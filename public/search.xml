<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[mac10.13ä¾æ—§è®©Xcodeæ”¯æŒæ‰“å¼€ç»ˆç«¯]]></title>
    <url>%2Fmac-high-sierra-open-with-external%2F</url>
    <content type="text"><![CDATA[åœ¨macOS10.13ä»¥å‰æ˜¯æ”¯æŒXcodeä¸­ç›´æ¥æ‰“å¼€ç»ˆç«¯çš„ï¼Œæ­¥éª¤å‘¢å°±æ˜¯ä¸‹é¢è¿™æ ·å­ï¼š å³å‡»å·¥ç¨‹ Open With External Editor ç»ˆç«¯å¼¹å‡ºæ¥äº†ã€‚ã€‚ å¦‚æœæ²¡æœ‰ç”Ÿæ•ˆï¼Œå°±æ˜¯ä½ çš„ç”µè„‘ä¸Šè£…äº†ä»€ä¹ˆå¯ä»¥æ‰“å¼€xx.xcodeprojçš„åº”ç”¨ç¨‹åºï¼Œä¹Ÿå°±æ˜¯åœ¨Finderä¸‹å³å‡»å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ ·å¼ï¼š å‘ï½ Xcodeä¸ºé»˜è®¤ï¼Œå¤‡å¿˜å½•ä¸ºé»˜è®¤ä¸‹é¢çš„ç¬¬ä¸€ä¸ªï½ï½ å¯¹ï¼Œå¦‚æœè¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šé¢3æ­¥ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼šè¿™ä¸ªæ–‡ä»¶è¢«è«åå…¶å¦™çš„ä¿å­˜åœ¨äº†å¤‡å¿˜å½•ï½ï½ è¿™ä¸æ˜¯æˆ‘ä»¬è¦çš„ğŸ¤·â€â™‚ï¸ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¿®æ”¹å¤‡å¿˜å½•.appçš„é…ç½®æ–‡ä»¶æ¥è¾¾åˆ°æˆ‘ä»¬çš„æ•ˆæœã€‚ æˆå› macSO10.13åŠ å¼ºäº†å¤‡å¿˜å½•ï¼Œå—¯çš„ç¡®å˜å¼ºäº†ï¼Œå¯æ˜¯å¹¶æ²¡æœ‰Xcodeå’Œç»ˆç«¯å¸¸ç”¨ã€‚ å¤‡å¿˜å½•å¢åŠ äº†å¯¼å…¥çš„åŠŸèƒ½ï¼Œæ”¯æŒäº†ä¸€äº›æ–‡ä»¶çš„æ‰“å¼€(åªæ˜¯å¯¼å…¥è€Œå·²ã€‚ã€‚)ï¼Œä½†æ˜¯å¹¶ä¸é€‚åˆæˆ‘ã€‚äºæ˜¯æ”¹ä¸€ä¸‹å§ï½ï½ æ“ä½œ åœ¨åº”ç”¨ç¨‹åºä¸­æ‰¾åˆ°å¤‡å¿˜å½• æ˜¾ç¤ºåŒ…å†…å®¹ æ‰¾åˆ° æˆ‘ä»¬è¦ä¿®æ”¹çš„plistæ–‡ä»¶ï¼š Contents/Info.plist åšä¸€ä¸‹å¤‡ä»½ï¼šå¤åˆ¶ä¸€ä¸‹ã€‚ã€‚ ç¡®ä¿ å·²å®Œæˆ ç›´æ¥ä¿®æ”¹Info.plistä¼šæç¤ºæ²¡æœ‰æƒé™ï¼Œä½¿ç”¨sudo vim Info.plistä¿®æ”¹ ä¸ç®¡ä½ ç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œåˆ é™¤ä¸‹é¢çš„è¿™äº›ä»£ç  1234567891011&lt;dict&gt; &lt;key&gt;CFBundleTypeName&lt;/key&gt; &lt;string&gt;General files and folders&lt;/string&gt; &lt;key&gt;CFBundleTypeRole&lt;/key&gt; &lt;string&gt;Viewer&lt;/string&gt; &lt;key&gt;LSItemContentTypes&lt;/key&gt; &lt;array&gt; &lt;string&gt;public.data&lt;/string&gt; &lt;string&gt;public.directory&lt;/string&gt; &lt;/array&gt;&lt;/dict&gt; :wq é‡å¯ä¸€ä¸‹ ï¼ˆç›®çš„ï¼šé‡å»ºç´¢å¼•ï¼‰ è‡³äºæˆ‘åšäº†ä»€ä¹ˆè®²é“ç†ï¼Œç”¨Xcodeçš„éƒ½çŸ¥é“å§ï¼Ÿè¿™ä¸ªæ˜¯æ³¨å†Œçš„appæ”¯æŒçš„æ–‡ä»¶ç±»å‹ã€‚ åˆ é™¤ä¹‹åå°±å¯ä»¥äº†ï¼Œå°±è¿™ä¹ˆå¤šğŸ˜‚ æ³¨æ„ä¸€ä¸‹æ“ä½œä¸­çš„æ­¥éª¤9å¯ä»¥æœ‰è„šæœ¬ï¼Œä½†æ˜¯è¿˜æ˜¯è€å®é‡å¯ä¸€ä¸‹å§ï¼Œæœ‰çš„è„šæœ¬ä¼šä½¿éƒ¨åˆ†å›¾æ ‡å¤±æ•ˆï¼Œå·¨çƒ¦ã€‚ã€‚è¿˜æ˜¯é‡å¯ä¸€ä¸‹æ¯”è¾ƒé è°±ã€‚æ¯•ç«Ÿä¸ç€æ€¥]]></content>
  </entry>
  <entry>
    <title><![CDATA[Xcode9ç¼–è¯‘å¤±è´¥]]></title>
    <url>%2Fdebug-xcode9-build-ipa%2F</url>
    <content type="text"><![CDATA[é”™è¯¯è¾“å‡º error: exportArchive: â€œFangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features. Error Domain=IDEProvisioningErrorDomain Code=9 â€œâ€Fangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features.â€ UserInfo={NSLocalizedDescription=â€Fangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features., NSLocalizedRecoverySuggestion=Add a profile to the â€œprovisioningProfilesâ€ dictionary in your Export Options property list.} é”™è¯¯åŸå› åœ¨å‡çº§Xcode9æ­£å¼ç‰ˆä¹‹åï¼ŒJenkinsä¹Ÿå°±å‡çº§äº†ï¼Œäºæ˜¯ä¹ç”¨åŸæ¥çš„å¥—è·¯æ‰“åŒ…ä¹‹åå°±æ˜¯ä¸Šé¢çš„é”™è¯¯ 5555â€¦ å¦‚æœä½¿ç”¨xcodebuildè¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªä¼šå‘ç”Ÿåœ¨é€‰æ‹©è¯ä¹¦çš„æ­¥éª¤ï¼Œé”™è¯¯å¤§è‡´å°±æ˜¯è¿™æ ·ã€‚ $xcodebuild --help å¯ä»¥çœ‹åˆ°ä¸€äº›ä¿¡æ¯ï¼Œè€Œä¸”åœ¨æœ€åè¿˜ç‰¹æ„æå‡ºäº†ä¸€ä¸ªâ€œ-exportOptionsPlistâ€å‚æ•°ã€‚å…·ä½“å†…å®¹è§xcodebuild --help è§£å†³é—®é¢˜æ‰æ˜¯å…³é”® ä½¿ç”¨xcode9è¿›è¡Œä¸€æ¬¡archive é€‰æ‹©ç›¸å…³è¯ä¹¦å•Šç¥é©¬çš„ï¼Œä¿æŒthinningä¸å˜å°±å¥½ å¯¼å‡º å¯¼å‡ºç›®å½•æœ‰ä¸€ä¸ªExportOptionsPlist.plistï¼Œè¿™ä¸ªå°±æ˜¯æ‰“åŒ…æ—¶å€™éœ€è¦çš„plist è„šæœ¬æ„å»ºipaå³ä¸ºç›®æ ‡å˜é‡ï¼Œå…·ä½“çš„å‚çœ‹æ‰“åŒ…è„šæœ¬ 123456789101112131415161718192021222324252627282930313233rm -rf ./build/*cat &lt;&lt; EOF &gt; ./build/exportOptionsPlist.plist&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;&lt;plist version="1.0"&gt;&lt;dict&gt; &lt;key&gt;compileBitcode&lt;/key&gt; &lt;true/&gt; &lt;key&gt;method&lt;/key&gt; &lt;string&gt;enterprise&lt;/string&gt; &lt;key&gt;provisioningProfiles&lt;/key&gt; &lt;dict&gt; &lt;key&gt;ershoufanglzg.fangdd.com&lt;/key&gt; &lt;string&gt;ershoufanglzg_dis&lt;/string&gt; &lt;/dict&gt; &lt;key&gt;signingCertificate&lt;/key&gt; &lt;string&gt;iPhone Distribution&lt;/string&gt; &lt;key&gt;signingStyle&lt;/key&gt; &lt;string&gt;manual&lt;/string&gt; &lt;key&gt;stripSwiftSymbols&lt;/key&gt; &lt;true/&gt; &lt;key&gt;teamID&lt;/key&gt; &lt;string&gt;J3B467DURT&lt;/string&gt; &lt;key&gt;thinning&lt;/key&gt; &lt;string&gt;&amp;lt;none&amp;gt;&lt;/string&gt;&lt;/dict&gt;&lt;/plist&gt;EOFxcodebuild -archivePath "./build/xxx.xcarchive" -workspace Fangduoduo.xcworkspace -sdk iphoneos -scheme "Fangduoduo_ent" -configuration "Release Inhouse" archivexcodebuild -exportArchive -archivePath "./build/xxx.xcarchive" -exportPath "./build/" -exportOptionsPlist ./build/exportOptionsPlist.plistipa=$(pwd)/$(ls ./build/*.ipa) xcodebuild â€“help Available keys for -exportOptionsPlist: compileBitcode : Bool For non-App Store exports, should Xcode re-compile the app from bitcode? Defaults to YES. embedOnDemandResourcesAssetPacksInBundle : Bool For non-App Store exports, if the app uses On Demand Resources and this is YES, asset packs are embedded in the app bundle so that the app can be tested without a server to host asset packs. Defaults to YES unless onDemandResourcesAssetPacksBaseURL is specified. iCloudContainerEnvironment : String If the app is using CloudKit, this configures the â€œcom.apple.developer.icloud-container-environmentâ€ entitlement. Available options vary depending on the type of provisioning profile used, but may include: Development and Production. installerSigningCertificate : String For manual signing only. Provide a certificate name, SHA-1 hash, or automatic selector to use for signing. Automatic selectors allow Xcode to pick the newest installed certificate of a particular type. The available automatic selectors are â€œMac Installer Distributionâ€ and â€œDeveloper ID Installerâ€. Defaults to an automatic certificate selector matching the current distribution method. manifest : Dictionary For non-App Store exports, users can download your app over the web by opening your distribution manifest file in a web browser. To generate a distribution manifest, the value of this key should be a dictionary with three sub-keys: appURL, displayImageURL, fullSizeImageURL. The additional sub-key assetPackManifestURL is required when using on-demand resources. method : String Describes how Xcode should export the archive. Available options: app-store, package, ad-hoc, enterprise, development, developer-id, and mac-application. The list of options varies based on the type of archive. Defaults to development. onDemandResourcesAssetPacksBaseURL : String For non-App Store exports, if the app uses On Demand Resources and embedOnDemandResourcesAssetPacksInBundle isnâ€™t YES, this should be a base URL specifying where asset packs are going to be hosted. This configures the app to download asset packs from the specified URL. provisioningProfiles : Dictionary For manual signing only. Specify the provisioning profile to use for each executable in your app. Keys in this dictionary are the bundle identifiers of executables; values are the provisioning profile name or UUID to use. signingCertificate : String For manual signing only. Provide a certificate name, SHA-1 hash, or automatic selector to use for signing. Automatic selectors allow Xcode to pick the newest installed certificate of a particular type. The available automatic selectors are â€œMac App Distributionâ€, â€œiOS Developerâ€, â€œiOS Distributionâ€, â€œDeveloper ID Applicationâ€, and â€œMac Developerâ€. Defaults to an automatic certificate selector matching the current distribution method. signingStyle : String The signing style to use when re-signing the app for distribution. Options are manual or automatic. Apps that were automatically signed when archived can be signed manually or automatically during distribution, and default to automatic. Apps that were manually signed when archived must be manually signed during distribtion, so the value of signingStyle is ignored. stripSwiftSymbols : Bool Should symbols be stripped from Swift libraries in your IPA? Defaults to YES. teamID : String The Developer Portal team to use for this export. Defaults to the team used to build the archive. thinning : String For non-App Store exports, should Xcode thin the package for one or more device variants? Available options: (Xcode produces a non-thinned universal app), (Xcode produces a universal app and all available thinned variants), or a model identifier for a specific device (e.g. â€œiPhone7,1â€). Defaults to . uploadBitcode : Bool For App Store exports, should the package include bitcode? Defaults to YES. uploadSymbols : Bool For App Store exports, should the package include symbols? Defaults to YES.]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹]]></title>
    <url>%2Fios-automation-jenkins-build%2F</url>
    <content type="text"><![CDATA[å¿™äºiOS11çš„å…¼å®¹ iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹ ä»‹ç»Jenkinsç¯å¢ƒå·²æ­å»ºå¥½ï¼Œç°åœ¨æˆ‘ä»¬æ¥å¼€å§‹æ„‰å¿«çš„ä¸ºiOSæ‰“åŒ…å§ï½ ä»è¿™ä¸ªæ–‡ç« ä¸­ä½ å°†è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š åœ¨Jenkinsåˆ›å»ºå·¥ç¨‹ buildå‡ºipa å°†ipaä¸Šä¼ è‡³fir é’‰é’‰æœºå™¨äººç¾¤é€šçŸ¥ å°†dsymä¸Šä¼ è‡³bugly è„šæœ¬ç¯å¢ƒå®‰è£…è¿™é‡Œå¤§å¤šæ•°æ“ä½œéƒ½æ˜¯ç”¨è„šæœ¬æ¥è¿›è¡Œçš„ï¼Œä¸ä¸ºåˆ«çš„ï¼Œå°±ä¸ºè‡ªç”±å’Œä»¥åï½ fastlaneæ­¤ä¹ƒè‡ªåŠ¨åŒ–ç¥å™¨ã€‚æ–‡æ¡£åœ¨æ­¤ã€‚å¼€æºå“Ÿï½ æ­¤å¤„ä¸»è¦ç”¨æ¥ç¼–è¯‘ã€æ‰“åŒ…ã€‚ å®‰è£…æ–¹æ³•ï¼š 1$ brew cask install fastlane æ­¤ç¥å™¨é™¤äº†ä¸Šè¿°åŠŸèƒ½ï¼Œè¿˜æä¾›å¾ˆå¤šå¾ˆå¤šå¾ˆå¤šå¾ˆå¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç¥é©¬çš„éƒ½æ”¯æŒã€‚éœ€è¦çš„å¯ä»¥å»æ–‡æ¡£é‡Œé¢ç¿»ç¿»ã€‚ åœ¨Xcode9 æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬2.14.1æ‰“åŒ…å‡ºé—®é¢˜äº†ã€‚ã€‚å…·ä½“åœ¨è¿™é‡Œè¯¦è§Xcode9ç¼–è¯‘å¤±è´¥ã€‚äºæ˜¯å‘¼é‡‡ç”¨äº†xcodebuildè¿›è¡Œæ‰“åŒ… fir.im-clifir.imæä¾›çš„åº”ç”¨å†…æµ‹æ‰˜ç®¡å·¥å…·ã€‚å¼€æºå®˜ç½‘ã€‚ å®‰è£…æ–¹æ³•ï¼š 1$ gem install fir-cli æ­¤å·¥å…·ä¹Ÿæä¾›æ‰“åŒ…ipaã€apkã€ä¸Šä¼ ç¬¦å·è¡¨è‡³BugHDã€ç­‰åŠŸèƒ½ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹©äº†fastlane gym ä¸Šä¼ åŠ é€Ÿï¼š 1$ sh -c "$(curl -sSL https://gist.githubusercontent.com/trawor/5dda140dee86836b8e60/raw/turbo-qiniu.sh)" ä¸Šä¼ åŠ é€Ÿä»£ç å·²ç»å¼€æºè‡³æ­¤ã€‚ BugHD: å·²åœæ­¢çº¿ä¸Šå…è´¹æœåŠ¡ï¼Œå¼€å§‹å–ç§æœ‰éƒ¨ç½²äº†ã€‚ å¦å¤–ï¼Œfir ä¹Ÿæœ‰Jenkinsæ’ä»¶ï¼Œä½†æ˜¯è¿™é‡Œé€‰æ‹©è„šæœ¬æ–¹å¼ã€‚ æ’ä»¶å®‰è£…æ‰€æœ‰çš„æ’ä»¶å¯ä»¥åœ¨ç³»ç»Ÿç®¡ç† -&gt; æ’ä»¶ç®¡ç†ä¸­è¿›è¡Œå®‰è£…ã€å¸è½½ã€é™çº§ã€æ›´æ–°ã€ç­‰æ“ä½œã€‚ ç¡®ä¿ä»¥ä¸‹æ’ä»¶å·²ç»è¢«å®‰è£…ï¼š æºä»£ç ç®¡ç†ï¼šGit Plugin ç¼–è¯‘è„šæœ¬ç¯å¢ƒå˜é‡ï¼šTool Environment Plugin å—¯ï¼Œå¼€å§‹åˆ›å»ºå·¥ç¨‹ï¼Œç„¶åé…ç½®æ‰“åŒ…å§ï¼ å·¥ç¨‹åˆ›å»ºå·¦ä¾§çš„æ–°å»º(New Item)æˆ‘å°±ä¸è¯´äº†å§ï½ï¼Œç‚¹å‡»è¾“å…¥é¡¹ç›®åå­—ï¼Œç„¶åé€‰æ‹©ç¬¬ä¸€ä¸ªæ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®å°±è¡Œå•¦ï½ï½ æ­¤å¤„é¡¹ç›®åå­—æš‚ä¸”æˆä¸ºtestã€‚è¿™é‡Œåªè¯´ä¸€äº›æ¯”è¾ƒé‡è¦çš„ï¼Œæ²¡æœ‰æ´»ä¸æˆçš„é‚£ç§é…ç½®ã€‚åˆ«çš„è‡ªå·±ç ”ç©¶ä¸€ä¸‹æˆ–è€…ç‚¹å‡»å³ä¾§â“å°±èƒ½çœ‹åˆ°ä»‹ç»ã€‚ æºç ç®¡ç†æ­¤å¤„ç‚¹å‡»Gitï¼Œå±•å¼€ä¹‹åè¾“å…¥Repository URLå³å¯ã€‚ Repository URLè¾“å…¥å®Œæ¯•ä¹‹åç‚¹å‡»åˆ«å¤„ï¼ŒJenkinsçš„Gitæ’ä»¶ä¼šè‡ªåŠ¨æ ¡éªŒè¯¥URLæ˜¯å¦èƒ½å¤Ÿcloneä¸‹æ¥ä»£ç ã€‚å‡ºç°çº¢è‰²å°±è‡ªå·±æ ¹æ®é”™è¯¯ä¿®æ”¹ä¸€ä¸‹å’¯ã€‚ã€‚ å¦å¤–æ­¤å¤„æ”¯æŒssh çš„æ–¹å¼ï¼Œå¤§è‡´æ ·å¼ä¸ºï¼šssh://sunjigang@github.com:29418/projects/aaaã€‚ Branches to build å†™ä¸Šä½ çš„æ„å»ºåˆ†æ”¯ï½ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚æ¥ï¼Œmasterä¸€èˆ¬ä¸ºä»“åº“çš„é»˜è®¤åˆ†æ”¯ã€‚ æ„å»ºè§¦å‘å™¨æ­¤å¤„è¡¨ç¤ºè¯¥é¡¹ç›®çš„æ„å»ºè§¦å‘æ¡ä»¶ã€‚ï¼ˆå¯é€‰ï¼‰ æˆ‘ä»¬è¿™é‡Œè¯´ä¸€ä¸‹Poll SCMï¼š å®šæ—¶æ£€æŸ¥æºç å˜æ›´ã€‚æ¡ä»¶æ˜¯ ä¸€å®šè¦é…ç½®Gitè¿™æ ·çš„æºç ç®¡ç†ã€‚ ä¾‹å­ï¼š H/15 * * * *ï¼šæ¯15åˆ†é’Ÿæ„å»ºä¸€æ¬¡ 0 2 * * *ï¼š æ¯å¤©2:00æ„å»ºä¸€æ¬¡ æ„å»ºæ­¤å¤„ä¸ºæ„å»ºçš„æ ¸å¿ƒğŸ˜‚ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¸ºäº†è‡ªç”±ï¼Œæ­¤å¤„å…¨éƒ¨ä½¿ç”¨shellè„šæœ¬ã€‚ 12345678910111213141516171819202122232425262728293031323334# å·¥ç¨‹åworkspace='xxx.xcworkspace'# æ„å»ºschemescheme='xxx'# æ‰“åŒ…ç±»å‹ï¼šapp-store, ad-hoc, package, enterprise, development, and developer-id.export_method='enterprise'# firçš„tokenï¼Œåœ¨fir-&gt;ç”¨æˆ·-&gt;token è·å–fir_token='c5077e0368888b9750ae848b9fe00***'# firä¸Šä¼ çŸ­é“¾æ¥ï¼Œæ•ˆæœä¸º https://fir.im/xxxfir_url='xxx'# é’‰é’‰æœºå™¨äººtokendingtalk_token='6d09e43ddc62e540be914ff2e901e28b921d55c5ad457f6f3571f9f881287***'# é’‰é’‰æœºå™¨äººå‘é€çš„å†…å®¹dingtalk_content="iOSXXXå·²ç»ä¸Šä¼ è‡³ http://fir.im/$&#123;fir_url&#125; ,å§å•¦å§å•¦å§å•¦ï½"# æ„å»ºfastlane gym --workspace $workspace \ --scheme $scheme \ --export_method $export_method \ clean# firipa=$(pwd)/$(ls *.ipa)git log -10 &gt; git.logfir p $ipa -T $fir_token -s $fir_url -c git.log# é’‰é’‰é€šçŸ¥curl "https://oapi.dingtalk.com/robot/send?access_token=$&#123;dingtalk_token&#125;" -H 'Content-Type: application/json' -d ' &#123;"msgtype": "text", "text": &#123; "content":$&#123;dingtalk_content&#125; &#125; &#125;' è‡³æ­¤ å·²ç»å®Œæˆäº†æ‰“åŒ…ã€ä¸Šä¼ firã€é’‰é’‰æœºå™¨äººé€šçŸ¥ã€‚ ä¸Šè¿°è„šæœ¬åªæ˜¯é…ç½®çš„ä¾‹å­ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚ï¼Œè‡ªå·±ç¼–å†™å’Œé…ç½®ã€‚ç‰¹åˆ«æ˜¯ .xcworkspaceçš„ä½ç½®ï¼Œè¦æ‰¾æ¸…æ¥šå‘€ schemeæ— æ³•æ‰¾åˆ°æ˜¯å› ä¸ºä½ åœ¨æäº¤ä»£ç çš„æ—¶å€™æ²¡æœ‰å°†å…¶è®¾ç½®ä¸ºshared fastlane gym æ”¯æŒå¾ˆå¤šå‚æ•°ï¼Œæ˜¯å¯¹xcodebuildçš„å°è£…ï¼Œæºç åŠæ–‡æ¡£åœ¨æ­¤ ä¸Šä¼ dSYMè‡³Buglyè¿™ä¸ªè¿˜æ˜¯æœ‰ç‚¹ç‚¹å¤æ‚çš„ï¼Œå› ä¸ºbuglyå¹¶æœªæä¾›å®Œæ•´çš„cliå·¥å…·é“¾ï¼Œéœ€è¦æ‰‹åŠ¨è·‘jaråŒ…ã€‚ä¸è¿‡éƒ½æ˜¯å¯ä»¥å®Œæˆçš„ã€‚ ä¸ºäº†éš”ç¦»å¼€æ‰“åŒ…å’Œä¸Šä¼ ï¼Œè¿™é‡Œåœ¨Jenkinsä¸Šæ–°å»ºä¸€ä¸ªé¡¹ç›®ç”¨æ¥ä¸Šä¼ dSYM]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AppStoreçš„æŠ˜å æ•ˆæœ]]></title>
    <url>%2Fappstore-truncate%2F</url>
    <content type="text"><![CDATA[UITextView-Moreä½¿ç”¨UITextKit å®ç°â€œæ›´å¤šâ€çš„æŠ˜å æ•ˆæœ ä¸»è¦ä»£ç è·å–æœ€åä¸€è¡ŒRect12345678var lastRect = CGRect.zerolayoutManager.enumerateEnclosingRects(forGlyphRange: NSRange(location: 0, length: textStorage.string.characters.count), withinSelectedGlyphRange: NSRange(location: NSNotFound, length: 0), in: textContainer, using: &#123; [weak self] (rect, isStop) inguard let _self = self else &#123; return &#125;var newRect = rectnewRect.origin.y += _self.textContainerInset.toplastRect = newRect&#125;)print(lastRect) å¢åŠ  exclusionPaths1textContainer.exclusionPaths = [UIBezierPath.init(rect: rect)] å¤‡æ³¨ UITextViewé»˜è®¤æºå¸¦å·¦å³è¾¹è·ï¼Œé€šè¿‡UITextView.textContainer.lineFragmentPaddingè·å– UITextViewé»˜è®¤æºå¸¦ä¸Šä¸‹å·¦å³è¾¹è·(UITextView.textContainerInset)ï¼Œå…¶ä¸­å·¦å³å’ŒlineFragmentPaddingç›¸åŠ  æ­¤å¤„å¹¶æ²¡æœ‰å¯¹TruncateTextViewè¿›è¡Œè¿‡å¤šçš„è®¾ç½®ï¼Œä¸»è¦æ˜¯å› ä¸ºç»§æ‰¿åœ¨UITextViewä¸‹ï¼ŒGIFä¸­çš„è¿™éƒ¨åˆ†è®¾ç½®æ”¾åœ¨äº†ViewController.swiftä¸­ æ­¤å¤„ä½¿ç”¨çš„æ˜¯frameï¼Œå¯ä»¥åœ¨UIView.sizeToFit()ä¹‹åè·å–åˆ°UIViewçš„Sizeã€‚çº¦æŸä¹Ÿå¤§æŠµå¦‚æ­¤ æ„Ÿè°¢ä¹é€é¥æä¾›çš„ä¾‹å­ï¼Œæ‰æ‰¾åˆ°äº†open func truncatedGlyphRange(inLineFragmentForGlyphAt glyphIndex: Int) -&gt; NSRangeæ–¹æ³•ğŸ˜‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ•ˆæœ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º]]></title>
    <url>%2Fios-automation-jenkins-configuration%2F</url>
    <content type="text"><![CDATA[iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹ ä»‹ç» JenkinsBuild great things at any scaleThe leading open source automation server, Jenkins provides hundreds of plugins to support building, deploying and automating any project. å¦‚å®˜ç½‘æ‰€è¯´Build great things at any scale ä»è¿™ç¯‡æ–‡ç« ä¸­ä½ å°†ä¼šå®ç°ï¼š åœ¨Macä¸Šå¤šç§æ–¹æ¡ˆå®‰è£…å¹¶å¯åŠ¨jenkins åœ¨å±€åŸŸç½‘ä¸­æ­£å¸¸è®¿é—®jenkins å®‰è£…å½“ç„¶ä½ é¦–å…ˆéœ€è¦ä¸€ä¸ªmacOSçš„ç³»ç»Ÿï¼Œä¸ºåæ¥çš„æ„å»ºåšåŸºç¡€ã€‚ Jenkinsä¸­å¯ä»¥ä½¿ç”¨pkgã€warçš„æ–¹å¼è¿è¡Œï¼Œå½“ç„¶è¿˜æœ‰åœ¨Installing Jenkinsä¸­æä¾›ä¸€äº›å®‰è£…æ–¹å¼ï¼š macOSTo install from the website, using a package: Download the latest package Open the package and follow the instructions Jenkins can also be installed using brew: Install the latest release version 1brew install jenkins Install the LTS version 1brew install jenkins-lts è¿™é‡Œä½¿ç”¨brewï¼Œå› ä¸ºå¾ˆæ–¹ä¾¿ï¼š12345678# å®‰è£…$ brew update &amp;&amp; brew install jenkins# æ›´æ–°$ brew update &amp; brew upgrade jenkins# åå°è¿è¡Œ è¿˜æ”¯æŒ`stop`ã€`restart`ç­‰ (è¿™ç§æ–¹å¼è¿˜æ˜¯æœ‰å·®åˆ«çš„ï¼Œä¸‹é¢ä¼šè¯´æ˜)$ brew services start jenkins è¿è¡Œå»ºè®®å…ˆæ¥çœ‹ä¸€æ³¢--help 1$ jenkins --help ä¸‹é¢æ˜¯å¸¸ç”¨çš„å‡ ç§æ–¹æ¡ˆï¼Œæ­¤å¤„å¦‚æœç¬¬ä¸€æ¬¡å®‰è£…ï¼Œå»ºè®®é‡‡ç”¨æ–¹æ¡ˆä¸€æˆ–è€…æ–¹æ¡ˆäºŒï¼Œæš‚æ—¶ä¸å»ºè®®æ–°æ‰‹ä½¿ç”¨åå°è¿è¡Œçš„æ–¹æ¡ˆï½ï½ï¼ˆä¼šåœ¨æ‰“åŒ…çš„æ—¶å€™å‡ºç°è¯ä¹¦çš„é—®é¢˜ï¼‰ æ–¹æ¡ˆä¸€ç›´æ¥è¿è¡Œjenkinså‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—è¾“å‡ºï¼Œä½†æ˜¯ä¸èƒ½é€€å‡ºå‘½ä»¤ã€‚ 1$ jenkins ç»è¿‡æ¼«é•¿çš„åˆå§‹åŒ–ï¼Œä¼šå°† ~/.jenkinsç›®å½•ä½œä¸ºJENKINS_HOME localhost:8080ä½œä¸ºé»˜è®¤URL ç»ˆç«¯è¾“å‡ºStarted initializationä¸€è¡Œä¹‹åå°±å¯ä»¥æ­£å¸¸æ‰“å¼€äº†ã€‚ åœ¨æµè§ˆå™¨æ‰“å¼€http://10.12.12.10:8080å°±å¯ä»¥æ­£å¸¸åŠ è½½å•¦ï½ é€€å‡ºè¿è¡Œï¼šcontrol + C ç»„åˆé”®ã€‚ æ–¹æ¡ˆäºŒç›´æ¥openï¼Œçœ‹ä¸åˆ°æ—¥å¿—è¾“å‡ºï¼Œæ‰€å¯¹åº”çš„è¿è¡Œç¯å¢ƒå’Œæ–¹æ¡ˆä¸€ç›¸åŒã€‚ 1$ open /usr/local/opt/jenkins/libexec/jenkins.war å‘½ä»¤ç»“æŸï¼Œç¨ç­‰ç‰‡åˆ»(åˆå§‹åŒ–ç›¸å…³ç›®å½•ã€ç¯å¢ƒ)ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€http://10.12.12.10:8080å°±å¯ä»¥æ­£å¸¸åŠ è½½å•¦ï½ æ–¹æ¡ˆä¸‰ä½¿ç”¨brewç›´æ¥æŒ‚åœ¨åå°ä½œä¸ºæœåŠ¡è¿è¡Œèµ·æ¥ 1$ sudo brew services start jenkins brewè¿˜æä¾›å…¶ä»–çš„å‚æ•°ï¼Œæ¯”å¦‚è¯´restartã€listã€stop ç­‰ç­‰ã€‚ æ­¤æ–¹æ¡ˆå’Œä¸Šé¢çš„è¿è¡Œç¯å¢ƒæ˜¯ä¸ä¸€æ ·çš„ï¼Œä¼šæœ‰äº›æƒé™çš„å·®åˆ«ã€‚ å…¶ä»–æ–¹æ¡ˆä½¿ç”¨launchctlã€nohup ç­‰å…¶ä»–æ–¹æ¡ˆè¿›è¡Œçš„åå°è¿è¡Œï¼ŒåŒæ–¹æ¡ˆä¸‰å·®ä¸å¤šã€‚ éœ€è¦è¯´çš„æ˜¯launchctlæ˜¯macOSä¸‹ç³»ç»Ÿæä¾›çš„åå°è¿è¡Œæ–¹æ¡ˆï¼Œbrewç­‰ï¼Œå‡æ¥è‡ªäºæ­¤ã€‚ åœ¨launchctlåå°ä¸­éœ€è¦ä¸€ä¸ªplistï¼Œä½†æ˜¯brewå·²ç»åšå¥½äº†ï¼Œæ”¾ç½®åœ¨~/Library/LaunchAgents/homebrew.mxcl.jenkins.plistã€‚éœ€è¦è¯´çš„æ˜¯launchctlæ˜¯macOSä¸‹ç³»ç»Ÿæä¾›çš„åå°è¿è¡Œæ–¹æ¡ˆï¼Œbrewç­‰ï¼Œå‡æ¥è‡ªäºæ­¤ï¼Œå…·ä½“çš„é…ç½®å‚æ•°éƒ½å’Œlaunchctlä¸€æ ·çš„ï¼Œæœç´¢ä¸€ä¸‹å¾ˆå¤šã€‚brewä¸ºæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ä¸€ä¸ªï¼Œç›´æ¥ä½¿ç”¨æ–¹æ¡ˆä¸‰å°±è¡Œã€‚ å…·ä½“æ“ä½œå¯ä»¥Googleä¸€ä¸‹ï¼Œå¾ˆå¤šçš„ï½ å®‰è£…å®Œæˆåçš„é…ç½®åœ¨Jenkinsåˆå§‹åŒ–å®Œæ¯•ä¸ºäº†éªŒè¯ç®¡ç†å‘˜èº«ä»½ï¼Œéœ€è¦å°†Jenkinsæœºå™¨ä¸Šçš„ä¸€ä¸ªå­—ç¬¦ä¸²è¾“å…¥åˆ°http://10.12.12.10:8080ä¸­è¿›è¡ŒéªŒè¯ï¼Œå…·ä½“æ–‡ä»¶ç›®å½•åœ¨è¾“å…¥çš„ç•Œé¢å°±èƒ½çœ‹åˆ°ï¼Œä¸è¦å¤§æƒŠå°æ€ªã€‚ ä¹‹åå¼€å§‹é€‰æ‹©å®‰è£…æ’ä»¶ã€‚è¿™é‡Œå¯ä»¥é€‰æ‹©æ¨èçš„ï½ï½ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å‹¾é€‰ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œç›´æ¥é€‰æ‹©æ¨èçš„æ–¹æ¡ˆè¿›è¡Œå®‰è£…ã€‚ ç»è¿‡æ¼«é•¿çš„ç­‰å¾…ï¼Œç»ˆäºå°†æ’ä»¶å®‰è£…å®Œæ¯•ï¼Œå¹¶å¯åŠ¨äº†èµ·æ¥ï½ï½ Jenkinsæƒé™ï¼Œå—¯ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œå¯ä»¥å»ç³»ç»Ÿç®¡ç† -&gt; Configure Global Security ä¸­è¿›è¡Œè®¾ç½®ã€‚ æ¥ä¸‹æ¥å¼€å§‹å»é…ç½®å·¥ç¨‹å§ï¼ä¼ é€é—¨ï¼šiOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹ å¯èƒ½ä¼šç¢°åˆ°çš„é”™è¯¯Error: Permission denied - *12$ brew services start jenkinsError: Permission denied - ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist è¿™ç§å¾ˆæ˜æ˜¾Permission deniedï¼Œåœ¨å‘½ä»¤è¡Œå‰æ·»åŠ sudoï¼Œç„¶åè¾“å…¥å¯†ç å³å¯ã€‚å¦‚ä¸‹ï¼š 1$ sudo brew services start jenkins æ–¹æ¡ˆäºŒåçš„åœ°å€å“ªé‡Œæ¥çš„ï¼Ÿè¿™é‡Œæ¨èçš„å®‰è£…æ–¹æ¡ˆæ˜¯brew install jenkins é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ‰¾åˆ°brewå®‰è£…çš„ä½ç½® 1234567891011$ $ brew services listName Status User Plistbeanstalkd stoppedinfluxdb stoppedjenkins started keith ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plistnginx stoppedsonarqube stoppedFDDdeiMac:~ FDD$ cat ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist...&lt;string&gt;/usr/local/opt/jenkins/libexec/jenkins.war&lt;/string&gt;... ç»™Jenkinsç»‘å®šä¸€ä¸ªIPè®²é“ç†è¿™ä¸ªä¸åº”è¯¥åœ¨è¿™é‡ŒèŠçš„ğŸ˜‚ï¼Œä¸è¿‡è¿˜æ˜¯è¯´ä¸€ä¸‹å§ã€‚ã€‚ ä¸€èˆ¬å±€åŸŸç½‘ä¸­éƒ½æ˜¯ç›´æ¥è‡ªåŠ¨è·å–IPä¿¡æ¯çš„ä¹Ÿå°±æ˜¯DHCPï¼Œä½†æ˜¯Jenkinsæ€»æ”¹IPä¹Ÿä¸å¥½ã€‚ã€‚äºæ˜¯ç»‘å®šä¸€ä¸‹å§ã€‚ åœ¨mac ä¸­ ç³»ç»Ÿåå¥½è®¾ç½® -&gt; ç½‘ç»œ è®°å½•ä¸‹æ¥å½“å‰è·å–åˆ°çš„IPã€‚ åœ¨é«˜çº§ä¸­å°†ä½¿ç”¨DHCPä¿®æ”¹ä¸ºä½¿ç”¨DHCP(æ‰‹åŠ¨è®¾å®šåœ°å€)ï¼Œç„¶åå°†ä¸Šé¢çš„åœ°å€å¡«è¿›å»å°±å¥½å•¦ï½ å½“ç„¶ä½ ä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–çš„åœ°å€ï¼Œåªè¦åˆ«äººæ²¡æœ‰å ç”¨ğŸ˜‚ï¼Œä½ å¼€å¿ƒå°±å¥½ï½]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé€†å‘-monkeydevå·¥å…·]]></title>
    <url>%2Freverse-ios-monkeydev%2F</url>
    <content type="text"><![CDATA[MonkeyDev wikiè¿™æ˜¯ä¸€ä¸ªä¸ºè¶Šç‹±å’Œéè¶Šç‹±å¼€å‘äººå‘˜å‡†å¤‡çš„å·¥å…·ï¼Œä¸»è¦åŒ…æ‹¬å››ä¸ªæ¨¡å—: Logos Tweak ä½¿ç”¨theosæä¾›çš„logify.plå·¥å…·å°†.xmæ–‡ä»¶è½¬æˆ.mmæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œé›†æˆäº†CydiaSubstrateï¼Œå¯ä»¥ä½¿ç”¨MSHookMessageExå’ŒMSHookFunctionæ¥Hook OCå‡½æ•°å’ŒæŒ‡å®šåœ°å€ã€‚ CaptainHook Tweak ä½¿ç”¨CaptainHookæä¾›çš„å¤´æ–‡ä»¶è¿›è¡ŒOC å‡½æ•°çš„Hookï¼Œä»¥åŠå±æ€§çš„è·å–ã€‚ Command-line Tool å¯ä»¥ç›´æ¥åˆ›å»ºè¿è¡Œäºè¶Šç‹±è®¾å¤‡çš„å‘½ä»¤è¡Œå·¥å…· MonkeyApp è¿™æ˜¯è‡ªåŠ¨ç»™ç¬¬ä¸‰æ–¹åº”ç”¨é›†æˆRevealã€Cycriptå’Œæ³¨å…¥dylibçš„æ¨¡å—ï¼Œæ”¯æŒè°ƒè¯•dylibå’Œç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæ”¯æŒPodç»™ç¬¬ä¸‰æ”¾åº”ç”¨é›†æˆSDKï¼Œåªéœ€è¦å‡†å¤‡ä¸€ä¸ªç ¸å£³åçš„ipaæˆ–è€…appæ–‡ä»¶å³å¯ã€‚ MonkeyDev wiki]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé€†å‘-class-dumpå·¥å…·]]></title>
    <url>%2Freverse-ios-class-dump%2F</url>
    <content type="text"><![CDATA[å®‰è£…class-dumpå»stevenygard.comä¸‹è½½æœ€æ–°çš„åŒ…ã€‚ å°†åŒ…ä¸­çš„class-dumpå¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°/opt/class-dumpã€‚(æˆ‘çš„é€†å‘ç›¸å…³å·¥å…·å‡åœ¨è¿™ä¸‹é¢ğŸ˜‚ï¼‰ åœ¨~/.base_profileä¸­æ·»åŠ export PATH=/opt/class-dump:$PATH è¿è¡Œsource ~/.base_profile æœ€åç¡®è®¤ä¸€ä¸‹å®‰è£…OK ï¼š 12$ class-dump --vclass-dump 3.5 (64 bit) compiled Nov 16 2013 12:22:33 åŠŸèƒ½ä½¿ç”¨ä¸€ä¸ªè®°å½•ä¸€ä¸ªå§ï½ ç”¨æ¥å¯¼å‡ºipa/.decryptedå¤´æ–‡ä»¶æ­¤å¤„åªèƒ½å¯¼å‡ºæœªåŠ å¯†çš„ipaï¼Œæˆ–è€…ç ¸è¿‡å£³çš„ã€‚å…·ä½“ç ¸å£³è¿‡ç¨‹ä¼ é€é—¨ 12345$ ls WeChat.decryptedWeChat.decrypted$ class-dump -H WeChat.decrypted -o ./Headers/$ ls HeadersHeaders å³å¾—å¤´æ–‡ä»¶ç›®å½•ï¼šHeaders]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé€†å‘-ç ¸å£³(cycript/clutch)]]></title>
    <url>%2Freverse-ios-dump-decrypted%2F</url>
    <content type="text"><![CDATA[å‡†å¤‡å·¥ä½œ è¶Šç‹±è®¾å¤‡ ç›®å‰æœ‰ä¸¤ç§ç ¸å£³å·¥å…·ï¼Œå¹¶ä¸è‚©å¹¶è‚©ï¼Œä¸€ä¸ªä¸è¡Œå°±ç”¨å¦ä¸€ä¸ªå‘—ï¼Œä¿©éƒ½ä¸è¡Œå°±Googleå§ï½ï½ ä¸‹é¢åˆ†åˆ«å¯¹cycriptã€clutchè¿›è¡Œç ¸å£³: ä½¿ç”¨cycriptè¿›è¡Œç ¸å£³å‡†å¤‡ Cydiaä¸­æœç´¢cycriptå¹¶å®‰è£…  æ­¥éª¤åˆ¶ä½œå¹¶ä¸Šä¼ dumpdecrypted.dylib ï¼ˆå·²ç»OKçš„å¯å¿½ç•¥åˆ¶ä½œç›®å‰æˆ‘åˆ¶ä½œç›®å½•æš‚æ—¶åœ¨~/Desktopã€‚ 1234$ git clone https://github.com/stefanesser/dumpdecrypted.git ~/Desktop$ cd ï½ï¼Desktop/dumpdecrypted$ make$ ls dumpdecrypted.dylib æ²¡ä»€ä¹ˆé”™è¯¯çš„è¯ï¼Œå³å¾—dumpdecrypted.dylibã€‚ ä¸Šä¼ å°†dumpdecrypted.dylibæ”¾åœ¨è¶Šç‹±è®¾å¤‡çš„/var/root/ä¸‹ 12345$ ls dumpdecrypted.dylib$ scp dumpdecrypted.dylib root@10.12.14.16:/var/root/root@10.12.14.16&apos;s password:dumpdecrypted.dylib 100% 193KB 3.0MB/s 00:00$ ç™»å½•è¿›è¶Šç‹±è®¾å¤‡å¯ä»¥ä½¿ç”¨ssh root@IPè¿›è¡Œç™»å½•ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ssh ipadï¼Œè¿™æ ·å…å¯†ç™»å½•ç™»å½•ã€‚ é…ç½®ä¼ é€é—¨ æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„è¿™é‡Œä»¥WeChatä¸ºä¾‹å­å•¦ï½ è®°å¾—å…ˆæ‰“å¼€å‘€ï½ï½ï½ ps -eï¼š æ˜¾ç¤ºæ‰€æœ‰ç¨‹åºgrep: è¿™é‡Œæ˜¯è¿‡æ»¤ä¸€ä¸‹ã€‚ã€‚å…·ä½“ç”¨æ³•Googleã€‚æ‰€æœ‰çš„ç¨‹åºæœ‰ç‚¹å¤šï¼Œæˆ‘çŸ¥é“åå­—ï¼Œæ‰€ä»¥ç›´æ¥è¿‡æ»¤ä¸€ä¸‹ã€‚ä¹Ÿå¯å¿½ç•¥ 1234567891011$ ps -e | grep WeChat705 ?? 0:02.20 /var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat707 ttys000 0:00.01 grep WeChat$ cycript -p 705$ cycript -p 705cy# [[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask][0]#&quot;file:///var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/&quot;cy# exit(0)MS:Error: _krncall(mach_vm_read_overwrite(task, data, sizeof(*baton), reinterpret_cast&lt;mach_vm_address_t&gt;(baton), &amp;error)) =4*** _assert(status == 0):../Inject.cpp(143):InjectLibrary$ æ­¤å¤„è·å¾—ä¸¤ä¸ªç›®å½•ï¼š /var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat /var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/ å¼€ç ¸1234567891011121314151617181920212223242526$ cd ~$ cp dumpdecrypted.dylib /var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/$ cd /var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/$ DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChatmach-o decryption dumperDISCLAIMER: This tool is only meant for security research purposes, not for application crackers.[+] detected 64bit ARM binary in memory.[+] offset to cryptid found: @0x1000c0ca8(from 0x1000c0000) = ca8[+] Found encrypted data at address 00004000 of length 51200000 bytes - type 1.[+] Opening /private/var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat for reading.[+] Reading header[+] Detecting header type[+] Executable is a plain MACH-O image[+] Opening WeChat.decrypted for writing.[+] Copying the not encrypted start of the file[+] Dumping the decrypted data into the file[+] Copying the not encrypted remainder of the file[+] Setting the LC_ENCRYPTION_INFO-&gt;cryptid to 0 at offset ca8[+] Closing original file[+] Closing dump file$ ls WeChat.decryptedWeChat.decrypted$ pwd/var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents æœ€åå¾—åˆ°æ–‡ä»¶: /var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/WeChat.decrypted å°†*.decryptedæ‹·è´å‡ºæ¥æˆ‘è¿™é‡Œç›´æ¥ä½¿ç”¨scpå§ï½ã€‚ 123456$ cd /Users/Madordie/Desktop/Madordie/iOS/xxx$ scp root@10.12.14.16:/var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/WeChat.decrypted .root@10.12.14.16&apos;s password:WeChat.decrypted 100% 61MB 4.7MB/s 00:12$ ls WeChat.decryptedWeChat.decrypted è‡³æ­¤åœ¨ä¸»æœºä¸Šå¾—åˆ°ï¼š /Users/Madordie/Desktop/Madordie/iOS/xxx/WeChat.decrypted æ€»ç»“ ä¸ºä»€ä¹ˆå°†dumpdecrypted.dylib copy è‡³*/Documents/ä¸‹ï¼Ÿ ï¼šåˆ«çš„ç›®å½•æ²¡æœ‰æƒé™ï½ï½ï¼ˆdumpdecrypted.dylib: stat() failed with errno=1 ï¼‰ ä½¿ç”¨clutchè¿›è¡Œç ¸å£³æ­¥éª¤ä¸‹è½½ä¸Šä¼ clutch(æ— é¡»é‡å¤åš)clutchå¯ä»¥ä»https://github.com/KJCracks/Clutchä¸‹è½½ç¼–è¯‘ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥ä»https://github.com/KJCracks/Clutch/releasesç›´æ¥ä¸‹è½½ã€‚ ç›®å‰ä¸‹è½½åˆ°ç›®å½•~/Clutch-2.0.4 ä¸Šä¼ åˆ°è®¾å¤‡ï¼š 1234$ cd ~$ scp Clutch-2.0.4 root@10.12.14.16:/usr/bin/root@10.12.14.16&apos;s password:Clutch-2.0.4 100% 1204KB 4.7MB/s 00:00 ç™»å½•è¿›è¶Šç‹±è®¾å¤‡å¯ä»¥ä½¿ç”¨ssh root@IPè¿›è¡Œç™»å½•ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ssh ipadï¼Œè¿™æ ·å…å¯†ç™»å½•ç™»å½•ã€‚ é…ç½®ä¼ é€é—¨ ä¿®æ”¹æƒé™1234$ cd ~$ cd /usr/bin$ mv Clutch-2.0.4 clutch$ chmod +x clutch ç ¸å£³12345678910111213141516$ clutch -iInstalled apps:1: é’‰é’‰ &lt;com.laiwang.DingTalk&gt;2: éŸ©å‰§TV-æœ€æ–°çƒ­é—¨éŸ©å‰§å¤§å…¨ &lt;com.baoyun.hanju&gt;3: PG Client - a better client for dribbble &lt;com.az.azdribbble&gt;4: çªç‰›ï¼è®¾è®¡è£…ä¿®æˆ‘ä»¬çš„å®¶ &lt;com.lingduohome.acorn&gt;$ clutch -d 1com.laiwang.DingTalk contains watchOS 2 compatible application. It&apos;s not possible to dump watchOS 2 apps with Clutch 2.0.4 at this moment.Zipping DingTalk.appASLR slide: 0x10001c000Dumping &lt;DingTalk&gt; (arm64)Patched cryptid (64bit segment)Writing new checksumDONE: /private/var/mobile/Documents/Dumped/com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ipaFinished dumping com.laiwang.DingTalk in 40.6 seconds$ ç”Ÿæˆæœ€ç»ˆè·¯å¾„: /private/var/mobile/Documents/Dumped/com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ipa ä¼ è‡³æœ¬åœ°æ³¨æ„è·¯å¾„ä¸­æœ‰()è¿™æ ·çš„å­—ç¬¦ï¼Œéœ€è¦è½¬ä¹‰ä¸€ä¸‹ã€‚å¦‚ä¸‹ï¼š åœ¨æœ¬åœ°ç»ˆç«¯ä¸­ä½¿ç”¨scpæ‹‰å–ï¼š 1234567$ scp root@10.12.14.16:&apos;/private/var/mobile/Documents/Dumped/com.laiwang.DingTalk-iOS7.0-\(Clutch-2.0.4\).ipa&apos; .root@10.12.14.16&apos;s password:com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ip 100% 48MB 3.6MB/s 00:13$ ls com.laiwang.DingTalk-iOS7.0-\(Clutch-2.0.4\).ipacom.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ipa$ pwd/Users/Madordie/Desktop/Madordie/ios-reverse è‡³æ­¤åœ¨ä¸»æœºä¸Šå¾—åˆ°ï¼š /Users/Madordie/Desktop/Madordie/ios-reverse/com.laiwang.DingTalk-iOS7.0-\(Clutch-2.0.4\).ipa æ€»ç»“ å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ”¯æŒè¿™ç§å·¥å…·ç ¸å£³ï¼Œå¤±è´¥äº†ç”¨ç¬¬ä¸€ç§è¯•è¯•ã€‚ã€‚ã€‚ æœ€åç›®å‰å‘ç°è¿™ä¸¤ç§ç ¸å£³å·¥å…·ã€‚ä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªAPPéƒ½å¯ä»¥ä½¿ç”¨2ç§å·¥å…·ã€‚æœ‰çš„åªæœ‰ä¸€ä¸ªæœ‰æ•ˆï¼Œæœ‰çš„ä¸¤ä¸ªéƒ½æœ‰æ•ˆï¼Œè¿˜æœ‰ä¸€ç§ä¸¤ä¸ªéƒ½å¤±è´¥çš„ğŸ˜‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé€†å‘-è®¾å¤‡sshå…å¯†ç™»å½•]]></title>
    <url>%2Freverse-ios-ssh%2F</url>
    <content type="text"><![CDATA[å‰ææ¡ä»¶ å·²è¶Šç‹±è®¾å¤‡ è¶Šç‹±è®¾å¤‡å®‰è£…OpenSSH(âš ï¸è®°å¾—ä¿®æ”¹é»˜è®¤çš„â€™alpineâ€™ç™»å½•å¯†ç ) ç”µè„‘å’Œè®¾å¤‡åŒå±€åŸŸç½‘ã€‚ï¼ˆæˆ‘è¿™é‡Œè®¾å¤‡IPï¼š10.11.12.13ï¼Œå¹¶ä¸”è®¾ç½®æˆé™æ€IPäº†ğŸ˜‚ï¼‰ æ­¥éª¤ç”ŸæˆRSAè¯ä¹¦æˆ‘è¿™é‡Œç”Ÿæˆçš„è¯ä¹¦ä¸º:ipadï¼Œå¯è‡ªå·±éœ€è¦å®šä¹‰ã€‚ï¼ˆæ³¨æ„å¦‚æœç›´æ¥å›è½¦ä¼šè¦†ç›–~/.ssh/id_rsaï¼‰ æ‰§è¡Œå‘½ä»¤ssh-keygenï¼Œå¦‚ä¸‹ï¼š12345678910111213141516171819202122232425$ cd ~/.ssh/$ ssh-keygenGenerating public/private rsa key pair.Enter file in which to save the key (/Users/Madordie/.ssh/id_rsa): ipadEnter passphrase (empty for no passphrase):Enter same passphrase again:Your identification has been saved in ipad.Your public key has been saved in ipad.pub.The key fingerprint is:SHA256:GpQBeAf+oqUzWlUhtItDcVyVFz2wd0EcIgD+BZLPK8U Madordie@Bingo.localThe key&apos;s randomart image is:+---[RSA 2048]----+| .+*+*++o++.o+. || .+o+o=...oo... || ..o.=+ .o ... || . . = .E. . . || o = o.S. || * ..o. || * .. || o o ||. |+----[SHA256]-----+$ ls ~/.ssh/ipad*/Users/Madordie/.ssh/ipad /Users/Madordie/.ssh/ipad.pub å°†å…¬é’¥æ¨é€è‡³è¶Šç‹±è®¾å¤‡é»˜è®¤æ˜¯æ²¡æœ‰~/.sshç›®å½•çš„ï¼Œæš‚æ—¶æ”¾ç½®åœ¨/var/rootä¸‹ã€‚ 1$ scp ~/.ssh/ipad.pub root@10.11.12.13:/var/root scp é»˜è®¤ç«¯å£ä¸º22 å¦‚æœéœ€è¦è‡ªå®šä¹‰ç«¯å£å¯ä»¥åœ¨è·¯å¾„å‰æ·»åŠ -P ç«¯å£å·å‚æ•°ã€‚ é…ç½®æœ¬æœº~/.ssh/configæ–‡ä»¶ä½¿ç”¨é¡ºæ‰‹çš„å·¥å…·ç¼–è¾‘~/.ssh/configæ–‡ä»¶ã€‚ï¼ˆæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªå•¦ï½ æŒ‰ç…§å¦‚ä¸‹æ ¼å¼å¡«å†™ã€‚é»˜è®¤sshç™»å½•ç«¯å£ä¸º22å¯ä»¥ä¸å†™ã€‚123456Host ipad Hostname 10.11.12.13 User root Port 22 PreferredAuthentications publickey IdentityFile ~/.ssh/ipad é…ç½®è¶Šç‹±è®¾å¤‡å…ˆç”¨ssh root@10.11.12.13ç™»å½•è¿›è®¾å¤‡ã€‚åˆšæ‰æˆ‘ä»¬å°†ipad.pubé€šè¿‡scpæ”¾åœ¨äº†/var/rootä¸‹ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹/var/root/.sshæ˜¯ä¸å­˜åœ¨çš„ï¼Œä½¿ç”¨å‘½ä»¤mkdir -p /var/root/.sshå³å¯åˆ›å»ºã€‚ 1$ cat ipad.pub &gt;&gt; /var/root/.ssh/authorized_keys ç„¶åå¼ºè¿«ç—‡çš„å¯ä»¥ä½¿ç”¨rm -rf ipad.pubåˆ é™¤å•¦ï½ å¯¹äº†ï¼Œé€€å‡ºsshç™»å½•çš„è®¾å¤‡ä½¿ç”¨ï¼š 123$ exitlogoutConnection to 10.11.12.13 closed. èµ¶ç´§æµ‹è¯•ä¸€ä¸‹è¿œç¨‹ç™»å½•æ•ˆæœ1$ ssh ipad ç„¶åä½ ä¼šå‘ç°ä½ å·²ç»å®Œæˆäº†å…å¯†ç ç™»å½•è¶Šç‹±è®¾å¤‡ã€‚ æ€»ç»“å…¶å®è¿™å¹¶ä¸æ˜¯åªæœ‰è¶Šç‹±iOSè®¾å¤‡æ‰èƒ½ä½¿ç”¨çš„å…ç™»å½•ï¼Œè€Œæ˜¯sshæ‰€æ”¯æŒçš„ã€‚ç”¨é€”ä¹Ÿå¾ˆæ–¹ä¾¿ï½]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è‡ªå®šä¹‰æ•°æ®å¡«å……Sketchæ’ä»¶]]></title>
    <url>%2Fformat-sketchplugin%2F</url>
    <content type="text"><![CDATA[å…ˆæ¥ä¸ªREADME.md format-sketchpluginä¸ºSketchè‡ªåŠ¨ç”Ÿæˆè‡ªå®šä¹‰å¡«å……æ•°æ®æºæ’ä»¶ã€‚ ä½¿ç”¨æ–¹æ³• ä¸‹è½½Releaseä¸Šçš„åŒ…ï¼Œå¹¶åŒå‡»æ‰“å¼€ é€‰æ‹©è¦éšæœºå¡«å……çš„æ–‡æœ¬æ•°æ®(æ”¯æŒå¤šé€‰ï¼Œæ–‡æœ¬æ•°æ®æŒ‰ç…§å›è½¦è¿›è¡Œéšæœºï¼Œä¼šé»˜è®¤åˆ é™¤ç©ºæ•°æ®) é€‰æ‹©éšæœºå¡«å……çš„å›¾ç‰‡æ–‡ä»¶å¤¹(åªæ”¯æŒå•é€‰æ–‡ä»¶å¤¹ï¼Œé€‰ä¸­æ–‡ä»¶å¤¹å†…çš„.pngã€ .PNGã€ .jpgã€ .JPGã€ .jpegã€ .JPEGã€ .gifã€ .GIFæ–‡ä»¶å°†ä¼šè¢«è¯†åˆ«å¹¶ä½œä¸ºæ•°æ®æº) å°†æ’ä»¶ç”Ÿæˆç›®å½•æ‹–æ‹½è‡³çª—å£å³å®Œæˆè®¾ç½® æ–‡æœ¬ã€å›¾ç‰‡æ–‡ä»¶å¤¹ å¯åœ¨ä¿å­˜å‰é‡å¤å¤šæ¬¡é€‰æ‹© ç‚¹å‡»åˆ¶ä½œï¼Œå³å¯åœ¨ç”Ÿæˆç›®å½•çœ‹åˆ°æ’ä»¶ç”Ÿæˆ ç”Ÿæˆè¯´æ˜ æ–‡æœ¬æ•°æ®æŒ‰ç…§æ–‡æœ¬æ–‡ä»¶åä½œä¸ºæ ‡ç¤º å›¾ç‰‡æ–‡ä»¶å¤¹æŒ‰ç…§å›¾ç‰‡æ–‡ä»¶å¤¹åä½œä¸ºæ ‡ç¤º ä¿å­˜æ—¶ï¼Œæ–‡æœ¬æ•°æ®ä¼šè¯»å–è‡³æ’ä»¶å†… ä¿å­˜æ—¶ï¼Œå›¾ç‰‡æ–‡ä»¶å¤¹ä¼šå¤åˆ¶è‡³æ’ä»¶å†…(ä¸è¯†åˆ«å­ç›®å½•ï¼Œå¹¶åªæ‹·è´å¯è¯†åˆ«çš„ç´ æ)]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Sketchplugin</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOS11-beta]]></title>
    <url>%2Fios11-beta%2F</url>
    <content type="text"><![CDATA[iOS11 é¢„è§ˆç‰ˆå®‰è£…ä½“éªŒç¬”è®°ã€‚ å†™åœ¨å‰é¢æ¯•ç«Ÿbetaç‰ˆï¼Œå‡çº§éœ€è°¨æ…ã€‚ç›®å‰æ¥çœ‹ä½“éªŒä¸Šè¿˜æ˜¯æœ‰ç‚¹å¡çš„ï½ï½ğŸ˜‚ å¡é¡¿è®©æˆ‘å®åœ¨æ— æ³•å¿å—ï¼Œå¹¶ä¸6.15å·é‡ç½®å›iOS10.3.2 ã€‚ã€‚ã€‚ 9.13 GMå‡ºæ¥äº†ï¼Œå†å®‰è£…ï½ï½ é€‚é…æœ‰å…ˆåï¼ŒiOS11é©¬ä¸Šå°±è¦å‘äº†ï¼Œè€ŒiPhoneXè¿˜éœ€è¦ç­‰ä¸€å°æ®µæ—¶é—´ã€‚æ‰€ä»¥iOS11çš„é€‚é…æ¯”iPhoneXæœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï½ APIå¤±æ•ˆçš„automaticallyAdjustsScrollViewInsetsiOS11 ç‰ˆæœ¬ä¸­ ç«‹å³å¤±æ•ˆã€‚ æœ€å®¹æ˜“å‡ºé—®é¢˜çš„å°±æ˜¯æ— å¯¼èˆªçš„é¡¶éƒ¨åˆ·æ–°ä¼šè«åå…¶å¦™çš„ç¼©ä¸è¿›å»ï½ï½ è¿˜æœ‰å°±æ˜¯å¦‚æœæ²¡æœ‰ä½¿ç”¨è¿™ä¸ªautomaticallyAdjustsScrollViewInsetsï¼Œä¸ºäº†è¾¾åˆ°é‚£ç§æˆ³è¿›å»çš„ä»£ç ç›´æ¥è®¾ç½®frame.y = 0ã€‚è¿™ç§æ“ä½œä¸ä½†ä¼šå‡ºç°å¯¼èˆªæ è«åå…¶å¦™çš„æˆ³å‡ºæ¥ï¼Œè¿˜æœ‰UITableView.section.headerè«åé”™ä½çš„é—®é¢˜ã€‚ API å£°æ˜ï¼š 1234567@available(iOS 2.0, *)open class UIViewController : UIResponder, ... &#123; ... @available(iOS, introduced: 7.0, deprecated: 11.0) open var automaticallyAdjustsScrollViewInsets: Bool // Defaults to YES ...&#125; ç›¸åº”çš„çš„æ›¿æ¢æ–¹æ¡ˆï¼š 12345678910@available(iOS 2.0, *)open class UIScrollView : UIView, ... &#123; ... /* Configure the behavior of adjustedContentInset. Default is UIScrollViewContentInsetAdjustmentAutomatic. */ @available(iOS 11.0, *) open var contentInsetAdjustmentBehavior: UIScrollViewContentInsetAdjustmentBehavior ...&#125; decisionHandler(.allow) was called more than onceå´©æºƒä¿¡æ¯ï¼š 123#0 ThreadNSInternalInconsistencyExceptionCompletion handler passed to -[WKWebViewJavascriptBridge webView:decidePolicyForNavigationAction:decisionHandler:] was called more than once è¿™æ˜¯WebViewJavascriptBridgeåœ¨iOS11ä¸Šçš„ä¸€ä¸ªIssues#302ã€‚ æ®åŒäº‹è¯´å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è§£å†³ï¼š1234if WebViewJavascriptBridgeBase().isWebViewJavascriptBridgeURL(url) &#123; return&#125;decisionHandler(.allow) æµ‹è¯•äº†ä¸€ä¸‹ç¡®å®ä¸å´©æºƒäº†ï¼Œä½†æ˜¯å…·ä½“çš„è§£å†³æ–¹æ¡ˆè¿˜è¦çœ‹ä½œè€…çš„åœ¨Issues#302ä¸­çš„å›å¤ã€‚ ç…§ç‰‡å­˜å‚¨æ—¶å€™æŸäº›è®¾å¤‡å¿…crashå´©æºƒä¿¡æ¯: 1232017-09-29 11:36:17.338816+0800 Demo-iOS11-crash-save-photo[636:139456] [access] This app has crashed because it attempted to access privacy-sensitive data without a usage description. The app&apos;s Info.plist must contain an NSPhotoLibraryAddUsageDescription key with a string value explaining to the user how the app uses this data. æ˜¯çš„ï¼Œè¿™ä¸ªDemoè¿˜æœ‰ä¸€ä¸ªcrashçš„æç¤ºã€‚ä½†æ˜¯åœ¨å¤§å·¥ç¨‹ä¸­ï¼Œæˆ‘å¹¶æ²¡æœ‰çœ‹åˆ°è¿™æ ·çš„ç©æ„è¾“å‡ºå‡ºæ¥ã€‚ã€‚æˆ‘åšçš„å¤ç°æ“ä½œè¾ƒç®€å•ï¼š 123456let img = UIImage(named: "278.jpg")let library = ALAssetsLibrary()guard let orientation = ALAssetOrientation(rawValue: img?.imageOrientation.rawValue ?? 0) else &#123; return &#125;library.writeImage(toSavedPhotosAlbum: img?.cgImage, orientation: orientation) &#123; (url, error) in guard error != nil else &#123; print("no crash"); return &#125;&#125; å°±è¿™ä¹ˆå¤šä»£ç ï¼Œä¸ç®¡æ˜¯æ‰“æ²¡æ‰“Swift Errorã€All Exceptionséƒ½æ— æ³•å®šä½åˆ°ä¸Šé¢ä»£ç å—ï¼Œè¿™æ‰æ˜¯æœ€å‘çš„ã€‚ ä¸Šé¢ä»£ç æ¼äº†ä¸€å¥å…³é”®çš„ä»£ç ï¼š 1guard ALAssetsLibrary.authorizationStatus() == .authorized else &#123; return &#125; éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šé¢ä»£ç ä¹‹åˆ¤æ–­äº†æ˜¯å¦æœ‰æƒé™ï¼Œä½†æ˜¯åœ¨iOS11ä¸Šå¹¶ä¸ä¼šå¼¹å‡ºä»€ä¹ˆæˆæƒæç¤ºã€‚å°±ç®—åœ¨Info.plistä¸­æ·»åŠ NSPhotoLibraryUsageDescriptionä¾æ—§æ— æµäºäº‹ã€‚ ç›®å‰æ¥çœ‹ï¼ŒiOS11ä¸­åªæœ‰æ·»åŠ NSPhotoLibraryAddUsageDescriptionæ‰å¯ä»¥ã€‚ è²Œä¼¼è¿˜æœ‰åˆ«çš„ä»€ä¹ˆé—®é¢˜ï¼Œåƒé¥­ï¼Œä¸‹åˆç»§ç»­]]></content>
      <categories>
        <category>iOS</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ã€Œè½¬ã€Unowned è¿˜æ˜¯ Weakï¼Ÿç”Ÿå‘½å‘¨æœŸå’Œæ€§èƒ½å¯¹æ¯”]]></title>
    <url>%2Fswiftgg-unowned-or-weak-lifetime-and-performance%2F</url>
    <content type="text"><![CDATA[ä½œè€…ï¼šUmberto Raimondiï¼ŒåŸæ–‡é“¾æ¥ï¼ŒåŸæ–‡æ—¥æœŸï¼š2016-10-27è¯‘è€…ï¼šshanksï¼›æ ¡å¯¹ï¼šCrystal Sunï¼›å®šç¨¿ï¼šCMB æ¯å½“å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆretain cyclesï¼‰æ—¶ï¼Œéœ€è¦è€ƒé‡å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæ¥é€‰æ‹©unownedæˆ–è€…weakæ ‡è¯†ç¬¦ï¼Œè¿™å·²ç»æˆä¸ºäº†ä¸€ä¸ªå…±è¯†ã€‚ä½†æ˜¯æœ‰æ—¶ä»ç„¶ä¼šå¿ƒå­˜ç–‘é—®ï¼Œåœ¨å…·ä½“çš„ä½¿ç”¨ä¸­åº”è¯¥é€‰æ‹©å“ªä¸€ä¸ªï¼Œæˆ–è€…é€€ä¸€æ­¥è®²ï¼Œä¿å®ˆçš„åªä½¿ç”¨ weak æ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©å‘¢ï¼Ÿ æœ¬æ–‡é¦–å…ˆå¯¹å¾ªç¯å¼•ç”¨çš„åŸºç¡€çŸ¥è¯†åšä¸€ä¸ªç®€è¦ä»‹ç»ï¼Œç„¶åä¼šåˆ†æ Swift æºä»£ç çš„ä¸€äº›ç‰‡æ®µï¼Œè®²è§£ unowned å’Œ weak åœ¨ç”Ÿå‘½å‘¨æœŸå’Œæ€§èƒ½ä¸Šçš„å·®å¼‚ç‚¹ï¼Œå¸Œæœ›çœ‹å®Œæœ¬æ–‡ä»¥åï¼Œåœ¨çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œèƒ½ä½¿ç”¨æ­£ç¡®çš„å¼±å¼•ç”¨ç±»å‹ã€‚ ç›®å½•: åŸºç¡€çŸ¥è¯† é—®é¢˜æ¥äº†: unowened è¿˜æ˜¯ weak? æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢ æ•è·åˆ—è¡¨å¤„ç†è§£æ ç»“è®º è„šæ³¨ ä» GitHub æˆ–è€… zipped è·å–æœ¬æ–‡ç›¸å…³çš„ Playground ä»£ç ã€‚ç„¶åä»è¿™é‡Œè·å–é—­åŒ…æ¡ˆä¾‹å’Œ SILï¼ŒSILGen ä»¥åŠ LLVM IR çš„è¾“å‡ºã€‚ åŸºç¡€çŸ¥è¯†ä¼—æ‰€å‘¨çŸ¥ï¼ŒSwift åˆ©ç”¨å¤è€å¹¶ä¸”æœ‰æ•ˆçš„è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼ˆARC, Automatic Reference Countingï¼‰æ¥ç®¡ç†å†…å­˜ï¼Œå¸¦æ¥çš„åæœå’Œåœ¨ Objective-C ä¸­ä½¿ç”¨çš„æƒ…å†µç±»ä¼¼ï¼Œéœ€è¦æ‰‹åŠ¨ä½¿ç”¨å¼±å¼•ç”¨æ¥è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚ å¦‚æœå¯¹ ARC ä¸äº†è§£ï¼Œåªéœ€è¦çŸ¥é“çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªå¼•ç”¨ç±»å‹å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°ä¸ä¹‹å…³è”ï¼Œè¿™ä¸ªå¼•ç”¨è®¡æ•°ç”¨æ¥è®°å½•è¿™ä¸ªå¯¹è±¡å®ä¾‹æ­£åœ¨è¢«å˜é‡æˆ–å¸¸é‡å¼•ç”¨çš„æ€»æ¬¡æ•°ã€‚å½“å¼•ç”¨è®¡æ•°å˜ä¸º 0 æ—¶ï¼Œå®ä¾‹å°†ä¼šè¢«ææ„ï¼Œå®ä¾‹å æœ‰çš„å†…å­˜å’Œèµ„æºéƒ½å°†å˜å¾—é‡æ–°å¯ç”¨ã€‚ å½“æœ‰ä¸¤ä¸ªå®ä¾‹é€šè¿‡æŸç§å½¢å¼äº’ç›¸å¼•ç”¨æ—¶ï¼Œå°±ä¼šå½¢æˆå¾ªç¯å¼•ç”¨ï¼ˆæ¯”å¦‚ï¼šä¸¤ä¸ªç±»å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå±æ€§æŒ‡å‘å¯¹æ–¹çš„ç±»å®ä¾‹ï¼›åŒå‘é“¾è¡¨ä¸­ä¸¤ä¸ªç›¸é‚»çš„èŠ‚ç‚¹å®ä¾‹ç­‰â€¦ï¼‰, ç”±äºä¸¤ä¸ªå®ä¾‹çš„å¼•ç”¨è®¡æ•°éƒ½ä¸€ç›´å¤§äº 0ï¼Œ å¾ªç¯å¼•ç”¨å°†ä¼šé˜»æ­¢è¿™äº›å®ä¾‹çš„ææ„ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå’Œå…¶ä»–ä¸€äº›æœ‰ç±»ä¼¼é—®é¢˜çš„è¯­è¨€ä¸€æ ·ï¼Œ åœ¨ Swift ä¸­ï¼Œå¼±å¼•ç”¨ çš„æ¦‚å¿µè¢«æäº†å‡ºæ¥ï¼Œå¼±å¼•ç”¨ä¸ä¼šè¢« ARC è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªå¼±å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¼•ç”¨ç±»å‹å®ä¾‹æ—¶ï¼Œå¼•ç”¨è®¡æ•°ä¸ä¼šå¢åŠ ã€‚ å¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å®ä¾‹çš„ææ„, åªéœ€è¦è®°ä½çš„æ˜¯ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå¼±å¼•ç”¨éƒ½ä¸ä¼šæ‹¥æœ‰å®ƒæŒ‡å‘çš„å¯¹è±¡ã€‚åœ¨æ­£å¼çš„åœºæ™¯ä¸­ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å¤„ç†è¿™ç±»å¼•ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æ„è¯†åˆ°è¿™ä¸€ç‚¹ã€‚ åœ¨ Swift ä¸­æœ‰ 2 ç§ å¼± å¼•ç”¨å½¢å¼ï¼Œunowned å’Œ weakã€‚ è™½ç„¶å®ƒä»¬çš„ä½œç”¨ç±»ä¼¼ï¼Œä½†ä¸å®ƒä»¬ç›¸å…³å®ä¾‹ç”Ÿå‘½å‘¨æœŸçš„å‡è®¾ä¼šç•¥æœ‰ä¸åŒï¼Œå¹¶ä¸”å…·æœ‰ä¸åŒçš„æ€§èƒ½ç‰¹å¾ã€‚ ä¸ºäº†ä¸¾ä¾‹è¯´æ˜å¾ªç¯å¼•ç”¨ï¼Œè¿™é‡Œä¸ä½¿ç”¨å¤§å®¶æœŸæœ›çœ‹åˆ°çš„ç±»ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ï¼Œè€Œä½¿ç”¨é—­åŒ…çš„ä¸Šä¸‹æ–‡æ¡ˆä¾‹ï¼Œè¿™åœ¨ Objective-C æ—¥å¸¸å¼€å‘ä¸­å¤„ç†å¾ªç¯å¼•ç”¨æ—¶ç»å¸¸ä¼šé‡åˆ°çš„æƒ…å†µã€‚å’Œç±»çš„å¾ªç¯å¼•ç”¨ç±»ä¼¼ï¼Œé€šè¿‡åˆ›å»ºä¸€ä¸ªå¼ºå¼•ç”¨æŒ‡å‘å¤–éƒ¨å®ä¾‹ï¼Œæˆ–æ•è·å®ƒï¼Œé˜»æ­¢å®ƒææ„ã€‚ åœ¨ Objective-C ï¼ŒæŒ‰ç…§æ ‡å‡†çš„åšæ³•ï¼Œå®šä¹‰ä¸€ä¸ªå¼±å¼•ç”¨æŒ‡å‘é—­åŒ…å¤–éƒ¨çš„å®ä¾‹ï¼Œç„¶ååœ¨é—­åŒ…å†…éƒ¨å®šä¹‰å¼ºå¼•ç”¨æŒ‡å‘è¿™ä¸ªå®ä¾‹ï¼Œåœ¨é—­åŒ…æ‰§è¡ŒæœŸé—´ä½¿ç”¨å®ƒã€‚å½“ç„¶ï¼Œæœ‰å¿…è¦åœ¨ä½¿ç”¨å‰æ£€æŸ¥å¼•ç”¨çš„æœ‰æ•ˆæ€§ã€‚ ä¸ºäº†æ›´æ–¹ä¾¿çš„å¤„ç†å¾ªç¯å¼•ç”¨ï¼ŒSwift å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œç”¨äºç®€åŒ–å’Œæ›´åŠ æ˜æ˜¾åœ°è¡¨è¾¾åœ¨é—­åŒ…å†…éƒ¨å¤–éƒ¨å˜é‡çš„æ•è·ï¼šæ•è·åˆ—è¡¨ï¼ˆcapture listï¼‰ã€‚ä½¿ç”¨æ•è·åˆ—è¡¨ï¼Œå¯ä»¥åœ¨å‡½æ•°çš„å¤´éƒ¨å®šä¹‰å’ŒæŒ‡å®šé‚£äº›éœ€è¦ç”¨åœ¨å†…éƒ¨çš„å¤–éƒ¨å˜é‡ï¼Œå¹¶ä¸”æŒ‡å®šå¼•ç”¨ç±»å‹(è¯‘è€…æ³¨ï¼šè¿™é‡Œæ˜¯æŒ‡ unowned å’Œ weakï¼‰ã€‚ æ¥ä¸‹æ¥ä¸¾ä¸€äº›ä¾‹å­ï¼Œåœ¨å„ç§æƒ…å†µä¸‹æ•è·å˜é‡çš„è¡¨ç°ã€‚ å½“ä¸ä½¿ç”¨æ•è·åˆ—è¡¨æ—¶ï¼Œé—­åŒ…å°†ä¼šåˆ›å»ºä¸€ä¸ªå¤–éƒ¨å˜é‡çš„å¼ºå¼•ç”¨ï¼š 123456789var i1 = 1, i2 = 1var fStrong = &#123; i1 += 1 i2 += 2&#125;fStrong()print(i1,i2) //Prints 2 and 3 é—­åŒ…å†…éƒ¨å¯¹å˜é‡çš„ä¿®æ”¹å°†ä¼šæ”¹å˜å¤–éƒ¨åŸå§‹å˜é‡çš„å€¼ï¼Œè¿™ä¸é¢„æœŸæ˜¯ä¸€è‡´çš„ã€‚ ä½¿ç”¨æ•è·åˆ—è¡¨ï¼Œé—­åŒ…å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯ç”¨å¸¸é‡ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå¸¸é‡ä¿®é¥°ç¬¦ï¼Œé—­åŒ…å°†ä¼šç®€å•åœ°æ‹·è´åŸå§‹å€¼åˆ°æ–°çš„å˜é‡ä¸­ï¼Œå¯¹äºå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚ 12345678var fCopy = &#123; [i1] in print(i1,i2)&#125;fStrong()print(i1,i2) //æ‰“å°ç»“æœæ˜¯ 2 å’Œ 3 fCopy() //æ‰“å°ç»“æœæ˜¯ 1 å’Œ 3 åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨è°ƒç”¨ fStrong ä¹‹å‰å®šä¹‰å‡½æ•° fCopy ,åœ¨è¯¥å‡½æ•°å®šä¹‰çš„æ—¶å€™ï¼Œç§æœ‰å¸¸é‡å·²ç»è¢«åˆ›å»ºäº†ã€‚æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå½“è°ƒç”¨ç¬¬äºŒä¸ªå‡½æ•°æ—¶å€™ï¼Œä»ç„¶æ‰“å° i1 çš„åŸå§‹å€¼ã€‚ å¯¹äºå¤–éƒ¨å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œåœ¨æ•è·åˆ—è¡¨ä¸­æŒ‡å®š weak æˆ– unownedï¼Œè¿™ä¸ªå¸¸é‡å°†ä¼šè¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªå¼±å¼•ç”¨ï¼ŒæŒ‡å‘åŸå§‹å€¼ï¼Œè¿™ç§æŒ‡å®šçš„æ•è·æ–¹å¼å°±æ˜¯ç”¨æ¥å¤„ç†å¾ªç¯å¼•ç”¨çš„æ–¹å¼ã€‚ 12345678910111213141516class aClass&#123; var value = 1&#125;var c1 = aClass()var c2 = aClass()var fSpec = &#123; [unowned c1, weak c2] in c1.value += 1 if let c2 = c2 &#123; c2.value += 1 &#125;&#125;fSpec()print(c1.value,c2.value) //Prints 2 and 2 ä¸¤ä¸ª aClass æ•è·å®ä¾‹çš„ä¸åŒçš„å®šä¹‰æ–¹å¼ï¼Œå†³å®šäº†å®ƒä»¬åœ¨é—­åŒ…ä¸­ä¸åŒçš„ä½¿ç”¨æ–¹å¼ã€‚ unowned å¼•ç”¨ä½¿ç”¨çš„åœºæ™¯æ˜¯ï¼ŒåŸå§‹å®ä¾‹æ°¸è¿œä¸ä¼šä¸º nilï¼Œé—­åŒ…å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”ç›´æ¥å®šä¹‰ä¸ºæ˜¾å¼è§£åŒ…å¯é€‰å€¼ã€‚å½“åŸå§‹å®ä¾‹è¢«ææ„åï¼Œåœ¨é—­åŒ…ä¸­ä½¿ç”¨è¿™ä¸ªæ•è·å€¼å°†å¯¼è‡´å´©æºƒã€‚ å¦‚æœæ•è·åŸå§‹å®ä¾‹åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¸º nil ï¼Œå¿…é¡»å°†å¼•ç”¨å£°æ˜ä¸º weakï¼Œ å¹¶ä¸”åœ¨ä½¿ç”¨ä¹‹å‰éªŒè¯è¿™ä¸ªå¼•ç”¨çš„æœ‰æ•ˆæ€§ã€‚ é—®é¢˜æ¥äº†: unowened è¿˜æ˜¯ weak?åœ¨å®é™…ä½¿ç”¨ä¸­å¦‚ä½•é€‰æ‹©è¿™ä¸¤ç§å¼±å¼•ç”¨ç±»å‹å‘¢ï¼Ÿ è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¯ä»¥ç®€å•ç”±åŸå§‹å¯¹è±¡å’Œå¼•ç”¨å®ƒçš„é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸæ¥è§£é‡Šã€‚ æœ‰ä¸¤ä¸ªå¯èƒ½å‡ºç°çš„åœºæ™¯ï¼š é—­åŒ…å’Œæ•è·å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œæ‰€ä»¥å¯¹è±¡å¯ä»¥è¢«è®¿é—®ï¼Œä¹Ÿå°±æ„å‘³ç€é—­åŒ…ä¹Ÿå¯ä»¥è¢«è®¿é—®ã€‚å¤–éƒ¨å¯¹è±¡å’Œé—­åŒ…æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ(æ¯”å¦‚ï¼šå¯¹è±¡å’Œå®ƒçš„çˆ¶å¯¹è±¡çš„ç®€å•è¿”å›å¼•ç”¨ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥æŠŠå¼•ç”¨å®šä¹‰ä¸º unownedã€‚ ä¸€ä¸ªç»å…¸çš„æ¡ˆä¾‹æ˜¯: [unowned self], ä¸»è¦ç”¨åœ¨é—­åŒ…ä¸­ï¼Œè¿™ç§é—­åŒ…ä¸»è¦åœ¨ä»–ä»¬çš„çˆ¶èŠ‚ç‚¹ä¸Šä¸‹æ–‡ä¸­åšä¸€äº›äº‹æƒ…ï¼Œæ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹è¢«å¼•ç”¨æˆ–ä¼ é€’ï¼Œä¸èƒ½ä½œç”¨åœ¨çˆ¶èŠ‚ç‚¹ä¹‹å¤–ã€‚ é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸå’Œæ•è·å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸äº’ç‹¬ç«‹ï¼Œå½“å¯¹è±¡ä¸èƒ½å†ä½¿ç”¨æ—¶ï¼Œé—­åŒ…ä¾ç„¶èƒ½å¤Ÿè¢«å¼•ç”¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥æŠŠå¼•ç”¨å®šä¹‰ä¸º weakï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨å®ƒä¹‹å‰éªŒè¯ä¸€ä¸‹å®ƒæ˜¯å¦ä¸º nilï¼ˆè¯·ä¸è¦å¯¹å®ƒè¿›è¡Œå¼ºåˆ¶è§£åŒ…). ä¸€ä¸ªç»å…¸çš„æ¡ˆä¾‹æ˜¯: [weak delegate = self.delegate!]ï¼Œå¯ä»¥åœ¨æŸäº›ä½¿ç”¨é—­åŒ…çš„åœºæ™¯ä¸­çœ‹åˆ°ï¼Œé—­åŒ…ä½¿ç”¨çš„æ˜¯å®Œå…¨æ— å…³ï¼ˆç”Ÿå‘½å‘¨æœŸç‹¬ç«‹ï¼‰çš„ä»£ç†å¯¹è±¡ã€‚ å½“æ— æ³•ç¡®è®¤ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´ç”Ÿå‘½å‘¨æœŸçš„å…³ç³»æ—¶ï¼Œæ˜¯å¦ä¸åº”è¯¥å»å†’é™©é€‰æ‹©ä¸€ä¸ªæ— æ•ˆ unowned å¼•ç”¨ï¼Ÿè€Œæ˜¯ä¿å®ˆé€‰æ‹© weak å¼•ç”¨æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºå¯¹è±¡ç”Ÿå‘½å‘¨æœŸäº†è§£æ˜¯ä¸€ä»¶å¿…è¦çš„äº‹æƒ…ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªä¿®é¥°ç¬¦åœ¨æ€§èƒ½ç‰¹æ€§ä¸Šä¹Ÿæœ‰å¾ˆå¤§çš„ä¸åŒã€‚ å¼±å¼•ç”¨æœ€å¸¸è§çš„å®ç°æ˜¯ï¼Œæ¯æ¬¡ä¸€ä¸ªæ–°çš„å¼•ç”¨ç”Ÿæˆæ—¶ï¼Œéƒ½ä¼šæŠŠæ¯ä¸ªå¼±å¼•ç”¨å’Œå®ƒæŒ‡å‘çš„å¯¹è±¡ä¿¡æ¯å­˜å‚¨åˆ°ä¸€ä¸ªé™„åŠ è¡¨ä¸­ã€‚ å½“æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡æ—¶ï¼ŒSwift è¿è¡Œæ—¶ä¼šå¯åŠ¨ææ„è¿‡ç¨‹ï¼Œä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œè¿è¡Œæ—¶ä¼šæŠŠæ‰€æœ‰ç›¸å…³çš„å¼±å¼•ç”¨ç½®ä¸º nil ã€‚å¼±å¼•ç”¨çš„è¿™ç§å®ç°æ–¹å¼æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€é›¶å’Œå¼±å¼•ç”¨â€ã€‚ è¿™ç§å®ç°æœ‰å®é™…çš„å¼€é”€ï¼Œè€ƒè™‘åˆ°éœ€è¦é¢å¤–å®ç°çš„æ•°æ®ç»“æ„ï¼Œéœ€è¦ç¡®ä¿åœ¨å¹¶å‘è®¿é—®æƒ…å†µä¸‹ï¼Œå¯¹è¿™ä¸ªå…¨å±€å¼•ç”¨ç»“æ„æ‰€æœ‰æ“ä½œçš„æ­£ç¡®æ€§ã€‚ä¸€æ—¦ææ„è¿‡ç¨‹å¼€å§‹äº†ï¼Œåœ¨ä»»ä½•ç¯å¢ƒä¸­ï¼Œéƒ½ä¸å…è®¸è®¿é—®å¼±å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡äº†ã€‚ å¼±å¼•ç”¨ï¼ˆåŒ…æ‹¬ unowned å’Œä¸€äº›å˜ä½“çš„ weak)åœ¨ Swift ä½¿ç”¨äº†æ›´ç®€å•å’Œå¿«é€Ÿçš„å®ç°æœºåˆ¶ã€‚ Swift ä¸­çš„æ¯ä¸ªå¯¹è±¡ä¿æŒäº†ä¸¤ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œä¸€ä¸ªæ˜¯å¼ºå¼•ç”¨è®¡æ•°å™¨ï¼Œç”¨æ¥å†³å®š ARC ä»€ä¹ˆæ—¶å€™å¯ä»¥å®‰å…¨åœ°ææ„è¿™ä¸ªå¯¹è±¡ï¼Œå¦å¤–ä¸€ä¸ªé™„åŠ çš„å¼±å¼•ç”¨è®¡æ•°å™¨ï¼Œç”¨æ¥è®¡ç®—åˆ›å»ºäº†å¤šå°‘ä¸ªæŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„ unowned æˆ–è€… weak å¼•ç”¨ï¼Œå½“è¿™ä¸ªè®¡æ•°å™¨ä¸ºé›¶æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å°†è¢« ææ„ ã€‚ éœ€è¦é‡ç‚¹ç†è§£çš„æ˜¯ï¼Œåªæœ‰ç­‰åˆ°æ‰€æœ‰ unowned å¼•ç”¨è¢«é‡Šæ”¾åï¼Œè¿™ä¸ªå¯¹è±¡æ‰ä¼šè¢«çœŸæ­£åœ°ææ„ï¼Œç„¶åå¯¹è±¡å°†ä¼šä¿æŒæœªè§£æå¯è®¿é—®çŠ¶æ€ï¼Œå½“ææ„å‘ç”Ÿåï¼Œå¯¹è±¡çš„å†…å®¹æ‰ä¼šè¢«å›æ”¶ã€‚ æ¯å½“ unowned å¼•ç”¨è¢«å®šä¹‰æ—¶ï¼Œå¯¹åº”çš„ unowned å¼•ç”¨è®¡æ•°ä¼šè¿›è¡ŒåŸå­çº§åˆ«åœ°å¢åŠ (ä½¿ç”¨åŸå­gcc/llvmæ“ä½œï¼Œè¿›è¡Œä¸€ç³»åˆ—å¿«é€Ÿä¸”çº¿ç¨‹å®‰å…¨çš„åŸºæœ¬æ“ä½œï¼Œä¾‹å¦‚ï¼šå¢åŠ ï¼Œå‡å°‘ï¼Œæ¯”è¾ƒï¼Œäº¤æ¢ç­‰)ï¼Œä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚åœ¨å¢åŠ è®¡æ•°ä¹‹å‰ï¼Œä¼šæ£€æŸ¥å¼ºå¼•ç”¨è®¡æ•°ä»¥ç¡®ä¿å¯¹è±¡æ˜¯æœ‰æ•ˆçš„ã€‚ è¯•å›¾è®¿é—®ä¸€ä¸ªæ— æ•ˆçš„å¯¹è±¡ï¼Œå°†ä¼šå¯¼è‡´é”™è¯¯çš„æ–­è¨€ï¼Œä½ çš„åº”ç”¨åœ¨è¿è¡Œæ—¶ä¸­ä¼šæŠ¥é”™(è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œçš„ unownd å®ç°æ–¹å¼å«åš unowned(safe) å®ç°)ä¸ºäº†æ›´å¥½çš„ä¼˜åŒ–ï¼Œåº”ç”¨ç¼–è¯‘æ—¶å¸¦æœ‰ -OFastï¼Œunowned å¼•ç”¨ä¸ä¼šå»éªŒè¯å¼•ç”¨å¯¹è±¡çš„æœ‰æ•ˆæ€§ï¼Œunowned å¼•ç”¨çš„è¡Œä¸ºå°±ä¼šåƒ Objective-C ä¸­çš„ __unsafe_unretained ä¸€æ ·ã€‚å¦‚æœå¼•ç”¨å¯¹è±¡æ— æ•ˆï¼Œunowned å¼•ç”¨å°†ä¼šæŒ‡å‘å·²ç»é‡Šæ”¾åƒåœ¾å†…å­˜ï¼ˆè¿™ç§å®ç°ç§°ä¹‹ unowned(unsafe)ï¼‰ã€‚ å½“ä¸€ä¸ª unowned å¼•ç”¨è¢«é‡Šæ”¾åï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰å…¶ä»–å¼ºå¼•ç”¨æˆ– unowned å¼•ç”¨æŒ‡å‘è¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿™ä¸ªå¯¹è±¡å°†è¢«ææ„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ªå¼•ç”¨å¯¹è±¡ä¸èƒ½åœ¨å¼ºå¼•ç”¨è®¡æ•°å™¨ç­‰äºé›¶çš„æƒ…å†µä¸‹ï¼Œè¢«ææ„çš„åŸå› ï¼Œæ‰€æœ‰çš„å¼•ç”¨è®¡æ•°å™¨å¿…é¡»èƒ½å¤Ÿè¢«è®¿é—®ç”¨æ¥éªŒè¯ unowned å¼•ç”¨å’Œå¼ºå¼•ç”¨æ•°é‡ã€‚ Swift çš„ weak å¼•ç”¨æ·»åŠ äº†é™„åŠ å±‚ï¼Œé—´æ¥åœ°æŠŠ unowned å¼•ç”¨åŒ…è£¹åˆ°äº†ä¸€ä¸ªå¯é€‰å®¹å™¨é‡Œé¢ï¼Œåœ¨æŒ‡å‘çš„å¯¹è±¡ææ„ä¹‹åå˜æˆç©ºçš„æƒ…å†µä¸‹ï¼Œè¿™æ ·å¤„ç†ä¼šæ›´åŠ çš„æ¸…æ™°ã€‚ä½†æ˜¯éœ€è¦ä»˜å‡ºçš„ä»£ä»·æ˜¯ï¼Œé™„åŠ çš„æœºåˆ¶éœ€è¦æ­£ç¡®åœ°å¤„ç†å¯é€‰å€¼ã€‚ è€ƒè™‘åˆ°ä»¥ä¸Šå› ç´ ï¼Œåœ¨å¯¹è±¡å…³ç³»ç”Ÿå‘½å‘¨æœŸå…è®¸çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆé€‰æ‹©ä½¿ç”¨ unowned å¼•ç”¨ã€‚ä½†æ˜¯è¿™ä¸æ˜¯æ­¤æ•…äº‹çš„ç»“å±€ï¼Œæ¥ä¸‹æ¥æ¯”è¾ƒä¸€ä¸‹ä¸¤è€…æ€§èƒ½1ä¸Šçš„å·®åˆ«ã€‚ æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢åœ¨æŸ¥çœ‹ Swift é¡¹ç›®æºç éªŒè¯ä¹‹å‰ï¼Œéœ€è¦ç†è§£ ARC å¦‚ä½•ç®¡ç†è¿™ä¸¤ç§å¼•ç”¨ç±»å‹ï¼Œå¹¶ä¸”è¿˜éœ€è¦è§£é‡Š swiftcï¼ŒLLVM å’Œ SIL çš„ç›¸å…³çŸ¥è¯†ã€‚ æ¥ä¸‹æ¥è¯•ç€ç®€è¦ä»‹ç»æœ¬æ–‡æ‰€éœ€è¦çš„å¿…å¤‡çŸ¥è¯†ç‚¹ï¼Œå¦‚æœæƒ³äº†è§£æ›´å¤šï¼Œå°†åœ¨æœ€åçš„è„šæ³¨ä¸­æ‰¾åˆ°ä¸€äº›æœ‰ç”¨çš„é“¾æ¥ã€‚ ä½¿ç”¨ä¸€ä¸ªå›¾æ¥è§£é‡Š swiftc æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹çš„åŒ…å«çš„æ¨¡å—ï¼š Swiftc å’Œ clang ä¸€æ ·æ„å»ºåœ¨ LLVM ä¸Šï¼Œéµå¾ª clang ç¼–è¯‘å™¨ç›¸ä¼¼çš„ç¼–è¯‘æµç¨‹ã€‚ åœ¨ç¼–è¯‘è¿‡ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨ä¸€ä¸ªç‰¹å®šè¯­è¨€å‰ç«¯è¿›è¡Œç®¡ç†ï¼Œswift æºä»£ç è¢«è§£é‡Šç”Ÿæˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘(AST)è¡¨è¾¾2ï¼Œç„¶åæŠ½è±¡è¯­æ³•æ ‘çš„ç»“æœä»è¯­ä¹‰è§’åº¦è¿›è¡Œåˆ†æï¼Œæ‰¾å‡ºè¯­ä¹‰é”™è¯¯ã€‚ åœ¨è¿™ä¸ªç‚¹ä¸Šï¼Œå¯¹äºå…¶ä»–çš„åŸºäº LLVM çš„ç¼–è¯‘å™¨æ¥è®²ï¼Œåœ¨é€šè¿‡ä¸€ä¸ªé™„åŠ æ­¥éª¤å¯¹æºä»£ç è¿›è¡Œé™æ€åˆ†æåï¼ˆå¿…è¦æ—¶å¯ä»¥æ˜¾ç¤ºé”™è¯¯å’Œè­¦å‘Šï¼‰ï¼Œæ¥ç€ IRGen æ¨¡å— ä¼šæŠŠ AST çš„å†…å®¹ä¼šè½¬æ¢æˆä¸€ä¸ªè½»é‡çš„å’Œåº•å±‚çš„æœºå™¨æ— å…³çš„è¡¨ç¤ºï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º LLVM IR(LLVM ä¸­é—´è¡¨ç¤º)ã€‚ å°½ç®¡ä¸¤ä¸ªæ¨¡å—éƒ½éœ€è¦åšä¸€äº›ç›¸åŒæ£€æŸ¥ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ¨¡å—æ˜¯åŒºåˆ†å¼€çš„ï¼Œåœ¨ä¸¤ä¸ªæ¨¡å—ä¹‹é—´ä¹Ÿå­˜åœ¨è®¸å¤šé‡å¤çš„ä»£ç ã€‚ IR æ˜¯ä¸€ç§é™æ€å•èµ‹å€¼å½¢å¼ï¼ˆSSA-formï¼‰ä¸€è‡´è¯­è¨€ï¼Œå¯ä»¥çœ‹åšæ³¨å…¥äº† LLVM çš„è™šæ‹Ÿæœºä¸‹çš„ RISC ç±»å‹æ±‡ç¼–è¯­è¨€ã€‚åŸºäº SSA å°†ç®€åŒ–æ¥ä¸‹æ¥çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œä»è¯­è¨€å‰ç«¯æä¾›çš„ä¸­é—´è¡¨è¾¾ä¼šåœ¨ IR è¿›è¡Œå¤šé‡ä¼˜åŒ–ã€‚ éœ€è¦é‡ç‚¹æ³¨æ„çš„æ˜¯ï¼ŒIR å…¶ä¸­ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œå®ƒå…·æœ‰ä¸‰ç§ä¸åŒçš„å½¢å¼ï¼šå†…å­˜è¡¨è¾¾ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰ï¼Œåºåˆ—åŒ–ä½ä»£ç å½¢å¼ï¼ˆä½ å·²ç»çŸ¥é“çš„ä½ä»£ç å½¢å¼ï¼‰å’Œå¯è¯»å½¢å¼ã€‚ æœ€åä¸€ç§å½¢å¼éå¸¸æœ‰ç”¨ï¼Œç”¨æ¥éªŒè¯ IR ä»£ç çš„æœ€ç»ˆç»“æ„ï¼Œè¿™ä¸ªç»“æ„å°†ä¼šä¼ å…¥åˆ°æ•´ä¸ªè¿‡ç¨‹ä¸­çš„æœ€åä¸€æ­¥ï¼Œå°†ä¼šä»æœºå™¨ç‹¬ç«‹çš„ IR ä»£ç è½¬æ¢æˆå¹³å°ç›¸å…³çš„è¡¨è¾¾(æ¯”å¦‚ï¼šx86ï¼ŒARM ç­‰ç­‰)ã€‚æœ€åä¸€æ­¥å°†è¢« LLVM å¹³å°åç«¯æ‰§è¡Œã€‚ é‚£ä¹ˆ swiftc å’Œå…¶ä»–åŸºäº LLVM çš„ç¼–è¯‘å™¨æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿswiftc å’Œå…¶ä»–ç¼–è¯‘å™¨ä»ç»“æ„å½¢å¼ä¸Šçš„å·®åˆ«ä¸»è¦ä½“ç°åœ¨ä¸€ä¸ªé™„åŠ ç»„ä»¶ï¼Œè¿™ä¸ªé™„åŠ ç»„ä»¶æ˜¯ SILGen ï¼Œåœ¨ IRGen ä¹‹å‰ï¼Œæ‰§è¡Œä»£ç çš„ç›‘æµ‹å’Œä¼˜åŒ–ï¼Œç”Ÿæˆä¸€ä¸ªé«˜çº§çš„ä¸­é—´è¡¨è¾¾ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º SIL ï¼ˆSwift Intermediate Languageï¼ŒSwift ä¸­é—´è¯­è¨€ï¼‰ï¼Œæœ€å SIL å°†ä¼šè½¬æ¢æˆ LLVM IRã€‚è¿™ä¸€æ­¥åŠ å¼ºäº†åœ¨å•ä¸ªè½¯ä»¶æ¨¡å—ä¸Šæ‰€æœ‰å…·ä½“è¯­è¨€çš„æ£€æŸ¥ï¼Œå¹¶ä¸”ç®€åŒ–äº† IRGenã€‚ ä» AST åˆ° IR çš„è½¬æ¢åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ã€‚SILGen æŠŠ AST æºä»£ç è½¬æ¢ä¸ºåŸå§‹ SIL ï¼Œç„¶åç¼–è¯‘å™¨è¿›è¡Œ Swift è¯­æ³•æ£€æŸ¥ï¼ˆéœ€è¦æ—¶æ‰“å°é”™è¯¯æˆ–è€…è­¦å‘Šä¿¡æ¯ï¼‰ï¼Œä¼˜åŒ–æœ‰æ•ˆçš„åŸå§‹ SIL ï¼Œé€šè¿‡ä¸€äº›æ­¥éª¤æœ€åç”Ÿæˆæ ‡å‡†åŒ– SIL ã€‚å¦‚ä¸Šé¢çš„ç¤ºæ„å›¾æ˜¾ç¤ºé‚£æ ·ï¼Œæ ‡å‡†åŒ– SIL çš„æœ€åè½¬åŒ–ä¸º LLVM IRã€‚ å†æ¬¡å¼ºè°ƒï¼ŒSIL æ˜¯ä¸€ä¸ª SSA ç±»å‹è¯­è¨€ï¼Œä½¿ç”¨é™„åŠ çš„ç»“æ„æ‰©å±•äº† Swift çš„è¯­æ³•ã€‚å®ƒä¾èµ– Swift çš„ç±»å‹ç³»ç»Ÿï¼Œå¹¶ä¸”èƒ½ç†è§£ Swift çš„å®šä¹‰ï¼Œä½†æ˜¯éœ€è¦é‡ç‚¹è®°ä½çš„æ˜¯ï¼Œå½“ç¼–è¯‘ä¸€ä¸ªæ‰‹å†™çš„ SIL æºç ï¼ˆæ˜¯çš„ï¼Œå¯ä»¥æ‰‹åŠ¨å†™ SIL ç„¶åç¼–è¯‘å®ƒï¼‰æ—¶ï¼Œé«˜é˜¶çš„ Swift ä»£ç æˆ–è€…å‡½æ•°å†…å®¹å°†è¢«ç¼–è¯‘å™¨å¿½ç•¥ã€‚ åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ï¼Œæˆ‘ä»¬å°†åˆ†æä¸€ä¸ªæ ‡å‡†åŒ– SIL çš„æ¡ˆä¾‹ï¼Œæ¥ç†è§£ unowned å’Œ weak å¼•ç”¨å¦‚ä½•è¢«ç¼–è¯‘å™¨å¤„ç†ã€‚ä¸€ä¸ªåŒ…å«æ•è·åˆ—è¡¨çš„åŸºæœ¬é—­åŒ…çš„ä¾‹å­ï¼ŒæŸ¥çœ‹è¿™ä¸ªä¾‹å­ç”Ÿæˆçš„ SIL ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°è¢«ç¼–è¯‘å™¨æ·»åŠ çš„æ‰€æœ‰ ARC ç›¸å…³çš„å‡½æ•°è°ƒç”¨ã€‚ ä» GitHub æˆ–è€… zipped è·å–æœ¬æ–‡ç›¸å…³çš„ Playground ä»£ç ã€‚ç„¶åä»è¿™é‡Œè·å–é—­åŒ…æ¡ˆä¾‹å’Œ SIL ï¼ŒSILGen ä»¥åŠ LLVM IR çš„è¾“å‡ºã€‚ æ•è·åˆ—è¡¨å¤„ç†è§£ææ¥ä¸‹æ¥çœ‹çœ‹ä¸€ä¸ªç®€å•çš„ Swift çš„ä¾‹å­ï¼Œå®šä¹‰ä¸¤ä¸ªç±»å˜é‡ï¼Œç„¶ååœ¨ä¸€ä¸ªé—­åŒ…ä¸­å¯¹ä»–ä»¬è¿›è¡Œå¼±å¼•ç”¨çš„æ•è·ï¼š 12345678910111213141516class aClass&#123; var value = 1&#125;var c1 = aClass()var c2 = aClass()var fSpec = &#123; [unowned c1, weak c2] in c1.value = 42 if let c2o = c2 &#123; c2o.value = 42 &#125;&#125;fSpec() é€šè¿‡ xcrun swiftc -emit-sil sample.swift ç¼–è¯‘ swift æºä»£ç ï¼Œç”Ÿæˆæ ‡å‡†åŒ– SIL ä»£ç ã€‚åŸå§‹SIL å¯ä»¥ä½¿ç”¨ -emit-silgen é€‰é¡¹æ¥ç”Ÿæˆã€‚ è¿è¡Œä»¥ä¸Šå‘½ä»¤ä»¥åï¼Œä¼šå‘ç° swiftc äº§ç”Ÿäº†è®¸å¤šä»£ç ã€‚é€šè¿‡æŸ¥çœ‹ swiftc è¾“å‡ºä»£ç çš„ç‰‡æ®µï¼Œå­¦ä¹ ä¸€ä¸‹åŸºæœ¬çš„ SIL æŒ‡ä»¤ï¼Œç†è§£æ•´ä¸ªç»“æ„ã€‚ åœ¨ä¸‹é¢ä»£ç ä¸­éœ€è¦çš„åœ°æ–¹æ·»åŠ äº†ä¸€äº›å¤šè¡Œæ³¨é‡Šï¼ˆç¼–è¯‘å™¨ä¹Ÿç”Ÿæˆäº†ä¸€äº›å•è¡Œæ³¨é‡Šï¼‰ï¼Œå¸Œæœ›è¿™äº›æ³¨é‡Šå·²ç»è¶³å¤Ÿè¯´æ¸…æ¥šå‘ç”Ÿäº†ä»€ä¹ˆï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145/* æ­¤æ–‡ä»¶åŒ…å«å…¸å‹ SIL ä»£ç */sil_stage canonical /* åªæœ‰åœ¨ SIL å†…éƒ¨ä½¿ç”¨çš„ç‰¹æ®Šçš„å¯¼å…¥*/import Builtin import Swiftimport SwiftShims/* ä¸‰ä¸ªå…¨å±€å˜é‡çš„å®šä¹‰ï¼ŒåŒ…æ‹¬ c1ï¼Œc2 å’Œ é—­åŒ… fSpecã€‚ @_Tv4clos2c1CS_6aClassæ˜¯å˜é‡çš„ç¬¦å·ï¼Œ$aClass æ˜¯å®ƒçš„ç±»å‹ï¼ˆç±»å‹å‰ç¼€ä¸º$)ã€‚ å˜é‡ååœ¨è¿™é‡Œçœ‹èµ·æ¥å¾ˆä¹±ï¼Œä½†æ˜¯åœ¨åé¢çš„ä»£ç ä¸­å°†å˜å¾—æ›´åŠ å¯è¯»ã€‚*/// c1sil_global hidden @_Tv4sample2c1CS_6aClass : $aClass// c2sil_global hidden @_Tv4sample2c2CS_6aClass : $aClass// fSpecsil_global hidden @_Tv4sample5fSpecFT_T_ : $@callee_owned () -&gt; ().../* å±‚æ¬¡ä½œç”¨åŸŸå®šä¹‰è¡¨ç¤ºåŸå§‹ä»£ç çš„ä½ç½®ã€‚ æ¯ä¸ª SIL æŒ‡ç¤ºå°†ä¼šæŒ‡å‘å®ƒç”Ÿæˆçš„ `sil_scope`ã€‚*/sil_scope 1 &#123; parent @main : $@convention(c) (Int32, UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;) -&gt; Int32 &#125;sil_scope 2 &#123; loc "sample.swift":14:1 parent 1 &#125;/* è‡ªåŠ¨ç”Ÿæˆçš„ @main å‡½æ•°åŒ…å«äº†æˆ‘ä»¬åŸå§‹å…¨éƒ¨ä½œç”¨åŸŸçš„ä»£ç ã€‚ è¿™é‡Œæ²¿ç”¨äº†ç†Ÿæ‚‰çš„ c main() å‡½æ•°ç»“æ„ï¼Œæ¥æ”¶å‚æ•°ä¸ªæ•°å’Œå‚æ•°æ•°ç»„ä¸¤ä¸ªè¾“å…¥ï¼Œè¿™ä¸ªå‡½æ•°éµå¾ª c è°ƒç”¨çº¦å®šã€‚ è¿™ä¸ªå‡½æ•°åŒ…å«äº†éœ€è¦è°ƒç”¨é—­åŒ…çš„æŒ‡ä»¤ã€‚*/// mainsil @main : $@convention(c) (Int32, UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;) -&gt; Int32 &#123;/* å…¥å£å®šä¹‰å¤´éƒ¨ä¸º % ç¬¦å·ï¼Œåé¢è·Ÿéšä¸€ä¸ªæ•°å­— idã€‚ æ¯å½“ä¸€ä¸ªæ–°çš„å…¥å£å®šä¹‰æ—¶ï¼ˆæˆ–è€…å‡½æ•°å¼€å¤´å®šä¹‰å‡½æ•°å‚æ•°ï¼‰ï¼Œç¼–è¯‘å™¨åœ¨å…¥å£è¡Œå°¾æ ¹æ®å®ƒçš„å€¼ï¼ˆå«åš usersï¼‰æ·»åŠ ä¸€ä¸ªæ³¨é‡Šã€‚ å¯¹äºå…¶ä»–æŒ‡ä»¤ï¼Œéœ€è¦æä¾› id å·ã€‚ åœ¨è¿™é‡Œï¼Œå…¥å£ 0 å°†è¢«ç”¨æ¥è®¡ç®—å…¥å£ 4 çš„å†…å®¹ï¼Œå…¥å£ 1 å°†è¢«ç”¨æ¥åˆ›å»ºå…¥å£ 10 çš„å€¼ã€‚*/// %0 // user: %4// %1 // user: %10/* æ¯ä¸€ä¸ªå‡½æ•°è¢«åˆ†è§£æˆä¸€ç³»åˆ—çš„åŸºæœ¬æŒ‡ä»¤å—ï¼Œæ¯ä¸€ä¸ªæŒ‡ä»¤å—ç»“æŸäºä¸€ä¸ªç»ˆæ­¢æŒ‡ä»¤ï¼ˆä¸€ä¸ªåˆ†æ”¯æˆ–è€…ä¸€ä¸ªè¿”å›ï¼‰ã€‚ è¿™ä¸€ç³»åˆ—çš„æŒ‡ä»¤å—è¡¨ç¤ºå‡½æ•°æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ã€‚*/bb0(%0 : $Int32, %1 : $UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;):... /* æ¯ä¸€ä¸ª SIL æŒ‡ä»¤éƒ½åŒ…å«ä¸€ä¸ªå¼•ç”¨ï¼ŒæŒ‡å‘æºä»£ç çš„ä½ç½®ï¼ŒåŒ…æ‹¬æŒ‡ä»¤å…·ä½“ä»æºä»£ç ä¸­å“ªä¸ªåœ°æ–¹æ¥ï¼Œå±äºå“ªä¸€ä¸ªä½œç”¨åŸŸã€‚ åœ¨åé¢åˆ†æå…·ä½“çš„æ–¹æ³•ä¼šçœ‹åˆ°è¿™äº›å†…å®¹ã€‚ */ unowned_retain %27 : $@sil_unowned aClass, loc "sample.swift":9:14, scope 2 // id: %28 store %27 to %2 : $*@sil_unowned aClass, loc "sample.swift":9:14, scope 2 // id: %29 %30 = alloc_box $@sil_weak Optional&lt;aClass&gt;, var, name "c2", loc "sample.swift":9:23, scope 2 // users: %46, %44, %43, %31 %31 = project_box %30 : $@box @sil_weak Optional&lt;aClass&gt;, loc "sample.swift":9:23, scope 2 // user: %35 %32 = load %19 : $*aClass, loc "sample.swift":9:23, scope 2 // users: %34, %33 ...&#125;.../* ä¸‹é¢æ˜¯ä¸€ç³»åˆ—è‡ªåŠ¨ç”Ÿæˆçš„`aClass`çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š init/deinit, setter/getter å’Œå…¶ä»–ä¸€äº›å·¥å…·æ–¹æ³•ã€‚ æ¯ä¸ªæ–¹æ³•å‰çš„æ³¨é‡Šæ˜¯ç¼–è¯‘å™¨æ·»åŠ çš„ï¼Œç”¨æ¥è¯´æ˜ä»£ç çš„å…·ä½“ä½œç”¨ã€‚*//* éšè—æ–¹æ³•åªåœ¨å®ƒä»¬æ¨¡å—ä¸­å¯è§ã€‚ @convention(æ–¹æ³•å)æ˜¯ Swift ä¸­æ–¹æ³•è°ƒç”¨é»˜è®¤çš„çº¦å®šï¼Œåœ¨å°¾éƒ¨æœ‰ä¸€ä¸ªé™„åŠ çš„å‚æ•°æŒ‡å‘å®ƒè‡ªå·±ã€‚*/// aClass.__deallocating_deinitsil hidden @_TFC4clos6aClassD : $@convention(method) (@owned aClass) -&gt; () &#123; ...&#125;/* @guaranteed å‚æ•°è¡¨ç¤ºä¿è¯åœ¨æ•´ä¸ªå‘¨æœŸå†…è°ƒç”¨æ­¤æ–¹æ³•éƒ½æœ‰æ•ˆã€‚*/// aClass.deinitsil hidden @_TFC4clos6aClassd : $@convention(method) (@guaranteed aClass) -&gt; @owned Builtin.NativeObject &#123; ...&#125;/* [transparent] ä¿®é¥°çš„æ–¹æ³•æ˜¯å†…è”çš„å°æ–¹æ³•*/// aClass.value.gettersil hidden [transparent] @_TFC4clos6aClassg5valueSi : $@convention(method) (@guaranteed aClass) -&gt; Int &#123; ...&#125;// aClass.value.settersil hidden [transparent] @_TFC4clos6aClasss5valueSi : $@convention(method) (Int, @guaranteed aClass) -&gt; () &#123; ...&#125;// aClass.value.materializeForSetsil hidden [transparent] @_TFC4clos6aClassm5valueSi : $@convention(method) (Builtin.RawPointer, @inout Builtin.UnsafeValueBuffer, @guaranteed aClass) -&gt; (Builtin.RawPointer, Optional&lt;Builtin.RawPointer&gt;) &#123; ...&#125;/* @owned ä¿®é¥°ç¬¦è¡¨ç¤ºè¿™ä¸ªå¯¹è±¡å°†è¢«è°ƒç”¨è€…æ‹¥æœ‰ã€‚*/// aClass.init() -&gt; aClasssil hidden @_TFC4clos6aClasscfT_S0_ : $@convention(method) (@owned aClass) -&gt; @owned aClass &#123; ...&#125;// aClass.__allocating_init() -&gt; aClasssil hidden @_TFC4clos6aClassCfT_S0_ : $@convention(method) (@thick aClass.Type) -&gt; @owned aClass &#123; ...&#125;/* æ¥ä¸‹é¢æ˜¯é—­åŒ…ä»£ç æ®µ*/// (closure #1)sil shared @_TF4closU_FT_T_ : $@convention(thin) (@owned @sil_unowned aClass, @owned @box @sil_weak Optional&lt;aClass&gt;) -&gt; () &#123; ... /* å…³äºé—­åŒ…çš„ SIL ä»£ç ï¼Œ è§ä¸‹æ–‡ */ ...&#125;.../* sil_vtable å®šä¹‰æ‰€æœ‰å…³äº aClass ç±»çš„è™šå‡½æ•°è¡¨ã€‚ sil_vtable åŒ…å«äº†æœŸæœ›çš„æ‰€æœ‰è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•ã€‚*/sil_vtable aClass &#123; #aClass.deinit!deallocator: _TFC4clos6aClassD // aClass.__deallocating_deinit #aClass.value!getter.1: _TFC4clos6aClassg5valueSi // aClass.value.getter #aClass.value!setter.1: _TFC4clos6aClasss5valueSi // aClass.value.setter #aClass.value!materializeForSet.1: _TFC4clos6aClassm5valueSi // aClass.value.materializeForSet #aClass.init!initializer.1: _TFC4clos6aClasscfT_S0_ // aClass.init() -&gt; aClass&#125; ç°åœ¨å›åˆ°ä¸»å‡½æ•°ï¼Œçœ‹çœ‹ä¸¤ä¸ªç±»å®ä¾‹å¦‚ä½•è¢«è·å–åˆ°ï¼Œå¹¶å¦‚ä½•ä¼ é€’ç»™è°ƒç”¨ä»–ä»¬çš„é—­åŒ…ã€‚ åœ¨è¿™é‡Œï¼Œæ‰€æœ‰æ ‡è¯†éƒ½è¢«é‡æ–°æ•´ç†ï¼Œä½¿å¾—ä»£ç ç‰‡æ®µæ›´åŠ å¯è¯»ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071// mainsil @main : $@convention(c) (Int32, UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;) -&gt; Int32 &#123;// %0 // user: %4// %1 // user: %10bb0(%0 : $Int32, %1 : $UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;): ... /* å…¨å±€å˜é‡çš„å¼•ç”¨ä½¿ç”¨ä¸‰ä¸ªå…¥å£æ¥æ”¾ç½®ã€‚ */ %13 = global_addr @clos.c1 : $*aClass, loc "sample.swift":5:5, scope 1 // users: %26, %17 ... %19 = global_addr @clos.c2 : $*aClass, loc "sample.swift":6:5, scope 1 // users: %32, %23 ... %25 = global_addr @clos.fSpec : $*@callee_owned () -&gt; (), loc "sample.swift":8:5, scope 1 // users: %48, %45 /* c1 æ˜¯ unowned_retained çš„ã€‚ ä¸‹é¢çš„æŒ‡ä»¤å¢åŠ å˜é‡çš„ unowned å¼•ç”¨è®¡æ•°ã€‚ */ %26 = load %13 : $*aClass, loc "sample.swift":9:14, scope 2 // user: %27 %27 = ref_to_unowned %26 : $aClass to $@sil_unowned aClass, loc "sample.swift":9:14, scope 2 // users: %47, %38, %39, %29, %28 unowned_retain %27 : $@sil_unowned aClass, loc "sample.swift":9:14, scope 2 // id: %28 store %27 to %2 : $*@sil_unowned aClass, loc "sample.swift":9:14, scope 2 // id: %29 /* å¯¹ c2 çš„å¤„ç†ä¼šæ›´åŠ å¤æ‚ä¸€äº›ã€‚ alloc_box åˆ›å»ºäº†ä¸€ä¸ªè¿™ä¸ªå˜é‡çš„å¼•ç”¨æ•°å®¹å™¨ï¼Œå˜é‡å°†ä¼šå­˜åœ¨è¿™ä¸ªå®¹å™¨çš„å †ä¸­ã€‚ å®¹å™¨åˆ›å»ºä»¥åï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªå¯é€‰å˜é‡ï¼ŒæŒ‡å‘ c2ï¼Œå¹¶ä¸”å¯é€‰å˜é‡ä¼šå­˜å‚¨åœ¨å®¹å™¨é‡Œã€‚å®¹å™¨ä¼šå¢åŠ æ‰€åŒ…å«å€¼çš„æŠ€æœ¯ï¼Œæ­£å¦‚ä¸‹é¢çœ‹åˆ°çš„ä¸€æ ·ï¼Œä¸€æ—¦å®¹å™¨è¢«è¿ç§»ï¼Œå¯é€‰å€¼å°±ä¼šè¢«é‡Šæ”¾ã€‚ åœ¨è¿™é‡Œï¼Œc2 çš„å€¼å°†è¢«å­˜å‚¨åœ¨è¿™ä¸ªå¯é€‰å€¼ä¸­ï¼Œå¯¹è±¡å°†æš‚æ—¶strong_retained ç„¶åé‡Šæ”¾ã€‚ */ %30 = alloc_box $@sil_weak Optional&lt;aClass&gt;, var, name "c2", loc "sample.swift":9:23, scope 2 // users: %46, %44, %43, %31 %31 = project_box %30 : $@box @sil_weak Optional&lt;aClass&gt;, loc "sample.swift":9:23, scope 2 // user: %35 %32 = load %19 : $*aClass, loc "sample.swift":9:23, scope 2 // users: %34, %33 strong_retain %32 : $aClass, loc "sample.swift":9:23, scope 2 // id: %33 %34 = enum $Optional&lt;aClass&gt;, #Optional.some!enumelt.1, %32 : $aClass, loc "sample.swift":9:23, scope 2 // users: %36, %35 store_weak %34 to [initialization] %31 : $*@sil_weak Optional&lt;aClass&gt;, loc "sample.swift":9:23, scope 2 // id: %35 release_value %34 : $Optional&lt;aClass&gt;, loc "sample.swift":9:23, scope 2 // id: %36 /* è·å–åˆ°é—­åŒ…çš„å¼•ç”¨ã€‚ */ // function_ref (closure #1) %37 = function_ref @sample.(closure #1) : $@convention(thin) (@owned @sil_unowned aClass, @owned @box @sil_weak Optional&lt;aClass&gt;) -&gt; (), loc "sample.swift":8:13, scope 2 // user: %44 /* c1 å°†è¢«æ ‡è®°ä¸º taggedï¼Œå¹¶ä¸”å˜é‡å˜ä¸º unowned_retainedã€‚ */ strong_retain_unowned %27 : $@sil_unowned aClass, loc "sample.swift":8:13, scope 2 // id: %38 %39 = unowned_to_ref %27 : $@sil_unowned aClass to $aClass, loc "sample.swift":8:13, scope 2 // users: %42, %40 %40 = ref_to_unowned %39 : $aClass to $@sil_unowned aClass, loc "sample.swift":8:13, scope 2 // users: %44, %41 unowned_retain %40 : $@sil_unowned aClass, loc "sample.swift":8:13, scope 2 // id: %41 strong_release %39 : $aClass, loc "sample.swift":8:13, scope 2 // id: %42 /* åŒ…å« c2 çš„å¯é€‰å€¼å®¹å™¨æ˜¯ strong_retained çš„ã€‚ */ strong_retain %30 : $@box @sil_weak Optional&lt;aClass&gt;, loc "sample.swift":8:13, scope 2 // id: %43 /* åˆ›å»ºä¸€ä¸ªé—­åŒ…å¯¹è±¡ï¼Œç»‘å®šæ–¹æ³•åˆ°å‚æ•°ä¸­ã€‚ */ %44 = partial_apply %37(%40, %30) : $@convention(thin) (@owned @sil_unowned aClass, @owned @box @sil_weak Optional&lt;aClass&gt;) -&gt; (), loc "sample.swift":8:13, scope 2 // user: %45 store %44 to %25 : $*@callee_owned () -&gt; (), loc "sample.swift":8:13, scope 2 // id: %45 /* å¯¹ c1 å’Œ c2 çš„å®¹å™¨å˜é‡è¿›è¡Œé‡Šæ”¾ï¼ˆä½¿ç”¨ å¯¹åº”åŒ¹é…çš„ *_release æ–¹æ³•ï¼‰ã€‚ */ strong_release %30 : $@box @sil_weak Optional&lt;aClass&gt;, loc "sample.swift":14:1, scope 2 // id: %46 unowned_release %27 : $@sil_unowned aClass, loc "sample.swift":9:14, scope 2 // id: %47 /* åŠ è½½åŸå…ˆå­˜å‚¨çš„é—­åŒ…å¯¹è±¡ï¼Œå¢åŠ å¼ºå¼•ç”¨ç„¶åè°ƒç”¨å®ƒã€‚ */ %48 = load %25 : $*@callee_owned () -&gt; (), loc "sample.swift":17:1, scope 2 // users: %50, %49 strong_retain %48 : $@callee_owned () -&gt; (), loc "sample.swift":17:1, scope 2 // id: %49 %50 = apply %48() : $@callee_owned () -&gt; (), loc "sample.swift":17:7, scope 2 ...&#125; é—­åŒ…æœ‰ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ç»“æ„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566/* é—­åŒ…å‚æ•°è¢«æ ‡è®°ä¸º @sil, æŒ‡å®šå‚æ•°å¦‚ä½•è¢«è®¡æ•°ï¼Œæœ‰ä¸€ä¸ª unowned çš„ aClass ç±»å˜é‡ c2, å’Œå¦å¤–ä¸€ä¸ªåŒ…å« c2 çš„å¯é€‰å€¼å®¹å™¨ã€‚*/// (closure #1)sil shared @clos.fSpec: $@convention(thin) (@owned @sil_unowned aClass, @owned @box @sil_weak Optional&lt;aClass&gt;) -&gt; () &#123;// %0 // users: %24, %6, %5, %2// %1 // users: %23, %3/* ä¸‹é¢çš„å‡½æ•°åŒ…å«ä¸‰å—ï¼Œåé¢ä¸¤å—çš„æ‰§è¡Œä¾èµ–å¯é€‰å€¼ c2 å…·ä½“çš„å€¼ã€‚*/bb0(%0 : $@sil_unowned aClass, %1 : $@box @sil_weak Optional&lt;aClass&gt;):... /* c1 è¢«å¼ºè®¡æ•°ã€‚ */ strong_retain_unowned %0 : $@sil_unowned aClass, loc "sample.swift":10:5, scope 17 // id: %5 %6 = unowned_to_ref %0 : $@sil_unowned aClass to $aClass, loc "sample.swift":10:5, scope 17 // users: %11, %10, %9 /* ä½¿ç”¨å†…éƒ¨è‡ªå¸¦åŒ…ï¼Œä¼ å…¥ä¸€ä¸ªæ•´å‹å­—é¢é‡åˆ°æ•´å‹ç»“æ„ä¸­ï¼Œåˆå§‹åŒ–äº†ä¸€ä¸ªå€¼ä¸º 42 çš„æ•´å‹å€¼ã€‚ è¿™ä¸ªå€¼å°†è¢«è®¾ç½®ä¸º c1 çš„æ–°å€¼ï¼Œå®Œæˆä»¥åè¿™ä¸ªå˜é‡å°†ä¼šè¢«é‡Šæ”¾ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡çœ‹åˆ° class_method æŒ‡ä»¤ï¼Œç”¨äºè·å– vtable ä¸­çš„å‡½æ•°å¼•ç”¨ã€‚ */ %7 = integer_literal $Builtin.Int64, 42, loc "sample.swift":10:16, scope 17 // user: %8 %8 = struct $Int (%7 : $Builtin.Int64), loc "sample.swift":10:16, scope 17 // user: %10 %9 = class_method %6 : $aClass, #aClass.value!setter.1 : (aClass) -&gt; (Int) -&gt; () , $@convention(method) (Int, @guaranteed aClass) -&gt; (), loc "sample.swift":10:14, scope 17 // user: %10 %10 = apply %9(%8, %6) : $@convention(method) (Int, @guaranteed aClass) -&gt; (), loc "sample.swift":10:14, scope 17 strong_release %6 : $aClass, loc "sample.swift":10:16, scope 17 // id: %11 /* æ¥ä¸‹æ¥è®¨è®º c2ã€‚ è·å–å¯é€‰å€¼ï¼Œç„¶åæ ¹æ®å®ƒçš„å†…å®¹æ‰§è¡Œæ¥ä¸‹æ¥çš„åˆ†æ”¯è¯­å¥ã€‚ If the optional has a value the bb2 block will be executed before jumping to bb3, if it doesn't after a brief jump to bb1, the function will proceed to bb3 releasing the retained parameters. */ %12 = load_weak %3 : $*@sil_weak Optional&lt;aClass&gt;, loc "sample.swift":11:18, scope 18 // user: %13 switch_enum %12 : $Optional&lt;aClass&gt;, case #Optional.some!enumelt.1: bb2, default bb1, loc "sample.swift":11:18, scope 18 // id: %13 bb1: // Preds: bb0 /* è·³è½¬åˆ°é—­åŒ…çš„ç»“å°¾ã€‚ */ br bb3, loc "sample.swift":11:18, scope 16 // id: %14// %15 // users: %21, %20, %19, %16bb2(%15 : $aClass): // Preds: bb0 /* è°ƒç”¨ aClass çš„ setterï¼Œè®¾ç½®å®ƒçš„å€¼ä¸º 42. */ ... %17 = integer_literal $Builtin.Int64, 42, loc "sample.swift":12:21, scope 19 // user: %18 %18 = struct $Int (%17 : $Builtin.Int64), loc "sample.swift":12:21, scope 19 // user: %20 %19 = class_method %15 : $aClass, #aClass.value!setter.1 : (aClass) -&gt; (Int) -&gt; () , $@convention(method) (Int, @guaranteed aClass) -&gt; (), loc "sample.swift":12:19, scope 19 // user: %20 %20 = apply %19(%18, %15) : $@convention(method) (Int, @guaranteed aClass) -&gt; (), loc "sample.swift":12:19, scope 19 strong_release %15 : $aClass, loc "sample.swift":13:5, scope 18 // id: %21 br bb3, loc "sample.swift":13:5, scope 18 // id: %22bb3: // Preds: bb1 bb2 /* é‡Šæ”¾æ‰€æœ‰è·å–çš„å˜é‡ç„¶åè¿”å›ã€‚ */ strong_release %1 : $@box @sil_weak Optional&lt;aClass&gt;, loc "sample.swift":14:1, scope 17 // id: %23 unowned_release %0 : $@sil_unowned aClass, loc "sample.swift":14:1, scope 17 // id: %24 %25 = tuple (), loc "sample.swift":14:1, scope 17 // user: %26 return %25 : $(), loc "sample.swift":14:1, scope 17 // id: %26&#125; åœ¨è¿™é‡Œï¼Œå¿½ç•¥æ‰ä¸åŒçš„ ARC æŒ‡ä»¤å¸¦æ¥çš„æ€§èƒ½çš„å·®å¼‚ç‚¹ï¼Œå¯¹ä¸åŒé˜¶æ®µæ¯ç§ç±»å‹çš„æ•è·å˜é‡åšä¸€ä¸ªå¿«é€Ÿçš„å¯¹æ¯”ï¼š åŠ¨ä½œ Unowned Weak é¢„å…ˆè°ƒç”¨ #1 å¯¹è±¡è¿›è¡Œ unowned_retain åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶ä¸”å¯¹è±¡è¿›è¡Œ strong_retain æ“ä½œã€‚åˆ›å»ºä¸€ä¸ªå¯é€‰å€¼ï¼Œå­˜å…¥åˆ°å®¹å™¨ä¸­ï¼Œç„¶åé‡Šæ”¾å¯é€‰å€¼ é¢„å…ˆè°ƒç”¨ #2 strong_retain_unownedï¼Œunowned_retain å’Œ strong_release strong_retain é—­åŒ…æ‰§è¡Œ strong_retain_unownedï¼Œunowned_release load_weak, æ‰“å¼€å¯é€‰å€¼, strong_release è°ƒç”¨ä¹‹å unowned_release strong_release æ­£å¦‚ä¸Šé¢çœ‹åˆ°çš„ SIL ä»£ç æ®µé‚£æ ·ï¼Œå¤„ç† weak å¼•ç”¨ä¼šæ¶‰åŠåˆ°æ›´å¤šçš„å·¥ä½œï¼Œå› ä¸ºéœ€è¦å¤„ç†å¼•ç”¨éœ€è¦çš„å¯é€‰å€¼ã€‚ å‚ç…§å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼Œè¿™é‡Œå¯¹æ¶‰åŠåˆ°çš„æ‰€æœ‰ ARC æŒ‡ä»¤åšä¸€ä¸ªç®€è¦çš„è§£é‡Šï¼š unowned_retainï¼šå¢åŠ å †å¯¹è±¡ä¸­çš„ unowned å¼•ç”¨è®¡æ•°ã€‚ strong_retain_unowned ï¼šæ–­è¨€å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°å¤§äº 0ï¼Œç„¶åå¢åŠ è¿™ä¸ªå¼•ç”¨è®¡æ•°ã€‚ strong_retainï¼šå¢åŠ å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°ã€‚ load_weakï¼šä¸æ˜¯çœŸæ­£çš„ ARC è°ƒç”¨ï¼Œä½†æ˜¯å®ƒå°†å¢åŠ å¯é€‰å€¼æŒ‡å‘å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°ã€‚ strong_releaseï¼šå‡å°‘å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°ã€‚å¦‚æœé‡Šæ”¾æ“ä½œæŠŠå¯¹è±¡å¼ºå¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œå¯¹è±¡å°†è¢«é”€æ¯ï¼Œç„¶åå¼±å¼•ç”¨å°†è¢«æ¸…é™¤ã€‚å½“æ•´ä¸ªå¼ºå¼•ç”¨è®¡æ•°å’Œ unowned å¼•ç”¨è®¡æ•°éƒ½ä¸º0æ—¶ï¼Œå¯¹è±¡çš„å†…å­˜æ‰ä¼šè¢«é‡Šæ”¾ã€‚ unowned_releaseï¼šå‡å°‘å¯¹è±¡çš„ unowned å¼•ç”¨è®¡æ•°ã€‚å½“æ•´ä¸ªå¼ºå¼•ç”¨è®¡æ•°å’Œ unowned å¼•ç”¨è®¡æ•°éƒ½ä¸º 0 æ—¶ï¼Œå¯¹è±¡çš„å†…å­˜æ‰ä¼šè¢«é‡Šæ”¾ã€‚ æ¥ä¸‹æ¥æ·±å…¥åˆ° Swift è¿è¡Œæ—¶çœ‹çœ‹ï¼Œè¿™äº›æŒ‡ä»¤éƒ½æ˜¯å¦‚ä½•è¢«å®ç°çš„ï¼Œç›¸å…³çš„ä»£ç æ–‡ä»¶æœ‰ï¼šHeapObject.cppï¼ŒHeapObject.hï¼ŒRefCount.h å’Œ Heap.cppã€ SwiftObject.mm ä¸­çš„å°‘é‡å®šä¹‰ã€‚å®¹å™¨å®ç°å¯ä»¥åœ¨ MetadataImpl.h æ‰¾åˆ°ï¼Œä½†æ˜¯æœ¬æ–‡ä¸å±•å¼€è®¨è®ºã€‚ è¿™äº›æ–‡ä»¶ä¸­å®šä¹‰å¤§å¤šæ•°çš„ ARC æ–¹æ³•éƒ½æœ‰ä¸‰ç§å˜ä½“ï¼Œä¸€ç§æ˜¯å¯¹ Swift å¯¹è±¡çš„åŸºç¡€å®ç°ï¼Œå¦å¤–ä¸¤ç§å®ç°æ˜¯é’ˆå¯¹éåŸç”Ÿ Swift å¯¹è±¡çš„ï¼šæ¡¥æ¥å¯¹è±¡å’ŒæœªçŸ¥å¯¹è±¡ã€‚åé¢ä¸¤ç§å˜ä½“è¿™é‡Œä¸äºˆè®¨è®ºã€‚ ç¬¬ä¸€ä¸ªè®¨è®ºæŒ‡ä»¤é›†å’Œ unowned å¼•ç”¨ç›¸å…³ã€‚ åœ¨ HeapObject.cpp æ–‡ä»¶ä¸­é—´å¯ä»¥çœ‹åˆ°å¯¹ unowned_retain å’Œ unowned_release çš„å®ç°æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526SWIFT_RT_ENTRY_VISIBILITYvoid swift::swift_unownedRetain(HeapObject *object) SWIFT_CC(RegisterPreservingCC_IMPL) &#123; if (!object) return; object-&gt;weakRefCount.increment();&#125;SWIFT_RT_ENTRY_VISIBILITYvoid swift::swift_unownedRelease(HeapObject *object) SWIFT_CC(RegisterPreservingCC_IMPL) &#123; if (!object) return; if (object-&gt;weakRefCount.decrementShouldDeallocate()) &#123; // Only class objects can be weak-retained and weak-released. auto metadata = object-&gt;metadata; assert(metadata-&gt;isClassObject()); auto classMetadata = static_cast&lt;const ClassMetadata*&gt;(metadata); assert(classMetadata-&gt;isTypeMetadata()); SWIFT_RT_ENTRY_CALL(swift_slowDealloc) (object, classMetadata-&gt;getInstanceSize(), classMetadata-&gt;getInstanceAlignMask()); &#125;&#125; swift_unownedRetain æ˜¯ unowned_retain çš„å…·ä½“å®ç°ï¼Œç®€å•åœ°è¿›è¡Œ unowned å¼•ç”¨è®¡æ•°çš„åŸå­å¢åŠ æ“ä½œï¼ˆè¿™é‡Œå®šä¹‰ä¸ºweakRefCountï¼‰ï¼Œswift_unownedRelease æ›´åŠ å¤æ‚ï¼ŒåŸå› ä¹‹å‰ä¹Ÿæè¿°è¿‡ï¼Œå½“æ²¡æœ‰å…¶ä»– unowned å¼•ç”¨å­˜åœ¨æ—¶ï¼Œå®ƒéœ€è¦æ‰§è¡Œå¯¹è±¡çš„ææ„æ“ä½œã€‚ ä½†æ˜¯æ•´ä½“æ¥è®²éƒ½ä¸å¤æ‚ï¼Œåœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ° doDecrementShouldDeallocate æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ä¸Šé¢ä»£ç ä¸­è¢«ä¸€ä¸ªå‘½åç±»ä¼¼çš„æ–¹æ³•è°ƒç”¨äº†ã€‚è¿™ä¸ªæ–¹æ³•æ²¡æœ‰åšå¤ªå¤šï¼Œswift_slowDealloc åªæ˜¯é‡Šæ”¾ç»™å®šçš„æŒ‡é’ˆã€‚ åˆ°æ­¤å·²ç»æœ‰äº†ä¸€ä¸ªå¯¹è±¡çš„ unowned å¼•ç”¨ï¼Œå¦å¤–ä¸€ä¸ªæŒ‡ä»¤ï¼Œstrong_retain_unowned ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¼ºå¼•ç”¨ï¼š 1234567891011SWIFT_RT_ENTRY_VISIBILITYvoid swift::swift_unownedRetainStrong(HeapObject *object) SWIFT_CC(RegisterPreservingCC_IMPL) &#123; if (!object) return; assert(object-&gt;weakRefCount.getCount() &amp;&amp; "object is not currently weakly retained"); if (! object-&gt;refCount.tryIncrement()) _swift_abortRetainUnowned(object);&#125; å› ä¸ºå¼±å¼•ç”¨åº”è¯¥æŒ‡å‘äº†è¿™ä¸ªå¯¹è±¡ï¼Œè¦ä½¿ç”¨æ–­è¨€æ¥éªŒè¯å¯¹è±¡æ˜¯å¦è¢«å¼±å¼•ç”¨ï¼Œä¸€æ—¦æ–­è¨€é€šè¿‡ï¼Œå°†å°è¯•è¿›è¡Œå¢åŠ å¼ºå¼•ç”¨è®¡æ•°çš„æ“ä½œã€‚ä¸€æ—¦å¯¹è±¡åœ¨è¿›ç¨‹ä¸­å·²ç»è¢«é‡Šæ”¾ï¼Œå°è¯•å°†ä¼šå¤±è´¥ã€‚ æ‰€æœ‰ç±»ä¼¼äº tryIncrement é€šè¿‡æŸç§å½¢å¼ä¿®æ”¹å¼•ç”¨è®¡æ•°çš„æ–¹æ³•éƒ½æ”¾åˆ° RefCount.h ä¸­ï¼Œéœ€è¦ä½¿ç”¨åŸå­æ“ä½œè¿›è¡Œè¿™äº›ä»»åŠ¡ã€‚ æ¥ä¸‹æ¥è®¨è®ºä¸‹ weak å¼•ç”¨çš„çš„å®ç°ï¼Œæ­£å¦‚ä¹‹å‰çœ‹åˆ°çš„é‚£æ ·ï¼Œswift_weakLoadStrong ç”¨æ¥è·å–å®¹å™¨ä¸­å¯é€‰å€¼ä¸­å¼ºå¼•ç”¨çš„å¯¹è±¡ã€‚ 1234567891011121314151617181920212223242526272829303132HeapObject *swift::swift_weakLoadStrong(WeakReference *ref) &#123; if (ref-&gt;Value == (uintptr_t)nullptr) &#123; return nullptr; &#125; // ref å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—® auto ptr = __atomic_fetch_or(&amp;ref-&gt;Value, WR_READING, __ATOMIC_RELAXED); while (ptr &amp; WR_READING) &#123; short c = 0; while (__atomic_load_n(&amp;ref-&gt;Value, __ATOMIC_RELAXED) &amp; WR_READING) &#123; if (++c == WR_SPINLIMIT) &#123; std::this_thread::yield(); c -= 1; &#125; &#125; ptr = __atomic_fetch_or(&amp;ref-&gt;Value, WR_READING, __ATOMIC_RELAXED); &#125; auto object = (HeapObject*)(ptr &amp; ~WR_NATIVE); if (object == nullptr) &#123; __atomic_store_n(&amp;ref-&gt;Value, (uintptr_t)nullptr, __ATOMIC_RELAXED); return nullptr; &#125; if (object-&gt;refCount.isDeallocating()) &#123; __atomic_store_n(&amp;ref-&gt;Value, (uintptr_t)nullptr, __ATOMIC_RELAXED); SWIFT_RT_ENTRY_CALL(swift_unownedRelease)(object); return nullptr; &#125; auto result = swift_tryRetain(object); __atomic_store_n(&amp;ref-&gt;Value, ptr, __ATOMIC_RELAXED); return result;&#125; åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œè·å–ä¸€ä¸ªå¼ºå¼•ç”¨éœ€è¦æ›´å¤šå¤æ‚åŒæ­¥æ“ä½œï¼Œåœ¨å¤šçº¿ç¨‹ç«äº‰ä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œä¼šå¸¦æ¥æ€§èƒ½æŸè€—ã€‚ åœ¨è¿™é‡Œç¬¬ä¸€æ¬¡å‡ºç°çš„ WeakReference å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªç®€å•çš„ç»“æ„ä½“ï¼ŒåŒ…å«ä¸€ä¸ªæ•´å‹å€¼å­—æ®µæŒ‡å‘ç›®æ ‡å¯¹è±¡ï¼Œç›®æ ‡å¯¹è±¡æ˜¯ä½¿ç”¨ HeapObject ç±»æ¥æ‰¿è½½çš„æ¯ä¸€ä¸ªè¿è¡Œæ—¶çš„ Swift å¯¹è±¡ã€‚ åœ¨ weak å¼•ç”¨è¯¢é—®å½“å‰çº¿ç¨‹è®¾ç½®çš„ WR_READING æ ‡è¯†ä¹‹åï¼Œä» WeakReference å®¹å™¨ä¸­è·å– Swift å¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸å†æœ‰æ•ˆï¼Œæˆ–è€…åœ¨ç­‰å¾…è·å–èµ„æºæ—¶ï¼Œå®ƒå˜æˆå¯ä»¥è¿›è¡Œææ„ï¼Œå½“å‰çš„å¼•ç”¨ä¼šè¢«è®¾ç½®ä¸º nullã€‚ å¦‚æœå¯¹è±¡ä¾ç„¶æœ‰æ•ˆï¼Œè·å–å¯¹è±¡çš„å°è¯•å°†ä¼šæˆåŠŸã€‚ å› æ­¤ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è®²ï¼Œå¯¹ weak å¼•ç”¨çš„å¸¸è§„æ“ä½œæ€§èƒ½æ¯” unowned å¼•ç”¨çš„æ›´ä½ï¼ˆä½†æ˜¯ä¸»è¦çš„é—®é¢˜è¿˜æ˜¯åœ¨å¯é€‰å€¼æ“ä½œä¸Šé¢ï¼‰ã€‚ ç»“è®ºä¿å®ˆçš„ä½¿ç”¨ weak å¼•ç”¨æ˜¯å¦æ˜æ™ºå‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œæ— è®ºæ˜¯ä»æ€§èƒ½çš„è§’åº¦è¿˜æ˜¯ä»£ç æ¸…æ™°çš„è§’åº¦è€Œè¨€ã€‚ ä½¿ç”¨æ­£ç¡®çš„æ•è·ä¿®é¥°ç¬¦ç±»å‹ï¼Œæ˜ç¡®çš„è¡¨æ˜ä»£ç ä¸­çš„ç”Ÿå‘½å‘¨æœŸç‰¹æ€§ï¼Œå½“å…¶ä»–äººæˆ–è€…ä½ è‡ªå·±åœ¨è¯»ä½ çš„ä»£ç æ—¶ä¸å®¹æ˜“è¯¯è§£ã€‚ è„šæ³¨1ã€è‹¹æœç¬¬ä¸€æ¬¡è®¨è®º weak/unowned äº‰è®®å¯ä»¥æŸ¥çœ‹è¿™é‡Œï¼Œä¹‹ååœ¨ twitter ä¸Š Joe Groff å¯¹æ­¤ä¹Ÿè¿›è¡Œäº†è®¨è®ºï¼Œå¹¶ä¸”è¢« Michael Tsai æ€»ç»“æˆæ–‡ã€‚è¿™ç¯‡æ–‡ç« ä»æ„å›¾è§’åº¦å‡ºå‘ï¼Œæä¾›äº†å®Œæ•´å¹¶ä¸”å¯æ“ä½œçš„è§£é‡Šã€‚ 2ã€ä»ç»´åŸºç™¾ç§‘ä¸­å¯ä»¥æ‰¾åˆ°å…³äº AST çš„è§£é‡Šï¼Œè¿˜å¯ä»¥ä» Slava Pestov çš„è¿™ç¯‡æ–‡ç« ä¸­çœ‹åˆ°å…³äº Swift ç¼–è¯‘å™¨ä¸­å¦‚ä½•å®ç° AST çš„ä¸€äº›ç»†èŠ‚ã€‚ 3ã€å…³äº SIL çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹è¯¦å°½çš„å®˜æ–¹ SIL æŒ‡å—ï¼Œè¿˜æœ‰ 2015 LLVM å¼€å‘è€…ä¼šè®®çš„è§†é¢‘ã€‚Lex Chou å†™çš„ SIL å¿«é€ŸæŒ‡å—å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚ 4ã€æŸ¥çœ‹åœ¨ Swift ä¸­å¦‚ä½•è¿›è¡Œåç§°ç²‰ç¢ï¼ˆname manglingï¼‰çš„ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹ Lex Chou çš„è¿™ç¯‡æ–‡ç« ã€‚ 5ã€Mike Ash åœ¨ä»–çš„ Friday Q&amp;A ä¸­çš„ä¸€ç¯‡æ–‡ç« ä¸­è®¨è®ºäº†å¦‚ä½•å®ç° weak å¼•ç”¨çš„ä¸€ç§å®è·µæ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•ä¸ç›®å‰ Swift çš„æ–¹æ³•å¯¹æ¯”èµ·æ¥æœ‰ä¸€äº›è¿‡æ—¶ï¼Œä½†æ˜¯å…¶ä¸­çš„è§£é‡Šä¾ç„¶å€¼å¾—å‚è€ƒã€‚ æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® http://swift.ggã€‚ æ–‡ç« è½¬è‡ª SwiftGG]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Unownedä¸Weak</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¾§æ»‘å¯¼èˆªæ æ¶ˆå¤±é—®é¢˜ç¬”è®°]]></title>
    <url>%2Fpush-pop-navigation-bar-hidden%2F</url>
    <content type="text"><![CDATA[å¦‚æœå‰é¡µé¢å’Œåé¡µé¢ä¸åŒï¼Œåˆ™ä¼šå‡ºç°è½»å¾®ä¾§æ»‘æ—¶å¯¼èˆªæ è«åå…¶å¦™æ²¡äº†ğŸ˜‚ Demo-PushAndPop Demo-PushAndPop[å·²è§£å†³] éšè—å¯¼èˆªæ +æ”¹å˜çŠ¶æ€æ æ ·å¼æ—¶å‡ºç°å¯¼èˆªæ è«åå…¶å¦™æ²¡äº† é—®é¢˜ å½“ViewController.swiftå®ç°123override var preferredStatusBarStyle: UIStatusBarStyle &#123; return .lightContent&#125; æ—¶ï¼Œä¸¤ä¸ªViewControllerå¯¹åº”çš„UIStatusBarStyleä¸åŒï¼Œåˆ™ä¼šå‡ºç°å¦‚ä¸Šå›¾ã€‚UIStatusBarStyleä¸€è‡´åˆ™æ­£å¸¸ã€‚ è§£å†³å…³é”®12345class NavigationController: UINavigationController &#123; override var childViewControllerForStatusBarStyle: UIViewController? &#123; return topViewController &#125;&#125; åªéœ€è¦å°†childViewControllerForStatusBarStyleè®¾ç½®ä¸ºUINavigationController.topViewControllerå³å¯ã€‚ å¦å¤–é™„ä¸ŠBViewControllerä¸­ç›¸å…³ä»£ç ã€‚åœ¨åˆ‡æ¢çš„ä¸¤ä¸ªUIViewControllerçš„preferredStatusBarStyleä¸€æ ·æ—¶ï¼Œä¸éœ€è¦è®¾ç½®UINavigationController.childViewControllerForStatusBarStyleã€‚12345678910111213141516171819202122232425262728class BViewController: UIViewController &#123; var navigationBarHidden = false override func viewWillAppear(_ animated: Bool) &#123; super.viewWillAppear(animated) guard let navigationController = navigationController else &#123; return &#125; if navigationController.isNavigationBarHidden != navigationBarHidden &#123; navigationController.setNavigationBarHidden(navigationBarHidden, animated: animated) &#125; &#125; override func viewWillDisappear(_ animated: Bool) &#123; super.viewWillDisappear(animated) guard let navigationController = navigationController else &#123; return &#125; guard let last = navigationController.viewControllers.last as? BViewController else &#123; return &#125; if last.navigationBarHidden != navigationBarHidden &#123; navigationController.setNavigationBarHidden(last.navigationBarHidden, animated: animated) &#125; &#125;&#125; æ„Ÿè°¢ @æœ¨å¤´ viewWillAppearæ›´æ¢ä¸ºviewDidAppearç„¶åè°ƒè¯•ï¼Œåœ¨Demoä¸­æµ‹è¯•ä¹Ÿå¯ä»¥æ›²çº¿æ•‘å›½ã€‚ @Harry æä¾›çš„ç»ˆæå¤§æ³•ï½]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Debug</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Œè½¬ã€iOSå›¾ç‰‡åŠ è½½é€Ÿåº¦æé™ä¼˜åŒ–â€”FastImageCacheè§£æ]]></title>
    <url>%2Fbang-fastimagecache%2F</url>
    <content type="text"><![CDATA[åŸæ–‡ï¼šiOSå›¾ç‰‡åŠ è½½é€Ÿåº¦æé™ä¼˜åŒ–â€”FastImageCacheè§£æ FastImageCacheæ˜¯Pathå›¢é˜Ÿå¼€å‘çš„ä¸€ä¸ªå¼€æºåº“ï¼Œç”¨äºæå‡å›¾ç‰‡çš„åŠ è½½å’Œæ¸²æŸ“é€Ÿåº¦ï¼Œè®©åŸºäºå›¾ç‰‡çš„åˆ—è¡¨æ»‘åŠ¨èµ·æ¥æ›´é¡ºç•…ï¼Œæ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåšçš„ã€‚ ä¼˜åŒ–ç‚¹iOSä»ç£ç›˜åŠ è½½ä¸€å¼ å›¾ç‰‡ï¼Œä½¿ç”¨UIImageVIewæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œéœ€è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š ä»ç£ç›˜æ‹·è´æ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒº ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´ ç”ŸæˆUIImageViewï¼ŒæŠŠå›¾åƒæ•°æ®èµ‹å€¼ç»™UIImageView å¦‚æœå›¾åƒæ•°æ®ä¸ºæœªè§£ç çš„PNG/JPGï¼Œè§£ç ä¸ºä½å›¾æ•°æ® CATransactionæ•è·åˆ°UIImageView layeræ ‘çš„å˜åŒ– ä¸»çº¿ç¨‹Runloopæäº¤CATransactionï¼Œå¼€å§‹è¿›è¡Œå›¾åƒæ¸²æŸ“ 6.1 å¦‚æœæ•°æ®æ²¡æœ‰å­—èŠ‚å¯¹é½ï¼ŒCore Animationä¼šå†æ‹·è´ä¸€ä»½æ•°æ®ï¼Œè¿›è¡Œå­—èŠ‚å¯¹é½ã€‚ 6.2 GPUå¤„ç†ä½å›¾æ•°æ®ï¼Œè¿›è¡Œæ¸²æŸ“ã€‚ FastImageCacheåˆ†åˆ«ä¼˜åŒ–äº†2,4,6.1ä¸‰ä¸ªæ­¥éª¤ï¼š ä½¿ç”¨mmapå†…å­˜æ˜ å°„ï¼Œçœå»äº†ä¸Šè¿°ç¬¬2æ­¥æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„æ“ä½œã€‚ ç¼“å­˜è§£ç åçš„ä½å›¾æ•°æ®åˆ°ç£ç›˜ï¼Œä¸‹æ¬¡ä»ç£ç›˜è¯»å–æ—¶çœå»ç¬¬4æ­¥è§£ç çš„æ“ä½œã€‚ ç”Ÿæˆå­—èŠ‚å¯¹é½çš„æ•°æ®ï¼Œé˜²æ­¢ä¸Šè¿°ç¬¬6.1æ­¥CoreAnimationåœ¨æ¸²æŸ“æ—¶å†æ‹·è´ä¸€ä»½æ•°æ®ã€‚ æ¥ä¸‹æ¥å…·ä½“ä»‹ç»è¿™ä¸‰ä¸ªä¼˜åŒ–ç‚¹ä»¥åŠå®ƒçš„å®ç°ã€‚ å†…å­˜æ˜ å°„å¹³å¸¸æˆ‘ä»¬è¯»å–ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸Šå±‚APIè°ƒç”¨åˆ°æœ€åä¼šä½¿ç”¨ç³»ç»Ÿæ–¹æ³•read()è¯»å–æ•°æ®ï¼Œå†…æ ¸æŠŠç£ç›˜æ•°æ®è¯»å…¥å†…æ ¸ç¼“å†²åŒºï¼Œç”¨æˆ·å†ä»å†…æ ¸ç¼“å†²åŒºè¯»å–æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·å†…å­˜ç©ºé—´ï¼Œè¿™é‡Œæœ‰ä¸€æ¬¡å†…å­˜æ‹·è´çš„æ—¶é—´æ¶ˆè€—ï¼Œå¹¶ä¸”è¯»å–åæ•´ä¸ªæ–‡ä»¶æ•°æ®å°±å·²ç»å­˜åœ¨äºç”¨æˆ·å†…å­˜ä¸­ï¼Œå ç”¨äº†è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚ FastImageCacheé‡‡ç”¨äº†å¦ä¸€ç§è¯»å†™æ–‡ä»¶çš„æ–¹æ³•ï¼Œå°±æ˜¯ç”¨mmapæŠŠæ–‡ä»¶æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´é‡Œçš„è™šæ‹Ÿå†…å­˜ï¼Œæ–‡ä»¶ä¸­çš„ä½ç½®åœ¨è™šæ‹Ÿå†…å­˜ä¸­æœ‰äº†å¯¹åº”çš„åœ°å€ï¼Œå¯ä»¥åƒæ“ä½œå†…å­˜ä¸€æ ·æ“ä½œè¿™ä¸ªæ–‡ä»¶ï¼Œç›¸å½“äºå·²ç»æŠŠæ•´ä¸ªæ–‡ä»¶æ”¾å…¥å†…å­˜ï¼Œä½†åœ¨çœŸæ­£ä½¿ç”¨åˆ°è¿™äº›æ•°æ®å‰å´ä¸ä¼šæ¶ˆè€—ç‰©ç†å†…å­˜ï¼Œä¹Ÿä¸ä¼šæœ‰è¯»å†™ç£ç›˜çš„æ“ä½œï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨è¿™äº›æ•°æ®æ—¶ï¼Œä¹Ÿå°±æ˜¯å›¾åƒå‡†å¤‡æ¸²æŸ“åœ¨å±å¹•ä¸Šæ—¶ï¼Œè™šæ‹Ÿå†…å­˜ç®¡ç†ç³»ç»ŸVMSæ‰æ ¹æ®ç¼ºé¡µåŠ è½½çš„æœºåˆ¶ä»ç£ç›˜åŠ è½½å¯¹åº”çš„æ•°æ®å—åˆ°ç‰©ç†å†…å­˜ï¼Œå†è¿›è¡Œæ¸²æŸ“ã€‚è¿™æ ·çš„æ–‡ä»¶è¯»å†™æ–‡ä»¶æ–¹å¼å°‘äº†æ•°æ®ä»å†…æ ¸ç¼“å­˜åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚ è§£ç å›¾åƒä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨çš„å›¾åƒæ˜¯JPG/PNGï¼Œè¿™äº›å›¾åƒæ•°æ®ä¸æ˜¯ä½å›¾ï¼Œè€Œæ˜¯æ˜¯ç»è¿‡ç¼–ç å‹ç¼©åçš„æ•°æ®ï¼Œä½¿ç”¨å®ƒæ¸²æŸ“åˆ°å±å¹•ä¹‹å‰éœ€è¦è¿›è¡Œè§£ç è½¬æˆä½å›¾æ•°æ®ï¼Œè¿™ä¸ªè§£ç æ“ä½œæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œå¹¶ä¸”æ²¡æœ‰GPUç¡¬è§£ç ï¼Œåªèƒ½é€šè¿‡CPUï¼ŒiOSé»˜è®¤ä¼šåœ¨ä¸»çº¿ç¨‹å¯¹å›¾åƒè¿›è¡Œè§£ç ã€‚å¾ˆå¤šåº“éƒ½è§£å†³äº†å›¾åƒè§£ç çš„é—®é¢˜ï¼Œä¸è¿‡ç”±äºè§£ç åçš„å›¾åƒå¤ªå¤§ï¼Œä¸€èˆ¬ä¸ä¼šç¼“å­˜åˆ°ç£ç›˜ï¼ŒSDWebImageçš„åšæ³•æ˜¯æŠŠè§£ç æ“ä½œä»ä¸»çº¿ç¨‹ç§»åˆ°å­çº¿ç¨‹ï¼Œè®©è€—æ—¶çš„è§£ç æ“ä½œä¸å ç”¨ä¸»çº¿ç¨‹çš„æ—¶é—´ã€‚ FastImageCacheä¹Ÿæ˜¯åœ¨å­çº¿ç¨‹è§£ç å›¾åƒï¼Œä¸åŒçš„æ˜¯å®ƒä¼šç¼“å­˜è§£ç åçš„å›¾åƒåˆ°ç£ç›˜ã€‚å› ä¸ºè§£ç åçš„å›¾åƒä½“ç§¯å¾ˆå¤§ï¼ŒFastImageCacheå¯¹è¿™äº›å›¾åƒæ•°æ®åšäº†ç³»åˆ—ç¼“å­˜ç®¡ç†ï¼Œè¯¦è§ä¸‹æ–‡å®ç°éƒ¨åˆ†ã€‚å¦å¤–ç¼“å­˜çš„å›¾åƒä½“ç§¯å¤§ä¹Ÿæ˜¯ä½¿ç”¨å†…å­˜æ˜ å°„è¯»å–æ–‡ä»¶çš„åŸå› ï¼Œå°æ–‡ä»¶ä½¿ç”¨å†…å­˜æ˜ å°„æ— ä¼˜åŠ¿ï¼Œå†…å­˜æ‹·è´çš„é‡å°‘ï¼Œæ‹·è´åå ç”¨ç”¨æˆ·å†…å­˜ä¹Ÿä¸é«˜ï¼Œæ–‡ä»¶è¶Šå¤§å†…å­˜æ˜ å°„ä¼˜åŠ¿è¶Šå¤§ã€‚ å­—èŠ‚å¯¹é½Core Animationåœ¨å›¾åƒæ•°æ®éå­—èŠ‚å¯¹é½çš„æƒ…å†µä¸‹æ¸²æŸ“å‰ä¼šå…ˆæ‹·è´ä¸€ä»½å›¾åƒæ•°æ®ï¼Œå®˜æ–¹æ–‡æ¡£æ²¡æœ‰å¯¹è¿™æ¬¡æ‹·è´è¡Œä¸ºä½œè¯´æ˜ï¼Œæ¨¡æ‹Ÿå™¨å’ŒInstrumenté‡Œæœ‰é«˜äº®æ˜¾ç¤ºâ€œcopied imagesâ€çš„åŠŸèƒ½ï¼Œä½†ä¼¼ä¹å®ƒæœ‰bugï¼Œå³ä½¿æŸå¼ å›¾ç‰‡æ²¡æœ‰è¢«é«˜äº®æ˜¾ç¤ºå‡ºæ¸²æŸ“æ—¶è¢«copyï¼Œä»è°ƒç”¨å †æ ˆä¸Šä¹Ÿè¿˜æ˜¯èƒ½çœ‹åˆ°è°ƒç”¨äº†CA::Render::copy_imageæ–¹æ³•ï¼š é‚£ä»€ä¹ˆæ˜¯å­—èŠ‚å¯¹é½å‘¢ï¼ŒæŒ‰æˆ‘çš„ç†è§£ï¼Œä¸ºäº†æ€§èƒ½ï¼Œåº•å±‚æ¸²æŸ“å›¾åƒæ—¶ä¸æ˜¯ä¸€ä¸ªåƒç´ ä¸€ä¸ªåƒç´ æ¸²æŸ“ï¼Œè€Œæ˜¯ä¸€å—ä¸€å—æ¸²æŸ“ï¼Œæ•°æ®æ˜¯ä¸€å—å—åœ°å–ï¼Œå°±å¯èƒ½é‡åˆ°è¿™ä¸€å—è¿ç»­çš„å†…å­˜æ•°æ®é‡Œç»“å°¾çš„æ•°æ®ä¸æ˜¯å›¾åƒçš„å†…å®¹ï¼Œæ˜¯å†…å­˜é‡Œå…¶ä»–çš„æ•°æ®ï¼Œå¯èƒ½è¶Šç•Œè¯»å–å¯¼è‡´ä¸€äº›å¥‡æ€ªçš„ä¸œè¥¿æ··å…¥ï¼Œæ‰€ä»¥åœ¨æ¸²æŸ“ä¹‹å‰CoreAnimationè¦æŠŠæ•°æ®æ‹·è´ä¸€ä»½è¿›è¡Œå¤„ç†ï¼Œç¡®ä¿æ¯ä¸€å—éƒ½æ˜¯å›¾åƒæ•°æ®ï¼Œå¯¹äºä¸è¶³ä¸€å—çš„æ•°æ®ç½®ç©ºã€‚å¤§è‡´å›¾ç¤ºï¼š(pixelæ˜¯å›¾åƒåƒç´ æ•°æ®ï¼Œdataæ˜¯å†…å­˜é‡Œå…¶ä»–æ•°æ®) å—çš„å¤§å°åº”è¯¥æ˜¯è·ŸCPU cache lineæœ‰å…³ï¼ŒARMv7æ˜¯32byteï¼ŒA9æ˜¯64byteï¼Œåœ¨A9ä¸‹CoreAnimationåº”è¯¥æ˜¯æŒ‰64byteä½œä¸ºä¸€å—æ•°æ®å»è¯»å–å’Œæ¸²æŸ“ï¼Œè®©å›¾åƒæ•°æ®å¯¹é½64byteå°±å¯ä»¥é¿å…CoreAnimationå†æ‹·è´ä¸€ä»½æ•°æ®è¿›è¡Œä¿®è¡¥ã€‚FastImageCacheåšçš„å­—èŠ‚å¯¹é½å°±æ˜¯è¿™ä¸ªäº‹æƒ…ã€‚ å®ç°FastImageCacheæŠŠåŒä¸ªç±»å‹å’Œå°ºå¯¸çš„å›¾åƒéƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œæ ¹æ®æ–‡ä»¶åç§»å–å•å¼ å›¾ç‰‡ï¼Œç±»ä¼¼webçš„cssé›ªç¢§å›¾ï¼Œè¿™é‡Œç§°ä¸ºImageTableã€‚è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿ç»Ÿä¸€ç®¡ç†å›¾ç‰‡ç¼“å­˜ï¼Œæ§åˆ¶ç¼“å­˜çš„å¤§å°ï¼Œæ•´ä¸ªFastImageCacheå°±æ˜¯åœ¨ç®¡ç†ä¸€ä¸ªä¸ªImageTableçš„æ•°æ®ã€‚æ•´ä½“å®ç°çš„æ•°æ®ç»“æ„å¦‚å›¾ï¼š ä¸€äº›è¡¥å……å’Œè¯´æ˜ï¼š ImageTable ä¸€ä¸ªImageFormatå¯¹åº”ä¸€ä¸ªImageTableï¼ŒImageFormatæŒ‡å®šäº†ImageTableé‡Œå›¾åƒæ¸²æŸ“æ ¼å¼/å¤§å°ç­‰ä¿¡æ¯ï¼ŒImageTableé‡Œçš„å›¾åƒæ•°æ®éƒ½ç”±ImageFormatè§„å®šäº†ç»Ÿä¸€çš„å°ºå¯¸ï¼Œæ¯å¼ å›¾åƒå¤§å°éƒ½æ˜¯ä¸€æ ·çš„ã€‚ ä¸€ä¸ªImageTableä¸€ä¸ªå®ä½“æ–‡ä»¶ï¼Œå¹¶æœ‰å¦ä¸€ä¸ªæ–‡ä»¶ä¿å­˜è¿™ä¸ªImageTableçš„metaä¿¡æ¯ã€‚ å›¾åƒä½¿ç”¨entityUUIDä½œä¸ºå”¯ä¸€æ ‡ç¤ºç¬¦ï¼Œç”±ç”¨æˆ·å®šä¹‰ï¼Œé€šå¸¸æ˜¯å›¾åƒurlçš„hashå€¼ã€‚ImageTable Metaçš„indexMapè®°å½•äº†entityUUID-&gt;entryIndexçš„æ˜ å°„ï¼Œé€šè¿‡indexMapå°±å¯ä»¥ç”¨å›¾åƒçš„entityUUIDæ‰¾åˆ°ç¼“å­˜æ•°æ®åœ¨ImageTableå¯¹åº”çš„ä½ç½®ã€‚ ImageTableEntry ImageTableçš„å®ä½“æ•°æ®æ˜¯ImageTableEntryï¼Œæ¯ä¸ªentryæœ‰ä¸¤éƒ¨åˆ†æ•°æ®ï¼Œä¸€éƒ¨åˆ†æ˜¯å¯¹é½åçš„å›¾åƒæ•°æ®ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯metaä¿¡æ¯ï¼Œmetaä¿å­˜è¿™å¼ å›¾åƒçš„UUIDå’ŒåŸå›¾UUIDï¼Œç”¨äºæ ¡éªŒå›¾åƒæ•°æ®çš„æ­£ç¡®æ€§ã€‚ Entryæ•°æ®æ˜¯æŒ‰å†…å­˜åˆ†é¡µå¤§å°å¯¹é½çš„ï¼Œæ•°æ®å¤§å°æ˜¯å†…å­˜åˆ†é¡µå¤§å°çš„æ•´æ•°å€ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è™šæ‹Ÿå†…å­˜ç¼ºé¡µåŠ è½½æ—¶ä½¿ç”¨æœ€å°‘çš„å†…å­˜é¡µåŠ è½½ä¸€å¼ å›¾åƒã€‚ å›¾åƒæ•°æ®åšäº†å­—èŠ‚å¯¹é½å¤„ç†ï¼ŒCoreAnimationä½¿ç”¨æ—¶æ— éœ€å†å¤„ç†æ‹·è´ã€‚å…·ä½“åšæ³•æ˜¯CGBitmapContextCreateåˆ›å»ºä½å›¾ç”»å¸ƒæ—¶bytesPerRowå‚æ•°ä¼ 64å€æ•°ã€‚ Chunk ImageTableå’Œå®ä½“æ•°æ®Entryé—´å¤šäº†å±‚Chunkï¼ŒChunkæ˜¯é€»è¾‘ä¸Šçš„æ•°æ®åˆ’åˆ†ï¼ŒNä¸ªEntryä½œä¸ºä¸€ä¸ªChunkï¼Œå†…å­˜æ˜ å°„mmapæ“ä½œæ˜¯ä»¥chunkä¸ºå•ä½çš„ï¼Œæ¯ä¸€ä¸ªchunkæ‰§è¡Œä¸€æ¬¡mmapæŠŠè¿™ä¸ªchunkçš„å†…å®¹æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ã€‚ä¸ºä»€ä¹ˆè¦å¤šä¸€å±‚chunkå‘¢ï¼ŒæŒ‰æˆ‘çš„ç†è§£ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†çµæ´»æ§åˆ¶mmapçš„å¤§å°å’Œè°ƒç”¨æ¬¡æ•°ï¼Œè‹¥å¯¹æ•´ä¸ªImageTableæ‰§è¡Œmmapï¼Œè½½å…¥è™šæ‹Ÿå†…å­˜çš„æ–‡ä»¶è¿‡å¤§ï¼Œè‹¥å¯¹æ¯ä¸ªEntryåšmmapï¼Œè°ƒç”¨æ¬¡æ•°ä¼šå¤ªå¤šã€‚ ç¼“å­˜ç®¡ç† ç”¨æˆ·å¯ä»¥å®šä¹‰æ•´ä¸ªImageTableé‡Œæœ€å¤§ç¼“å­˜çš„å›¾åƒæ•°é‡ï¼Œåœ¨æœ‰æ–°å›¾åƒéœ€è¦ç¼“å­˜æ—¶ï¼Œå¦‚æœç¼“å­˜æ²¡æœ‰è¶…è¿‡é™åˆ¶ï¼Œä¼šä»¥chunkä¸ºå•ä½æ‰©å±•æ–‡ä»¶å¤§å°ï¼Œé¡ºåºå†™ä¸‹å»ã€‚å¦‚æœå·²è¶…è¿‡æœ€å¤§ç¼“å­˜é™åˆ¶ï¼Œä¼šæŠŠæœ€å°‘ä½¿ç”¨çš„ç¼“å­˜æ›¿æ¢æ‰ï¼Œå®ç°æ–¹æ³•æ˜¯æ¯æ¬¡ä½¿ç”¨å›¾åƒéƒ½ä¼šæŠŠUUIDæ’å…¥åˆ°MRUEntriesæ•°ç»„çš„å¼€å¤´ï¼ŒMRUEntriesæŒ‰æœ€è¿‘ä½¿ç”¨é¡ºåºæ’åˆ—äº†å›¾åƒUUIDï¼Œæ•°ç»„é‡Œæœ€åä¸€ä¸ªå›¾åƒå°±æ˜¯æœ€å°‘ä½¿ç”¨çš„ã€‚è¢«æ›¿æ¢æ‰çš„å›¾ç‰‡ä¸‹æ¬¡éœ€è¦å†ä½¿ç”¨æ—¶ï¼Œå†èµ°ä¸€æ¬¡å–åŸå›¾â€”è§£å‹â€”å­˜å‚¨çš„æµç¨‹ã€‚ ä½¿ç”¨FastImageCacheé€‚åˆç”¨äºtableViewé‡Œç¼“å­˜æ¯ä¸ªcellä¸ŠåŒæ ·è§„æ ¼çš„å›¾åƒï¼Œä¼˜ç‚¹æ˜¯èƒ½æå¤§åŠ å¿«ç¬¬ä¸€æ¬¡ä»ç£ç›˜åŠ è½½è¿™äº›å›¾åƒçš„é€Ÿåº¦ã€‚ä½†å®ƒæœ‰ä¸¤ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼šä¸€æ˜¯å ç©ºé—´å¤§ã€‚å› ä¸ºç¼“å­˜äº†è§£ç åçš„ä½å›¾åˆ°ç£ç›˜ï¼Œä½å›¾æ˜¯å¾ˆå¤§çš„ï¼Œå®½é«˜100100çš„å›¾åƒåœ¨2xçš„é«˜æ¸…å±è®¾å¤‡ä¸‹å°±éœ€è¦200200*4byte/pixel=156KBï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆFastImageCacheè¦å¤§è´¹å‘¨ç« é™åˆ¶ç¼“å­˜å¤§å°ã€‚äºŒæ˜¯æ¥å£ä¸å‹å¥½ï¼Œéœ€é¢„å®šä¹‰å¥½ç¼“å­˜çš„å›¾åƒå°ºå¯¸ã€‚FastImageCacheæ— æ³•åƒSDWebImageé‚£æ ·æ— ç¼æ¥å…¥UIImageViewï¼Œä½¿ç”¨å®ƒéœ€è¦é…ç½®ImageTableï¼Œå®šä¹‰å¥½å°ºå¯¸ï¼Œæ‰‹åŠ¨æä¾›çš„åŸå›¾ï¼Œæ¯ç§å®ä½“å›¾åƒè¦å®šä¹‰ä¸€ä¸ªFICEntityæ¨¡å‹ï¼Œä½¿é€»è¾‘å˜å¤æ‚ã€‚ FastImageCacheå·²ç»å±äºæé™ä¼˜åŒ–ï¼Œåšå›¾åƒåŠ è½½/æ¸²æŸ“ä¼˜åŒ–æ—¶åº”è¯¥ä¼˜å…ˆè€ƒè™‘ä¸€äº›ä½ä»£ä»·é«˜å›æŠ¥çš„ä¼˜åŒ–ç‚¹ï¼Œä¾‹å¦‚CALayerä»£æ›¿UIImageVIewï¼Œå‡å°‘GPUè®¡ç®—ï¼ˆå»é€æ˜/åƒç´ å¯¹é½ï¼‰ï¼Œå›¾åƒå­çº¿ç¨‹è§£ç ï¼Œé¿å…Offscreen-Renderç­‰ã€‚åœ¨å…¶ä»–ä¼˜åŒ–éƒ½åšåˆ°ä½ï¼Œå›¾åƒçš„æ¸²æŸ“è¿˜æ˜¯æœ‰æ€§èƒ½é—®é¢˜çš„å‰æä¸‹æ‰è€ƒè™‘ä½¿ç”¨FastImageCacheè¿›ä¸€æ­¥æå‡é¦–æ¬¡åŠ è½½çš„æ€§èƒ½ï¼Œä¸è¿‡å­—èŠ‚å¯¹é½çš„ä¼˜åŒ–å€’æ˜¯å¯ä»¥è„±ç¦»FastImageCacheç›´æ¥è¿ç”¨åœ¨é¡¹ç›®ä¸Šï¼Œåªéœ€è¦åœ¨è§£ç å›¾åƒæ—¶bitmapç”»å¸ƒçš„bytesPerRowè®¾ä¸º64çš„å€æ•°å³å¯ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>FastImageCache</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[debug-_SwiftValue-unsignedIntegerValue]]></title>
    <url>%2Fdebug-SwiftValue-unsignedIntegerValue%2F</url>
    <content type="text"><![CDATA[crash:123456let attr = try? NSMutableAttributedString(data: data, options: [NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType, NSCharacterEncodingDocumentAttribute: String.Encoding.utf8], documentAttributes:nil)// log:2017-04-17 14:04:38.140 [41275:463875] -[_SwiftValue unsignedIntegerValue]: unrecognized selector sent to instance 0x608000256620 WTF! è¿™ä¸ªæ–¹æ³•å¯åŠ¨æ—¶ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œè¦å¼‚æ­¥ï¼Ÿ]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Debug</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RxSwiftè¯­æ³•ç¬”è®°]]></title>
    <url>%2Frx-dictionary%2F</url>
    <content type="text"><![CDATA[è®°å½•RxSwiftåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›å¸¸ç”¨è¯­æ³•ã€‚ è¯´æ˜æŒ‰ç…§RxSwift å…¥å‘æ‰‹å†Œ Part0 - åŸºç¡€æ¦‚å¿µæ ¼å¼è¿›è¡Œè¡¥å……ã€‚ SupportCodeåœ¨è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œå…ˆçœ‹ä¸‹é¡¹ç›®é‡Œçš„ SupportCode.swift ï¼Œä¸»è¦ä¸º playground æä¾›äº†ä¸¤ä¸ªä¾¿åˆ©å‡½æ•°ã€‚ ä¸€ä¸ªæ˜¯ example å‡½æ•°ï¼Œä¸“é—¨ç”¨æ¥å†™ç¤ºä¾‹ä»£ç çš„ï¼Œç»Ÿä¸€è¾“å‡º log ä¾¿äºæ ‡è®°æµè§ˆï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒå˜é‡ä¸æ±¡æŸ“å…¨å±€ï¼š 1234public func example(description: String, action: () -&gt; ()) &#123; print("\n--- \(description) example ---") action()&#125; å¦ä¸€ä¸ªæ˜¯ delay å‡½æ•°ï¼Œé€šè¿‡ dispatch_after ç”¨æ¥æ¼”ç¤ºå»¶æ—¶çš„ï¼š 12345678public func delay(delay:Double, closure:()-&gt;()) &#123; dispatch_after( dispatch_time( DISPATCH_TIME_NOW, Int64(delay * Double(NSEC_PER_SEC)) ), dispatch_get_main_queue(), closure)&#125; Introductionä¸»è¦ä»‹ç»äº† Rx çš„åŸºç¡€ï¼š Observable ã€‚ Observable&lt;Element&gt; æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ä¸­è¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸€ä¸ªäº‹ä»¶åºåˆ— (GeneratorType) ï¼Œä¼šå‘è®¢é˜…è€…å‘é€æ–°äº§ç”Ÿçš„äº‹ä»¶ä¿¡æ¯ã€‚äº‹ä»¶ä¿¡æ¯åˆ†ä¸ºä¸‰ç§ï¼š Next(value) è¡¨ç¤ºæ–°çš„äº‹ä»¶æ•°æ®ã€‚ Completed è¡¨ç¤ºäº‹ä»¶åºåˆ—çš„å®Œç»“ã€‚ Error åŒæ ·è¡¨ç¤ºå®Œç»“ï¼Œä½†æ˜¯ä»£è¡¨å¼‚å¸¸å¯¼è‡´çš„å®Œç»“ã€‚ï¼ˆæ‰“ä¸ªå²”ï¼šåè®®å‘½åï¼Œæƒ³èµ·æ¥ä¸Šåˆæ±¤å“¥åœ¨å¾®åšè¯´çš„ä¸€æ®µè¯ï¼š å¦å¤–ï¼Œæˆ‘è§‰å¾— protocol åå­—ç”¨å½¢å®¹è¯ä¼šæ›´åŠ è¯­ä¹‰åˆ†æ˜ï¼Œæ¯”å¦‚ Swift : Flyable, Killable, Visibleã€‚å…¨ç”¨åè¯çš„è¯æ˜¾å¾—æ¯”è¾ƒç”Ÿç¡¬ï¼Œæ¯”å¦‚ Swift : Head, Wings, Assã€‚ emptyempty æ˜¯ä¸€ä¸ªç©ºçš„åºåˆ—ï¼Œå®ƒåªå‘é€ .Completed æ¶ˆæ¯ã€‚ 123456789example("empty") &#123; let emptySequence: Observable&lt;Int&gt; = empty() let subscription = emptySequence .subscribe &#123; event in print(event) &#125;&#125;--- empty example ---Completed nevernever æ˜¯æ²¡æœ‰ä»»ä½•å…ƒç´ ã€ä¹Ÿä¸ä¼šå‘é€ä»»ä½•äº‹ä»¶çš„ç©ºåºåˆ—ã€‚ 123456789example("never") &#123; let neverSequence: Observable&lt;String&gt; = never() let subscription = neverSequence .subscribe &#123; _ in print("This block is never called.") &#125;&#125;--- never example --- justjust æ˜¯åªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„åºåˆ—ï¼Œå®ƒä¼šå…ˆå‘é€ .Next(value) ï¼Œç„¶åå‘é€ .Completed ã€‚ 1234567891011example("just") &#123; let singleElementSequence = just(32) let subscription = singleElementSequence .subscribe &#123; event in print(event) &#125;&#125;--- just example ---Next(32)CompletedsequenceOf sequenceOf å¯ä»¥æŠŠä¸€ç³»åˆ—å…ƒç´ è½¬æ¢æˆäº‹ä»¶åºåˆ—ã€‚ 1234567891011121314example("sequenceOf") &#123; let sequenceOfElements/* : Observable&lt;Int&gt; */ = sequenceOf(0, 1, 2, 3) let subscription = sequenceOfElements .subscribe &#123; event in print(event) &#125;&#125;--- sequenceOf example ---Next(0)Next(1)Next(2)Next(3)Completedfrom from æ˜¯é€šè¿‡ asObservable() æ–¹æ³•æŠŠ Swift ä¸­çš„åºåˆ— (SequenceType) è½¬æ¢æˆäº‹ä»¶åºåˆ—ã€‚ 1234567891011121314example("from") &#123; let sequenceFromArray = [1, 2, 3, 4, 5].asObservable() let subscription = sequenceFromArray .subscribe &#123; event in print(event) &#125;&#125;--- from example ---Next(1)Next(2)Next(3)Next(4)Next(5)Completed createcreate å¯ä»¥é€šè¿‡é—­åŒ…åˆ›å»ºåºåˆ—ï¼Œé€šè¿‡ .on(e: Event) æ·»åŠ äº‹ä»¶ã€‚ 12345678910111213141516example("create") &#123; let myJust = &#123; (singleElement: Int) -&gt; Observable&lt;Int&gt; in return create &#123; observer in observer.on(.Next(singleElement)) observer.on(.Completed) return NopDisposable.instance &#125; &#125; let subscription = myJust(5) .subscribe &#123; event in print(event) &#125;&#125;--- create example ---Next(5)Completed failWithfailWith åˆ›å»ºä¸€ä¸ªæ²¡æœ‰å…ƒç´ çš„åºåˆ—ï¼Œåªä¼šå‘é€å¤±è´¥ (.Error) äº‹ä»¶ã€‚ 12345678910example("failWith") &#123; let error = NSError(domain: "Test", code: -1, userInfo: nil) let erroredSequence: Observable&lt;Int&gt; = failWith(error) let subscription = erroredSequence .subscribe &#123; event in print(event) &#125;&#125;--- failWith example ---Error(Error Domain=Test Code=-1 "The operation couldnâ€™t be completed. (Test error -1.)") deferreddeferred ä¼šç­‰åˆ°æœ‰è®¢é˜…è€…çš„æ—¶å€™å†é€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»º Observable å¯¹è±¡ï¼Œæ¯ä¸ªè®¢é˜…è€…è®¢é˜…çš„å¯¹è±¡éƒ½æ˜¯å†…å®¹ç›¸åŒè€Œå®Œå…¨ç‹¬ç«‹çš„åºåˆ—ã€‚ 123456789101112131415161718192021222324252627282930313233example("deferred") &#123; let deferredSequence: Observable&lt;Int&gt; = deferred &#123; print("creating") return create &#123; observer in print("emmiting") observer.on(.Next(0)) observer.on(.Next(1)) observer.on(.Next(2)) return NopDisposable.instance &#125; &#125; print("go") deferredSequence .subscribe &#123; event in print(event) &#125; deferredSequence .subscribe &#123; event in print(event) &#125;&#125;--- deferred example ---gocreatingemmitingNext(0)Next(1)Next(2)creatingemmitingNext(0)Next(1)Next(2) ä¸ºä»€ä¹ˆéœ€è¦ defferd è¿™æ ·ä¸€ä¸ªå¥‡æ€ªçš„å®¶ä¼™å‘¢ï¼Ÿå…¶å®è¿™ç›¸å½“äºæ˜¯ä¸€ç§å»¶æ—¶åŠ è½½ï¼Œå› ä¸ºåœ¨æ·»åŠ ç›‘å¬çš„æ—¶å€™æ•°æ®æœªå¿…åŠ è½½å®Œæ¯•ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š 123456789101112example("TestDeferred") &#123; var value: String? = nil var subscription: Observable&lt;String?&gt; = just(value) // got value value = "Hello!" subscription.subscribe &#123; event in print(event) &#125;&#125;--- TestDeferred example ---Next(nil)Completed å¦‚æœä½¿ç”¨ deffered åˆ™å¯ä»¥æ­£å¸¸æ˜¾ç¤ºæƒ³è¦çš„æ•°æ®ï¼š 1234567891011121314example("TestDeferred") &#123; var value: String? = nil var subscription: Observable&lt;String?&gt; = deferred &#123; return just(value) &#125; // got value value = "Hello!" subscription.subscribe &#123; event in print(event) &#125;&#125;--- TestDeferred example ---Next(Optional("Hello!"))Completed Subjectsæ¥ä¸‹æ¥æ˜¯å…³äº Subject çš„å†…å®¹ã€‚ Subject å¯ä»¥çœ‹åšæ˜¯ä¸€ç§ä»£ç†å’Œæ¡¥æ¢ã€‚å®ƒæ—¢æ˜¯è®¢é˜…è€…åˆæ˜¯è®¢é˜…æºï¼Œè¿™æ„å‘³ç€å®ƒæ—¢å¯ä»¥è®¢é˜…å…¶ä»– Observable å¯¹è±¡ï¼ŒåŒæ—¶åˆå¯ä»¥å¯¹å®ƒçš„è®¢é˜…è€…ä»¬å‘é€äº‹ä»¶ã€‚ å¦‚æœæŠŠ Observable ç†è§£æˆä¸æ–­è¾“å‡ºäº‹ä»¶çš„æ°´ç®¡ï¼Œé‚£ Subject å°±æ˜¯å¥—åœ¨ä¸Šé¢çš„æ°´é¾™å¤´ã€‚å®ƒæ—¢æ€¼ç€ä¸€æ ¹ä¸æ–­å‡ºæ°´çš„æ°´ç®¡ï¼ŒåŒæ—¶ä¹Ÿå‘å¤–é¢è¾“é€ç€æ–°é²œæ°´æºã€‚å¦‚æœä½ ç›´æ¥ç”¨æ°´æ¯æ¥ç€æ°´ç®¡çš„æ°´ï¼Œé‚£å¯èƒ½å¯¼å‡ºæ¥ä»€ä¹ˆç‹æ°´èƒ¶æ°´å®Œå…¨æŠŠæŒä¸ä½ï¼›å¦‚æœä½ åœ¨æ°´é¾™å¤´ä¸‹é¢æ¥ç€æ°´ï¼Œé‚£ä½ å¯ä»¥éšå¿ƒæ‰€æ¬²çš„è°ƒæˆä½ æƒ³è¦çš„æ°´é€Ÿå’Œæ°´æ¸©ã€‚ ï¼ˆå¥½å§ä¸Šé¢ä¸€æ®µæ–‡æ¡£é‡Œæ²¡æœ‰ï¼Œæ˜¯æˆ‘çæ°çš„ï¼Œå¦‚æœç†è§£é”™äº†è¿˜æœ›æ‰“è„¸(ï¿£Îµ(#ï¿£)â˜†â•°â•®(ï¿£â–½ï¿£///)) åœ¨å¼€å§‹ä¸‹é¢çš„ä»£ç ä¹‹å‰ï¼Œå…ˆå®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ç”¨äºè¾“å‡ºæ•°æ®ï¼š 123456func writeSequenceToConsole&lt;O: ObservableType&gt;(name: String, sequence: O) &#123; sequence .subscribe &#123; e in print("Subscription: \(name), event: \(e)") &#125;&#125; PublishSubjectPublishSubject ä¼šå‘é€è®¢é˜…è€…ä»è®¢é˜…ä¹‹åçš„äº‹ä»¶åºåˆ—ã€‚ 12345678910111213141516example("PublishSubject") &#123; let subject = PublishSubject&lt;String&gt;() writeSequenceToConsole("1", sequence: subject) subject.on(.Next("a")) subject.on(.Next("b")) writeSequenceToConsole("2", sequence: subject) subject.on(.Next("c")) subject.on(.Next("d"))&#125;--- PublishSubject example ---Subscription: 1, event: Next(a)Subscription: 1, event: Next(b)Subscription: 1, event: Next(c)Subscription: 2, event: Next(c)Subscription: 1, event: Next(d)Subscription: 2, event: Next(d) ReplaySubjectReplaySubject åœ¨æ–°çš„è®¢é˜…å¯¹è±¡è®¢é˜…çš„æ—¶å€™ä¼šè¡¥å‘æ‰€æœ‰å·²ç»å‘é€è¿‡çš„æ•°æ®é˜Ÿåˆ—ï¼Œ bufferSize æ˜¯ç¼“å†²åŒºçš„å¤§å°ï¼Œå†³å®šäº†è¡¥å‘é˜Ÿåˆ—çš„æœ€å¤§å€¼ã€‚å¦‚æœ bufferSize æ˜¯1ï¼Œé‚£ä¹ˆæ–°çš„è®¢é˜…è€…å‡ºç°çš„æ—¶å€™å°±ä¼šè¡¥å‘ä¸Šä¸€ä¸ªäº‹ä»¶ï¼Œå¦‚æœæ˜¯2ï¼Œåˆ™è¡¥ä¸¤ä¸ªï¼Œä»¥æ­¤ç±»æ¨ã€‚ 1234567891011121314151617example("ReplaySubject") &#123; let subject = ReplaySubject&lt;String&gt;.create(bufferSize: 1) writeSequenceToConsole("1", sequence: subject) subject.on(.Next("a")) subject.on(.Next("b")) writeSequenceToConsole("2", sequence: subject) subject.on(.Next("c")) subject.on(.Next("d"))&#125;--- ReplaySubject example ---Subscription: 1, event: Next(a)Subscription: 1, event: Next(b)Subscription: 2, event: Next(b) // è¡¥äº†ä¸€ä¸ª bSubscription: 1, event: Next(c)Subscription: 2, event: Next(c)Subscription: 1, event: Next(d)Subscription: 2, event: Next(d) BehaviorSubjectBehaviorSubject åœ¨æ–°çš„è®¢é˜…å¯¹è±¡è®¢é˜…çš„æ—¶å€™ä¼šå‘é€æœ€è¿‘å‘é€çš„äº‹ä»¶ï¼Œå¦‚æœæ²¡æœ‰åˆ™å‘é€ä¸€ä¸ªé»˜è®¤å€¼ã€‚ 123456789101112131415161718example("BehaviorSubject") &#123; let subject = BehaviorSubject(value: "z") writeSequenceToConsole("1", sequence: subject) subject.on(.Next("a")) subject.on(.Next("b")) writeSequenceToConsole("2", sequence: subject) subject.on(.Next("c")) subject.on(.Completed)&#125;--- BehaviorSubject example ---Subscription: 1, event: Next(z)Subscription: 1, event: Next(a)Subscription: 1, event: Next(b)Subscription: 2, event: Next(b)Subscription: 1, event: Next(c)Subscription: 2, event: Next(c)Subscription: 1, event: CompletedSubscription: 2, event: Completed VariableVariable æ˜¯åŸºäº BehaviorSubject çš„ä¸€å±‚å°è£…ï¼Œå®ƒçš„ä¼˜åŠ¿æ˜¯ï¼šä¸ä¼šè¢«æ˜¾å¼ç»ˆç»“ã€‚å³ï¼šä¸ä¼šæ”¶åˆ° .Completed å’Œ .Error è¿™ç±»çš„ç»ˆç»“äº‹ä»¶ï¼Œå®ƒä¼šä¸»åŠ¨åœ¨ææ„çš„æ—¶å€™å‘é€ .Complete ã€‚ 1234567891011121314151617example("Variable") &#123; let variable = Variable("z") writeSequenceToConsole("1", sequence: variable) variable.value = "a" variable.value = "b" writeSequenceToConsole("2", sequence: variable) variable.value = "c"&#125;--- Variable example ---Subscription: 1, event: Next(z)Subscription: 1, event: Next(a)Subscription: 1, event: Next(b)Subscription: 2, event: Next(b)Subscription: 1, event: Next(c)Subscription: 2, event: Next(c)Subscription: 1, event: CompletedSubscription: 2, event: Completed Transformæˆ‘ä»¬å¯ä»¥å¯¹åºåˆ—åšä¸€äº›è½¬æ¢ï¼Œç±»ä¼¼äº Swift ä¸­ CollectionType çš„å„ç§è½¬æ¢ã€‚åœ¨ä»¥å‰çš„å‘ä¸­æ›¾ç»æåˆ°è¿‡ï¼Œå¯ä»¥å‚è€ƒï¼šå‡½æ•°å¼çš„å‡½æ•°ã€‚ mapmap å°±æ˜¯å¯¹æ¯ä¸ªå…ƒç´ éƒ½ç”¨å‡½æ•°åšä¸€æ¬¡è½¬æ¢ï¼ŒæŒ¨ä¸ªæ˜ å°„ä¸€éã€‚ 1234567891011example("map") &#123; let originalSequence = sequenceOf(1,2,3) originalSequence .map &#123; $0 * 2 &#125; .subscribe &#123; print($0) &#125;&#125;--- map example ---Next(2)Next(4)Next(6)Completed flatMapmap åœ¨åšè½¬æ¢çš„æ—¶å€™å¾ˆå®¹æ˜“å‡ºç°ã€å‡ç»´ã€çš„æƒ…å†µï¼Œå³ï¼šè½¬å˜ä¹‹åï¼Œä»ä¸€ä¸ªåºåˆ—å˜æˆäº†ä¸€ä¸ªåºåˆ—çš„åºåˆ—ã€‚ ä»€ä¹ˆæ˜¯ã€å‡ç»´ã€ï¼Ÿåœ¨é›†åˆä¸­æˆ‘ä»¬å¯ä»¥ä¸¾è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘æœ‰ä¸€ä¸ªå¥½å‹åˆ—è¡¨ [p1, p2, p3]ï¼Œé‚£ä¹ˆå¦‚æœè¦è·å–æˆ‘å¥½å‹çš„å¥½å‹çš„åˆ—è¡¨ï¼Œå¯ä»¥è¿™æ ·åšï¼š 1myFriends.map &#123; $0.getFriends() &#125; ç»“æœå°±æˆäº† [[p1-1, p1-2, p1-3], [p2-1], [p3-1, p3-2]] ï¼Œè¿™å°±æˆäº†å¥½å‹çš„å¥½å‹åˆ—è¡¨çš„åˆ—è¡¨äº†ã€‚è¿™å°±æ˜¯ä¸€ä¸ªã€å‡ç»´ã€çš„ä¾‹å­ã€‚ ï¼ˆä»¥ä¸Šå†…å®¹æ–‡æ¡£ä¸­ä¾æ—§æ²¡æœ‰ï¼Œä¾æ—§æ˜¯æˆ‘çæ°çš„ï¼Œä¾æ—§æ¬¢è¿æœ‰é”™è¯¯å½“é¢æ‰“è„¸(ï¿£Îµ(#ï¿£)â˜†â•°â•®(ï¿£â–½ï¿£///)) åœ¨ Swift ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ flatMap è¿‡æ»¤æ‰ map ä¹‹åçš„ nil ç»“æœã€‚åœ¨ Rx ä¸­ï¼Œ flatMap å¯ä»¥æŠŠä¸€ä¸ªåºåˆ—è½¬æ¢æˆä¸€ç»„åºåˆ—ï¼Œç„¶åå†æŠŠè¿™ä¸€ç»„åºåˆ—ã€æ‹æ‰ã€æˆä¸€ä¸ªåºåˆ—ã€‚ 12345678910111213141516171819202122example("flatMap") &#123; let sequenceInt = sequenceOf(1, 2, 3) let sequenceString = sequenceOf("A", "B", "--") sequenceInt .flatMap &#123; int in sequenceString &#125; .subscribe &#123; print($0) &#125;&#125;--- flatMap example ---Next(A)Next(B)Next(--)Next(A)Next(B)Next(--)Next(A)Next(B)Next(--)Completed scanscan æœ‰ç‚¹åƒ reduce ï¼Œå®ƒä¼šæŠŠæ¯æ¬¡çš„è¿ç®—ç»“æœç´¯ç§¯èµ·æ¥ï¼Œä½œä¸ºä¸‹ä¸€æ¬¡è¿ç®—çš„è¾“å…¥å€¼ã€‚ 123456789101112131415161718example("scan") &#123; let sequenceToSum = sequenceOf(0, 1, 2, 3, 4, 5) sequenceToSum .scan(0) &#123; acum, elem in acum + elem &#125; .subscribe &#123; print($0) &#125;&#125;--- scan example ---Next(0)Next(1)Next(3)Next(6)Next(10)Next(15)Completed Filteringé™¤äº†ä¸Šé¢çš„å„ç§è½¬æ¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹åºåˆ—è¿›è¡Œè¿‡æ»¤ã€‚ filterfilter åªä¼šè®©ç¬¦åˆæ¡ä»¶çš„å…ƒç´ é€šè¿‡ã€‚ 12345678910111213141516example("filter") &#123; let subscription = sequenceOf(0, 1, 2, 3, 4, 5, 6, 7, 8, 9) .filter &#123; $0 % 2 == 0 &#125; .subscribe &#123; print($0) &#125;&#125;--- filter example ---Next(0)Next(2)Next(4)Next(6)Next(8)Completed distinctUntilChangeddistinctUntilChanged ä¼šåºŸå¼ƒæ‰é‡å¤çš„äº‹ä»¶ã€‚ 1234567891011121314example("distinctUntilChanged") &#123; let subscription = sequenceOf(1, 2, 3, 1, 1, 4) .distinctUntilChanged() .subscribe &#123; print($0) &#125;&#125;--- distinctUntilChanged example ---Next(1)Next(2)Next(3)Next(1)Next(4)Completed taketake åªè·å–åºåˆ—ä¸­çš„å‰ n ä¸ªäº‹ä»¶ï¼Œåœ¨æ»¡è¶³æ•°é‡ä¹‹åä¼šè‡ªåŠ¨ .Completed ã€‚ 123456789101112example("take") &#123; let subscription = sequenceOf(1, 2, 3, 4, 5, 6) .take(3) .subscribe &#123; print($0) &#125;&#125;--- take example ---Next(1)Next(2)Next(3)Completed throttle VS. debouncethrottle å’Œ debounce ç›®çš„éƒ½æ˜¯æ§åˆ¶æŸä¸ªæ—¶é—´æ®µå†…äº‹ä»¶åºåˆ—çš„é€Ÿåº¦ã€‚ä½†æ˜¯åˆæœ‰å·®åˆ«ï¼š debounce : ç©ºé—²æ§åˆ¶ ç©ºé—²æ—¶é—´å¿…é¡» &gt;= å›ºå®šçš„æ—¶é—´ï¼Œäº‹ä»¶åºåˆ—æ‰ä¼šè¢«æ”¾è¡Œ throttle : é¢‘ç‡æ§åˆ¶ äº‹ä»¶åºåˆ—æ»¡è¶³ 1/delay æ‰ä¼šè¢«æ”¾è¡Œ ä¸€èˆ¬çš„æŒ‰é’®ç‚¹å‡»ã€ç”¨æˆ·è¾“å…¥ã€ç­‰éƒ½å±äºé¢‘ç‡æ§åˆ¶ï¼Œåº”è¯¥ä½¿ç”¨ throttle ã€‚ 1234567891011let searchResults = searchBar.rx.text.orEmpty .throttle(0.3, scheduler: MainScheduler.instance) .distinctUntilChanged() .flatMapLatest &#123; query -&gt; Observable&lt;[Repository]&gt; in if query.isEmpty &#123; return .just([]) &#125; return searchGitHub(query) .catchErrorJustReturn([]) &#125; .observeOn(MainScheduler.instance) Combiningè¿™éƒ¨åˆ†æ˜¯å…³äºåºåˆ—çš„è¿ç®—ï¼Œå¯ä»¥å°†å¤šä¸ªåºåˆ—æºè¿›è¡Œç»„åˆæ‹¼è£…æˆä¸€ä¸ªæ–°çš„äº‹ä»¶åºåˆ—ã€‚ startWithstartWith ä¼šåœ¨é˜Ÿåˆ—å¼€å§‹ä¹‹å‰æ’å…¥ä¸€ä¸ªäº‹ä»¶å…ƒç´ ã€‚ 12345678910111213example("startWith") &#123; let subscription = sequenceOf(4, 5, 6) .startWith(3) .subscribe &#123; print($0) &#125;&#125;--- startWith example ---Next(3)Next(4)Next(5)Next(6)Completed combineLatestå¦‚æœå­˜åœ¨ä¸¤æ¡äº‹ä»¶é˜Ÿåˆ—ï¼Œéœ€è¦åŒæ—¶ç›‘å¬ï¼Œé‚£ä¹ˆæ¯å½“æœ‰æ–°çš„äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼ŒcombineLatest ä¼šå°†æ¯ä¸ªé˜Ÿåˆ—çš„æœ€æ–°çš„ä¸€ä¸ªå…ƒç´ è¿›è¡Œåˆå¹¶ã€‚ 123456789101112131415161718example("combineLatest 1") &#123; let intOb1 = PublishSubject&lt;String&gt;() let intOb2 = PublishSubject&lt;Int&gt;() combineLatest(intOb1, intOb2) &#123; "\($0) \($1)" &#125; .subscribe &#123; print($0) &#125; intOb1.on(.Next("A")) intOb2.on(.Next(1)) intOb1.on(.Next("B")) intOb2.on(.Next(2))&#125;--- combineLatest 1 example ---Next(A 1)Next(B 1)Next(B 2) zipzip äººå¦‚å…¶åï¼Œå°±æ˜¯åˆå¹¶ä¸¤æ¡é˜Ÿåˆ—ç”¨çš„ï¼Œä¸è¿‡å®ƒä¼šç­‰åˆ°ä¸¤ä¸ªé˜Ÿåˆ—çš„å…ƒç´ ä¸€ä¸€å¯¹åº”åœ°å‡‘é½äº†ä¹‹åå†åˆå¹¶ï¼Œæ­£å¦‚ç™¾æŠ˜ä¸æ’“çš„ç±³æ–¯ç‰¹èœæ‰€æé†’çš„ï¼Œ zip å°±åƒæ˜¯æ‹‰é“¾ä¸€æ ·ï¼Œä¸¤æ ¹æ‹‰é“¾æ‹‰ç€æ‹‰ç€åˆå¹¶åˆ°äº†ä¸€æ ¹ä¸Šï¼š 123456789101112131415161718example("zip 1") &#123; let intOb1 = PublishSubject&lt;String&gt;() let intOb2 = PublishSubject&lt;Int&gt;() zip(intOb1, intOb2) &#123; "\($0) \($1)" &#125; .subscribe &#123; print($0) &#125; intOb1.on(.Next("A")) intOb2.on(.Next(1)) intOb1.on(.Next("B")) intOb1.on(.Next("C")) intOb2.on(.Next(2))&#125;--- zip 1 example ---Next(A 1)Next(B 2) mergemerge å°±æ˜¯ merge å•¦ï¼ŒæŠŠä¸¤ä¸ªé˜Ÿåˆ—æŒ‰ç…§é¡ºåºç»„åˆåœ¨ä¸€èµ·ã€‚ 1234567891011121314151617181920example("merge 1") &#123; let subject1 = PublishSubject&lt;Int&gt;() let subject2 = PublishSubject&lt;Int&gt;() sequenceOf(subject1, subject2) .merge() .subscribeNext &#123; int in print(int) &#125; subject1.on(.Next(1)) subject1.on(.Next(2)) subject2.on(.Next(3)) subject1.on(.Next(4)) subject2.on(.Next(5))&#125;--- merge 1 example ---12345 switchå½“ä½ çš„äº‹ä»¶åºåˆ—æ˜¯ä¸€ä¸ªäº‹ä»¶åºåˆ—çš„åºåˆ— (Observable&lt;Observable&lt;T&gt;&gt;) çš„æ—¶å€™ï¼Œï¼ˆå¯ä»¥ç†è§£æˆäºŒç»´åºåˆ—ï¼Ÿï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ switch å°†åºåˆ—çš„åºåˆ—å¹³é“ºæˆä¸€ç»´ï¼Œå¹¶ä¸”åœ¨å‡ºç°æ–°çš„åºåˆ—çš„æ—¶å€™ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°æœ€æ–°çš„é‚£ä¸ªåºåˆ—ä¸Šã€‚å’Œ merge ç›¸ä¼¼çš„æ˜¯ï¼Œå®ƒä¹Ÿæ˜¯èµ·åˆ°äº†å°†å¤šä¸ªåºåˆ—ã€æ‹å¹³ã€æˆä¸€æ¡åºåˆ—çš„ä½œç”¨ã€‚ 12345678910111213141516171819202122232425262728293031example("switchLatest") &#123; let var1 = Variable(0) let var2 = Variable(200) // var3 is like an Observable&lt;Observable&lt;Int&gt;&gt; let var3 = Variable(var1) let d = var3 .switchLatest() .subscribe &#123; print($0) &#125; var1.value = 1 var1.value = 2 var1.value = 3 var1.value = 4 var3.value = var2 var2.value = 201 var1.value = 5 var3.value = var1 var2.value = 202 var1.value = 6&#125;--- switchLatest example ---Next(0)Next(1)Next(2)Next(3)Next(4)Next(200)Next(201)Next(5)Next(6) æ³¨æ„ï¼Œè™½ç„¶éƒ½æ˜¯ã€æ‹å¹³ã€ï¼Œä½†æ˜¯å’Œ flatmap æ˜¯ä¸åŒçš„ï¼Œ flatmap æ˜¯å°†ä¸€æ¡åºåˆ—å˜æˆå¦ä¸€æ¡åºåˆ—ï¼Œè€Œè¿™å˜æ¢è¿‡ç¨‹ä¼šè®©ç»´åº¦å˜é«˜ï¼Œæ‰€ä»¥éœ€è¦ã€æ‹å¹³ã€ï¼Œè€Œ switch æ˜¯å°†æœ¬æ¥äºŒç»´çš„åºåˆ—ï¼ˆåºåˆ—çš„åºåˆ—ï¼‰æ‹å¹³æˆäº†ä¸€ç»´çš„åºåˆ—ã€‚ Error Handlingåœ¨äº‹ä»¶åºåˆ—ä¸­ï¼Œé‡åˆ°å¼‚å¸¸ä¹Ÿæ˜¯å¾ˆæ­£å¸¸çš„äº‹æƒ…ï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¤„ç†å¼‚å¸¸çš„æ‰‹æ®µã€‚ catchErrorcatchError å¯ä»¥æ•è·å¼‚å¸¸äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨åé¢æ— ç¼æ¥ä¸Šå¦ä¸€æ®µäº‹ä»¶åºåˆ—ï¼Œä¸æ¯«æ²¡æœ‰å¼‚å¸¸çš„ç—•è¿¹ã€‚ 1234567891011121314151617181920example("catchError 1") &#123; let sequenceThatFails = PublishSubject&lt;Int&gt;() let recoverySequence = sequenceOf(100, 200) sequenceThatFails .catchError &#123; error in return recoverySequence &#125; .subscribe &#123; print($0) &#125; sequenceThatFails.on(.Next(1)) sequenceThatFails.on(.Next(2)) sequenceThatFails.on(.Error(NSError(domain: "Test", code: 0, userInfo: nil)))&#125;--- catchError 1 example ---Next(1)Next(2)Next(100)Next(200)Completed retryretry é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨å‡ºç°å¼‚å¸¸çš„æ—¶å€™ä¼šå†å»ä»å¤´è®¢é˜…äº‹ä»¶åºåˆ—ï¼Œå¦„å›¾é€šè¿‡ã€ä»å¤´å†æ¥ã€è§£å†³å¼‚å¸¸ã€‚ 123456789101112131415161718192021222324252627example("retry") &#123; var count = 1 // bad practice, only for example purposes let funnyLookingSequence: Observable&lt;Int&gt; = create &#123; observer in let error = NSError(domain: "Test", code: 0, userInfo: nil) observer.on(.Next(0)) observer.on(.Next(1)) if count &lt; 2 &#123; observer.on(.Error(error)) count++ &#125; observer.on(.Next(2)) observer.on(.Completed) return NopDisposable.instance &#125; funnyLookingSequence .retry() .subscribe &#123; print($0) &#125;&#125;--- retry example ---Next(0)Next(1)Next(0)Next(1)Next(2)Completed Utilityè¿™é‡Œåˆ—ä¸¾äº†é’ˆå¯¹äº‹ä»¶åºåˆ—çš„ä¸€äº›æ–¹æ³•ã€‚ subscribesubscribe åœ¨å‰é¢å·²ç»æ¥è§¦è¿‡äº†ï¼Œæœ‰æ–°çš„äº‹ä»¶å°±ä¼šè§¦å‘ã€‚ 123456789101112example("subscribe") &#123; let sequenceOfInts = PublishSubject&lt;Int&gt;() sequenceOfInts .subscribe &#123; print($0) &#125; sequenceOfInts.on(.Next(1)) sequenceOfInts.on(.Completed)&#125;--- subscribe example ---Next(1)Completed subscribeNextsubscribeNext ä¹Ÿæ˜¯è®¢é˜…ï¼Œä½†æ˜¯åªè®¢é˜… .Next äº‹ä»¶ã€‚ 1234567891011example("subscribeNext") &#123; let sequenceOfInts = PublishSubject&lt;Int&gt;() sequenceOfInts .subscribeNext &#123; print($0) &#125; sequenceOfInts.on(.Next(1)) sequenceOfInts.on(.Completed)&#125;--- subscribeNext example ---1 subscribeCompletedsubscribeCompleted æ˜¯åªè®¢é˜… .Completed å®Œæˆäº‹ä»¶ã€‚ 1234567891011example("subscribeCompleted") &#123; let sequenceOfInts = PublishSubject&lt;Int&gt;() sequenceOfInts .subscribeCompleted &#123; print("It's completed") &#125; sequenceOfInts.on(.Next(1)) sequenceOfInts.on(.Completed)&#125;--- subscribeCompleted example ---It's completed subscribeErrorsubscribeError åªè®¢é˜… .Error å¤±è´¥äº‹ä»¶ã€‚ 1234567891011example("subscribeError") &#123; let sequenceOfInts = PublishSubject&lt;Int&gt;() sequenceOfInts .subscribeError &#123; error in print(error) &#125; sequenceOfInts.on(.Next(1)) sequenceOfInts.on(.Error(NSError(domain: "Examples", code: -1, userInfo: nil)))&#125;--- subscribeError example ---Error Domain=Examples Code=-1 "The operation couldnâ€™t be completed. (Examples error -1.)" doOndoOn å¯ä»¥ç›‘å¬äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨äº‹ä»¶å‘ç”Ÿä¹‹å‰è°ƒç”¨ã€‚ 1234567891011121314151617example("doOn") &#123; let sequenceOfInts = PublishSubject&lt;Int&gt;() sequenceOfInts .doOn &#123; print("Intercepted event \($0)") &#125; .subscribe &#123; print($0) &#125; sequenceOfInts.on(.Next(1)) sequenceOfInts.on(.Completed)&#125;--- doOn example ---Intercepted event Next(1)Next(1)Intercepted event CompletedCompleted Conditionalæˆ‘ä»¬å¯ä»¥å¯¹å¤šä¸ªäº‹ä»¶åºåˆ—åšä¸€äº›å¤æ‚çš„é€»è¾‘åˆ¤æ–­ã€‚ takeUntiltakeUntil å…¶å®å°±æ˜¯ take ï¼Œå®ƒä¼šåœ¨ç»ˆäºç­‰åˆ°é‚£ä¸ªäº‹ä»¶ä¹‹åè§¦å‘ .Completed äº‹ä»¶ã€‚ 1234567891011121314151617example("takeUntil") &#123; let originalSequence = PublishSubject&lt;Int&gt;() let whenThisSendsNextWorldStops = PublishSubject&lt;Int&gt;() originalSequence .takeUntil(whenThisSendsNextWorldStops) .subscribe &#123; print($0) &#125; originalSequence.on(.Next(1)) originalSequence.on(.Next(2)) whenThisSendsNextWorldStops.on(.Next(1)) originalSequence.on(.Next(3))&#125;--- takeUntil example ---Next(1)Next(2)Completed takeWhiletakeWhile åˆ™æ˜¯å¯ä»¥é€šè¿‡çŠ¶æ€è¯­å¥åˆ¤æ–­æ˜¯å¦ç»§ç»­ take ã€‚ 12345678910111213141516example("takeWhile") &#123; let sequence = PublishSubject&lt;Int&gt;() sequence .takeWhile &#123; int in int &lt; 2 &#125; .subscribe &#123; print($0) &#125; sequence.on(.Next(1)) sequence.on(.Next(2)) sequence.on(.Next(3))&#125;--- takeWhile example ---Next(1)Completed Aggregateæˆ‘ä»¬å¯ä»¥å¯¹äº‹ä»¶åºåˆ—åšä¸€äº›é›†åˆè¿ç®—ã€‚ concatconcat å¯ä»¥æŠŠå¤šä¸ªäº‹ä»¶åºåˆ—åˆå¹¶èµ·æ¥ã€‚ 12345678910111213141516171819202122232425example("concat") &#123; let var1 = BehaviorSubject(value: 0) let var2 = BehaviorSubject(value: 200) // var3 is like an Observable&lt;Observable&lt;Int&gt;&gt; let var3 = BehaviorSubject(value: var1) let d = var3 .concat() .subscribe &#123; print($0) &#125; var1.on(.Next(1)) var1.on(.Next(2)) var3.on(.Next(var2)) var2.on(.Next(201)) var1.on(.Next(3)) var1.on(.Completed) var2.on(.Next(202))&#125;--- concat example ---Next(0)Next(1)Next(2)Next(3)Next(201)Next(202) reduceè¿™é‡Œçš„ reduce å’Œ CollectionType ä¸­çš„ reduce æ˜¯ä¸€ä¸ªæ„æ€ï¼Œéƒ½æ˜¯æŒ‡é€šè¿‡å¯¹ä¸€ç³»åˆ—æ•°æ®çš„è¿ç®—æœ€åç”Ÿæˆä¸€ä¸ªç»“æœã€‚ 12345678910example("reduce") &#123; sequenceOf(0, 1, 2, 3, 4, 5, 6, 7, 8, 9) .reduce(0, +) .subscribe &#123; print($0) &#125;&#125;--- reduce example ---Next(45)Completed Connectableå‘å¾…å¡«ï¼ŒXcode é‡Œè¿™ä¸ªæ“åœºè·‘ä¸èµ·æ¥äº†ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å“åº”å¼ç¼–ç¨‹</tag>
        <tag>RxSwift</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sonarqube-note]]></title>
    <url>%2Fsonarqube-note%2F</url>
    <content type="text"><![CDATA[æ­¥éª¤Get Started in Two Minutes Download and unzip the SonarQube distribution (letâ€™s say in â€œC:\sonarqubeâ€ or â€œ/etc/sonarqubeâ€) Start the SonarQube server: 12345# On Windows, execute:C:\sonarqube\bin\windows-x86-xx\StartSonar.bat # On other operating system, execute:/etc/sonarqube/bin/[OS]/sonar.sh console Download and unzip the SonarQube Scanner (letâ€™s say in â€œC:\sonar-scannerâ€ or â€œ/etc/sonar-scannerâ€) Download and unzip some project samples (letâ€™s say in â€œC:\sonar-scanning-examplesâ€ or â€œ/etc/sonar-scanning-examplesâ€) Analyze a project: 1234567# On Windows:cd C:\sonar-scanning-examples\sonarqube-scannerC:\sonar-scanner\bin\sonar-scanner.bat # On other operating system:cd /etc/sonar-scanning-examples/sonarqube-scanner/etc/sonar-scanner/bin/sonar-scanner Browse the results at http://localhost:9000 (default System administrator credentials are admin/admin) æ–‡æ¡£ docs.sonarqube.org]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>Sonarqube</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Œè½¬ã€çœŸå®ä¸–ç•Œä¸­çš„ Swift æ€§èƒ½ä¼˜åŒ–]]></title>
    <url>%2Freal-world-swift-performance%2F</url>
    <content type="text"><![CDATA[åŸæ–‡é“¾æ¥ï¼šçœŸå®ä¸–ç•Œä¸­çš„ Swift æ€§èƒ½ä¼˜åŒ– æœ‰å¤ªå¤šçš„å› ç´ ä¼šå¯¼è‡´æ‚¨çš„åº”ç”¨å˜å¾—ç¼“æ…¢ã€‚åœ¨æœ¬æ¬¡è®²æ¼”ä¸­ï¼Œæˆ‘ä»¬å°†è‡ªåº•å‘ä¸Šåœ°æ¥æ¢ç´¢åº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–ã€‚æ¥çœ‹ä¸€çœ‹åœ¨çœŸå®ä¸–ç•Œä¸­è¿›è¡Œæ•°æ®è§£æã€æ•°æ®æ˜ å°„å’Œæ•°æ®å­˜å‚¨çš„æ—¶å€™ï¼ŒSwift çš„ç‰¹æ€§ï¼ˆåè®®ã€æ³›å‹ã€ç»“æ„ä½“å’Œç±»ï¼‰æ˜¯å¦‚ä½•å½±å“åº”ç”¨æ€§èƒ½çš„ï¼Œæˆ‘ä»¬å°†ç¡®å®šå½±å“æ€§èƒ½æå‡çš„ç“¶é¢ˆæ‰€åœ¨ï¼Œå¹¶ä½“éªŒ Swift å¸¦æ¥çš„ã€Œè¿…æ·ã€ä½“éªŒã€‚ æ¦‚è¿°ä»Šå¤©æˆ‘æ‰“ç®—åŒå¤§å®¶è°ˆè®º Swift æ€§èƒ½ä¼˜åŒ–æ–¹é¢çš„å†…å®¹ã€‚å½“æˆ‘ä»¬æ„å»ºè½¯ä»¶çš„æ—¶å€™ï¼Œç‰¹åˆ«æ˜¯ç§»åŠ¨è½¯ä»¶ï¼Œç”±äºäººä»¬çš„ç²¾åŠ›ã€æ—¶é—´æœ‰é™ï¼Œäººä»¬å¾€å¾€æ›´å–œæ¬¢æœ‰ä¸€ä¸ªæµç•…çš„ç”¨æˆ·ä½“éªŒï¼Œè€Œä¸æ˜¯ç­‰ç€æ‚¨çš„åº”ç”¨åœ¨é‚£åŠ è½½ã€‚å¦‚æœåº”ç”¨è¿è¡Œé€Ÿåº¦è¿‡æ…¢ï¼Œå¹¶ä¸”ä¸èƒ½ç»™ç”¨æˆ·å¸¦æ¥ä»–ä»¬æ‰€æƒ³è¦çš„ç»“æœçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¼šè®©äººä»¬æ„Ÿåˆ°ä¸çˆ½ã€‚å› æ­¤ï¼Œè®©æ‚¨çš„ä»£ç èƒ½å¤Ÿå¿«é€Ÿè¿è¡Œæ˜¯æ— æ¯”é‡è¦çš„ä¸€ä»¶äº‹ã€‚ é‚£ä¹ˆæœ‰ä»€ä¹ˆå› ç´ ä¼šå¯¼è‡´ä»£ç è¿è¡Œç¼“æ…¢å‘¢ï¼Ÿå½“æ‚¨åœ¨ç¼–å†™ä»£ç å¹¶é€‰æ‹©æ¶æ„çš„æ—¶å€™ï¼Œæ·±åˆ»è®¤è¯†åˆ°è¿™äº›æ¶æ„æ‰€å¸¦æ¥çš„å½±å“æ˜¯éå¸¸é‡è¦çš„ã€‚æˆ‘å°†é¦–å…ˆè°ˆä¸€è°ˆï¼šå¦‚ä½•ç†è§£å†…è”ã€åŠ¨æ€è°ƒåº¦ä¸é™æ€è°ƒåº¦ä¹‹é—´çš„æƒè¡¡ï¼Œä»¥åŠç›¸å…³ç»“æ„æ˜¯å¦‚ä½•åˆ†é…å†…å­˜çš„ï¼Œè¿˜æœ‰æ€æ ·é€‰æ‹©æœ€é€‚åˆçš„æ¶æ„ã€‚ å†…å­˜åˆ†é…å¯¹è±¡çš„å†…å­˜åˆ†é… (allocation) å’Œå†…å­˜é‡Šæ”¾ (deallocation) æ˜¯ä»£ç ä¸­æœ€å¤§çš„å¼€é”€ä¹‹ä¸€ï¼ŒåŒæ—¶é€šå¸¸ä¹Ÿæ˜¯ä¸å¯é¿å…çš„ã€‚Swift ä¼šè‡ªè¡Œåˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼Œæ­¤å¤–å®ƒå­˜åœ¨ä¸¤ç§ç±»å‹çš„åˆ†é…æ–¹å¼ã€‚ ç¬¬ä¸€ä¸ªæ˜¯åŸºäºæ ˆ (stack-based) çš„å†…å­˜åˆ†é…ã€‚Swift ä¼šå°½å¯èƒ½é€‰æ‹©åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ã€‚æ ˆæ˜¯ä¸€ç§éå¸¸ç®€å•çš„æ•°æ®ç»“æ„ï¼›æ•°æ®ä»æ ˆçš„åº•éƒ¨æ¨å…¥ (push)ï¼Œä»æ ˆçš„é¡¶éƒ¨å¼¹å‡º (pop)ã€‚ç”±äºæˆ‘ä»¬åªèƒ½å¤Ÿä¿®æ”¹æ ˆçš„æœ«ç«¯ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘æ ˆæœ«ç«¯çš„æŒ‡é’ˆæ¥å®ç°è¿™ç§æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”åœ¨å…¶ä¸­è¿›è¡Œå†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾åªéœ€è¦é‡æ–°åˆ†é…è¯¥æ•´æ•°å³å¯ã€‚ ç¬¬äºŒä¸ªæ˜¯åŸºäºå † (heap-based) çš„å†…å­˜åˆ†é…ã€‚è¿™ä½¿å¾—å†…å­˜åˆ†é…å°†å…·å¤‡æ›´åŠ åŠ¨æ€çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†æ˜¯è¿™éœ€è¦æ›´ä¸ºå¤æ‚çš„æ•°æ®ç»“æ„ã€‚è¦åœ¨å †ä¸Šè¿›è¡Œå†…å­˜åˆ†é…çš„è¯ï¼Œæ‚¨éœ€è¦é”å®šå †å½“ä¸­çš„ä¸€ä¸ªç©ºé—²å— (free block)ï¼Œå…¶å¤§å°èƒ½å¤Ÿå®¹çº³æ‚¨çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœªä½¿ç”¨çš„å—ï¼Œç„¶ååœ¨å…¶ä¸­åˆ†é…å†…å­˜ã€‚å½“æˆ‘ä»¬éœ€è¦é‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¿…é¡»æœç´¢ä½•å¤„èƒ½å¤Ÿé‡æ–°æ’å…¥è¯¥å†…å­˜å—ã€‚è¿™ä¸ªæ“ä½œå¾ˆç¼“æ…¢ã€‚ä¸»è¦æ˜¯ä¸ºäº†çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬å¿…é¡»è¦å¯¹è¿™äº›ä¸œè¥¿è¿›è¡Œé”å®šå’ŒåŒæ­¥ã€‚ å¼•ç”¨è®¡æ•°æˆ‘ä»¬è¿˜æœ‰å¼•ç”¨è®¡æ•° (reference counting) çš„æ¦‚å¿µï¼Œè¿™ä¸ªæ“ä½œç›¸å¯¹ä¸æ€ä¹ˆè€—è´¹æ€§èƒ½ï¼Œä½†æ˜¯ç”±äºä½¿ç”¨æ¬¡æ•°å¾ˆå¤šï¼Œå› æ­¤å®ƒå¸¦æ¥çš„æ€§èƒ½å½±å“ä»ç„¶æ˜¯å¾ˆå¤§çš„ã€‚å¼•ç”¨è®¡æ•°æ˜¯ Objective-C å’Œ Swift ä¸­ç”¨äºç¡®å®šä½•æ—¶è¯¥é‡Šæ”¾å¯¹è±¡çš„å®‰å…¨æœºåˆ¶ã€‚ç›®å‰ï¼ŒSwift å½“ä¸­çš„å¼•ç”¨è®¡æ•°æ˜¯å¼ºåˆ¶è‡ªåŠ¨ç®¡ç†çš„ï¼Œè¿™æ„å‘³ç€å®ƒå¾ˆå®¹æ˜“è¢«å¼€å‘è€…ä»¬æ‰€å¿½ç•¥ã€‚ç„¶è€Œï¼Œå½“æ‚¨æ‰“å¼€ Instrument æŸ¥çœ‹ä½•å¤„å½±å“äº†ä»£ç è¿è¡Œçš„é€Ÿåº¦çš„æ—¶å€™ï¼Œæ‚¨ä¼šå‘ç° 20,000 å¤šæ¬¡çš„ Swift æŒæœ‰ (retain) å’Œé‡Šæ”¾ (release)ï¼Œè¿™äº›æ“ä½œå ç”¨äº† 90% çš„ä»£ç è¿è¡Œæ—¶é—´ï¼123func perform(with object: Object) &#123; object.doAThing()&#125; è¿™æ˜¯å› ä¸ºå¦‚æœæœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°æ¥æ”¶äº†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”æ‰§è¡Œäº†è¿™ä¸ªå¯¹è±¡çš„ doAThing() æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ’å…¥å¯¹è±¡æŒæœ‰å’Œé‡Šæ”¾æ“ä½œï¼Œä»¥ç¡®ä¿åœ¨è¿™ä¸ªæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸå½“ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä¼šè¢«å›æ”¶æ‰ã€‚12345func perform(with object: Object) &#123; __swift_retain(object) object.doAThing() __swift_release(object)&#125; è¿™äº›å¯¹è±¡æŒæœ‰å’Œé‡Šæ”¾æ“ä½œæ˜¯åŸå­æ“ä½œ (atomic operations)ï¼Œæ‰€ä»¥å®ƒä»¬è¿è½¬ç¼“æ…¢å°±å¾ˆæ­£å¸¸äº†ã€‚æˆ–è€…ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“å¦‚ä½•è®©å®ƒä»¬èƒ½å¤Ÿè¿è¡Œå¾—æ›´å¿«ä¸€äº›ã€‚ è°ƒåº¦ä¸å¯¹è±¡æ­¤å¤–è¿˜æœ‰è°ƒåº¦ (dispatch) çš„æ¦‚å¿µã€‚Swift æ‹¥æœ‰ä¸‰ç§ç±»å‹çš„è°ƒåº¦æ–¹å¼ã€‚Swift ä¼šå°½å¯èƒ½å°†å‡½æ•°å†…è” (inline)ï¼Œè¿™æ ·çš„è¯ä½¿ç”¨è¿™ä¸ªå‡½æ•°å°†ä¸ä¼šæœ‰é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚é™æ€è°ƒåº¦ (static dispatch) æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ V-table è¿›è¡Œçš„æŸ¥æ‰¾å’Œè·³è½¬ï¼Œè¿™ä¸ªæ“ä½œä¼šèŠ±è´¹ä¸€çº³ç§’çš„æ—¶é—´ã€‚ç„¶ååŠ¨æ€è°ƒåº¦ (dynamic dispatch) å°†ä¼šèŠ±è´¹å¤§æ¦‚äº”çº³ç§’çš„æ—¶é—´ï¼Œå¦‚æœæ‚¨åªæœ‰å‡ ä¸ªè¿™æ ·çš„æ–¹æ³•è°ƒç”¨çš„è¯ï¼Œè¿™å®é™…ä¸Šå¹¶ä¸ä¼šå¸¦æ¥å¤šå¤§çš„é—®é¢˜ï¼Œé—®é¢˜æ˜¯å½“æ‚¨åœ¨ä¸€ä¸ªåµŒå¥—å¾ªç¯æˆ–è€…æ‰§è¡Œä¸Šåƒæ¬¡æ“ä½œå½“ä¸­ä½¿ç”¨äº†åŠ¨æ€è°ƒåº¦çš„è¯ï¼Œé‚£ä¹ˆå®ƒæ‰€å¸¦æ¥çš„æ€§èƒ½è€—è´¹å°†æˆç™¾ä¸Šåƒåœ°ç´¯ç§¯èµ·æ¥ï¼Œæœ€ç»ˆå½±å“åº”ç”¨æ€§èƒ½ã€‚ Swift åŒæ ·ä¹Ÿæœ‰ä¸¤ç§ç±»å‹çš„å¯¹è±¡ã€‚1234567class Index &#123; let section: Int let item: Int&#125;let i = Index(section: 1, item: 1) è¿™æ˜¯ä¸€ä¸ªç±»ï¼Œç±»å½“ä¸­çš„æ•°æ®éƒ½ä¼šåœ¨å †ä¸Šåˆ†é…å†…å­˜ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º Index çš„ç±»ã€‚å…¶ä¸­åŒ…å«äº†ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ª section å’Œä¸€ä¸ª itemã€‚å½“æˆ‘ä»¬åˆ›å»ºäº†è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå †ä¸Šä¾¿åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘æ­¤ Index çš„æŒ‡é’ˆï¼Œå› æ­¤åœ¨å †ä¸Šä¾¿å­˜æ”¾äº†è¿™ä¸ª section å’Œ item çš„æ•°æ®å’Œç©ºé—´ã€‚ å¦‚æœæˆ‘ä»¬å¯¹å…¶å»ºç«‹å¼•ç”¨ï¼Œå°±ä¼šå‘ç°æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªæŒ‡å‘å †ä¸Šç›¸åŒåŒºåŸŸçš„æŒ‡é’ˆäº†ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯å…±äº«å†…å­˜çš„ã€‚123456789class Index &#123; let section: Int let item: Int&#125;let i = Index(section: 1, item: 1)let i2 = i è¿™ä¸ªæ—¶å€™ï¼ŒSwift ä¼šè‡ªåŠ¨æ’å…¥å¯¹è±¡æŒæœ‰æ“ä½œã€‚12345678910class Index &#123; let section: Int let item: Int&#125;let i = Index(section: 1, item: 1)__swift_retain(i)let i2 = i ç»“æ„ä½“å¾ˆå¤šäººéƒ½ä¼šè¯´ï¼šè¦ç¼–å†™æ€§èƒ½ä¼˜å¼‚çš„ Swift ä»£ç ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ç»“æ„ä½“äº†ï¼Œç»“æ„ä½“é€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»“æ„ï¼Œå› ä¸ºç»“æ„ä½“ä¼šå­˜å‚¨åœ¨æ ˆä¸Šï¼Œå¹¶ä¸”é€šå¸¸ä¼šä½¿ç”¨é™æ€è°ƒåº¦æˆ–è€…å†…è”è°ƒåº¦ã€‚ å­˜å‚¨åœ¨æ ˆä¸Šçš„ Swift ç»“æ„ä½“å°†å ç”¨ä¸‰ä¸ª Word å¤§å°ã€‚å¦‚æœæ‚¨çš„ç»“æ„ä½“å½“ä¸­çš„æ•°æ®æ•°é‡ä½äºä¸‰ç§çš„è¯ï¼Œé‚£ä¹ˆç»“æ„ä½“çš„å€¼ä¼šè‡ªåŠ¨åœ¨æ ˆä¸Šå†…è”ã€‚Word æ˜¯ CPU å½“ä¸­å†…ç½®æ•´æ•°çš„å¤§å°ï¼Œå®ƒæ˜¯ CPU æ‰€å·¥ä½œçš„åŒºå—ã€‚123456struct Index &#123; let section: Int let item: Int&#125;let i = Index(section: 1, item: 1) åœ¨è¿™é‡Œæ‚¨å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªç»“æ„ä½“çš„æ—¶å€™ï¼Œå¸¦æœ‰ section å’Œ item å€¼å¾— Index ç»“æ„ä½“å°†ä¼šç›´æ¥ä¸‹æ”¾åˆ°æ ˆå½“ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ä¸ä¼šæœ‰é¢å¤–çš„å†…å­˜åˆ†é…å‘ç”Ÿã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬åœ¨åˆ«å¤„å°†å…¶èµ‹å€¼åˆ°å¦ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ1234567struct Index &#123; let section: Int let item: Int&#125;let i = Index(section: 1, item: 1)let i2 = i å¦‚æœæˆ‘ä»¬å°† i èµ‹ç»™ i2ï¼Œè¿™ä¼šå°†æˆ‘ä»¬å­˜å‚¨åœ¨æ ˆå½“ä¸­çš„å€¼ç›´æ¥å†æ¬¡å¤åˆ¶ä¸€éï¼Œè¿™ä¸ªæ—¶å€™å¹¶ä¸ä¼šå‡ºç°å¼•ç”¨çš„æƒ…å†µã€‚è¿™å°±æ˜¯æ‰€è°“çš„ã€Œå€¼ç±»å‹ã€ã€‚ é‚£ä¹ˆå¦‚æœç»“æ„ä½“å½“ä¸­å­˜æ”¾äº†å¼•ç”¨ç±»å‹çš„è¯åˆä¼šæ€æ ·å‘¢ï¼ŸæŒæœ‰å†…è”æŒ‡é’ˆçš„ç»“æ„ä½“ã€‚123456struct User &#123; let name: String let id: String&#125;let u = User(name: "Joe", id: "1234") å½“æˆ‘ä»¬å°†å…¶èµ‹å€¼ç»™åˆ«çš„å˜é‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æŒæœ‰äº†å…±äº«ä¸¤ä¸ªç»“æ„ä½“çš„ç›¸åŒæŒ‡é’ˆï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¦å¯¹è¿™ä¸¤ä¸ªæŒ‡é’ˆè¿›è¡ŒæŒæœ‰æ“ä½œï¼Œè€Œä¸æ˜¯åœ¨å¯¹è±¡ä¸Šæ‰§è¡Œå•ç‹¬çš„æŒæœ‰æ“ä½œã€‚12345678910struct User &#123; let name: String let id: String&#125;let u = User(name: "Joe", id: "1234")__swift_retain(u.name._textStorage)__swift_retain(u.id._textStorage)let u2 = u å¦‚æœå…¶ä¸­åŒ…å«äº†ç±»çš„è¯ï¼Œé‚£ä¹ˆæ€§èƒ½è€—è´¹ä¼šæ›´å¤§ã€‚ æŠ½è±¡ç±»å‹æ­£å¦‚æˆ‘ä»¬æ­¤å‰æ‰€è¿°ï¼ŒSwift æä¾›äº†è®¸å¤šä¸åŒçš„æŠ½è±¡ç±»å‹ (abstraction)ï¼Œä»è€Œå…è®¸æˆ‘ä»¬è‡ªè¡Œå†³å®šä»£ç è¯¥å¦‚ä½•è¿è¡Œï¼Œä»¥åŠå†³å®šä»£ç çš„æ€§èƒ½ç‰¹æ€§ã€‚ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹æŠ½è±¡ç±»å‹æ˜¯å¦‚ä½•åœ¨å®é™…ç¯å¢ƒå½“ä¸­ä½¿ç”¨çš„ã€‚è¿™é‡Œæœ‰ä¸€æ®µå¾ˆç®€å•çš„ä»£ç ï¼š1234567891011struct Circle &#123; let radius: Double let center: Point func draw() &#123;&#125;&#125;var circles = (1..&lt;100_000_000).map &#123; _ in Circle(...) &#125;for circle in circles &#123; circle.draw()&#125; è¿™é‡Œæœ‰ä¸€ä¸ªå¸¦æœ‰ radius å’Œ center å±æ€§çš„ Circle ç»“æ„ä½“ã€‚å®ƒå°†å ç”¨ä¸‰ä¸ª Word å¤§å°çš„ç©ºé—´ï¼Œå¹¶å­˜å‚¨åœ¨æ ˆä¸Šã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€äº¿ä¸ª Circleï¼Œç„¶åæˆ‘ä»¬éå†è¿™äº› Circle å¹¶è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚åœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œè¿™æ®µæ“ä½œåœ¨å‘å¸ƒæ¨¡å¼ä¸‹è€—è´¹äº† 0.3 ç§’çš„æ—¶é—´ã€‚é‚£ä¹ˆå½“éœ€æ±‚å‘ç”Ÿå˜æ›´çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹å‘¢ï¼Ÿ æˆ‘ä»¬ä¸ä»…éœ€è¦ç»˜åœ†ï¼Œè¿˜éœ€è¦èƒ½å¤Ÿå¤„ç†å¤šç§ç±»å‹çš„å½¢çŠ¶ã€‚è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬è¿˜éœ€è¦ç»˜çº¿ã€‚æˆ‘éå¸¸å–œæ¬¢é¢å‘åè®®ç¼–ç¨‹ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘åœ¨ä¸ä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µä¸‹å®ç°å¤šæ€æ€§ï¼Œå¹¶ä¸”å®ƒå…è®¸æˆ‘ä»¬åªéœ€è¦è€ƒè™‘è¿™ä¸ªã€ŒæŠ½è±¡ç±»å‹ã€å³å¯ã€‚123456789101112131415protocol Drawable &#123; func draw()&#125;struct Circle: Drawable &#123; let radius: Double let center: Point func draw() &#123;&#125;&#125;let drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in Circle(...) &#125;for drawable in drawables &#123; drawable.draw()&#125; æˆ‘ä»¬éœ€è¦åšçš„ï¼Œå°±æ˜¯å°†è¿™ä¸ª draw æ–¹æ³•æå–åˆ°åè®®å½“ä¸­ï¼Œç„¶åå°†æ•°ç»„çš„å¼•ç”¨ç±»å‹å˜æ›´ä¸ºè¿™ä¸ªåè®®ï¼Œè¿™æ ·åšå¯¼è‡´è¿™æ®µä»£ç èŠ±è´¹äº† 4.0 ç§’çš„æ—¶é—´æ¥è¿è¡Œã€‚é€Ÿç‡å‡æ…¢äº† 1300%ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ è¿™æ˜¯å› ä¸ºæ­¤å‰çš„ä»£ç å¯ä»¥è¢«é™æ€è°ƒåº¦ï¼Œä»è€Œåœ¨æ²¡æœ‰ä»»ä½•å †åº”ç”¨å»ºç«‹çš„æƒ…å†µä¸‹ä»èƒ½å¤Ÿæ‰§è¡Œã€‚è¿™å°±æ˜¯åè®®æ˜¯å¦‚ä½•å®ç°çš„ã€‚ ä¾‹å¦‚ï¼Œå¦‚å¤§å®¶æ‰€è§ï¼Œè¿™é‡Œæ˜¯æˆ‘ä»¬æ­¤å‰çš„ Circle ç»“æ„ä½“ã€‚åœ¨è¿™ä¸ª for å¾ªç¯å½“ä¸­ï¼ŒSwift ç¼–è¯‘å™¨æ‰€åšçš„å°±æ˜¯å‰å¾€ V-table è¿›è¡ŒæŸ¥æ‰¾ï¼Œæˆ–è€…ç›´æ¥å°† draw å‡½æ•°å†…è”ã€‚ 1234567891011struct Circle &#123; let radius: Double let center: Point func draw() &#123;&#125;&#125;var circles = (1..&lt;100_000_000).map &#123; _ in Circle(...) &#125;for circle in circles &#123; circle.draw()&#125; å½“æˆ‘ä»¬ç”¨åè®®æ¥æ›¿ä»£çš„æ—¶å€™ï¼Œæ­¤æ—¶å®ƒå¹¶ä¸çŸ¥é“è¿™ä¸ªå¯¹è±¡æ˜¯ç»“æ„ä½“è¿˜æ˜¯ç±»ã€‚å› ä¸ºè¿™é‡Œå¯èƒ½æ˜¯ä»»ä½•ä¸€ä¸ªå®ç°æ­¤åè®®çš„ç±»å‹ã€‚ 12345678910111213141516protocol Drawable &#123; func draw()&#125;struct Circle: Drawable &#123; let radius: Double let center: Point func draw() &#123;&#125;&#125;var drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in return Circle(...) &#125;for drawable in drawables &#123; drawable.draw()&#125; é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å»è°ƒåº¦è¿™ä¸ª draw å‡½æ•°å‘¢ï¼Ÿç­”æ¡ˆå°±ä½äºåè®®è®°å½•è¡¨ (protocol witness tableï¼Œä¹Ÿç§°ä¸ºè™šå‡½æ•°è¡¨) å½“ä¸­ã€‚å®ƒå…¶ä¸­å­˜æ”¾äº†æ‚¨åº”ç”¨å½“ä¸­æ¯ä¸ªå®ç°åè®®çš„å¯¹è±¡åï¼Œå¹¶ä¸”åœ¨åº•å±‚å®ç°å½“ä¸­ï¼Œè¿™ä¸ªè¡¨æœ¬è´¨ä¸Šå……å½“äº†è¿™äº›ç±»å‹çš„åˆ«åã€‚ 123456789101112131415161718protocol Drawable &#123; func draw()&#125;struct Circle: Drawable &#123; let radius: Double let center: Point func draw() &#123;&#125;&#125;var drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in return Circle(...)&#125;for drawable in drawables &#123; drawable.draw()&#125; åœ¨è¿™é‡Œçš„ä»£ç å½“ä¸­ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è·å–åè®®è®°å½•è¡¨å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä»è¿™ä¸ªæ—¢æœ‰å®¹å™¨ (existential container) å½“ä¸­è·å–ï¼Œè¿™ä¸ªå®¹å™¨ç›®å‰æ‹¥æœ‰ä¸€ä¸ªä¸‰ä¸ªå­—å¤§å°çš„ç»“æ„ä½“ï¼Œå¹¶ä¸”å­˜æ”¾åœ¨å…¶å†…éƒ¨çš„å€¼ç¼“å†²åŒºå½“ä¸­ï¼Œæ­¤å¤–è¿˜ä¸åè®®è®°å½•è¡¨å»ºç«‹äº†å¼•ç”¨å…³ç³»ã€‚ 123456struct Circle: Drawable &#123; let radius: Double let center: Point func draw() &#123;&#125;&#125; è¿™é‡Œ Circle ç±»å‹å­˜æ”¾åœ¨äº†ä¸‰ä¸ªå­—å¤§å°çš„ç¼“å†²åŒºå½“ä¸­ï¼Œå¹¶ä¸”ä¸ä¼šè¢«å•ç‹¬å¼•ç”¨ã€‚ 123456struct Line: Drawable &#123; let origin: Point let end: Point func draw() &#123;&#125;&#125; ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºæˆ‘ä»¬çš„ Line ç±»å‹æ¥è¯´ï¼Œå®ƒå…¶ä¸­åŒ…å«äº†å››ä¸ªå­—çš„å­˜å‚¨ç©ºé—´ï¼Œå› ä¸ºå®ƒæ‹¥æœ‰ä¸¤ä¸ªç‚¹ç±»å‹ã€‚è¿™ä¸ª Line ç»“æ„ä½“éœ€è¦è¶…è¿‡å››ä¸ªå­—ä»¥ä¸Šçš„å­˜å‚¨ç©ºé—´ã€‚æˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†å®ƒå‘¢ï¼Ÿè¿™ä¼šå¯¹æ€§èƒ½æœ‰å½±å“ä¹ˆï¼Ÿå¥½å§ï¼Œå®ƒçš„ç¡®ä¼šï¼š 123456789101112131415protocol Drawable &#123; func draw()&#125;struct Line: Drawable &#123; let origin: Point let end: Point func draw() &#123;&#125;&#125;let drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in Line(...) &#125;for drawable in drawables &#123; drawable.draw()&#125; è¿™éœ€è¦èŠ±è´¹ 45 ç§’é’Ÿçš„æ—¶é—´æ¥è¿è¡Œã€‚ä¸ºä»€ä¹ˆè¿™é‡Œè¦èŠ±è¿™ä¹ˆä¹…çš„æ—¶é—´å‘¢ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆäº‹å‘¢ï¼Ÿ ç»å¤§éƒ¨åˆ†çš„æ—¶é—´éƒ½èŠ±è´¹åœ¨å¯¹ç»“æ„ä½“è¿›è¡Œå†…å­˜åˆ†é…ä¸Šäº†ï¼Œå› ä¸ºç°åœ¨å®ƒä»¬æ— æ³•å­˜æ”¾åœ¨åªæœ‰ä¸‰ä¸ªå­—å¤§å°çš„ç¼“å†²åŒºå½“ä¸­äº†ã€‚å› æ­¤è¿™äº›ç»“æ„ä¼šåœ¨å †ä¸Šè¿›è¡Œå†…å­˜åˆ†é…ï¼Œæ­¤å¤–è¿™ä¹Ÿä¸åè®®æœ‰ä¸€ç‚¹å…³ç³»ã€‚ç”±äºæ—¢æœ‰å®¹å™¨åªèƒ½å¤Ÿå­˜å‚¨ä¸‰ä¸ªå­—å¤§å°çš„ç»“æ„ä½“ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä¸å¯¹è±¡å»ºç«‹å¼•ç”¨å…³ç³»ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦æŸç§åä¸ºå€¼è®°å½•è¡¨ (value witness table)ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ç”¨æ¥å¤„ç†ä»»æ„å€¼çš„ä¸œè¥¿ã€‚ å› æ­¤åœ¨è¿™é‡Œï¼Œç¼–è¯‘å™¨å°†åˆ›å»ºä¸€ä¸ªå€¼è®°å½•è¡¨ï¼Œå¯¹æ¯ä¸ªï¿½ï¿½ï¿½ç¼“å†²åŒºã€å†…æ•›ç»“æ„ä½“æ¥è¯´ï¼Œéƒ½æœ‰ä¸‰ä¸ªå­—å¤§å°çš„ç¼“å†²åŒºï¼Œç„¶åå®ƒå°†è´Ÿè´£å¯¹å€¼æˆ–è€…ç±»è¿›è¡Œå†…å­˜åˆ†é…ã€æ‹·è´ã€é”€æ¯å’Œå†…å­˜é‡Šæ”¾ç­‰æ“ä½œã€‚ 1234567891011121314151617func draw(drawable: Drawable) &#123; drawable.draw()&#125;let value: Drawable = Line()draw(local: value)// Generatesfunc draw(value: ECTDrawable) &#123; var drawable: ECTDrawable = ECTDrawable() let vwt = value.vwt let pwt = value.pwt drawable.vwt = value.vwt drawable.pwt = value.pwt vwt.allocateBuffAndCopyValue(&amp;drawable, value) pwt.draw(vwt.projectBuffer(&amp;drawable)&#125; è¿™é‡Œæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¿™å°±æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„ä¸­é—´äº§ç‰©ã€‚å¦‚æœæˆ‘ä»¬åªæœ‰ä¸€ä¸ª draw å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šæ¥å—æˆ‘ä»¬åˆ›å»ºçš„ Line ä½œä¸ºå‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬å°†å®ƒä¼ é€’ç»™è¿™ä¸ª draw å‡½æ•°å³å¯ã€‚ å®é™…æƒ…å†µæ—¶ï¼Œå®ƒå°†è¿™ä¸ª Drawable åè®®ä¼ é€’åˆ°æ—¢æœ‰å®¹å™¨å½“ä¸­ï¼Œç„¶ååœ¨å‡½æ•°å†…éƒ¨å†æ¬¡è¿›è¡Œåˆ›å»ºã€‚è¿™ä¼šå¯¹å€¼å’Œåè®®è®°å½•è¡¨è¿›è¡Œèµ‹å€¼ï¼Œç„¶ååˆ†é…ä¸€ä¸ªæ–°çš„ç¼“å†²åŒºï¼Œç„¶åå°†å…¶ä»–ç»“æ„ã€ç±»æˆ–è€…ç±»ä¼¼å¯¹è±¡çš„å€¼æ‹·è´è¿›è¿™ä¸ªç¼“å†²åŒºå½“ä¸­ã€‚ç„¶åå°±ä½¿ç”¨åè®®è®°å½•è¡¨å½“ä¸­çš„ draw å‡½æ•°ï¼ŒæŠŠçœŸå®çš„ Drable å¯¹è±¡ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°ã€‚ æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œå€¼è®°å½•è¡¨å’Œåè®®è®°å½•è¡¨å°†ä¼šå­˜æ”¾åœ¨æ ˆä¸Šï¼Œè€Œ Line å°†ä¼šè¢«å­˜æ”¾åœ¨å †ä¸Šï¼Œä»è€Œæœ€åå°†çº¿ç»˜åˆ¶å‡ºæ¥ã€‚ ç»“è®ºå¯¹æˆ‘ä»¬è¿›è¡Œæ•°æ®å»ºæ¨¡çš„æ–¹å¼è¿›è¡Œç®€å•çš„æ›´æ”¹å°†ä¼šå¯¹æ€§èƒ½é€ æˆå·¨å¤§çš„å½±å“ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹è¯¥å¦‚ä½•æ¥é¿å…è¿™äº›æƒ…å†µçš„å‘ç”Ÿã€‚ é¦–å…ˆè®©æˆ‘ä»¬æ¥è¯´ä¸€è¯´æ³›å‹ã€‚å¤§å®¶å¯èƒ½ä¼šè¯´äº†ï¼Œæˆ‘ç»™å„ä½å±•ç¤ºäº†åè®®ä¼šå¯¼è‡´æ€§èƒ½çš„ä¸‹é™ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨æ³›å‹å‘¢ï¼Ÿç­”æ¡ˆåœ¨äºï¼šæ³›å‹å…è®¸æˆ‘ä»¬åšä»€ä¹ˆã€‚ 123struct Stack&lt;T: Type&gt; &#123;...&#125; å‡è®¾æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªå¸¦æœ‰æ³›å‹ T çš„ Stack ç»“æ„ä½“ï¼Œå®ƒå—åˆ°ä¸€ä¸ªåè®®ç±»å‹çš„çº¦æŸã€‚ç¼–è¯‘å™¨æ‰€è¦åšçš„ï¼Œå°±æ˜¯å°†è¿™ä¸ª T ææ¢æˆç›¸åº”çš„åè®®ï¼Œæˆ–è€…æ›¿æ¢ä¸ºæˆ‘ä»¬ä¼ å…¥çš„å…·ä½“ç±»å‹ã€‚è¿™äº›æ“ä½œä¼šä¸€ç›´æ²¿ç€å‡½æ•°é“¾ (function chain) æ‰§è¡Œï¼Œå¹¶ä¸”ç¼–è¯‘å™¨ä¼šåˆ›å»ºç›´æ¥å¯¹æ­¤ç±»å‹è¿›è¡Œæ“ä½œçš„ä¸“ç”¨ç‰ˆæœ¬ã€‚ è¿™æ ·æˆ‘ä»¬å°±æ— éœ€å†ä½¿ç”¨å€¼è®°å½•è¡¨æˆ–è€…åè®®è®°å½•è¡¨äº†ï¼Œå¹¶ä¸”è¿˜ç§»é™¤äº†æ—¢æœ‰å®¹å™¨ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„è§£å†³æ–¹å¼ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿå†™å‡ºçœŸæ­£å¿«é€Ÿè¿è¡Œçš„æ³›å‹ä»£ç ï¼Œå¹¶ä¸”è¿˜å…·å¤‡ Swift æ‰€æä¾›çš„è‰¯å¥½å¤šæ€æ€§ã€‚è¿™å°±æ˜¯æ‰€è°“çš„é™æ€å¤šæ€æ€§ (static polymorphism)ã€‚ æ‚¨è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨æšä¸¾æ¥æ”¹è¿›æ•°æ®æ¨¡å‹ï¼Œè€Œä¸æ˜¯ä»æœåŠ¡å™¨ä¸­è·å–å¤§é‡çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æ­£åœ¨æ„å»ºä¸€ä¸ªç¤¾äº¤åº”ç”¨ï¼Œæ‚¨éœ€è¦å¯¹è´¦æˆ·å»ºç«‹çŠ¶æ€çš„ç®¡ç†ï¼Œä»¥å‰æ‚¨å¯èƒ½ä¼šä½¿ç”¨å­—ç¬¦ä¸²æ¥è¿›è¡Œæ§åˆ¶ã€‚ 123enum AccountStatus: String, RawRepresentable &#123;case .banned, .verified, incomplete&#125; å¦‚æœæˆ‘ä»¬æ”¹ç”¨æšä¸¾çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— éœ€è¿›è¡Œå†…å­˜åˆ†é…äº†ï¼Œå½“æˆ‘ä»¬ä¼ é€’è¿™ä¸ªç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªæ˜¯å°†æšä¸¾å€¼è¿›è¡Œä¼ é€’ï¼Œè¿™æ˜¯ä¸€ä¸ªåŠ å¿«ä»£ç è¿è¡Œé€Ÿåº¦çš„å¥½æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¸ºæ•´ä¸ªåº”ç”¨ç¨‹åºæä¾›æ›´å®‰å…¨ã€æ›´å¯è¯»çš„ä»£ç ã€‚ æ­¤å¤–ï¼Œä½¿ç”¨ u-æ¨¡å‹æˆ–è€…æ¼”ç¤ºè€… (Presenter) æˆ–è€…ä¸åŒçš„æŠ½è±¡ç±»å‹çš„å½¢å¼ï¼Œæ¥æ„å»ºç‰¹å®šç±»å‹çš„æ¨¡å‹ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿç²¾ç®€æ‰åº”ç”¨å½“ä¸­è®¸å¤šä¸å¿…è¦çš„éƒ¨åˆ†ã€‚ å¥½çš„ï¼Œæˆ‘çš„è®²æ¼”åˆ°æ­¤ç»“æŸï¼Œå†…å®¹å¾ˆçŸ­ï¼Œæ„Ÿè°¢è¯¸ä½çš„å‚ä¸ï¼]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Swift ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–ç¬”è®°]]></title>
    <url>%2Fswift-build-times%2F</url>
    <content type="text"><![CDATA[Xcodeåœ¨ç¼–è¯‘Swiftä»£ç çš„æ—¶å€™é€Ÿåº¦ä¼šè¶Šæ¥è¶Šæ…¢ï¼Œå°±æ­¤æŸ¥æ‰¾åŸå› ï¼Œå¹¶åˆ—å‡ºè‡ªå·±çš„ä¼˜åŒ–æ€è·¯ã€‚ Xcode8.2æ·»åŠ User-Defindæ–°çš„SWIFT_WHOLE_MODULE_OPTIMIZATION = YESå¯ä»¥è¿‡æ»¤ä¸ºä¿®æ”¹frameworkã€‚ é’ˆå¯¹è¿ç®—ç¬¦??çš„ä¼˜åŒ–åœ¨ä½¿ç”¨??æ—¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½éœ€è¦ä¼˜åŒ–ï¼ŒåŒ…è£¹åœ¨å¾ªç¯ä¸­çš„??ä¼šæ¯”è¾ƒè€—æ—¶æ¯”è¾ƒå‰å®³ï¼Œç›®å‰ä¸çŸ¥é“ä¸ºå•¥ï¼Œä¼°è®¡ç¼–è¯‘çš„æ—¶å€™éœ€è¦æ£€æŸ¥çš„æ­¤æ—¶æ¯”è¾ƒå¤šå§ğŸ˜‚ã€‚ å°è¯•æ˜¾å¼è§£åŒ…æ€è·¯ï¼š??ç¼–è¯‘æ…¢ï¼Œå°±ä¸ç”¨??ï¼Œç›´æ¥ä½¿ç”¨if elseå®æ–½: ç”±äºå·¥ç¨‹ä¸­ä½¿ç”¨çš„??æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æ¯”è¾ƒä¿®æ”¹èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚ä½†æ˜¯å¯ä»¥è§£å†³é—®é¢˜ã€‚çœŸä¸è¡Œå†™æ–¹æ³•è½¬åŒ–è°ƒç”¨å–½ã€‚ã€‚ é”™è¯¯çš„å°è¯•äº†é‡è½½è¿ç®—ç¬¦??æ–¹å¼æ€è·¯: ??è¿ç®—ç¬¦ç¼–è¯‘è€—æ—¶è¾ƒå¤šï¼Œç›´è§‰æ˜¯??å®ç°æœ‰å¤æ‚çš„æ“ä½œ,é‡æ–°æŒ‰ç…§æ˜¾å¼è§£åŒ…çš„æ–¹æ¡ˆè¿›è¡Œå®ç°ã€‚å®æ–½: åˆ†æ??çš„ä½¿ç”¨åœºæ™¯ï¼Œå·¦ä¾§ä¸ºT?,å³ä¾§ä¸ºTï¼Œè¿”å›å€¼T é‡è½½å‡½æ•°åå®šä¹‰public func ?? &lt;T&gt;(left: T?, right: T) -&gt; T å®ç° ç¼–è¯‘ errorï¼šAmbiguous use of operator &#39;??&#39; æ€è€ƒï¼šè¿™ä¸«çš„åœ¨é‡è½½è¿ç®—ç¬¦çš„æ—¶å€™ä¸èƒ½ä½¿ç”¨æ³›å‹å§ã€‚ã€‚ æ›´æ”¹å‡½æ•°ä¸ºpublic func ?? &lt;Any&gt;(left: Any?, right: Any) -&gt; Any PL. OKäº†ï¼Œå¯æ˜¯é—®é¢˜æ¥äº†ï¼Œç³»ç»Ÿçš„??æ˜¯å¯ä»¥è¿”å›å¯¹åº”çš„ç±»å‹ï¼Œå¯æ˜¯è¿™æ ·é‡è½½ä¹‹åè¿”å›ä¸€ä¸ªAnyï¼Œä»£ç ä¸­å¦‚æœå‡ºç°let str = str1 ?? &quot;&quot;åˆ™strç±»å‹å°±å˜ä¸ºAnyè€Œä¸æ˜¯Stringã€‚å·¨å‘ é¡¾ä¸äº†é‚£ä¹ˆå¤šäº†ï¼ŒçœŸä¸è¡Œä¸€ä¸ªä¸€ä¸ªè·‘ã€‚äºæ˜¯å…ˆä¿®æ”¹ä¸€ä¸ªè¾ƒä¸ºä¸¥é‡çš„Stringç±»å‹ã€‚ å°è¯•ç¼–è¯‘ï¼Œç»“æœæ—¶é—´æƒŠäººçš„æ²¡æœ‰å˜åŒ–ã€‚ã€‚ä¾æ—§å±…é«˜ä¸ä¸‹ ä»¥å¤±è´¥å‘Šç»ˆã€‚ã€‚ æ€»ç»“: è¿™ä¸ª??è€—æ—¶è¾ƒå¤šå¹¶ä¸æ˜¯å› ä¸º??çš„å®ç°æœ‰é—®é¢˜ï¼ŒçŒœæµ‹æ˜¯åœ¨ä¸º??å‡†å¤‡å·¦å³å‚æ•°çš„æ—¶å€™éœ€è¦è¿›è¡Œä¸€å±‚å±‚çš„è§£åŒ…ç¡®å®šç±»å‹ï¼Œå†åŠ ä¸Š??å¯èƒ½æœ‰é‡è½½ç‰ˆæœ¬ï¼Œè¿›è¡Œç±»å‹åŒ¹é…çš„æ—¶å€™æ¯”è¾ƒè€—æ—¶ã€‚ å°è¯•æ‰©å±•æ–¹æ³•è¿›è¡Œä¼˜åŒ–æ€è·¯: æ—¢ç„¶è¿ç®—ç¬¦ä¼šå¯¼è‡´ç¼–è¯‘æ…¢ï¼Œé‚£ä¹ˆå°±å°è¯•ä½¿ç”¨æ–¹æ³•ç›´æ¥è¿›è¡Œè½¬æ¢ã€‚å®ç°: ä»£ç å¦‚ä¸‹ï¼š123456789struct Operator &#123; /// ==&gt; ?? static func `try`&lt;T&gt;(_ origin: T?, _ then: T) -&gt; T &#123; guard let value = origin else &#123; return then &#125; return value &#125;&#125; æµ‹è¯•å‘ç°ä¸Šè¿°æ–¹æ³•å¯ä»¥ä¼˜åŒ–æ—¶é—´ã€‚ ä»¥ä¸‹åŸæ–‡å‡ºè‡ªï¼šå…³äº Swift ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ€è€ƒ åŸæ–‡é“¾æ¥ : Regarding Swift build time optimizations åŸæ–‡ä½œè€… : Robert Gummesson è¯‘æ–‡å‡ºè‡ª : æ˜é‡‘ç¿»è¯‘è®¡åˆ’ è¯‘è€… : æ¨é¾™é¾™ æ ¡å¯¹è€…: ç”³å† å, Jack King å…³äº Swift ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ€è€ƒä¸Šå‘¨ï¼Œæˆ‘è¯»äº† @nickoneill ä¸€ç¯‡ä¼˜ç§€çš„å¸–å­ Speeding Up Slow Swift Build Times ä¹‹åï¼Œæˆ‘å‘ç°ç”¨ä¸€ä¸ªç•¥ä¸åŒä»¥å¾€çš„è§’åº¦å»è¯»Swiftä»£ç ï¼Œå¹¶ä¸æ˜¯å¾ˆéš¾ã€‚ ä¸€è¡Œä¹‹å‰å¾ˆç®€æ´çš„ä»£ç ï¼Œç°åœ¨å´å‡ºç°äº†æ–°çš„é—®é¢˜â€”â€”å®ƒæ˜¯å¦åº”è¯¥é‡æ„ä¸º9è¡Œä»£ç æ¥è¾¾åˆ°æ›´å¿«çš„ç¼–è¯‘é€Ÿåº¦ï¼Ÿ (nil coalescing è¿ç®—ç¬¦å°±æ˜¯ä¸€ä¸ªä¾‹å­)å­°è½»å­°é‡ï¼Ÿç®€æ´çš„ä»£ç è¿˜æ˜¯å¯¹ç¼–è¯‘å™¨å‹å¥½çš„ä»£ç ï¼Ÿ æˆ‘è§‰å¾—ï¼Œå®ƒå–å†³äºé¡¹ç›®çš„å¤§å°å’Œå¼€å‘è€…çš„æƒ³æ³•ã€‚ ä½†è¯·ç­‰ç­‰â€¦ è¿™é‡Œæœ‰ä¸€ä¸ªXcodeæ’ä»¶åœ¨è®²ä¸€äº›ä¾‹å­ä¹‹å‰ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°äº†é€šè¿‡æ‰‹å·¥æå–æ—¥å¿—ä¿¡æ¯æ˜¯éå¸¸è€—æ—¶çš„äº‹æƒ…ã€‚é€šè¿‡å‘½ä»¤è¡Œå·¥å…·å®ç°ä¼šç›¸å¯¹å®¹æ˜“ä¸€äº›ï¼Œä½†æ˜¯æˆ‘æŠŠå®ƒå¾€å‰æ¨è¿›äº†ä¸€æ­¥ï¼šé›†æˆä¸ºXcodeæ’ä»¶ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ€åˆçš„ç›®çš„ä»…ä»…æ˜¯è¯†åˆ«å¹¶ä¿®å¤ä»£ç ä¸­æœ€è€—æ—¶çš„åœ°æ–¹ï¼Œä½†æ˜¯ç°åœ¨æˆ‘è§‰å¾—å®ƒæˆä¸ºäº†ä¸€ä¸ªå¿…é¡»è¦è¿­ä»£çš„è¿‡ç¨‹ã€‚è¿™æ ·æˆ‘æ‰å¯ä»¥æ›´åŠ é«˜æ•ˆåœ°æ„å»ºä»£ç ï¼Œå¹¶ä¸”é˜²æ­¢åœ¨é¡¹ç›®ä¸­å‡ºç°è€—æ—¶çš„å‡½æ•°ã€‚ ä¸å°‘æƒŠå–œæˆ‘ç»å¸¸åœ¨ä¸åŒçš„ Git åˆ†æ”¯ä¸­è·³è½¬ï¼Œå¹¶ä¸”ç­‰å¾…ä¸€ä¸ªæš–æ…¢çš„é¡¹ç›®ç¼–è¯‘ç®€ç›´æ˜¯åœ¨æµªè´¹æˆ‘çš„ç”Ÿå‘½ã€‚å› æ­¤æˆ‘æ€è€ƒäº†å¾ˆé•¿æ—¶é—´ï¼Œä¸€ä¸ªç©å…·é¡¹ç›®ï¼ˆå¤§çº¦ä¸¤ä¸‡è¡Œ Swift ä»£ç ï¼‰ä¼šç¼–è¯‘å¦‚æ­¤é•¿çš„æ—¶é—´ã€‚ å½“æˆ‘çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´å®ƒå¦‚æ­¤æ…¢ä¹‹åï¼Œæˆ‘ä¸å¾—ä¸æ‰¿è®¤æˆ‘éœ‡æƒŠäº†ï¼Œä¸€è¡Œä»£ç å±…ç„¶éœ€è¦å‡ ç§’çš„ç¼–è¯‘æ—¶é—´ã€‚ è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ã€‚ Nil åˆå¹¶è¿ç®—ç¬¦ç¼–è¯‘å™¨è‚¯å®šä¸å–œæ¬¢è¿™é‡Œçš„ç¬¬ä¸€ç§æ–¹æ³•ã€‚åœ¨å±•å¼€ä¸‹é¢ä¸¤å¤„ç®€å†™çš„ä»£ç ä¹‹åï¼Œæ„å»ºæ—¶é—´å‡å°‘äº† 99.4%ã€‚ // æ„å»ºæ—¶é—´ï¼š 5238.3ms return CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height) // æ„å»ºæ—¶é—´ï¼š 32.4ms var padding: CGFloat = 22 if let rightView = rightView { padding += rightView.bounds.width } if let leftView = leftView { padding += leftView.bounds.width } return CGSizeMake(size.width + padding, bounds.height) ArrayOfStuff + [Stuff]è¿™ä¸ªçœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ï¼š return ArrayOfStuff + [Stuff] // è€Œä¸æ˜¯ ArrayOfStuff.append(stuff) return ArrayOfStuff æˆ‘ç»å¸¸è¿™ä¹ˆåšï¼Œå¹¶ä¸”å®ƒå½±å“äº†æ¯æ¬¡æ„å»ºçš„æ—¶é—´ã€‚ä¸‹é¢æ˜¯æœ€ç³Ÿç³•çš„ä¸€ä¸ªä¾‹å­ï¼Œæ”¹å†™åæ„å»ºæ—¶é—´å¯ä»¥å‡å°‘ 97.9%ã€‚ // æ„å»ºæ—¶é—´ï¼š 1250.3ms let systemOptions = [ 7, 14, 30, -1 ] let systemNames = (0...2).map{ String(format: localizedFormat, systemOptions[$0]) } + [NSLocalizedString(&quot;everything&quot;, comment: &quot;&quot;)] // Some code in-between labelNames = Array(systemNames[0..&lt;count]) + [systemNames.last!] // æ„å»ºæ—¶é—´ï¼š 25.5ms let systemOptions = [ 7, 14, 30, -1 ] var systemNames = systemOptions.dropLast().map{ String(format: localizedFormat, $0) } systemNames.append(NSLocalizedString(&quot;everything&quot;, comment: &quot;&quot;)) // Some code in-between labelNames = Array(systemNames[0..&lt;count]) labelNames.append(systemNames.last!) ä¸‰å…ƒè¿ç®—ç¬¦ä»…ä»…æ˜¯é€šè¿‡æ›¿æ¢ä¸‰å…ƒè¿ç®—ç¬¦ä¸º if else è¯­å¥å°±èƒ½å‡å°‘ 92.9% çš„æ„å»ºæ—¶é—´ã€‚å¦‚æœä½¿ç”¨ä¸€ä¸ªforå¾ªç¯æ›¿æ¢ map å‡½æ•°ï¼Œå®ƒåˆèƒ½å‡å°‘å¦ä¸€ä¸ª 75%ï¼ˆä½†æ˜¯æˆ‘çš„çœ¼ç›å¯å°±å—ä¸äº†å’¯ğŸ˜‰ï¼‰ã€‚ // æ„å»ºæ—¶é—´ï¼š 239.0ms let labelNames = type == 0 ? (1...5).map{type0ToString($0)} : (0...2).map{type1ToString($0)} // æ„å»ºæ—¶é—´ï¼š 16.9ms var labelNames: [String] if type == 0 { labelNames = (1...5).map{type0ToString($0)} } else { labelNames = (0...2).map{type1ToString($0)} } è½¬æ¢ CGFloat åˆ° CGFloatè¿™é‡Œæˆ‘æ‰€è¯´çš„å¹¶ä¸ä¸€å®šæ­£ç¡®ã€‚å˜é‡å·²ç»ä½¿ç”¨äº† CGFloat å¹¶ä¸”æœ‰ä¸€äº›æ‹¬å·ä¹Ÿæ˜¯å¤šä½™çš„ã€‚åœ¨æ¸…ç†äº†è¿™äº›å†—ä½™ä¹‹åï¼Œæ„å»ºæ—¶é—´èƒ½å‡å°‘ 99.9%ã€‚ // æ„å»ºæ—¶é—´ï¼š 3431.7 ms return CGFloat(M_PI) * (CGFloat((hour + hourDelta + CGFloat(minute + minuteDelta) / 60) * 5) - 15) * unit / 180 // æ„å»ºæ—¶é—´ï¼š 3.0ms return CGFloat(M_PI) * ((hour + hourDelta + (minute + minuteDelta) / 60) * 5 - 15) * unit / 180 Round()è¿™ä¸ªä¸€ä¸ªéå¸¸å¥‡æ€ªçš„ä¾‹å­ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­å˜é‡æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ä¸å®ä¾‹å˜é‡çš„æ··åˆã€‚è¿™ä¸ªé—®é¢˜å¯èƒ½ä¸æ˜¯å››èˆäº”å…¥æœ¬èº«ï¼Œè€Œæ˜¯ç»“åˆä»£ç çš„æ–¹æ³•ã€‚å»æ‰å››èˆäº”å…¥çš„æ–¹æ³•å¤§æ¦‚èƒ½å‡å°‘ 97.6% çš„æ„å»ºæ—¶é—´ã€‚ // æ„å»ºæ—¶é—´ï¼š 1433.7ms let expansion = a â€” b â€” c + round(d * 0.66) + e // æ„å»ºæ—¶é—´ï¼š 34.7ms let expansion = a â€” b â€” c + d * 0.66 + e æ³¨æ„ï¼šæ‰€æœ‰çš„æµ‹è¯•éƒ½åœ¨ MacBook Air (13-inch, Mid 2013)ä¸­è¿›è¡Œã€‚ å°è¯•å®ƒæ— è®ºä½ æ˜¯å¦é¢ä¸´è¿‡æ„å»ºæ—¶é—´å¤ªé•¿çš„é—®é¢˜ï¼Œç¼–å†™å¯¹ç¼–è¯‘å™¨å‹å¥½çš„ä»£ç éƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æˆ‘ç¡®å®šä½ è‡ªå·±ä¼šåœ¨å…¶ä¸­æ‰¾åˆ°ä¸€äº›æƒŠå–œã€‚ä½œä¸ºå‚è€ƒï¼Œè¿™é‡Œæœ‰å®Œæ•´çš„ä»£ç ï¼Œåœ¨æˆ‘çš„å·¥ç¨‹ä¸­å¯ä»¥5ç§’å†…å®Œæˆç¼–è¯‘â€¦ import UIKit class CMExpandingTextField: UITextField { func textFieldEditingChanged() { invalidateIntrinsicContentSize() } override func intrinsicContentSize() -&gt; CGSize { if isFirstResponder(), let text = text { let size = text.sizeWithAttributes(typingAttributes) return CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height) } return super.intrinsicContentSize() } }]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fastlaneè‡ªåŠ¨åŒ–ç¬”è®°]]></title>
    <url>%2Ffastlane-note%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰åœ¨æ­å»ºJenkinsçš„æ—¶å€™ï¼Œç”±äºçœ‹åˆ°Fastlaneçš„é…ç½®å¥½å¤æ‚ï¼Œé‚£ä¹ˆå¤šï¼Œè€Œå½“æ—¶çš„éœ€æ±‚å°±æ˜¯è‡ªåŠ¨æ‰“åŒ…ã€‚ã€‚æ‰€ä»¥æ²¡æœ‰ç”¨ï¼Œç°åœ¨æƒ³æ¥å¥½æ°”ï¼ä»Šå¤©ç¿»åˆ°InfoQçš„ä¸€ä¸ªæ–‡ç« ï¼Œåˆè¯¦ç»†çš„äº†è§£äº†Fastlaneä¹‹åï¼Œè§‰å¾—æ­¤å¤§æ³•ç”šå¥½ï¼Œè§£å†³å¾ˆå¤šç—›ç‚¹ï¼å†³å®šæé€šè¿™ä¸€åˆ‡ï¼å›çœ‹ä¹‹å‰çš„build-ipa-sh.mdç¡®å®æ¯”è¾ƒåƒµç¡¬ã€‚è‡ªåŠ¨åŒ–è¿˜æ˜¯å¾ˆæ£’çš„ã€‚ åŸºæœ¬çŸ¥è¯† (@icyleaf)åœ¨Fastlane - iOS å’Œ Android çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ä¸­è¯´åˆ°ï¼š Fastlane æä¾›çš„æµç¨‹çš„ä¼—å¤šå·¥å…·éƒ½æ˜¯å¯ä»¥ç‹¬ç«‹å­˜åœ¨å’Œä½¿ç”¨ï¼ˆæä¾› cli å‘½ä»¤ï¼‰ï¼Œä¹Ÿå¯ä»¥ç»Ÿä¸€ç”± fastlane æ¥æ§åˆ¶ã€‚å®ƒåœ¨ä½¿ç”¨ä¸­æå‡ºäº†ä¸¤ä¸ªæ¦‚å¿µï¼š - action: Fastlane çš„æ’ä»¶ï¼Œæˆªè‡³å½“å‰å†…ç½® 165 ä¸ªè‡³å¤šï¼Œä¸è¿‡æ¯ä¸ªåŠ¨ä½œçš„é¢—ç²’åº¦å¤§å°ä¸ä¸€ã€‚æŸ¥çœ‹è¯¦æƒ… - lane: Fastlane çš„ä»»åŠ¡ï¼ˆæˆ–è€…å¯ä»¥ç†è§£ä¸ºå‘½ä»¤ï¼‰ï¼Œä¸€ä¸ªå¯ä»¥åŒ…å«å¤šä¸ª lanesï¼Œé€šè¿‡ fastlane cli ä¼ å…¥åˆ¶å®šçš„ lane æ¥æ‰§è¡Œã€‚ è‡ªæˆ‘æ„Ÿè§‰è¿™å¥è¯è¿™ä¸ªå¯¹ç†è§£å’Œä½¿ç”¨å¾ˆé‡è¦ï¼ é…ç½® Fastlaneå·²è¢«Fabricæ”¶è´­ï¼Œæ‰€ä»¥æŒ‰ç…§å…¶å®‰è£…ä¹Ÿå¾ˆéšæ„(æˆ³æˆ‘é…ç½®)ã€‚ å¯¹äºæ‰“åŒ…ï¼Œ æ–‡ç«  æ·±å…¥æµ…å‡º Fastlane ä¸€çœ‹ä½ å°±æ‡‚ fir.im weekly - ã€Œ æŒç»­é›†æˆ ã€å®è·µæ•™ç¨‹åˆé›† ä½¿ç”¨fastlaneå®ç°iOSæŒç»­é›†æˆ fastlane docs fastlane GitHub Fastlaneå®æˆ˜ï¼ˆä¸€ï¼‰ï¼šç§»åŠ¨å¼€å‘è‡ªåŠ¨åŒ–ä¹‹é“ Fastlaneå®æˆ˜ï¼ˆäºŒï¼‰ï¼šActionå’ŒPluginæœºåˆ¶ Fastlaneå®æˆ˜ï¼ˆä¸‰ï¼‰ï¼šFastlaneåœ¨Androidå¹³å°çš„åº”ç”¨ Fastlaneå®æˆ˜ï¼ˆå››ï¼‰ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•ç¯‡ Fastlaneå®æˆ˜ï¼ˆäº”ï¼‰ï¼šé«˜çº§ç”¨æ³•]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>Fastlane</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•å®ç°AppStoreæŸ¥çœ‹æ›´å¤šçš„æ–¹æ³•]]></title>
    <url>%2Fuitextkit-ellipsis-sth-at-the-end%2F</url>
    <content type="text"><![CDATA[â€“ 2017.9.20 æ›´æ–° â€“çœ‹åˆ°AppStoreçš„æ›´å¤šæ•ˆæœï¼Œåšçš„ä¸é”™å“ï¼Œæœ¬æ–‡å°è¯•é‡‡ç”¨UITextKitè¿›è¡Œå®ç°ã€‚ App Storeä¸­çš„æŸ¥çœ‹æ›´å¤šåŠ¨ç”»æ˜¯ä¸æ˜¯å¾ˆç»™åŠ›ï¼Ÿå¯æ˜¯åšèµ·æ¥ç¡®ä¸çŸ¥é“å¦‚ä½•ä¸‹æ‰‹ï¼Ÿè¿™é‡Œæˆ‘æä¾›ä¸€ç§UITextKitçš„æ–¹æ³•æ¥ç®€å•çš„å®ç°ä¸€ä¸‹ã€‚ ä¸ºäº†è®©ä¾‹å­ç®€å•ï¼Œæˆ‘å°±ç›´æ¥å†™äº†ä¸ªmoreï¼Œé‚£ä¸ªviewæ˜¯è‡ªå®šä¹‰çš„ï¼Œéšä¾¿æ·»åŠ çš„ï¼Œå’Œæœ¬èº«çš„æ–‡æœ¬å±•ç¤ºçš„å¹¶æ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚ ä¸ºäº†è®©æœ€åçš„é‚£ä¸ªmoreViewæ›´åŠ å¥½ç”¨ï¼Œå¢åŠ äº†å·²ç»å±•å¼€æ˜¾ç¤ºå…¨éƒ¨æ˜¯å¦éšè—çš„æ§åˆ¶ã€‚ ä¸»è¦ä»£ç è·å–æœ€åä¸€è¡ŒRect 12345678var lastRect = CGRect.zerolayoutManager.enumerateEnclosingRects(forGlyphRange: NSRange(location: 0, length: textStorage.string.characters.count), withinSelectedGlyphRange: NSRange(location: NSNotFound, length: 0), in: textContainer, using: &#123; [weak self] (rect, isStop) inguard let _self = self else &#123; return &#125;var newRect = rectnewRect.origin.y += _self.textContainerInset.toplastRect = newRect&#125;)print(lastRect) å¢åŠ  exclusionPaths 1textContainer.exclusionPaths = [UIBezierPath.init(rect: rect)] å¤‡æ³¨ github UITextViewé»˜è®¤æºå¸¦å·¦å³è¾¹è·ï¼Œé€šè¿‡UITextView.textContainer.lineFragmentPaddingè·å– UITextViewé»˜è®¤æºå¸¦ä¸Šä¸‹å·¦å³è¾¹è·(UITextView.textContainerInset)ï¼Œå…¶ä¸­å·¦å³å’ŒlineFragmentPaddingç›¸åŠ  æ­¤å¤„å¹¶æ²¡æœ‰å¯¹TruncateTextViewè¿›è¡Œè¿‡å¤šçš„è®¾ç½®ï¼Œä¸»è¦æ˜¯å› ä¸ºç»§æ‰¿åœ¨UITextViewä¸‹ï¼ŒGIFä¸­çš„è¿™éƒ¨åˆ†è®¾ç½®æ”¾åœ¨äº†ViewController.swiftä¸­ æ­¤å¤„ä½¿ç”¨çš„æ˜¯frameï¼Œå¯ä»¥åœ¨UIView.sizeToFit()ä¹‹åè·å–åˆ°UIViewçš„Sizeã€‚çº¦æŸä¹Ÿå¤§æŠµå¦‚æ­¤ æ„Ÿè°¢ä¹é€é¥æä¾›çš„ä¾‹å­ï¼Œæ‰æ‰¾åˆ°äº†open func truncatedGlyphRange(inLineFragmentForGlyphAt glyphIndex: Int) -&gt; NSRangeæ–¹æ³•ğŸ˜‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ•ˆæœ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¼˜é›…çš„ä½¿ç”¨SwiftLint]]></title>
    <url>%2Felegant-to-use-swiftlint%2F</url>
    <content type="text"><![CDATA[æ¥å…¥äº†SwiftLineï¼Œä¿®æ”¹2000+çš„warningã€300+errorçš„ä¸€ç‚¹ç¬”è®°å¿ƒå¾—ã€‚ SwiftLint SwiftLintA tool to enforce Swift style and conventions, loosely based on GitHubâ€™s Swift Style Guide. SwiftLint hooks into Clang and SourceKit to use the AST representation of your source files for more accurate results. SwiftLint æ˜¯ä¸€ä¸ªç”¨äºå¼ºåˆ¶æ£€æŸ¥ Swift ä»£ç é£æ ¼å’Œè§„å®šçš„ä¸€ä¸ªå·¥å…·ï¼ŒåŸºæœ¬ä¸Šä»¥ GitHubâ€™s Swift ä»£ç é£æ ¼æŒ‡å—ä¸ºåŸºç¡€ã€‚ SwiftLint Hook äº† Clang å’Œ SourceKit ä»è€Œèƒ½å¤Ÿä½¿ç”¨ AST æ¥è¡¨ç¤ºæºä»£ç æ–‡ä»¶çš„æ›´å¤šç²¾ç¡®ç»“æœã€‚ å¯¹åŸæœ‰ä»£ç æ ¼å¼åŒ–è‡ªåŠ¨æ ¼å¼åŒ– 1swiftlint autocorrect TrailingWhitespaceRuleç°è±¡ xxx.swift:34: warning: Trailing Whitespace Violation: Lines should not have trailing whitespace. (trailing_whitespace) è§„åˆ™å®ç°ï¼šTrailingWhitespaceRule.swift åŸå›  Xcodeä¸­çš„â€ç©ºç™½è¡Œâ€ã€‚å…¶å®å¹¶ä¸ç©ºç™½ï¼Œå«æœ‰ç©ºçš„å­—ç¬¦ã€‚æœ€æ˜æ˜¾çš„è¡¨ç°ä¸ºgitæäº¤çš„æ—¶å€™ä¼šæœ‰æ˜æ˜¾çš„é»„è‰²è­¦å‘Šã€‚ è§£å†³åŠæ³• Xcodeä¸­æœ‰é€‰é¡¹å¯ä»¥ç›´æ¥æ§åˆ¶ï¼Œå…·ä½“è·¯å¾„ä¸º 12345Xcode -&gt; Preferences-&gt; Text Editing-&gt; While editing-&gt; [V] Including whitespace-only lines ColonRuleç°è±¡ xxx.swift:13:71: warning: Colon Violation: Colons should be next to the identifier when specifying a type. (colon) åŸå›  å˜é‡æ–¹æ³•çš„ : çš„å³è¾¹åº”è¯¥æœ‰ä¸€ä¸ªç©ºæ ¼æ‰èƒ½è¯†åˆ«å‡ºæ¥ï¼Œä¸”å·¦ä¾§ä¸èƒ½ç•™ç©ºæ ¼ã€‚æ‰€ä»¥å†™ä»£ç çš„æ—¶å€™éšæ‰‹å†™ä¸Šè¿˜æ˜¯æ¯”è¾ƒå¥½çš„ã€‚ã€‚ æ —å­ï¼š 12345678// OK:var responseData: [String : Any]? = nil // è¿”å›ç»“æœï¼Œè¯·æ±‚ä¹‹å‰ä¸ºnil// warning: ç¬¬ä¸€ä¸ª&apos;:&apos;å¤„å·¦ä¾§æœ‰ç©ºæ ¼var responseData : [String : Any]? = nil // è¿”å›ç»“æœï¼Œè¯·æ±‚ä¹‹å‰ä¸ºnil// warning: ç¬¬ä¸€ä¸ª&apos;:&apos;å¤„å³ä¾§æ— ç©ºæ ¼var responseData:[String : Any]? = nil // è¿”å›ç»“æœï¼Œè¯·æ±‚ä¹‹å‰ä¸ºnil è§£å†³åŠæ³• è§„èŒƒä¹¦å†™ LineLengthRuleç°è±¡ xxx.swift:90: warning: Line Length Violation: Line should be 100 characters or less: currently 101 characters (line_length) åŸå›  è¡Œæ•°è¶…äº†å‘—ã€‚ã€‚ è§£å†³åŠæ³• æ–¹æ³•åå­—å†™çš„ç®€å•æ˜“æ‡‚ ControlStatementRuleç°è±¡ xxx.swift:169:21: warning: Control Statement Violation: if,for,while,do statements shouldnâ€™t wrap their conditionals in parentheses. (control_statement) è§„åˆ™å®ç°ControlStatementRule åŸå›  swiftä¸­if,for,while,do è¯­å¥ä¸åº”è¯¥ç”¨() UnusedClosureParameterRuleç°è±¡ xxx.swift:103:62: warning: Unused Closure Parameter Violation: Unused parameter â€œresponseâ€ in a closure should be replaced with _. (unused_closure_parameter) è§„åˆ™å®ç°UnusedClosureParameterRule åŸå›  response æ²¡æœ‰ä½¿ç”¨ï¼Œå»ºè®®æ›¿æ¢ä¸º _ã€‚ CyclomaticComplexityRuleç°è±¡ xxx.swift:69:5: warning: Cyclomatic Complexity Violation: Function should have complexity 10 or less: currently complexity equals 14 (cyclomatic_complexity) è§„åˆ™å®ç°CyclomaticComplexityRule åŸå›  ğŸ˜‚ï¼Œä»–è¯´ä½ è¿™å‡½æ•°å†™çš„å¤ªå¤æ‚äº†ã€‚çœ‹å®ç°æ˜¯è¯´ä¸èƒ½æœ‰è¿‡å¤šçš„if {} OpeningBraceRuleç°è±¡ xxx.swift:221:34: warning: Opening Brace Spacing Violation: Opening braces should be preceded by a single space and on the same line as the declaration. (opening_brace) è§„åˆ™å®ç°OpeningBraceRule è§£å†³ {}çš„å‰é¢è¦æœ‰ç©ºæ ¼éš”å¼€]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>SwiftLint</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç§‘å­¦ä¸Šç½‘ä¹‹æ¬ç“¦å·¥ssæ­å»ºç¬”è®°]]></title>
    <url>%2Fbandwagonhost-note%2F</url>
    <content type="text"><![CDATA[åŸæ¥å§ï¼Œç”¨ç”¨goagentã€Lanternã€XX-Netï¼Œç¡®å®ï¼Œè¿™ç©æ„åªèƒ½Googleå‡ºæ¥ç»“æœï¼Œä½†æ˜¯æœ‰çš„ç«™ç‚¹æ‰“ä¸å¼€æ‰æ˜¯æœ€éªšçš„ã€‚ã€‚åŒäº‹æäº†ä¸ªæ¬ç“¦å·¥æŒºä¾¿å®œï¼Œäºæ˜¯ä¹å°±ä¹Ÿæäº†ä¸€ä¸ªã€‚ä¸è¿‡å¼ºè¿«ç—‡çŠ¯äº†ï¼Œå°è¯•äº†å„ç§SSç‰ˆæœ¬ä»¥åŠå„ç§ä¼˜åŒ–ï¼Œç›®çš„æ˜¯æ‰¾ä¸ªæµç•…ç‚¹çš„ç‰ˆæœ¬è¿›è¡Œç§‘å­¦ä¸Šç½‘ã€‚ å†™åœ¨å‰é¢ çº¢çº¿è¶Šä¸å¾—ï¼çº¢çº¿è¶Šä¸å¾—ï¼çº¢çº¿è¶Šä¸å¾—ï¼é‡è¦çš„äº‹æƒ…è¯´3éã€‚ å‚çœ‹ç¬¬ä¸€æ¡ å‚çœ‹ç¬¬ä¸€æ¡ å‚çœ‹ç¬¬ä¸€æ¡ 2017 07 18 say goog bay !]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>ss</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­£åˆ™è¡¨è¾¾å¼å­¦ä¹ ç¬”è®°]]></title>
    <url>%2Fbruch-up-regular-expressions%2F</url>
    <content type="text"><![CDATA[æ­£åˆ™è¡¨è¾¾å¼åŸºç¡€å­¦ä¹ ç¬”è®°ã€‚ å‰é¢ ä¸Šæ¬¡æ‰¾äº†ä¸ªå¾ˆå¥½çš„æ–‡ç« ï¼Œå¯æ˜¯æ‰‹æ®‹æ²¡ä¿å­˜ã€‚ã€‚æ‰¾ä¸åˆ°äº†ğŸ˜­ï¼Œç°åœ¨é‡æ–°æ‰¾äº†ä¸€ä¸ªæ–‡ç« ï¼šæ­£åˆ™è¡¨è¾¾å¼30åˆ†é’Ÿå…¥é—¨æ•™ç¨‹ æ­£å¦‚ä½œè€…è¯´çš„ï¼š å£°æ˜æœ¬æ–‡éåŸåˆ›ï¼Œæ˜¯æ”¹ç¼–è‡ªã€Šæ­£åˆ™è¡¨è¾¾å¼30åˆ†é’Ÿå…¥é—¨æ•™ç¨‹ã€‹ï¼Œå› ä¸ºåŸä½œè€…çš„æ’ç‰ˆä¸ªäººä¸æ˜¯å¾ˆå–œæ¬¢ï¼Œè€Œä¸”å†…å®¹ä¸Šä¸ªäººè§‰å¾—æœ‰äº›åœ°æ–¹éœ€è¦æ”¹è¿›ï¼Œæ‰€ä»¥åœ¨ gitbook ä¸Šå¼€äº†ä¸€æœ¬ä¹¦ã€‚ OSCçš„åœ¨çº¿æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯• å¼€æå…ƒå­—ç¬¦ \ : è½¬ä¹‰ \b : å•è¯å¼€å§‹æˆ–ç»“æŸ ^ : å­—ç¬¦ä¸²å¼€å§‹ $ : å­—ç¬¦ä¸²ç»“æŸ \d : ä¸€ä¸ªæ•°å­— \s : ä»»æ„ç©ºç™½å­—ç¬¦ï¼šç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€ä¸­æ–‡å…¨è§’ç©ºæ ¼ã€ç­‰ \w : å­—æ¯/æ•°å­—/ä¸‹åˆ’çº¿/æ±‰å­— å¯è§å­—ç¬¦ . : é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦ é‡å¤ {n} : å‰ç½®ä½é‡å¤åŒ¹é… [n] æ¬¡ {n,m} : å‰ç½®ä½é‡å¤åŒ¹é… [n-m] æ¬¡ {n,} : å‰ç½®ä½é‡å¤åŒ¹é… [n-âˆ] æ¬¡ * : æ•°é‡åŒºé—´ï¼š[0-N] + : æ•°é‡åŒºé—´ï¼š[1-N] ? : æ•°é‡åŒºé—´ï¼š[0-1] å­—ç¬¦ç±» [nml] : å¯ä»¥åŒ¹é…åˆ° n/m/l æ¡ä»¶ | : æˆ–è¯­å¥ã€‚å­˜åœ¨é€»è¾‘çŸ­è·¯ (m) : åˆ†ç»„è¯­å¥ã€‚å­å¼ï¼Œå¯ä»¥æŒ‡å®šé‡å¤ä»€ä¹ˆçš„ åä¹‰ \W : ä»»æ„ä¸æ˜¯ï¼ˆå­—ç¬¦ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€æ±‰å­—ï¼‰ \S : ä»»æ„ä¸æ˜¯ ç©ºç™½ç¬¦ \D : ä»»æ„ä¸æ˜¯ æ•°å­— \B : ä»»æ„ä¸æ˜¯ å•è¯å¼€å¤´æˆ–ç»“å°¾ \^x : é™¤xä»¥å¤–çš„ä»»æ„å­—ç¬¦ [\^abc] : é™¤abcè¿™å‡ ä¸ªå­—æ¯ä»¥å¤–çš„ä»»æ„å­—ç¬¦ åå‘å¼•ç”¨ (\w+)è¿™æ ·ç”¨()çš„éƒ¨åˆ†ç§°ä¸ºä¸€ä¸ªåˆ†ç»„ï¼Œå…¶åŒ¹é…åˆ°çš„å†…å®¹å¯ä»¥ä½¿ç”¨\næ¥è¡¨ç¤ºï¼Œnä»£è¡¨è¯¥åˆ†ç»„ä¸ºç¬¬nä¸ªåˆ†ç»„ã€‚åˆ†ç»„ä¸‹æ ‡ä»1å¼€å§‹ã€‚ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å­è¡¨è¾¾å¼ç»„å: (?&lt;Word&gt;M) \k&lt;Word&gt; : æˆ– (?&#39;Word&#39;M) \k&#39;Word&#39;ï¼Œå…¶ä¸­Mä¸ºå­å¼ã€‚ å¸¸ç”¨åˆ†ç»„è¯­æ³•æ•è· (exp) : åŒ¹é…exp,å¹¶æ•è·æ–‡æœ¬åˆ°è‡ªåŠ¨å‘½åçš„ç»„é‡Œ (?exp) : åŒ¹é…exp,å¹¶æ•è·æ–‡æœ¬åˆ°åç§°ä¸ºnameçš„ç»„é‡Œï¼Œä¹Ÿå¯ä»¥å†™æˆ(?â€™nameâ€™exp) (?:exp) : åŒ¹é…exp,ä¸æ•è·åŒ¹é…çš„æ–‡æœ¬ï¼Œä¹Ÿä¸ç»™æ­¤åˆ†ç»„åˆ†é…ç»„å· é›¶å®½æ–­è¨€ (?=exp) : åŒ¹é…expå‰é¢çš„ä½ç½® (?&lt;=exp) : åŒ¹é…expåé¢çš„ä½ç½® (?!exp) : åŒ¹é…åé¢è·Ÿçš„ä¸æ˜¯expçš„ä½ç½® (?&lt;!exp) : åŒ¹é…å‰é¢ä¸æ˜¯expçš„ä½ç½® æ³¨é‡Š (?#comment) : è¿™ç§ç±»å‹çš„åˆ†ç»„ä¸å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å¤„ç†äº§ç”Ÿä»»ä½•å½±å“ï¼Œç”¨äºæä¾›æ³¨é‡Šè®©äººé˜…è¯» è´ªå©ªä¸æ‡’æƒ° è´ªå©ªï¼šåŒ¹é…çš„å°½å¯èƒ½é•¿ æ‡’æƒ°ï¼šåŒ¹é…çš„å°½å¯èƒ½çŸ­ *? : é‡å¤ä»»æ„æ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ +? : é‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ ?? : é‡å¤0æ¬¡æˆ–1æ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ {n,m}? : é‡å¤nåˆ°mæ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ {n,}? : é‡å¤næ¬¡ä»¥ä¸Šï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ å¹³è¡¡ç»„/é€’å½’åŒ¹é… # æˆ‘å¼€å§‹çœ‹ä¸æ‡‚äº†ğŸ˜‚ å…¶ä»– \a : æŠ¥è­¦å­—ç¬¦(æ‰“å°å®ƒçš„æ•ˆæœæ˜¯ç”µè„‘å˜€ä¸€å£°) \b : é€šå¸¸æ˜¯å•è¯åˆ†ç•Œä½ç½®ï¼Œä½†å¦‚æœåœ¨å­—ç¬¦ç±»é‡Œä½¿ç”¨ä»£è¡¨é€€æ ¼ \t : åˆ¶è¡¨ç¬¦ï¼ŒTab \r : å›è½¦ \v : ç«–å‘åˆ¶è¡¨ç¬¦ \f : æ¢é¡µç¬¦ \n : æ¢è¡Œç¬¦ \e : Escape \0nn : ASCIIä»£ç ä¸­å…«è¿›åˆ¶ä»£ç ä¸ºnnçš„å­—ç¬¦ \xnn : ASCIIä»£ç ä¸­åå…­è¿›åˆ¶ä»£ç ä¸ºnnçš„å­—ç¬¦ \unnnn : Unicodeä»£ç ä¸­åå…­è¿›åˆ¶ä»£ç ä¸ºnnnnçš„å­—ç¬¦ \cN : ASCIIæ§åˆ¶å­—ç¬¦ã€‚æ¯”å¦‚\cCä»£è¡¨Ctrl+C \A : å­—ç¬¦ä¸²å¼€å¤´(ç±»ä¼¼^ï¼Œä½†ä¸å—å¤„ç†å¤šè¡Œé€‰é¡¹çš„å½±å“) \Z : å­—ç¬¦ä¸²ç»“å°¾æˆ–è¡Œå°¾(ä¸å—å¤„ç†å¤šè¡Œé€‰é¡¹çš„å½±å“) \z : å­—ç¬¦ä¸²ç»“å°¾(ç±»ä¼¼$ï¼Œä½†ä¸å—å¤„ç†å¤šè¡Œé€‰é¡¹çš„å½±å“) \G : å½“å‰æœç´¢çš„å¼€å¤´ \p{name} : Unicodeä¸­å‘½åä¸ºnameçš„å­—ç¬¦ç±»ï¼Œä¾‹å¦‚\p{IsGreek} (?&gt;exp) : è´ªå©ªå­è¡¨è¾¾å¼ (?&lt;x&gt;-&lt;y&gt;exp) : å¹³è¡¡ç»„ (?im-nsx:exp) : åœ¨å­è¡¨è¾¾å¼expä¸­æ”¹å˜å¤„ç†é€‰é¡¹ (?im-nsx) : ä¸ºè¡¨è¾¾å¼åé¢çš„éƒ¨åˆ†æ”¹å˜å¤„ç†é€‰é¡¹ (?(exp)yes|no) : æŠŠexpå½“ä½œé›¶å®½æ­£å‘å…ˆè¡Œæ–­è¨€ï¼Œå¦‚æœåœ¨è¿™ä¸ªä½ç½®èƒ½åŒ¹é…ï¼Œä½¿ç”¨yesä½œä¸ºæ­¤ç»„çš„è¡¨è¾¾å¼ï¼›å¦åˆ™ä½¿ç”¨no (?(exp)yes) : åŒä¸Šï¼Œåªæ˜¯ä½¿ç”¨ç©ºè¡¨è¾¾å¼ä½œä¸ºno (?(name)yes|no) : å¦‚æœå‘½åä¸ºnameçš„ç»„æ•è·åˆ°äº†å†…å®¹ï¼Œä½¿ç”¨yesä½œä¸ºè¡¨è¾¾å¼ï¼›å¦åˆ™ä½¿ç”¨no (?(name)yes) : åŒä¸Šï¼Œåªæ˜¯ä½¿ç”¨ç©ºè¡¨è¾¾å¼ä½œä¸ºno æ —å­ 5-12ä½QQï¼š^\d{5,12}$ IPv4åœ°å€ï¼š((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?) go goã€kitty kittyè¿™æ ·çš„å è¯ï¼š\b(\w+)\b\s+\1\b åå‘å¼•ç”¨ï¼š\b(\w+)\b\s+\1\b == \b(?&lt;Word&gt;\w+)\b\s+\k&lt;Word&gt;\b == \b(?&#39;Word&#39;\w+)\b\s+\k&#39;Word&#39;\b æœ€å çŸ¥è¯†ç ”ç©¶äº†ä¸€ä¸‹è¯­æ³•ï¼Œè¿˜æœªè¯¦ç»†æµ‹è¯•ã€‚æ€è€ƒï¼šè¿™ç©æ„çœŸå¿ƒå‰å®³ğŸ˜‚ã€‚]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>æ­£åˆ™è¡¨è¾¾å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DEBUG - swiftä¸­å–å‡ºé€šçŸ¥ä¸­çš„frame]]></title>
    <url>%2Fdebug-swift-notifa-frame%2F</url>
    <content type="text"><![CDATA[swiftä¸­è·å–OCå­˜å‚¨çš„Frameä¸¤ç§è·å–æ–¹æ¡ˆã€‚ Swiftä¸‹åœ¨Notification.userInfoå–Frameï¼ŒDebugå’ŒReleaseæƒ…å†µä¸‹è¿˜ä¸ä¸€æ ·ã€‚ã€‚ â€“&gt;æ›´æ–°äº2016.12.1 Version 8.1 (8B62) 1234567891011func keyboardShow(sender: Notification) &#123; var endFrame = CGRect.zero if let frame = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? CGRect &#123; endFrame = frame // *** Debugæ˜¯å¯ä»¥é€šè¿‡çš„ã€‚ä½†æ˜¯Releaseæ— æ³•é€šè¿‡ã€‚ NSLog("&lt;&lt;&lt;INFO&gt;&gt;&gt;: as CGRect") &#125; else if let value = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValue &#123; endFrame = value.cgRectValue // *** Releaseä¼šå–å‡ºNSValue NSLog("&lt;&lt;&lt;INFO&gt;&gt;&gt;: as NSValue") &#125; ç”±äºReleaseæ— æ³•è°ƒè¯•ï¼Œæ‰€ä»¥è´¹äº†ä¸å°‘åŠ²ã€‚é¦–å…ˆSwiftä¸­çš„å­—å…¸å·²ç»å¯ä»¥å­˜æ”¾å€¼ç±»å‹ï¼Œå…¶æœ¬èº«ä¹Ÿæ˜¯å€¼ç±»å‹ã€‚æ‰€ä»¥æˆ‘é¦–å…ˆé€‰æ‹©äº†ç¬¬ä¸€ç§å†™æ³•let frame = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? CGRect, ä½†æ˜¯Releaseæƒ…å†µä¸‹å´å‘ç”Ÿè§£åŒ…å¤±è´¥çš„æƒ…å†µã€‚æ‰€ä»¥é‡‡ç”¨OCçš„ä¼ ç»Ÿå†™æ³•let value = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValueã€‚å°±èƒ½è§£æå‡ºæ¥ã€‚ä½†æ˜¯æ€»æ„Ÿè§‰OCçš„æ–¹æ³•ä¸å¤ŸswiftğŸ˜‚ã€‚ã€‚ã€‚ æœ‰åŒäº‹ç›´æ¥å¼ºåˆ¶è½¬æ¢ä¸ºNSValueæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œäºæ˜¯ä¹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°ç›´æ¥æ ¡éªŒNSValueå°±å¯ä»¥ã€‚ä½†æ˜¯swiftä¸­æ„Ÿè§‰ä¸åº”è¯¥æœ‰è¿™ä¸ªè½¬æ¢äº†ï¼Œæ¯•ç«Ÿæœ¬èº«å°±å¯ä»¥å­˜å‚¨CGRect.. çŒœæµ‹åŸå› ï¼šç›®å‰é˜¶æ®µSwiftçš„å­—å…¸å’ŒOCçš„å­—å…¸æ•°æ®ç»“æ„è¿˜å¹¶æœªå®Œå…¨ä¸€è‡´ã€‚ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Debug</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DEBUG - Xcode8è§£æ.crash]]></title>
    <url>%2Fdebug-xcode8-analysis-crash-file%2F</url>
    <content type="text"><![CDATA[5æ­¥è§£æ.crashæ–‡ä»¶ Xcode8ä¸­è§£æ.crashæ–‡ä»¶ å¯¼å‡ºx.crashæ–‡ä»¶ï¼Œæ”¾ç½®åœ¨ç›®å½•Aä¸‹ å¤åˆ¶å·¥ç¨‹å.app.dSYMåˆ°ç›®å½•A é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿è¡Œexport DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer æ‹·è´è„šæœ¬æ–‡ä»¶ï¼Œè¿è¡Œcp /Applications/Xcode.app/Contents/SharedFrameworks/DVTFoundation.framework/Versions/A/Resources/symbolicatecrash ç›®å½•A åˆ°ç›®å½•Aè§£æï¼Œè¿è¡Œ./symbolicatecrash x.crash å·¥ç¨‹å.app.dSYM &gt; è‡ªå®šä¹‰è¾“å‡ºç»“æœæ–‡ä»¶å]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Debug</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DEBUG - UIView.h#190]]></title>
    <url>%2Fdebug-uiview-m-190%2F</url>
    <content type="text"><![CDATA[CRASH:void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)() UIView.m:190 - UIViewReportBrokenSuperviewChainå¼‚å¸¸ä¿¡æ¯ï¼š 123*** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit/UIKit-3599.6.1/UIView.m:190invalid mode &apos;kCFRunLoopCommonModes&apos; provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.libc++abi.dylib: terminate_handler unexpectedly threw an exception å¼‚å¸¸åˆ†æ APP crashåœ¨ 1[keyWindow addSubview:weakSelf]; é”™è¯¯å †æ ˆä¿¡æ¯ã€‚ ä½†æ˜¯çœŸæ­£é€ æˆcrashçš„ä»£ç ä¸ºï¼š 1[self.layer insertSublayer:xxxView.layer atIndex:0]; è§£å†³æ–¹æ¡ˆï¼š 12[self layoutIfNeeded];[self.layer insertSublayer:xxxView.layer atIndex:0]; åŸå› åˆ†æï¼š ä¸‹é¢è¿™ä¸ªè¯´çš„å¾ˆåœ¨ç† http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation I had this issue with a library when moving over to Xcode 8 (Material-Controls-For-iOS - MDTextField). I found that the problem was coming from where the layer of one view (which had no superview) was being added to another. It looks like this may be the case for yourself also - your toolbar being created has not been added to a superview first. The fix I used was to add the view as a subview of the view that the layer was being added to, so in your case adding the toolbar as a subview of myModelView should stop the error. ç¢°åˆ°è¯¥é—®é¢˜çš„è¿˜æœ‰ Googleå‡ºæ¥çš„ä¸€ä¸ªï¼Œä½†æ˜¯å¹¶æœªçœ‹åˆ°ç›¸å…³å›å¤ã€‚ã€‚ã€‚ IOS10ä¸Šå´©æºƒé”™è¯¯â€œView has lost track of its superview, most (å¹¶æœªæ‰¾åˆ°åŸè´´) stackoverflow(è¿™ä¸ªåˆ†æçš„å¾ˆåˆ°ä½) é”™è¯¯å †æ ˆ &lt;è„±æ•&gt; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667*** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit/UIKit-3599.6.1/UIView.m:190invalid mode &apos;kCFRunLoopCommonModes&apos; provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.libc++abi.dylib: terminate_handler unexpectedly threw an exception(lldb) bt* thread #1: tid = 0x87c18, 0x000000018238c524 libobjc.A.dylib`objc_exception_throw, queue = &apos;com.apple.main-thread&apos;, stop reason = breakpoint 1.2 frame #0: 0x000000018238c524 libobjc.A.dylib`objc_exception_throw frame #1: 0x0000000183954094 CoreFoundation`+[NSException raise:format:arguments:] + 104 frame #2: 0x00000001843de898 Foundation`-[NSAssertionHandler handleFailureInFunction:file:lineNumber:description:] + 88 frame #3: 0x0000000189a7cf9c UIKit`UIViewReportBrokenSuperviewChain + 472 frame #4: 0x0000000189a7d658 UIKit`_UIViewTopDownSubtreeTraversal + 1496 frame #5: 0x000000018a0f3390 UIKit`-[UIView(UIConstraintBasedLayout_EngineDelegate) _invalidateSystemLayoutSizeFittingSizeAtEngineDelegateLevel] + 232 frame #6: 0x00000001843832ac Foundation`-[NSISEngine tryToAddConstraintWithMarker:expression:integralizationAdjustment:mutuallyExclusiveConstraints:] + 920 frame #7: 0x0000000184382dcc Foundation`-[NSLayoutConstraint _addLoweredExpression:toEngine:integralizationAdjustment:lastLoweredConstantWasRounded:mutuallyExclusiveConstraints:] + 284 frame #8: 0x00000001843809e0 Foundation`-[NSLayoutConstraint _addToEngine:integralizationAdjustment:mutuallyExclusiveConstraints:] + 272 frame #9: 0x000000018989cfdc UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 396 frame #10: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168 frame #11: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564 frame #12: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224 frame #13: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196 frame #14: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168 frame #15: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564 frame #16: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224 frame #17: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196 frame #18: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168 frame #19: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564 frame #20: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224 frame #21: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196 frame #22: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168 frame #23: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564 frame #24: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224 frame #25: 0x00000001898a4bb0 UIKit`-[UIWindow(UIConstraintBasedLayout) _switchToLayoutEngine:] + 72 frame #26: 0x00000001898a4b04 UIKit`-[UIWindow(UIConstraintBasedLayout) _initializeLayoutEngine] + 256 frame #27: 0x00000001898a4910 UIKit`-[UIView(UIConstraintBasedLayout) _layoutEngine_windowDidChange] + 132 frame #28: 0x00000001897996dc UIKit`-[UIView(Internal) _didMoveFromWindow:toWindow:] + 200 frame #29: 0x0000000189798d90 UIKit`__45-[UIView(Hierarchy) _postMovedFromSuperview:]_block_invoke + 156 frame #30: 0x0000000189798be8 UIKit`-[UIView(Hierarchy) _postMovedFromSuperview:] + 792 frame #31: 0x00000001897a4ad0 UIKit`-[UIView(Internal) _addSubview:positioned:relativeTo:] + 1788 frame #32: 0x00000001897a43bc UIKit`-[UIView(Hierarchy) addSubview:] + 828 * frame #33: 0x00000001004f78ec Project_ent`__31-[EsfCommentReportView show]_block_invoke((null)=&lt;unavailable&gt;) + 228 at EsfCommentReportView.m:293 frame #34: 0x00000001897d2b88 UIKit`+[UIView(UIViewAnimationWithBlocks) _setupAnimationWithDuration:delay:view:options:factory:animations:start:animationStateGenerator:completion:] + 660 frame #35: 0x00000001897d28e8 UIKit`+[UIView(UIViewAnimationWithBlocks) animateWithDuration:animations:] + 56 frame #36: 0x00000001004f77a0 Project_ent`-[EsfCommentReportView show](self=0x000000015fe32020, _cmd=&quot;show&quot;) + 492 at EsfCommentReportView.m:291 frame #37: 0x0000000100858a04 Project_ent`__53-[BuyerAdviserProfileViewController reportAction:]_block_invoke((null)=&lt;unavailable&gt;) + 308 at BuyerAdviserProfileViewController.m:174 frame #38: 0x00000001003f93e4 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:](self=MyLoginViewController, _cmd=&quot;ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:&quot;, viewController=0x000000015fd2e320, sourceType=2, afterCheckOrLogin=0x00000001008588d0, cancelLogin=(null)) + 236 at MyLoginViewController.m:123 frame #39: 0x00000001003f92b0 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:](self=MyLoginViewController, _cmd=&quot;ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:&quot;, viewController=0x000000015fd2e320, afterCheckOrLogin=0x00000001008588d0, cancelLogin=(null)) + 156 at MyLoginViewController.m:114 frame #40: 0x00000001003f9124 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:](self=MyLoginViewController, _cmd=&quot;ifShouldLoginFromViewController:afterCheckOrLogin:&quot;, viewController=0x000000015fd2e320, afterCheckOrLogin=0x00000001008588d0) + 120 at MyLoginViewController.m:104 frame #41: 0x0000000100858870 Project_ent`-[BuyerAdviserProfileViewController reportAction:](self=0x000000015fd2e320, _cmd=&quot;reportAction:&quot;, button=0x000000015fe26650) + 452 at BuyerAdviserProfileViewController.m:156 frame #42: 0x00000001897d27b0 UIKit`-[UIApplication sendAction:to:from:forEvent:] + 96 frame #43: 0x00000001897d2730 UIKit`-[UIControl sendAction:to:forEvent:] + 80 frame #44: 0x00000001897bcbe4 UIKit`-[UIControl _sendActionsForEvents:withEvent:] + 452 frame #45: 0x00000001897d201c UIKit`-[UIControl touchesEnded:withEvent:] + 584 frame #46: 0x00000001897d1b44 UIKit`-[UIWindow _sendTouchesForEvent:] + 2484 frame #47: 0x00000001897ccd8c UIKit`-[UIWindow sendEvent:] + 2988 frame #48: 0x000000018979d858 UIKit`-[UIApplication sendEvent:] + 340 frame #49: 0x0000000189f8acb8 UIKit`__dispatchPreprocessedEventFromEventQueue + 2736 frame #50: 0x0000000189f84720 UIKit`__handleEventQueue + 784 frame #51: 0x0000000183902278 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 24 frame #52: 0x0000000183901bc0 CoreFoundation`__CFRunLoopDoSources0 + 524 frame #53: 0x00000001838ff7c0 CoreFoundation`__CFRunLoopRun + 804 frame #54: 0x000000018382e048 CoreFoundation`CFRunLoopRunSpecific + 444 frame #55: 0x00000001852b1198 GraphicsServices`GSEventRunModal + 180 frame #56: 0x0000000189808628 UIKit`-[UIApplication _run] + 684 frame #57: 0x0000000189803360 UIKit`UIApplicationMain + 208 frame #58: 0x0000000100a3db78 Project_ent`main + 460 at main.swift:24 frame #59: 0x00000001828105b8 libdyld.dylib`start + 4(lldb)]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Debug</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Xcodeæ‰“åŒ…è„šæœ¬]]></title>
    <url>%2Fbuild-ipa-sh%2F</url>
    <content type="text"><![CDATA[Jenkinsè‡ªåŠ¨æ„å»ºè„šæœ¬è§£å†³æ–¹æ¡ˆã€‚ å†™åœ¨å‰é¢2017.9.26æ›´æ–°ï¼šxcode9æ›´æ–°åˆæ— æ³•æ„å»ºå’¯ 2017.6.14æ›´æ–°:xcprettyæ ¼å¼åŒ–è¾“å‡ºæ—¥å¿—ã€‚å¾ˆæºœï¼Œè¾“å‡ºæ•ˆæœå’Œ fastlane å·®ä¸å¤šå“ˆå“ˆ 2017.1.13æ›´æ–°ï¼š å¥½å§ï¼Œå…¶å®æœ‰æ›´åŠ å¼ºæ‚çš„æ‰“åŒ…å·¥å…·ï¼Œè™½ç„¶æ—©æœ‰è€³é—»ä½†æ˜¯æ²¡å¼„ã€‚ç„¶åæœ€è¿‘æ­å»ºäº†ä¸€ä¸‹ï¼Œè¿™æ‰“åŒ…è„šæœ¬ä¹Ÿä¸ç”¨äº†ï¼Œæ¯•ç«Ÿæœ‰æˆå¥—å·¥å…·å˜›ã€‚å˜¿å˜¿ ä¸è¿‡æœ€åä¸Šä¼ oscçš„è„šæœ¬è¿˜æ˜¯å¾ˆå¯ä»¥çš„ã€‚ ä¼ é€é—¨ï¼šFastlaneè‡ªåŠ¨åŒ–ç¬”è®° Xcode8å¥½æ‚²å‚¬ï¼ŒXcode8æ›´æ–°ä¹‹åJenkinsæ‰“åŒ…å¤±è´¥äº†ã€‚ã€‚ç”±äºä»£ç åº“ä¸­ä½¿ç”¨äº†swift3è¯­æ³•ï¼Œæ•…å¿…é¡»ä½¿ç”¨Xcode8ã€‚ã€‚ å…ˆæ¥é‡ç‚¹ï¼šå¯ç”¨è„šæœ¬ï¼š 12345678910111213141516171819202122232425#!/bin/bash# è¿½ä¸Šfir API token è‡ªåŠ¨ä¸Šä¼ # åŸºäºå½“å‰ä»£ç è¿›è¡Œæ‰“åŒ…æ‰“åŒ…ç›®å½•ï¼šMyProject/build/MyProject_ent.ipacd MyProjectrm -rf ./build/*xcodebuild -archivePath "./build/xxx.xcarchive" -workspace MyProject.xcworkspace -sdk iphoneos -scheme "MyProject_ent" -configuration "Release Inhouse" archiveecho "&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;&lt;plist version="1.0"&gt;&lt;dict&gt;&lt;key&gt;method&lt;/key&gt;&lt;string&gt;enterprise&lt;/string&gt;&lt;key&gt;compileBitcode&lt;/key&gt;&lt;string&gt;YES&lt;/string&gt;&lt;/dict&gt;&lt;/plist&gt;" &gt; ./build/exportOptionsPlist.plistxcodebuild -exportArchive -archivePath "./build/xxx.xcarchive" -exportPath "./build/" -exportOptionsPlist ./build/exportOptionsPlist.plistcd build/fir i ./MyProject_ent.ipaif [ -n "$1" ]; then git log -10 &gt; git.log fir p ./MyProject_ent.ipa -T $1 -c git.logfi ä¹‹å‰æ¼æ‰äº†ä¸€ä¸ªé”™è¯¯ï¼šThe flag -exportFormat cannot be specified along with -exportOptionsPlist å¯¼è‡´äº†æœ€ç»ˆåŒ…ç­¾åé”™è¯¯ï¼Œè€Œæ— æ³•å®‰è£…ã€‚ exportOptionsPlistå‚è€ƒçš„iOS æ‰“åŒ…æ€»ç»“ æ‰‹åŠ¨ä¸Šä¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133#!/bin/bash# è¿½ä¸Šfir API token è‡ªåŠ¨ä¸Šä¼ # åŸºäºå½“å‰ä»£ç è¿›è¡Œæ‰“åŒ…æ‰“åŒ…ç›®å½•ï¼šxxxx/build/xxxx_ent.ipaworkspace_name=xxxxscheme_name=xxxx_entcd $workspace_namerm -rf ./build/*xcodebuild -archivePath &quot;./build/xxx.xcarchive&quot; -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration &quot;Release Inhouse&quot; archivecat &lt;&lt; EOF &gt; ./build/exportOptionsPlist.plist&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt; &lt;dict&gt; &lt;key&gt;method&lt;/key&gt; &lt;string&gt;enterprise&lt;/string&gt; &lt;key&gt;compileBitcode&lt;/key&gt; &lt;false/&gt; &lt;/dict&gt;&lt;/plist&gt;EOFxcodebuild -exportArchive -archivePath &quot;./build/xxx.xcarchive&quot; -exportOptionsPlist &quot;./build/exportOptionsPlist.plist&quot; -exportPath &quot;./build/&quot;cd build/git log -10 &gt; git.log#æ‹·è´ipaåˆ°ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­cp ./$scheme_name.ipa ./tmp.zip#å°†ipaè§£å‹unzip tmp.zip#appæ–‡ä»¶ä¸­Info.plistæ–‡ä»¶è·¯å¾„app_infoplist_path=$(pwd)/Payload/*.app/Info.plist#å–bundleIdentifierbundleIdentifier=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleIdentifier&quot; $&#123;app_infoplist_path&#125;)#å–buildå€¼bundleVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleVersion&quot; $&#123;app_infoplist_path&#125;)#æ˜¾ç¤ºåç§°ipa_name=$workspace_name#ipaä¸‹è½½urlipa_download_url=&quot;https://***/install_ipa/raw/master/xxxx_ent.ipa&quot;#itms-servicesåè®®ä¸²ios_install_url=&quot;itms-services://?action=download-manifest&amp;url=https://***/install_ipa/raw/master/xxxx_ent.plist&quot;#ç”Ÿæˆinstall.htmlæ–‡ä»¶cat &lt;&lt; EOF &gt; index.html&lt;!DOCTYPE HTML&gt;&lt;html&gt; &lt;head&gt; &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt; &lt;title&gt;å®‰è£…&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;p align=center&gt; &lt;font size=&quot;8&quot;&gt; &lt;a href=&quot;$&#123;ios_install_url&#125;&quot;&gt;ç‚¹å‡»è¿™é‡Œå®‰è£…&lt;/a&gt; &lt;/font&gt; &lt;/p&gt; &lt;/div&gt; &lt;/body&gt;&lt;/html&gt;EOF#ç”Ÿæˆplistæ–‡ä»¶cat &lt;&lt; EOF &gt; $&#123;workspace_name&#125;.plist&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt;&lt;dict&gt; &lt;key&gt;items&lt;/key&gt; &lt;array&gt; &lt;dict&gt; &lt;key&gt;assets&lt;/key&gt; &lt;array&gt; &lt;dict&gt; &lt;key&gt;kind&lt;/key&gt; &lt;string&gt;software-package&lt;/string&gt; &lt;key&gt;url&lt;/key&gt; &lt;string&gt;$&#123;ipa_download_url&#125;&lt;/string&gt; &lt;/dict&gt; &lt;dict&gt; &lt;key&gt;kind&lt;/key&gt; &lt;string&gt;display-image&lt;/string&gt; &lt;key&gt;needs-shine&lt;/key&gt; &lt;true/&gt; &lt;key&gt;url&lt;/key&gt; &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt; &lt;/dict&gt; &lt;dict&gt; &lt;key&gt;kind&lt;/key&gt; &lt;string&gt;full-size-image&lt;/string&gt; &lt;key&gt;needs-shine&lt;/key&gt; &lt;true/&gt; &lt;key&gt;url&lt;/key&gt; &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt; &lt;/dict&gt; &lt;/array&gt;&lt;key&gt;metadata&lt;/key&gt; &lt;dict&gt; &lt;key&gt;bundle-identifier&lt;/key&gt; &lt;string&gt;$&#123;bundleIdentifier&#125;&lt;/string&gt; &lt;key&gt;bundle-version&lt;/key&gt; &lt;string&gt;$&#123;bundleVersion&#125;&lt;/string&gt; &lt;key&gt;kind&lt;/key&gt; &lt;string&gt;software&lt;/string&gt; &lt;key&gt;subtitle&lt;/key&gt; &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt; &lt;key&gt;title&lt;/key&gt; &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt; &lt;/dict&gt; &lt;/dict&gt; &lt;/array&gt;&lt;/dict&gt;&lt;/plist&gt;EOFfir i $scheme_name.ipa æ‰‹åŠ¨ä¸Šä¼ åˆ°OSCè„šæœ¬123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232#!/bin/bashroot_path=$(pwd)workspace_name=Fangduoduoscheme_name=XXX# ç¼–è¯‘cd $root_pathcd $workspace_namerm -rf ./build/*xcodebuild -archivePath ./build/$scheme_name.xcarchive -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration &quot;Release Inhouse&quot; archiveecho &quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt;&lt;dict&gt;&lt;key&gt;method&lt;/key&gt;&lt;string&gt;enterprise&lt;/string&gt;&lt;key&gt;compileBitcode&lt;/key&gt;&lt;false/&gt;&lt;/dict&gt;&lt;/plist&gt;&quot; &gt; ./build/exportOptionsPlist.plistxcodebuild -exportArchive -archivePath ./build/$scheme_name.xcarchive -exportOptionsPlist &quot;./build/exportOptionsPlist.plist&quot; -exportPath &quot;./build/&quot;cd build/if [ ! -f $scheme_name.ipa ]; then echo &quot;*** æ— æ³•æ‰“åŒ… ***&quot; exit -1fifir i ./$scheme_name.ipagit log -10 &gt; git.loggit_log=$(cat git.log)# fir ä¸Šä¼ if [ -n &quot;$1&quot; ]; then fir p ./$scheme_name.ipa -T $1 -c git.logfi# æ ¡éªŒHTMLå¹¶ä¸Šä¼ public_git_path=$root_path/public_ipa_tmp/public_git_root=&quot;install_ipa&quot;public_git=&quot;https://***/install_ipa.git&quot;#ipaä¸‹è½½urlipa_download_url=&quot;https://***/install_ipa/raw/master/XXX.ipa&quot;#itms-servicesåè®®ä¸²ios_install_url=&quot;itms-services://?action=download-manifest&amp;url=https://***/install_ipa/raw/master/XXX.plist&quot;cd $root_path/# checkout path is OKif [ ! -e $public_git_path ]; then mkdir $public_git_pathfiif [ -n $public_git_path ]; then rm -rf $public_git_pathfimkdir $public_git_pathcd $public_git_pathgit initgit remote add origin $public_gitcd $root_path/$workspace_name/build/#æ‹·è´ipaåˆ°ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­cp ./$scheme_name.ipa ./tmp.ziprm -rf Payload#å°†ipaè§£å‹unzip tmp.zip#appæ–‡ä»¶ä¸­Info.plistæ–‡ä»¶è·¯å¾„app_infoplist_path=$(pwd)/Payload/*.app/Info.plist#å–bundleIdentifierbundleIdentifier=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleIdentifier&quot; $&#123;app_infoplist_path&#125;)#å–buildå€¼bundleVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleVersion&quot; $&#123;app_infoplist_path&#125;)#å–shortVersionbuildå€¼shortVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleShortVersionString&quot; $&#123;app_infoplist_path&#125;)#æ˜¾ç¤ºåç§°ipa_name=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleDisplayName&quot; $&#123;app_infoplist_path&#125;)nowTime=$(date +%Y-%m-%d\ %H:%M)log_url=&quot;https://madordie.github.io/uploads/avatar.png&quot;#ç”Ÿæˆinstall.htmlæ–‡ä»¶cat &lt;&lt; EOF &gt; index.html&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0&quot;&gt;&lt;title&gt;$&#123;ipa_name&#125;å®‰è£…&lt;/title&gt;&lt;style&gt;.containor &#123; position: relative; top: 0; left: 0; right: 0; margin: 0 auto; width: 100%; max-width: 640px; text-align: center;&#125;.logo &#123; width: 120px; margin-top: 30px;&#125;.title,.version_history,.update_time &#123; text-align: center; color: #999; font-size: 16px;&#125;.title &#123; margin-top: 10px;&#125;.version_history,.update_time &#123; margin-top: 5px;&#125;.download &#123; display: block; width: 150px; height: 30px; line-height: 30px; margin: 0 auto; margin-top: 20px; border: 1px solid #eee; border-radius: 20px; text-decoration: none; color: #999;&#125;.log_title &#123; margin-top: 20px; font-size: 18px; color: #333;&#125;.log &#123; color: #aaa; padding: 20px; text-align: left; font-size: 12px; line-height: 15px; white-space: pre-wrap; word-wrap: break-word; overflow: hidden;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=&quot;containor&quot;&gt; &lt;img class=&quot;logo&quot; src=$&#123;log_url&#125; /&gt; &lt;div class=&quot;title&quot;&gt;$ipa_name&lt;/div&gt; &lt;div class=&quot;version_history&quot;&gt;$&#123;shortVersion&#125;(bundle:$&#123;bundleVersion&#125;)&lt;/div&gt; &lt;div&gt;&lt;/div&gt; &lt;div class=&quot;update_time&quot;&gt;$&#123;nowTime&#125;&lt;/div&gt; &lt;a class=&quot;download&quot; href=&quot;$&#123;ios_install_url&#125;&quot;&gt;ç‚¹å‡»è¿™é‡Œå®‰è£…&lt;/a&gt; &lt;div class=&quot;log_title&quot;&gt;æ›´æ–°æ—¥å¿—&lt;/div&gt; &lt;div class=&quot;log&quot;&gt; $&#123;git_log&#125; &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;EOF#ç”Ÿæˆplistæ–‡ä»¶cat &lt;&lt; EOF &gt; $&#123;scheme_name&#125;.plist&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt;&lt;dict&gt; &lt;key&gt;items&lt;/key&gt; &lt;array&gt; &lt;dict&gt; &lt;key&gt;assets&lt;/key&gt; &lt;array&gt; &lt;dict&gt; &lt;key&gt;kind&lt;/key&gt; &lt;string&gt;software-package&lt;/string&gt; &lt;key&gt;url&lt;/key&gt; &lt;string&gt;$&#123;ipa_download_url&#125;&lt;/string&gt; &lt;/dict&gt; &lt;dict&gt; &lt;key&gt;kind&lt;/key&gt; &lt;string&gt;display-image&lt;/string&gt; &lt;key&gt;needs-shine&lt;/key&gt; &lt;true/&gt; &lt;key&gt;url&lt;/key&gt; &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt; &lt;/dict&gt; &lt;dict&gt; &lt;key&gt;kind&lt;/key&gt; &lt;string&gt;full-size-image&lt;/string&gt; &lt;key&gt;needs-shine&lt;/key&gt; &lt;true/&gt; &lt;key&gt;url&lt;/key&gt; &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt; &lt;/dict&gt; &lt;/array&gt;&lt;key&gt;metadata&lt;/key&gt; &lt;dict&gt; &lt;key&gt;bundle-identifier&lt;/key&gt; &lt;string&gt;$&#123;bundleIdentifier&#125;&lt;/string&gt; &lt;key&gt;bundle-version&lt;/key&gt; &lt;string&gt;$&#123;bundleVersion&#125;&lt;/string&gt; &lt;key&gt;kind&lt;/key&gt; &lt;string&gt;software&lt;/string&gt; &lt;key&gt;subtitle&lt;/key&gt; &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt; &lt;key&gt;title&lt;/key&gt; &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt; &lt;/dict&gt; &lt;/dict&gt; &lt;/array&gt;&lt;/dict&gt;&lt;/plist&gt;EOF#fir i $scheme_name.ipacp $scheme_name.ipa $public_git_pathcp $scheme_name.plist $public_git_pathcp index.html $public_git_pathcd $public_git_pathls -l &gt; README.mdif [ ! -e &quot;./.git/&quot; ]; then echo &quot;*** OSCçš„gitç›®å½•ä¸å®Œæ•´ï¼Œæ— æ³•ä¸Šä¼ ï¼Œè¯·è”ç³»å¼€å‘! ***&quot; exit -1fiecho &quot;commit and pushing ...&quot;git add .git commit -am $bundleVersiongit push -f origin master å°†ç¬¦å·è¡¨dsymä¸Šä¼ è‡³bugly1234567891011121314151617181920212223242526272829path='/Users/xx/.jenkins/workspace/xzx'schem='xx'package='xx'bugly_id='xx'bugly_key='xx'cp $&#123;path&#125;/xx/Info.plist ./Info.plistcp $&#123;path&#125;/xx.app.dSYM.zip ./dsym.zip# ------------ post dsym ------------ #unzip -o dsym.zip -d dsymapp_infoplist_path='Info.plist'version=$(/usr/libexec/PlistBuddy -c "print CFBundleVersion" $&#123;app_infoplist_path&#125;)java -jar ./bugly/buglySymboliOS.jar \ -i dsym/$&#123;scheme&#125; \ -dsym \ -u \ -id $&#123;bugly_id&#125; \ -key $&#123;bugly_key&#125; \ -package $&#123;package&#125; \ -version $&#123;version&#125;# ------------ UUID ------------ #unzip -o ./dsym/$&#123;scheme&#125;.zipxcrun dwarfdump --uuid ./$&#123;scheme&#125; &gt;&gt; ./uuids-$&#123;version&#125;.txt ä¿®æ”¹ç¯å¢ƒä»£ç 1sed -i '' "s/#define RELEASE_MODE [[:digit:]]/#define RELEASE_MODE $&#123;mode&#125;/g" ./Fangduoduo/config/AppConfig.h Jenkinså®‰è£… Installing Jenkins OS X Homebrew åå°è¿è¡Œ1brew services start jenkins æ— æ³•è¯†åˆ«gerritâ€¦. 1nohup jenkins &gt; ~/fdd-backup/jenkins.log g 2&gt;&amp;1 &amp; æ— æ³•ç­¾åâ€¦ ä¸Šé¢2ä¸ªæ–¹æ¡ˆå¹¶ä¸æ˜¯ä¸èƒ½è¿è¡Œï¼Œè€Œæ˜¯éœ€è¦é¢å¤–é…ç½®ã€‚ã€‚ğŸ˜‚ https://gxnotes.com/article/61107.html]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[UIç´ æä¸ä»£ç è§£è€¦çš„è®¨è®ºä¸æ€è€ƒ]]></title>
    <url>%2Fui-source-and-code-decoupling%2F</url>
    <content type="text"><![CDATA[ä¸ªäººå¯¹UIç´ æå’Œä»£ç çš„è§£è€¦çš„ä¸€äº›ç²—æµ…çš„çœ‹æ³•ã€‚æ¯”å¦‚ï¼šè§£è€¦æ–¹æ¡ˆã€æ˜¯å¦è¯¥è§£è€¦ã€‚ èµ·å›  ç¾¤é‡Œå¬åˆ°æœ‰äººè®¨è®ºè¿™ä¸ªè¯é¢˜ï¼Œå½“æ—¶è§‰å¾—æ¯”è¾ƒæ–°é²œï¼Œå°±ååˆ†å¥½å¥‡çš„è¯·æ•™äº†ä¸¤ä½ç»éªŒä¸°å¯Œçš„@kkkã€@AKï¼Œè™½ç„¶æœªå¾—å…¶ä¸­çœŸé«“ï¼Œä½†æ˜¯ä¹Ÿå¾—åˆ°ä¸€äº›è‡ªå·±çš„æ€è€ƒã€‚æ€»ç»“ä¸€ä¸‹ä¸¤äººçš„æ–¹æ¡ˆï¼Œä»¥åŠè‡ªå·±çš„æ€è€ƒï¼Œ é—®é¢˜ ä»£ç å†…éƒ¨å¼•å…¥çš„ç´ æå±äºè®¾è®¡ç®¡ç†ï¼Œä»£ç åˆ™æ˜¯ç å†œç®¡ç†ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ä¸¤ä¸ªå·¥åšéƒ½æœ‰ç å†œç®¡ç†åˆ™æ˜¯ä¸€ç§è€¦åˆï¼Œä¸ºäº†å‡è½»è®¾è®¡å¸ˆé¢‘ç¹æ›´æ¢ç´ æè€Œå¸¦æ¥çš„ç å†œçš„æ— ä¼‘æ­¢çš„åä½œï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œç€æ–¹é¢çš„è§£è—•ã€‚ è§£å†³æ–¹æ¡ˆ å“ªåå“ªè¡¥ã€‚æœ‰é—®é¢˜å°±ä¼šæœ‰è§£å†³æ–¹æ¡ˆã€‚ç¾¤ä¸­è¯´çš„æ–¹æ¡ˆä¸€ç”±äºå½“æ—¶ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰å¼„æ˜ç™½ã€‚æ–¹æ¡ˆäºŒã€æ–¹æ¡ˆä¸‰æ˜¯è‡ªå·±çš„ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚ æ–¹æ¡ˆä¸€ ç¾¤ä¸­è®¨è®ºçš„æ˜¯ç´ æã€ä»£ç æ”¾åœ¨ä¸€ä¸ªä»“åº“ï¼Œåˆ†æ”¯ä¸åŒï¼Œä½¿ç”¨è„šæœ¬è¿›è¡Œæ•´åˆ(å…¶å®å¹¶æ²¡æœ‰æƒ³æ˜ç™½æ€ä¹ˆå¼„ã€‚ã€‚ä¸‹å‘¨è¯·æ•™ä¸€ä¸‹)ã€‚å¦å¤–ï¼Œ@å¤æ±æ³¡æ³¡ è¿˜æœ‰ä¸€ä¸ªç®€åŒ–å°±æ˜¯è¿™ä¸ªå¤„ç†çš„è„šæœ¬å¯ä»¥æ”¾åœ¨Add Run Script Build Phaseï¼Œæš´éœ²å‡ºæ¥å·²çŸ¥çš„é—®é¢˜ï¼š æ“ä½œéº»çƒ¦ å›¾ç‰‡å¯èƒ½é‡å¤ å‘½åè§„èŒƒ æ–¹æ¡ˆäºŒ æŒ‰ç…§Podsçš„é›†æˆæ–¹å¼ï¼Œå¯ä»¥å°†ç´ æçœ‹ä½œä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œç›´æ¥å°†ç´ æåšæˆä¸€ä¸ªbundleï¼Œé‡‡ç”¨Podsç§æœ‰åº“æˆ–è€…å…¶ä»–æ–¹å¼æ”¾å…¥å·¥ç¨‹ã€‚æš´éœ²å‡ºæ¥å·²çŸ¥çš„é—®é¢˜ï¼š ä»€ä¹ˆæ—¶å€™æ›´æ–°è¿™ä¸ªbundle å¤šäººåˆä½œæ—¶è¿™ä¸ªbundleå†²çªé—®é¢˜ å‘½åè§„èŒƒ æ–¹æ¡ˆä¸‰ å·¥ç¨‹ä½¿ç”¨xcassetsè¿›è¡Œç´ ææ‰“åŒ…ï¼Œç„¶åä½¿ç”¨å­åº“è¿›è¡ŒæŒç»­é›†æˆã€‚è¿™æ ·ï¼Œè®¾è®¡å¸ˆçš„ç´ æå¯ä»¥æ”¾åœ¨å¦ä¸€ä¸ªç‹¬ç«‹ç´ æä»“åº“ï¼Œå†…å«æ›´æ–°è„šæœ¬ï¼Œç›´æ¥å°†ç´ æç”Ÿæˆå¯¹åº”çš„xcassetsç»“æ„ï¼Œå¹¶ä¸Šä¼ è‡³å­åº“ã€‚è¿™æ ·è®¾è®¡å¸ˆåšå®Œç´ æç›´æ¥æ‰”åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œè‡ªåŠ¨æˆ–æ‰‹åŠ¨è·‘ä¸€ä¸‹è„šæœ¬å³å¯æ›´æ–°åˆ°ç´ æä»“åº“ã€‚æš´éœ²å‡ºæ¥å·²çŸ¥çš„é—®é¢˜ï¼š ç”±äºæ²¡æœ‰æµ‹è¯•è¿‡ï¼Œä¸çŸ¥é“å¦‚æœç´ ææ¯”è¾ƒå¤šçš„è¯ä¼šä¸ä¼šå‘ç”Ÿå†²çªã€‚å› è¯¥ä¸ä¼šå§ï¼Œéƒ½æ˜¯åŠ æ–‡ä»¶æˆ–è€…ä¿®æ”¹ğŸ˜‚ (æœ‰æ—¶é—´å»ç ”ç©¶ä¸€ä¸‹ä¹‹åæ›´æ–°) å‘½åè§„èŒƒçš„é—®é¢˜ä¾æ—§å­˜åœ¨ æ–¹æ¡ˆå›› å­—ä½“åº“ ã€‚æœ€è¿‘åŒäº‹æå‡ºå…³äºç”¨å­—ä½“åº“å»å­˜å‚¨ç´ æå›¾ç‰‡çš„æ–¹æ¡ˆã€‚æ„Ÿè§‰éå¸¸çš„èµï¼Œè™½ç„¶å¹¶æœªå®è·µï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆå°±åƒemojiä¸€æ ·ï¼Œä¸ä½†å‡å°‘äº†ç›¸åŒå›¾ç‰‡å†…å®¹ä¹‹é—´å­˜åœ¨å¤šä¸ªä¸åŒå°ºå¯¸ç‰ˆæœ¬çš„é—®é¢˜ï¼Œä¹Ÿèƒ½å¤Ÿæ¯”è¾ƒå¥½çš„è¿›è¡Œå‹ç¼©ç®¡ç†ã€‚è®¾è®¡å¸ˆéœ€è¦åšçš„å°±æ˜¯åšå‡ºä¸€å¥—å­—ä½“åº“ï¼Œç„¶åå°†æ‰€æœ‰çš„ç´ æå›¾å…¨éƒ¨æŒ‰ç…§è®¾è®¡å­—ä½“çš„æ–¹æ¡ˆè¿›è¡Œè®¾è®¡å’Œåˆ¶ä½œï¼Œè¿™æ ·åœ¨ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦å¯¼å…¥ä¸€ä¸ªå­—ä½“æ–‡ä»¶å°±å¥½äº†ã€‚å¯¹äºè¿™ä¸ªå­—ä½“æ–‡ä»¶å¦‚ä½•ç®¡ç†éƒ½å¥½è¯´ï¼Œæ¯•ç«Ÿåªæœ‰ä¸€ä¸ªå­—ä½“æ–‡ä»¶ã€‚å­—ä½“åº“çš„åˆ¶ä½œæ–¹é¢è¿˜ä¸æ˜¯å¾ˆäº†è§£ï¼Œæ‰€ä»¥åªæç€ä¹ˆä¸€ä¸‹å§å˜¿å˜¿ã€‚ã€‚ æ€è€ƒ å¥½äº†ï¼Œé‡è¦çš„é—®é¢˜æ¥äº†ï¼Œä¸Šé¢çš„é—®é¢˜éƒ½æ˜¯å­˜åœ¨å‘½åè§„èŒƒçš„é—®é¢˜ã€‚æ­¤é—®é¢˜å¦‚ä½•åŒ–è§£å‘¢ï¼Ÿ ç´ æçš„å¼•å…¥éœ€æ ¹æ®ç´ æåå†™å…¥ä»£ç ä¸­ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰èƒ½ä¸ç”¨ç´ æåå‘¢ï¼Ÿé‚£æ—¶ä¸å¯èƒ½çš„ğŸ˜ï¼Œæ¯•ç«Ÿä½ è¦æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦å»æ ‡å¿—ç€ä¸€ä¸ªç´ æã€‚å¯èƒ½æœ‰çš„äººè¯´å¯ä»¥åšä¸€ä¸ªjsonç”¨æ¥ä¿å­˜ä»£ç çš„å‘½åå’Œç´ æçš„å‘½åå‘€ï¼Œæˆ‘åªæƒ³è¯´MDZZï¼Œé‚£ä¸æ˜¯æœ‰ä¸¤å¥—éœ€è¦ç»´æŠ¤çš„å‘½åè§„åˆ™ä¹ˆã€‚ã€‚å¾—ä¸å¿å¤±ã€‚ è¿™ä¸ªå‘½åçš„é—®é¢˜å…¶å®ä¸èƒ½å¤æ‚åŒ–ã€‚å‚çœ‹iOSçš„é¡¹ç›®å›½é™…åŒ–æ“ä½œï¼Œä½¿ç”¨ä¸€ä¸ªkeyä½œä¸ºæ–‡æ¡ˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œéœ€è¦æ˜¾ç¤ºè¯¥æ–‡æ¡ˆï¼Œé€šè¿‡è¿™ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦å°±èƒ½ç›´æ¥å–åˆ°ã€‚å›å¤´çœ‹ä¸‹ç´ æï¼Œæ˜¯ä¸æ˜¯ä¹Ÿèƒ½ç‚®åˆ¶ä¸€ä¸ªå‘¢ï¼Ÿ å¦‚æœç´ æåå­—æœ‰ç»Ÿä¸€çš„è§„åˆ™ï¼Œå°±ä¸éœ€è¦è¿™æ ·çš„keyä½œä¸ºç»Ÿä¸€æ ‡è¯†ç¬¦ï¼Œç›´æ¥ä½¿ç”¨ç´ æåå­—å³å¯ï¼Œè¿™æ ·ç»´æŠ¤ä¸€å¥—ç´ æå‘½åè§„åˆ™æ€»æ¯”ä¸¤å¥—æ›´å®¹æ˜“ç»´æŠ¤ã€‚æ‰€ä»¥ï¼Œç›´æ¥ä½¿ç”¨ç´ æåå³å¯ã€‚ å¦‚æœç´ æä¸èƒ½ç»Ÿä¸€å‘½åè§„åˆ™ï¼Œé‚£ä¹ˆè¿™æ ·çš„å¯¹ç…§æ–‡ä»¶å­˜åœ¨ä¹Ÿæ˜¯å¾ˆä¸é”™çš„ã€‚è¯åˆè¯´å›æ¥ï¼Œè¦è¿›è¡ŒUIç´ æå’Œä»£ç çš„è§£è€¦ï¼Œç´ æåéƒ½ä¸èƒ½ç»Ÿä¸€ï¼Œè¿˜å¦‚ä½•è§£è€¦ï¼Œæ­¤é—®é¢˜ä¹Ÿä¸å­˜åœ¨äº†ã€‚ã€‚ é€€ä¸€æ­¥ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è®©ç´ æè®©è®¾è®¡å¸ˆè‡ªå·±ç»´æŠ¤ï¼Œä»£ç ä¸å»ç»´æŠ¤ç´ æã€‚è®¾è®¡å¸ˆå’Œç å†œçš„è€¦åˆåœ¨äºå›¾ç‰‡æœ¬èº«çš„äº¤æ¢æ¯”è¾ƒçƒ¦ã€‚ä¸è®ºé‡‡ç”¨å“ªç§è§£è€¦æ–¹æ¡ˆï¼Œéƒ½æ˜¯æŠŠå›¾ç‰‡çš„è€¦åˆè½¬æ¢ä¸ºå›¾ç‰‡åå­—çš„è€¦åˆ(ä¹Ÿå¯ä»¥ç†è§£ä¸ºç´ æå¯¹åº”çš„KEYçš„è€¦åˆ)ã€‚ç»“æœæ˜¯ ä¸ºäº†è§£é™¤ä¸€ä¸ªè€¦åˆ,è€Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„è€¦åˆ ã€‚ä¸ªäººè®¤ä¸ºè¿™æ ·æ˜¯ä¸é è°±çš„ã€‚ã€‚é™¤éæœ‰å¼ºåŠ›çš„äººå»æ¨åŠ¨è®¾è®¡å¸ˆèµ°æ ‡å‡†çš„å‘½åã€‚ ç»“è®º å…¶å®è¿™ä¸ªé—®é¢˜å¤§å¯ä¸å¿…çº ç»“ï¼Œå¦‚æœæœ‰å¼ºåŠ›çš„äººå»æ¨åŠ¨è¿™ä¸ªæ ‡å‡†æŒç»­èµ°ä¸‹å»é‚£ä¹ˆè¿™ä¸ªé—®é¢˜æ‰æœ‰ä»·å€¼ã€‚å¦‚æœçœŸçš„è¦è¿›è¡Œé¢˜ä¸­è¯´çš„ä»£ç è§£è€¦çš„è¯ï¼Œæˆ‘è®¤ä¸ºç¬¬ä¸‰ç§æ˜¯æ¯”è¾ƒé è°±çš„ã€‚ å‘½åæ ‡å‡†ã€å‘½åæ ‡å‡†ã€å‘½åæ ‡å‡†â€¦ ã€‚ è¯´æ˜ ç»éªŒæœ‰é™ï¼Œå¦‚æœæœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œæœ›å‘ŠçŸ¥ã€‚æ‹œè°¢ï¼]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¼€å‘å°è®°]]></title>
    <url>%2Fnote%2F</url>
    <content type="text"><![CDATA[å¼€å‘ä¸­çš„å°ç¬”è®°ã€‚è®°å½•å¼€å‘ä¸­çš„ç‚¹æ»´æ»´ç‚¹ã€‚ æ‰¹é‡æ›¿æ¢jsonæ–‡ä»¶ä¸­çš„æ³¨é‡Šå¤‡ä»½è‡³.bat 1$ perl -i.bat -lpe 's/\/\/[^"]+$//g' xx æ‰¹é‡æ­£åˆ™æ›¿æ¢çš„å¦ä¸€ç§æ€è·¯ 1234#!/base/shfind . -name &apos;*.swift&apos; | while read file; do perl -i -lpe &apos;s/if \(([^\)].*)\) \&#123;/if $1 \&#123;/g&apos; $filedone æ‰¹é‡åˆ é™¤ç©ºæ ¼ç»„æˆçš„ç©ºè¡Œä¸­çš„ç©ºæ ¼ 1234#!/base/shfind . -name &apos;*.swift&apos; | while read file; do sed -i &apos;&apos; &apos;s/^[[:space:]][[:space:]]*$//g&apos; $filedone è·å–ä»£ç æ‰§è¡Œæ—¶é—´ 1234567891011121314151617181920212223242526272829#import &lt;mach/mach_time.h&gt;static NSMutableDictionary *__times;static inline void debug_start_of(NSString *key)&#123; __times = __times ?: [NSMutableDictionary new]; uint64_t start = mach_absolute_time(); __times[key] = @(start);&#125;static inline void debug_stop_of(NSString *key)&#123; if (__times) &#123; uint64_t end = mach_absolute_time(); uint64_t start = [__times[key] unsignedLongLongValue]; if (start != 0) &#123; uint64_t elapsed = end - start; mach_timebase_info_data_t info; if (mach_timebase_info(&amp;info) != KERN_SUCCESS) &#123; printf("mach_timebase_info failed\n"); &#125; uint64_t nanosecs = elapsed * info.numer / info.denom; uint64_t millisecs = nanosecs / 1000000; printf("[DEBUG code rt] %s:%llu ms\n", [key cStringUsingEncoding:NSUTF8StringEncoding], millisecs); &#125; else &#123; printf("[DEBUG code rt] %s error: no start\n", [key cStringUsingEncoding:NSUTF8StringEncoding]); &#125; &#125;&#125; NAN Aå¯¹Bé™¤ä½™æ—¶ï¼Œå¦‚æœB == 0 åˆ™ä¼šé€ æˆNANï¼ŒtruncatingRemainder(dividingBy:)æ˜¯swiftçš„æ–¹æ³•ï¼Œä¹Ÿä¼šé€ æˆæ­¤é—®é¢˜ å½“NSUInteger 0 - 1æ—¶ï¼Œè¿ç®—ç»“æœä¸º NANï¼ŒiOSä¸­æœ‰ä¸€ä¸ªå®isnan(x)è¿”å›æ˜¯å¦ä¸ºnanã€‚å¦å¤–è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« Objective-C ä¸­ åˆ¤æ–­ NaNå¤§è‡´è®°å½•äº†ä¸€ä¸‹12345678910111213// math.h #56#if defined(__GNUC__)# define HUGE_VAL __builtin_huge_val()# define HUGE_VALF __builtin_huge_valf()# define HUGE_VALL __builtin_huge_vall()# define NAN __builtin_nanf("0x7fc00000")#else# define HUGE_VAL 1e500# define HUGE_VALF 1e50f# define HUGE_VALL 1e5000L# define NAN __nan()#endif å¦å¤–ï¼ŒNANä¸èƒ½ç›´æ¥åˆ¤æ–­ == éœ€è¦è°ƒç”¨ä¸‹é¢çš„å®ã€‚å¦åˆ™ä¼šå‘ç”Ÿè«åå…¶å¦™çš„é—®é¢˜123456 // math.h #178#define isnan(x) \ ( sizeof(x) == sizeof(float) ? __inline_isnanf((float)(x)) \ : sizeof(x) == sizeof(double) ? __inline_isnand((double)(x)) \ : __inline_isnanl((long double)(x)))]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¡¹ç›®ä¸­çš„UITableView]]></title>
    <url>%2Fabout-project-tableview%2F</url>
    <content type="text"><![CDATA[å‰ä¸¤å¤©å¬åˆ°æœ‰äººè¯´å¤šäººåˆä½œçš„é¡¹ç›®å¹¶ä¸éœ€è¦å¤„ç†å¾ˆå¤šäº‹æƒ…ï¼Œåªéœ€è¦å¤„ç†å¥½è‡ªå·±çš„é‚£éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘å°±å¥½äº†ã€‚æ„Ÿè§‰è¿™æ˜¯ä¸€ä¸ªå¾ˆä¸è´Ÿè´£ä»»çš„è¯´æ³•ã€‚ ä½œä¸ºä¸€ä¸ªAPPçš„å¼€å‘è€…ï¼Œè‡ªå·±è´Ÿè´£çš„äº‹å…¶ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œä½†æ˜¯éƒ½æ˜¯è¿™ä¸ªAPPçš„å¼€å‘è€…ï¼Œä¹Ÿè¦å¾€é‡Œé¢å¡ä»£ç ï¼Œå¦‚æœæ¯ä¸ªäººéƒ½ç”¨ä¸åŒçš„é€»è¾‘é£æ ¼å»ç»„ç»‡ä»£ç ã€‚é‚£ä¹ˆæ•´ä¸ªé¡¹ç›®å°±æ˜¯ä¸€å¨å¨å¨ï¼Œè¿™ä¸ªå¨ä¼šå½±å“é¡¹ç›®çš„æ¼”è¿›ã€æ—¥åçš„å‘å±•ã€‚ å½“ç„¶æœ‰çš„æ˜¯çœ‹ä¸å‡ºæ¥çš„ï¼Œæ¯”å¦‚è¯´ï¼šå½“ä¸€ä¸ªè¯·å‡çš„äººå†™çš„ä»£ç å‡ºç°ä¸€ä¸ªBUGï¼Œéœ€è¦ä¿®å¤ä¸Šçº¿çš„æ—¶å€™ï¼Œå¯¹äºä¸åŒçš„ä»£ç é£æ ¼ï¼Œéœ€è¦æ‰¾åˆ°é—®é¢˜çš„å…³é”®ä»£ç ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ’•å¿ƒè£‚è‚ºçš„ï¼Œä½†æ˜¯å¦‚æœåŒä¸€å¥—ä»£ç é£æ ¼ï¼Œå¿ƒä¸­å°±ä¼šæœ‰ä¸€ä¸ªå¤§è‡´çš„ä½ç½®ï¼Œå»ä¿®æ”¹æ—¶å€™å°±ä¼šæ¯”è¾ƒå¿«é€Ÿçš„å®šä½é—®é¢˜ã€‚ ä»åè®®å…¥æ‰‹UITableViewæ˜¯é¡¹ç›®ä¸­éå¸¸å¸¸è§çš„iOSé«˜çº§æ§ä»¶ï¼Œåœ¨é¡µé¢ä¸­æ‰€æœ‰ç›¸ä¼¼çš„é¡µé¢å‡ ä¹éƒ½æ˜¯ç”±è¯¥æ§ä»¶è¿›è¡Œå®Œæˆã€‚å…¶å¹¿æ³›è¿ç”¨çš„ä¸æ­¢æ˜¯ä½¿ç”¨æ–¹ä¾¿ï¼Œæœ€ä¸»è¦çš„æ˜¯å†…éƒ¨çš„å¤ç”¨ä¼˜åŒ–ä¹Ÿæ˜¯ç›¸å½“ç»™åŠ›çš„ã€‚ åè®®æ¨¡å¼ä¸‹çš„UITableViewUITableViewæ˜¯å…¸å‹çš„ åè®®-ä»£ç†æ¨¡å¼ ï¼Œæ¯”ä¾‹id &lt;UITableViewDataSource&gt; dataSourceå’Œid &lt;UITableViewDelegate&gt; delegateï¼Œæ‰€ä»¥ä½¿ç”¨å¯¹äºè¿™ç§æ¯”è¾ƒè§„æ•´çš„åˆ—è¡¨æ¥è¯´æŠŠåè®®ç»§ç»­æ‰©å±•åˆ°ä¸‹ä¸€çº§ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ ä¸ºäº†ç»Ÿä¸€UITableView.dataSourceå’ŒUITableView.delegateï¼Œæ„å»ºå¦‚ä¸‹åè®®ï¼š1234567// ç›´æ¥å¡«å……Cellçš„cellModel@protocol CellModelProtocol &lt;NSObject&gt;- (NSString *)cellClassName; // cellModelç»‘å®šçš„ç±»å- (void)cellModelForCell:(UITableViewCell *)cell; // cellModelå¡«å……ä¸Šé¢ç»‘å®šçš„cell@end é‚£ä¹ˆåªéœ€è¦åœ¨ä»£ç†ä¸­åšå¦‚ä¸‹è®¾ç½®: 12345678910111213141516171819202122232425#pragma mark &lt;UITableViewDelegate, UITableViewDataSource&gt;- (NSInteger)numberOfSectionsInTableView:(UITableView*)tableView&#123; return 1;&#125;- (NSInteger)tableView:(UITableView*)tableView numberOfRowsInSection:(NSInteger)section&#123; return self.viewModel.dataSource.count;&#125;- (UITableViewCell*)tableView:(UITableView*)tableView cellForRowAtIndexPath:(NSIndexPath*)indexPath&#123; id&lt;CellModelProtocol&gt; cellModel = self.viewModel.dataSource[indexPath.row]; UITableViewCell* cell = [tableView dequeueReusableCellWithIdentifier:[cellModel cellClassName]]; cell.frame = tableView.bounds; [cellModel cellModelForCell:cell]; [cell sizeToFit]; return cell;&#125;- (CGFloat)tableView:(UITableView*)tableView heightForRowAtIndexPath:(NSIndexPath*)indexPath&#123; id&lt;CellModelProtocol&gt; cellModel = self.viewModel.dataSource[indexPath.row]; UITableViewCell* cell = [tableView ktj_cacheHeightCellForReuseIDFA:[cellModel cellClassName]]; [cellModel cellModelForCell:cell]; return [cell sizeThatFits:tableView.bounds.size].height;&#125; è€Œåœ¨cellä¸­ï¼Œé»˜è®¤åœ¨sizeThatFits:ä¸­è¿›è¡Œå¸ƒå±€çš„è®¾ç½®å’Œç®—é«˜å³å¯ã€‚å¦‚ä¸‹ï¼š 12345678910111213// xxxCell.m- (CGSize)sizeThatFits:(CGSize)size &#123; CGRect frame = CGRectZero; // æ ¹æ®Cellçš„å®é™…å†…å®¹è¿›è¡Œå¸ƒå±€å¹¶è®¾ç½®é«˜åº¦ frame.origin = CGPointMake(10, 15); frame.size = [self.infoLabel sizeThatFits:CGSizeMake(size.width-frame.origin.x*2, size.height)]; self.infoLabel.frame = frame; size.height = CGRectGetMaxY(self.infoLabel.frame)+frame.origin.y; return size;&#125; å¦‚æœcellé‡‡ç”¨autolayoutï¼Œåˆ™è®¡ç®—é‡‡ç”¨UITableView-FDTemplateLayoutCellçš„è®¡ç®—æ–¹æ³•ã€‚ 123456789101112131415161718192021@implementation UITableViewCell (KTJCellAutoLayoutForSize)// autoloutå¸ƒå±€è®¡ç®—é«˜åº¦- (CGSize)ktj_ALCellSizeThatFits:(CGSize)size &#123; // Add a hard width constraint to make dynamic content views (like labels) expand vertically instead // of growing horizontally, in a flow-layout manner. NSLayoutConstraint *tempWidthConstraint = [NSLayoutConstraint constraintWithItem:self.contentView attribute:NSLayoutAttributeWidth relatedBy:NSLayoutRelationEqual toItem:nil attribute:NSLayoutAttributeNotAnAttribute multiplier:1.0 constant:size.width]; [self.contentView addConstraint:tempWidthConstraint]; // Auto layout engine does its math size = [self.contentView systemLayoutSizeFittingSize:UILayoutFittingCompressedSize]; size.height += 1; [self.contentView removeConstraint:tempWidthConstraint]; return size;&#125;@end å¦å¤–åœ¨&lt;UITableViewDelegate, UITableViewDataSource&gt;ä¸­åªå†™äº†1ç»„ï¼Œåªæœ‰cellï¼Œæ²¡æœ‰headerã€footerçš„æƒ…å†µï¼Œå¦‚æœéœ€è¦ï¼Œç‚®åˆ¶å³å¯ã€‚ è¯´ä¸€ä¸‹è¿™ä¸ªå…¶ä¸­çš„ktj_cacheHeightCellForReuseIDFA:ç±»åˆ«æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†ç®—é«˜è¿›è¡Œç¼“å­˜çš„ä¸€ä¸ªcellï¼Œè¿™ä¸ªcellä¿å­˜åœ¨ NSCacheä¸­ã€‚æ‰€ä»¥ä¸ºäº†ç»Ÿä¸€ï¼Œéœ€è¦åœ¨æ•°æ®åˆå§‹åŒ–æ—¶å€™æ³¨å†Œæ‰€æœ‰çš„cellã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ ¹æ®ç±»åç›´æ¥ç”Ÿæˆï¼Œè¿™ä¸ªè‡ªä¸»å†³å®šã€‚ è¯´åˆ°ç®—é«˜ï¼Œéœ€è¦è¯´ä¸€ä¸‹è¿™å…¶ä¸­çš„dequeueReusableCellWithIdentifier:æ–¹æ³•ã€‚è¯¥æ–¹æ³•æ˜¯ä»tableViewçš„ç¼“å­˜æ± ä¸­å–å‡ºæŒ‡å®šIDçš„cellã€‚è¯·æ³¨æ„æ˜¯ å–å‡º ï¼Œå¹¶ä¸”UITableViewå¹¶æ²¡æœ‰æš´éœ²å‡ºå¦‚ä½•æ”¾è¿›ç¼“å­˜æ± ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦æš´éœ²å‡ºæ”¾è¿›ç¼“å­˜æ± çš„æ–¹æ³•ã€‚ è€Œä¸”UITableViewåªæœ‰ä¸€ä¸ªåœ°æ–¹èƒ½å¤Ÿæ¥æ”¶Cellé‚£å°±æ˜¯tableView:cellForRowAtIndexPath:ã€‚æ‰€ä»¥è¯·ä¿è¯dequeueReusableCellWithIdentifier:å–å‡ºçš„æ–¹æ³• éœ€è¦é€šè¿‡tableView:cellForRowAtIndexPath:è¿”å›ç»™UITableView ã€‚è¿™å°±æ˜¯æˆ‘ä¸Šé¢è¯´çš„ktj_cacheHeightCellForReuseIDFA:æ–¹æ³•ä¸ºä½•è¦åšä¸€ä¸ª cacheå»ç¼“å­˜æˆ‘å–å‡ºçš„cellï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘cellçš„æµªè´¹ã€‚ åŒç†ï¼Œå¯¹äºUITableViewçš„headerViewã€footerViewæ¥è¯´ï¼Œå¯ä»¥ç‚®åˆ¶ä»¥ä¸Šåè®®ã€æ–¹æ³•ã€‚ä¸å†èµ˜è¿° PS. UITableView-FDTemplateLayoutCell: sunnyxxæ‰“é€ çš„ä¼˜åŒ–UITableViewçš„ä¸€ä¸ªåº“ï¼Œ6000çš„starï¼Œå¾ˆèµã€‚ è§„èŒƒåŒ–çš„ä»£ç é£æ ¼å¯¹äºå¤šäººå¼€å‘ï¼Œæœ€å´©æºƒçš„äº‹æƒ…å°±è¦æ•°å»è¯»åˆ«äººçš„ä»£ç ã€‚å°±ç®—ä¸æ˜¯å¤šäººå¼€å‘ï¼Œæ¥æ‰‹åˆ«äººçš„ä»£ç ä¹Ÿæ˜¯è®©äººæœ€å´©æºƒçš„äº‹æƒ…ã€‚å¦‚æœæœ‰ä¸ç”¨è€ƒè™‘è¿™ä»¶äº‹çš„å«æˆ‘ï¼ ä¸åŒçš„å…¬å¸å¯ä»¥æœ‰ä¸åŒçš„ä»£ç é£æ ¼ï¼Œä½†æ˜¯ä¸€ä¸ªå…¬å¸çš„ä»£ç é£æ ¼éœ€è¦ä¿æŒä¸€è‡´ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°ä¸€äººè¯·å‡ï¼Œæ— äººèƒ½æ¥å—é¡¹ç›®çš„å°´å°¬å±€é¢ï¼Œå°±ç®—èƒ½æ¥ï¼Œä¹Ÿæ˜¯éœ€è¦ä¸ºäº†åŠ ä¸€ä¸ªé€»è¾‘åˆ¤æ–­ï¼Œéœ€è¦èŠ±è´¹å¾ˆå¤§çš„ç²¾åŠ›å»å¤„ç†ã€‚ è‡³äºå…¶ä¸­çš„ä»£ç ä¸ç»Ÿä¸€çš„å‘ï¼Œææ€•è¦ç­‰è¸©è¿‡æ‰çŸ¥é“å§ğŸ˜‚ã€‚ ä¸šåŠ¡é€»è¾‘çš„æ‹†åˆ†å¯¹äºå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¯¹å…¶æ‹†åˆ†æ˜¯éå¸¸é‡è¦çš„ï¼Œä¸æ‹†åˆ†å¾ˆå¯èƒ½å†™å‡ºæ¥çš„ä»£ç ä¸€ä¸ªæ–‡ä»¶ &gt;1000 è¡Œã€‚å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å¯¹äºå†™å‡ºæ¥éœ€è¦ä¸€æ°”å‘µæˆï¼Œä¿®æ”¹èµ·æ¥ä¹Ÿå°±å‡ºç°äº†ç‰µä¸€å‘åŠ¨å…¨èº«(è™½ç„¶æ‹†åˆ†å®Œæˆä¹‹åå¯èƒ½ä¹Ÿä¼šå…³é”®é€»è¾‘ä»£ç ä¸å¯æ‹†åˆ†ï¼Œä½†æ˜¯ä¼šå¥½å¾ˆå¤š)ã€‚ ç­›é€‰é‡æ„ç­›é€‰ä¸»è¦å¤„ç†çš„æ˜¯ç­›é€‰é¡¹ï¼Œé’ˆå¯¹ä¼—å¤šç­›é€‰æ¡ä»¶æ‹†åˆ†ä¸ºä¸åŒçš„ä¸šåŠ¡é€»è¾‘æ¨¡å—æ˜¯å¿…é¡»çš„ã€‚éµç…§æ‹†åˆ†çš„åŸåˆ™ï¼Œäºæ˜¯ä¹æ ¹æ®UIåˆ’åˆ†å‡ºæ¥ä½ç½®ã€ä»·æ ¼ã€æˆ·å‹ã€ç­›é€‰ã€æ’åºè¿™ä¹ˆå‡ ä¸ªæ¨¡å—ã€‚é’ˆå¯¹æ¯ä¸ªæ¨¡å—è‡ªè¡Œå¤„ç†é€‰ä¸­æ•°æ®ã€UIå±•ç¤ºã€‚å¯¹å¤–åªæš´éœ²é€‰ä¸­é¡¹è¾“å…¥å’Œé€‰ä¸­å›è°ƒã€‚ å¯¹äºæ¯ä¸ªæ•°æ®å¤§è‡´éƒ½å¯åˆ†ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œç„¶åå¯é€‰ä¸­1é¡¹æˆ–å¤šé¡¹ã€‚äºæ˜¯ä¹ï¼Œè¿™ä¸ªä»£ç å¦‚æœä¸æ‹‰å‡ºæ¥æ˜¯è¦å†™å¥½å¤šæ¬¡çš„ï¼Œæ‹‰å‡ºæ¥ï¼Œä½†æ˜¯é€‰ä¸­éœ€è¦æŠŠé€‰ä¸­çš„é€»è¾‘æ‰”å‡ºæ¥ï¼Œæ–¹ä¾¿è‡ªå®šä¹‰ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>UITableView</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºè½¬è½½çš„æ–‡ç« ]]></title>
    <url>%2Fabout-reprint-article%2F</url>
    <content type="text"><![CDATA[ä¸€ç‚¹åˆ é™¤åŸé“¾æ¥çš„è½¬è½½æ–‡ç« çš„ç‰¢éªš ç¼˜ç”±å‰ä¸¤å¤©çœ‹åˆ°æœ‹å‹åœˆä¸€ä¸ªå“¥ä»¬è½¬è½½äº†è®¸å¤šå…³äºiOSçš„ä¸€äº›æ–‡ç« ï¼Œå¾ˆæ˜¯å…´å¥‹ï¼Œå»å›´è§‚ã€‚çªç„¶å‘ç°è¿™æ–‡ç¬”ç»å¯¹æ˜¯ç»è¿‡æ ¡å¯¹çš„ã€‚å¿ƒä¸­å¤§å–œï¼Œä»¥ä¸ºæ·˜åˆ°å®äº†ï¼ˆå› ä¸ºæ–‡ç« å¹¶æ²¡æœ‰ç½²åè½¬è½½å‡ºå¤„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯åŸåˆ›ï¼‰ã€‚ä¹‹åçœ‹äº†ä¸€ä¸‹ä»–çš„å¦ä¸€ä¸ªæ–‡ç« ï¼Œåˆšå¥½æˆ‘ç™¾åº¦è¿‡è¿™ä¸ªæ–‡ç« çš„åŸä½œè€…çš„æœ€åä¸€ä¸ªç³»åˆ—çš„ï¼Œäºæ˜¯æˆ‘åˆç¿»é˜…äº†ä¸€ä¸‹çœ‹çœ‹æ˜¯ä¸æ˜¯ä¸ä¸€æ ·ï¼Œç»“æœå’Œæˆ‘æƒ³çš„ä¸€æ ·ï¼Œé™¤äº†åˆ é™¤äº†ä½œè€…çš„ç½²åä¹‹å¤–å…¶ä»–çš„éƒ½æ˜¯ä¸€æ ·çš„ã€‚äºæ˜¯å…³æ‰äº†ç½‘é¡µï¼Œå¿ƒä¸­é»˜é»˜çš„é„™è§†ã€‚ å…³äºè½¬è½½çš„åˆ«äººæ–‡ç« å¯¹äºä¸€äº›å¤§ç¥çš„æŠ€æœ¯æ–‡ç« éƒ½æ˜¯å–œæ¬¢çš„ï¼Œçˆ±ä¸é‡Šæ‰‹çš„é‚£ç§ï¼Œæˆ‘ä¹Ÿæ˜¯ã€‚æœ‰çš„èƒ½è½¬è½½çš„æˆ‘å°±è½¬è½½ï¼Œä¸èƒ½è½¬è½½çš„ï¼Œæˆ‘ä¼šå¤åˆ¶ä¸‹æ¥ï¼Œæ”¾åœ¨æˆ‘è‡ªå·±çš„æ–‡ä»¶å¤¹ä¸­ï¼Œä¸ºçš„æ˜¯æ–¹ä¾¿æŸ¥è¯¢ã€‚åœ¨è½¬è½½çš„æ—¶å€™æˆ‘ä¼šç‰¹æ„æ ‡ç¤ºè½¬è½½çš„åœ°å€ã€‚è€Œä¸”ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä¼šåœ¨æ–‡ç« çš„å¼€å§‹å†™ä¸Šå‡ å¥ç®€å•çš„ä¸»è¦çš„æ€æƒ³ï¼ˆæ¯”å¦‚ï¼šã€Š[è½¬]è“ç‰™å¼€å‘ã€‹ã€ã€Š[æ¬è¿] macä¸‹å®‰è£…GDBã€‹ã€ã€Šï¼»æ¬è¿ï¼½MAC ä¸‹å®‰è£… brewã€‹ï¼‰ï¼Œå½“ç„¶æœ‰æ—¶å€™æ²¡æ¥å¾—åŠçš„å°±å¿˜äº†ğŸ˜‚ï¼ˆæ¯”å¦‚ï¼šã€Š[æ¬è¿] iOS 7 ä¾§æ»‘è¿”å›æ‰‹åŠ¿ä½¿ç”¨å’Œé”™è¯¯é›†ã€‹ï¼‰ã€‚ è¿˜æœ‰å…³äºæ–‡ç« çš„æ’ç‰ˆï¼Œæ®Šä¸çŸ¥åŸä½œè€…ä¸ºäº†è®©è¯»è€…æ›´å¥½çš„é˜…è¯»ä¼šå¯¹æ’ç‰ˆåšçš„æ¯”è¾ƒå¥½ï¼Œæœ‰çš„äººä¸ºäº†é˜…è¯»æ–¹ä¾¿ä¼šå»é˜…è¯»åŸä½œè€…çš„æ–‡ç« ã€‚æ¯”å¦‚è¯´æˆ‘è¿™ç§å¼ºè¿«ç—‡ã€‚ æˆ‘å¯¹åˆ é™¤åŸé“¾çš„è½¬è½½æ–‡ç« æ€åº¦ç„¶åè¯´ä¸€ä¸‹æˆ‘å¯¹äºé‚£äº›æŠ„è¢­çš„ï¼Œç„¶ååˆ é™¤äº†åŸé“¾æ¥çš„äººé„™è§†ä¸€ä¸‹ã€‚æ¯ä¸€ç¯‡æ–‡ç« éƒ½æ˜¯åˆ«äººèŠ±è´¹äº†å¤§é‡çš„ç²¾åŠ›å»å®Œæˆçš„ï¼Œæœ‰çš„ä¸ºäº†è®©è¯»è€…èƒ½å¤Ÿæ›´æ¸…æ¥šçš„ç†è§£ï¼Œæ‰€ä»¥ä¼šåœ¨å‘å¸ƒçš„æ—¶å€™æ‰¾åˆ«äººå»è¯»ä¸€è¯»ï¼Œçœ‹èƒ½ä¸èƒ½ç†è§£å…¶ä¸­äº‘äº‘ã€‚ç„¶è€Œå¯¹æ–‡ç« çš„åŸé“¾æ¥ä¿å­˜æ˜¯ä¸€ç§å¯¹åˆ«äººåŠ³åŠ¨æˆæœçš„å°Šé‡ï¼Œå¯¹åŸä½œè€…æœ€åŸºæœ¬çš„å°Šé‡ã€‚ åˆ«çš„ä¸æƒ³å¤šè¯´äº†ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚è°¢è°¢ï¼ä¸”è¡Œä¸”çæƒœã€‚]]></content>
      <categories>
        <category>ç‰¢éªš</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å‡†å¤‡é£Ÿç”¨RAC(ReactiveCocoa)çš„é¡¾è™‘]]></title>
    <url>%2Freactivecocoa-ready-to-use%2F</url>
    <content type="text"><![CDATA[å¯¹äºç›®å‰çš„é¡¹ç›®ï¼Œå¦‚æœå¼•ç”¨RACï¼Œä¼šå¯¹é¡¹ç›®é€ æˆå“ªäº›å½±å“çš„ç›¸å…³æ€è€ƒã€‚ è¯´æ˜ä¼—æ‰€å‘¨çŸ¥ï¼ŒRACå¾ˆç«ï¼Œæœ‰å¾ˆå¤šå´‡æ‹œè€…ã€‚æœ¬æ–‡åªæ˜¯ä¸€ä¸ªæ–°æ‰‹ç¬¬ä¸€æ¬¡ä½¿ç”¨RACæ—¶å€™æ‰€é¡¾å¿Œçš„ä¸€äº›é—®é¢˜ï¼Œå¦‚æœæœ‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆåŠæ—¶å‘ŠçŸ¥æˆ‘ï¼Œæˆ‘ä¼šåŠæ—¶æ›´æ”¹ã€‚ OCç®€å•é£Ÿç”¨æ–¹æ³•å…ˆæ¥ä¸ªä¾‹å­ä»£ç ï¼š 123456789101112131415161718RACSignal *RSignal = [[self.R rac_newValueChannelWithNilValue:@0] startWith:@(self.R.value)];RACSignal *GSignal = [[self.G rac_newValueChannelWithNilValue:@0] startWith:@(self.G.value)];RACSignal *BSignal = [[self.B rac_newValueChannelWithNilValue:@0] startWith:@(self.B.value)];NSString*(^valueFormat)(NSNumber *value) = ^(NSNumber *value) &#123; return [NSString stringWithFormat:@"%.0f", [value doubleValue]*255];&#125;;[RSignal subscribeNext:^(id x) &#123; self.RVaule.text = valueFormat(x);&#125;];[GSignal subscribeNext:^(id x) &#123; self.GValue.text = valueFormat(x);&#125;];[BSignal subscribeNext:^(id x) &#123; self.BValue.text = valueFormat(x);&#125;]; æ˜¯ä¸æ˜¯è¶…çº§ç®€å•ï¼ é¡¾è™‘å¯æ˜¯æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼š OCå±äºè¿è¡Œæ—¶è¯­æ³•ï¼Œè¿™ä¸ªé‡Œé¢çš„id xçš„ä¸ç¡®å®šå› ç´ å¯èƒ½ä¼šå¯¼è‡´ç±»å‹è¯†åˆ«å‡ºç°é”™è¯¯ã€‚å¦‚æœè¯´é¡¹ç›®æ˜¯å¤šäººç»´æŠ¤ï¼Œé‚£ä¹ˆAå¯èƒ½ä¸çŸ¥é“Bå†™çš„Signalèµ°çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜å°±ä¸é€‚ç”¨äºæ¾æ•£çš„å¤šäººå¼€å‘ã€‚å¦‚æœéœ€è¦ä½¿ç”¨RACææ€•éœ€è¦åœ¨é¡¹ç›®å¯åŠ¨æ—¶è¿›è¡Œè§„é¿è¿™äº›ä¸ç¡®å®šçš„é—®é¢˜æ‰èƒ½å¼•å…¥ã€‚ Swiftç®€å•é£Ÿç”¨æ–¹æ³•åœ¨ReactiveCocoaçš„README.mdä¸­æœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼š Objective-C and Swift Although ReactiveCocoa was started as an Objective-C framework, as of [version 3.0][CHANGELOG], all major feature development is concentrated on the [Swift API][]. RACâ€™s [Objective-C API][] and Swift API are entirely separate, but there is a [bridge][Objective-C Bridging] to convert between the two. This is mostly meant as a compatibility layer for older ReactiveCocoa projects, or to use Cocoa extensions which havenâ€™t been added to the Swift API yet. The Objective-C API will continue to exist and be supported for the foreseeable future, but it wonâ€™t receive many improvements. For more information about using this API, please consult our [legacy documentation][]. We highly recommend that all new projects use the Swift API.]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ReactiveCocoa</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hexoçš„åšå®¢è®©ç™¾åº¦æ”¶å½•]]></title>
    <url>%2Fuse-hexo-setup-blog%2F</url>
    <content type="text"><![CDATA[è¿™ä¸ªgithub.ioæ­å»ºçš„è¿‡ç¨‹å‚è€ƒï¼Œä»¥åŠå‘ç™¾åº¦æ¨é€çš„pythonã€jsè„šæœ¬ã€‚ å‚è€ƒåšå®¢æ„Ÿè°¢ å²æœˆå¦‚æ­Œ çš„è¿™ä¸ªã€ŠHexo 3.1.1 é™æ€åšå®¢æ­å»ºæŒ‡å—ã€‹åŒæ—¶æ„Ÿè°¢è¿™ä¸ªã€Šå‘ç™¾åº¦æ¨é€hexoåšå®¢æ‰€æœ‰é“¾æ¥çš„Pythonè„šæœ¬ã€‹(åˆ«é—®æˆ‘ä¸ºå•¥ç‚¹ä¸å¼€ï¼Œè¿™ä¸ªè¦é—®åšä¸»ï¼Œä¸è¿‡è¦çœ‹è¿™ä¸ªæ–‡ç« ä¹Ÿä¸æ˜¯æ²¡åŠæ³•çš„ğŸ˜‚ï¼Œå› ä¸ºè¿™ä¸ªåšå®¢ä¹Ÿç”¨gitç®¡ç†çš„ã€‚ã€‚ã€‚ä½ æ‡‚) å¦å¤–è¿˜æœ‰ä¸€ä¸ªsoulçš„ç™¾åº¦ä¸»åŠ¨æ¨é€hexoç”Ÿæˆçš„æ–‡ç«  pythonè‡ªåŠ¨æ¨é€è„šæœ¬ä¿®æ”¹ä¸Šé¢è¯´çš„åšä¸»å¤§çº¦ç”¨çš„æ˜¯windowsï¼Œæ‰€ä»¥è„šæœ¬å¹¶ä¸èƒ½ç«‹é©¬çš„è¿è¡Œåœ¨Macä¸Šï¼Œéœ€è¦åšäº›ä¿®æ”¹ï¼šæ•…ä¿®æ”¹ä¸ºï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374#!/usr/bin/env python# -*- coding: utf-8 -*-# @Author: LoveNight# @Date: 2015-11-16 20:45:59# @Last Modified by: LoveNight# @Last Modified time: 2015-11-18 18:07:19# @Last Modified by: Keith# @Last Modified time: 2016-07-06 16:22:45import osimport sysimport jsonfrom bs4 import BeautifulSoup as BSimport requests#import msvcrt"""hexo åšå®¢ä¸“ç”¨ï¼Œå‘ç™¾åº¦ç«™é•¿å¹³å°æäº¤æ‰€æœ‰ç½‘å€æœ¬è„šæœ¬å¿…é¡»æ”¾åœ¨hexoåšå®¢çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼éœ€è¦å·²å®‰è£…ç”Ÿæˆç™¾åº¦ç«™ç‚¹åœ°å›¾çš„æ’ä»¶ã€‚ç™¾åº¦ç«™é•¿å¹³å°æäº¤é“¾æ¥ï¼šhttp://zhanzhang.baidu.com/linksubmit/indexä¸»åŠ¨æ¨é€ï¼šæœ€ä¸ºå¿«é€Ÿçš„æäº¤æ–¹å¼ï¼Œæ¨èæ‚¨å°†ç«™ç‚¹å½“å¤©æ–°äº§å‡ºé“¾æ¥ç«‹å³é€šè¿‡æ­¤æ–¹å¼æ¨é€ç»™ç™¾åº¦ï¼Œä»¥ä¿è¯æ–°é“¾æ¥å¯ä»¥åŠæ—¶è¢«ç™¾åº¦æ”¶å½•ã€‚ä»ä¸­æ‰¾åˆ°è‡ªå·±çš„æ¥å£è°ƒç”¨åœ°å€pythonç¯å¢ƒï¼špip install beautifulsoup4pip install requestsxcode-select --install pip install lxml """# âŒâŒâŒ æŠ„çš„éœ€è¦æ›´æ”¹è¿™ä¸ªURLï¼ï¼è¿™æ˜¯æˆ‘çš„ï¼ï¼âŒâŒâŒurl = 'http://data.zz.baidu.com/urls?site=https://madordie.github.io&amp;token=j33t0VEPFl24tJ8N'baidu_sitemap = os.path.join(sys.path[0], 'public', 'baidusitemap.xml')google_sitemap = os.path.join(sys.path[0], 'public', 'sitemap.xml')sitemap = [baidu_sitemap, google_sitemap]assert (os.path.exists(baidu_sitemap) or os.path.exists( google_sitemap)), "æ²¡æ‰¾åˆ°ä»»ä½•ç½‘ç«™åœ°å›¾ï¼Œè¯·æ£€æŸ¥ï¼"# ä»ç«™ç‚¹åœ°å›¾ä¸­è¯»å–ç½‘å€åˆ—è¡¨def getUrls(): urls = [] for _ in sitemap: if os.path.exists(_): with open(_, "r") as f: xml = f.read() soup = BS(xml, "xml") tags = soup.find_all("loc") urls += [x.string for x in tags] if _ == baidu_sitemap: tags = soup.find_all("breadCrumb", url=True) urls += [x["url"] for x in tags] return urls# POSTæäº¤ç½‘å€åˆ—è¡¨def postUrls(urls): urls = set(urls) # å…ˆå»é‡ print("ä¸€å…±æå–å‡º %s ä¸ªç½‘å€" % len(urls)) print(urls) data = "\n".join(urls) return requests.post(url, data=data).textif __name__ == '__main__': urls = getUrls() result = postUrls(urls) print("æäº¤ç»“æœï¼š") print(result)# msvcrt.getch() jsè„šæœ¬è¿™ä¸ªè„šæœ¬æ˜¯æˆ‘åœ¨soulçš„ç™¾åº¦ä¸»åŠ¨æ¨é€hexoç”Ÿæˆçš„æ–‡ç« å‘ç°çš„ï¼Œæ„Ÿè§‰ä¹Ÿå¾ˆèµã€‚ github è„šæœ¬åœ°å€ æ¨é€ ä»Šå¤©å‘ç°ç™¾åº¦æ²¡æ”¶å½•æˆ‘çš„ç«™..ä¸»è¦æ˜¯æˆ‘çš„ç«™ç‚¹æ¢æ¥æ¢å»çš„..ä¼°è®¡è¢«banäº†..ç„¶åæƒ³ç”¨sitemapæ¥æ¨é€ä¸€ä¸‹..ç»“æœå‘ç°githubç¦ç”¨äº†ç™¾åº¦çˆ¬è™«..æ²¡åŠæ³•åªèƒ½ä¸»åŠ¨æ¨é€äº†. åˆ©ç”¨æ’ä»¶ è¿™é‡Œåˆ©ç”¨åˆ°äº†ä¸€æ¬¾æ’ä»¶ hexo-generator-baidu-sitemap è®¾ç½®å¾ˆç®€å• åªéœ€è¦åœ¨.config.ymlæ·»åŠ ä¸€äº›æ•°æ®å³å¯, ä¸‹é¢é™„ä¸Šæˆ‘çš„æ·»åŠ æ•°æ® themeè¿™ä¸ªå¯ä»¥éšæ„æ›´æ”¹ ä¸‹é¢çš„copyå³å¯ 123456# Extensions## Plugins: http://hexo.io/plugins/## Themes: http://hexo.io/themes/theme: yiliabaidusitemap:path: baidusitemap.xml è¿è¡Œ ç„¶åhexo g ç”Ÿæˆä¸€ä¸‹æ•°æ® ä¼šåœ¨publicä¸‹é¢å‘ç°ä¸€ä¸ªæ–‡ä»¶åä¸ºbaidusitemap.xml è„šæœ¬ è¿™é‡Œç”¨nodejså†™äº†ä¸€æ¬¾è„šæœ¬ å¤§æ¦‚æµç¨‹æ˜¯ è·å–baidusitemap.xmlé‡Œé¢çš„å†…å®¹ ç„¶åè¯»å–æœ¬åœ°çš„ä¸€ä¸ªsite_file.jsonè¿™ä¸ªæ–‡ä»¶ è¿™ä¸ªæ–‡ä»¶å­˜å‚¨çš„æ˜¯ä¸Šä¸€æ¬¡æ•°æ® ä¸ä¸Šä¸€æ¬¡æ•°æ®è¿›è¡Œå¯¹æ¯” å¦‚æœå¯¹æ¯”å‘ç°æ–°æ•°æ®é‚£ä¹ˆå°±ä¸Šä¼ æ–°æ•°æ® å¦åˆ™å…¨éƒ¨ä¸Šä¼ . è¿è¡Œè„šæœ¬ æŠŠActivePush.jsè„šæœ¬æ”¾åœ¨hexoæ–‡ä»¶å¤¹ä¸»ç›®å½• ç„¶åç”¨nodejs ActivePush.jsä¸€ä¸‹å³å¯ è¿™é‡Œè¿˜æ”¯æŒä¸€ä¸ªå‚æ•°nodejs ActivePush.js all åˆ™æ˜¯ä¸å¯¹æ¯”ç›´æ¥ä¸Šä¼ æ•°æ®]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>SEO</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åšå®¢è¿ç§»å…¬å‘Š]]></title>
    <url>%2Fabout-change-blog%2F</url>
    <content type="text"><![CDATA[ä½ æ•¢ä¿¡ï¼æˆ‘åˆæ¬å®¶äº†ã€‚ã€‚ ä¹‹å‰åœ¨åšå®¢å›­åæ¥åˆå»äº†èš‚èšç¬”è®°ï¼Œæœ€åå§ï¼Œæˆ‘å°±åˆ°äº†è¿™é‡Œã€‚ è¯´ä¸‹å¤§ä½“æ„Ÿå—ï¼š åšå®¢å›­æŒºå¥½çš„ï¼Œä¸è¿‡ä¸å–œæ¬¢å…¶ç¼–ç æ–¹å¼ï¼ŒçœŸçš„ä¸å–œæ¬¢ã€‚åšå®¢å›­çš„ä¸»é¢˜ä»€ä¹ˆçš„éƒ½æ˜¯å¯ä»¥å®šåˆ¶ï¼Œä½†æ˜¯æ€»å½’æ˜¯å†™èµ·æ¥æ¯”è¾ƒè´¹åŠ²çš„ã€‚ èš‚èšç¬”è®°ä¸é”™ï¼Œæˆ‘å¼€å§‹æ—¶å€™logoè¿˜ä¸æ˜¯è¿™ä¸ªåŸæ¥logoæ˜¯ğŸ˜‚,ä¸è¿‡ç°åœ¨å·²ç»å¾ˆå‰å®³äº†ï¼Œå¼€å§‹äº†å„ç§ä¸šåŠ¡ã€‚æœŸå¾…ä¼šèµ°å¾—æ›´å¥½æ›´è¿œã€‚ æˆ‘æ˜¯çœ‹äº†å·§å“¥çš„è¿™ä¸ªåšæ–‡æ‰å¼€å§‹å‡†å¤‡è½¬åˆ°Githubçš„ã€‚ã€‚èµ¶è„šmarkdownå¾ˆå¥½ç©ï¼Œè™½ç„¶å‡ºæ¥å¾ˆæ—©äº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä»”ç»†çš„å»å­¦ä¹ è¿™ä¸ªè¯­æ³•ï¼Œäºæ˜¯ä¹è¿™ä¸ªåšå®¢å°±ç”¨hexoè¿›è¡Œæ­å»ºã€‚ è™½ç„¶æˆ‘è¿˜ä¸çŸ¥é“æ€ä¹ˆè®©ç™¾åº¦æ”¶å½•æˆ‘çš„Githubï¼Œä½†æ˜¯ä¸»è¦çš„æ˜¯èƒ½å°è¯•ç€è‡ªå·±æƒ³è¯•è¯•ç¡®æ²¡æœ‰å°è¯•çš„äº‹æƒ…ï¼]]></content>
      <categories>
        <category>å…¬å‘Š</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä¸ªäººèµ„æ–™é¡µ]]></title>
    <url>%2Fabout-me%2F</url>
    <content type="text"><![CDATA[åŸºæœ¬èµ„æ–™å­™ç»§åˆšQQ: 453870736åšå®¢ï¼šhttps://madordie.github.ioGitHubï¼šhttps://github.com/madordieE-mail: e.madordie@gmail.com æ•™è‚²èƒŒæ™¯2011.09-2015.06 å—é˜³ç†å·¥å­¦é™¢ è½¯ä»¶å·¥ç¨‹(ç§»åŠ¨è®¾å¤‡åº”ç”¨å¼€å‘æ–¹å‘) æœ¬ç§‘ ç®€ä»‹ï¼šç§»åŠ¨è®¾å¤‡åº”ç”¨å¼€å‘ä¸»è¦é¢å‘ç§»åŠ¨è®¾å¤‡æ‰€åŸ¹å…»çš„è½¯ä»¶å·¥ç¨‹å¸ˆã€‚ä¸»è¦åˆ†ä¸ºåµŒå…¥å¼ã€å®‰å“ã€iOSä¸‰ä¸ªåˆ†æ”¯ã€‚å…¶ä¸­åµŒå…¥å¼ç³»ç»Ÿä¸ºä¸»è¦å‘å±•æ–¹å‘ï¼Œä¸ºå¿«é€Ÿé€‚åº”å¸‚åœºçš„éœ€æ±‚ï¼ŒåŒæ—¶å¼€è®¾å®‰å“ã€iOSåŸºç¡€è¯¾ç¨‹ã€‚æ‰€å­¦è¯¾ç¨‹æ¶µç›–è½¯ä»¶å·¥ç¨‹ã€åµŒå…¥å¼ç³»ç»Ÿç­‰æ–¹é¢ã€‚ ä¸“ä¸šæŠ€èƒ½ æ“…é•¿Cã€Objective-Cã€Swiftå¼€å‘ï¼Œæœ‰è¾ƒä¸ºæ‰å®çš„iOSç¯å¢ƒå¼€å‘ç»éªŒã€‚ ç†Ÿæ‚‰shellã€rubyã€pythonã€ç­‰è¯­è¨€ã€‚ æœ‰è‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œè¾ƒå¼ºçš„åˆ†æé—®é¢˜ã€è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼Œå¹¶èƒ½ç§¯ææ€»ç»“æ‰€é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚ å¯¹é¡¹ç›®æ•´ä½“æ¶æ„æœ‰ä¸€å®šçš„è®¤è¯†å’ŒæŠŠæ§ï¼Œèƒ½å¤Ÿæ­å»ºè¾ƒä¸ºé€‚åˆå½“å‰é¡¹ç›®å‘å±•çš„æ¶æ„ã€‚ èƒ½å¤Ÿæ­å»ºgitlabã€JenkinsæœåŠ¡å™¨ï¼Œå¹¶ç†Ÿç»ƒä½¿ç”¨Jenkinsè¿›è¡Œæ‰“åŒ…ã€è‡ªå®šä¹‰æ“ä½œã€æ›´æ–°iconfontç­‰æ“ä½œã€‚ å–„äºåˆ¶ä½œå·¥å…·ç»„ä»¶æé«˜å¼€å‘æ•ˆç‡ï¼Œæ¯”å¦‚ï¼šJenkinsæ‰“ä¸åŒç¯å¢ƒåŒ…ã€ç»Ÿä¸€æ›´æ–°iconfontã€åˆ¶ä½œsketchè‡ªå®šä¹‰å¡«å……æ’ä»¶ç­‰ã€‚ ç†Ÿç»ƒä½¿ç”¨AutoLayoutè¿›è¡Œä»£ç ã€IBé€‚é…ï¼Œä»¥åŠframeçš„é€‚é…ã€‚ ç†Ÿç»ƒä½¿ç”¨Cocoapodsè¿›è¡Œé¡¹ç›®æ‹†åˆ†ã€å¹¶èƒ½å¤Ÿç¼–å†™éƒ¨åˆ†rubyè„šæœ¬è¿›è¡Œä¸€äº›è‡ªå®šä¹‰æ“ä½œã€‚ ç†Ÿç»ƒä½¿ç”¨MVVMã€MVCã€ç­‰æ¨¡å¼ã€‚ èƒ½å¤Ÿä½¿ç”¨RxSwiftè¿›è¡Œå“åº”å¼ç¼–ç¨‹ã€‚ ç†Ÿç»ƒæŒæ¡GCDã€NSThreadç­‰å¤šçº¿ç¨‹ç¼–ç¨‹æŠ€æœ¯ã€‚ ç†Ÿç»ƒæŒæ¡SwiftLintçš„é…ç½®ä»¥åŠè§„åˆ™å®šåˆ¶ã€‚ ç†Ÿæ‚‰iOSæ ¸å¿ƒåŠ¨ç”»ã€CALayerçš„å¼€å‘ã€‚ å¯¹cocos2dæ¸¸æˆå¼€å‘æœ‰ä¸€å®šçš„äº†è§£ã€‚ å·¥ä½œç»éªŒæˆ¿å¤šå¤š2015.05-è‡³ä»Š æ·±åœ³æˆ¿å¥½å¤šç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ï¼ˆä¸Šæµ·åˆ†å…¬å¸ï¼‰æ–°æˆ¿ã€äºŒæ‰‹æˆ¿äº¤æ˜“æœåŠ¡å¹³å°ã€‚å·¥ä½œèŒè´£ï¼šï¼ˆå›¢é˜Ÿé¡¹ç›®ï¼‰ ä¸»è¦ä¸šåŠ¡æ¨¡å—çš„å¼€å‘(æ¯”å¦‚ï¼šå¤§é¦–é¡µã€ç­›é€‰ã€IMåŸºç¡€æ¡†æ¶ã€ç­‰)ã€‚ åˆ›å»ºsketchè‡ªåŠ¨å¡«å……æ–‡æœ¬ã€å›¾ç‰‡ç´ ææ’ä»¶ç”Ÿæˆå·¥å…·ã€‚ åˆ›å»ºiconfontè‡ªåŠ¨æ›´æ–°ç»„ä»¶ã€‚ å¼€è¾ŸCocoaPodsçš„ç»„ä»¶åŒ–é“è·¯ã€‚ åˆ›å»ºJenkinsçš„è‡ªåŠ¨åŒ–ã€‚ é¡½å›ºcrashçš„ç ”ç©¶ä¿®å¤ã€‚ å¼€å‘è¯­è¨€ï¼šCã€OCã€Swift è‚Œè‚¤ç®¡å®¶2014.10-2015.05 ä¸Šæµ·å•†è·¯ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ä½¿ç”¨è‡ªä¸»ç ”å‘çš„è‚Œè‚¤æµ‹è¯•ä»ªè¿›è¡Œæ°´ã€æ²¹ã€è„‚è‚ªçš„å‚æ•°çš„æµ‹é‡ã€åˆ†äº«ã€äº¤æµç¤¾åŒºç±»APPã€‚å·¥ä½œèŒè´£ï¼š(ä¸ªäººé¡¹ç›®) é¡¹ç›®2.xçš„æ‰€æœ‰ç‰ˆæœ¬è¿­ä»£ï¼ŒåŒ…æ‹¬ç¤¾åŒºã€IMã€æ´»åŠ¨ç­‰ã€‚ ä¸€ä»£ç¡¬ä»¶è‚Œè‚¤æµ‹è¯•ä»ªåŠŸèƒ½å¼€å‘ã€‚ ä¸»è¦é‡‡ç”¨IB+autolayoutè¿›è¡Œé¡µé¢é€‚é…å¸ƒå±€ã€‚å¼€å‘è¯­è¨€ï¼šOCã€C eTalk2014.04-2014.06å¤§å­¦æ¯•è®¾ã€‚å±€åŸŸç½‘çš„è‡ªå®šä¹‰åè®®èŠå¤©å·¥å…·ã€‚è‡ªå·±æ­å»ºCçš„æœåŠ¡+iOSçš„å®¢æˆ·ç«¯ã€‚å·¥ä½œèŒè´£ï¼š(ä¸ªäººé¡¹ç›®) åŸºäºTCPè¿›è¡Œå¤šiOSç«¯é“¾æ¥Cçš„æœåŠ¡ç«¯ã€‚ é‡‡ç”¨è‡ªå®šä¹‰åè®®è¿›è¡Œé€šä¿¡ã€‚ å®Œæˆè”ç³»äººçš„å¢ã€åˆ ã€æŸ¥ã€æ”¹åŠŸèƒ½ï¼›ç”¨æˆ·çš„è‡ªå®šä¹‰è¡¨æƒ…ã€å¤´åƒã€å•ç‚¹ï¼å¤šç‚¹ç™»å½•ç­‰åŠŸèƒ½å¼€å‘è¯­è¨€ï¼šOCã€Cã€shell ä¸ªäººç‰¹è´¨çƒ­è¡·äºæŠ€æœ¯ã€‚ä¸€ä¸ªå…¸å‹å¤„å¥³åº§å¼ºè¿«ç—‡é‡åº¦æ‚£è€…ã€‚å¹¶ä¼´æœ‰ä»£ç æ´ç™–ã€‚æ€ç»´æ´»è·ƒã€çŸ¥è¯†é¢å¹¿ã€å…·æœ‰å¾ˆå¼ºçš„æ¥å—å’Œå­¦ä¹ æ–°çŸ¥è¯†çš„èƒ½åŠ›ã€‚åšäº‹è®¤çœŸè´Ÿè´£ï¼Œ å–„ä¸äººäº¤æµã€æœ‰å›¢é˜Ÿæ„è¯†ï¼Œä¸ºäººç§¯æä¹è§‚ã€‚]]></content>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•æ­£ç¡®çš„è¿ç»­æ¨æ–°é¡µé¢]]></title>
    <url>%2Fpush-queue-for-navigation%2F</url>
    <content type="text"><![CDATA[é¢˜è®°å½“ä½¿ç”¨æŸä¸ªé¡µé¢è¿˜æ²¡æœ‰è¿›è¡ŒviewDidAppear:çš„æ—¶å€™å†è¿›è¡Œä¸€æ¬¡æ¨é¡µé¢æ˜¯ä¸å®‰å…¨çš„ã€‚è‹¹æœåœ¨iPhone5C iOS7.1.2ä¸­Pushæ—¶ç»™å‡ºçš„è­¦å‘Šï¼š â€œnested push animation can result in corrupted navigation bar. Finishing up a navigation transition in an unexpected state. Navigation Bar subview tree might get corrupted.â€ è¿™è¯´æ˜è¿™ä¸ªä¸å®‰å…¨çš„æ“ä½œå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨Crashï¼ŒCrashç»Ÿè®¡ç³»ç»Ÿç»Ÿè®¡çš„åŸå› ä¸ºï¼š â€œCanâ€™t add self as subviewâ€ã€‚ æœ¬æ–‡å°è¯•è§£å†³è¯¥Crashï¼Œå®ç°åµŒå¥—å®‰å…¨çš„å»æ¨é¡µé¢ã€‚ é—®é¢˜æ‰€åœ¨è‹¹æœç»™å‡ºçš„è­¦å‘Šä¸­æŒ‡å‡ºåµŒå¥—æ¨é¡µé¢å¯èƒ½å¯¼è‡´å¯¼èˆªæ æŸåï¼Œå…¶å¯¼èˆªæ å­è§†å›¾æ ‘å¯èƒ½æŸåã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘å¯¹VC1è¿›è¡ŒPushå‡ºVC2æ—¶å€™è¦æ³¨æ„ï¼Œå¿…é¡»è¦ç­‰åˆ°VC1æ˜¾ç¤ºå‘¨æœŸå®Œå…¨ç»“æŸï¼Œæ‰èƒ½è¿›è¡ŒPushVC2æ“ä½œã€‚ æ­¤é—®é¢˜çš„å‘ç”Ÿå¹¶ä¸æ˜¯ç®€å•çš„ä¸€ä¸ªä»£ç å—ä¸­ä½¿ç”¨åŒä¸€ä¸ªå¯¼èˆªæ§åˆ¶å™¨è¿›è¡Œè¿ç»­Pushæ“ä½œã€‚å›æƒ³ä¸€ä¸‹ViewControllerçš„ç”Ÿå‘½å‘¨æœŸã€‚å…¶å®æ ‡å¿—ç€ViewControllerå®Œå…¨æ˜¾ç¤ºçš„æ˜¯viewDidAppear:è°ƒç”¨ï¼Œé‚£ä¹ˆåœ¨æ­¤æ–¹æ³•ç”Ÿå‘½å‘¨æœŸä¹‹å‰çš„æ–¹æ³•ä¸­è¿›è¡ŒPushå‡æœ‰å¯èƒ½é€ æˆâ€œnested push animation can result in corrupted navigation barâ€ã€‚ ç”±äºiOS7.1.2çš„iPhone5Cè¢«å‡çº§ï¼Œæ— æ³•å¿…ç°æ­¤BUGï¼Œæ‰€ä»¥æ²¡æœ‰æˆªå›¾ã€‚å¯ä»¥è‡ªå·±æ‰¾ä¸ªæµ‹ä¸€ä¸‹ã€‚ã€‚ è§£å†³æ–¹æ¡ˆæ–¹æ¡ˆä¸€ï¼šé€šè¿‡å»¶æ—¶é¿å¼€æ­¤æ—¶é—´æ®µã€‚åœ¨å¾ˆå¤šæºç ä¸­ä¼šçœ‹åˆ°è¿™æ ·ä¸€è¡Œä»£ç ï¼š 1234// 0.1æ˜¯æˆ‘éšæ‰‹å†™çš„ã€‚ã€‚æ˜¯ä¸€ä¸ªæ ¹æ®è‡ªå·±æƒ…å†µä¼°ç®—ä¸Šä¸€ä¸ªPUSHçš„è€—æ—¶ï¼Œdispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.1 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; [self.navigationController pushViewController:vc animated:YES];&#125;); å¦‚ä¸Šä»£ç ï¼Œåœ¨GitHubä¸­å¾ˆå¸¸è§ï¼Œèµ·åˆå¹¶ä¸æ‡‚å…¶ç”¨æ„ï¼Œå½“é‡åˆ°è¿™ä¸ªé—®é¢˜æ—¶å€™æˆ‘æ‰æ˜ç™½ã€‚ è¿˜æœ‰ä¸€ç§ä»£ç ï¼š 123456// objccn.iodispatch_async(dispatch_get_main_queue(), ^&#123; // Some UIKit call that had timing issues but works fine // in the next runloop. [self updatePopoverSize];&#125;); è¿™ç§ä»£ç æ˜¯åˆ‡æ¢åˆ°ä¸‹ä¸ªä»£ç å‘¨æœŸï¼Œæ¥é¿å¼€åµŒå¥—çš„æ—¶åºé—®é¢˜ã€‚objc.ioæœ‰è¿™ä¹ˆä¸ªæ–‡ç« è¯´äº†è¿™ä¸ªé—®é¢˜çš„å¼Šç«¯ï¼š ç”¨ dispatch_async ä¿®å¤æ—¶åºé—®é¢˜ åœ¨ä½¿ç”¨ UIKit çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›æ—¶åºä¸Šçš„éº»çƒ¦ï¼Ÿå¾ˆå¤šæ—¶å€™ï¼Œè¿™æ ·è¿›è¡Œâ€œä¿®æ­£â€çœ‹æ¥éå¸¸å®Œç¾ï¼š 12345dispatch_async(dispatch_get_main_queue(), ^&#123; // Some UIKit call that had timing issues but works fine // in the next runloop. [self updatePopoverSize];&#125;); åƒä¸‡åˆ«è¿™ä¹ˆåšï¼ç›¸ä¿¡æˆ‘ï¼Œè¿™ç§åšæ³•å°†ä¼šåœ¨ä¹‹åä½ çš„ app è§„æ¨¡å¤§ä¸€äº›çš„æ—¶å€™è®©ä½ æ‰¾ä¸ç€åŒ—ã€‚è¿™ç§ä»£ç éå¸¸éš¾ä»¥è°ƒè¯•ï¼Œå¹¶ä¸”ä½ å¾ˆå¿«å°±ä¼šé™·å…¥ç”¨æ›´å¤šçš„ dispatch æ¥ä¿®å¤æ‰€è°“çš„è«åå…¶å¦™çš„â€æ—¶åºé—®é¢˜â€ã€‚å®¡è§†ä½ çš„ä»£ç ï¼Œå¹¶ä¸”æ‰¾åˆ°åˆé€‚çš„åœ°æ–¹æ¥è¿›è¡Œè°ƒç”¨ï¼ˆæ¯”å¦‚åœ¨ viewWillAppear é‡Œè°ƒç”¨ï¼Œè€Œä¸æ˜¯ viewDidLoad ä¹‹ç±»çš„ï¼‰æ‰æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æ­£ç¡®åšæ³•ã€‚æˆ‘åœ¨è‡ªå·±çš„ä»£ç ä¸­ä¹Ÿè¿˜ç•™æœ‰ä¸€äº›è¿™æ ·çš„ hackï¼Œä½†æ˜¯æˆ‘ä¸ºå®ƒä»¬åŸºæœ¬éƒ½åšäº†æ­£ç¡®çš„æ–‡æ¡£å·¥ä½œï¼Œå¹¶ä¸”å¯¹åº”çš„ issue ä¹Ÿè¢«ä¸€ä¸€è®°å½•è¿‡ã€‚ è®°ä½è¿™ä¸æ˜¯çœŸæ­£çš„ GCD ç‰¹æ€§ï¼Œè€Œåªæ˜¯ä¸€ä¸ªåœ¨ GCD ä¸‹å¾ˆå®¹æ˜“å®ç°çš„å¸¸è§åé¢æ¨¡å¼ã€‚äº‹å®ä¸Šä½ å¯ä»¥ä½¿ç”¨ performSelector:afterDelay: æ–¹æ³•æ¥å®ç°åŒæ ·çš„æ“ä½œï¼Œå…¶ä¸­ delay æ˜¯åœ¨å¯¹åº”æ—¶é—´åçš„ runloopã€‚ å…¶å®è¿™æ ·è®¾è®¡å¾ˆç®€å•ï¼Œç›®çš„å°±æ˜¯é€šè¿‡GCDçš„å»¶è¿Ÿæäº¤æ¥â€œå·§å¦™â€çš„é¿å¼€Pushçš„æ—¶é—´ï¼Œå¾ˆæ˜¾ç„¶è¿™ä¸ªæ—¶é—´å¯¹äºæœºå‹ã€ç³»ç»Ÿç‰ˆæœ¬ã€å½“å‰æ‰‹æœºçŠ¶å†µæ¥è¯´å¾ˆéš¾æŠŠæ¡ã€‚ä½†æ˜¯ä¸å¾—ä¸è¯´çš„æ˜¯ç¡®å®æœ‰äº›ä½œç”¨ï¼Œé‚£å°±æ˜¯èƒ½é¿å¼€éƒ¨åˆ†é—®é¢˜ã€‚æ‰€ä»¥æœ¬æ¥å°æ¦‚ç‡å‘ç”Ÿçš„äº‹æƒ…ï¼Œè¿™ä¸ªå†è¿‡æ»¤ä¸€äº›ï¼Œè¿™ä¸ªBUGå°±å¾®ä¹å…¶å¾®äº†ã€‚ æ–¹æ¡ˆäºŒï¼šå¼ºåˆ¶åœ¨viewDidAppear:ä¹‹åè¿›è¡ŒPushã€‚ä¸å¾—ä¸è¯´è¿™æ ·çš„åšæ³•æˆ‘æ›¾ç»ç”¨è¿‡ä¸€ä¸ªé¡µé¢ï¼Œä¸å¤šè¯´ï¼Œéº»çƒ¦ç¨‹åº¦è‡ªå·±æµ‹ä¸€ä¸‹ã€‚ å¦‚æœè¯´å¤šäººåˆä½œé¡¹ç›®å‘¢ï¼Œå¦‚æœè¯´é¡µé¢æ¯”è¾ƒå¤šã€å·¥ä½œæ¯”è¾ƒå¿™å‘¢ï¼Ÿå‘µå‘µå“’ æ–¹æ¡ˆä¸‰ï¼šå¯¹UINavigationControlleræ‰€Pushçš„VCè¿›è¡Œé˜Ÿåˆ—åŒ–ã€‚å¯¹äºVCæ˜¯å¦å·²ç»Pushç»“æŸï¼ŒUINavigationControlleræœ€æ¸…æ¥šï¼Œè€Œè¿™ä¸€ç»“æœåˆšå¥½é€šè¿‡ä»£ç†ä¼ é€’å‡ºæ¥ã€‚æ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹å¯¹Pushçš„VCsè¿›è¡Œé˜Ÿåˆ—åŒ–ï¼Œé˜²æ­¢å…¶è¿›è¡ŒåµŒå¥—Pushã€‚ é‚£ä¹ˆé—®é¢˜å°±å¯ä»¥å¾—åˆ°å¾ˆå¥½çš„è§£å†³ã€‚ å¯¹ æ–¹æ¡ˆä¸‰ çš„è¯¦ç»†å°è£… å¯¹äºè¯¥é—®é¢˜çš„æœ€ç®€å•çš„ã€ä¾¿äºåˆä½œã€ä¾¿äºæ›´æ”¹çš„å°±æ˜¯æ–¹æ¡ˆä¸‰äº†ï¼Œå¯¹æ–¹æ¡ˆä¸‰è¿›è¡Œå±•å¼€å¯å¾—å¦‚ä¸‹æ­¥éª¤ï¼š è®¾ç½®UINavigationControllerçš„ä»£ç†ï¼Œå¹¶å®ç°willShowViewControllerã€didShowViewControlleræ–¹æ³•ã€‚ æ‹¦æˆªåˆ°UINavigationControllerçš„Pushæ–¹æ³•ï¼Œé€šè¿‡æ­¥éª¤1çš„ä»£ç†åˆ¤æ–­åˆ°æ˜¯å¦æ­£åœ¨Show,å¦‚æœä¸åœ¨Showåˆ™æ˜¾ç¤ºï¼Œå¦‚æœæ­£åœ¨Showåˆ™æŠŠå½“å‰çš„VCå…¥é˜Ÿåˆ—ã€‚åœ¨didShowViewControllerä¸­åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰åˆ™è¯´æ˜å‘ç”Ÿäº†é‡å ï¼Œè¯¥é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªè¿›è¡ŒPushã€‚ä¸ºäº†æ›´å¥½çš„å…¼å®¹æ‰€é‡åˆ°çš„Pushæƒ…å†µï¼Œä½¿ç”¨0.5ç§’ä½œä¸ºå…œåº•ï¼Œå¯¹é˜Ÿåˆ—è¿›è¡Œæ”¾å¼€ã€‚ç»“æŸï¼Œå°±æ˜¯è¿™æ ·å­ã€‚ è¯´ä¸‹æˆ‘å®ç°çš„æ–¹æ³•ï¼Œå…¶å®é‡ç‚¹åœ¨äºå¦‚ä½•æ‹¦æˆªPushæ“ä½œã€‚ æˆ‘æœ€å¼€å§‹é‡‡ç”¨äº†ç»§æ‰¿UINavigationControllerçš„æ–¹æ³•ï¼Œå› ä¸ºç»§æ‰¿ä½†ä¸€ï¼Œä¸ä¼šå¹²æ‰°å…¶ä»–çš„ç±»ã€‚å€¼å¾—ä¸€èµã€‚ å¯¹äºè¦è§£å†³å…¶é—®é¢˜ï¼Œæ‰€æœ‰çš„éƒ½éœ€è¦è¿›è¡Œç»§æ‰¿ï¼Œè¿‡äºéº»çƒ¦ï¼Œäºæ˜¯å¢åŠ äº†ç¬¬äºŒç§æ–¹æ¡ˆï¼šHOOKã€‚ ä¸¤ç§æ–¹æ¡ˆä¸ºäº†è¾¾åˆ°ç»Ÿä¸€çš„æ•ˆæœï¼Œæ‰€ä»¥æ‹‰å‡ºå…¶ä¸­çš„ä»£ç†ï¼Œå°±å®Œæˆäº†ç»Ÿä¸€ã€‚ ä»£ç ï¼‹Demo]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Debug</tag>
      </tags>
  </entry>
</search>
