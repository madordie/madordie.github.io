<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ä¸ªäººèµ„æ–™é¡µ</title>
    <url>/post/about-me/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="å­™ç»§åˆš"><a href="#å­™ç»§åˆš" class="headerlink" title="å­™ç»§åˆš"></a>å­™ç»§åˆš</h1><ul>
<li>ç”· / 1992.09 / å…šå‘˜ / æ±‰æ—</li>
<li>æ‰‹æœº: <a href="tel://1717932390">1717932390</a></li>
<li>åšå®¢: <a href="https://madordie.github.io/">ç»§åˆšçš„åšå®¢</a></li>
<li>GitHub: <a href="https://github.com/madordie" target="_blank" rel="noopener">madordie</a></li>
<li>Email: <a href="mailto:io.madordie@gmail.com">io.madordie@gmail.com</a></li>
</ul>
<h2 id="ä¸ªäººæŠ€èƒ½"><a href="#ä¸ªäººæŠ€èƒ½" class="headerlink" title="ä¸ªäººæŠ€èƒ½"></a>ä¸ªäººæŠ€èƒ½</h2><ul>
<li>ç†Ÿç»ƒæŒæ¡Objective-Cã€Swiftç­‰è¯­è¨€, äº†è§£shellã€C</li>
<li>èƒ½å¤Ÿä½¿ç”¨å„ç§å·¥å…·åˆ†æå¹¶è§£å†³å†…å­˜æ³„æ¼ã€å´©æºƒç­‰é—®é¢˜</li>
<li>ç†Ÿç»ƒæŒæ¡runtimeã€runloopã€blockç­‰,å¹¶äº†è§£ç›¸å…³çš„åº•å±‚çŸ¥è¯†</li>
<li>èƒ½å¤Ÿæ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè¾ƒä¼˜åœ°æŠ€æœ¯é€‰å‹ä»¥åŠå®ç°</li>
<li>æ‹¥æœ‰è¾ƒå¼ºçš„å‘ç°ã€åˆ†æã€è§£å†³é—®é¢˜çš„èƒ½åŠ›</li>
<li>æ‹¥æœ‰è‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯</li>
<li>èƒ½å¤Ÿä½¿ç”¨Jenkinsç­‰è‡ªåŠ¨åŒ–å·¥å…·è¿›è¡ŒæŒç»­é›†æˆå¹¶åˆ†å‘</li>
</ul>
<h2 id="å·¥ä½œç»å†"><a href="#å·¥ä½œç»å†" class="headerlink" title="å·¥ä½œç»å†"></a>å·¥ä½œç»å†</h2><ul>
<li>2015.08-è‡³ä»Š ä¸Šæµ·æˆ¿å¤šå¤šç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ (iOSé«˜çº§å·¥ç¨‹å¸ˆ)</li>
<li>2014.10-2015.05 ä¸Šæµ·å•†è·¯ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ (iOSå·¥ç¨‹å¸ˆ)</li>
</ul>
<h2 id="é¡¹ç›®ç»å†"><a href="#é¡¹ç›®ç»å†" class="headerlink" title="é¡¹ç›®ç»å†"></a>é¡¹ç›®ç»å†</h2><h3 id="å¤šå¤šå–æˆ¿"><a href="#å¤šå¤šå–æˆ¿" class="headerlink" title="å¤šå¤šå–æˆ¿"></a>å¤šå¤šå–æˆ¿</h3><p>ä¸€ä¸ªæˆ¿å¤šå¤šç»çºªå•†æˆ·ä¸“ä¸šè·å®¢å¹³å°ã€ç»çºªäººç§»åŠ¨ä½œä¸šå¹³å°</p>
<ul>
<li>ä¸»è¦ä½¿ç”¨è¯­è¨€: Objective-C + Swift</li>
<li>ä¸»è¦ä½¿ç”¨å¸ƒå±€: Code Frame + AutoLayout</li>
<li>ç»„ç»‡é¡¹ç›®å¯åŠ¨å¹¶è§„èŒƒå¼€å‘æµç¨‹ä»¥é€‚åº”æ›´å¤šäººçš„åä½œå¼€å‘</li>
<li>æ¨è¿›é¡¹ç›®æ¨¡å—åŒ–</li>
<li>ä¸»å¯¼ä¸€äº›æ ¸å¿ƒåº“çš„åº•å±‚å®ç°</li>
</ul>
<h3 id="å¯å¯èµš"><a href="#å¯å¯èµš" class="headerlink" title="å¯å¯èµš"></a>å¯å¯èµš</h3><p>ä¸€ä¸ªå‘å¸ƒä»»åŠ¡ã€åšä»»åŠ¡ã€é¢†å–ç°é‡‘çš„åˆ·æ¦œç§¯åˆ†å¢™</p>
<ul>
<li>ä¸»è¦ä½¿ç”¨è¯­è¨€: Objective-C + C + Swift</li>
<li>ä¸»è¦è´Ÿè´£å®‰è£…æ£€æµ‹ã€æ··æ·†ã€åé€†å‘ç­‰æ ¸å¿ƒåŠŸèƒ½çš„ç ”å‘ä¸ç»´æŠ¤</li>
<li>è´Ÿè´£åˆ†æã€æ ‡è®°ã€é”å®šå¯ç–‘ç”¨æˆ·è¡Œä¸ºçš„è´¦å·åŠå…³è”è´¦å·</li>
</ul>
<h3 id="æˆ¿å¤šå¤š"><a href="#æˆ¿å¤šå¤š" class="headerlink" title="æˆ¿å¤šå¤š"></a>æˆ¿å¤šå¤š</h3><p>ä¸€ä¸ªå¯ä»¥è¿›è¡Œæ–°æˆ¿ã€äºŒæ‰‹æˆ¿ã€ç§Ÿæˆ¿è¿›è¡Œä¹°å–çš„å¹³å°</p>
<ul>
<li>ä¸»è¦ä½¿ç”¨è¯­è¨€: Objective-C + Swift</li>
<li>ä¸»è¦ä½¿ç”¨å¸ƒå±€: Code Frame + AutoLayout</li>
<li>æ­å»ºå¹¶ç»´æŠ¤Jenkinså¹³å°</li>
<li>è®¾è®¡å®ç°å¹¶ç»´æŠ¤è¾ƒä¸ºå¤æ‚çš„æ¨¡å—</li>
<li>æ ¹æ®å´©æºƒç³»ç»Ÿçš„ç»Ÿè®¡,åˆ†æå¹¶ä¿®å¤å„ç§å´©æºƒ</li>
</ul>
<h3 id="è‚Œè‚¤ç®¡å®¶"><a href="#è‚Œè‚¤ç®¡å®¶" class="headerlink" title="è‚Œè‚¤ç®¡å®¶"></a>è‚Œè‚¤ç®¡å®¶</h3><p>ä¸€ä¸ªç”¨ç¡¬ä»¶æµ‹è¯•çš®è‚¤æ•°æ®å¹¶æä¾›ä¿å…»å»ºè®®çš„åŒ–å¦†å“ç¤¾åŒº</p>
<ul>
<li>ä¸»è¦ä½¿ç”¨è¯­è¨€: Objective-C + C</li>
<li>ä¸»è¦ä½¿ç”¨å¸ƒå±€: Interface Builder + AutoLayout</li>
<li>è´Ÿè´£é¡¹ç›®2xç‰ˆæœ¬æ ¸å¿ƒåŠŸèƒ½çš„å¼€å‘ã€ç»´æŠ¤ å¦‚: ç¤¾åŒºã€IMã€ç­‰</li>
<li>ä¸€ä»£ç¡¬ä»¶è‚Œè‚¤æµ‹è¯•ä»ªçš„ç¡¬ä»¶å¯¹æ¥ä¸åŠŸèƒ½å¼€å‘</li>
</ul>
<h2 id="æ•™è‚²èƒŒæ™¯"><a href="#æ•™è‚²èƒŒæ™¯" class="headerlink" title="æ•™è‚²èƒŒæ™¯"></a>æ•™è‚²èƒŒæ™¯</h2><p>æœ¬ç§‘: 2011.09-2015.06 å—é˜³ç†å·¥å­¦é™¢   è½¯ä»¶å·¥ç¨‹(ç§»åŠ¨è®¾å¤‡åº”ç”¨å¼€å‘æ–¹å‘)</p>
<h2 id="è‡ªæˆ‘è¯„ä»·"><a href="#è‡ªæˆ‘è¯„ä»·" class="headerlink" title="è‡ªæˆ‘è¯„ä»·"></a>è‡ªæˆ‘è¯„ä»·</h2><ul>
<li>çƒ­è¡·äºæŠ€æœ¯</li>
<li>å§‹ç»ˆä¿¡å¥‰: ä»£ç çš„ç®€å•ç¨‹åº¦ä¸ç»´æŠ¤æˆæœ¬ä»¥åŠå‡ºé”™ç‡æˆæ­£æ¯”</li>
<li>ä¹è§‚å¼€æœ—ã€æ€ç»´æ´»è·ƒã€åšäº‹è®¤çœŸè´Ÿè´£ã€ä¸ºäººç§¯æä¹è§‚ã€æœ‰è¾ƒå¼ºçš„å›¢é˜Ÿæ„è¯†</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>åšå®¢è¿ç§»å…¬å‘Š</title>
    <url>/post/about-change-blog/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>ä½ æ•¢ä¿¡ï¼æˆ‘åˆæ¬å®¶äº†ã€‚ã€‚</p>
<p>ä¹‹å‰åœ¨<a href="http://www.cnblogs.com/madordie/" target="_blank" rel="noopener">åšå®¢å›­</a>åæ¥åˆå»äº†<a href="http://madordie.leanote.com/" target="_blank" rel="noopener">èš‚èšç¬”è®°</a>ï¼Œæœ€åå§ï¼Œæˆ‘å°±åˆ°äº†<a href="https://madordie.github.io/">è¿™é‡Œ</a>ã€‚</p>
<p>è¯´ä¸‹å¤§ä½“æ„Ÿå—ï¼š</p>
<p><a href="http://www.cnblogs.com/" target="_blank" rel="noopener">åšå®¢å›­</a>æŒºå¥½çš„ï¼Œä¸è¿‡ä¸å–œæ¬¢å…¶ç¼–ç æ–¹å¼ï¼ŒçœŸçš„ä¸å–œæ¬¢ã€‚åšå®¢å›­çš„ä¸»é¢˜ä»€ä¹ˆçš„éƒ½æ˜¯å¯ä»¥å®šåˆ¶ï¼Œä½†æ˜¯æ€»å½’æ˜¯å†™èµ·æ¥æ¯”è¾ƒè´¹åŠ²çš„ã€‚</p>
<p><del><a href="https://leanote.com/" target="_blank" rel="noopener">èš‚èšç¬”è®°</a>ä¸é”™ï¼Œæˆ‘å¼€å§‹æ—¶å€™logoè¿˜ä¸æ˜¯è¿™ä¸ª<img src="http://7xvzwi.com1.z0.glb.clouddn.com/leanote_new_logo.png" width=35 alt="æ–°logo">åŸæ¥logoæ˜¯<img src="http://7xvzwi.com1.z0.glb.clouddn.com/leanote_old_logo.png" width=35 alt="æ—§logo" >ğŸ˜‚,ä¸è¿‡ç°åœ¨å·²ç»å¾ˆå‰å®³äº†ï¼Œå¼€å§‹äº†å„ç§ä¸šåŠ¡ã€‚æœŸå¾…ä¼šèµ°å¾—æ›´å¥½æ›´è¿œã€‚</del></p>
<p>èš‚èšç¬”è®°å·²ä¸æ”¯æŒå…è´¹ç”¨æˆ·éƒ¨ç½²åšå®¢ï¼Œè¿™é‡Œæ˜¯<a href="https://leanote.com/pricing" target="_blank" rel="noopener">ä»·æ ¼æ–¹æ¡ˆ</a>ã€‚</p>
<p>æˆ‘æ˜¯çœ‹äº†<a href="http://blog.devtang.com/" target="_blank" rel="noopener">å·§å“¥</a>çš„<a href="http://blog.devtang.com/2012/02/10/setup-blog-based-on-github/" target="_blank" rel="noopener">è¿™ä¸ªåšæ–‡</a>æ‰å¼€å§‹å‡†å¤‡è½¬åˆ°Githubçš„ã€‚ã€‚èµ¶è„šmarkdownå¾ˆå¥½ç©ï¼Œè™½ç„¶å‡ºæ¥å¾ˆæ—©äº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä»”ç»†çš„å»å­¦ä¹ è¿™ä¸ªè¯­æ³•ï¼Œäºæ˜¯ä¹è¿™ä¸ªåšå®¢å°±ç”¨<a href="https://hexo.io/" target="_blank" rel="noopener">hexo</a>è¿›è¡Œæ­å»ºã€‚</p>
<p>è™½ç„¶æˆ‘è¿˜ä¸çŸ¥é“æ€ä¹ˆè®©ç™¾åº¦æ”¶å½•æˆ‘çš„Githubï¼Œä½†æ˜¯ä¸»è¦çš„æ˜¯èƒ½å°è¯•ç€è‡ªå·±æƒ³è¯•è¯•ç¡®æ²¡æœ‰å°è¯•çš„äº‹æƒ…ï¼</p>
]]></content>
      <categories>
        <category>å…¬å‘Š</category>
      </categories>
      <tags>
        <tag>blog</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoçš„åšå®¢è®©ç™¾åº¦æ”¶å½•</title>
    <url>/post/use-hexo-setup-blog/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>è¿™ä¸ªgithub.ioæ­å»ºçš„è¿‡ç¨‹å‚è€ƒï¼Œä»¥åŠå‘ç™¾åº¦æ¨é€çš„pythonã€jsè„šæœ¬ã€‚</p>
<a id="more"></a>

<h1 id="å‚è€ƒåšå®¢"><a href="#å‚è€ƒåšå®¢" class="headerlink" title="å‚è€ƒåšå®¢"></a>å‚è€ƒåšå®¢</h1><p>æ„Ÿè°¢ <a href="http://lovenight.github.io/" target="_blank" rel="noopener">å²æœˆå¦‚æ­Œ</a> çš„è¿™ä¸ª<a href="http://lovenight.github.io/2015/11/10/Hexo-3-1-1-%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/" target="_blank" rel="noopener">ã€ŠHexo 3.1.1 é™æ€åšå®¢æ­å»ºæŒ‡å—ã€‹</a>åŒæ—¶æ„Ÿè°¢è¿™ä¸ª<a href="http://lovenight.github.io/2015/11/18/%E5%90%91%E7%99%BE%E5%BA%A6%E6%8E%A8%E9%80%81hexo%E5%8D%9A%E5%AE%A2%E6%89%80%E6%9C%89%E9%93%BE%E6%8E%A5%E7%9A%84Python%E8%84%9A%E6%9C%AC/" target="_blank" rel="noopener">ã€Šå‘ç™¾åº¦æ¨é€hexoåšå®¢æ‰€æœ‰é“¾æ¥çš„Pythonè„šæœ¬ã€‹</a>(åˆ«é—®æˆ‘ä¸ºå•¥ç‚¹ä¸å¼€ï¼Œè¿™ä¸ªè¦é—®åšä¸»ï¼Œä¸è¿‡è¦çœ‹è¿™ä¸ªæ–‡ç« ä¹Ÿä¸æ˜¯æ²¡åŠæ³•çš„ğŸ˜‚ï¼Œå› ä¸ºè¿™ä¸ªåšå®¢ä¹Ÿç”¨gitç®¡ç†çš„ã€‚ã€‚ã€‚ä½ æ‡‚)</p>
<p>å¦å¤–è¿˜æœ‰ä¸€ä¸ª<a href="http://emufan.com/" target="_blank" rel="noopener">soul</a>çš„<a href="http://emufan.com/2016/02/18/%E7%99%BE%E5%BA%A6%E4%B8%BB%E5%8A%A8%E6%8E%A8%E9%80%81hexo%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E7%AB%A0/" target="_blank" rel="noopener">ç™¾åº¦ä¸»åŠ¨æ¨é€hexoç”Ÿæˆçš„æ–‡ç« </a></p>
<h1 id="pythonè‡ªåŠ¨æ¨é€è„šæœ¬ä¿®æ”¹"><a href="#pythonè‡ªåŠ¨æ¨é€è„šæœ¬ä¿®æ”¹" class="headerlink" title="pythonè‡ªåŠ¨æ¨é€è„šæœ¬ä¿®æ”¹"></a>pythonè‡ªåŠ¨æ¨é€è„šæœ¬ä¿®æ”¹</h1><p>ä¸Šé¢è¯´çš„åšä¸»å¤§çº¦ç”¨çš„æ˜¯windowsï¼Œæ‰€ä»¥è„šæœ¬å¹¶ä¸èƒ½ç«‹é©¬çš„è¿è¡Œåœ¨Macä¸Šï¼Œéœ€è¦åšäº›ä¿®æ”¹ï¼šæ•…ä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: LoveNight</span></span><br><span class="line"><span class="comment"># @Date:   2015-11-16 20:45:59</span></span><br><span class="line"><span class="comment"># @Last Modified by:   LoveNight</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2015-11-18 18:07:19</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># @Last Modified by:   Keith</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2016-07-06 16:22:45</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup <span class="keyword">as</span> BS</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment">#import msvcrt</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">hexo åšå®¢ä¸“ç”¨ï¼Œå‘ç™¾åº¦ç«™é•¿å¹³å°æäº¤æ‰€æœ‰ç½‘å€</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æœ¬è„šæœ¬å¿…é¡»æ”¾åœ¨hexoåšå®¢çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼éœ€è¦å·²å®‰è£…ç”Ÿæˆç™¾åº¦ç«™ç‚¹åœ°å›¾çš„æ’ä»¶ã€‚</span></span><br><span class="line"><span class="string">ç™¾åº¦ç«™é•¿å¹³å°æäº¤é“¾æ¥ï¼šhttp://zhanzhang.baidu.com/linksubmit/index</span></span><br><span class="line"><span class="string">ä¸»åŠ¨æ¨é€ï¼šæœ€ä¸ºå¿«é€Ÿçš„æäº¤æ–¹å¼ï¼Œæ¨èæ‚¨å°†ç«™ç‚¹å½“å¤©æ–°äº§å‡ºé“¾æ¥ç«‹å³é€šè¿‡æ­¤æ–¹å¼æ¨é€ç»™ç™¾åº¦ï¼Œä»¥ä¿è¯æ–°é“¾æ¥å¯ä»¥åŠæ—¶è¢«ç™¾åº¦æ”¶å½•ã€‚</span></span><br><span class="line"><span class="string">ä»ä¸­æ‰¾åˆ°è‡ªå·±çš„æ¥å£è°ƒç”¨åœ°å€</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pythonç¯å¢ƒï¼š</span></span><br><span class="line"><span class="string">pip install beautifulsoup4</span></span><br><span class="line"><span class="string">pip install requests</span></span><br><span class="line"><span class="string">xcode-select --install	</span></span><br><span class="line"><span class="string">pip install lxml </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âŒâŒâŒ æŠ„çš„éœ€è¦æ›´æ”¹è¿™ä¸ªURLï¼ï¼è¿™æ˜¯æˆ‘çš„ï¼ï¼âŒâŒâŒ</span></span><br><span class="line">url = <span class="string">'http://data.zz.baidu.com/urls?site=https://madordie.github.io&amp;token=j33t0VEPFl24tJ8N'</span></span><br><span class="line">baidu_sitemap = os.path.join(sys.path[<span class="number">0</span>], <span class="string">'public'</span>, <span class="string">'baidusitemap.xml'</span>)</span><br><span class="line">google_sitemap = os.path.join(sys.path[<span class="number">0</span>], <span class="string">'public'</span>, <span class="string">'sitemap.xml'</span>)</span><br><span class="line">sitemap = [baidu_sitemap, google_sitemap]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> (os.path.exists(baidu_sitemap) <span class="keyword">or</span> os.path.exists(</span><br><span class="line">    google_sitemap)), <span class="string">"æ²¡æ‰¾åˆ°ä»»ä½•ç½‘ç«™åœ°å›¾ï¼Œè¯·æ£€æŸ¥ï¼"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»ç«™ç‚¹åœ°å›¾ä¸­è¯»å–ç½‘å€åˆ—è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrls</span><span class="params">()</span>:</span></span><br><span class="line">    urls = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> sitemap:</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(_):</span><br><span class="line">            <span class="keyword">with</span> open(_, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">                xml = f.read()</span><br><span class="line">        soup = BS(xml, <span class="string">"xml"</span>)</span><br><span class="line">        tags = soup.find_all(<span class="string">"loc"</span>)</span><br><span class="line">        urls += [x.string <span class="keyword">for</span> x <span class="keyword">in</span> tags]</span><br><span class="line">        <span class="keyword">if</span> _ == baidu_sitemap:</span><br><span class="line">            tags = soup.find_all(<span class="string">"breadCrumb"</span>, url=<span class="literal">True</span>)</span><br><span class="line">            urls += [x[<span class="string">"url"</span>] <span class="keyword">for</span> x <span class="keyword">in</span> tags]</span><br><span class="line">    <span class="keyword">return</span> urls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># POSTæäº¤ç½‘å€åˆ—è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">postUrls</span><span class="params">(urls)</span>:</span></span><br><span class="line">    urls = set(urls)  <span class="comment"># å…ˆå»é‡</span></span><br><span class="line">    print(<span class="string">"ä¸€å…±æå–å‡º %s ä¸ªç½‘å€"</span> % len(urls))</span><br><span class="line">    print(urls)</span><br><span class="line">    data = <span class="string">"\n"</span>.join(urls)</span><br><span class="line">    <span class="keyword">return</span> requests.post(url, data=data).text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    urls = getUrls()</span><br><span class="line">    result = postUrls(urls)</span><br><span class="line">    print(<span class="string">"æäº¤ç»“æœï¼š"</span>)</span><br><span class="line">    print(result)</span><br><span class="line"><span class="comment">#    msvcrt.getch()</span></span><br></pre></td></tr></table></figure>

<h1 id="jsè„šæœ¬"><a href="#jsè„šæœ¬" class="headerlink" title="jsè„šæœ¬"></a>jsè„šæœ¬</h1><p>è¿™ä¸ªè„šæœ¬æ˜¯æˆ‘åœ¨<a href="http://emufan.com/" target="_blank" rel="noopener">soul</a>çš„<a href="http://emufan.com/2016/02/18/%E7%99%BE%E5%BA%A6%E4%B8%BB%E5%8A%A8%E6%8E%A8%E9%80%81hexo%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E7%AB%A0/" target="_blank" rel="noopener">ç™¾åº¦ä¸»åŠ¨æ¨é€hexoç”Ÿæˆçš„æ–‡ç« </a>å‘ç°çš„ï¼Œæ„Ÿè§‰ä¹Ÿå¾ˆèµã€‚</p>
<blockquote>
<h2 id="github"><a href="#github" class="headerlink" title="github"></a>github</h2><p>  <a href="https://github.com/Relsoul/bdwork/tree/master/soul/hexo%E7%99%BE%E5%BA%A6%E4%B8%BB%E5%8A%A8%E4%B8%8A%E4%BC%A0" target="_blank" rel="noopener">è„šæœ¬åœ°å€</a></p>
</blockquote>
<h2 id="æ¨é€"><a href="#æ¨é€" class="headerlink" title="æ¨é€"></a>æ¨é€</h2><p>  ä»Šå¤©å‘ç°ç™¾åº¦æ²¡æ”¶å½•æˆ‘çš„ç«™..ä¸»è¦æ˜¯æˆ‘çš„ç«™ç‚¹æ¢æ¥æ¢å»çš„..ä¼°è®¡è¢«banäº†..ç„¶åæƒ³ç”¨sitemapæ¥æ¨é€ä¸€ä¸‹..ç»“æœå‘ç°githubç¦ç”¨äº†ç™¾åº¦çˆ¬è™«..æ²¡åŠæ³•åªèƒ½ä¸»åŠ¨æ¨é€äº†.</p>
<h2 id="åˆ©ç”¨æ’ä»¶"><a href="#åˆ©ç”¨æ’ä»¶" class="headerlink" title="åˆ©ç”¨æ’ä»¶"></a>åˆ©ç”¨æ’ä»¶</h2><p>  è¿™é‡Œåˆ©ç”¨åˆ°äº†ä¸€æ¬¾æ’ä»¶<br>  <a href="https://github.com/coneycode/hexo-generator-baidu-sitemap" target="_blank" rel="noopener">hexo-generator-baidu-sitemap</a><br>  è®¾ç½®å¾ˆç®€å• åªéœ€è¦åœ¨.config.ymlæ·»åŠ ä¸€äº›æ•°æ®å³å¯, ä¸‹é¢é™„ä¸Šæˆ‘çš„æ·»åŠ æ•°æ® themeè¿™ä¸ªå¯ä»¥éšæ„æ›´æ”¹ ä¸‹é¢çš„copyå³å¯<br>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">## Plugins: http:&#x2F;&#x2F;hexo.io&#x2F;plugins&#x2F;</span><br><span class="line">## Themes: http:&#x2F;&#x2F;hexo.io&#x2F;themes&#x2F;</span><br><span class="line">theme: yilia</span><br><span class="line">baidusitemap:</span><br><span class="line">path: baidusitemap.xml</span><br></pre></td></tr></table></figure></p>
<blockquote>
<h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><p>  ç„¶åhexo g ç”Ÿæˆä¸€ä¸‹æ•°æ® ä¼šåœ¨publicä¸‹é¢å‘ç°ä¸€ä¸ªæ–‡ä»¶åä¸ºbaidusitemap.xml</p>
</blockquote>
<h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><p>  è¿™é‡Œç”¨nodejså†™äº†ä¸€æ¬¾è„šæœ¬ å¤§æ¦‚æµç¨‹æ˜¯ è·å–baidusitemap.xmlé‡Œé¢çš„å†…å®¹ ç„¶åè¯»å–æœ¬åœ°çš„ä¸€ä¸ªsite_file.jsonè¿™ä¸ªæ–‡ä»¶ è¿™ä¸ªæ–‡ä»¶å­˜å‚¨çš„æ˜¯ä¸Šä¸€æ¬¡æ•°æ® ä¸ä¸Šä¸€æ¬¡æ•°æ®è¿›è¡Œå¯¹æ¯” å¦‚æœå¯¹æ¯”å‘ç°æ–°æ•°æ®é‚£ä¹ˆå°±ä¸Šä¼ æ–°æ•°æ® å¦åˆ™å…¨éƒ¨ä¸Šä¼ .</p>
<h2 id="è¿è¡Œè„šæœ¬"><a href="#è¿è¡Œè„šæœ¬" class="headerlink" title="è¿è¡Œè„šæœ¬"></a>è¿è¡Œè„šæœ¬</h2><p>  æŠŠActivePush.jsè„šæœ¬æ”¾åœ¨hexoæ–‡ä»¶å¤¹ä¸»ç›®å½• ç„¶åç”¨nodejs ActivePush.jsä¸€ä¸‹å³å¯ è¿™é‡Œè¿˜æ”¯æŒä¸€ä¸ªå‚æ•°nodejs ActivePush.js all åˆ™æ˜¯ä¸å¯¹æ¯”ç›´æ¥ä¸Šä¼ æ•°æ®</p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>blog</tag>
        <tag>SEO</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuä½¿ç”¨SakuraFrpå®ç°å†…ç½‘ç©¿é€</title>
    <url>/post/ubuntu-sakura-frp/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>è®°å½•å°†ä¸€å°åƒç°çš„ç¬”è®°æœ¬æ”¹è£…æˆæœåŠ¡å™¨ï¼Œå¹¶æš´éœ²åœ¨å…¬ç½‘ä¸‹çš„è¿‡ç¨‹ã€‚</p>
<a id="more"></a>

<h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><ul>
<li>ä¸€ä¸ª ubuntu-18.04.2-desktop-amd64.iso</li>
<li>ä¸€å°é™ˆæ—§çš„Gatewayç¬”è®°æœ¬</li>
<li>ä¸€å°ä¸»æˆ˜MBP</li>
</ul>
<p>iso: å¦‚æœä»<a href="https://ubuntu.com/download/desktop" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸‹è½½é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå¯ä»¥è€ƒè™‘ä¸Š<code>wget</code>ã€è¿…é›·ã€‚æˆ‘è¿™é‡Œä½¿ç”¨äº†<code>wget</code>å¹¶ä¸”ä½¿ç”¨äº†<a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cdimage/ubuntu/releases/" target="_blank" rel="noopener">æ¸…åçš„é•œåƒ</a></p>
<p>Gateway: è¿˜æ˜¯ä¸ªwin10ï¼Œäºæ˜¯ä¹é¡ºæ‰‹å°±æŠŠ<code>ubuntu-18.04.2-desktop-amd64.iso</code>åˆ¶ä½œæˆäº†Uç›˜ï¼Œæ­¤å¤„æˆ‘å°±ä¸è¯´äº†ï¼Œåæ­£èƒ½å¼•å¯¼è¿›å»å°±è¡Œå•Šå“ˆå“ˆå“ˆ</p>
<p>MBP: ä¸»è¦å·¥ä½œåœ¨è¿™é‡Œã€‚æ¯”å¦‚è¿œç¨‹winæ¡Œé¢ç”¨çš„æ˜¯<a href="https://apps.apple.com/us/app/microsoft-remote-desktop/id1295203466?mt=12" target="_blank" rel="noopener">Microsoft Remote Desktop</a></p>
<h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><p>æ³¨æ„ï¼ŒUbuntuä¼šå°†ç¡¬ç›˜ <strong>æ‰€æœ‰åˆ†åŒºå…¨éƒ¨æ ¼å¼åŒ–</strong> ï¼Œè¯·å…ˆå¦¥å–„å¤‡ä»½ã€‚</p>
<p>ç»è¿‡å®‰è£…æç¤ºä»¥åŠç¬”è®°æœ¬çš„ç–¯ç‹‚å‘çƒ­å¾ˆå¿«å°±å®‰è£…å®Œäº‹äº†ã€‚</p>
<h2 id="è®¾ç½®Ubuntuè½¯ä»¶æº"><a href="#è®¾ç½®Ubuntuè½¯ä»¶æº" class="headerlink" title="è®¾ç½®Ubuntuè½¯ä»¶æº"></a>è®¾ç½®Ubuntuè½¯ä»¶æº</h2><p>è¿™é‡Œè¿˜æ˜¯ç”¨æ¸…åå¤§å­¦çš„é•œåƒï¼Œå…¶<a href="https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/" target="_blank" rel="noopener">Ubuntu é•œåƒä½¿ç”¨å¸®åŠ©</a>ä¹Ÿæ˜¯ç›¸å½“çš„è¯¦ç»†ï¼š</p>
<blockquote>
<p>Ubuntu çš„è½¯ä»¶æºé…ç½®æ–‡ä»¶æ˜¯ /etc/apt/sources.listã€‚å°†ç³»ç»Ÿè‡ªå¸¦çš„è¯¥æ–‡ä»¶åšä¸ªå¤‡ä»½ï¼Œå°†è¯¥æ–‡ä»¶æ›¿æ¢ä¸ºä¸‹é¢å†…å®¹ï¼Œå³å¯ä½¿ç”¨ TUNA çš„è½¯ä»¶æºé•œåƒã€‚</p>
<p>é€‰æ‹©ä½ çš„ubuntuç‰ˆæœ¬: 18.04 LTS</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic main restricted universe multiverse</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-updates main restricted universe multiverse</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-updates main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-backports main restricted universe multiverse</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-backports main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-security main restricted universe multiverse</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"># é¢„å‘å¸ƒè½¯ä»¶æºï¼Œä¸å»ºè®®å¯ç”¨</span><br><span class="line"># deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-proposed main restricted universe multiverse</span><br><span class="line"># deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; bionic-proposed main restricted universe multiverse</span><br></pre></td></tr></table></figure>

<h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><p><code>apt</code>å·²ç»ç›¸å½“å®Œå–„ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt dist-upgrade</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œåˆ«å¿˜äº†å®‰è£…<code>wget</code>:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt install wget</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„å¦‚æœæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤å·²ç»è®¾ç½®äº†æ¸…åå¤§å­¦çš„é•œåƒæºï¼Œé‚£é€Ÿåº¦å°†ä¼šå¾ˆå¿«ã€‚è¦ä¸ç„¶å°±å¾ˆæ…¢æ…¢æ…¢ã€‚ã€‚</p>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><p>æ­¤æ­¥éª¤å¹¶éå¿…é¡»ï¼Œåªæ˜¯è®°å½•ä¸€ä¸‹ä¸€äº›å¾ˆå‘çš„äº‹æƒ…ï¼Œå•Šå“ˆå“ˆå“ˆå“ˆ</p>
<h3 id="æ²¡æœ‰Wi-Fié€‰é¡¹"><a href="#æ²¡æœ‰Wi-Fié€‰é¡¹" class="headerlink" title="æ²¡æœ‰Wi-Fié€‰é¡¹"></a>æ²¡æœ‰Wi-Fié€‰é¡¹</h3><p>å®‰è£…Wi-Fié©±åŠ¨ï¼Œè®°å¾—é‡å¯å“¦ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt install bcmwl-kernel-source</span><br></pre></td></tr></table></figure>

<h3 id="æœªçŸ¥çš„æ˜¾ç¤ºå™¨ï¼ˆUnknown-Displayï¼‰"><a href="#æœªçŸ¥çš„æ˜¾ç¤ºå™¨ï¼ˆUnknown-Displayï¼‰" class="headerlink" title="æœªçŸ¥çš„æ˜¾ç¤ºå™¨ï¼ˆUnknown Displayï¼‰"></a>æœªçŸ¥çš„æ˜¾ç¤ºå™¨ï¼ˆUnknown Displayï¼‰</h3><p>å¦‚æœæ˜¯å¾ˆå¿«çš„æ„è¯†åˆ°æ˜¯<code>è®¾ç½®</code>é‡Œé¢æœ‰ä¸€ä¸ª<code>æœªçŸ¥çš„æ˜¾ç¤ºå™¨</code>ï¼Œå¹¶ä¸”ä»¥<code>æ‹¼æ¥</code>çš„æ–¹å¼ä½¿ç”¨ï¼Œé‚£ä½ å°±ç›´æ¥æ ¹æ®<a href="https://bugs.launchpad.net/ubuntu/+source/ubuntu-drivers-common/+bug/1296020" target="_blank" rel="noopener">Non-existent display detected in both intel driver and nvidia driver (Optimus Laptop)</a>æ‰€ç¤ºï¼Œåªéœ€å®‰è£…Bumblebeeå¹¶é‡å¯å³å¯ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt install bumblebee-nvidia</span><br></pre></td></tr></table></figure>

<p>è¯¥é—®é¢˜è²Œä¼¼æ˜¯ç”±äºé›†æˆæ˜¾å¡å’Œç‹¬æ˜¾å…±å­˜çš„é—®é¢˜ï¼Œæ‰€ä»¥å½“ä½ å¹¶æ²¡æœ‰è¿æ¥å¤–æ¥æ˜¾ç¤ºå™¨ä½†æ˜¯å´å‡ºç°ä»¥ä¸‹åŒæ˜¾ç¤ºå™¨æ‰æœ‰çš„åŠŸèƒ½æ—¶å€™è®°å¾—ç”¨è¿™ä¸ªæ–¹æ¡ˆã€‚</p>
<ul>
<li>APPæ‰“å¼€äº†å´çœ‹ä¸åˆ°ç•Œé¢ï¼Œåªçœ‹åˆ°é¡µé¢å—–çš„ä¸€ä¸‹é£å‡ºäº†å±å¹•</li>
<li>å·¦ä¸Šè§’æœ‰æ—¶å€™ä¼šå‡ºç°ä¸€ä¸ªé»‘æ¡†æ¡†ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ•°å­—1</li>
<li>é¼ æ ‡æ”¾è‡³å±å¹•ä¸Šä¸‹å·¦å³ï¼Œæœ‰ä¸€ä¸ªè¾¹ä¼šè¿›å»</li>
<li>å³é”®çª—å£ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼<code>ç§»è‡³æ˜¾ç¤ºå™¨å³ä¾§</code>çš„æŒ‰é’®ï¼Œç‚¹äº†å°±çœ‹ä¸è§äº†</li>
<li><code>xrandr --listmonitors</code> æœ‰ä¸¤ä¸ª</li>
</ul>
<h3 id="åˆ‡æ¢Intelå’ŒNvidiaæ˜¾å¡"><a href="#åˆ‡æ¢Intelå’ŒNvidiaæ˜¾å¡" class="headerlink" title="åˆ‡æ¢Intelå’ŒNvidiaæ˜¾å¡"></a>åˆ‡æ¢Intelå’ŒNvidiaæ˜¾å¡</h3><p><strong>no zuo no die no life, å¬æˆ‘ä¸€å¥åŠåˆ«ç©è¿™ä¸ªã€‚ã€‚ã€‚</strong>ã€‚å¦‚æœGäº†å»çœ‹ä¸‹<a href="https://www.qingsword.com/qing/ubuntu-remove-nvidia.html" target="_blank" rel="noopener">è§£å†³Ubuntu18.04å®‰è£…Nvidiaé©±åŠ¨å¼€æœºå¡æ­»</a></p>
<p><a href="https://www.linuxbabe.com/desktop-linux/switch-intel-nvidia-graphics-card-ubuntu" target="_blank" rel="noopener">How To Switch Between Intel and Nvidia Graphics Card on Ubuntu</a>é‡åˆ°å¡åœ¨<code>Started bpfilter</code>ä¹‹åéœ€è¦ç¼–è¾‘/etc/gdm3/custom.confï¼Œå°†ä¸‹é¢è¿™ä¸€è¡Œæ”¾å¼€ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ï¼ƒWaylandEnable = FALSE</span><br></pre></td></tr></table></figure>

<h1 id="å†…ç½‘ç©¿é€"><a href="#å†…ç½‘ç©¿é€" class="headerlink" title="å†…ç½‘ç©¿é€"></a>å†…ç½‘ç©¿é€</h1><p>å°†<code>å†…ç½‘ç©¿é€</code>æ”¾åœ¨Googleé‡Œé¢æœç´¢ä¸€ä¸‹ä¼šæœ‰å¾ˆå¤šæ–¹æ¡ˆï¼Œæˆ‘çš„VPSè¢«é‚»å±…è¿ç´¯ä¹‹åå°±æ²¡æœ‰å†ä¹°ï¼Œæ‰€ä»¥æˆ‘æ²¡æœ‰åŸŸåã€å…¬ç½‘IPã€‚ã€‚ã€‚å…¶ä¸­æœç´¢ç»“æœçš„å¤§éƒ¨åˆ†éƒ½ä¸é€‚åˆæˆ‘ã€‚</p>
<p>å…¶ä¸­å¤§éƒ¨åˆ†æåˆ°ä¸€ä¸ª<code>DDNS</code>çš„æ¦‚å¿µï¼š<a href="https://zh.wikipedia.org/wiki/%E5%8B%95%E6%85%8BDNS" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘:åŠ¨æ€DNS</a></p>
<blockquote>
<p>åŠ¨æ€DNSï¼ˆè‹±è¯­ï¼šDynamic DNSï¼Œç®€ç§°DDNSï¼‰æ˜¯åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰ä¸­çš„ä¸€ç§è‡ªåŠ¨æ›´æ–°åç§°æœåŠ¡å™¨ï¼ˆName serverï¼‰å†…å®¹çš„æŠ€æœ¯ã€‚æ ¹æ®äº’è”ç½‘çš„åŸŸåè®¢ç«‹è§„åˆ™ï¼ŒåŸŸåå¿…é¡»è·Ÿä»å›ºå®šçš„IPåœ°å€ã€‚ä½†åŠ¨æ€DNSç³»ç»Ÿä¸ºåŠ¨æ€ç½‘åŸŸæä¾›ä¸€ä¸ªå›ºå®šçš„åç§°æœåŠ¡å™¨ï¼ˆName serverï¼‰ï¼Œé€è¿‡å³æ—¶æ›´æ–°ï¼Œä½¿å¤–ç•Œç”¨æˆ·èƒ½å¤Ÿè¿ä¸ŠåŠ¨æ€ç”¨æˆ·çš„ç½‘å€ã€‚</p>
</blockquote>
<p>äº†è§£ç©è¿™ä¸ªä¹‹åå°±å¯ä»¥æœç´¢å¹¶é€‰æ‹©DDMSæ–¹æ¡ˆäº†ã€‚</p>
<p>å†æ˜ç¡®ä¸€ä¸‹ç›®æ ‡ï¼šåœ¨å¤–ç½‘sshè¿›å†…ç½‘æˆ‘ä»¬åˆšå»ºå¥½çš„Ubuntuã€‚</p>
<h2 id="fatedier-frp"><a href="#fatedier-frp" class="headerlink" title="fatedier/frp"></a>fatedier/frp</h2><p>é¦–æ¨è¿™ç§æ–¹æ¡ˆï¼š<a href="https://github.com/fatedier/frp" target="_blank" rel="noopener">fatedier/frp</a>, æ–‡æ¡£æœ‰ä¸­æ–‡å¹¶ä¸”æ¯”è¾ƒè¯¦ç»†ã€‚</p>
<p>è¿˜æœ‰å°‘æ•°æ´¾çš„ä¸€ä¸ªæ–‡ç« ä¹Ÿä¸é”™ï¼š<a href="https://sspai.com/post/52523" target="_blank" rel="noopener">ä½¿ç”¨frpè¿›è¡Œå†…ç½‘ç©¿é€</a></p>
<h2 id="TPDDNS"><a href="#TPDDNS" class="headerlink" title="TPDDNS"></a>TPDDNS</h2><p>ä¸è¿‡æˆ‘å®¶é‡Œçš„è·¯ç”±æ˜¯<a href="https://www.tp-link.com.cn/" target="_blank" rel="noopener">TP-LINK</a>çš„ï¼ŒTP-LINKæ˜¯å¯ä»¥å‚è€ƒ<a href="https://service.tp-link.com.cn/detail_article_2978.html" target="_blank" rel="noopener">TPDDNSçš„ä½¿ç”¨æ–¹æ³•ä»‹ç»</a>å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ã€‚</p>
<p>ä¸è¿‡å‘æ¯”çš„äº‹æƒ…æ˜¯[TPDDNS]æ”¯æŒçš„ç¡¬ä»¶ç‰ˆæœ¬æ˜¯4.0ã€‚å‚è€ƒ<a href="https://service.tp-link.com.cn/detail_article_1420.html" target="_blank" rel="noopener">å¦‚ä½•æŸ¥çœ‹äº§å“å‹å·ä¸ç¡¬ä»¶ç‰ˆæœ¬ï¼Ÿ</a>ï¼Œä¹Ÿå°±æ˜¯å…¶<code>ver 4.0</code>ä¹‹ä¸Šæ˜¯å¯ä»¥çš„ã€‚</p>
<p>æœ€å¥½æ˜¯é—®ä¸€ä¸‹<code>TP-LINK åœ¨çº¿å®¢æœ</code>ï¼Œä¸€èˆ¬ æŸçŒ«ã€æŸç‹—ä¸Šé¢çš„å®¢æœæ˜¯ä¸æ‡‚è¿™ä¸ªçš„ã€‚</p>
<p>å¾ˆæ˜¾ç„¶æˆ‘å®¶é‡Œçš„è·¯ç”±æ˜¯V3.0 å•Šå“ˆå“ˆå“ˆ æ­¤æ–¹æ¡ˆæˆ‘è¿™é‡Œä¸é€‚ç”¨ã€‚ä¸è¿‡çœ‹ä¸Šé¢çš„æ•™ç¨‹å·²ç»å¾ˆè¯¦å°½äº†ï¼Œåº”è¯¥æ¯”è¾ƒå¥½æã€‚</p>
<h2 id="Sakura-Frp"><a href="#Sakura-Frp" class="headerlink" title="Sakura Frp"></a>Sakura Frp</h2><p>è¿™ä¸ªæ®<a href="https://www.natfrp.org/" target="_blank" rel="noopener">å®˜ç½‘</a>ä»‹ç»æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p>ç®€å•æ–¹ä¾¿<br>å®¢æˆ·ç«¯åŸºäº Fatedier Frp ä¿®æ”¹ï¼Œå…å»äº†é…ç½®æ–‡ä»¶ï¼Œæ”¹ä¸ºä»ç½‘ç»œè¯»å–é…ç½®ï¼Œæ‚¨åªéœ€è¦åœ¨ç½‘ç«™ä¸Šç®€å•æ“ä½œå³å¯æ·»åŠ æ˜ å°„ã€‚</p>
<p>å®Œå…¨å…è´¹<br>æ‚¨ä¸å¿…å†ä¸ºäº†å†…ç½‘ç©¿é€å¤šèŠ±ä¸€åˆ†é’±ï¼ŒSakura Frp æ˜¯æ°¸è¿œå…è´¹çš„ï¼Œæˆ‘ä»¬åªä¸ºäº†è®©æ›´å¤šäººèƒ½ä½“éªŒåˆ°å…è´¹ã€å¥½ç”¨çš„å†…ç½‘ç©¿é€ã€‚</p>
<p>è‡ªç”±ä½¿ç”¨<br>æˆ‘ä»¬éå¸¸æ¬¢è¿æ‚¨å°† Sakura Frp é›†æˆåˆ°è‡ªå·±çš„è½¯ä»¶ä¸­ï¼Œå¹¶ä¸”æˆ‘ä»¬æä¾›äº†å¤šç§ API æ¥å£ä»¥ä¾›ä½¿ç”¨ï¼Œå®Œå…¨æ²¡æœ‰ä½¿ç”¨é™åˆ¶ã€‚</p>
</blockquote>
<p>å¥½äº†ï¼Œé€‚åˆæˆ‘è¿™ç§ä¸æ„¿æ„èŠ±é’±çš„ç©·å±Œä¸ï¼Œæ¥<a href="https://openid.natfrp.org/?action=register&src=www.natfrp.com" target="_blank" rel="noopener">æ³¨å†Œ</a>å§ã€‚ã€‚</p>
<p>ç™»å½•è¿›å»æ‰å‘ç°ï¼Œå¥½å¤šæ–‡å­—ã€‚æ²¡æœ‰æ˜æ˜¾çš„æ–°æ‰‹æ•™ç¨‹ï¼Œå¯¹æˆ‘è¿™ç§ä¸æ˜¯å¾ˆæ‡‚<code>FRP</code>çš„äººæ¥è¯´ç®€ç›´ä¸€è„¸æ‡µé€¼ã€‚</p>
<h2 id="åˆ›å»ºæ˜ å°„"><a href="#åˆ›å»ºæ˜ å°„" class="headerlink" title="åˆ›å»ºæ˜ å°„"></a>åˆ›å»ºæ˜ å°„</h2><p><a href="https://www.natfrp.com/page/panel/" target="_blank" rel="noopener">æ˜ å°„åˆ—è¡¨</a>ä¸­çš„<code>ç¤ºä¾‹æ˜ å°„ - Linux SSH</code>æ­£åˆæˆ‘æ„ï¼Œç„¶ååªéœ€è¦å†ç‚¹ä¸€ä¸‹<code>éšæœºç«¯å£</code>å°±å¯ä»¥ä¸ç”¨è¾“å…¥ç›´æ¥ç‚¹æ·»åŠ äº†ã€‚</p>
<p><img src="/images/2019-07-09-13-43-31.png" alt="Linux SSH å¹¶éšæœºç«¯å£"></p>
<p><img src="/images/2019-07-09-13-44-25.png" alt="å·²æ·»åŠ çš„éš§é“åˆ—è¡¨"></p>
<p>è‡³æ­¤ç¬¬ä¸€ä¸ªæ˜ å°„å·²ç»åˆ›å»ºäº†ï¼Œç„¶åéœ€è¦å»Ubuntuä¸Šå¼€å¯ä»£ç†å§</p>
<h2 id="å¼€å¯ä»£ç†"><a href="#å¼€å¯ä»£ç†" class="headerlink" title="å¼€å¯ä»£ç†"></a>å¼€å¯ä»£ç†</h2><p>åœ¨<a href="https://www.natfrp.com/page/panel/" target="_blank" rel="noopener">å®¢æˆ·è½¯ä»¶</a>ä¸­æ‰¾åˆ°é€‚åˆè‡ªå·±çš„<code>Linux x64 (64ä½æ“ä½œç³»ç»Ÿ)</code>åŒ…å¹¶ä¸‹è½½è‡³Ubuntu:</p>
<p>æ­¤å¤„å°†åŒ…ä¸‹è½½è‡³<code>/opt/natfrp</code>(è¯¥è·¯å¾„å°†åœ¨åé¢çš„é…ç½®ä¸­ä½¿ç”¨)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /opt/natfrp &amp;&amp; <span class="built_in">cd</span> /opt/natfrp</span><br><span class="line">sudo wget https://cdn.tcotp.cn:4443/client/Sakura_frpc_linux_amd64.tar.gz</span><br><span class="line">sudo tar zxvf Sakura_frpc_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>

<p>è§£å‹å®Œæˆåï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶<code>Sakura_frpc_linux_amd64</code>(è¯¥æ–‡ä»¶åå°†åœ¨åé¢çš„é…ç½®ä¸­ä½¿ç”¨)</p>
<p>æ ¹æ®<a href="https://www.zerobbs.net/?s=viewpost&tid=5" target="_blank" rel="noopener">Linux å°† Sakura Frp è®¾ç½®ä¸ºæœåŠ¡ï¼Œå¼€æœºè‡ªåŠ¨å¯åŠ¨</a>çš„æ•™ç¨‹æ“ä½œå¦‚ä¸‹ï¼š</p>
<h3 id="åˆ›å»ºservice"><a href="#åˆ›å»ºservice" class="headerlink" title="åˆ›å»ºservice"></a>åˆ›å»ºservice</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vi /etc/systemd/system/sakurafrp.service</span><br></pre></td></tr></table></figure>

<h3 id="æ ¹æ®è‡ªå·±çš„é…ç½®å†™å…¥service"><a href="#æ ¹æ®è‡ªå·±çš„é…ç½®å†™å…¥service" class="headerlink" title="æ ¹æ®è‡ªå·±çš„é…ç½®å†™å…¥service"></a>æ ¹æ®è‡ªå·±çš„é…ç½®å†™å…¥service</h3><p><code>/opt/natfrp/</code>: Sakura_frpc_linux_amd64çš„å…¨è·¯å¾„<br><code>/opt/natfrp/Sakura_frpc_linux_amd64</code>: è§£å‹ä¹‹åçš„Sakura_frpc_linux_amd64å…¨è·¯å¾„<br><code>--sid=</code>: æœåŠ¡å™¨åˆ—è¡¨ä¸­å·¦ä¾§çš„æ•°å­—</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Sakura Frp Client</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">WorkingDirectory=/opt/natfrp/</span><br><span class="line">LimitNOFILE=4096</span><br><span class="line">PIDFile=/var/run/sakurafrp/client.pid</span><br><span class="line">ExecStart=/opt/natfrp/Sakura_frpc_linux_amd64 --su=ä½ çš„è´¦å· --sp=ä½ çš„å¯†ç  --sid=ä½ è¦é€‰æ‹©çš„æœåŠ¡å™¨çš„ID(å°±æ˜¯æœåŠ¡å™¨åˆ—è¡¨å·¦ä¾§çš„æ•°å­—)</span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitInterval=600</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>sidä¿¡æ¯[2019.7.9:14:10]:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">| ID	åç§°		çŠ¶æ€		ä»‹ç»</span><br><span class="line">|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">| 1	å®æ³¢ç”µä¿¡	âˆš åœ¨çº¿		é«˜é˜²çº¿è·¯ï¼Œé€‚åˆæ­ Minecraft æœåŠ¡å™¨ï¼Œä½¿ç”¨äººæ•°è¾ƒå¤š (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 2	å®æ³¢è”é€š	âˆš åœ¨çº¿		è”é€šçº¿è·¯ï¼Œé˜²å¾¡ 20Gï¼Œé€‚åˆéƒ¨åˆ†ç§»åŠ¨è”é€š&#x2F;ç”¨æˆ·ä½¿ç”¨ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 3	å¾å·ç”µä¿¡	âˆš åœ¨çº¿		å¾å·é«˜é˜²ç”µä¿¡ï¼Œé€‚åˆå¼€æœï¼Œæœˆæµé‡å›ºå®š 500Gï¼Œè¯·åˆç†ä½¿ç”¨ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 4	è´µå·ç”µä¿¡	Ã— ç¦»çº¿		è´µå·ç”µä¿¡èŠ‚ç‚¹ï¼Œæ— é˜²å¾¡ï¼Œé€‚åˆå°æµé‡ä¼ è¾“æœåŠ¡[è¶…æµé‡åœæœº] (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 6	ç½—é©¬å°¼äºš	Ã— ç¦»çº¿		ç½—é©¬å°¼äºšä¸é™å†…å®¹æ— è§† DMCA ç‰ˆæƒæœåŠ¡å™¨ï¼Œå…å¤‡æ¡ˆ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 7	æ—¥æœ¬åƒå…†	âˆš åœ¨çº¿		æ—¥æœ¬åƒå…†æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 8	å°æ¹¾ç™¾å…†	âˆš åœ¨çº¿		å°æ¹¾è°·æ­Œäº‘ 100M æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå»¶è¿Ÿè¾ƒä½ï¼Œå…å¤‡æ¡ˆ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 9	é¦™æ¸¯çº¿è·¯1 âˆš åœ¨çº¿		é¦™æ¸¯ StarryDNS 100M æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 10	æ±Ÿè‹é•‡æ±Ÿ	âˆš åœ¨çº¿		æ±Ÿè‹é•‡æ±Ÿ 100M æœåŠ¡å™¨ï¼ŒBGP å…¨å›½ä¼˜åŒ–çº¿è·¯ï¼Œé€‚åˆå¼€æœ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 12	æ²³å—ç”µä¿¡	âˆš åœ¨çº¿		æ²³å—ç”µä¿¡çº¿è·¯æœåŠ¡å™¨ï¼Œé€‚åˆå¼€æœä»¥åŠå°æµé‡æœåŠ¡ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 13	é¦™æ¸¯çº¿è·¯2 âˆš åœ¨çº¿		é¦™æ¸¯è°·æ­Œäº‘ 100M æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 30	æ´›æ‰çŸ¶01	âˆš åœ¨çº¿		ç¾å›½æ´›æ‰çŸ¶åƒå…†æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ çº¿è·¯ 1 (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 31	æ´›æ‰çŸ¶02	âˆš åœ¨çº¿		ç¾å›½æ´›æ‰çŸ¶åƒå…†æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ çº¿è·¯ 2 (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 32	æ´›æ‰çŸ¶03	âˆš åœ¨çº¿		ç¾å›½æ´›æ‰çŸ¶åƒå…†æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ çº¿è·¯ 3 (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 33	æ´›æ‰çŸ¶04	âˆš åœ¨çº¿		ç¾å›½æ´›æ‰çŸ¶åƒå…†æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ çº¿è·¯ 4 (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 34	æ´›æ‰çŸ¶05	âˆš åœ¨çº¿		ç¾å›½æ´›æ‰çŸ¶åƒå…†æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ çº¿è·¯ 5 (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 38	æ–°åŠ å¡01	Ã— ç¦»çº¿		æ–°åŠ å¡é˜¿é‡Œäº‘ 30M æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 39	è’™ç‰¹åˆ©å°”	âˆš åœ¨çº¿		åŠ æ‹¿å¤§è’™ç‰¹åˆ©å°”è°·æ­Œäº‘ 100M æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 43	é¦™æ¸¯ç§»åŠ¨	Ã— ç¦»çº¿		é¦™æ¸¯ UOvZ 100M ç§»åŠ¨æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ[æœºæˆ¿æ–­ç½‘ç»´æŠ¤ä¸­] (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 45	ç¾å›½çº½çº¦1 âˆš åœ¨çº¿		ç¾å›½çº½çº¦ç™¾å…†æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ çº¿è·¯1 (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 46	ç¾å›½çº½çº¦2 âˆš åœ¨çº¿		ç¾å›½çº½çº¦ç™¾å…†æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ çº¿è·¯2 (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">| 47	æ—¥æœ¬é•¿é‡	Ã— ç¦»çº¿		æ—¥æœ¬é•¿é‡ç™¾å…†æœåŠ¡å™¨ï¼Œé€‚åˆå»ºç«™ï¼Œå…å¤‡æ¡ˆ (å®˜æ–¹æœåŠ¡å™¨)</span><br><span class="line">|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<h3 id="å¯åŠ¨service"><a href="#å¯åŠ¨service" class="headerlink" title="å¯åŠ¨service"></a>å¯åŠ¨service</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å°±åˆ›å»ºæˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥å¯åŠ¨æœåŠ¡ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl start sakurafrp</span><br></pre></td></tr></table></figure>

<p>å°†æœåŠ¡è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> sakurafrp</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦åœæ­¢è¿è¡Œå®¢æˆ·ç«¯ï¼Œåªéœ€è¦è¾“å…¥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl stop sakurafrp</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦ç¦æ­¢å¼€æœºå¯åŠ¨ï¼Œè¾“å…¥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> sakurafrp</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œæ¥è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å½“å‰çš„çŠ¶æ€ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">â•°â”€&gt;$ sudo systemctl status sakurafrp</span><br><span class="line">â— sakurafrp.service - Sakura Frp Client</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/sakurafrp.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Tue 2019-07-09 11:07:19 CST; 3h 13min ago</span><br><span class="line"> Main PID: 3301 (Sakura_frpc_lin)</span><br><span class="line">    Tasks: 10 (<span class="built_in">limit</span>: 4915)</span><br><span class="line">   Memory: 5.9M</span><br><span class="line">   CGroup: /system.slice/sakurafrp.service</span><br><span class="line">           â””â”€3301 /opt/natfrp/Sakura_frpc_linux_amd64 --su=xxxxxxxx --sp=xxxxxxxx --sid=xxx</span><br><span class="line"></span><br><span class="line">7æœˆ 09 11:07:20 madordie-NV47H Sakura_frpc_linux_amd64[3301]: &gt;é…ç½®æ–‡ä»¶è½½å…¥æˆåŠŸ</span><br><span class="line">7æœˆ 09 11:07:20 madordie-NV47H Sakura_frpc_linux_amd64[3301]: 2019/07/09 11:07:20 [I] [proxy_manager.go:322] å¢åŠ ä»£ç†: [xxx.natfrp.org:22941        29795-87248]</span><br><span class="line">7æœˆ 09 11:07:20 madordie-NV47H Sakura_frpc_linux_amd64[3301]: 2019/07/09 11:07:20 [I] [control.go:242] [d54792913cdac17d] ç™»å½•æˆåŠŸ, è·å–åˆ°è¿è¡ŒID [d54792913cdac17d], server udp port [7001]</span><br><span class="line">7æœˆ 09 11:07:20 madordie-NV47H Sakura_frpc_linux_amd64[3301]: 2019/07/09 11:07:20 [I] [control.go:167] [d54792913cdac17d] [xxx.natfrp.org:22941        29795-87248] å¯åŠ¨ä»£ç†æˆåŠŸ</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>[xxx.natfrp.org:22941        29795-87248] å¯åŠ¨ä»£ç†æˆåŠŸ</code></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯é€‰ç”¨çš„sidä¸ä¸€æ ·å…¶ä»£ç†çš„åŸŸåä¹Ÿä¸ä¸€æ ·ã€‚è¿™ä¸ªæ˜¯å¾ˆæ˜¾ç„¶çš„ï¼Œä½†æ˜¯æ˜¯å®¹æ˜“å¿½ç•¥çš„ã€‚</p>
<h1 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h1><p>åœ¨MBPä¸ŠéªŒè¯ä¸€ä¸‹<code>xxx.natfrp.org:22941</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">â•°â”€&gt;$ ssh -p 22941 madordie@xxx.natfrp.org</span><br><span class="line">Welcome to Ubuntu 19.04 (GNU/Linux 4.18.0-15-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">12 updates can be installed immediately.</span><br><span class="line">6 of these updates are security updates.</span><br><span class="line"></span><br><span class="line">Last login: Tue Jul  9 14:19:33 2019 from 127.0.0.1</span><br></pre></td></tr></table></figure>

<p><code>Sakura Frp</code>å·²é€šï¼Œæ„‰å¿«çš„ç©è€å§ï¼</p>
<p>æ‹¬å¼§ï¼šä¸€æ—¦å…¶æš´éœ²å‡ºå»åˆ«å¿˜äº†è€ƒè™‘å®‰å…¨ï¼Œæ¯”å¦‚ä½ çš„è¿™ä¸ªSSHè´¦å·ã€å¯†ç æ˜¯å¦è¶³å¤Ÿå¤æ‚ï¼Œæˆ–è€…æ˜¯å¦å…³é—­äº†è´¦å·å¯†ç ç™»é™†ã€‚</p>
<h1 id="å…¶ä»–æ–¹æ¡ˆ"><a href="#å…¶ä»–æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–æ–¹æ¡ˆ"></a>å…¶ä»–æ–¹æ¡ˆ</h1><p>è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ–¹æ¡ˆå¯ä»¥é€‰æ‹©ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><a href="https://hsk.oray.com/" target="_blank" rel="noopener">èŠ±ç”Ÿå£³</a></li>
<li><a href="https://www.noip.com/" target="_blank" rel="noopener">no-ip</a></li>
<li><a href="https://github.com/fatedier/frp" target="_blank" rel="noopener">å¼€æºçš„frp</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>å†…ç½‘ç©¿é€</tag>
      </tags>
  </entry>
  <entry>
    <title>mac10.13 pods å‘½ä»¤é”™è¯¯</title>
    <url>/post/macos-high-sierra-cocoapods/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>æ¯é€¢å‡çº§å¤§ç‰ˆæœ¬æ€»è¦è¿‡æç‚¹äº‹æƒ…ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ pod env</span><br><span class="line">-bash: /usr/<span class="built_in">local</span>/bin/pod: /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/bin/ruby: bad interpreter: No such file or directory</span><br></pre></td></tr></table></figure>

<p>ä¸è®ºæ˜¯<code>pod env</code>ã€<code>pod update</code> ç­‰ç­‰å‡æŠ¥ä¸Šé¢çš„é”™è¯¯ã€‚</p>
<p>å¦‚æœGoogleå‘ç°ï¼š</p>
<ul>
<li><a href="https://stackoverflow.com/questions/44396215/cocoapods-not-working-in-macos-high-sierra" target="_blank" rel="noopener">ruby - CocoaPods not working in macOS High Sierra - Stack Overflow</a></li>
<li><a href="https://github.com/CocoaPods/CocoaPods/issues/6778" target="_blank" rel="noopener">CocoaPods CLI fails in High Sierra due to change of Ruby version #6778</a></li>
<li><a href="https://github.com/CocoaPods/CocoaPods/issues/6898#issuecomment-332060096" target="_blank" rel="noopener">High Sierra: bad interpreter #6898</a></li>
</ul>
<p>äº‹æƒ…çš„ç¼˜ç”±å°±æ˜¯è¿™æ ·ã€‚</p>
<p><a href="https://github.com/CocoaPods/CocoaPods/issues/6898#issuecomment-332060096" target="_blank" rel="noopener">#6898</a>ä¸­é“å‡ºäº†ç®€å•ç›´æ¥çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<blockquote>
<p>for all others:</p>
</blockquote>
<blockquote>
<p><code>gem install -n /usr/local/bin cocoapods</code></p>
</blockquote>
<blockquote>
<p>fixes it</p>
</blockquote>
<p><strong>ç»¼åˆèµ·æ¥</strong>è§£å†³è¿™ä¸ªé—®é¢˜æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ gem update --system</span><br><span class="line">$ gem uninstall cocoapods</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'gem: --bindir /usr/local/bin'</span> &gt;&gt; ~/.gemrc</span><br><span class="line">$ sudo gem install cocoapods</span><br></pre></td></tr></table></figure>

<p>æ„‰å¿«çš„ä½¿ç”¨cocoapodså§ï½</p>
]]></content>
      <categories>
        <category>macOS</category>
      </categories>
      <tags>
        <tag>cocoapods</tag>
      </tags>
  </entry>
  <entry>
    <title>mac10.13ä¾æ—§è®©Xcodeæ”¯æŒæ‰“å¼€ç»ˆç«¯</title>
    <url>/post/mac-high-sierra-open-with-external/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>åœ¨macOS10.13ä»¥å‰æ˜¯æ”¯æŒXcodeä¸­ç›´æ¥æ‰“å¼€ç»ˆç«¯çš„ï¼Œæ­¥éª¤å‘¢å°±æ˜¯ä¸‹é¢è¿™æ ·å­ï¼š</p>
<p><img src="/images/mac-high-sierra-open-with-external-1.gif" alt="æ•ˆæœå›¾"></p>
<ol>
<li>å³å‡»å·¥ç¨‹</li>
<li>Open With External Editor</li>
<li>ç»ˆç«¯å¼¹å‡ºæ¥äº†ã€‚ã€‚</li>
</ol>
<p>å¦‚æœæ²¡æœ‰ç”Ÿæ•ˆï¼Œå°±æ˜¯ä½ çš„ç”µè„‘ä¸Šè£…äº†ä»€ä¹ˆå¯ä»¥æ‰“å¼€<code>xx.xcodeproj</code>çš„åº”ç”¨ç¨‹åºï¼Œä¹Ÿå°±æ˜¯åœ¨<code>Finder</code>ä¸‹å³å‡»å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ ·å¼ï¼š</p>
<p><img src="/images/mac-high-sierra-open-with-external-2.jpg" alt="æ•ˆæœå›¾"></p>
<p>å‘ï½ Xcodeä¸ºé»˜è®¤ï¼Œå¤‡å¿˜å½•ä¸ºé»˜è®¤ä¸‹é¢çš„ç¬¬ä¸€ä¸ªï½ï½</p>
<p>å¯¹ï¼Œå¦‚æœè¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šé¢3æ­¥ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼šè¿™ä¸ªæ–‡ä»¶è¢«è«åå…¶å¦™çš„ä¿å­˜åœ¨äº†å¤‡å¿˜å½•ï½ï½  </p>
<p>è¿™ä¸æ˜¯æˆ‘ä»¬è¦çš„ğŸ¤·â€â™‚ï¸ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¿®æ”¹<code>å¤‡å¿˜å½•.app</code>çš„é…ç½®æ–‡ä»¶æ¥è¾¾åˆ°æˆ‘ä»¬çš„æ•ˆæœã€‚</p>
<a id="more"></a>

<h3 id="æˆå› "><a href="#æˆå› " class="headerlink" title="æˆå› "></a>æˆå› </h3><p>macSO10.13åŠ å¼ºäº†å¤‡å¿˜å½•ï¼Œå—¯çš„ç¡®å˜å¼ºäº†ï¼Œå¯æ˜¯å¹¶æ²¡æœ‰Xcodeå’Œç»ˆç«¯å¸¸ç”¨ã€‚</p>
<p>å¤‡å¿˜å½•å¢åŠ äº†å¯¼å…¥çš„åŠŸèƒ½ï¼Œæ”¯æŒäº†ä¸€äº›æ–‡ä»¶çš„æ‰“å¼€(åªæ˜¯å¯¼å…¥è€Œå·²ã€‚ã€‚)ï¼Œä½†æ˜¯å¹¶ä¸é€‚åˆæˆ‘ã€‚äºæ˜¯æ”¹ä¸€ä¸‹å§ï½ï½</p>
<h3 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h3><ol>
<li>åœ¨<code>åº”ç”¨ç¨‹åº</code>ä¸­æ‰¾åˆ°<code>å¤‡å¿˜å½•</code></li>
<li>æ˜¾ç¤ºåŒ…å†…å®¹</li>
<li>æ‰¾åˆ° æˆ‘ä»¬è¦ä¿®æ”¹çš„plistæ–‡ä»¶ï¼š <code>Contents/Info.plist</code></li>
<li>åšä¸€ä¸‹å¤‡ä»½ï¼šå¤åˆ¶ä¸€ä¸‹ã€‚ã€‚</li>
<li>ç¡®ä¿ &lt;4&gt; å·²å®Œæˆ</li>
<li>ç›´æ¥ä¿®æ”¹<code>Info.plist</code>ä¼šæç¤ºæ²¡æœ‰æƒé™ï¼Œä½¿ç”¨<code>sudo vim Info.plist</code>ä¿®æ”¹</li>
<li>ä¸ç®¡ä½ ç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œåˆ é™¤ä¸‹é¢çš„è¿™äº›ä»£ç <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleTypeName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>General files and folders<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleTypeRole<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>Viewer<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>LSItemContentTypes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>public.data<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>public.directory<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><code>:wq</code></li>
<li>é‡å¯ä¸€ä¸‹ ï¼ˆç›®çš„ï¼šé‡å»ºç´¢å¼•ï¼‰</li>
</ol>
<h3 id="è‡³äºæˆ‘åšäº†ä»€ä¹ˆ"><a href="#è‡³äºæˆ‘åšäº†ä»€ä¹ˆ" class="headerlink" title="è‡³äºæˆ‘åšäº†ä»€ä¹ˆ"></a>è‡³äºæˆ‘åšäº†ä»€ä¹ˆ</h3><p>è®²é“ç†ï¼Œç”¨Xcodeçš„éƒ½çŸ¥é“å§ï¼Ÿè¿™ä¸ªæ˜¯æ³¨å†Œçš„appæ”¯æŒçš„æ–‡ä»¶ç±»å‹ã€‚ åˆ é™¤ä¹‹åå°±å¯ä»¥äº†ï¼Œå°±è¿™ä¹ˆå¤šğŸ˜‚</p>
<h3 id="æ³¨æ„ä¸€ä¸‹"><a href="#æ³¨æ„ä¸€ä¸‹" class="headerlink" title="æ³¨æ„ä¸€ä¸‹"></a>æ³¨æ„ä¸€ä¸‹</h3><p><code>æ“ä½œ</code>ä¸­çš„<code>æ­¥éª¤9</code>å¯ä»¥æœ‰è„šæœ¬ï¼Œä½†æ˜¯è¿˜æ˜¯è€å®é‡å¯ä¸€ä¸‹å§ï¼Œæœ‰çš„è„šæœ¬ä¼šä½¿éƒ¨åˆ†å›¾æ ‡å¤±æ•ˆï¼Œå·¨çƒ¦ã€‚ã€‚è¿˜æ˜¯é‡å¯ä¸€ä¸‹æ¯”è¾ƒé è°±ã€‚æ¯•ç«Ÿä¸ç€æ€¥</p>
]]></content>
      <categories>
        <category>macOS</category>
      </categories>
      <tags>
        <tag>Xcode</tag>
      </tags>
  </entry>
  <entry>
    <title>sketechæ¨¡å—åŒæ­¥æ’ä»¶</title>
    <url>/post/sync-sketchplugin/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="Sketch-æ¨¡å—åŒæ­¥æ’ä»¶"><a href="#Sketch-æ¨¡å—åŒæ­¥æ’ä»¶" class="headerlink" title="Sketch æ¨¡å—åŒæ­¥æ’ä»¶"></a>Sketch æ¨¡å—åŒæ­¥æ’ä»¶</h2><p>é€šè¿‡è¯¥æ’ä»¶å¯ä»¥å°†sketchä¸­çš„ç”»æ¿è½¬æ¢ä¸ºdataç„¶åä¸Šä¼ è‡³æœåŠ¡å™¨ï¼Œå¹¶èƒ½é€šè¿‡æ’ä»¶å°†æœåŠ¡å™¨çš„dataä¸‹è½½è‡³æœ¬åœ°è¿˜åŸä¸ºä¹‹å‰çš„ç”»æ¿ã€‚</p>
<p><img src="https://github.com/madordie/sync-sketch-plugin/blob/master/Untitled.gif?raw=true" alt="é¢„è§ˆ"></p>
<a id="more"></a>

<h2 id="æ ¸å¿ƒåŠŸèƒ½"><a href="#æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½"></a>æ ¸å¿ƒåŠŸèƒ½</h2><p>åŠŸèƒ½çš„å®ç°éƒ½æ˜¯é€šè¿‡<a href="https://www.sketchapp.com/" target="_blank" rel="noopener">Sketch.app</a>çš„APIå®ç°</p>
<p>å…¶æ ¸å¿ƒåŠŸèƒ½å°±ä¿©ï¼š</p>
<ul>
<li>å°†ç”»æ¿ç¼–ç </li>
<li>è§£ç ä¸ºç”»æ¿</li>
</ul>
<h2 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h2><p>ç”±äºåŠŸèƒ½å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯sketchå¹¶æ²¡æœ‰å®Œæ•´çš„APIæ–‡æ¡£ï¼Œæ‰€ä»¥åªèƒ½æ‘¸ç´¢ç€æ¥ï¼Œæœ€åæ€»ç»“ä¸€ä¸‹ç”¨åˆ°çš„APIï¼Œåªæœ‰ä¸‹é¢çš„å‡ ä¸ªé‡è¦å‡½æ•°ã€‚</p>
<p>ä½†æ˜¯è¦æ‰¾åˆ°è¿™äº›APIå¹¶ä¸æ˜¯éšæ‰‹ä¸€ä¸ªGoogleå¯ä»¥å¾—åˆ°ï¼Œç°å°†å…¶åˆ—å‡ºï¼Œæ–¹ä¾¿ä½ èƒ½éšæ‰‹Googleä¸€ä¸‹å°±å¾—åˆ°ï¼šï¼‰</p>
<p>å¦å¤–ï¼Œä¸‹é¢å‡ éƒ¨åˆ†çš„ä»£ç éƒ½é€šè¿‡<a href="https://github.com/ccgus/CocoaScript" target="_blank" rel="noopener">CocoaScript</a>çš„è¯­æ³•ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åº”ç”¨åˆ°æ’ä»¶ä¸­ã€‚</p>
<p>ä¸ºäº†èƒ½æ›´å¥½çš„ç†è§£å’Œä½¿ç”¨ç›¸å…³APIï¼Œæˆ‘å°½é‡è¯¦ç»†ã€‚</p>
<h3 id="å°†ç”»æ¿ç¼–ç "><a href="#å°†ç”»æ¿ç¼–ç " class="headerlink" title="å°†ç”»æ¿ç¼–ç "></a>å°†ç”»æ¿ç¼–ç </h3><p>æœ¬èŠ‚ä¼šå°†æ‰€æœ‰å·²ç»é€‰ä¸­çš„å±‚æ‰€å¯¹åº”çš„ç”»æ¿è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸²ã€‚</p>
<p>ps.</p>
<ul>
<li><code>å±‚</code>åŒ…å«sketchèƒ½å¤Ÿå‘ˆç°çš„æ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šæ–‡æœ¬ã€çŸ©å½¢ã€å›¾ç‰‡ã€ç”»æ¿ã€‚</li>
<li>å¦‚æœé€‰ä¸­çš„å±‚æ²¡æœ‰ç”»æ¿ï¼Œå°†ä¼šè¢«å¿½ç•¥ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> selection = context.selection,</span><br><span class="line">    artboards = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; selection.count(); i++) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å–å‡ºé€‰ä¸­çš„æ‰€æœ‰ç”»æ¿</span></span><br><span class="line">        <span class="keyword">var</span> artboard = selection[i].parentArtboard();</span><br><span class="line">        <span class="keyword">if</span> (artboards.indexOf(artboard) == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="comment">// è¿‡æ»¤é‡å¤çš„ç”»æ¿</span></span><br><span class="line">            artboards.push(artboard);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (artboards.length == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// å¹¶æ— é€‰ä¸­çš„ä»»ä½•ç”»æ¿</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶ artboards æ•°ç»„ï¼Œ å³ä¸ºå½“å‰é€‰ä¸­çš„æ‰€æœ‰ç”»æ¿</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> selectionStrings = [];</span><br><span class="line">artboards.forEach(<span class="function"><span class="params">artboard</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å°†ç”»æ¿è½¬ä¸ºJSONå­—ç¬¦ä¸²ï¼Œå¹¶ä¿å­˜åœ¨ selectionStrings æ•°ç»„ä¸­</span></span><br><span class="line">        selectionStrings.push(MSJSONDataArchiver.archiveStringWithRootObject_error_(artboard.immutableModelObject(), nil));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†selectionStringsæ•°ç»„è½¬ä¸ºæ•°ç»„JSONå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">var</span> selectionsString = <span class="string">'['</span> + selectionStrings.join(<span class="string">','</span>) + <span class="string">']'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶selectionsStringå­—ç¬¦ä¸²å³ä¸ºå½“å‰é€‰ä¸­çš„æ‰€æœ‰ç”»æ¿çš„jsonæ•°ç»„å­—ç¬¦ä¸²å½¢å¼ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="è§£ç ä¸ºç”»æ¿"><a href="#è§£ç ä¸ºç”»æ¿" class="headerlink" title="è§£ç ä¸ºç”»æ¿"></a>è§£ç ä¸ºç”»æ¿</h3><p>æ¥ä¸Šä¸€èŠ‚çš„<code>selectionsString</code>ã€‚</p>
<p>å…ˆå°†<code>selectionsString</code>è½¬ä¸º<code>page</code>çš„jsonæ•°æ®ï¼Œç„¶åè§£æä¸ºä¸€ä¸ªæ–°çš„<code>page</code>ï¼Œå¹¶å±…ä¸­å±•ç¤ºã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> selectionsString = res.layers,</span><br><span class="line">    pageUUID = NSUUID.UUID().UUIDString(),</span><br><span class="line">    <span class="comment">// ç”¨pageçš„JSONåŒ…è£¹selectionsStringï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„UUID</span></span><br><span class="line">    pageString = <span class="string">'&#123;"_class":"page","do_objectID":"'</span> + pageUUID + <span class="string">'","layers":'</span> + selectionsString + <span class="string">'&#125;'</span>,</span><br><span class="line">    data = NSString.alloc().initWithString(pageString).dataUsingEncoding_(<span class="number">4</span>),</span><br><span class="line">    <span class="comment">// å°†JSONè§£ç </span></span><br><span class="line">    unarchive = MSJSONDataUnarchiver.unarchiveObjectWithData(data),</span><br><span class="line">    <span class="comment">// ç”Ÿæˆæ–°çš„page</span></span><br><span class="line">    newPage = MSPage.alloc().initWithImmutableModelObject(unarchive),</span><br><span class="line">    <span class="comment">// æ’å…¥ä¸€ä¸ªæ–°çš„page</span></span><br><span class="line">    page = MSDocument.currentDocument().addBlankPage();</span><br><span class="line"><span class="comment">// å°†ç”Ÿæˆçš„pageæ‰€æœ‰çš„layersè½¬ç§»åˆ°æ–°çš„pageé‡Œé¢</span></span><br><span class="line">page.addLayers(newPage.layers());</span><br><span class="line"><span class="comment">// ä¸ºpageè®¾ç½®å“¥åå­—</span></span><br><span class="line">page.setName(res.project);</span><br><span class="line"><span class="comment">// pageå‰§ä¸­</span></span><br><span class="line">MSDocument.currentDocument().contentDrawView().centerLayersInCanvas();</span><br><span class="line">MSDocument.currentDocument().pageTreeLayoutDidChange();</span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–ä»£ç "><a href="#å…¶ä»–ä»£ç " class="headerlink" title="å…¶ä»–ä»£ç "></a>å…¶ä»–ä»£ç </h3><p>å…³äºåˆ«çš„åç«¯æ“ä½œå•Š ä»€ä¹ˆçš„æˆ‘è®¤ä¸ºå¹¶ä¸æ˜¯æ ¸å¿ƒä»£ç ã€‚é‚£ä»£ç è°éƒ½ä¼šå†™ã€‚ã€‚æ¯•ç«Ÿæˆ‘å†™è¿™ä¸ªçš„æ—¶å€™åªæœ‰2å‘¨çš„æ‘¸ç´¢ç»éªŒğŸ˜‚ï¼Œè¿˜æ˜¯ä¸èŠè¿™ä¸ªäº†ã€‚</p>
<ul>
<li><code>sync-npm</code> æ’ä»¶ç›¸å…³çš„ç›®å½•ï¼Œé‡‡ç”¨<a href="https://github.com/skpm/skpm" target="_blank" rel="noopener">skpm</a>æ„å»º</li>
<li><code>sync-server</code> æ’ä»¶å¯¹åº”çš„æœåŠ¡ç«¯ä»£ç ï¼Œé‡‡ç”¨<a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node-js</a>æ„å»º</li>
</ul>
<h2 id="ç›®å‰è¿˜å­˜åœ¨çš„é—®é¢˜"><a href="#ç›®å‰è¿˜å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="ç›®å‰è¿˜å­˜åœ¨çš„é—®é¢˜"></a>ç›®å‰è¿˜å­˜åœ¨çš„é—®é¢˜</h2><ul>
<li>å¦‚æœæ˜¯å¸¦å›¾ç‰‡çš„ç”»æ¿ï¼Œå¹¶ä¸”è¾ƒå¤šçš„æ—¶å€™ï¼Œ<code>selectionsString</code>ä¼šå¾ˆå¤§ï¼Œä¼ è¾“é€Ÿåº¦æœ‰ç‚¹æ…¢ã€‚ã€‚</li>
<li>UIäº¤äº’æœ‰ç‚¹åƒè—•ã€‚ã€‚æœ€å¥½å¼€å‘ä¸€å¥—macOSçš„UIï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯åªèœé¸¡ã€‚ã€‚</li>
<li>é¡¹ç›®çš„ä»£ç æˆ‘åªæ˜¯ç®€ç®€å•å•çš„è¿å­¦å¸¦å†™2å‘¨åšå‡ºæ¥çš„ã€‚ã€‚å†™çš„ä¸æ˜¯ä¸€èˆ¬çš„æ¸£ï¼Œè§è°…ã€‚ã€‚</li>
</ul>
<h2 id="ä½ å¯èƒ½éœ€è¦çš„å‚è€ƒèµ„æ–™"><a href="#ä½ å¯èƒ½éœ€è¦çš„å‚è€ƒèµ„æ–™" class="headerlink" title="ä½ å¯èƒ½éœ€è¦çš„å‚è€ƒèµ„æ–™"></a>ä½ å¯èƒ½éœ€è¦çš„å‚è€ƒèµ„æ–™</h2><ul>
<li>Sketchçš„å¤´æ–‡ä»¶ï¼š<a href="https://github.com/abynim/Sketch-Headers" target="_blank" rel="noopener">Sketch-Headers</a>ï¼Œå¯ä»¥çœå»è‡ªå·±<a href="http://stevenygard.com/projects/class-dump/" target="_blank" rel="noopener">class-dump</a>çš„éº»çƒ¦.</li>
<li>æ’ä»¶å¼€å‘ç¥å™¨ï¼š<a href="https://github.com/skpm/skpm" target="_blank" rel="noopener">skpm</a></li>
<li>ç”¨æ¥è°ƒè¯•å¾ˆä¸é”™ï¼š<a href="https://github.com/skpm/sketch-dev-tools" target="_blank" rel="noopener">Sketch DevTools</a></li>
<li>å®˜æ–¹å¼€å‘æ–‡æ¡£ï¼š<a href="https://developer.sketchapp.com/" target="_blank" rel="noopener">Sketch Developer</a></li>
<li>æ’ä»¶å¼€å‘ç¤¾åŒºï¼š<a href="https://sketchplugins.com/" target="_blank" rel="noopener">Sketch Developers</a></li>
<li>æ’ä»¶ä½¿ç”¨çš„è¯­è¨€ï¼š<a href="https://github.com/ccgus/CocoaScript" target="_blank" rel="noopener">CocoaScript</a>ï¼Œä½†æ˜¯å¹¶ä¸ä»…é™è¿™ä¸€ç§å“Ÿ</li>
<li>æ¨èæœç´¢å¼•æ“: <a href="https://www.google.com/" target="_blank" rel="noopener">Google</a>ï¼Œåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆç”¨Googleä¸ç”¨ç™¾åº¦ï¼Œæˆ‘æ˜¯ä¸ä¼šå‘Šè¯‰ä½ sketchæ’ä»¶å¼€å‘æœ¬æ¥èµ„æ–™å°±å°‘ï¼Œå›½å†…æ›´å°‘çš„ã€‚ã€‚</li>
</ul>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>è€è§„çŸ©ï¼š<a href="https://github.com/madordie/sync-sketch-plugin" target="_blank" rel="noopener">madordie/sync-sketch-plugin</a></p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Sketchplugin</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitment/Gitalkè‡ªåŠ¨åˆå§‹åŒ–</title>
    <url>/post/blog-gitment-auto-setup/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>ä¸€ä¸ªrubyè„šæœ¬è§£æ”¾ä½ åŒæ‰‹å•ªå•ªå•ªçš„æ•²é”®ç›˜ä¸‰åˆ†é’Ÿï½</p>
<p>PS.</p>
<ul>
<li>rubyæ–°æ‰‹ï¼Œè½»æ‹ã€‚ã€‚</li>
<li>ä¸‰æ˜¯è™šæŒ‡ã€‚ã€‚</li>
</ul>
<a id="more"></a>

<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>ä¹‹å‰çœ‹åˆ°äººå®¶çš„ç§ç«™éƒ½æ˜¯ç”¨çš„<a href="https://github.com/" target="_blank" rel="noopener">GitHub</a>åšçš„è¯„è®ºç³»ç»Ÿã€‚ã€‚å¾ˆæƒ³è¦ï¼Œä½†æ˜¯äººå®¶æ²¡æœ‰ç”¨<a href="https://pages.github.com/" target="_blank" rel="noopener">pages</a>è¿™æ ·çš„ç©æ„ã€‚ã€‚</p>
<p>ä»Šå¤©çœ‹åˆ°<a href="http://awhisper.github.io/" target="_blank" rel="noopener">å‘³ç²¾</a>å¤§ä½¬çš„RSSè·ªäº†ï¼Œç„¶åçœ‹åˆ°äººå®¶ç”¨çš„æ˜¯GitHubçš„è¯„è®ºã€‚ã€‚é¡¿æ—¶è§‰å¾—æƒ³è¦ï¼Œ23333</p>
<p>ç„¶åçœ‹äº†ä¸€å“ˆ æ˜¯è¿™ä¸ªï¼š<a href="https://github.com/imsun/gitment" target="_blank" rel="noopener">gitment</a></p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>è¿™ä¸ªæˆ‘å°±ä¸è¯´äº†ï¼Œä½œè€…æœ‰å†™ä¸­æ–‡æ–‡æ¡£ï¼Œçœ‹ä¸€çœ¼å°±æ˜ç™½äº†ã€‚</p>
<p>åˆ—ä¸€ä¸‹æˆ‘çš„ä½¿ç”¨<a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">NexTä¸»é¢˜</a>çš„é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Gitment</span></span><br><span class="line"><span class="comment"># Introduction: https://imsun.net/posts/gitment-introduction/</span></span><br><span class="line"><span class="attr">gitment:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mint:</span> <span class="literal">true</span> <span class="comment"># RECOMMEND, A mint on Gitment, to support count, language and proxy_gateway</span></span><br><span class="line">  <span class="attr">count:</span> <span class="literal">true</span> <span class="comment"># Show comments count in post meta area</span></span><br><span class="line">  <span class="attr">lazy:</span> <span class="literal">false</span> <span class="comment"># Comments lazy loading with a button</span></span><br><span class="line">  <span class="attr">cleanly:</span> <span class="literal">false</span> <span class="comment"># Hide 'Powered by ...' on footer, and more</span></span><br><span class="line">  <span class="attr">language:</span> <span class="comment"># Force language, or auto switch by theme</span></span><br><span class="line">  <span class="attr">github_user:</span> <span class="string">xxxxxx</span> <span class="comment"># MUST HAVE, Your Github ID</span></span><br><span class="line">  <span class="attr">github_repo:</span> <span class="string">xxxxxx</span> <span class="comment"># MUST HAVE, The repo you use to store Gitment comments</span></span><br><span class="line">  <span class="attr">client_id:</span> <span class="string">xxxxxx</span> <span class="comment"># MUST HAVE, Github client id for the Gitment</span></span><br><span class="line">  <span class="attr">client_secret:</span> <span class="string">xxxxxx</span> <span class="comment"># EITHER this or proxy_gateway, Github access secret token for the Gitment</span></span><br><span class="line">  <span class="attr">proxy_gateway:</span> <span class="comment"># Address of api proxy, See: https://github.com/aimingoo/intersect</span></span><br><span class="line">  <span class="attr">redirect_protocol:</span> <span class="comment"># Protocol of redirect_uri with force_redirect_protocol when mint enabled</span></span><br></pre></td></tr></table></figure>

<h2 id="Gitment"><a href="#Gitment" class="headerlink" title="Gitment"></a>Gitment</h2><p>å…³äºä½œè€…çš„<a href="https://github.com/imsun/gitment/issues/8" target="_blank" rel="noopener">åˆå§‹åŒ–è¯„è®ºæ¡†æ–¹æ¡ˆè®¨è®º</a>è¿˜åœ¨è®¨è®ºä¸­ã€‚ã€‚ã€‚</p>
<p>ä½†æ˜¯æˆ‘è¦ç”¨ã€‚ã€‚ç­‰æ˜¯ä¸å¯èƒ½ç­‰çš„äº†ã€‚</p>
<p>çœ‹åˆ°<a href="https://draveness.me/git-comments-initialize" target="_blank" rel="noopener">è‡ªåŠ¨åˆå§‹åŒ– Gitalk å’Œ Gitment è¯„è®º</a>çš„è„šæœ¬æƒ³ç€åˆšå¥½æˆ‘çš„ä¹Ÿæ˜¯è‡ªåŠ¨å‘å¸ƒã€å¤‡ä»½ï¼Œè¿™ä¸æ˜¯åˆšå¥½å˜›ã€‚ã€‚</p>
<p>ä½†æ˜¯å­˜åœ¨å¤šæ¬¡æ‰§è¡Œå°±ä¼šå¤šæ¬¡åˆ›å»ºçš„é—®é¢˜ã€‚è¿™ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚</p>
<h3 id="ç¬¬ä¸€ç‰ˆï¼šæ”¯æŒå¤šæ¬¡æ‰§è¡Œ"><a href="#ç¬¬ä¸€ç‰ˆï¼šæ”¯æŒå¤šæ¬¡æ‰§è¡Œ" class="headerlink" title="ç¬¬ä¸€ç‰ˆï¼šæ”¯æŒå¤šæ¬¡æ‰§è¡Œ"></a>ç¬¬ä¸€ç‰ˆï¼šæ”¯æŒå¤šæ¬¡æ‰§è¡Œ</h3><p>GitHubæä¾›è¾ƒä¸ºå®Œå–„çš„APIï¼Œç”¨æˆ‘è¿™æ°´æ°´çš„rbæ°´å¹³ï¼Œå¤§è‡´å¯ä»¥å®Œå–„å¦‚ä¸‹ï¼š</p>
<figure class="highlight rb"><table><tr><td class="code"><pre><span class="line"><span class="comment"># from : https://madordie.github.io/post/blog-gitment-auto-setup</span></span><br><span class="line"><span class="comment"># å¦å¤–ï¼Œtokenå·²æ”¾åœ¨.git-tokenæ–‡ä»¶ä¸‹ï¼Œé˜²æ­¢æ³„æ¼ã€‚ã€‚</span></span><br><span class="line"></span><br><span class="line">username = <span class="string">"madordie"</span> <span class="comment"># GitHub ç”¨æˆ·å</span></span><br><span class="line">token = <span class="string">`cat .git-token`</span>  <span class="comment"># GitHub Token</span></span><br><span class="line">repo_name = <span class="string">"madordie.github.io"</span> <span class="comment"># å­˜æ”¾ issues</span></span><br><span class="line">sitemap_url = <span class="string">"https://raw.githubusercontent.com/madordie/madordie.github.io/master/sitemap.xml"</span> <span class="comment"># sitemap æ­¤å¤„ç”±äºgithub.ioä¸æ˜¯ç«‹é©¬ç”Ÿæ•ˆï¼Œä½†æ˜¯ä»“åº“æ˜¯ç«‹é©¬ç”Ÿæ•ˆçš„ï¼Œæ‰€ä»¥æ­¤å¤„åº”è¯¥æ›´æ¢ä¸ºä»“åº“çš„raw</span></span><br><span class="line">kind = <span class="string">"gitment"</span> <span class="comment"># "Gitalk" or "gitment"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'open-uri'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'faraday'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'active_support'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'active_support/core_ext'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'sitemap-parser'</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">"æ­£åœ¨æ£€ç´¢URL"</span></span><br><span class="line"></span><br><span class="line">sitemap = SitemapParser.new sitemap_url</span><br><span class="line">urls = sitemap.to_a</span><br><span class="line"></span><br><span class="line">puts <span class="string">"æ£€ç´¢åˆ°æ–‡ç« å…±<span class="subst">#&#123;urls.count&#125;</span>ä¸ª"</span></span><br><span class="line"></span><br><span class="line">conn = Faraday.new(<span class="symbol">:url</span> =&gt; <span class="string">"https://api.github.com"</span>) <span class="keyword">do</span> <span class="params">|conn|</span></span><br><span class="line">  conn.basic_auth(username, token)</span><br><span class="line">  conn.headers[<span class="string">'Accept'</span>] = <span class="string">"application/vnd.github.symmetra-preview+json"</span></span><br><span class="line">  conn.adapter  Faraday.default_adapter</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">commenteds = Array.new</span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="string">  if [ ! -f .commenteds ]; then</span></span><br><span class="line"><span class="string">    touch .commenteds</span></span><br><span class="line"><span class="string">  fi</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">File.open(<span class="string">".commenteds"</span>, <span class="string">"r"</span>) <span class="keyword">do</span> <span class="params">|file|</span></span><br><span class="line">  file.each_line <span class="keyword">do</span> <span class="params">|line|</span></span><br><span class="line">    commenteds.push line</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">urls.each_with_index <span class="keyword">do</span> <span class="params">|url, index|</span></span><br><span class="line">  url = url.gsub(<span class="regexp">/index.html$/</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> commenteds.<span class="keyword">include</span>?(<span class="string">"<span class="subst">#&#123;url&#125;</span>\n"</span>) == <span class="literal">false</span></span><br><span class="line">    url_key = Digest::MD5.hexdigest(URI.parse(url).path)</span><br><span class="line">    response = conn.get <span class="string">"/search/issues?q=label:<span class="subst">#&#123;url_key&#125;</span>+state:open+repo:<span class="subst">#&#123;username&#125;</span>/<span class="subst">#&#123;repo_name&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">    puts <span class="string">"æ­£åœ¨åˆ›å»º: <span class="subst">#&#123;url&#125;</span>"</span></span><br><span class="line">    <span class="keyword">if</span> JSON.parse(response.body)[<span class="string">'total_count'</span>] &gt; <span class="number">0</span></span><br><span class="line">      puts <span class="string">"\tâ†³ å·²å­˜åœ¨"</span></span><br><span class="line">      <span class="string">`echo <span class="subst">#&#123;url&#125;</span> &gt;&gt; .commenteds`</span></span><br><span class="line">      title = open(url).read.scan(<span class="regexp">/&lt;title&gt;(.*?)&lt;\/title&gt;/</span>).first.first.force_encoding(<span class="string">'UTF-8'</span>)</span><br><span class="line"></span><br><span class="line">      response = conn.post(<span class="string">"/repos/<span class="subst">#&#123;username&#125;</span>/<span class="subst">#&#123;repo_name&#125;</span>/issues"</span>) <span class="keyword">do</span> <span class="params">|req|</span></span><br><span class="line">        req.body = &#123; <span class="symbol">body:</span> url, <span class="symbol">labels:</span> [kind, url], <span class="symbol">title:</span> title &#125;.to_json</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">if</span> JSON.parse(response.body)[<span class="string">'number'</span>] &gt; <span class="number">0</span></span><br><span class="line">        <span class="string">`echo <span class="subst">#&#123;url&#125;</span> &gt;&gt; .commenteds`</span></span><br><span class="line">        puts <span class="string">"\tâ†³ å·²åˆ›å»ºæˆåŠŸ"</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        puts <span class="string">"\tâ†³ <span class="subst">#&#123;response.body&#125;</span>"</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>è„šæœ¬OKï¼Œè¿˜éœ€è¦å®‰è£…ä¸€äº›åº“ç”¨è¿™ä¸ªå°±è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo gem install faraday activesupport sitemap-parser</span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸æƒ…å†µéƒ½ä¼šå®‰è£…æˆåŠŸï¼Œé‚£ä¹ˆè·‘ä¸€ä¸‹è„šæœ¬å§ï¼š</p>
<figure class="highlight rb"><table><tr><td class="code"><pre><span class="line">ruby comment.rb</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¬¡è¿è¡Œè¯·æ±‚å¤šï¼Œç¨å¾®ç­‰ä¸€ä¼šã€‚è¡¨æ€¥ã€‚ã€‚</p>
<p>è·‘å®Œä¹‹åå¦‚æœä½ çš„é“¾æ¥æ€»é•¿åº¦éƒ½æ˜¯ <code>&lt;= 50</code> å­—ç¬¦ï¼Œé‚£ä¹ˆçœŸå—¨ï¼Œè¿™å°±è¡Œäº†ã€‚</p>
<p>ä½†æ˜¯å¦‚æœä»¥åæœ‰å¯èƒ½ <code>&gt; 50</code>ï¼Œæˆ–è€…ä¸ç¡®å®šä»¥åä¼šä¸ä¼šå†™ä¸€ä¸ªé“¾æ¥è´¼é•¿çš„æ–‡ç« ï¼Œé‚£ä¹ˆä½ å¯èƒ½è¿˜è¦å¾€ä¸‹å†çœ‹ä¸€ä¸‹ã€‚ã€‚</p>
<h3 id="ç¬¬äºŒç‰ˆï¼šå…¼å®¹æ–‡ç« é“¾æ¥å¾ˆé•¿é•¿é•¿"><a href="#ç¬¬äºŒç‰ˆï¼šå…¼å®¹æ–‡ç« é“¾æ¥å¾ˆé•¿é•¿é•¿" class="headerlink" title="ç¬¬äºŒç‰ˆï¼šå…¼å®¹æ–‡ç« é“¾æ¥å¾ˆé•¿é•¿é•¿"></a>ç¬¬äºŒç‰ˆï¼šå…¼å®¹æ–‡ç« é“¾æ¥å¾ˆé•¿é•¿é•¿</h3><p>å…³äºè¿™ä¸ªçš„è®¨è®ºå¾ˆå¤šï¼Œåœ¨issuesä¸­æœä¸€ä¸‹å¤§çº¦è¿™æ ·ï¼š<a href="https://github.com/imsun/gitment/issues?utf8=%E2%9C%93&q=is%253Aissue+validation+Failed" target="_blank" rel="noopener">Error: Validation Failed</a>ã€‚</p>
<p>è¿™ä¸ª<code>Error: Validation Failed</code>å°±æ˜¯labelå¤ªé•¿ã€‚</p>
<p>å…³äºè¿™ä¸ªé—®é¢˜åœ¨<a href="https://developer.github.com/v3/issues/labels/#create-a-label" target="_blank" rel="noopener">API: Create a label</a>å¹¶æœªæåŠã€‚</p>
<p>ä½†æ˜¯åœ¨ä»»ä½•ä¸€ä¸ªä»“åº“ä¸‹ï¼ŒæŒ‰ç…§<code>Issues -&gt; New label</code>çš„æ—¶å€™ï¼Œè¾“å…¥çš„<code>Label name</code>æ˜¯æœ‰é™åˆ¶çš„ï¼Œè¾“å…¥è¶…è¿‡<code>50</code>ä¸ªè‡ªç¬¦ä¹‹åä¾¿æ— æ³•å†æ¥æ”¶è¾“å…¥ã€‚å°±é…±ï¼Œæ²¡æ‰¾åˆ°ä»€ä¹ˆæ–‡æ¡£ã€‚ã€‚</p>
<p>çœ‹äº†è¿™ä¸ª<a href="https://github.com/imsun/gitment/issues/116" target="_blank" rel="noopener">Validation Failed IDé•¿åº¦é—®é¢˜å»ºè®®</a>ä¹‹åè§‰å¾—ï¼ŒMD5ä¸€ä¸‹å§é‚£å°±ã€‚ã€‚</p>
<p>ä¸ºäº†é€‰æ‹©ä¸€ä¸ªKEYå»MD5ï¼Œé¡ºä¾¿è§£å†³ä¸€ä¸‹<a href="https://github.com/imsun/gitment/issues/168" target="_blank" rel="noopener">åŒä¸€ä¸ªé¡µé¢ï¼Œå¸¦é”šç‚¹#moreä¼šåˆå§‹åŒ–ä¸€æ¡æ–°çš„issue</a>è¿™ä¸ªé—®é¢˜ï¼Œ</p>
<p>æ‰€ä»¥KEYä½¿ç”¨<a href="https://github.com/imsun/gitment/issues/68" target="_blank" rel="noopener">å…³äºhexoåšå®¢å•ç¯‡æ–‡ç« åˆå§‹åŒ–ä¸¤æ¬¡çš„é—®é¢˜</a>ä¸­æå‡ºçš„<code>window.location.pathname</code>å§ï¼Œä½†æ˜¯å…³äº<code>/</code>çš„è®¨è®ºï¼Œæˆ‘è¿™é‡Œè²Œä¼¼å¹¶æ²¡æœ‰çœ‹åˆ°ï¼Œæˆ‘çš„éƒ½æ˜¯æœ‰çš„ğŸ˜‚ã€‚ã€‚å¦‚æœçœ‹åˆ°çš„è¯å†æ›´ï¼Œæˆ–è€…ä¿é™©æœŸé—´ï¼Œå…ˆæŒ‰ç…§è¿™ç§æ–¹æ¡ˆæ›´æ–°ä¸€ä¸‹ã€‚</p>
<p>å°†ä¸Šé¢çš„åšå®Œï¼Œç°åœ¨çš„rbåº”è¯¥é•¿è¿™ä¸ªæ ·å­:</p>
<figure class="highlight rb"><table><tr><td class="code"><pre><span class="line"><span class="comment"># from : https://madordie.github.io/post/blog-gitment-auto-setup</span></span><br><span class="line"><span class="comment"># å¦å¤–ï¼Œtokenå·²æ”¾åœ¨.git-tokenæ–‡ä»¶ä¸‹,å¹¶è¢«.gitignoreæ ‡è®°ï¼Œé˜²æ­¢æ³„æ¼ã€‚ã€‚</span></span><br><span class="line"></span><br><span class="line">username = <span class="string">"madordie"</span> <span class="comment"># GitHub ç”¨æˆ·å</span></span><br><span class="line">token = <span class="string">`cat .git-token`</span>  <span class="comment"># GitHub Token</span></span><br><span class="line">repo_name = <span class="string">"madordie.github.io"</span> <span class="comment"># å­˜æ”¾ issues</span></span><br><span class="line">sitemap_url = <span class="string">"https://madordie.github.io/sitemap.xml"</span> <span class="comment"># sitemap</span></span><br><span class="line">kind = <span class="string">"gitment"</span> <span class="comment"># "Gitalk" or "gitment"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'open-uri'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'faraday'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'active_support'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'active_support/core_ext'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'sitemap-parser'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'digest'</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">"æ­£åœ¨æ£€ç´¢URL"</span></span><br><span class="line"></span><br><span class="line">sitemap = SitemapParser.new sitemap_url</span><br><span class="line">urls = sitemap.to_a</span><br><span class="line"></span><br><span class="line">puts <span class="string">"æ£€ç´¢åˆ°æ–‡ç« å…±<span class="subst">#&#123;urls.count&#125;</span>ä¸ª"</span></span><br><span class="line"></span><br><span class="line">conn = Faraday.new(<span class="symbol">:url</span> =&gt; <span class="string">"https://api.github.com"</span>) <span class="keyword">do</span> <span class="params">|conn|</span></span><br><span class="line">  conn.basic_auth(username, token)</span><br><span class="line">  conn.headers[<span class="string">'Accept'</span>] = <span class="string">"application/vnd.github.symmetra-preview+json"</span></span><br><span class="line">  conn.adapter  Faraday.default_adapter</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">commenteds = Array.new</span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="string">  if [ ! -f .commenteds ]; then</span></span><br><span class="line"><span class="string">    touch .commenteds</span></span><br><span class="line"><span class="string">  fi</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">File.open(<span class="string">".commenteds"</span>, <span class="string">"r"</span>) <span class="keyword">do</span> <span class="params">|file|</span></span><br><span class="line">  file.each_line <span class="keyword">do</span> <span class="params">|line|</span></span><br><span class="line">      commenteds.push line</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">urls.each_with_index <span class="keyword">do</span> <span class="params">|url, index|</span></span><br><span class="line">  url.gsub!(<span class="regexp">/index.html$/</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> commenteds.<span class="keyword">include</span>?(<span class="string">"<span class="subst">#&#123;url&#125;</span>\n"</span>) == <span class="literal">false</span></span><br><span class="line">    url_key = Digest::MD5.hexdigest(URI.parse(url).path)</span><br><span class="line">    response = conn.get <span class="string">"/search/issues?q=label:<span class="subst">#&#123;url_key&#125;</span>+state:open+repo:<span class="subst">#&#123;username&#125;</span>/<span class="subst">#&#123;repo_name&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> JSON.parse(response.body)[<span class="string">'total_count'</span>] &gt; <span class="number">0</span></span><br><span class="line">      <span class="string">`echo <span class="subst">#&#123;url&#125;</span> &gt;&gt; .commenteds`</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      puts <span class="string">"æ­£åœ¨åˆ›å»º: <span class="subst">#&#123;url&#125;</span>"</span></span><br><span class="line">      title = open(url).read.scan(<span class="regexp">/&lt;title&gt;(.*?)&lt;\/title&gt;/</span>).first.first.force_encoding(<span class="string">'UTF-8'</span>)</span><br><span class="line">      response = conn.post(<span class="string">"/repos/<span class="subst">#&#123;username&#125;</span>/<span class="subst">#&#123;repo_name&#125;</span>/issues"</span>) <span class="keyword">do</span> <span class="params">|req|</span></span><br><span class="line">        req.body = &#123; <span class="symbol">body:</span> url, <span class="symbol">labels:</span> [kind, url_key], <span class="symbol">title:</span> title &#125;.to_json</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">if</span> JSON.parse(response.body)[<span class="string">'number'</span>] &gt; <span class="number">0</span></span><br><span class="line">        <span class="string">`echo <span class="subst">#&#123;url&#125;</span> &gt;&gt; .commenteds`</span></span><br><span class="line">        puts <span class="string">"\tâ†³ å·²åˆ›å»ºæˆåŠŸ"</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        puts <span class="string">"\tâ†³ <span class="subst">#&#123;response.body&#125;</span>"</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>åŒæ—¶åˆ«å¿˜äº†ä¿®æ”¹å¯¹åº”çš„ç½‘é¡µã€‚ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">NexT.Pisces v5.1.4</a></p>
<p>éœ€è¦ä¿®æ”¹<code>/themes/next/layout/_third-party/comments/gitment.swig</code>æ–‡ä»¶ï¼Œç”±äºJSä¸æ”¯æŒMD5,æ‰€ä»¥è¿˜éœ€è¦å¼•å…¥ä¸€ä¸ªJSï¼Œäºæ˜¯ä¹å¤§çº¦è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    &#123;% if theme.gitment.mint %&#125;</span><br><span class="line">        &#123;% set CommentsClass &#x3D; &quot;Gitmint&quot; %&#125;</span><br><span class="line">        &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https:&#x2F;&#x2F;aimingoo.github.io&#x2F;gitmint&#x2F;style&#x2F;default.css&quot;&gt;</span><br><span class="line">        &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;aimingoo.github.io&#x2F;gitmint&#x2F;dist&#x2F;gitmint.browser.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">+       &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;blueimp-md5&#x2F;2.10.0&#x2F;js&#x2F;md5.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        &#123;% set CommentsClass &#x3D; &quot;Gitment&quot; %&#125;</span><br><span class="line">        &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https:&#x2F;&#x2F;imsun.github.io&#x2F;gitment&#x2F;style&#x2F;default.css&quot;&gt;</span><br><span class="line">        &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;imsun.github.io&#x2F;gitment&#x2F;dist&#x2F;gitment.browser.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">+       &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;blueimp-md5&#x2F;2.10.0&#x2F;js&#x2F;md5.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">...</span><br><span class="line">        var gitment &#x3D; new &#123;&#123;CommentsClass&#125;&#125;(&#123;</span><br><span class="line">-           id: document.location.href,</span><br><span class="line">+           id: md5(window.location.pathname.replace(&#x2F;index.html&#x2F;, &quot;&quot;)),</span><br><span class="line">            owner: &#39;&#123;&#123; theme.gitment.github_user &#125;&#125;&#39;,</span><br><span class="line">            repo: &#39;&#123;&#123; theme.gitment.github_repo &#125;&#125;&#39;,</span><br></pre></td></tr></table></figure>

<p>è‡³äºè¿™ä¸ªMD5çš„å¼•å…¥ï¼Œæˆ‘æ˜¯éšä¾¿æœçš„ä¸€ä¸ªã€‚ã€‚è¿™ä¸ª<code>if theme.gitment.mint</code>æˆ‘å¹¶ä¸çŸ¥é“åœ¨å“ªé‡Œé…ç½®çš„ï¼Œæ‰€ä»¥ä¿©éƒ½åŠ ä¸Šå§ã€‚</p>
<p>æ‰§è¡Œä¸€ä¸‹è„šæœ¬å§ï¼Œåº”è¯¥é½æ´»äº†ã€‚</p>
<h2 id="Gitalk"><a href="#Gitalk" class="headerlink" title="Gitalk"></a>Gitalk</h2><p>å¥½æ°”å•Š, <a href="https://github.com/next-theme/hexo-theme-next" target="_blank" rel="noopener">Nextä¸»é¢˜</a>å‡çº§ä¹‹åä¸æ”¯æŒGitmentäº†, å¤§æ¦‚æ˜¯å› ä¸ºä¸Šé¢ç§ç§é—®é¢˜å§, æ‰€ä»¥,è¢«è¿«æ¥åˆ°äº†<a href="https://github.com/gitalk/gitalk" target="_blank" rel="noopener">Gitalk</a></p>
<p>çœŸé¦™è­¦å‘Š.</p>
<p>å›å½’æœ¬å¿ƒ,è¯‰æ±‚å°±ä¸€ä¸ª: ä»<code>gitment</code>å…¼å®¹è‡³<code>gitalk</code>.</p>
<p>è„šæœ¬éœ€è¦é…ç½®é¡¹:</p>
<ul>
<li>.git-token = æ”¾ç½®token åˆ‡è®°æ³¨æ„æ·»åŠ <code>.gitignore</code></li>
<li>username = â€œmadordieâ€ # GitHub ç”¨æˆ·å</li>
<li>token = <code>cat .git-token</code>  # GitHub Token</li>
<li>repo_name = â€œmadordie.github.ioâ€ # å­˜æ”¾ issues</li>
<li>sitemap_url = â€œ<a href="https://raw.githubusercontent.com/madordie/madordie.github.io/master/sitemap.xml&quot;" target="_blank" rel="noopener">https://raw.githubusercontent.com/madordie/madordie.github.io/master/sitemap.xml&quot;</a> # sitemap</li>
<li>kind = â€œGitalkâ€ # â€œGitalkâ€ or â€œgitmentâ€</li>
</ul>
<p>ç„¶å, è„šæœ¬ä¼šè¯†åˆ«<code>kind</code>æ˜¯å¦å·²ç»æ·»åŠ , å¦‚æœæ²¡æœ‰æ·»åŠ ä¼šè¿½ä¸€ä¸ª<code>label</code>, ä»¥ç¡®ä¿èƒ½æ­£å¸¸æ‰§è¡Œ</p>
<figure class="highlight rb"><table><tr><td class="code"><pre><span class="line"><span class="comment"># from : https://madordie.github.io/post/blog-gitment-auto-setup</span></span><br><span class="line"><span class="comment"># å¦å¤–ï¼Œtokenå·²æ”¾åœ¨.git-tokenæ–‡ä»¶ä¸‹ï¼Œé˜²æ­¢æ³„æ¼ã€‚ã€‚</span></span><br><span class="line"></span><br><span class="line">username = <span class="string">"madordie"</span> <span class="comment"># GitHub ç”¨æˆ·å</span></span><br><span class="line">token = <span class="string">`cat .git-token`</span>  <span class="comment"># GitHub Token</span></span><br><span class="line">repo_name = <span class="string">"madordie.github.io"</span> <span class="comment"># å­˜æ”¾ issues</span></span><br><span class="line">sitemap_url = <span class="string">"https://raw.githubusercontent.com/madordie/madordie.github.io/master/sitemap.xml"</span> <span class="comment"># sitemap</span></span><br><span class="line">kind = <span class="string">"Gitalk"</span> <span class="comment"># "Gitalk" or "gitment"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'open-uri'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'faraday'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'active_support'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'active_support/core_ext'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'sitemap-parser'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'digest'</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">"æ­£åœ¨æ£€ç´¢URL"</span></span><br><span class="line"></span><br><span class="line">sitemap = SitemapParser.new sitemap_url</span><br><span class="line">urls = sitemap.to_a</span><br><span class="line"></span><br><span class="line">puts <span class="string">"æ£€ç´¢åˆ°æ–‡ç« å…±<span class="subst">#&#123;urls.count&#125;</span>ä¸ª"</span></span><br><span class="line"></span><br><span class="line">conn = Faraday.new(<span class="symbol">:url</span> =&gt; <span class="string">"https://api.github.com/"</span>) <span class="keyword">do</span> <span class="params">|conn|</span></span><br><span class="line">  conn.basic_auth(username, token)</span><br><span class="line">  conn.headers[<span class="string">'Accept'</span>] = <span class="string">"application/vnd.github.symmetra-preview+json"</span></span><br><span class="line">  conn.adapter  Faraday.default_adapter</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">commenteds = Array.new</span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="string">  if [ ! -f .commenteds ]; then</span></span><br><span class="line"><span class="string">    touch .commenteds</span></span><br><span class="line"><span class="string">  fi</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">File.open(<span class="string">".commenteds"</span>, <span class="string">"r"</span>) <span class="keyword">do</span> <span class="params">|file|</span></span><br><span class="line">  file.each_line <span class="keyword">do</span> <span class="params">|line|</span></span><br><span class="line">      commenteds.push line</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">urls.each_with_index <span class="keyword">do</span> <span class="params">|url, index|</span></span><br><span class="line">  url = url.gsub(<span class="regexp">/index.html$/</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> commenteds.<span class="keyword">include</span>?(<span class="string">"<span class="subst">#&#123;url&#125;</span>\n"</span>) == <span class="literal">false</span></span><br><span class="line">    url_key = Digest::MD5.hexdigest(URI.parse(url).path)</span><br><span class="line">    response = conn.get <span class="string">"/search/issues?q=label:<span class="subst">#&#123;url_key&#125;</span>+state:open+repo:<span class="subst">#&#123;username&#125;</span>/<span class="subst">#&#123;repo_name&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">    puts <span class="string">"æ­£åœ¨åˆ›å»º: <span class="subst">#&#123;url&#125;</span> -&gt; [<span class="subst">#&#123;url_key&#125;</span>, <span class="subst">#&#123;kind&#125;</span>]"</span></span><br><span class="line">    labels = JSON.parse(response.body)[<span class="string">"items"</span>]</span><br><span class="line">      .map &#123; <span class="params">|item|</span></span><br><span class="line">        item[<span class="string">"labels"</span>].map &#123; <span class="params">|label|</span> label[<span class="string">"name"</span>] &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .flatten</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> labels.<span class="keyword">include</span>?(url_key)</span><br><span class="line">      <span class="keyword">if</span> labels.<span class="keyword">include</span>?(kind)</span><br><span class="line">        puts <span class="string">"\tâ†³ å·²å­˜åœ¨"</span></span><br><span class="line">        <span class="string">`echo <span class="subst">#&#123;url&#125;</span> &gt;&gt; .commenteds`</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        issue_id = JSON.parse(response.body)[<span class="string">"items"</span>]</span><br><span class="line">          .map &#123; <span class="params">|item|</span> item[<span class="string">"number"</span>] &#125;</span><br><span class="line">          .first</span><br><span class="line"></span><br><span class="line">        puts <span class="string">"\tâ†³ æ­£åœ¨ä¸ºè¯„è®º(<span class="subst">#&#123;issue_id&#125;</span>)å¢åŠ `<span class="subst">#&#123;kind&#125;</span>`æ ‡ç­¾"</span></span><br><span class="line">        response = conn.post(<span class="string">"/repos/<span class="subst">#&#123;username&#125;</span>/<span class="subst">#&#123;repo_name&#125;</span>/issues/<span class="subst">#&#123;issue_id&#125;</span>/labels"</span>) <span class="keyword">do</span> <span class="params">|req|</span></span><br><span class="line">          req.body = &#123; <span class="symbol">labels:</span> [kind] &#125;.to_json</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">if</span> response.status == <span class="number">200</span></span><br><span class="line">          <span class="string">`echo <span class="subst">#&#123;url&#125;</span> &gt;&gt; .commenteds`</span></span><br><span class="line">          puts <span class="string">"\t\tâ†³ å·²å¢åŠ æˆåŠŸ"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          puts <span class="string">"\tâ†³ <span class="subst">#&#123;response.body&#125;</span>"</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      title = open(url).read.scan(<span class="regexp">/&lt;title&gt;(.*?)&lt;\/title&gt;/</span>).first.first.force_encoding(<span class="string">'UTF-8'</span>)</span><br><span class="line">      response = conn.post(<span class="string">"/repos/<span class="subst">#&#123;username&#125;</span>/<span class="subst">#&#123;repo_name&#125;</span>/issues"</span>) <span class="keyword">do</span> <span class="params">|req|</span></span><br><span class="line">        req.body = &#123; <span class="symbol">body:</span> url, <span class="symbol">labels:</span> [kind, url_key], <span class="symbol">title:</span> title &#125;.to_json</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">if</span> JSON.parse(response.body)[<span class="string">'number'</span>] &gt; <span class="number">0</span></span><br><span class="line">        <span class="string">`echo <span class="subst">#&#123;url&#125;</span> &gt;&gt; .commenteds`</span></span><br><span class="line">        puts <span class="string">"\tâ†³ å·²åˆ›å»ºæˆåŠŸ"</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        puts <span class="string">"\tâ†³ <span class="subst">#&#123;response.body&#125;</span>"</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><ul>
<li>æ–‡ä¸­æåˆ°çš„å…³äºé“¾æ¥<code>/</code>é£˜å¿½ä¸å®šçš„äº‹æƒ…æˆ‘æ²¡ç¢°åˆ°ï¼Œæˆ‘æ˜¯ç›´æ¥å–çš„<a href="https://madordie.github.io/sitemap.xml">sitemap</a>ï¼Œè²Œä¼¼æ¯ä¸ªæ–‡ç« éƒ½å¸¦äº†<code>/</code></li>
<li>æ–‡ä¸­çš„å¼•ç”¨å•¥çš„æˆ‘éƒ½æ ‡è®°äº†é“¾æ¥ï¼Œå¦‚æœ‰æ¼æ‰ã€ä¸æ˜ç™½ï¼Œéº»çƒ¦å‘Šè¯‰æˆ‘ä¸€å“ˆï¼Œæˆ‘å»è¡¥ä¸€ä¸‹</li>
<li>æˆ‘åªæ˜¯ä¸ªå°å°çš„iOSï¼Œå¯¹rubyã€jsæ‡‚å¾—ä¸å¤šï¼Œrbå†™çš„ä¸å¥½çš„åœ°æ–¹è½»æ‹</li>
<li>å“¦å¯¹äº†ï¼Œè¿™è„šæœ¬å…¨éƒ¨åœ¨è¿™é‡Œï¼š<a href="https://github.com/madordie/madordie.github.io/blob/master/comment.rb" target="_blank" rel="noopener">comment.rb</a>ã€‚åŒæ—¶ï¼Œè¿™ä¸ªè„šæœ¬æˆ‘åˆæ”¾åœ¨äº†è‡ªåŠ¨å‘å¸ƒçš„shellè„šæœ¬é‡Œé¢ï¼ŒåŒæ ·shellå†™çš„å¾ˆæ°´ã€‚ã€‚æ”¾åœ¨äº†è¿™é‡Œï¼š<a href="https://github.com/madordie/madordie.github.io/blob/master/deploy.sh" target="_blank" rel="noopener">deploy.sh</a>ï¼Œè€Œä¸”æ˜¯å¾ˆæ—©ä¹‹å‰å°±å†™äº†çš„ã€‚ã€‚</li>
<li>å¦‚æœè¿˜æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¯ä»¥æ‹‰å‡ºæ¥è®¨è®ºä¸€å“ˆ ;)</li>
</ul>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>blog</tag>
        <tag>gitment</tag>
        <tag>gitalk</tag>
      </tags>
  </entry>
  <entry>
    <title>sonarqube-note</title>
    <url>/post/sonarqube-note/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><p>Get Started in Two Minutes</p>
<ol>
<li>Download and unzip the SonarQube distribution (letâ€™s say in â€œC:\sonarqubeâ€ or â€œ/etc/sonarqubeâ€)</li>
<li>Start the SonarQube server:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># On Windows, execute:</span><br><span class="line">C:\sonarqube\bin\windows-x86-xx\StartSonar.bat</span><br><span class="line"> </span><br><span class="line"># On other operating system, execute:</span><br><span class="line">&#x2F;etc&#x2F;sonarqube&#x2F;bin&#x2F;[OS]&#x2F;sonar.sh console</span><br></pre></td></tr></table></figure></li>
<li>Download and unzip the SonarQube Scanner (letâ€™s say in â€œC:\sonar-scannerâ€ or â€œ/etc/sonar-scannerâ€)</li>
<li>Download and unzip some project samples (letâ€™s say in â€œC:\sonar-scanning-examplesâ€ or â€œ/etc/sonar-scanning-examplesâ€)</li>
<li>Analyze a project:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># On Windows:</span><br><span class="line">cd C:\sonar-scanning-examples\sonarqube-scanner</span><br><span class="line">C:\sonar-scanner\bin\sonar-scanner.bat</span><br><span class="line"> </span><br><span class="line"># On other operating system:</span><br><span class="line">cd &#x2F;etc&#x2F;sonar-scanning-examples&#x2F;sonarqube-scanner</span><br><span class="line">&#x2F;etc&#x2F;sonar-scanner&#x2F;bin&#x2F;sonar-scanner</span><br></pre></td></tr></table></figure></li>
<li>Browse the results at <a href="http://localhost:9000/" target="_blank" rel="noopener">http://localhost:9000</a> (default System administrator credentials are admin/admin)</li>
</ol>
<h3 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h3><ul>
<li><a href="https://docs.sonarqube.org/display/HOME/SonarQube+Platform" target="_blank" rel="noopener">docs.sonarqube.org</a></li>
<li></li>
</ul>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>Sonarqube</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼€å‘å°è®°</title>
    <url>/post/note/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>å¼€å‘ä¸­çš„å°ç¬”è®°ã€‚è®°å½•å¼€å‘ä¸­çš„ç‚¹æ»´æ»´ç‚¹ã€‚</p>
<a id="more"></a>


<h2 id="æ‰¹é‡æ›¿æ¢jsonæ–‡ä»¶ä¸­çš„æ³¨é‡Š"><a href="#æ‰¹é‡æ›¿æ¢jsonæ–‡ä»¶ä¸­çš„æ³¨é‡Š" class="headerlink" title="æ‰¹é‡æ›¿æ¢jsonæ–‡ä»¶ä¸­çš„æ³¨é‡Š"></a>æ‰¹é‡æ›¿æ¢jsonæ–‡ä»¶ä¸­çš„æ³¨é‡Š</h2><p>å¤‡ä»½è‡³.bat</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ perl -i.bat -lpe <span class="string">'s/\/\/[^"]+$//g'</span> xx</span><br></pre></td></tr></table></figure>


<h2 id="æ‰¹é‡æ­£åˆ™æ›¿æ¢çš„å¦ä¸€ç§æ€è·¯"><a href="#æ‰¹é‡æ­£åˆ™æ›¿æ¢çš„å¦ä¸€ç§æ€è·¯" class="headerlink" title="æ‰¹é‡æ­£åˆ™æ›¿æ¢çš„å¦ä¸€ç§æ€è·¯"></a>æ‰¹é‡æ­£åˆ™æ›¿æ¢çš„å¦ä¸€ç§æ€è·¯</h2>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;base&#x2F;sh</span><br><span class="line">find . -name &#39;*.swift&#39; | while read file; do</span><br><span class="line">  perl -i -lpe &#39;s&#x2F;if \(([^\)].*)\) \&#123;&#x2F;if $1 \&#123;&#x2F;g&#39; $file</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h2 id="æ‰¹é‡åˆ é™¤ç©ºæ ¼ç»„æˆçš„ç©ºè¡Œä¸­çš„ç©ºæ ¼"><a href="#æ‰¹é‡åˆ é™¤ç©ºæ ¼ç»„æˆçš„ç©ºè¡Œä¸­çš„ç©ºæ ¼" class="headerlink" title="æ‰¹é‡åˆ é™¤ç©ºæ ¼ç»„æˆçš„ç©ºè¡Œä¸­çš„ç©ºæ ¼"></a>æ‰¹é‡åˆ é™¤ç©ºæ ¼ç»„æˆçš„ç©ºè¡Œä¸­çš„ç©ºæ ¼</h2>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;base&#x2F;sh</span><br><span class="line">find . -name &#39;*.swift&#39; | while read file; do</span><br><span class="line">  sed -i &#39;&#39; &#39;s&#x2F;^[[:space:]][[:space:]]*$&#x2F;&#x2F;g&#39; $file</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h2 id="è·å–ä»£ç æ‰§è¡Œæ—¶é—´"><a href="#è·å–ä»£ç æ‰§è¡Œæ—¶é—´" class="headerlink" title="è·å–ä»£ç æ‰§è¡Œæ—¶é—´"></a>è·å–ä»£ç æ‰§è¡Œæ—¶é—´</h2>  <figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">import</span> &lt;mach/mach_time.h&gt;</span><br><span class="line"><span class="keyword">static</span> <span class="type">NSMutableDictionary</span> *__times;</span><br><span class="line"><span class="keyword">static</span> inline void debug_start_of(<span class="type">NSString</span> *key)</span><br><span class="line">&#123;</span><br><span class="line">  __times = __times ?: [<span class="type">NSMutableDictionary</span> new];</span><br><span class="line"></span><br><span class="line">  uint64_t start = mach_absolute_time();</span><br><span class="line">  __times[key] = @(start);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> inline void debug_stop_of(<span class="type">NSString</span> *key)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (__times) &#123;</span><br><span class="line">    uint64_t end = mach_absolute_time();</span><br><span class="line">    uint64_t start = [__times[key] unsignedLongLongValue];</span><br><span class="line">    <span class="keyword">if</span> (start != <span class="number">0</span>) &#123;</span><br><span class="line">      uint64_t elapsed = end - start;</span><br><span class="line">      mach_timebase_info_data_t info;</span><br><span class="line">      <span class="keyword">if</span> (mach_timebase_info(&amp;info) != <span class="type">KERN_SUCCESS</span>) &#123;</span><br><span class="line">        printf(<span class="string">"mach_timebase_info failed\n"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      uint64_t nanosecs = elapsed * info.numer / info.denom;</span><br><span class="line">      uint64_t millisecs = nanosecs / <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line">      printf(<span class="string">"[DEBUG code rt] %s:%llu ms\n"</span>, [key cStringUsingEncoding:<span class="type">NSUTF8StringEncoding</span>], millisecs);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      printf(<span class="string">"[DEBUG code rt] %s error: no start\n"</span>, [key cStringUsingEncoding:<span class="type">NSUTF8StringEncoding</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NAN"><a href="#NAN" class="headerlink" title="NAN"></a>NAN</h2><ul>
<li><p><code>A</code>å¯¹<code>B</code>é™¤ä½™æ—¶ï¼Œå¦‚æœ<code>B == 0</code> åˆ™ä¼šé€ æˆNANï¼Œ<code>truncatingRemainder(dividingBy:)</code>æ˜¯<code>swift</code>çš„æ–¹æ³•ï¼Œä¹Ÿä¼šé€ æˆæ­¤é—®é¢˜</p>
</li>
<li><p>å½“<code>NSUInteger 0 - 1</code>æ—¶ï¼Œè¿ç®—ç»“æœä¸º NANï¼ŒiOSä¸­æœ‰ä¸€ä¸ªå®<code>isnan(x)</code>è¿”å›æ˜¯å¦ä¸ºnanã€‚å¦å¤–è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« <a href="http://blog.csdn.net/toss156/article/details/7101885" target="_blank" rel="noopener">Objective-C ä¸­ åˆ¤æ–­ NaN</a>å¤§è‡´è®°å½•äº†ä¸€ä¸‹</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  math.h  #56</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__GNUC__)</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span>    HUGE_VAL     __builtin_huge_val()</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span>    HUGE_VALF    __builtin_huge_valf()</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span>    HUGE_VALL    __builtin_huge_vall()</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span>    NAN          __builtin_nanf(<span class="meta-string">"0x7fc00000"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span>    HUGE_VAL     1e500</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span>    HUGE_VALF    1e50f</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span>    HUGE_VALL    1e5000L</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span>    NAN          __nan()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦å¤–ï¼ŒNANä¸èƒ½ç›´æ¥åˆ¤æ–­ == éœ€è¦è°ƒç”¨ä¸‹é¢çš„å®ã€‚å¦åˆ™ä¼šå‘ç”Ÿè«åå…¶å¦™çš„é—®é¢˜</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">  <span class="comment">//  math.h  #178</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> isnan(x)                                                         \</span></span><br><span class="line">    ( <span class="keyword">sizeof</span>(x) == <span class="keyword">sizeof</span>(<span class="keyword">float</span>)  ? __inline_isnanf((<span class="keyword">float</span>)(x))          \</span><br><span class="line">    : <span class="keyword">sizeof</span>(x) == <span class="keyword">sizeof</span>(<span class="keyword">double</span>) ? __inline_isnand((<span class="keyword">double</span>)(x))         \</span><br><span class="line">                                  : __inline_isnanl((<span class="keyword">long</span> <span class="keyword">double</span>)(x)))</span><br></pre></td></tr></table></figure>

</li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼˜é›…çš„ä½¿ç”¨SwiftLint</title>
    <url>/post/elegant-to-use-swiftlint/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>æ¥å…¥äº†SwiftLineï¼Œä¿®æ”¹2000+çš„warningã€300+errorçš„ä¸€ç‚¹ç¬”è®°å¿ƒå¾—ã€‚</p>
<a id="more"></a>

<h1 id="SwiftLint"><a href="#SwiftLint" class="headerlink" title="SwiftLint"></a>SwiftLint</h1><blockquote>
<h2 id="SwiftLint-1"><a href="#SwiftLint-1" class="headerlink" title="SwiftLint"></a><a href="https://github.com/realm/SwiftLint" target="_blank" rel="noopener">SwiftLint</a></h2><p>A tool to enforce Swift style and conventions, loosely based on GitHubâ€™s Swift Style Guide.<br>  SwiftLint hooks into Clang and SourceKit to use the AST representation of your source files for more accurate results.<br>  SwiftLint æ˜¯ä¸€ä¸ªç”¨äºå¼ºåˆ¶æ£€æŸ¥ Swift ä»£ç é£æ ¼å’Œè§„å®šçš„ä¸€ä¸ªå·¥å…·ï¼ŒåŸºæœ¬ä¸Šä»¥ GitHubâ€™s Swift ä»£ç é£æ ¼æŒ‡å—ä¸ºåŸºç¡€ã€‚<br>  SwiftLint Hook äº† Clang å’Œ SourceKit ä»è€Œèƒ½å¤Ÿä½¿ç”¨ AST æ¥è¡¨ç¤ºæºä»£ç æ–‡ä»¶çš„æ›´å¤šç²¾ç¡®ç»“æœã€‚</p>
</blockquote>
<h2 id="å¯¹åŸæœ‰ä»£ç æ ¼å¼åŒ–"><a href="#å¯¹åŸæœ‰ä»£ç æ ¼å¼åŒ–" class="headerlink" title="å¯¹åŸæœ‰ä»£ç æ ¼å¼åŒ–"></a>å¯¹åŸæœ‰ä»£ç æ ¼å¼åŒ–</h2><h3 id="è‡ªåŠ¨æ ¼å¼åŒ–"><a href="#è‡ªåŠ¨æ ¼å¼åŒ–" class="headerlink" title="è‡ªåŠ¨æ ¼å¼åŒ–"></a>è‡ªåŠ¨æ ¼å¼åŒ–</h3>  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">swiftlint autocorrect</span><br></pre></td></tr></table></figure>

<h3 id="TrailingWhitespaceRule"><a href="#TrailingWhitespaceRule" class="headerlink" title="TrailingWhitespaceRule"></a>TrailingWhitespaceRule</h3><h4 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><blockquote>
<p>xxx.swift:34: warning: Trailing Whitespace Violation: Lines should not have trailing whitespace. (trailing_whitespace)</p>
</blockquote>
<p>  è§„åˆ™å®ç°ï¼š<a href="https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/TrailingWhitespaceRule.swift" target="_blank" rel="noopener">TrailingWhitespaceRule.swift</a></p>
<h4 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h4><p>  Xcodeä¸­çš„â€ç©ºç™½è¡Œâ€ã€‚å…¶å®å¹¶ä¸ç©ºç™½ï¼Œå«æœ‰ç©ºçš„å­—ç¬¦ã€‚æœ€æ˜æ˜¾çš„è¡¨ç°ä¸ºgitæäº¤çš„æ—¶å€™ä¼šæœ‰æ˜æ˜¾çš„é»„è‰²è­¦å‘Šã€‚</p>
<h4 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h4><p>  Xcodeä¸­æœ‰é€‰é¡¹å¯ä»¥ç›´æ¥æ§åˆ¶ï¼Œå…·ä½“è·¯å¾„ä¸º<br>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Xcode </span><br><span class="line">-&gt; Preferences</span><br><span class="line">-&gt; Text Editing</span><br><span class="line">-&gt; While editing</span><br><span class="line">-&gt; [V] Including whitespace-only lines</span><br></pre></td></tr></table></figure></p>
<h3 id="ColonRule"><a href="#ColonRule" class="headerlink" title="ColonRule"></a>ColonRule</h3><h4 id="ç°è±¡-1"><a href="#ç°è±¡-1" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><blockquote>
<p>xxx.swift:13:71: warning: Colon Violation: Colons should be next to the identifier when specifying a type. (colon)</p>
</blockquote>
<h4 id="åŸå› -1"><a href="#åŸå› -1" class="headerlink" title="åŸå› "></a>åŸå› </h4><p>  å˜é‡æ–¹æ³•çš„ <code>: </code> çš„å³è¾¹åº”è¯¥æœ‰ä¸€ä¸ªç©ºæ ¼æ‰èƒ½è¯†åˆ«å‡ºæ¥ï¼Œä¸”å·¦ä¾§ä¸èƒ½ç•™ç©ºæ ¼ã€‚æ‰€ä»¥å†™ä»£ç çš„æ—¶å€™éšæ‰‹å†™ä¸Šè¿˜æ˜¯æ¯”è¾ƒå¥½çš„ã€‚ã€‚<br>  æ —å­ï¼š<br>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;  OK:</span><br><span class="line">var responseData: [String : Any]? &#x3D; nil &#x2F;&#x2F; è¿”å›ç»“æœï¼Œè¯·æ±‚ä¹‹å‰ä¸ºnil</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;  warning: ç¬¬ä¸€ä¸ª&#39;:&#39;å¤„å·¦ä¾§æœ‰ç©ºæ ¼</span><br><span class="line">var responseData : [String : Any]? &#x3D; nil &#x2F;&#x2F; è¿”å›ç»“æœï¼Œè¯·æ±‚ä¹‹å‰ä¸ºnil</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;  warning: ç¬¬ä¸€ä¸ª&#39;:&#39;å¤„å³ä¾§æ— ç©ºæ ¼</span><br><span class="line">var responseData:[String : Any]? &#x3D; nil &#x2F;&#x2F; è¿”å›ç»“æœï¼Œè¯·æ±‚ä¹‹å‰ä¸ºnil</span><br></pre></td></tr></table></figure></p>
<h4 id="è§£å†³åŠæ³•-1"><a href="#è§£å†³åŠæ³•-1" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h4><p>  è§„èŒƒä¹¦å†™</p>
<h3 id="LineLengthRule"><a href="#LineLengthRule" class="headerlink" title="LineLengthRule"></a>LineLengthRule</h3><h4 id="ç°è±¡-2"><a href="#ç°è±¡-2" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><blockquote>
<p>xxx.swift:90: warning: Line Length Violation: Line should be 100 characters or less: currently 101 characters (line_length)</p>
</blockquote>
<h4 id="åŸå› -2"><a href="#åŸå› -2" class="headerlink" title="åŸå› "></a>åŸå› </h4><p>  è¡Œæ•°è¶…äº†å‘—ã€‚ã€‚</p>
<h4 id="è§£å†³åŠæ³•-2"><a href="#è§£å†³åŠæ³•-2" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h4><ul>
<li>æ–¹æ³•åå­—å†™çš„ç®€å•æ˜“æ‡‚</li>
</ul>
<h3 id="ControlStatementRule"><a href="#ControlStatementRule" class="headerlink" title="ControlStatementRule"></a>ControlStatementRule</h3><h4 id="ç°è±¡-3"><a href="#ç°è±¡-3" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><blockquote>
<p>xxx.swift:169:21: warning: Control Statement Violation: if,for,while,do statements shouldnâ€™t wrap their conditionals in parentheses. (control_statement)</p>
</blockquote>
<p>  è§„åˆ™å®ç°<a href="https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/ControlStatementRule.swift" target="_blank" rel="noopener">ControlStatementRule</a></p>
<h4 id="åŸå› -3"><a href="#åŸå› -3" class="headerlink" title="åŸå› "></a>åŸå› </h4><p>  swiftä¸­<code>if,for,while,do</code> è¯­å¥ä¸åº”è¯¥ç”¨<code>()</code></p>
<h3 id="UnusedClosureParameterRule"><a href="#UnusedClosureParameterRule" class="headerlink" title="UnusedClosureParameterRule"></a>UnusedClosureParameterRule</h3><h4 id="ç°è±¡-4"><a href="#ç°è±¡-4" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><blockquote>
<p>xxx.swift:103:62: warning: Unused Closure Parameter Violation: Unused parameter â€œresponseâ€ in a closure should be replaced with _. (unused_closure_parameter)</p>
</blockquote>
<p>  è§„åˆ™å®ç°<a href="https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/UnusedClosureParameterRule.swift" target="_blank" rel="noopener">UnusedClosureParameterRule</a></p>
<h4 id="åŸå› -4"><a href="#åŸå› -4" class="headerlink" title="åŸå› "></a>åŸå› </h4><p>  <code>response</code> æ²¡æœ‰ä½¿ç”¨ï¼Œå»ºè®®æ›¿æ¢ä¸º <code>_</code>ã€‚</p>
<h3 id="CyclomaticComplexityRule"><a href="#CyclomaticComplexityRule" class="headerlink" title="CyclomaticComplexityRule"></a>CyclomaticComplexityRule</h3><h4 id="ç°è±¡-5"><a href="#ç°è±¡-5" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><blockquote>
<p>xxx.swift:69:5: warning: Cyclomatic Complexity Violation: Function should have complexity 10 or less: currently complexity equals 14 (cyclomatic_complexity)</p>
</blockquote>
<p>  è§„åˆ™å®ç°<a href="https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/CyclomaticComplexityRule.swift" target="_blank" rel="noopener">CyclomaticComplexityRule</a></p>
<h4 id="åŸå› -5"><a href="#åŸå› -5" class="headerlink" title="åŸå› "></a>åŸå› </h4><p>  ğŸ˜‚ï¼Œä»–è¯´ä½ è¿™å‡½æ•°å†™çš„å¤ªå¤æ‚äº†ã€‚çœ‹å®ç°æ˜¯è¯´ä¸èƒ½æœ‰è¿‡å¤šçš„<code>if {}</code></p>
<h3 id="OpeningBraceRule"><a href="#OpeningBraceRule" class="headerlink" title="OpeningBraceRule"></a>OpeningBraceRule</h3><h4 id="ç°è±¡-6"><a href="#ç°è±¡-6" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><blockquote>
<p>xxx.swift:221:34: warning: Opening Brace Spacing Violation: Opening braces should be preceded by a single space and on the same line as the declaration. (opening_brace)</p>
</blockquote>
<p>  è§„åˆ™å®ç°<a href="https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/OpeningBraceRule.swift" target="_blank" rel="noopener">OpeningBraceRule</a></p>
<h4 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h4><p>  <code>{}</code>çš„å‰é¢è¦æœ‰ç©ºæ ¼éš”å¼€</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>SwiftLint</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­£åˆ™è¡¨è¾¾å¼å­¦ä¹ ç¬”è®°</title>
    <url>/post/bruch-up-regular-expressions/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>æ­£åˆ™è¡¨è¾¾å¼åŸºç¡€å­¦ä¹ ç¬”è®°ã€‚</p>
<a id="more"></a>

<h1 id="å‰é¢"><a href="#å‰é¢" class="headerlink" title="å‰é¢"></a>å‰é¢</h1><p>  ä¸Šæ¬¡æ‰¾äº†ä¸ªå¾ˆå¥½çš„æ–‡ç« ï¼Œå¯æ˜¯æ‰‹æ®‹æ²¡ä¿å­˜ã€‚ã€‚æ‰¾ä¸åˆ°äº†ğŸ˜­ï¼Œç°åœ¨é‡æ–°æ‰¾äº†ä¸€ä¸ªæ–‡ç« ï¼š<a href="https://luke0922.gitbooks.io/learnregularexpressionin30minutes/content/index.html" target="_blank" rel="noopener">æ­£åˆ™è¡¨è¾¾å¼30åˆ†é’Ÿå…¥é—¨æ•™ç¨‹</a><br>  æ­£å¦‚ä½œè€…è¯´çš„ï¼š</p>
<blockquote>
<h1 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="å£°æ˜"></a>å£°æ˜</h1><p>æœ¬æ–‡éåŸåˆ›ï¼Œæ˜¯æ”¹ç¼–è‡ª<a href="http://deerchao.net/tutorials/regex/regex.htm#mission" target="_blank" rel="noopener">ã€Šæ­£åˆ™è¡¨è¾¾å¼30åˆ†é’Ÿå…¥é—¨æ•™ç¨‹ã€‹</a>ï¼Œå› ä¸ºåŸä½œè€…çš„æ’ç‰ˆä¸ªäººä¸æ˜¯å¾ˆå–œæ¬¢ï¼Œè€Œä¸”å†…å®¹ä¸Šä¸ªäººè§‰å¾—æœ‰äº›åœ°æ–¹éœ€è¦æ”¹è¿›ï¼Œæ‰€ä»¥åœ¨ gitbook ä¸Šå¼€äº†ä¸€æœ¬ä¹¦ã€‚</p>
</blockquote>
<p>  OSCçš„<a href="http://tool.oschina.net/regex" target="_blank" rel="noopener">åœ¨çº¿æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•</a></p>
<h1 id="å¼€æ"><a href="#å¼€æ" class="headerlink" title="å¼€æ"></a>å¼€æ</h1><h2 id="å…ƒå­—ç¬¦"><a href="#å…ƒå­—ç¬¦" class="headerlink" title="å…ƒå­—ç¬¦"></a>å…ƒå­—ç¬¦</h2><ul>
<li><code>\</code> : è½¬ä¹‰</li>
<li><code>\b</code> : å•è¯å¼€å§‹æˆ–ç»“æŸ</li>
<li><code>^</code> : å­—ç¬¦ä¸²å¼€å§‹</li>
<li><code>$</code> : å­—ç¬¦ä¸²ç»“æŸ</li>
<li><code>\d</code> : ä¸€ä¸ªæ•°å­—</li>
<li><code>\s</code> : ä»»æ„ç©ºç™½å­—ç¬¦ï¼šç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€ä¸­æ–‡å…¨è§’ç©ºæ ¼ã€ç­‰</li>
<li><code>\w</code> : å­—æ¯/æ•°å­—/ä¸‹åˆ’çº¿/æ±‰å­— å¯è§å­—ç¬¦</li>
<li><code>.</code> : é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦</li>
</ul>
<h2 id="é‡å¤"><a href="#é‡å¤" class="headerlink" title="é‡å¤"></a>é‡å¤</h2><ul>
<li><code>{n}</code> : å‰ç½®ä½é‡å¤åŒ¹é… [n] æ¬¡</li>
<li><code>{n,m}</code> : å‰ç½®ä½é‡å¤åŒ¹é… [n-m] æ¬¡</li>
<li><code>{n,}</code> : å‰ç½®ä½é‡å¤åŒ¹é… [n-âˆ] æ¬¡</li>
<li><code>*</code> : æ•°é‡åŒºé—´ï¼š[0-N]</li>
<li><code>+</code> : æ•°é‡åŒºé—´ï¼š[1-N]</li>
<li><code>?</code> : æ•°é‡åŒºé—´ï¼š[0-1]</li>
</ul>
<h2 id="å­—ç¬¦ç±»"><a href="#å­—ç¬¦ç±»" class="headerlink" title="å­—ç¬¦ç±»"></a>å­—ç¬¦ç±»</h2><ul>
<li><code>[nml]</code> : å¯ä»¥åŒ¹é…åˆ° n/m/l</li>
</ul>
<h2 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h2><ul>
<li><code>|</code> : __æˆ–__è¯­å¥ã€‚å­˜åœ¨é€»è¾‘çŸ­è·¯</li>
<li><code>(m)</code> : __åˆ†ç»„__è¯­å¥ã€‚å­å¼ï¼Œå¯ä»¥æŒ‡å®šé‡å¤ä»€ä¹ˆçš„</li>
</ul>
<h2 id="åä¹‰"><a href="#åä¹‰" class="headerlink" title="åä¹‰"></a>åä¹‰</h2><ul>
<li><code>\W</code> : ä»»æ„__ä¸æ˜¯__ï¼ˆå­—ç¬¦ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€æ±‰å­—ï¼‰</li>
<li><code>\S</code> : ä»»æ„<strong>ä¸æ˜¯</strong> ç©ºç™½ç¬¦</li>
<li><code>\D</code> : ä»»æ„<strong>ä¸æ˜¯</strong> æ•°å­—</li>
<li><code>\B</code> : ä»»æ„<strong>ä¸æ˜¯</strong> å•è¯å¼€å¤´æˆ–ç»“å°¾</li>
<li><code>\^x</code> : é™¤xä»¥å¤–çš„ä»»æ„å­—ç¬¦</li>
<li><code>[\^abc]</code> : é™¤abcè¿™å‡ ä¸ªå­—æ¯ä»¥å¤–çš„ä»»æ„å­—ç¬¦</li>
</ul>
<h2 id="åå‘å¼•ç”¨"><a href="#åå‘å¼•ç”¨" class="headerlink" title="åå‘å¼•ç”¨"></a>åå‘å¼•ç”¨</h2><p>  <code>(\w+)</code>è¿™æ ·ç”¨<code>()</code>çš„éƒ¨åˆ†ç§°ä¸ºä¸€ä¸ªåˆ†ç»„ï¼Œå…¶åŒ¹é…åˆ°çš„å†…å®¹å¯ä»¥ä½¿ç”¨<code>\n</code>æ¥è¡¨ç¤ºï¼Œ<code>n</code>ä»£è¡¨è¯¥åˆ†ç»„ä¸ºç¬¬nä¸ªåˆ†ç»„ã€‚åˆ†ç»„ä¸‹æ ‡ä»<code>1</code>å¼€å§‹ã€‚<br>  ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å­è¡¨è¾¾å¼ç»„å: <code>(?&lt;Word&gt;M) \k&lt;Word&gt;</code> : æˆ– <code>(?&#39;Word&#39;M) \k&#39;Word&#39;</code>ï¼Œå…¶ä¸­Mä¸ºå­å¼ã€‚</p>
<h2 id="å¸¸ç”¨åˆ†ç»„è¯­æ³•"><a href="#å¸¸ç”¨åˆ†ç»„è¯­æ³•" class="headerlink" title="å¸¸ç”¨åˆ†ç»„è¯­æ³•"></a>å¸¸ç”¨åˆ†ç»„è¯­æ³•</h2><h3 id="æ•è·"><a href="#æ•è·" class="headerlink" title="æ•è·"></a>æ•è·</h3><ul>
<li><code>(exp)</code> : åŒ¹é…exp,å¹¶æ•è·æ–‡æœ¬åˆ°è‡ªåŠ¨å‘½åçš„ç»„é‡Œ</li>
<li><code>(?exp)</code> : åŒ¹é…exp,å¹¶æ•è·æ–‡æœ¬åˆ°åç§°ä¸ºnameçš„ç»„é‡Œï¼Œä¹Ÿå¯ä»¥å†™æˆ(?â€™nameâ€™exp)</li>
<li><code>(?:exp)</code> : åŒ¹é…exp,ä¸æ•è·åŒ¹é…çš„æ–‡æœ¬ï¼Œä¹Ÿä¸ç»™æ­¤åˆ†ç»„åˆ†é…ç»„å·</li>
</ul>
<h3 id="é›¶å®½æ–­è¨€"><a href="#é›¶å®½æ–­è¨€" class="headerlink" title="é›¶å®½æ–­è¨€"></a>é›¶å®½æ–­è¨€</h3><ul>
<li><code>(?=exp)</code> : åŒ¹é…expå‰é¢çš„ä½ç½®</li>
<li><code>(?&lt;=exp)</code> : åŒ¹é…expåé¢çš„ä½ç½®</li>
<li><code>(?!exp)</code> : åŒ¹é…åé¢è·Ÿçš„ä¸æ˜¯expçš„ä½ç½®</li>
<li><code>(?&lt;!exp)</code> : åŒ¹é…å‰é¢ä¸æ˜¯expçš„ä½ç½®</li>
</ul>
<h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><ul>
<li><code>(?#comment)</code> : è¿™ç§ç±»å‹çš„åˆ†ç»„ä¸å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å¤„ç†äº§ç”Ÿä»»ä½•å½±å“ï¼Œç”¨äºæä¾›æ³¨é‡Šè®©äººé˜…è¯»</li>
</ul>
<h2 id="è´ªå©ªä¸æ‡’æƒ°"><a href="#è´ªå©ªä¸æ‡’æƒ°" class="headerlink" title="è´ªå©ªä¸æ‡’æƒ°"></a>è´ªå©ªä¸æ‡’æƒ°</h2><p>  è´ªå©ªï¼šåŒ¹é…çš„å°½å¯èƒ½é•¿<br>  æ‡’æƒ°ï¼šåŒ¹é…çš„å°½å¯èƒ½çŸ­</p>
<ul>
<li><code>*?</code> : é‡å¤ä»»æ„æ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤</li>
<li><code>+?</code> : é‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤</li>
<li><code>??</code> : é‡å¤0æ¬¡æˆ–1æ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤</li>
<li><code>{n,m}?</code> : é‡å¤nåˆ°mæ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤</li>
<li><code>{n,}?</code> : é‡å¤næ¬¡ä»¥ä¸Šï¼Œä½†å°½å¯èƒ½å°‘é‡å¤</li>
</ul>
<h2 id="å¹³è¡¡ç»„-é€’å½’åŒ¹é…"><a href="#å¹³è¡¡ç»„-é€’å½’åŒ¹é…" class="headerlink" title="å¹³è¡¡ç»„/é€’å½’åŒ¹é…"></a>å¹³è¡¡ç»„/é€’å½’åŒ¹é…</h2><p>  # æˆ‘å¼€å§‹çœ‹ä¸æ‡‚äº†ğŸ˜‚</p>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul>
<li><code>\a</code> : æŠ¥è­¦å­—ç¬¦(æ‰“å°å®ƒçš„æ•ˆæœæ˜¯ç”µè„‘å˜€ä¸€å£°)</li>
<li><code>\b</code> : é€šå¸¸æ˜¯å•è¯åˆ†ç•Œä½ç½®ï¼Œä½†å¦‚æœåœ¨å­—ç¬¦ç±»é‡Œä½¿ç”¨ä»£è¡¨é€€æ ¼</li>
<li><code>\t</code> : åˆ¶è¡¨ç¬¦ï¼ŒTab</li>
<li><code>\r</code> : å›è½¦</li>
<li><code>\v</code> : ç«–å‘åˆ¶è¡¨ç¬¦</li>
<li><code>\f</code> : æ¢é¡µç¬¦</li>
<li><code>\n</code> : æ¢è¡Œç¬¦</li>
<li><code>\e</code> : Escape</li>
<li><code>\0nn</code> : ASCIIä»£ç ä¸­å…«è¿›åˆ¶ä»£ç ä¸ºnnçš„å­—ç¬¦</li>
<li><code>\xnn</code> : ASCIIä»£ç ä¸­åå…­è¿›åˆ¶ä»£ç ä¸ºnnçš„å­—ç¬¦</li>
<li><code>\unnnn</code> : Unicodeä»£ç ä¸­åå…­è¿›åˆ¶ä»£ç ä¸ºnnnnçš„å­—ç¬¦</li>
<li><code>\cN</code> : ASCIIæ§åˆ¶å­—ç¬¦ã€‚æ¯”å¦‚\cCä»£è¡¨Ctrl+C</li>
<li><code>\A</code> : å­—ç¬¦ä¸²å¼€å¤´(ç±»ä¼¼^ï¼Œä½†ä¸å—å¤„ç†å¤šè¡Œé€‰é¡¹çš„å½±å“)</li>
<li><code>\Z</code> : å­—ç¬¦ä¸²ç»“å°¾æˆ–è¡Œå°¾(ä¸å—å¤„ç†å¤šè¡Œé€‰é¡¹çš„å½±å“)</li>
<li><code>\z</code> : å­—ç¬¦ä¸²ç»“å°¾(ç±»ä¼¼$ï¼Œä½†ä¸å—å¤„ç†å¤šè¡Œé€‰é¡¹çš„å½±å“)</li>
<li><code>\G</code> : å½“å‰æœç´¢çš„å¼€å¤´</li>
<li><code>\p{name}</code> : Unicodeä¸­å‘½åä¸ºnameçš„å­—ç¬¦ç±»ï¼Œä¾‹å¦‚\p{IsGreek}</li>
<li><code>(?&gt;exp)</code> : è´ªå©ªå­è¡¨è¾¾å¼</li>
<li><code>(?&lt;x&gt;-&lt;y&gt;exp)</code> : å¹³è¡¡ç»„</li>
<li><code>(?im-nsx:exp)</code> : åœ¨å­è¡¨è¾¾å¼expä¸­æ”¹å˜å¤„ç†é€‰é¡¹</li>
<li><code>(?im-nsx)</code> : ä¸ºè¡¨è¾¾å¼åé¢çš„éƒ¨åˆ†æ”¹å˜å¤„ç†é€‰é¡¹</li>
<li><code>(?(exp)yes|no)</code> : æŠŠexpå½“ä½œé›¶å®½æ­£å‘å…ˆè¡Œæ–­è¨€ï¼Œå¦‚æœåœ¨è¿™ä¸ªä½ç½®èƒ½åŒ¹é…ï¼Œä½¿ç”¨yesä½œä¸ºæ­¤ç»„çš„è¡¨è¾¾å¼ï¼›å¦åˆ™ä½¿ç”¨no</li>
<li><code>(?(exp)yes)</code> : åŒä¸Šï¼Œåªæ˜¯ä½¿ç”¨ç©ºè¡¨è¾¾å¼ä½œä¸ºno</li>
<li><code>(?(name)yes|no)</code> : å¦‚æœå‘½åä¸ºnameçš„ç»„æ•è·åˆ°äº†å†…å®¹ï¼Œä½¿ç”¨yesä½œä¸ºè¡¨è¾¾å¼ï¼›å¦åˆ™ä½¿ç”¨no</li>
<li><code>(?(name)yes)</code> : åŒä¸Šï¼Œåªæ˜¯ä½¿ç”¨ç©ºè¡¨è¾¾å¼ä½œä¸ºno</li>
</ul>
<h2 id="æ —å­"><a href="#æ —å­" class="headerlink" title="æ —å­"></a>æ —å­</h2><ul>
<li>5-12ä½QQï¼š<code>^\d{5,12}$</code></li>
<li>IPv4åœ°å€ï¼š<code>((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)</code></li>
<li><code>go go</code>ã€<code>kitty kitty</code>è¿™æ ·çš„å è¯ï¼š<code>\b(\w+)\b\s+\1\b</code></li>
<li>åå‘å¼•ç”¨ï¼š<code>\b(\w+)\b\s+\1\b</code> == <code>\b(?&lt;Word&gt;\w+)\b\s+\k&lt;Word&gt;\b</code> == <code>\b(?&#39;Word&#39;\w+)\b\s+\k&#39;Word&#39;\b</code></li>
</ul>
<h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>  çŸ¥è¯†ç ”ç©¶äº†ä¸€ä¸‹è¯­æ³•ï¼Œè¿˜æœªè¯¦ç»†æµ‹è¯•ã€‚æ€è€ƒï¼šè¿™ç©æ„çœŸå¿ƒå‰å®³ğŸ˜‚ã€‚</p>
<hr>
<p><a href="../reprinted-regular-mind-map">æ€ç»´å¯¼å›¾</a></p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>æ­£åˆ™è¡¨è¾¾å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ç§‘å­¦ä¸Šç½‘ä¹‹æ¬ç“¦å·¥ssæ­å»ºç¬”è®°</title>
    <url>/post/bandwagonhost-note/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>åŸæ¥å§ï¼Œç”¨ç”¨goagentã€Lanternã€XX-Netï¼Œç¡®å®ï¼Œè¿™ç©æ„åªèƒ½Googleå‡ºæ¥ç»“æœï¼Œä½†æ˜¯æœ‰çš„ç«™ç‚¹æ‰“ä¸å¼€æ‰æ˜¯æœ€éªšçš„ã€‚ã€‚<br>åŒäº‹æäº†ä¸ªæ¬ç“¦å·¥æŒºä¾¿å®œï¼Œäºæ˜¯ä¹å°±ä¹Ÿæäº†ä¸€ä¸ªã€‚ä¸è¿‡å¼ºè¿«ç—‡çŠ¯äº†ï¼Œå°è¯•äº†å„ç§SSç‰ˆæœ¬ä»¥åŠå„ç§ä¼˜åŒ–ï¼Œç›®çš„æ˜¯æ‰¾ä¸ªæµç•…ç‚¹çš„ç‰ˆæœ¬è¿›è¡Œ__ç§‘å­¦ä¸Šç½‘__ã€‚</p>
<a id="more"></a>

<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><ul>
<li><p>çº¢çº¿è¶Šä¸å¾—ï¼çº¢çº¿è¶Šä¸å¾—ï¼çº¢çº¿è¶Šä¸å¾—ï¼é‡è¦çš„äº‹æƒ…è¯´3éã€‚</p>
</li>
<li><p>å‚çœ‹ç¬¬ä¸€æ¡</p>
</li>
<li><p>å‚çœ‹ç¬¬ä¸€æ¡</p>
</li>
<li><p>å‚çœ‹ç¬¬ä¸€æ¡</p>
<p>2017 07 18 say goog bay !</p>
</li>
</ul>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>ss</tag>
      </tags>
  </entry>
  <entry>
    <title>è‡ªå®šä¹‰æ•°æ®å¡«å……Sketchæ’ä»¶</title>
    <url>/post/format-sketchplugin/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="å…ˆæ¥ä¸ªREADME-md"><a href="#å…ˆæ¥ä¸ªREADME-md" class="headerlink" title="å…ˆæ¥ä¸ªREADME.md"></a>å…ˆæ¥ä¸ªREADME.md</h2><blockquote>
<h2 id="format-sketchplugin"><a href="#format-sketchplugin" class="headerlink" title="format-sketchplugin"></a><a href="https://github.com/madordie/format-sketchplugin" target="_blank" rel="noopener">format-sketchplugin</a></h2></blockquote>
<blockquote>
<p>ä¸ºSketchè‡ªåŠ¨ç”Ÿæˆè‡ªå®šä¹‰å¡«å……æ•°æ®æºæ’ä»¶ã€‚</p>
</blockquote>
<blockquote>
<p><img src="https://github.com/madordie/format-sketchplugin/blob/master/Images/Untitled.gif?raw=true" alt="é¢„è§ˆ"></p>
</blockquote>
<blockquote>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2></blockquote>
<blockquote>
<ul>
<li>ä¸‹è½½<a href="https://github.com/madordie/format-sketchplugin/releases" target="_blank" rel="noopener">Release</a>ä¸Šçš„åŒ…ï¼Œå¹¶åŒå‡»æ‰“å¼€</li>
</ul>
</blockquote>
<ul>
<li>é€‰æ‹©è¦éšæœºå¡«å……çš„æ–‡æœ¬æ•°æ®(æ”¯æŒå¤šé€‰ï¼Œæ–‡æœ¬æ•°æ®æŒ‰ç…§å›è½¦è¿›è¡Œéšæœºï¼Œä¼šé»˜è®¤åˆ é™¤ç©ºæ•°æ®)</li>
<li>é€‰æ‹©éšæœºå¡«å……çš„å›¾ç‰‡æ–‡ä»¶å¤¹(åªæ”¯æŒå•é€‰æ–‡ä»¶å¤¹ï¼Œé€‰ä¸­æ–‡ä»¶å¤¹å†…çš„<code>.png</code>ã€ <code>.PNG</code>ã€ <code>.jpg</code>ã€ <code>.JPG</code>ã€ <code>.jpeg</code>ã€ <code>.JPEG</code>ã€ <code>.gif</code>ã€ <code>.GIF</code>æ–‡ä»¶å°†ä¼šè¢«è¯†åˆ«å¹¶ä½œä¸ºæ•°æ®æº)</li>
<li>å°†æ’ä»¶ç”Ÿæˆç›®å½•æ‹–æ‹½è‡³çª—å£å³å®Œæˆè®¾ç½®</li>
<li>æ–‡æœ¬ã€å›¾ç‰‡æ–‡ä»¶å¤¹ å¯åœ¨ä¿å­˜å‰é‡å¤å¤šæ¬¡é€‰æ‹©</li>
<li>ç‚¹å‡»<code>åˆ¶ä½œ</code>ï¼Œå³å¯åœ¨ç”Ÿæˆç›®å½•çœ‹åˆ°æ’ä»¶ç”Ÿæˆ</li>
</ul>
<blockquote>
<h2 id="ç”Ÿæˆè¯´æ˜"><a href="#ç”Ÿæˆè¯´æ˜" class="headerlink" title="ç”Ÿæˆè¯´æ˜"></a>ç”Ÿæˆè¯´æ˜</h2></blockquote>
<blockquote>
<ul>
<li>æ–‡æœ¬æ•°æ®æŒ‰ç…§æ–‡æœ¬æ–‡ä»¶åä½œä¸ºæ ‡ç¤º</li>
</ul>
</blockquote>
<ul>
<li>å›¾ç‰‡æ–‡ä»¶å¤¹æŒ‰ç…§å›¾ç‰‡æ–‡ä»¶å¤¹åä½œä¸ºæ ‡ç¤º</li>
<li>ä¿å­˜æ—¶ï¼Œæ–‡æœ¬æ•°æ®ä¼šè¯»å–è‡³æ’ä»¶å†…</li>
<li>ä¿å­˜æ—¶ï¼Œå›¾ç‰‡æ–‡ä»¶å¤¹ä¼šå¤åˆ¶è‡³æ’ä»¶å†…(ä¸è¯†åˆ«å­ç›®å½•ï¼Œå¹¶åªæ‹·è´å¯è¯†åˆ«çš„ç´ æ)</li>
</ul>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Sketchplugin</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºè½¬è½½çš„æ–‡ç« </title>
    <url>/post/about-reprint-article/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>ä¸€ç‚¹åˆ é™¤åŸé“¾æ¥çš„è½¬è½½æ–‡ç« çš„ç‰¢éªš</p>
<a id="more"></a>

<h1 id="ç¼˜ç”±"><a href="#ç¼˜ç”±" class="headerlink" title="ç¼˜ç”±"></a>ç¼˜ç”±</h1><p>å‰ä¸¤å¤©çœ‹åˆ°æœ‹å‹åœˆä¸€ä¸ªå“¥ä»¬è½¬è½½äº†è®¸å¤šå…³äºiOSçš„ä¸€äº›æ–‡ç« ï¼Œå¾ˆæ˜¯å…´å¥‹ï¼Œå»å›´è§‚ã€‚çªç„¶å‘ç°è¿™æ–‡ç¬”ç»å¯¹æ˜¯ç»è¿‡æ ¡å¯¹çš„ã€‚å¿ƒä¸­å¤§å–œï¼Œä»¥ä¸ºæ·˜åˆ°å®äº†ï¼ˆå› ä¸ºæ–‡ç« å¹¶æ²¡æœ‰ç½²åè½¬è½½å‡ºå¤„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯åŸåˆ›ï¼‰ã€‚ä¹‹åçœ‹äº†ä¸€ä¸‹ä»–çš„å¦ä¸€ä¸ªæ–‡ç« ï¼Œåˆšå¥½æˆ‘ç™¾åº¦è¿‡è¿™ä¸ªæ–‡ç« çš„åŸä½œè€…çš„æœ€åä¸€ä¸ªç³»åˆ—çš„ï¼Œäºæ˜¯æˆ‘åˆç¿»é˜…äº†ä¸€ä¸‹çœ‹çœ‹æ˜¯ä¸æ˜¯ä¸ä¸€æ ·ï¼Œç»“æœå’Œæˆ‘æƒ³çš„ä¸€æ ·ï¼Œé™¤äº†åˆ é™¤äº†ä½œè€…çš„ç½²åä¹‹å¤–å…¶ä»–çš„éƒ½æ˜¯ä¸€æ ·çš„ã€‚äºæ˜¯å…³æ‰äº†ç½‘é¡µï¼Œå¿ƒä¸­é»˜é»˜çš„é„™è§†ã€‚</p>
<h1 id="å…³äºè½¬è½½çš„åˆ«äººæ–‡ç« "><a href="#å…³äºè½¬è½½çš„åˆ«äººæ–‡ç« " class="headerlink" title="å…³äºè½¬è½½çš„åˆ«äººæ–‡ç« "></a>å…³äºè½¬è½½çš„åˆ«äººæ–‡ç« </h1><p>å¯¹äºä¸€äº›å¤§ç¥çš„æŠ€æœ¯æ–‡ç« éƒ½æ˜¯å–œæ¬¢çš„ï¼Œçˆ±ä¸é‡Šæ‰‹çš„é‚£ç§ï¼Œæˆ‘ä¹Ÿæ˜¯ã€‚æœ‰çš„èƒ½è½¬è½½çš„æˆ‘å°±è½¬è½½ï¼Œä¸èƒ½è½¬è½½çš„ï¼Œæˆ‘ä¼šå¤åˆ¶ä¸‹æ¥ï¼Œæ”¾åœ¨æˆ‘è‡ªå·±çš„æ–‡ä»¶å¤¹ä¸­ï¼Œä¸ºçš„æ˜¯æ–¹ä¾¿æŸ¥è¯¢ã€‚åœ¨è½¬è½½çš„æ—¶å€™æˆ‘ä¼šç‰¹æ„æ ‡ç¤ºè½¬è½½çš„åœ°å€ã€‚è€Œä¸”ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä¼šåœ¨æ–‡ç« çš„å¼€å§‹å†™ä¸Šå‡ å¥ç®€å•çš„ä¸»è¦çš„æ€æƒ³ï¼ˆæ¯”å¦‚ï¼š<a href="http://www.cnblogs.com/madordie/p/5159597.html" target="_blank" rel="noopener">ã€Š[è½¬]è“ç‰™å¼€å‘ã€‹</a>ã€<a href="http://www.cnblogs.com/madordie/p/4322044.html" target="_blank" rel="noopener">ã€Š[æ¬è¿] macä¸‹å®‰è£…GDBã€‹</a>ã€<a href="http://www.cnblogs.com/madordie/p/4322042.html" target="_blank" rel="noopener">ã€Šï¼»æ¬è¿ï¼½MAC ä¸‹å®‰è£… brewã€‹</a>ï¼‰ï¼Œå½“ç„¶æœ‰æ—¶å€™æ²¡æ¥å¾—åŠçš„å°±å¿˜äº†ğŸ˜‚ï¼ˆæ¯”å¦‚ï¼š<a href="http://www.cnblogs.com/madordie/p/4357685.html" target="_blank" rel="noopener">ã€Š[æ¬è¿] iOS 7 ä¾§æ»‘è¿”å›æ‰‹åŠ¿ä½¿ç”¨å’Œé”™è¯¯é›†ã€‹</a>ï¼‰ã€‚</p>
<p>è¿˜æœ‰å…³äºæ–‡ç« çš„æ’ç‰ˆï¼Œæ®Šä¸çŸ¥åŸä½œè€…ä¸ºäº†è®©è¯»è€…æ›´å¥½çš„é˜…è¯»ä¼šå¯¹æ’ç‰ˆåšçš„æ¯”è¾ƒå¥½ï¼Œæœ‰çš„äººä¸ºäº†é˜…è¯»æ–¹ä¾¿ä¼šå»é˜…è¯»åŸä½œè€…çš„æ–‡ç« ã€‚æ¯”å¦‚è¯´æˆ‘è¿™ç§å¼ºè¿«ç—‡ã€‚</p>
<h1 id="æˆ‘å¯¹åˆ é™¤åŸé“¾çš„è½¬è½½æ–‡ç« æ€åº¦"><a href="#æˆ‘å¯¹åˆ é™¤åŸé“¾çš„è½¬è½½æ–‡ç« æ€åº¦" class="headerlink" title="æˆ‘å¯¹åˆ é™¤åŸé“¾çš„è½¬è½½æ–‡ç« æ€åº¦"></a>æˆ‘å¯¹åˆ é™¤åŸé“¾çš„è½¬è½½æ–‡ç« æ€åº¦</h1><p>ç„¶åè¯´ä¸€ä¸‹æˆ‘å¯¹äºé‚£äº›æŠ„è¢­çš„ï¼Œç„¶ååˆ é™¤äº†åŸé“¾æ¥çš„äººé„™è§†ä¸€ä¸‹ã€‚æ¯ä¸€ç¯‡æ–‡ç« éƒ½æ˜¯åˆ«äººèŠ±è´¹äº†å¤§é‡çš„ç²¾åŠ›å»å®Œæˆçš„ï¼Œæœ‰çš„ä¸ºäº†è®©è¯»è€…èƒ½å¤Ÿæ›´æ¸…æ¥šçš„ç†è§£ï¼Œæ‰€ä»¥ä¼šåœ¨å‘å¸ƒçš„æ—¶å€™æ‰¾åˆ«äººå»è¯»ä¸€è¯»ï¼Œçœ‹èƒ½ä¸èƒ½ç†è§£å…¶ä¸­äº‘äº‘ã€‚ç„¶è€Œå¯¹æ–‡ç« çš„åŸé“¾æ¥ä¿å­˜æ˜¯ä¸€ç§å¯¹åˆ«äººåŠ³åŠ¨æˆæœçš„å°Šé‡ï¼Œå¯¹åŸä½œè€…æœ€åŸºæœ¬çš„å°Šé‡ã€‚</p>
<p>åˆ«çš„ä¸æƒ³å¤šè¯´äº†ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚è°¢è°¢ï¼<br>ä¸”è¡Œä¸”çæƒœã€‚</p>
]]></content>
      <categories>
        <category>ç‰¢éªš</category>
      </categories>
  </entry>
  <entry>
    <title>iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º</title>
    <url>/post/ios-automation-jenkins-configuration/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><ul>
<li><a href="../ios-automation-jenkins-configuration">iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º</a></li>
<li><a href="../ios-automation-jenkins-build">iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹</a></li>
</ul>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><blockquote>
<p> <strong>Jenkins</strong><br><em>Build great things at any scale</em><br>The leading open source automation server, Jenkins provides hundreds of plugins to support building, deploying and automating any project.</p>
</blockquote>
<p>å¦‚<a href="https://jenkins.io/" target="_blank" rel="noopener">å®˜ç½‘</a>æ‰€è¯´<code>Build great things at any scale</code></p>
<p>ä»è¿™ç¯‡æ–‡ç« ä¸­ä½ å°†ä¼šå®ç°ï¼š</p>
<ul>
<li>åœ¨Macä¸Šå¤šç§æ–¹æ¡ˆå®‰è£…å¹¶å¯åŠ¨jenkins</li>
<li>åœ¨å±€åŸŸç½‘ä¸­æ­£å¸¸è®¿é—®jenkins</li>
</ul>
<a id="more"></a>

<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å½“ç„¶ä½ é¦–å…ˆéœ€è¦ä¸€ä¸ªmacOSçš„ç³»ç»Ÿï¼Œä¸ºåæ¥çš„æ„å»ºåšåŸºç¡€ã€‚</p>
<p>Jenkinsä¸­å¯ä»¥ä½¿ç”¨<code>pkg</code>ã€<code>war</code>çš„æ–¹å¼è¿è¡Œï¼Œå½“ç„¶è¿˜æœ‰åœ¨<a href="https://jenkins.io/doc/book/getting-started/installing/" target="_blank" rel="noopener">Installing Jenkins</a>ä¸­æä¾›ä¸€äº›å®‰è£…æ–¹å¼ï¼š</p>
<blockquote>
<p> <strong>macOS</strong><br>To install from the website, using a package:</p>
</blockquote>
<blockquote>
<ul>
<li>Download the latest package</li>
<li>Open the package and follow the instructions</li>
</ul>
</blockquote>
<blockquote>
<p>Jenkins can also be installed using brew:</p>
</blockquote>
<blockquote>
<ul>
<li>Install the latest release version<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">brew install jenkins </span><br></pre></td></tr></table></figure></li>
<li>Install the LTS version<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">brew install jenkins-lts </span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p>è¿™é‡Œä½¿ç”¨<code>brew</code>ï¼Œå› ä¸º<strong>å¾ˆæ–¹ä¾¿</strong>ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">$ brew update &amp;&amp; brew install jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°</span></span><br><span class="line">$ brew update &amp; brew upgrade jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment"># åå°è¿è¡Œ è¿˜æ”¯æŒ`stop`ã€`restart`ç­‰ (è¿™ç§æ–¹å¼è¿˜æ˜¯æœ‰å·®åˆ«çš„ï¼Œä¸‹é¢ä¼šè¯´æ˜)</span></span><br><span class="line">$ brew services start jenkins</span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><p>å»ºè®®å…ˆæ¥çœ‹ä¸€æ³¢<code>--help</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ jenkins --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h3><p>ç›´æ¥è¿è¡Œ<code>jenkins</code>å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—è¾“å‡ºï¼Œä½†æ˜¯ä¸èƒ½é€€å‡ºå‘½ä»¤ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ jenkins</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æ¼«é•¿çš„åˆå§‹åŒ–ï¼Œä¼šå°†</p>
<ul>
<li><code>~/.jenkins</code>ç›®å½•ä½œä¸º<code>JENKINS_HOME</code></li>
<li><code>localhost:8080</code>ä½œä¸ºé»˜è®¤URL</li>
</ul>
<p>ç»ˆç«¯è¾“å‡º<code>Started initialization</code>ä¸€è¡Œä¹‹åå°±å¯ä»¥æ­£å¸¸æ‰“å¼€äº†ã€‚</p>
<p>åœ¨æµè§ˆå™¨æ‰“å¼€<a href="http://10.12.12.10:8080/" target="_blank" rel="noopener">http://10.12.12.10:8080</a>å°±å¯ä»¥æ­£å¸¸åŠ è½½å•¦ï½</p>
<p>é€€å‡ºè¿è¡Œï¼š<code>control + C</code> ç»„åˆé”®ã€‚</p>
<h3 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h3><p>ç›´æ¥<code>open</code>ï¼Œçœ‹ä¸åˆ°æ—¥å¿—è¾“å‡ºï¼Œæ‰€å¯¹åº”çš„è¿è¡Œç¯å¢ƒå’Œæ–¹æ¡ˆä¸€ç›¸åŒã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ open /usr/<span class="built_in">local</span>/opt/jenkins/libexec/jenkins.war</span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤ç»“æŸï¼Œç¨ç­‰ç‰‡åˆ»(åˆå§‹åŒ–ç›¸å…³ç›®å½•ã€ç¯å¢ƒ)ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€<a href="http://10.12.12.10:8080/" target="_blank" rel="noopener">http://10.12.12.10:8080</a>å°±å¯ä»¥æ­£å¸¸åŠ è½½å•¦ï½</p>
<h3 id="æ–¹æ¡ˆä¸‰"><a href="#æ–¹æ¡ˆä¸‰" class="headerlink" title="æ–¹æ¡ˆä¸‰"></a>æ–¹æ¡ˆä¸‰</h3><p>ä½¿ç”¨<code>brew</code>ç›´æ¥æŒ‚åœ¨åå°ä½œä¸ºæœåŠ¡è¿è¡Œèµ·æ¥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sudo brew services start jenkins</span><br></pre></td></tr></table></figure>

<p><code>brew</code>è¿˜æä¾›å…¶ä»–çš„å‚æ•°ï¼Œæ¯”å¦‚è¯´<code>restart</code>ã€<code>list</code>ã€<code>stop</code> ç­‰ç­‰ã€‚</p>
<p>æ­¤æ–¹æ¡ˆå’Œä¸Šé¢çš„è¿è¡Œç¯å¢ƒæ˜¯ä¸ä¸€æ ·çš„ï¼Œä¼šæœ‰äº›æƒé™çš„å·®åˆ«ã€‚</p>
<h3 id="å…¶ä»–æ–¹æ¡ˆ"><a href="#å…¶ä»–æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–æ–¹æ¡ˆ"></a>å…¶ä»–æ–¹æ¡ˆ</h3><p>ä½¿ç”¨<code>launchctl</code>ã€<code>nohup</code> ç­‰å…¶ä»–æ–¹æ¡ˆè¿›è¡Œçš„åå°è¿è¡Œï¼ŒåŒæ–¹æ¡ˆä¸‰å·®ä¸å¤šã€‚</p>
<p>éœ€è¦è¯´çš„æ˜¯<code>launchctl</code>æ˜¯macOSä¸‹ç³»ç»Ÿæä¾›çš„åå°è¿è¡Œæ–¹æ¡ˆï¼Œ<code>brew</code>ç­‰ï¼Œå‡æ¥è‡ªäºæ­¤ã€‚</p>
<p>åœ¨<code>launchctl</code>åå°ä¸­éœ€è¦ä¸€ä¸ª<code>plist</code>ï¼Œä½†æ˜¯<code>brew</code>å·²ç»åšå¥½äº†ï¼Œæ”¾ç½®åœ¨<code>~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist</code>ã€‚éœ€è¦è¯´çš„æ˜¯<code>launchctl</code>æ˜¯macOSä¸‹ç³»ç»Ÿæä¾›çš„åå°è¿è¡Œæ–¹æ¡ˆï¼Œ<code>brew</code>ç­‰ï¼Œå‡æ¥è‡ªäºæ­¤ï¼Œå…·ä½“çš„é…ç½®å‚æ•°éƒ½å’Œ<code>launchctl</code>ä¸€æ ·çš„ï¼Œæœç´¢ä¸€ä¸‹å¾ˆå¤šã€‚<code>brew</code>ä¸ºæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ä¸€ä¸ªï¼Œç›´æ¥ä½¿ç”¨<code>æ–¹æ¡ˆä¸‰</code>å°±è¡Œã€‚</p>
<p>å…·ä½“æ“ä½œå¯ä»¥Googleä¸€ä¸‹ï¼Œå¾ˆå¤šçš„ï½</p>
<h2 id="å®‰è£…å®Œæˆåçš„é…ç½®"><a href="#å®‰è£…å®Œæˆåçš„é…ç½®" class="headerlink" title="å®‰è£…å®Œæˆåçš„é…ç½®"></a>å®‰è£…å®Œæˆåçš„é…ç½®</h2><p>åœ¨Jenkinsåˆå§‹åŒ–å®Œæ¯•ä¸ºäº†éªŒè¯ç®¡ç†å‘˜èº«ä»½ï¼Œéœ€è¦å°†Jenkinsæœºå™¨ä¸Šçš„ä¸€ä¸ªå­—ç¬¦ä¸²è¾“å…¥åˆ°<a href="http://10.12.12.10:8080/" target="_blank" rel="noopener">http://10.12.12.10:8080</a>ä¸­è¿›è¡ŒéªŒè¯ï¼Œå…·ä½“æ–‡ä»¶ç›®å½•åœ¨è¾“å…¥çš„ç•Œé¢å°±èƒ½çœ‹åˆ°ï¼Œä¸è¦å¤§æƒŠå°æ€ªã€‚</p>
<p>ä¹‹åå¼€å§‹é€‰æ‹©å®‰è£…æ’ä»¶ã€‚è¿™é‡Œå¯ä»¥é€‰æ‹©æ¨èçš„ï½ï½ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å‹¾é€‰ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œç›´æ¥é€‰æ‹©æ¨èçš„æ–¹æ¡ˆè¿›è¡Œå®‰è£…ã€‚</p>
<p>ç»è¿‡æ¼«é•¿çš„ç­‰å¾…ï¼Œç»ˆäºå°†æ’ä»¶å®‰è£…å®Œæ¯•ï¼Œå¹¶å¯åŠ¨äº†èµ·æ¥ï½ï½</p>
<p>Jenkinsæƒé™ï¼Œå—¯ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œå¯ä»¥å»<code>ç³»ç»Ÿç®¡ç† -&gt; Configure Global Security</code>  ä¸­è¿›è¡Œè®¾ç½®ã€‚</p>
<p>æ¥ä¸‹æ¥å¼€å§‹å»é…ç½®å·¥ç¨‹å§ï¼ä¼ é€é—¨ï¼š<a href="../ios-automation-jenkins-build">iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹</a></p>
<h2 id="å¯èƒ½ä¼šç¢°åˆ°çš„é”™è¯¯"><a href="#å¯èƒ½ä¼šç¢°åˆ°çš„é”™è¯¯" class="headerlink" title="å¯èƒ½ä¼šç¢°åˆ°çš„é”™è¯¯"></a>å¯èƒ½ä¼šç¢°åˆ°çš„é”™è¯¯</h2><h3 id="Error-Permission-denied"><a href="#Error-Permission-denied" class="headerlink" title="Error: Permission denied - ***"></a>Error: Permission denied - ***</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ brew services start jenkins</span><br><span class="line">Error: Permission denied - ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist</span><br></pre></td></tr></table></figure>
<p>è¿™ç§å¾ˆæ˜æ˜¾<code>Permission denied</code>ï¼Œåœ¨å‘½ä»¤è¡Œå‰æ·»åŠ <code>sudo</code>ï¼Œç„¶åè¾“å…¥å¯†ç å³å¯ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sudo brew services start jenkins</span><br></pre></td></tr></table></figure>

<h3 id="æ–¹æ¡ˆäºŒåçš„åœ°å€å“ªé‡Œæ¥çš„ï¼Ÿ"><a href="#æ–¹æ¡ˆäºŒåçš„åœ°å€å“ªé‡Œæ¥çš„ï¼Ÿ" class="headerlink" title="æ–¹æ¡ˆäºŒåçš„åœ°å€å“ªé‡Œæ¥çš„ï¼Ÿ"></a><code>æ–¹æ¡ˆäºŒ</code>åçš„åœ°å€å“ªé‡Œæ¥çš„ï¼Ÿ</h3><p>è¿™é‡Œæ¨èçš„å®‰è£…æ–¹æ¡ˆæ˜¯<code>brew install jenkins</code></p>
<p>é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ‰¾åˆ°<code>brew</code>å®‰è£…çš„ä½ç½®</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ brew services list</span><br><span class="line">Name       Status  User Plist</span><br><span class="line">beanstalkd stopped</span><br><span class="line">influxdb   stopped</span><br><span class="line">jenkins    started keith  ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist</span><br><span class="line">nginx      stopped</span><br><span class="line">sonarqube  stopped</span><br><span class="line">FDDdeiMac:~ FDD$ cat ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist</span><br><span class="line">...</span><br><span class="line">&lt;string&gt;/usr/<span class="built_in">local</span>/opt/jenkins/libexec/jenkins.war&lt;/string&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="ç»™Jenkinsç»‘å®šä¸€ä¸ªIP"><a href="#ç»™Jenkinsç»‘å®šä¸€ä¸ªIP" class="headerlink" title="ç»™Jenkinsç»‘å®šä¸€ä¸ªIP"></a>ç»™Jenkinsç»‘å®šä¸€ä¸ªIP</h3><p>è®²é“ç†è¿™ä¸ªä¸åº”è¯¥åœ¨è¿™é‡ŒèŠçš„ğŸ˜‚ï¼Œä¸è¿‡è¿˜æ˜¯è¯´ä¸€ä¸‹å§ã€‚ã€‚</p>
<p>ä¸€èˆ¬å±€åŸŸç½‘ä¸­éƒ½æ˜¯ç›´æ¥è‡ªåŠ¨è·å–IPä¿¡æ¯çš„ä¹Ÿå°±æ˜¯DHCPï¼Œä½†æ˜¯Jenkinsæ€»æ”¹IPä¹Ÿä¸å¥½ã€‚ã€‚äºæ˜¯ç»‘å®šä¸€ä¸‹å§ã€‚</p>
<p>åœ¨mac ä¸­ <code>ç³»ç»Ÿåå¥½è®¾ç½® -&gt; ç½‘ç»œ</code> è®°å½•ä¸‹æ¥å½“å‰è·å–åˆ°çš„IPã€‚</p>
<p>åœ¨<code>é«˜çº§</code>ä¸­å°†<code>ä½¿ç”¨DHCP</code>ä¿®æ”¹ä¸º<code>ä½¿ç”¨DHCP(æ‰‹åŠ¨è®¾å®šåœ°å€)</code>ï¼Œç„¶åå°†ä¸Šé¢çš„åœ°å€å¡«è¿›å»å°±å¥½å•¦ï½</p>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–çš„åœ°å€ï¼Œåªè¦åˆ«äººæ²¡æœ‰å ç”¨ğŸ˜‚ï¼Œä½ å¼€å¿ƒå°±å¥½ï½</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹</title>
    <url>/post/ios-automation-jenkins-build/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><ul>
<li><a href="../ios-automation-jenkins-configuration">iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º</a></li>
<li><a href="../ios-automation-jenkins-build">iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹</a></li>
</ul>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Jenkinsç¯å¢ƒå·²æ­å»ºå¥½ï¼Œç°åœ¨æˆ‘ä»¬æ¥å¼€å§‹æ„‰å¿«çš„ä¸ºiOSæ‰“åŒ…å§ï½</p>
<p>ä»è¿™ä¸ªæ–‡ç« ä¸­ä½ å°†è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>åœ¨Jenkinsåˆ›å»ºå·¥ç¨‹</li>
<li>buildå‡ºipa</li>
<li>å°†ipaä¸Šä¼ è‡³fir</li>
<li>é’‰é’‰æœºå™¨äººç¾¤é€šçŸ¥</li>
<li>å°†dsymä¸Šä¼ è‡³bugly</li>
</ul>
<a id="more"></a>

<h2 id="è„šæœ¬ç¯å¢ƒå®‰è£…"><a href="#è„šæœ¬ç¯å¢ƒå®‰è£…" class="headerlink" title="è„šæœ¬ç¯å¢ƒå®‰è£…"></a>è„šæœ¬ç¯å¢ƒå®‰è£…</h2><p>è¿™é‡Œå¤§å¤šæ•°æ“ä½œéƒ½æ˜¯ç”¨è„šæœ¬æ¥è¿›è¡Œçš„ï¼Œä¸ä¸ºåˆ«çš„ï¼Œå°±ä¸ºè‡ªç”±å’Œä»¥åï½</p>
<h3 id="fastlane"><a href="#fastlane" class="headerlink" title="fastlane"></a>fastlane</h3><p>æ­¤ä¹ƒè‡ªåŠ¨åŒ–ç¥å™¨ã€‚<a href="https://docs.fastlane.tools/" target="_blank" rel="noopener">æ–‡æ¡£åœ¨æ­¤</a>ã€‚<a href="https://github.com/fastlane/fastlane" target="_blank" rel="noopener">å¼€æºå“Ÿï½</a></p>
<p>æ­¤å¤„ä¸»è¦ç”¨æ¥ç¼–è¯‘ã€æ‰“åŒ…ã€‚</p>
<p>å®‰è£…æ–¹æ³•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ brew cask install fastlane</span><br></pre></td></tr></table></figure>

<p>æ­¤ç¥å™¨é™¤äº†ä¸Šè¿°åŠŸèƒ½ï¼Œè¿˜æä¾›å¾ˆå¤šå¾ˆå¤šå¾ˆå¤šå¾ˆå¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç¥é©¬çš„éƒ½æ”¯æŒã€‚éœ€è¦çš„å¯ä»¥å»æ–‡æ¡£é‡Œé¢ç¿»ç¿»ã€‚</p>
<p>åœ¨Xcode9 æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬2.14.1æ‰“åŒ…å‡ºé—®é¢˜äº†ã€‚ã€‚å…·ä½“åœ¨è¿™é‡Œè¯¦è§<a href="../debug-xcode9-build-ipa">Xcode9ç¼–è¯‘å¤±è´¥</a>ã€‚äºæ˜¯å‘¼é‡‡ç”¨äº†<code>xcodebuild</code>è¿›è¡Œæ‰“åŒ…</p>
<h3 id="fir-im-cli"><a href="#fir-im-cli" class="headerlink" title="fir.im-cli"></a>fir.im-cli</h3><p><a href="https://fir.im/" target="_blank" rel="noopener">fir.im</a>æä¾›çš„åº”ç”¨å†…æµ‹æ‰˜ç®¡å·¥å…·ã€‚<a href="https://github.com/FIRHQ/fir-cli/blob/master/README.md" target="_blank" rel="noopener">å¼€æºå®˜ç½‘</a>ã€‚</p>
<p>å®‰è£…æ–¹æ³•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ gem install fir-cli</span><br></pre></td></tr></table></figure>

<p>æ­¤å·¥å…·ä¹Ÿæä¾›æ‰“åŒ…ipaã€apkã€ä¸Šä¼ ç¬¦å·è¡¨è‡³BugHDã€ç­‰åŠŸèƒ½ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹©äº†<code>fastlane gym</code></p>
<p>ä¸Šä¼ åŠ é€Ÿï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sh -c <span class="string">"<span class="variable">$(curl -sSL https://gist.githubusercontent.com/trawor/5dda140dee86836b8e60/raw/turbo-qiniu.sh)</span>"</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ åŠ é€Ÿä»£ç å·²ç»<a href="http://blog.fir.im/turbo-qiniu/" target="_blank" rel="noopener">å¼€æºè‡³æ­¤</a>ã€‚</p>
<p><a href="http://bughd.com/" target="_blank" rel="noopener">BugHD</a>: å·²åœæ­¢çº¿ä¸Šå…è´¹æœåŠ¡ï¼Œå¼€å§‹å–ç§æœ‰éƒ¨ç½²äº†ã€‚</p>
<p>å¦å¤–ï¼Œfir ä¹Ÿæœ‰<a href="http://blog.fir.im/jenkins/" target="_blank" rel="noopener">Jenkinsæ’ä»¶</a>ï¼Œä½†æ˜¯è¿™é‡Œé€‰æ‹©è„šæœ¬æ–¹å¼ã€‚</p>
<h2 id="æ’ä»¶å®‰è£…"><a href="#æ’ä»¶å®‰è£…" class="headerlink" title="æ’ä»¶å®‰è£…"></a>æ’ä»¶å®‰è£…</h2><p>æ‰€æœ‰çš„æ’ä»¶å¯ä»¥åœ¨<code>ç³»ç»Ÿç®¡ç† -&gt; æ’ä»¶ç®¡ç†</code>ä¸­è¿›è¡Œå®‰è£…ã€å¸è½½ã€é™çº§ã€æ›´æ–°ã€ç­‰æ“ä½œã€‚</p>
<p>ç¡®ä¿ä»¥ä¸‹æ’ä»¶å·²ç»è¢«å®‰è£…ï¼š</p>
<ul>
<li>æºä»£ç ç®¡ç†ï¼š<a href="https://wiki.jenkins.io/display/JENKINS/Git+Plugin" target="_blank" rel="noopener">Git Plugin</a></li>
<li>ç¼–è¯‘è„šæœ¬ç¯å¢ƒå˜é‡ï¼š<a href="http://wiki.hudson-ci.org/display/HUDSON/Tool+Environment+Plugin" target="_blank" rel="noopener">Tool Environment Plugin</a></li>
</ul>
<p>å—¯ï¼Œå¼€å§‹åˆ›å»ºå·¥ç¨‹ï¼Œç„¶åé…ç½®æ‰“åŒ…å§ï¼</p>
<h2 id="å·¥ç¨‹ç›¸å…³é…ç½®"><a href="#å·¥ç¨‹ç›¸å…³é…ç½®" class="headerlink" title="å·¥ç¨‹ç›¸å…³é…ç½®"></a>å·¥ç¨‹ç›¸å…³é…ç½®</h2><p>å·¦ä¾§çš„<code>æ–°å»º(New Item)</code>æˆ‘å°±ä¸è¯´äº†å§ï½ï¼Œç‚¹å‡»è¾“å…¥é¡¹ç›®åå­—ï¼Œç„¶åé€‰æ‹©ç¬¬ä¸€ä¸ª<code>æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®</code>å°±è¡Œå•¦ï½ï½</p>
<p>æ­¤å¤„é¡¹ç›®åå­—æš‚ä¸”æˆä¸º<code>test</code>ã€‚è¿™é‡Œåªè¯´ä¸€äº›æ¯”è¾ƒé‡è¦çš„ï¼Œæ²¡æœ‰æ´»ä¸æˆçš„é‚£ç§é…ç½®ã€‚åˆ«çš„è‡ªå·±ç ”ç©¶ä¸€ä¸‹æˆ–è€…ç‚¹å‡»å³ä¾§â“å°±èƒ½çœ‹åˆ°ä»‹ç»ã€‚</p>
<h3 id="æºç ç®¡ç†"><a href="#æºç ç®¡ç†" class="headerlink" title="æºç ç®¡ç†"></a>æºç ç®¡ç†</h3><p>æ­¤å¤„ç‚¹å‡»<code>Git</code>ï¼Œå±•å¼€ä¹‹åè¾“å…¥<code>Repository URL</code>å³å¯ã€‚</p>
<p><code>Repository URL</code>è¾“å…¥å®Œæ¯•ä¹‹åç‚¹å‡»åˆ«å¤„ï¼ŒJenkinsçš„Gitæ’ä»¶ä¼šè‡ªåŠ¨æ ¡éªŒè¯¥URLæ˜¯å¦èƒ½å¤Ÿcloneä¸‹æ¥ä»£ç ã€‚å‡ºç°çº¢è‰²å°±è‡ªå·±æ ¹æ®é”™è¯¯ä¿®æ”¹ä¸€ä¸‹å’¯ã€‚ã€‚</p>
<p>å¦å¤–æ­¤å¤„æ”¯æŒ<code>ssh</code> çš„æ–¹å¼ï¼Œå¤§è‡´æ ·å¼ä¸ºï¼š<code>ssh://sunjigang@github.com:29418/projects/aaa</code>ã€‚</p>
<p><code>Branches to build</code> å†™ä¸Šä½ çš„æ„å»ºåˆ†æ”¯ï½ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚æ¥ï¼Œ<code>master</code>ä¸€èˆ¬ä¸ºä»“åº“çš„é»˜è®¤åˆ†æ”¯ã€‚</p>
<h3 id="æ„å»ºè§¦å‘å™¨"><a href="#æ„å»ºè§¦å‘å™¨" class="headerlink" title="æ„å»ºè§¦å‘å™¨"></a>æ„å»ºè§¦å‘å™¨</h3><p>æ­¤å¤„è¡¨ç¤ºè¯¥é¡¹ç›®çš„æ„å»ºè§¦å‘æ¡ä»¶ã€‚ï¼ˆå¯é€‰ï¼‰</p>
<p>æˆ‘ä»¬è¿™é‡Œè¯´ä¸€ä¸‹<code>Poll SCM</code>ï¼š</p>
<p>å®šæ—¶æ£€æŸ¥æºç å˜æ›´ã€‚æ¡ä»¶æ˜¯ ä¸€å®šè¦é…ç½®<code>Git</code>è¿™æ ·çš„æºç ç®¡ç†ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<ul>
<li><code>H/15 * * * *</code>ï¼šæ¯15åˆ†é’Ÿæ„å»ºä¸€æ¬¡</li>
<li><code>0 2 * * *</code>ï¼š æ¯å¤©2:00æ„å»ºä¸€æ¬¡</li>
</ul>
<h3 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><p>æ­¤å¤„ä¸ºæ„å»ºçš„æ ¸å¿ƒğŸ˜‚ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¸ºäº†è‡ªç”±ï¼Œæ­¤å¤„å…¨éƒ¨ä½¿ç”¨<code>shell</code>è„šæœ¬ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å·¥ç¨‹å</span></span><br><span class="line">workspace=<span class="string">'xxx.xcworkspace'</span></span><br><span class="line"><span class="comment"># æ„å»ºscheme</span></span><br><span class="line">scheme=<span class="string">'xxx'</span></span><br><span class="line"><span class="comment"># æ‰“åŒ…ç±»å‹ï¼šapp-store, ad-hoc, package, enterprise, development, and developer-id.</span></span><br><span class="line">export_method=<span class="string">'enterprise'</span></span><br><span class="line"><span class="comment"># firçš„tokenï¼Œåœ¨fir-&gt;ç”¨æˆ·-&gt;token è·å–</span></span><br><span class="line">fir_token=<span class="string">'c5077e0368888b9750ae848b9fe00***'</span></span><br><span class="line"><span class="comment"># firä¸Šä¼ çŸ­é“¾æ¥ï¼Œæ•ˆæœä¸º https://fir.im/xxx</span></span><br><span class="line">fir_url=<span class="string">'xxx'</span></span><br><span class="line"><span class="comment"># é’‰é’‰æœºå™¨äººtoken</span></span><br><span class="line">dingtalk_token=<span class="string">'6d09e43ddc62e540be914ff2e901e28b921d55c5ad457f6f3571f9f881287***'</span></span><br><span class="line"><span class="comment"># é’‰é’‰æœºå™¨äººå‘é€çš„å†…å®¹</span></span><br><span class="line">dingtalk_content=<span class="string">"iOSXXXå·²ç»ä¸Šä¼ è‡³ http://fir.im/<span class="variable">$&#123;fir_url&#125;</span> ,å§å•¦å§å•¦å§å•¦ï½"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»º</span></span><br><span class="line">fastlane gym</span><br><span class="line">    --workspace <span class="variable">$workspace</span> \</span><br><span class="line">    --scheme <span class="variable">$scheme</span> \</span><br><span class="line">    --export_method <span class="variable">$export_method</span> \</span><br><span class="line">    clean</span><br><span class="line"></span><br><span class="line"><span class="comment"># fir</span></span><br><span class="line">ipa=$(<span class="built_in">pwd</span>)/$(ls *.ipa)</span><br><span class="line">git <span class="built_in">log</span> -10 &gt; git.log</span><br><span class="line">fir p <span class="variable">$ipa</span> -T <span class="variable">$fir_token</span> -s <span class="variable">$fir_url</span> -c git.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># é’‰é’‰é€šçŸ¥</span></span><br><span class="line">curl <span class="string">"https://oapi.dingtalk.com/robot/send?access_token=<span class="variable">$&#123;dingtalk_token&#125;</span>"</span> -H <span class="string">'Content-Type: application/json'</span>    -d <span class="string">'</span></span><br><span class="line"><span class="string">    &#123;"msgtype": "text",</span></span><br><span class="line"><span class="string">        "text": &#123;</span></span><br><span class="line"><span class="string">            "content":$&#123;dingtalk_content&#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;'</span></span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ å·²ç»å®Œæˆäº†æ‰“åŒ…ã€ä¸Šä¼ firã€é’‰é’‰æœºå™¨äººé€šçŸ¥ã€‚</p>
<p>ä¸Šè¿°è„šæœ¬åªæ˜¯é…ç½®çš„ä¾‹å­ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚ï¼Œè‡ªå·±ç¼–å†™å’Œé…ç½®ã€‚ç‰¹åˆ«æ˜¯</p>
<ul>
<li><code>.xcworkspace</code>çš„ä½ç½®ï¼Œè¦æ‰¾æ¸…æ¥šå‘€</li>
<li><code>scheme</code>æ— æ³•æ‰¾åˆ°æ˜¯å› ä¸ºä½ åœ¨æäº¤ä»£ç çš„æ—¶å€™æ²¡æœ‰å°†å…¶è®¾ç½®ä¸ºshared</li>
<li><code>fastlane gym</code> æ”¯æŒå¾ˆå¤šå‚æ•°ï¼Œæ˜¯å¯¹<code>xcodebuild</code>çš„å°è£…ï¼Œ<a href="https://github.com/fastlane/fastlane/tree/master/gym" target="_blank" rel="noopener">æºç åŠæ–‡æ¡£åœ¨æ­¤</a></li>
</ul>
<h3 id="ä¸Šä¼ dSYMè‡³Bugly"><a href="#ä¸Šä¼ dSYMè‡³Bugly" class="headerlink" title="ä¸Šä¼ dSYMè‡³Bugly"></a>ä¸Šä¼ dSYMè‡³Bugly</h3><p>è¿™ä¸ªè¿˜æ˜¯æœ‰ç‚¹ç‚¹å¤æ‚çš„ï¼Œå› ä¸ºbuglyå¹¶æœªæä¾›å®Œæ•´çš„cliå·¥å…·é“¾ï¼Œéœ€è¦æ‰‹åŠ¨è·‘jaråŒ…ã€‚ä¸è¿‡éƒ½æ˜¯å¯ä»¥å®Œæˆçš„ã€‚</p>
<p>ä¸ºäº†éš”ç¦»å¼€æ‰“åŒ…å’Œä¸Šä¼ ï¼Œè¿™é‡Œåœ¨Jenkinsä¸Šæ–°å»ºä¸€ä¸ªé¡¹ç›®ç”¨æ¥ä¸Šä¼ dSYM</p>
<p>å…¶ä¸­éœ€è¦è¡”æ¥çš„åœ°æ–¹å°±æ˜¯ä¸Šé¢çš„è¾“å‡ºè¦ä½œä¸ºè¿™ä¸ªçš„è¾“å‡ºã€‚æ‰€ä»¥éœ€è¦å‰åå¯¹åº”ä½ç½®ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è·¯å¾„ä¸»è¦ç”¨æ¥æå–Info.plistä»¥åŠdsymæ–‡ä»¶</span></span><br><span class="line">path=<span class="string">'/Users/FDD/.jenkins/workspace/fdd-ios-app/fdd-app-ios/Fangduoduo'</span></span><br><span class="line"><span class="comment"># scheme name</span></span><br><span class="line">scheme=<span class="string">'Fangduoduo_ent'</span></span><br><span class="line"><span class="comment"># ipa bundleId</span></span><br><span class="line">package=<span class="string">'xx.xx.com'</span></span><br><span class="line"><span class="comment"># bugly id</span></span><br><span class="line">bugly_id=<span class="string">'9xxx'</span></span><br><span class="line"><span class="comment"># bugly key</span></span><br><span class="line">bugly_key=<span class="string">'wHzxcxxx'</span></span><br><span class="line"></span><br><span class="line">rm -rf *dSYM*</span><br><span class="line">cp <span class="variable">$&#123;path&#125;</span>/Fangduoduo/Fangduoduo_ent-Info.plist ./Info.plist</span><br><span class="line">cp -rf <span class="variable">$&#123;path&#125;</span>/build/*.xcarchive/dSYMs .</span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------ post dsym ------------ #</span></span><br><span class="line"></span><br><span class="line">app_infoplist_path=<span class="string">'Info.plist'</span></span><br><span class="line">version=$(/usr/libexec/PlistBuddy -c <span class="string">"print CFBundleVersion"</span> <span class="variable">$&#123;app_infoplist_path&#125;</span>)</span><br><span class="line"></span><br><span class="line">java -jar ./bugly/buglySymboliOS.jar \</span><br><span class="line">	-i dSYMs/<span class="variable">$&#123;scheme&#125;</span>.app.dSYM \</span><br><span class="line">    -dsym \</span><br><span class="line">    -u \</span><br><span class="line">    -id <span class="variable">$&#123;bugly_id&#125;</span> \</span><br><span class="line">    -key <span class="variable">$&#123;bugly_key&#125;</span> \</span><br><span class="line">    -package <span class="variable">$&#123;package&#125;</span> \</span><br><span class="line">    -version <span class="variable">$&#123;version&#125;</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># @bugly jaræ‰§è¡Œçš„æ—¶å€™è¿”å›çŠ¶æ€ç æœ‰é—®é¢˜ã€‚å·²åé¦ˆï¼Œä½†æ˜¯ä¸è§ä¿®æ”¹ã€‚ã€‚</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># ------------ UUID ------------ #</span></span><br><span class="line"></span><br><span class="line">unzip -o ./dSYMs/<span class="variable">$&#123;scheme&#125;</span>.app.dSYM.zip</span><br><span class="line">xcrun dwarfdump --uuid ./<span class="variable">$&#123;scheme&#125;</span> &gt;&gt; ./uuids-<span class="variable">$&#123;version&#125;</span>.txt</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—è¯´çš„æ˜¯ï¼Œå¦‚æœä¸Šé¢çš„æŠ¥é”™ï¼Œé‚£ä¹ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯è·¯å¾„ä»€ä¹ˆçš„å†™é”™äº†ã€‚ã€‚ã€‚</p>
<p>å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥åœ¨<a href="../../about">å…³äº</a>ä¸­æ‰¾åˆ°æˆ‘ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title>Xcode9ç¼–è¯‘å¤±è´¥</title>
    <url>/post/debug-xcode9-build-ipa/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="é”™è¯¯è¾“å‡º"><a href="#é”™è¯¯è¾“å‡º" class="headerlink" title="é”™è¯¯è¾“å‡º"></a>é”™è¯¯è¾“å‡º</h2><blockquote>
<p>error: exportArchive: â€œFangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features.</p>
</blockquote>
<blockquote>
<p>Error Domain=IDEProvisioningErrorDomain Code=9 â€œâ€Fangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features.â€ UserInfo={NSLocalizedDescription=â€Fangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features., NSLocalizedRecoverySuggestion=Add a profile to the â€œprovisioningProfilesâ€ dictionary in your Export Options property list.}</p>
</blockquote>
<a id="more"></a>

<h2 id="é”™è¯¯åŸå› "><a href="#é”™è¯¯åŸå› " class="headerlink" title="é”™è¯¯åŸå› "></a>é”™è¯¯åŸå› </h2><p>åœ¨å‡çº§Xcode9æ­£å¼ç‰ˆä¹‹åï¼ŒJenkinsä¹Ÿå°±å‡çº§äº†ï¼Œäºæ˜¯ä¹ç”¨åŸæ¥çš„å¥—è·¯æ‰“åŒ…ä¹‹åå°±æ˜¯ä¸Šé¢çš„é”™è¯¯ 5555â€¦</p>
<p>å¦‚æœä½¿ç”¨<code>xcodebuild</code>è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªä¼šå‘ç”Ÿåœ¨é€‰æ‹©è¯ä¹¦çš„æ­¥éª¤ï¼Œé”™è¯¯å¤§è‡´å°±æ˜¯è¿™æ ·ã€‚</p>
<p><code>$xcodebuild --help</code> å¯ä»¥çœ‹åˆ°ä¸€äº›ä¿¡æ¯ï¼Œè€Œä¸”åœ¨æœ€åè¿˜ç‰¹æ„æå‡ºäº†ä¸€ä¸ªâ€œ-exportOptionsPlistâ€å‚æ•°ã€‚å…·ä½“å†…å®¹è§<code>xcodebuild --help</code></p>
<h2 id="è§£å†³é—®é¢˜æ‰æ˜¯å…³é”®"><a href="#è§£å†³é—®é¢˜æ‰æ˜¯å…³é”®" class="headerlink" title="è§£å†³é—®é¢˜æ‰æ˜¯å…³é”®"></a>è§£å†³é—®é¢˜æ‰æ˜¯å…³é”®</h2><ol>
<li><p>ä½¿ç”¨xcode9è¿›è¡Œä¸€æ¬¡<code>archive</code></p>
</li>
<li><p>é€‰æ‹©ç›¸å…³è¯ä¹¦å•Šç¥é©¬çš„ï¼Œä¿æŒ<code>thinning</code>ä¸å˜å°±å¥½</p>
</li>
<li><p>å¯¼å‡º</p>
</li>
<li><p>å¯¼å‡ºç›®å½•æœ‰ä¸€ä¸ª<code>ExportOptionsPlist.plist</code>ï¼Œè¿™ä¸ªå°±æ˜¯æ‰“åŒ…æ—¶å€™éœ€è¦çš„plist</p>
</li>
</ol>
<h2 id="è„šæœ¬æ„å»º"><a href="#è„šæœ¬æ„å»º" class="headerlink" title="è„šæœ¬æ„å»º"></a>è„šæœ¬æ„å»º</h2><p><code>ipa</code>å³ä¸ºç›®æ ‡å˜é‡ï¼Œå…·ä½“çš„å‚çœ‹<a href="../build-ipa-sh">æ‰“åŒ…è„šæœ¬</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">rm -rf ./build/*</span><br><span class="line">cat &lt;&lt; EOF &gt; ./build/exportOptionsPlist.plist</span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC <span class="string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;</span><br><span class="line">&lt;plist version=<span class="string">"1.0"</span>&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">    &lt;key&gt;compileBitcode&lt;/key&gt;</span><br><span class="line">    &lt;<span class="literal">true</span>/&gt;</span><br><span class="line">    &lt;key&gt;method&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;enterprise&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;provisioningProfiles&lt;/key&gt;</span><br><span class="line">    &lt;dict&gt;</span><br><span class="line">        &lt;key&gt;ershoufanglzg.fangdd.com&lt;/key&gt;</span><br><span class="line">        &lt;string&gt;ershoufanglzg_dis&lt;/string&gt;</span><br><span class="line">    &lt;/dict&gt;</span><br><span class="line">    &lt;key&gt;signingCertificate&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;iPhone Distribution&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;signingStyle&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;manual&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;stripSwiftSymbols&lt;/key&gt;</span><br><span class="line">    &lt;<span class="literal">true</span>/&gt;</span><br><span class="line">    &lt;key&gt;teamID&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;J3B467DURT&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;thinning&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;&amp;lt;none&amp;gt;&lt;/string&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">xcodebuild -archivePath <span class="string">"./build/xxx.xcarchive"</span> -workspace Fangduoduo.xcworkspace -sdk iphoneos -scheme <span class="string">"Fangduoduo_ent"</span> -configuration <span class="string">"Release Inhouse"</span> archive</span><br><span class="line">xcodebuild -exportArchive -archivePath <span class="string">"./build/xxx.xcarchive"</span> -exportPath <span class="string">"./build/"</span> -exportOptionsPlist ./build/exportOptionsPlist.plist</span><br><span class="line"></span><br><span class="line">ipa=$(<span class="built_in">pwd</span>)/$(ls ./build/*.ipa)</span><br></pre></td></tr></table></figure>

<h2 id="xcodebuild-â€“help"><a href="#xcodebuild-â€“help" class="headerlink" title="xcodebuild â€“help"></a>xcodebuild â€“help</h2><blockquote>
<p>Available keys for -exportOptionsPlist:</p>
</blockquote>
<blockquote>
<p>compileBitcode : Bool</p>
</blockquote>
<blockquote>
<p>For non-App Store exports, should Xcode re-compile the app from bitcode? Defaults to YES.</p>
</blockquote>
<blockquote>
<p>embedOnDemandResourcesAssetPacksInBundle : Bool</p>
</blockquote>
<blockquote>
<p>For non-App Store exports, if the app uses On Demand Resources and this is YES, asset packs are embedded in the app bundle so that the app can be tested without a server to host asset packs. Defaults to YES unless onDemandResourcesAssetPacksBaseURL is specified.</p>
</blockquote>
<blockquote>
<p>iCloudContainerEnvironment : String</p>
</blockquote>
<blockquote>
<p>If the app is using CloudKit, this configures the â€œcom.apple.developer.icloud-container-environmentâ€ entitlement. Available options vary depending on the type of provisioning profile used, but may include: Development and Production.</p>
</blockquote>
<blockquote>
<p>installerSigningCertificate : String</p>
</blockquote>
<blockquote>
<p>For manual signing only. Provide a certificate name, SHA-1 hash, or automatic selector to use for signing. Automatic selectors allow Xcode to pick the newest installed certificate of a particular type. The available automatic selectors are â€œMac Installer Distributionâ€ and â€œDeveloper ID Installerâ€. Defaults to an automatic certificate selector matching the current distribution method.</p>
</blockquote>
<blockquote>
<p>manifest : Dictionary</p>
</blockquote>
<blockquote>
<p>For non-App Store exports, users can download your app over the web by opening your distribution manifest file in a web browser. To generate a distribution manifest, the value of this key should be a dictionary with three sub-keys: appURL, displayImageURL, fullSizeImageURL. The additional sub-key assetPackManifestURL is required when using on-demand resources.</p>
</blockquote>
<blockquote>
<p>method : String</p>
</blockquote>
<blockquote>
<p>Describes how Xcode should export the archive. Available options: app-store, package, ad-hoc, enterprise, development, developer-id, and mac-application. The list of options varies based on the type of archive. Defaults to development.</p>
</blockquote>
<blockquote>
<p>onDemandResourcesAssetPacksBaseURL : String</p>
</blockquote>
<blockquote>
<p>For non-App Store exports, if the app uses On Demand Resources and embedOnDemandResourcesAssetPacksInBundle isnâ€™t YES, this should be a base URL specifying where asset packs are going to be hosted. This configures the app to download asset packs from the specified URL.</p>
</blockquote>
<blockquote>
<p>provisioningProfiles : Dictionary</p>
</blockquote>
<blockquote>
<p>For manual signing only. Specify the provisioning profile to use for each executable in your app. Keys in this dictionary are the bundle identifiers of executables; values are the provisioning profile name or UUID to use.</p>
</blockquote>
<blockquote>
<p>signingCertificate : String</p>
</blockquote>
<blockquote>
<p>For manual signing only. Provide a certificate name, SHA-1 hash, or automatic selector to use for signing. Automatic selectors allow Xcode to pick the newest installed certificate of a particular type. The available automatic selectors are â€œMac App Distributionâ€, â€œiOS Developerâ€, â€œiOS Distributionâ€, â€œDeveloper ID Applicationâ€, and â€œMac Developerâ€. Defaults to an automatic certificate selector matching the current distribution method.</p>
</blockquote>
<blockquote>
<p>signingStyle : String</p>
</blockquote>
<blockquote>
<p>The signing style to use when re-signing the app for distribution. Options are manual or automatic. Apps that were automatically signed when archived can be signed manually or automatically during distribution, and default to automatic. Apps that were manually signed when archived must be manually signed during distribtion, so the value of signingStyle is ignored.</p>
</blockquote>
<blockquote>
<p>stripSwiftSymbols : Bool</p>
</blockquote>
<blockquote>
<p>Should symbols be stripped from Swift libraries in your IPA? Defaults to YES.</p>
</blockquote>
<blockquote>
<p>teamID : String</p>
</blockquote>
<blockquote>
<p>The Developer Portal team to use for this export. Defaults to the team used to build the archive.</p>
</blockquote>
<blockquote>
<p>thinning : String</p>
</blockquote>
<blockquote>
<p>For non-App Store exports, should Xcode thin the package for one or more device variants? Available options: <none> (Xcode produces a non-thinned universal app), <thin-for-all-variants> (Xcode produces a universal app and all available thinned variants), or a model identifier for a specific device (e.g. â€œiPhone7,1â€). Defaults to <none>.</p>
</blockquote>
<blockquote>
<p>uploadBitcode : Bool</p>
</blockquote>
<blockquote>
<p>For App Store exports, should the package include bitcode? Defaults to YES.</p>
</blockquote>
<blockquote>
<p>uploadSymbols : Bool</p>
</blockquote>
<blockquote>
<p>For App Store exports, should the package include symbols? Defaults to YES.</p>
</blockquote>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>DEBUG</tag>
      </tags>
  </entry>
  <entry>
    <title>DEBUG - Xcodeè§£æ.crash</title>
    <url>/post/debug-xcode8-analysis-crash-file/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>5æ­¥è§£æ<code>.crash</code>æ–‡ä»¶</p>
<a id="more"></a>

<h1 id="Xcodeä¸­è§£æ-crashæ–‡ä»¶"><a href="#Xcodeä¸­è§£æ-crashæ–‡ä»¶" class="headerlink" title="Xcodeä¸­è§£æ.crashæ–‡ä»¶"></a>Xcodeä¸­è§£æ.crashæ–‡ä»¶</h1><ol>
<li>å¯¼å‡º<code>x.crash</code>æ–‡ä»¶ï¼Œæ”¾ç½®åœ¨<code>ç›®å½•A</code>ä¸‹</li>
<li>å¤åˆ¶<code>å·¥ç¨‹å.app.dSYM</code>åˆ°<code>ç›®å½•A</code></li>
<li>é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿è¡Œ<code>export DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer</code></li>
<li>æ‹·è´è„šæœ¬æ–‡ä»¶ï¼Œè¿è¡Œ<code>cp /Applications/Xcode.app/Contents/SharedFrameworks/DVTFoundation.framework/Versions/A/Resources/symbolicatecrash ç›®å½•A</code></li>
<li>åˆ°<code>ç›®å½•A</code>è§£æï¼Œè¿è¡Œ<code>./symbolicatecrash x.crash å·¥ç¨‹å.app.dSYM &gt; è‡ªå®šä¹‰è¾“å‡ºç»“æœæ–‡ä»¶å</code></li>
</ol>
<h1 id="æ³¨"><a href="#æ³¨" class="headerlink" title="æ³¨"></a>æ³¨</h1><ul>
<li>è¿™é‡Œæœ€é‡è¦çš„æ˜¯<code>symbolicatecrash</code>æ–‡ä»¶ï¼Œ<code>symbolicatecrash</code>åœ¨æ‰‹è§£æä¸æ„ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>DEBUG</tag>
      </tags>
  </entry>
  <entry>
    <title>classçš„class-static-funcä½¿ç”¨Selfä½œä¸ºè¿”å›å€¼</title>
    <url>/post/class-static-func-return-self/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="ä¸€ä¸ªé—®é¢˜"><a href="#ä¸€ä¸ªé—®é¢˜" class="headerlink" title="ä¸€ä¸ªé—®é¢˜"></a>ä¸€ä¸ªé—®é¢˜</h1><ul>
<li>Xcode: Version 11.4.1 (11E503a)</li>
<li>swift: Swift 5</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MDButton</span>: <span class="title">UIButton</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸ºäº†æ›´æ¸…æ¥šå±•ç¤ºé—®é¢˜,ä»£ç ç»è¿‡ç²¾ç®€</span></span><br><span class="line">    <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">make</span>() -&gt; <span class="title">Self</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">MDButton</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç æ— æ³•ç¼–è¯‘:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ViewController.swift: error: cannot convert return expression of type &#39;MDButton&#39; to return type &#39;Self&#39;</span><br><span class="line">        return MDButton()</span><br><span class="line">               ^~~~~~~~~~</span><br><span class="line">                          as! Self</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h1 id="æŸ¥æ‰¾å…³äºSelfçš„æ–°ç‰¹æ€§"><a href="#æŸ¥æ‰¾å…³äºSelfçš„æ–°ç‰¹æ€§" class="headerlink" title="æŸ¥æ‰¾å…³äºSelfçš„æ–°ç‰¹æ€§"></a>æŸ¥æ‰¾å…³äº<code>Self</code>çš„æ–°ç‰¹æ€§</h1><p><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0068-universal-self.md" target="_blank" rel="noopener">Proposal: SE-0068</a>è¿™é‡Œæœ‰è¯´åˆ°å…³äºè¿™ä¸ª<code>Self</code>çš„é—®é¢˜.</p>
<p>å…¶ç›®çš„æ˜¯ä¸ºäº†è§£å†³:</p>
<blockquote>
<ul>
<li><code>dynamicType</code> remains an exception to Swiftâ€™s lowercased keywords rule. This change eliminates a special case thatâ€™s out of step with Swiftâ€™s new standards.</li>
<li><code>Self</code> is shorter and clearer in its intent. It mirrors <code>self</code>, which refers to the current instance.</li>
<li>It provides an easier way to access static members. As type names grow large, readability suffers. <code>MyExtremelyLargeTypeName.staticMember</code> is unwieldy to type and read.</li>
<li>Code using hardwired type names is less portable than code that automatically knows its type.</li>
<li>Renaming a type means updating any <code>TypeName</code> references in code.</li>
<li>Using <code>self.dynamicType</code> fights against Swiftâ€™s goals of concision and clarity in that it is both noisy and esoteric.</li>
</ul>
</blockquote>
<p>æ‰€ä»¥è¯´è¯¥é—®é¢˜åœ¨<code>struct</code>ä¸­å¹¶ä¸å­˜åœ¨,ä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä»£ç å®Œå…¨æ²¡æœ‰é—®é¢˜:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xxx</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">()</span></span> -&gt; <span class="type">Self</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> xxx()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ç©¶ç«Ÿå¦‚ä½•ä¿®æ”¹"><a href="#ç©¶ç«Ÿå¦‚ä½•ä¿®æ”¹" class="headerlink" title="ç©¶ç«Ÿå¦‚ä½•ä¿®æ”¹"></a>ç©¶ç«Ÿå¦‚ä½•ä¿®æ”¹</h1><p>å¥½å§,ä¸Šé¢æµ‹è¯•è¿‡è¿™å‡ ä¸ªå…³é”®å­—ä¹‹å,å°è¯•ä¿®æ”¹å‡½æ•°å†…çš„è¿”å›å¯¹è±¡å§.æ­¤æ—¶æ—¢ç„¶<code>Self</code>æ˜¯<code>dynamicType</code>,é‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>self</code>å»è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•å°±è¡Œäº†å§, äºæ˜¯:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MDButton2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">     <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">make</span>() -&gt; <span class="title">Self</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æˆ– return self.init()</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">Self</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ä¸€ç‚¹çœ‹æ³•"><a href="#ä¸€ç‚¹çœ‹æ³•" class="headerlink" title="ä¸€ç‚¹çœ‹æ³•"></a>ä¸€ç‚¹çœ‹æ³•</h1><p>é¦–å…ˆ, æ•´ä¸ªè¿‡ç¨‹(åŒ…æ‹¬Xcodeçš„æç¤º)ä¸ä½¿ç”¨<code>as!</code>çš„è§£å†³æ–¹æ¡ˆ, å¯¹,æˆ‘å°±æ˜¯é‚£ä¸ªåšå†³ä¸ä½¿ç”¨<code>as!</code>çš„äºº(åˆ·é¢˜é™¤å¤–).</p>
<p>ç„¶å, å¯ä»¥ç¿»ä¸€ä¸‹è¿™ä¸ª<code>Self</code>çš„å®ç°<a href="https://github.com/apple/swift/pull/22863" target="_blank" rel="noopener">apple/swift#22863</a>,å†…å®¹æ¯”è¾ƒå¤š.</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>DEBUG</tag>
        <tag>Swift</tag>
      </tags>
  </entry>
  <entry>
    <title>debug-_SwiftValue-unsignedIntegerValue</title>
    <url>/post/debug-SwiftValue-unsignedIntegerValue/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>crash:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let attr &#x3D; try? NSMutableAttributedString(data: data,</span><br><span class="line">                                          options: [NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType,</span><br><span class="line">                                                    NSCharacterEncodingDocumentAttribute: String.Encoding.utf8],</span><br><span class="line">                                          documentAttributes:nil)</span><br><span class="line">&#x2F;&#x2F; log:</span><br><span class="line">2017-04-17 14:04:38.140 [41275:463875] -[_SwiftValue unsignedIntegerValue]: unrecognized selector sent to instance 0x608000256620</span><br></pre></td></tr></table></figure>

<a id="more"></a>



<p>WTF! è¿™ä¸ªæ–¹æ³•å¯åŠ¨æ—¶ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œè¦å¼‚æ­¥ï¼Ÿ</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>DEBUG</tag>
      </tags>
  </entry>
  <entry>
    <title>DEBUG - swiftä¸­å–å‡ºé€šçŸ¥ä¸­çš„frame</title>
    <url>/post/debug-swift-notifa-frame/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>swiftä¸­è·å–OCå­˜å‚¨çš„Frameä¸¤ç§è·å–æ–¹æ¡ˆã€‚</p>
<a id="more"></a>

<h1 id="Swiftä¸‹åœ¨Notification-userInfoå–Frameï¼ŒDebugå’ŒReleaseæƒ…å†µä¸‹è¿˜ä¸ä¸€æ ·ã€‚ã€‚"><a href="#Swiftä¸‹åœ¨Notification-userInfoå–Frameï¼ŒDebugå’ŒReleaseæƒ…å†µä¸‹è¿˜ä¸ä¸€æ ·ã€‚ã€‚" class="headerlink" title="Swiftä¸‹åœ¨Notification.userInfoå–Frameï¼ŒDebugå’ŒReleaseæƒ…å†µä¸‹è¿˜ä¸ä¸€æ ·ã€‚ã€‚"></a>Swiftä¸‹åœ¨Notification.userInfoå–Frameï¼ŒDebugå’ŒReleaseæƒ…å†µä¸‹è¿˜ä¸ä¸€æ ·ã€‚ã€‚</h1><p>  â€“&gt;æ›´æ–°äº2016.12.1</p>
<p>  __ Version 8.1 (8B62) __</p>
  <figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">keyboardShow</span><span class="params">(sender: Notification)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> endFrame = <span class="type">CGRect</span>.zero        </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> frame = sender.userInfo?[<span class="type">UIKeyboardFrameEndUserInfoKey</span>] <span class="keyword">as</span>? <span class="type">CGRect</span> &#123;</span><br><span class="line">        endFrame = frame</span><br><span class="line">        <span class="comment">//  *** Debugæ˜¯å¯ä»¥é€šè¿‡çš„ã€‚ä½†æ˜¯Releaseæ— æ³•é€šè¿‡ã€‚</span></span><br><span class="line">        <span class="type">NSLog</span>(<span class="string">"&lt;&lt;&lt;INFO&gt;&gt;&gt;: as CGRect"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> value = sender.userInfo?[<span class="type">UIKeyboardFrameEndUserInfoKey</span>] <span class="keyword">as</span>? <span class="type">NSValue</span> &#123;</span><br><span class="line">        endFrame = value.cgRectValue</span><br><span class="line">        <span class="comment">//  *** Releaseä¼šå–å‡ºNSValue</span></span><br><span class="line">        <span class="type">NSLog</span>(<span class="string">"&lt;&lt;&lt;INFO&gt;&gt;&gt;: as NSValue"</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>  ç”±äºReleaseæ— æ³•è°ƒè¯•ï¼Œæ‰€ä»¥è´¹äº†ä¸å°‘åŠ²ã€‚é¦–å…ˆSwiftä¸­çš„å­—å…¸å·²ç»å¯ä»¥å­˜æ”¾å€¼ç±»å‹ï¼Œå…¶æœ¬èº«ä¹Ÿæ˜¯å€¼ç±»å‹ã€‚æ‰€ä»¥æˆ‘é¦–å…ˆé€‰æ‹©äº†ç¬¬ä¸€ç§å†™æ³•<code>let frame = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? CGRect</code>, ä½†æ˜¯Releaseæƒ…å†µä¸‹å´å‘ç”Ÿè§£åŒ…å¤±è´¥çš„æƒ…å†µã€‚æ‰€ä»¥é‡‡ç”¨OCçš„ä¼ ç»Ÿå†™æ³•<code>let value = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValue</code>ã€‚å°±èƒ½è§£æå‡ºæ¥ã€‚ä½†æ˜¯æ€»æ„Ÿè§‰OCçš„æ–¹æ³•ä¸å¤ŸswiftğŸ˜‚ã€‚ã€‚ã€‚</p>
<p>  æœ‰åŒäº‹ç›´æ¥å¼ºåˆ¶è½¬æ¢ä¸ºNSValueæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œäºæ˜¯ä¹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°ç›´æ¥æ ¡éªŒNSValueå°±å¯ä»¥ã€‚ä½†æ˜¯swiftä¸­æ„Ÿè§‰ä¸åº”è¯¥æœ‰è¿™ä¸ªè½¬æ¢äº†ï¼Œæ¯•ç«Ÿæœ¬èº«å°±å¯ä»¥å­˜å‚¨CGRect..</p>
<p>  çŒœæµ‹åŸå› ï¼šç›®å‰é˜¶æ®µSwiftçš„å­—å…¸å’ŒOCçš„å­—å…¸æ•°æ®ç»“æ„è¿˜å¹¶æœªå®Œå…¨ä¸€è‡´ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>DEBUG</tag>
      </tags>
  </entry>
  <entry>
    <title>DEBUG - UIView.h#190</title>
    <url>/post/debug-uiview-m-190/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>CRASH:<br><code>void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)()</code></p>
<a id="more"></a>

<h1 id="UIView-m-190-UIViewReportBrokenSuperviewChain"><a href="#UIView-m-190-UIViewReportBrokenSuperviewChain" class="headerlink" title="UIView.m:190 - UIViewReportBrokenSuperviewChain"></a>UIView.m:190 - UIViewReportBrokenSuperviewChain</h1><h2 id="å¼‚å¸¸ä¿¡æ¯ï¼š"><a href="#å¼‚å¸¸ä¿¡æ¯ï¼š" class="headerlink" title="å¼‚å¸¸ä¿¡æ¯ï¼š"></a>å¼‚å¸¸ä¿¡æ¯ï¼š</h2>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), &#x2F;BuildRoot&#x2F;Library&#x2F;Caches&#x2F;com.apple.xbs&#x2F;Sources&#x2F;UIKit&#x2F;UIKit-3599.6.1&#x2F;UIView.m:190</span><br><span class="line">invalid mode &#39;kCFRunLoopCommonModes&#39; provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.</span><br><span class="line">libc++abi.dylib: terminate_handler unexpectedly threw an exception</span><br></pre></td></tr></table></figure>

<h2 id="å¼‚å¸¸åˆ†æ"><a href="#å¼‚å¸¸åˆ†æ" class="headerlink" title="å¼‚å¸¸åˆ†æ"></a>å¼‚å¸¸åˆ†æ</h2><p>  APP crashåœ¨<br>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[keyWindow addSubview:weakSelf];</span><br></pre></td></tr></table></figure><br>  <a href="#%E9%94%99%E8%AF%AF%E5%A0%86%E6%A0%88">é”™è¯¯å †æ ˆä¿¡æ¯</a>ã€‚</p>
<p>  ä½†æ˜¯çœŸæ­£é€ æˆcrashçš„ä»£ç ä¸ºï¼š</p>
  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[self.layer insertSublayer:xxxView.layer atIndex:0];</span><br></pre></td></tr></table></figure>


<p>  è§£å†³æ–¹æ¡ˆï¼š<br>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[self layoutIfNeeded];</span><br><span class="line">[self.layer insertSublayer:xxxView.layer atIndex:0];</span><br></pre></td></tr></table></figure></p>
<p>  åŸå› åˆ†æï¼š<br>  ä¸‹é¢è¿™ä¸ªè¯´çš„å¾ˆåœ¨ç†</p>
<blockquote>
<p><a href="http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation" target="_blank" rel="noopener">http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation</a></p>
<p>I had this issue with a library when moving over to Xcode 8 (Material-Controls-For-iOS - MDTextField). I found that the problem was coming from where the layer of one view (which had no superview) was being added to another.</p>
<p>It looks like this may be the case for yourself also - your toolbar being created has not been added to a superview first. The fix I used was to add the view as a subview of the view that the layer was being added to, so in your case adding the toolbar as a subview of myModelView should stop the error.</p>
</blockquote>
<h2 id="ç¢°åˆ°è¯¥é—®é¢˜çš„è¿˜æœ‰"><a href="#ç¢°åˆ°è¯¥é—®é¢˜çš„è¿˜æœ‰" class="headerlink" title="ç¢°åˆ°è¯¥é—®é¢˜çš„è¿˜æœ‰"></a>ç¢°åˆ°è¯¥é—®é¢˜çš„è¿˜æœ‰</h2><ul>
<li><a href="http://technology.ezeenow.com/Posts/119474/Unity_Prime31_prompt_for_photo_is_crashing_on_iOS_10_and_XCode_8" target="_blank" rel="noopener">Googleå‡ºæ¥çš„ä¸€ä¸ªï¼Œä½†æ˜¯å¹¶æœªçœ‹åˆ°ç›¸å…³å›å¤ã€‚ã€‚ã€‚</a></li>
<li><a href="http://www.th7.cn/Program/IOS/201609/975582.shtml" target="_blank" rel="noopener">IOS10ä¸Šå´©æºƒé”™è¯¯â€œView has lost track of its superview, most (å¹¶æœªæ‰¾åˆ°åŸè´´)</a></li>
<li><a href="http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation" target="_blank" rel="noopener">stackoverflow(è¿™ä¸ªåˆ†æçš„å¾ˆåˆ°ä½)</a></li>
</ul>
<h2 id="é”™è¯¯å †æ ˆ-lt-è„±æ•-gt"><a href="#é”™è¯¯å †æ ˆ-lt-è„±æ•-gt" class="headerlink" title="é”™è¯¯å †æ ˆ &lt;è„±æ•&gt;"></a><a name="é”™è¯¯å †æ ˆ">é”™è¯¯å †æ ˆ &lt;è„±æ•&gt;</a></h2>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), &#x2F;BuildRoot&#x2F;Library&#x2F;Caches&#x2F;com.apple.xbs&#x2F;Sources&#x2F;UIKit&#x2F;UIKit-3599.6.1&#x2F;UIView.m:190</span><br><span class="line">invalid mode &#39;kCFRunLoopCommonModes&#39; provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.</span><br><span class="line">libc++abi.dylib: terminate_handler unexpectedly threw an exception</span><br><span class="line"></span><br><span class="line">(lldb) bt</span><br><span class="line">* thread #1: tid &#x3D; 0x87c18, 0x000000018238c524 libobjc.A.dylib&#96;objc_exception_throw, queue &#x3D; &#39;com.apple.main-thread&#39;, stop reason &#x3D; breakpoint 1.2</span><br><span class="line">    frame #0: 0x000000018238c524 libobjc.A.dylib&#96;objc_exception_throw</span><br><span class="line">    frame #1: 0x0000000183954094 CoreFoundation&#96;+[NSException raise:format:arguments:] + 104</span><br><span class="line">    frame #2: 0x00000001843de898 Foundation&#96;-[NSAssertionHandler handleFailureInFunction:file:lineNumber:description:] + 88</span><br><span class="line">    frame #3: 0x0000000189a7cf9c UIKit&#96;UIViewReportBrokenSuperviewChain + 472</span><br><span class="line">    frame #4: 0x0000000189a7d658 UIKit&#96;_UIViewTopDownSubtreeTraversal + 1496</span><br><span class="line">    frame #5: 0x000000018a0f3390 UIKit&#96;-[UIView(UIConstraintBasedLayout_EngineDelegate) _invalidateSystemLayoutSizeFittingSizeAtEngineDelegateLevel] + 232</span><br><span class="line">    frame #6: 0x00000001843832ac Foundation&#96;-[NSISEngine tryToAddConstraintWithMarker:expression:integralizationAdjustment:mutuallyExclusiveConstraints:] + 920</span><br><span class="line">    frame #7: 0x0000000184382dcc Foundation&#96;-[NSLayoutConstraint _addLoweredExpression:toEngine:integralizationAdjustment:lastLoweredConstantWasRounded:mutuallyExclusiveConstraints:] + 284</span><br><span class="line">    frame #8: 0x00000001843809e0 Foundation&#96;-[NSLayoutConstraint _addToEngine:integralizationAdjustment:mutuallyExclusiveConstraints:] + 272</span><br><span class="line">    frame #9: 0x000000018989cfdc UIKit&#96;__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 396</span><br><span class="line">    frame #10: 0x0000000184380510 Foundation&#96;-[NSISEngine withBehaviors:performModifications:] + 168</span><br><span class="line">    frame #11: 0x000000018989cde8 UIKit&#96;__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</span><br><span class="line">    frame #12: 0x00000001897995e0 UIKit&#96;-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</span><br><span class="line">    frame #13: 0x000000018989cf14 UIKit&#96;__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196</span><br><span class="line">    frame #14: 0x0000000184380510 Foundation&#96;-[NSISEngine withBehaviors:performModifications:] + 168</span><br><span class="line">    frame #15: 0x000000018989cde8 UIKit&#96;__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</span><br><span class="line">    frame #16: 0x00000001897995e0 UIKit&#96;-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</span><br><span class="line">    frame #17: 0x000000018989cf14 UIKit&#96;__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196</span><br><span class="line">    frame #18: 0x0000000184380510 Foundation&#96;-[NSISEngine withBehaviors:performModifications:] + 168</span><br><span class="line">    frame #19: 0x000000018989cde8 UIKit&#96;__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</span><br><span class="line">    frame #20: 0x00000001897995e0 UIKit&#96;-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</span><br><span class="line">    frame #21: 0x000000018989cf14 UIKit&#96;__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196</span><br><span class="line">    frame #22: 0x0000000184380510 Foundation&#96;-[NSISEngine withBehaviors:performModifications:] + 168</span><br><span class="line">    frame #23: 0x000000018989cde8 UIKit&#96;__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</span><br><span class="line">    frame #24: 0x00000001897995e0 UIKit&#96;-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</span><br><span class="line">    frame #25: 0x00000001898a4bb0 UIKit&#96;-[UIWindow(UIConstraintBasedLayout) _switchToLayoutEngine:] + 72</span><br><span class="line">    frame #26: 0x00000001898a4b04 UIKit&#96;-[UIWindow(UIConstraintBasedLayout) _initializeLayoutEngine] + 256</span><br><span class="line">    frame #27: 0x00000001898a4910 UIKit&#96;-[UIView(UIConstraintBasedLayout) _layoutEngine_windowDidChange] + 132</span><br><span class="line">    frame #28: 0x00000001897996dc UIKit&#96;-[UIView(Internal) _didMoveFromWindow:toWindow:] + 200</span><br><span class="line">    frame #29: 0x0000000189798d90 UIKit&#96;__45-[UIView(Hierarchy) _postMovedFromSuperview:]_block_invoke + 156</span><br><span class="line">    frame #30: 0x0000000189798be8 UIKit&#96;-[UIView(Hierarchy) _postMovedFromSuperview:] + 792</span><br><span class="line">    frame #31: 0x00000001897a4ad0 UIKit&#96;-[UIView(Internal) _addSubview:positioned:relativeTo:] + 1788</span><br><span class="line">    frame #32: 0x00000001897a43bc UIKit&#96;-[UIView(Hierarchy) addSubview:] + 828</span><br><span class="line">  * frame #33: 0x00000001004f78ec Project_ent&#96;__31-[EsfCommentReportView show]_block_invoke((null)&#x3D;&lt;unavailable&gt;) + 228 at EsfCommentReportView.m:293</span><br><span class="line">    frame #34: 0x00000001897d2b88 UIKit&#96;+[UIView(UIViewAnimationWithBlocks) _setupAnimationWithDuration:delay:view:options:factory:animations:start:animationStateGenerator:completion:] + 660</span><br><span class="line">    frame #35: 0x00000001897d28e8 UIKit&#96;+[UIView(UIViewAnimationWithBlocks) animateWithDuration:animations:] + 56</span><br><span class="line">    frame #36: 0x00000001004f77a0 Project_ent&#96;-[EsfCommentReportView show](self&#x3D;0x000000015fe32020, _cmd&#x3D;&quot;show&quot;) + 492 at EsfCommentReportView.m:291</span><br><span class="line">    frame #37: 0x0000000100858a04 Project_ent&#96;__53-[BuyerAdviserProfileViewController reportAction:]_block_invoke((null)&#x3D;&lt;unavailable&gt;) + 308 at BuyerAdviserProfileViewController.m:174</span><br><span class="line">    frame #38: 0x00000001003f93e4 Project_ent&#96;+[MyLoginViewController ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:](self&#x3D;MyLoginViewController, _cmd&#x3D;&quot;ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:&quot;, viewController&#x3D;0x000000015fd2e320, sourceType&#x3D;2, afterCheckOrLogin&#x3D;0x00000001008588d0, cancelLogin&#x3D;(null)) + 236 at MyLoginViewController.m:123</span><br><span class="line">    frame #39: 0x00000001003f92b0 Project_ent&#96;+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:](self&#x3D;MyLoginViewController, _cmd&#x3D;&quot;ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:&quot;, viewController&#x3D;0x000000015fd2e320, afterCheckOrLogin&#x3D;0x00000001008588d0, cancelLogin&#x3D;(null)) + 156 at MyLoginViewController.m:114</span><br><span class="line">    frame #40: 0x00000001003f9124 Project_ent&#96;+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:](self&#x3D;MyLoginViewController, _cmd&#x3D;&quot;ifShouldLoginFromViewController:afterCheckOrLogin:&quot;, viewController&#x3D;0x000000015fd2e320, afterCheckOrLogin&#x3D;0x00000001008588d0) + 120 at MyLoginViewController.m:104</span><br><span class="line">    frame #41: 0x0000000100858870 Project_ent&#96;-[BuyerAdviserProfileViewController reportAction:](self&#x3D;0x000000015fd2e320, _cmd&#x3D;&quot;reportAction:&quot;, button&#x3D;0x000000015fe26650) + 452 at BuyerAdviserProfileViewController.m:156</span><br><span class="line">    frame #42: 0x00000001897d27b0 UIKit&#96;-[UIApplication sendAction:to:from:forEvent:] + 96</span><br><span class="line">    frame #43: 0x00000001897d2730 UIKit&#96;-[UIControl sendAction:to:forEvent:] + 80</span><br><span class="line">    frame #44: 0x00000001897bcbe4 UIKit&#96;-[UIControl _sendActionsForEvents:withEvent:] + 452</span><br><span class="line">    frame #45: 0x00000001897d201c UIKit&#96;-[UIControl touchesEnded:withEvent:] + 584</span><br><span class="line">    frame #46: 0x00000001897d1b44 UIKit&#96;-[UIWindow _sendTouchesForEvent:] + 2484</span><br><span class="line">    frame #47: 0x00000001897ccd8c UIKit&#96;-[UIWindow sendEvent:] + 2988</span><br><span class="line">    frame #48: 0x000000018979d858 UIKit&#96;-[UIApplication sendEvent:] + 340</span><br><span class="line">    frame #49: 0x0000000189f8acb8 UIKit&#96;__dispatchPreprocessedEventFromEventQueue + 2736</span><br><span class="line">    frame #50: 0x0000000189f84720 UIKit&#96;__handleEventQueue + 784</span><br><span class="line">    frame #51: 0x0000000183902278 CoreFoundation&#96;__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 24</span><br><span class="line">    frame #52: 0x0000000183901bc0 CoreFoundation&#96;__CFRunLoopDoSources0 + 524</span><br><span class="line">    frame #53: 0x00000001838ff7c0 CoreFoundation&#96;__CFRunLoopRun + 804</span><br><span class="line">    frame #54: 0x000000018382e048 CoreFoundation&#96;CFRunLoopRunSpecific + 444</span><br><span class="line">    frame #55: 0x00000001852b1198 GraphicsServices&#96;GSEventRunModal + 180</span><br><span class="line">    frame #56: 0x0000000189808628 UIKit&#96;-[UIApplication _run] + 684</span><br><span class="line">    frame #57: 0x0000000189803360 UIKit&#96;UIApplicationMain + 208</span><br><span class="line">    frame #58: 0x0000000100a3db78 Project_ent&#96;main + 460 at main.swift:24</span><br><span class="line">    frame #59: 0x00000001828105b8 libdyld.dylib&#96;start + 4</span><br><span class="line">(lldb)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>DEBUG</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»ä¸€ä¸ªå¸¸è§çš„å´©æºƒå¼€å§‹</title>
    <url>/post/debug-sth-from-crash/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>æ˜¨å¤©ä¸‹ç­æ—¶å€™ä¸€æœ‹å‹ç¢°åˆ°ä¸€ä¸ªä¸‹é¢çš„å´©æºƒï¼Œä½†æ˜¯å…¨å±€æ–­ç‚¹å´æ— æ³•æ–­åˆ°æŒ‡å®šä½ç½®ã€‚é‰´äºä¸ä¿¡é‚ªçš„æ€åº¦ï¼Œå†³å®šå°è¯•ä¸€ç•ªã€‚ç„¶åå°†æ­¤äº‹è®°å½•å¦‚ä¸‹æ–‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*** Terminating app due to uncaught exception &#39;NSInvalidArgumentException&#39;, reason: &#39;-[__NSCFConstantString hasPrefix:]: nil argument&#39;</span><br><span class="line">*** First throw call stack:</span><br><span class="line">(0x18521ed8c .....)</span><br><span class="line">libc++abi.dylib: terminating with uncaught exception of type NSException</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="å´©æºƒè¡¨ç°"><a href="#å´©æºƒè¡¨ç°" class="headerlink" title="å´©æºƒè¡¨ç°"></a>å´©æºƒè¡¨ç°</h2><p>é‚£è€å“¥è¯´ä»–çš„APPè¿è¡Œä¹‹åï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œç­‰å¾…10sä¹‹åå°±ä¼šé—ªé€€ï¼Œé—ªé€€çš„æœ€é‡è¦ä¿¡æ¯æ˜¯ä¸Šé¢ï¼Œæ ˆç»“æ„ä¸Šæ²¡æœ‰å‡½æ•°ä¿¡æ¯ï¼Œåªæœ‰åœ°å€ã€‚</p>
<p>æ‰“å¼€å…¨å±€æ–­ç‚¹ï¼Œä¹Ÿæ— æ³•ç›´æ¥æ–­åˆ°æŒ‡å®šçš„å‡½æ•°ï¼Œè¿™ä¸ªä¿¡æ¯æˆ‘ç•™äº†ä¸€å¼ å›¾ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š(å·²è„±æ•)</p>
<p><img src="/images/2018-07-25-10-52-38.png" alt="å´©æºƒæˆªå›¾"></p>
<h2 id="å…ˆç®€å•çš„åˆ†æä¸€ä¸‹"><a href="#å…ˆç®€å•çš„åˆ†æä¸€ä¸‹" class="headerlink" title="å…ˆç®€å•çš„åˆ†æä¸€ä¸‹"></a>å…ˆç®€å•çš„åˆ†æä¸€ä¸‹</h2><ul>
<li>å´©æºƒåŸå› å¾ˆæ˜ç¡®:<code>-[__NSCFConstantString hasPrefix:]: nil argument</code>ã€‚</li>
<li><code>__NSCFConstantString</code>ä¸º<code>NSString</code>ç±»ç°‡é‡Œé¢çš„ä¸€ä¸ªç±»ï¼Œå¸¸è§çš„ç±»ä¼¼çš„è¿˜æœ‰å¾ˆå¤šã€‚</li>
<li><code>- (BOOL)hasPrefix:(NSString *)str;</code>ä¸­<code>nil argument</code>ï¼Œä¹Ÿå°±æ˜¯<code>str</code>ä¸º<code>nil</code>ã€‚</li>
<li><code>First throw call stack</code>ä¸‹æ–¹å‡ä¸ºåœ°å€ï¼Œè¯´æ˜æ­¤å‡½æ•°åº”è¯¥åœ¨ä¸€ä¸ª<code>.a/.framework</code>ä¸­ã€‚</li>
<li><code>APPè¿è¡Œä¹‹åï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œç­‰å¾…10sä¹‹åå°±ä¼šé—ªé€€</code>è¯´æ˜æ­¤å´©æºƒä¸ºå¼‚æ­¥è°ƒç”¨ï¼Œè‡³äºæ˜¯ä¸æ˜¯å®šæ—¶è°ƒç”¨ï¼Œè¿™ä¸ªçœŸä¸å¥½è¯´ã€‚</li>
<li>ç”±äºæˆ‘æŠ€æœ¯æœ‰é™ï¼Œåˆ«çš„å¥½åƒæç‚¼ä¸å‡ºæœ‰ç”¨ä¿¡æ¯äº†ã€‚ã€‚</li>
</ul>
<h2 id="å¤ç°ä¸€ä¸‹å´©æºƒ"><a href="#å¤ç°ä¸€ä¸‹å´©æºƒ" class="headerlink" title="å¤ç°ä¸€ä¸‹å´©æºƒ"></a>å¤ç°ä¸€ä¸‹å´©æºƒ</h2><p>å…ˆæ¥ä¸ªç®€å•çš„ä»£ç ï¼ŒéªŒè¯ä¸€ä¸‹ ** <code>- (BOOL)hasPrefix:(NSString *)str;</code>ä¸­<code>nil argument</code>ï¼Œä¹Ÿå°±æ˜¯<code>str</code>ä¸º<code>nil</code>ã€‚ **</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, @([<span class="string">@""</span> hasPrefix:<span class="literal">nil</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä¸€ä¸‹ï¼Œç»“æœå¾ˆæ„æ–™ä¹‹ä¸­ï¼Œå¾—å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Untitled.m:<span class="number">4</span>:<span class="number">29</span>: warning: null passed to a callee that requires a non-null argument [-Wnonnull]</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, @([<span class="string">@""</span> hasPrefix:<span class="literal">nil</span>]));</span><br><span class="line">                            ^         ~~~</span><br><span class="line"><span class="number">1</span> warning generated.</span><br><span class="line">Terminated due to signal: ABORT TRAP (<span class="number">6</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-07</span><span class="number">-25</span> <span class="number">10</span>:<span class="number">44</span>:<span class="number">50.569</span> Untitled[<span class="number">53770</span>:<span class="number">899141</span>] *** Terminating app due to uncaught exception <span class="string">'NSInvalidArgumentException'</span>, reason: <span class="string">'-[__NSCFConstantString hasPrefix:]: nil argument'</span></span><br><span class="line">*** First throw call stack:</span><br><span class="line">(</span><br><span class="line">	<span class="number">0</span>   CoreFoundation                      <span class="number">0x00007fff30aae2db</span> __exceptionPreprocess + <span class="number">171</span></span><br><span class="line">	<span class="number">1</span>   libobjc.A.dylib                     <span class="number">0x00007fff57c58c76</span> objc_exception_throw + <span class="number">48</span></span><br><span class="line">	<span class="number">2</span>   CoreFoundation                      <span class="number">0x00007fff30b3fd7d</span> +[<span class="built_in">NSException</span> raise:format:] + <span class="number">205</span></span><br><span class="line">	<span class="number">3</span>   CoreFoundation                      <span class="number">0x00007fff30a01840</span> -[__NSCFString hasPrefix:] + <span class="number">96</span></span><br><span class="line">	<span class="number">4</span>   Untitled                            <span class="number">0x000000010787fd60</span> main + <span class="number">64</span></span><br><span class="line">	<span class="number">5</span>   libdyld.dylib                       <span class="number">0x00007fff58872015</span> start + <span class="number">1</span></span><br><span class="line">)</span><br><span class="line">libc++abi.dylib: terminating with uncaught exception of type <span class="built_in">NSException</span></span><br></pre></td></tr></table></figure>

<p>ç»è¿‡<code>1 warning generated</code>ä¹‹åï¼Œæœæ–­å´©æºƒäº†ï¼Œè¿˜æœ‰æ˜ç¡®çš„å´©æºƒæ—¶å€™æ ˆç»“æ„ã€‚</p>
<p>å¥½ï¼Œé—®é¢˜ç¡®å®šäº†å°±æ˜¯è¿™ä¸ª<code>1 warning generated</code>é€ æˆçš„ã€‚æ”¹ä¸‹å°±å®Œäº‹å’¯ï½ï½</p>
<h2 id="å¯»æ‰¾é—®é¢˜"><a href="#å¯»æ‰¾é—®é¢˜" class="headerlink" title="å¯»æ‰¾é—®é¢˜"></a>å¯»æ‰¾é—®é¢˜</h2><h3 id="å°è¯•è§£é™¤warning"><a href="#å°è¯•è§£é™¤warning" class="headerlink" title="å°è¯•è§£é™¤warning"></a>å°è¯•è§£é™¤warning</h3><p>è¿œç¨‹è¿›å»ä¹‹åæˆ‘éœ‡æƒŠäº†ï¼Œ<code>warning: 999+</code>ã€‚å…ˆå¿«é€Ÿæ‰¾åˆ°é—®é¢˜ï¼Œè¦ä»€ä¹ˆè‡ªè¡Œè½¦ã€‚ã€‚</p>
<p>Xcodeä¸­å…¨å±€æœç´¢<code>hasPrefix</code>å…³é”®å­—ï¼Œå¸¦å˜é‡çš„å…¨éƒ¨åŠ ä¸Šæ–­ç‚¹ã€‚</p>
<p>runä¸€ä¸‹ï¼Œé—®é¢˜ä¾æ—§å¦‚æ­¤ã€‚ã€‚æ­£å¦‚ä¸Šé¢è¯´çš„ä¸€æ ·ï¼š</p>
<blockquote>
<p><code>First throw call stack</code>ä¸‹æ–¹å‡ä¸ºåœ°å€ï¼Œè¯´æ˜æ­¤å‡½æ•°åº”è¯¥åœ¨ä¸€ä¸ª<code>.a/.framework</code>ä¸­ã€‚</p>
</blockquote>
<p>GO DIEâ€¦</p>
<p>PS.</p>
<ul>
<li>å…³äº<code>hasPrefix</code>å‡½æ•°çš„<a href="https://developer.apple.com/documentation/foundation/nsstring/1410309-hasprefix?language=objc" target="_blank" rel="noopener">OCå£°æ˜</a>ã€<a href="https://developer.apple.com/documentation/foundation/nsstring/1410309-hasprefix" target="_blank" rel="noopener">swiftå£°æ˜</a>å‡ä¸ºå®Œæ•´å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å®‰å¿ƒå…¨å±€æœç´¢å°±èƒ½æ‰¾åˆ°ä»£ç ä¸­å·²å­˜åœ¨çš„<code>hasPrefix</code>å‡½æ•°</li>
<li>é¡ºä¾¿æœäº†ä¸€ä¸‹è¯¥é¡¹ç›®ä¸åŒ…å«ç¬¬ä¸‰æ–¹<code>.a</code>, ä½†æ˜¯<code>.framework</code>ä¸å°‘ã€‚ã€‚æœ‰<a href="https://cocoapods.org/" target="_blank" rel="noopener">CocoaPods</a>é›†æˆæœ‰ç›´æ¥æ‹–è¿›æ¥çš„ã€‚ã€‚</li>
</ul>
<h3 id="å°è¯•Method-Swizzlingä¸€ä¸‹"><a href="#å°è¯•Method-Swizzlingä¸€ä¸‹" class="headerlink" title="å°è¯•Method Swizzlingä¸€ä¸‹"></a>å°è¯•Method Swizzlingä¸€ä¸‹</h3><p>è¿™ç©æ„æ—¢ç„¶åœ¨åˆ«äººçš„frameworkä¸­ï¼Œé‚£å°±æ›´æ–°ä¸€ä¸‹å’¯ï¼Œä½†æ˜¯å…¨éƒ¨æ›´æ–°å¹¶ä¸å¯å–ã€‚ã€‚</p>
<p>frameworkçš„æ›´æ–°å¯èƒ½å¯¼è‡´ä¸€äº›ä¸å¯é¢„ä¼°çš„å¯å˜å› ç´ ã€‚æ¯”å¦‚è¯´APIä¿®æ”¹ã€å†…éƒ¨é€»è¾‘å˜æ›´å¯¼è‡´å¤–éƒ¨ä½¿ç”¨ä¸å…¼å®¹ã€æŸäº›å¼€å‘è€…å–œæ¬¢ç›´æ¥ä¿®æ”¹frameworkã€ç­‰ã€‚</p>
<p>æ‰€ä»¥å…ˆç¡®å®šæ˜¯å“ªä¸ªframeworkã€‚</p>
<p>Method Swizzlingã€‚å°†å…¶<code>-[__NSCFConstantString hasPrefix:]: nil argument</code>ç›´æ¥è¿‡æ»¤<code>nil</code>ï¼Œå²‚ä¸ç¾æ»‹æ»‹ï½ï½</p>
<p>å¥½äº†å…ˆæµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MySafeString</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MySafeString</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    Class originalClass = <span class="built_in">NSClassFromString</span>(<span class="string">@"__NSCFConstantString"</span>);</span><br><span class="line">    Class swizzledClass = [<span class="keyword">self</span> <span class="keyword">class</span>];</span><br><span class="line">    SEL originalSelector = <span class="keyword">@selector</span>(hasPrefix:);</span><br><span class="line">    SEL swizzledSelector = <span class="keyword">@selector</span>(safe_hasPrefix:);</span><br><span class="line">    Method originalMethod = class_getInstanceMethod(originalClass, originalSelector);</span><br><span class="line">    Method swizzledMethod = class_getInstanceMethod(swizzledClass, swizzledSelector);</span><br><span class="line">    </span><br><span class="line">    IMP originalIMP = method_getImplementation(originalMethod);</span><br><span class="line">    IMP swizzledIMP = method_getImplementation(swizzledMethod);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *originalType = method_getTypeEncoding(originalMethod);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *swizzledType = method_getTypeEncoding(swizzledMethod);</span><br><span class="line">    </span><br><span class="line">    class_replaceMethod(originalClass,swizzledSelector,originalIMP,originalType);</span><br><span class="line">    class_replaceMethod(originalClass,originalSelector,swizzledIMP,swizzledType);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)safe_hasPrefix:(<span class="built_in">NSString</span> *)str &#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> [<span class="keyword">self</span> safe_hasPrefix:str];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, @([<span class="string">@""</span> hasPrefix:<span class="literal">nil</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">Untitled.m:<span class="number">33</span>:<span class="number">29</span>: warning: null passed to a callee that requires a non-null argument [-Wnonnull]</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, @([<span class="string">@""</span> hasPrefix:<span class="literal">nil</span>]));</span><br><span class="line">                            ^         ~~~</span><br><span class="line"><span class="number">1</span> warnings generated.</span><br><span class="line"><span class="number">2018</span><span class="number">-07</span><span class="number">-25</span> <span class="number">11</span>:<span class="number">32</span>:<span class="number">20.634</span> Untitled[<span class="number">54520</span>:<span class="number">926937</span>] <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>ä¸å´©æºƒäº†ï¼Œèµ¶ç´§ç²˜è¿‡å»ï¼Œå¹¶åœ¨<code>- (BOOL)safe_hasPrefix:(NSString *)str</code>ä¸­çš„<code>return YES;</code>æ‰“ä¸Šæ–­ç‚¹ã€‚</p>
<p>å†…å¿ƒå¾—åˆ°äº†æå¤§çš„æ»¡è¶³ï½ ç¾æ»‹æ»‹ï½ï½ï½</p>
<p>2åˆ†é’Ÿåã€‚</p>
<p>æ–­ç‚¹åœäº†ï¼Œå‘<code>- (BOOL)safe_hasPrefix:(NSString *)str</code>çš„<code>str</code>ä¼ nilçš„è°ƒç”¨è€…æ˜¯<code>[MOBFErrorReportService writeHTTPErrorMsg:error:]</code>ã€‚</p>
<p>å°†<code>MOBFErrorReportService</code>æ”¾å…¥<a href="https://www.google.com/" target="_blank" rel="noopener">Google</a>çœ‹åˆ°ç¬¬äºŒä¸ªå°±æ˜¯è¿™ä¸ª<a href="http://bbs.mob.com/thread-23618-1-1.html" target="_blank" rel="noopener">[MOBFDevice duid] - BUGæäº¤- Mobå®˜æ–¹è®ºå›</a>ã€‚æ–‡ä¸­æŒ‡å‡º<code>SDK ç‰ˆæœ¬: ShareSDKVersion-3.5.1</code>ã€‚</p>
<p>å¥½äº†çœ‹ä¸€ä¸‹<code>ShareSDK</code>è¿™ä¸ªåº“ã€‚emmm è¿™ä¸ªåº“æ˜¯æ‹–æ‹½è¿›å»çš„ã€‚è€å“¥è¯´è¿™é¡¹ç›®æ¥æ‰‹ä¹‹åæ²¡æ›´æ–°è¿‡è¿™ä¸ªåº“ã€‚</p>
<p>äº‹å·²è‡³æ­¤ï¼Œç¡®å®šæ˜¯<code>ShareSDK</code>çš„é—®é¢˜ã€‚</p>
<p>æ›´æ–°ä¹‹ï¼Œé—®é¢˜è§£å†³ï½  çœŸå¿ƒçš„ç¾æ»‹æ»‹ï½ï½</p>
<p>PS.</p>
<ul>
<li>ä¸Šæ–‡ä¸­å…³äºç±»ç°‡çš„ Method Swizzlingï¼Œè¯¦è§<a href="http://www.tanhao.me/code/160723.html/" target="_blank" rel="noopener">Method Swizzlingçš„å„ç§å§¿åŠ¿</a>ã€‚</li>
</ul>
<h2 id="å¯»æ‰¾çš„è¿‡ç¨‹éƒ¨åˆ†ç‰¹å†™"><a href="#å¯»æ‰¾çš„è¿‡ç¨‹éƒ¨åˆ†ç‰¹å†™" class="headerlink" title="å¯»æ‰¾çš„è¿‡ç¨‹éƒ¨åˆ†ç‰¹å†™"></a>å¯»æ‰¾çš„è¿‡ç¨‹éƒ¨åˆ†ç‰¹å†™</h2><p>ä¸Šé¢çš„é€»è¾‘å¹¶ä¸æ˜¯ä¸€æ°”å‘µæˆï¼Œè€Œæ˜¯ç”±äºç²—å¿ƒä¹Ÿèµ°äº†éƒ¨åˆ†å¼¯è·¯ï¼Œç‰¹åˆ—å‡ºæ¥å¼•ä»¥ä¸ºæˆ’ã€‚</p>
<h3 id="çœ‹åˆ°å…¨å±€æ–­ç‚¹çœŸçš„èµ°ä¸åˆ°æ—¶"><a href="#çœ‹åˆ°å…¨å±€æ–­ç‚¹çœŸçš„èµ°ä¸åˆ°æ—¶" class="headerlink" title="çœ‹åˆ°å…¨å±€æ–­ç‚¹çœŸçš„èµ°ä¸åˆ°æ—¶"></a>çœ‹åˆ°å…¨å±€æ–­ç‚¹çœŸçš„èµ°ä¸åˆ°æ—¶</h3><p>ç”±äºä»£ç æ˜¯å…¬å¸ä»£ç ï¼Œä¹Ÿæ²¡æœ‰demo,æ‰€ä»¥å¸ƒå‰å²›ä¸ºå•¥ç¡®å®æ–­ç‚¹ä¸ä¼šèµ°ã€‚ã€‚ã€‚</p>
<p>MMP çœ‹åˆ°äº†<code>First throw call stack</code>ä¹‹åç¬¬ä¸€ååº”æ˜¯ï¼Œè¿™äº›åœ°å€åº”è¯¥å¯ä»¥è¿˜åŸåˆ°å¯¹åº”çš„ä½ç½®ã€‚</p>
<p>ç„¶åæƒ³åˆ°äº†é€†å‘é‡Œé¢çš„éªšæ“ä½œã€‚é¡¿æ—¶æƒ³é€†å‘åˆ†æä¸€ä¸‹ã€‚ã€‚ã€‚</p>
<p>ä½†ç”±äºçœ‹äº†ä¸€ä¸‹<code>.app</code>ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶æœ‰ ** 40M ** ,ç®—äº†ç®—äº†ï¼ŒIDAè½½å…¥çš„æœ‰ç‚¹æ…¢ï¼Œè¿™è¦å¥½ä¹…æ‰èƒ½åˆ†æå®Œã€‚ã€‚</p>
<p>æƒ³äº†æƒ³å¤©è¦ä¸‹é›¨ï¼Œåª³å¦‡å’Œå¨ƒéƒ½åœ¨å¤–é¢ã€‚æœæ–­æ”¾å¼ƒåˆ†æä¸€æ³¢çš„å†²åŠ¨ï¼Œæ¥<code>Method Swizzling</code>ä¼šæ›´å¿«ã€‚</p>
<h3 id="çœ‹èµ°çœ¼çš„-Method-Swizzling"><a href="#çœ‹èµ°çœ¼çš„-Method-Swizzling" class="headerlink" title="çœ‹èµ°çœ¼çš„ Method Swizzling"></a>çœ‹èµ°çœ¼çš„ Method Swizzling</h3><p>ä¹‹å‰çœ‹è¿‡è¿™ä¸ª<a href="http://www.tanhao.me/code/160723.html/" target="_blank" rel="noopener">Method Swizzlingçš„å„ç§å§¿åŠ¿</a>æ–‡ç« ï¼Œå°è±¡æ·±åˆ»ã€‚</p>
<p>ç”±äº ** Method Swizzling ** é£é™©ä¸é‚£ä¹ˆå®¹æ˜“æ§åˆ¶ï¼Œæ‰€ä»¥å¹¶æ²¡ç”¨ç±»ç°‡ç›¸å…³çš„ã€‚</p>
<p>ä¸€é¡¿<code>cmd c / cmd v</code>ä¹‹åæ”¹äº†ç±»åå°±æ‰”äº†è¿‡å»ã€‚å½“æ—¶å¤§çº¦è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)safe_hasPrefix:(<span class="built_in">NSString</span> *)str &#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æ­¤å¤„ä¼šå‘ç”Ÿå¾ªç¯è°ƒç”¨ï¼Œæ˜¯é”™è¯¯çš„ç¤ºä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> [(<span class="built_in">NSString</span> *)<span class="keyword">self</span> hasPrefix:str];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚æˆ‘åˆšåœ¨ä¸Šé¢çš„å¤‡æ³¨ä¸€æ ·ã€‚</p>
<p>è„‘è¢‹ä¸€çƒ­ï¼Œè¿™ç±»ç°‡ä¼šä¸ä¼šæœ‰åˆ«çš„å‘ï¼Œç„¶åè¿‡åˆ†çš„è‡ªä¿¡å¿½ç•¥äº†<code>safe_</code>å‰ç¼€ï¼Œå¹¶å†™äº†ä¸ªCçš„å‰ç¼€æ¯”è¾ƒï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)safe_hasPrefix:(<span class="built_in">NSString</span> *)str &#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (((<span class="built_in">NSString</span> *)<span class="keyword">self</span>).length &lt; str.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æ­¤å¤„é€»è¾‘å¹¶æœªç»è¿‡å¾ˆå¤šçš„æµ‹è¯•ç”¨ä¾‹æµ‹è¯•ï¼Œåªæ˜¯ä¸´æ—¶ä¿®è¡¥ã€‚å®é™…æ–¹æ¡ˆåº”è¯¥ç›´æ¥è°ƒç”¨safe_hasPrefix</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *str1 = [str cStringUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *str2 = [(<span class="built_in">NSString</span> *)<span class="keyword">self</span> cStringUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSInteger</span> idx = str.length; idx &gt;= <span class="number">0</span>; idx--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (str1[idx] != str2[idx]) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ç•ªæ¢­å“ˆä¹‹åï¼Œå®šä½åˆ°äº†é—®é¢˜ã€‚</p>
<p>ä½†æ˜¯ä»Šå¤©å¤ç›˜çš„æ—¶å€™æƒ³åˆ°è¿™ä¸ªç±»ç°‡çš„IMPæ­£å¸¸çš„æ“ä½œä¹Ÿä¸å¯èƒ½å‡ºç°å¾ªç¯è°ƒç”¨ã€‚ã€‚ã€‚ã€‚</p>
<p>ç„¶åå‘ç°æ˜¨å¤©çš„ä¸€ç•ªæ¢­å“ˆçœŸçš„æ˜¯å¼±æ™ºã€‚ã€‚æƒ­æ„§æƒ­æ„§ã€‚ã€‚ã€‚</p>
<h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><ul>
<li>è§£å†³é—®é¢˜çš„æ–¹æ¡ˆåœ¨äºçŸ¥è¯†é¢çš„å®½åº¦ã€‚ï¼ˆä¸€ç›´ä¸ºæˆ‘æ²¡æœ‰é€šè¿‡<code>First throw call stack</code>ç›´æ¥å®šä½è€Œå®³ç¾ï¼‰</li>
<li>ç€æ€¥ä¸‹ç­çš„æ—¶å€™åˆ«å†™å¤ªå¤šé€»è¾‘ï¼Œå®¹æ˜“æ¼ã€‚è¦ä¹ˆåˆ«ç€æ€¥ï¼Œè¦ä¹ˆä¸‡åˆ†å°å¿ƒã€‚</li>
<li>é›†æˆç¬¬ä¸‰æ–¹SDKåˆ«çèƒ¡é—¹ï¼Œä½¿ç”¨ä»£ç ç›´æ¥é›†æˆ(é™¤éä¸‡ä¸å¾—å·²)ã€‚å°½é‡ä½¿ç”¨<a href="https://cocoapods.org/" target="_blank" rel="noopener">CocoaPods</a>è¿™æ ·çš„å·¥å…·ã€‚</li>
<li>ä»£ç ä¸­çš„ ** warning ** è®°å¾—æ¶ˆä¸€ä¸‹ã€‚æˆå¤©<code>999+</code> å®¹æ˜“æ¼æ‰å…³é”®ä¿¡æ¯ã€‚</li>
<li>å¼€å‘çš„ç¬¬ä¸‰æ–¹SDKä¸€å®šè¦æ³¨æ„æµ‹è¯•è¦†ç›–ç‡ã€‚</li>
<li>swiftå¤§æ³•å¥½ã€‚swiftä¸ç”¨<code>!</code>ç»å¯¹ä¸ä¼šæœ‰æœºä¼šå‡ºç°<code>func hasPrefix(_ str: String) -&gt; Bool</code>ä¸­å‚æ•°<code>str</code>ä¼ ç©ºçš„å¯èƒ½ :)</li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>DEBUG</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¾§æ»‘å¯¼èˆªæ æ¶ˆå¤±é—®é¢˜ç¬”è®°</title>
    <url>/post/push-pop-navigation-bar-hidden/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>å¦‚æœå‰é¡µé¢å’Œåé¡µé¢ä¸åŒï¼Œåˆ™ä¼šå‡ºç°è½»å¾®ä¾§æ»‘æ—¶å¯¼èˆªæ è«åå…¶å¦™æ²¡äº†ğŸ˜‚</p>
<p><a href="https://github.com/madordie/Demo-PushAndPop" target="_blank" rel="noopener">Demo-PushAndPop</a></p>
<a id="more"></a>

<h2 id="Demo-PushAndPop"><a href="#Demo-PushAndPop" class="headerlink" title="Demo-PushAndPop"></a>Demo-PushAndPop</h2><p>[å·²è§£å†³] éšè—å¯¼èˆªæ +æ”¹å˜çŠ¶æ€æ æ ·å¼æ—¶å‡ºç°å¯¼èˆªæ è«åå…¶å¦™æ²¡äº†</p>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p><img src="https://github.com/madordie/Demo-PushAndPop/blob/master/Untitled.gif?raw=true" alt="snapshot"></p>
<p>å½“<code>ViewController.swift</code>å®ç°</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">var</span> preferredStatusBarStyle: <span class="type">UIStatusBarStyle</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> .lightContent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ—¶ï¼Œä¸¤ä¸ª<code>ViewController</code>å¯¹åº”çš„<code>UIStatusBarStyle</code>ä¸åŒï¼Œåˆ™ä¼šå‡ºç°å¦‚ä¸Šå›¾ã€‚<code>UIStatusBarStyle</code>ä¸€è‡´åˆ™æ­£å¸¸ã€‚</p>
<h2 id="è§£å†³å…³é”®"><a href="#è§£å†³å…³é”®" class="headerlink" title="è§£å†³å…³é”®"></a>è§£å†³å…³é”®</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NavigationController</span>: <span class="title">UINavigationController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> childViewControllerForStatusBarStyle: <span class="type">UIViewController?</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> topViewController</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åªéœ€è¦å°†<code>childViewControllerForStatusBarStyle</code>è®¾ç½®ä¸º<code>UINavigationController.topViewController</code>å³å¯ã€‚</p>
<h2 id="å¦å¤–"><a href="#å¦å¤–" class="headerlink" title="å¦å¤–"></a>å¦å¤–</h2><p>é™„ä¸Š<code>BViewController</code>ä¸­ç›¸å…³ä»£ç ã€‚åœ¨åˆ‡æ¢çš„ä¸¤ä¸ª<code>UIViewController</code>çš„<code>preferredStatusBarStyle</code>ä¸€æ ·æ—¶ï¼Œä¸éœ€è¦è®¾ç½®<code>UINavigationController.childViewControllerForStatusBarStyle</code>ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> navigationBarHidden = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewWillAppear(animated)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> navigationController = navigationController  <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> navigationController.isNavigationBarHidden != navigationBarHidden &#123;</span><br><span class="line">            navigationController.setNavigationBarHidden(navigationBarHidden, animated: animated)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewWillDisappear(animated)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> navigationController = navigationController  <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> last = navigationController.viewControllers.last <span class="keyword">as</span>? <span class="type">BViewController</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> last.navigationBarHidden != navigationBarHidden &#123;</span><br><span class="line">            navigationController.setNavigationBarHidden(last.navigationBarHidden, animated: animated)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h2><ul>
<li>@æœ¨å¤´ <code>viewWillAppear</code>æ›´æ¢ä¸º<code>viewDidAppear</code>ç„¶åè°ƒè¯•ï¼Œåœ¨Demoä¸­æµ‹è¯•ä¹Ÿå¯ä»¥æ›²çº¿æ•‘å›½ã€‚</li>
<li>@Harry æä¾›çš„ç»ˆæå¤§æ³•ï½</li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>DEBUG</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å¿«é€ŸæŸ¥æ‰¾ipaå†…çš„ç¬¦å·å¼•ç”¨</title>
    <url>/post/how-to-quickly-find-symbol-references-in-ipa/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>ITMS-90809: Deprecated API Usage - Apple will stop accepting submissions of apps that use UIWebView APIs . See <a href="https://developer.apple.com/documentation/uikit/uiwebview" target="_blank" rel="noopener">https://developer.apple.com/documentation/uikit/uiwebview</a> for more information.</p>
</blockquote>
<p>ç†Ÿæ‚‰ä¸?</p>
<a id="more"></a>

<h2 id="æºç çº§åˆ«å¼•ç”¨"><a href="#æºç çº§åˆ«å¼•ç”¨" class="headerlink" title="æºç çº§åˆ«å¼•ç”¨"></a>æºç çº§åˆ«å¼•ç”¨</h2><p>æœ‰äº›æ—¶å€™, æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾æˆ‘ä»¬çš„<code>.ipa</code>é‡Œé¢ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨äº†æŸä¸ªAPI, è€Œå¸¸è§„æ“ä½œæ˜¯åœ¨Xcodeçš„<code>Navigation -&gt; Find</code>é‡Œé¢ç›´æ¥searchä¸€ä¸‹å°±å¯ä»¥æŸ¥åˆ°æºç ä¸Šå“ªäº›åœ°æ–¹ç›´æ¥è°ƒç”¨äº†è¯¥API.</p>
<p>è€Œå¾€å¾€è¿™ç§æƒ…å†µä¸‹å¯ä»¥è§£å†³é—®é¢˜çš„è¯å°±ä¸ä¼šè·‘å»<code>Google</code>äº†.</p>
<h2 id="äºŒè¿›åˆ¶çº§åˆ«å¼•ç”¨"><a href="#äºŒè¿›åˆ¶çº§åˆ«å¼•ç”¨" class="headerlink" title="äºŒè¿›åˆ¶çº§åˆ«å¼•ç”¨"></a>äºŒè¿›åˆ¶çº§åˆ«å¼•ç”¨</h2><p>APPæ€»ä¼šé€šè¿‡å„ç§æ‰‹æ®µé›†æˆäº›åˆ«äººçš„ç¬¬ä¸‰æ–¹åº“, è€Œæ­¤åº“ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆæˆ‘ä»¬ä¸€èˆ¬å¹¶ä¸èƒ½ååˆ†äº†è§£(å¦‚æœèƒ½äº†è§£å¤§æ¦‚äººå®¶å°±å¼€æºäº†å§). è¿™ä¸ªæ—¶å€™è¦å¦‚ä½•æŸ¥æ‰¾è¿™äº›åº“æœ‰æ²¡æœ‰ä½¿ç”¨æŸAPIè¯¥å’‹åŠå‘¢?</p>
<h3 id="å®šä½ç©¶ç«Ÿæœ‰è°åœ¨åŒ…å«"><a href="#å®šä½ç©¶ç«Ÿæœ‰è°åœ¨åŒ…å«" class="headerlink" title="å®šä½ç©¶ç«Ÿæœ‰è°åœ¨åŒ…å«"></a>å®šä½ç©¶ç«Ÿæœ‰è°åœ¨åŒ…å«</h3><p>æˆ‘ä»¬æäº¤<code>App Store</code>éƒ½æ˜¯æ‰“åŒ…æˆ<code>.ipa</code>æäº¤,æ‰€ä»¥æˆ‘ä»¬å…ˆå°†<code>.ipa</code>é‡å‘½å<code>.zip</code>å¹¶è§£å‹. ç„¶åå‡è®¾æˆ‘ä»¬éœ€è¦æ‰¾çš„æ˜¯<code>UIWebView</code>, <code>Terminal</code>æå¼€,åˆ°è§£å‹åçš„ç›®å½•.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">â•­â”€Bingo@madordie xxx.app</span><br><span class="line">â•°â”€&gt;$ find . -print0 | xargs -0 grep -s <span class="string">'UIWebView'</span></span><br></pre></td></tr></table></figure>

<p>ä¾¿å¾—åˆ°<code>xxx.app</code>å†…æ‰€æœ‰åŒ…å«<code>UIWebView</code>å­—ç¬¦çš„æ–‡ä»¶(åŒ…æ‹¬Mach-O). è¿™ä¸ªæ—¶å€™è¾“å‡ºçš„è¡Œ<code>Binary file ./XXXX/YYYY matches</code>å³ä¸ºåŒ¹é…åˆ°äº†.</p>
<p>æ­¤æ—¶å®šä½åˆ°<code>XXXX/YYYY</code>å†…å«æœ‰<code>UIWebView</code>.</p>
<p>å¦å¤–: ä¸Šè¿°å‘½ä»¤åœ¨é¡¹ç›®ä¸»ç›®å½•æ‰§è¡Œä¹Ÿå¯ä»¥æœç´¢åˆ°, åªä¸è¿‡é™¤äº†<code>Navigation -&gt; Find</code>é‡Œsearchçš„è¿˜æœ‰å…¶ä»–çš„, å†…å®¹å¦‚æœå¤šçš„è¯å¯ä»¥å†ç”¨<code>grep</code>è¿‡æ»¤ä¸€æ¬¡.</p>
<p>æ¯”å¦‚åªå…³å¿ƒ<code>Binary file</code>:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">â•­â”€Bingo@madordie project-main-path</span><br><span class="line">â•°â”€&gt;$ find . -print0 | xargs -0 grep -s <span class="string">'UIWebView'</span> | grep <span class="string">'^Binary'</span></span><br></pre></td></tr></table></figure>

<h3 id="è¿™ä¸ªAPIåœ¨Mach-Oä¸­æ˜¯ä»€ä¹ˆ"><a href="#è¿™ä¸ªAPIåœ¨Mach-Oä¸­æ˜¯ä»€ä¹ˆ" class="headerlink" title="è¿™ä¸ªAPIåœ¨Mach-Oä¸­æ˜¯ä»€ä¹ˆ"></a>è¿™ä¸ªAPIåœ¨Mach-Oä¸­æ˜¯ä»€ä¹ˆ</h3><h4 id="æœ‰å­—ç¬¦ä¸²å—"><a href="#æœ‰å­—ç¬¦ä¸²å—" class="headerlink" title="æœ‰å­—ç¬¦ä¸²å—"></a>æœ‰å­—ç¬¦ä¸²å—</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">â•­â”€Bingo@madordie xxx.app</span><br><span class="line">â•°â”€&gt;$ strings ./XXXX/YYYY | grep <span class="string">'UIWebView'</span></span><br><span class="line">T@<span class="string">"UIWebView"</span>,R,N,V_webView</span><br><span class="line">UIWebViewDelegate</span><br><span class="line">B40@0:8@<span class="string">"UIWebView"</span>16@<span class="string">"NSURLRequest"</span>24q32</span><br><span class="line">v24@0:8@<span class="string">"UIWebView"</span>16</span><br><span class="line">v32@0:8@<span class="string">"UIWebView"</span>16@<span class="string">"NSError"</span>24</span><br><span class="line">@<span class="string">"UIWebView"</span></span><br></pre></td></tr></table></figure>

<h4 id="æœ‰symbolå—"><a href="#æœ‰symbolå—" class="headerlink" title="æœ‰symbolå—"></a>æœ‰symbolå—</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">â•­â”€Bingo@madordie xxx.app</span><br><span class="line">â•°â”€&gt;$ nm ./XXXX/YYYY | grep <span class="string">'UIWebView'</span></span><br><span class="line">                 U _OBJC_CLASS_<span class="variable">$_UIWebView</span></span><br></pre></td></tr></table></figure>

<h3 id="å€¼å¾—è¯´ä¸€ä¸‹"><a href="#å€¼å¾—è¯´ä¸€ä¸‹" class="headerlink" title="å€¼å¾—è¯´ä¸€ä¸‹"></a>å€¼å¾—è¯´ä¸€ä¸‹</h3><p>é€šè¿‡ä¸Šé¢çš„æ“ä½œåŸºæœ¬ä¸Šå¯ä»¥æ£€ç´¢å‡ºæ¥App StoreæŸ¥åˆ°çš„API, ä½†æ˜¯è¯´å…¶ä»–çš„å­—ç¬¦ä¸²æ‹¼æ¥/åŠ å¯†çš„æ–¹æ¡ˆå»ç»•è¿‡çš„è¯,é‚£ä¹ˆå°±é—®é—®ä½œè€…å§â€¦</p>
<p>çœŸä¸è¡Œä½¿ç”¨é€†å‘åˆ†æå·¥å…·å»åˆ†æä¹Ÿå¯ä»¥. ä½†æ˜¯ä¸ªäººè§‰å¾—ç¨å¾®æœ‰ç‚¹å¤§æå°ç”¨ :)</p>
<p>ä¸Šé¢ä½¿ç”¨çš„å‘½ä»¤çš„æ–‡æ¡£å‡å¯é€šè¿‡<code>man xxx</code>ã€<code>xxx --help</code>ã€Googleç­‰æ–¹å¼æŸ¥è¯¢å°±ä¸å•°å—¦äº†.</p>
<h3 id="UIWebViewçš„åºŸå¼ƒé€šå‘Š"><a href="#UIWebViewçš„åºŸå¼ƒé€šå‘Š" class="headerlink" title="UIWebViewçš„åºŸå¼ƒé€šå‘Š"></a>UIWebViewçš„åºŸå¼ƒé€šå‘Š</h3><p><a href="https://developer.apple.com/cn/news/?id=12232019b" target="_blank" rel="noopener">æ›´æ–°ä½¿ç”¨ç½‘é¡µè§†å›¾çš„ App</a></p>
<blockquote>
<p>æ›´æ–°ä½¿ç”¨ç½‘é¡µè§†å›¾çš„ App<br>2019 å¹´ 12 æœˆ 23 æ—¥</p>
<p>å¦‚æœæ‚¨çš„ app ä»åœ¨ä½¿ç”¨å·²å¼ƒç”¨çš„ UIWebView API åµŒå…¥ç½‘ç»œå†…å®¹ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨å°½å¿«æ›´æ–°ä¸º WKWebView ä»¥æå‡å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚WKWebView å¯å°†ç½‘é¡µå¤„ç†é™åˆ¶åœ¨ app çš„ç½‘é¡µè§†å›¾ä¸­ï¼Œä»è€Œç¡®ä¿ä¸å®‰å…¨çš„ç½‘ç«™å†…å®¹ä¸ä¼šå½±å“åˆ° app çš„å…¶ä»–éƒ¨åˆ†ã€‚æ­¤å¤–ï¼ŒiOSã€macOS å’Œ Mac Catalyst å‡æ”¯æŒ WKWebViewã€‚</p>
<p>2020 å¹´ 4 æœˆèµ· App Store å°†ä¸å†æ¥å—ä½¿ç”¨ UIWebView çš„æ–° appï¼Œ2020 å¹´ 12 æœˆèµ·å°†ä¸å†æ¥å—ä½¿ç”¨ UIWebView çš„ app æ›´æ–°ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>iOS</category>
        <category>macOS</category>
      </categories>
      <tags>
        <tag>DEBUG</tag>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•æ­£ç¡®çš„è¿ç»­æ¨æ–°é¡µé¢</title>
    <url>/post/push-queue-for-navigation/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="é¢˜è®°"><a href="#é¢˜è®°" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h2><p>å½“ä½¿ç”¨æŸä¸ªé¡µé¢è¿˜æ²¡æœ‰è¿›è¡ŒviewDidAppear:çš„æ—¶å€™å†è¿›è¡Œä¸€æ¬¡æ¨é¡µé¢æ˜¯ä¸å®‰å…¨çš„ã€‚è‹¹æœåœ¨iPhone5C iOS7.1.2ä¸­Pushæ—¶ç»™å‡ºçš„è­¦å‘Šï¼š</p>
<blockquote>
<p>â€œnested push animation can result in corrupted navigation bar. Finishing up a navigation transition in an unexpected state. Navigation Bar subview tree might get corrupted.â€</p>
</blockquote>
<p>è¿™è¯´æ˜è¿™ä¸ªä¸å®‰å…¨çš„æ“ä½œå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨Crashï¼ŒCrashç»Ÿè®¡ç³»ç»Ÿç»Ÿè®¡çš„åŸå› ä¸ºï¼š</p>
<blockquote>
<p>â€œCanâ€™t add self as subviewâ€ã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°è¯•è§£å†³è¯¥Crashï¼Œå®ç°åµŒå¥—å®‰å…¨çš„å»æ¨é¡µé¢ã€‚</p>
<a id="more"></a>

<h2 id="é—®é¢˜æ‰€åœ¨"><a href="#é—®é¢˜æ‰€åœ¨" class="headerlink" title="é—®é¢˜æ‰€åœ¨"></a>é—®é¢˜æ‰€åœ¨</h2><p>è‹¹æœç»™å‡ºçš„è­¦å‘Šä¸­æŒ‡å‡ºåµŒå¥—æ¨é¡µé¢å¯èƒ½å¯¼è‡´å¯¼èˆªæ æŸåï¼Œå…¶å¯¼èˆªæ å­è§†å›¾æ ‘å¯èƒ½æŸåã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘å¯¹VC1è¿›è¡ŒPushå‡ºVC2æ—¶å€™è¦æ³¨æ„ï¼Œå¿…é¡»è¦ç­‰åˆ°VC1æ˜¾ç¤ºå‘¨æœŸå®Œå…¨ç»“æŸï¼Œæ‰èƒ½è¿›è¡ŒPushVC2æ“ä½œã€‚</p>
<p>æ­¤é—®é¢˜çš„å‘ç”Ÿå¹¶ä¸æ˜¯ç®€å•çš„ä¸€ä¸ªä»£ç å—ä¸­ä½¿ç”¨åŒä¸€ä¸ªå¯¼èˆªæ§åˆ¶å™¨è¿›è¡Œè¿ç»­Pushæ“ä½œã€‚å›æƒ³ä¸€ä¸‹<code>ViewController</code>çš„ç”Ÿå‘½å‘¨æœŸã€‚å…¶å®æ ‡å¿—ç€<code>ViewController</code>å®Œå…¨æ˜¾ç¤ºçš„æ˜¯<code>viewDidAppear:</code>è°ƒç”¨ï¼Œé‚£ä¹ˆåœ¨æ­¤æ–¹æ³•ç”Ÿå‘½å‘¨æœŸä¹‹å‰çš„æ–¹æ³•ä¸­è¿›è¡ŒPushå‡æœ‰å¯èƒ½é€ æˆâ€œnested push animation can result in corrupted navigation barâ€ã€‚</p>
<p>ç”±äºiOS7.1.2çš„iPhone5Cè¢«å‡çº§ï¼Œæ— æ³•å¿…ç°æ­¤BUGï¼Œæ‰€ä»¥æ²¡æœ‰æˆªå›¾ã€‚å¯ä»¥è‡ªå·±æ‰¾ä¸ªæµ‹ä¸€ä¸‹ã€‚ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ–¹æ¡ˆä¸€ï¼šé€šè¿‡å»¶æ—¶é¿å¼€æ­¤æ—¶é—´æ®µã€‚"><a href="#æ–¹æ¡ˆä¸€ï¼šé€šè¿‡å»¶æ—¶é¿å¼€æ­¤æ—¶é—´æ®µã€‚" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šé€šè¿‡å»¶æ—¶é¿å¼€æ­¤æ—¶é—´æ®µã€‚"></a>æ–¹æ¡ˆä¸€ï¼šé€šè¿‡å»¶æ—¶é¿å¼€æ­¤æ—¶é—´æ®µã€‚</h3><p>åœ¨å¾ˆå¤šæºç ä¸­ä¼šçœ‹åˆ°è¿™æ ·ä¸€è¡Œä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;  0.1æ˜¯æˆ‘éšæ‰‹å†™çš„ã€‚ã€‚æ˜¯ä¸€ä¸ªæ ¹æ®è‡ªå·±æƒ…å†µä¼°ç®—ä¸Šä¸€ä¸ªPUSHçš„è€—æ—¶ï¼Œ</span><br><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.1 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    [self.navigationController pushViewController:vc animated:YES];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šä»£ç ï¼Œåœ¨<a href="https://github.com/search?utf8=%E2%9C%93&q=dispatch_after+pushViewController%253A&type=Code&ref=searchresults" target="_blank" rel="noopener">GitHubä¸­å¾ˆå¸¸è§</a>ï¼Œèµ·åˆå¹¶ä¸æ‡‚å…¶ç”¨æ„ï¼Œå½“é‡åˆ°è¿™ä¸ªé—®é¢˜æ—¶å€™æˆ‘æ‰æ˜ç™½ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;  objccn.io</span><br><span class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    &#x2F;&#x2F; Some UIKit call that had timing issues but works fine</span><br><span class="line">    &#x2F;&#x2F; in the next runloop.</span><br><span class="line">    [self updatePopoverSize];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¿™ç§ä»£ç æ˜¯åˆ‡æ¢åˆ°ä¸‹ä¸ªä»£ç å‘¨æœŸï¼Œæ¥é¿å¼€åµŒå¥—çš„æ—¶åºé—®é¢˜ã€‚<a href="https://objccn.io/issue-2-4/" target="_blank" rel="noopener">objc.io</a>æœ‰è¿™ä¹ˆä¸ªæ–‡ç« è¯´äº†è¿™ä¸ªé—®é¢˜çš„å¼Šç«¯ï¼š</p>
<blockquote>
<p>ç”¨ <code>dispatch_async</code> ä¿®å¤æ—¶åºé—®é¢˜</p>
</blockquote>
<blockquote>
<p>åœ¨ä½¿ç”¨ UIKit çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›æ—¶åºä¸Šçš„éº»çƒ¦ï¼Ÿå¾ˆå¤šæ—¶å€™ï¼Œè¿™æ ·è¿›è¡Œâ€œä¿®æ­£â€çœ‹æ¥éå¸¸å®Œç¾ï¼š</p>
</blockquote>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">   &#x2F;&#x2F; Some UIKit call that had timing issues but works fine</span><br><span class="line">   &#x2F;&#x2F; in the next runloop.</span><br><span class="line">   [self updatePopoverSize];</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>
<p>åƒä¸‡åˆ«è¿™ä¹ˆåšï¼ç›¸ä¿¡æˆ‘ï¼Œè¿™ç§åšæ³•å°†ä¼šåœ¨ä¹‹åä½ çš„ app è§„æ¨¡å¤§ä¸€äº›çš„æ—¶å€™è®©ä½ æ‰¾ä¸ç€åŒ—ã€‚è¿™ç§ä»£ç éå¸¸éš¾ä»¥è°ƒè¯•ï¼Œå¹¶ä¸”ä½ å¾ˆå¿«å°±ä¼šé™·å…¥ç”¨æ›´å¤šçš„ dispatch æ¥ä¿®å¤æ‰€è°“çš„è«åå…¶å¦™çš„â€æ—¶åºé—®é¢˜â€ã€‚å®¡è§†ä½ çš„ä»£ç ï¼Œå¹¶ä¸”æ‰¾åˆ°åˆé€‚çš„åœ°æ–¹æ¥è¿›è¡Œè°ƒç”¨ï¼ˆæ¯”å¦‚åœ¨ viewWillAppear é‡Œè°ƒç”¨ï¼Œè€Œä¸æ˜¯ viewDidLoad ä¹‹ç±»çš„ï¼‰æ‰æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æ­£ç¡®åšæ³•ã€‚æˆ‘åœ¨è‡ªå·±çš„ä»£ç ä¸­ä¹Ÿè¿˜ç•™æœ‰ä¸€äº›è¿™æ ·çš„ hackï¼Œä½†æ˜¯æˆ‘ä¸ºå®ƒä»¬åŸºæœ¬éƒ½åšäº†æ­£ç¡®çš„æ–‡æ¡£å·¥ä½œï¼Œå¹¶ä¸”å¯¹åº”çš„ issue ä¹Ÿè¢«ä¸€ä¸€è®°å½•è¿‡ã€‚</p>
</blockquote>
<p>è®°ä½è¿™ä¸æ˜¯çœŸæ­£çš„ <code>GCD</code> ç‰¹æ€§ï¼Œè€Œåªæ˜¯ä¸€ä¸ªåœ¨ <code>GCD</code> ä¸‹å¾ˆå®¹æ˜“å®ç°çš„å¸¸è§åé¢æ¨¡å¼ã€‚äº‹å®ä¸Šä½ å¯ä»¥ä½¿ç”¨ <code>performSelector:afterDelay:</code> æ–¹æ³•æ¥å®ç°åŒæ ·çš„æ“ä½œï¼Œå…¶ä¸­ <code>delay</code> æ˜¯åœ¨å¯¹åº”æ—¶é—´åçš„ <code>runloop</code>ã€‚</p>
<p>å…¶å®è¿™æ ·è®¾è®¡å¾ˆç®€å•ï¼Œç›®çš„å°±æ˜¯é€šè¿‡<code>GCD</code>çš„å»¶è¿Ÿæäº¤æ¥â€œå·§å¦™â€çš„é¿å¼€Pushçš„æ—¶é—´ï¼Œå¾ˆæ˜¾ç„¶è¿™ä¸ªæ—¶é—´å¯¹äºæœºå‹ã€ç³»ç»Ÿç‰ˆæœ¬ã€å½“å‰æ‰‹æœºçŠ¶å†µæ¥è¯´å¾ˆéš¾æŠŠæ¡ã€‚ä½†æ˜¯ä¸å¾—ä¸è¯´çš„æ˜¯ç¡®å®æœ‰äº›ä½œç”¨ï¼Œé‚£å°±æ˜¯èƒ½é¿å¼€éƒ¨åˆ†é—®é¢˜ã€‚æ‰€ä»¥æœ¬æ¥å°æ¦‚ç‡å‘ç”Ÿçš„äº‹æƒ…ï¼Œè¿™ä¸ªå†è¿‡æ»¤ä¸€äº›ï¼Œè¿™ä¸ªBUGå°±å¾®ä¹å…¶å¾®äº†ã€‚</p>
<h3 id="æ–¹æ¡ˆäºŒï¼šå¼ºåˆ¶åœ¨viewDidAppear-ä¹‹åè¿›è¡ŒPushã€‚"><a href="#æ–¹æ¡ˆäºŒï¼šå¼ºåˆ¶åœ¨viewDidAppear-ä¹‹åè¿›è¡ŒPushã€‚" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šå¼ºåˆ¶åœ¨viewDidAppear:ä¹‹åè¿›è¡ŒPushã€‚"></a>æ–¹æ¡ˆäºŒï¼šå¼ºåˆ¶åœ¨<code>viewDidAppear:</code>ä¹‹åè¿›è¡ŒPushã€‚</h3><p>ä¸å¾—ä¸è¯´è¿™æ ·çš„åšæ³•æˆ‘æ›¾ç»ç”¨è¿‡ä¸€ä¸ªé¡µé¢ï¼Œä¸å¤šè¯´ï¼Œéº»çƒ¦ç¨‹åº¦è‡ªå·±æµ‹ä¸€ä¸‹ã€‚</p>
<p>å¦‚æœè¯´å¤šäººåˆä½œé¡¹ç›®å‘¢ï¼Œå¦‚æœè¯´é¡µé¢æ¯”è¾ƒå¤šã€å·¥ä½œæ¯”è¾ƒå¿™å‘¢ï¼Ÿå‘µå‘µå“’</p>
<h3 id="æ–¹æ¡ˆä¸‰ï¼šå¯¹UINavigationControlleræ‰€Pushçš„VCè¿›è¡Œé˜Ÿåˆ—åŒ–ã€‚"><a href="#æ–¹æ¡ˆä¸‰ï¼šå¯¹UINavigationControlleræ‰€Pushçš„VCè¿›è¡Œé˜Ÿåˆ—åŒ–ã€‚" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šå¯¹UINavigationControlleræ‰€Pushçš„VCè¿›è¡Œé˜Ÿåˆ—åŒ–ã€‚"></a>æ–¹æ¡ˆä¸‰ï¼šå¯¹<code>UINavigationController</code>æ‰€Pushçš„VCè¿›è¡Œé˜Ÿåˆ—åŒ–ã€‚</h3><p>å¯¹äºVCæ˜¯å¦å·²ç»Pushç»“æŸï¼Œ<code>UINavigationController</code>æœ€æ¸…æ¥šï¼Œè€Œè¿™ä¸€ç»“æœåˆšå¥½é€šè¿‡ä»£ç†ä¼ é€’å‡ºæ¥ã€‚æ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹å¯¹Pushçš„VCsè¿›è¡Œé˜Ÿåˆ—åŒ–ï¼Œé˜²æ­¢å…¶è¿›è¡ŒåµŒå¥—Pushã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜å°±å¯ä»¥å¾—åˆ°å¾ˆå¥½çš„è§£å†³ã€‚</p>
<p>å¯¹ æ–¹æ¡ˆä¸‰ çš„è¯¦ç»†å°è£…</p>
<p>å¯¹äºè¯¥é—®é¢˜çš„æœ€ç®€å•çš„ã€ä¾¿äºåˆä½œã€ä¾¿äºæ›´æ”¹çš„å°±æ˜¯æ–¹æ¡ˆä¸‰äº†ï¼Œå¯¹æ–¹æ¡ˆä¸‰è¿›è¡Œå±•å¼€å¯å¾—å¦‚ä¸‹æ­¥éª¤ï¼š</p>
<p>è®¾ç½®<code>UINavigationController</code>çš„ä»£ç†ï¼Œå¹¶å®ç°<code>willShowViewController</code>ã€<code>didShowViewController</code>æ–¹æ³•ã€‚</p>
<p>æ‹¦æˆªåˆ°<code>UINavigationController</code>çš„Pushæ–¹æ³•ï¼Œé€šè¿‡æ­¥éª¤1çš„ä»£ç†åˆ¤æ–­åˆ°æ˜¯å¦æ­£åœ¨Show,å¦‚æœä¸åœ¨Showåˆ™æ˜¾ç¤ºï¼Œå¦‚æœæ­£åœ¨Showåˆ™æŠŠå½“å‰çš„VCå…¥é˜Ÿåˆ—ã€‚<br>åœ¨didShowViewControllerä¸­åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰åˆ™è¯´æ˜å‘ç”Ÿäº†é‡å ï¼Œè¯¥é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªè¿›è¡ŒPushã€‚<br>ä¸ºäº†æ›´å¥½çš„å…¼å®¹æ‰€é‡åˆ°çš„Pushæƒ…å†µï¼Œä½¿ç”¨0.5ç§’ä½œä¸ºå…œåº•ï¼Œå¯¹é˜Ÿåˆ—è¿›è¡Œæ”¾å¼€ã€‚<br>ç»“æŸï¼Œå°±æ˜¯è¿™æ ·å­ã€‚</p>
<p>è¯´ä¸‹æˆ‘å®ç°çš„æ–¹æ³•ï¼Œå…¶å®é‡ç‚¹åœ¨äºå¦‚ä½•æ‹¦æˆªPushæ“ä½œã€‚</p>
<p>æˆ‘æœ€å¼€å§‹é‡‡ç”¨äº†ç»§æ‰¿<code>UINavigationController</code>çš„æ–¹æ³•ï¼Œå› ä¸ºç»§æ‰¿ä½†ä¸€ï¼Œä¸ä¼šå¹²æ‰°å…¶ä»–çš„ç±»ã€‚å€¼å¾—ä¸€èµã€‚</p>
<p>å¯¹äºè¦è§£å†³å…¶é—®é¢˜ï¼Œæ‰€æœ‰çš„éƒ½éœ€è¦è¿›è¡Œç»§æ‰¿ï¼Œè¿‡äºéº»çƒ¦ï¼Œäºæ˜¯å¢åŠ äº†ç¬¬äºŒç§æ–¹æ¡ˆï¼šHOOKã€‚</p>
<p>ä¸¤ç§æ–¹æ¡ˆä¸ºäº†è¾¾åˆ°ç»Ÿä¸€çš„æ•ˆæœï¼Œæ‰€ä»¥æ‹‰å‡ºå…¶ä¸­çš„ä»£ç†ï¼Œå°±å®Œæˆäº†ç»Ÿä¸€ã€‚</p>
<p><a href="https://github.com/madordie/KTJPushQueueForNavigation.git" target="_blank" rel="noopener">ä»£ç ï¼‹Demo</a></p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>debug</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å®ç°AppStoreæŸ¥çœ‹æ›´å¤šçš„æ–¹æ³•</title>
    <url>/post/appstore-truncate/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="UITextView-More"><a href="#UITextView-More" class="headerlink" title="UITextView-More"></a><a href="https://github.com/madordie/UITextView-More" target="_blank" rel="noopener">UITextView-More</a></h2><p>ä½¿ç”¨UITextKit å®ç°â€œæ›´å¤šâ€çš„æŠ˜å æ•ˆæœ</p>
<p><img src="https://github.com/madordie/UITextView-More/blob/master/Untitled.gif?raw=true" alt="é¢„è§ˆ"></p>
<a id="more"></a>

<h2 id="ä¸»è¦ä»£ç "><a href="#ä¸»è¦ä»£ç " class="headerlink" title="ä¸»è¦ä»£ç "></a>ä¸»è¦ä»£ç </h2><h3 id="è·å–æœ€åä¸€è¡ŒRect"><a href="#è·å–æœ€åä¸€è¡ŒRect" class="headerlink" title="è·å–æœ€åä¸€è¡ŒRect"></a>è·å–æœ€åä¸€è¡ŒRect</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> lastRect = <span class="type">CGRect</span>.zero</span><br><span class="line">layoutManager.enumerateEnclosingRects(forGlyphRange: <span class="type">NSRange</span>(location: <span class="number">0</span>, length: textStorage.string.characters.<span class="built_in">count</span>), withinSelectedGlyphRange: <span class="type">NSRange</span>(location: <span class="type">NSNotFound</span>, length: <span class="number">0</span>), <span class="keyword">in</span>: textContainer, using: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (rect, isStop) <span class="keyword">in</span></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> _self = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="keyword">var</span> newRect = rect</span><br><span class="line">newRect.origin.y += _self.textContainerInset.top</span><br><span class="line">lastRect = newRect</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(lastRect)</span><br></pre></td></tr></table></figure>

<h3 id="å¢åŠ -exclusionPaths"><a href="#å¢åŠ -exclusionPaths" class="headerlink" title="å¢åŠ  exclusionPaths"></a>å¢åŠ  <code>exclusionPaths</code></h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">textContainer.exclusionPaths = [<span class="type">UIBezierPath</span>.<span class="keyword">init</span>(rect: rect)]</span><br></pre></td></tr></table></figure>

<h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><ul>
<li><code>UITextView</code>é»˜è®¤æºå¸¦å·¦å³è¾¹è·ï¼Œé€šè¿‡<code>UITextView.textContainer.lineFragmentPadding</code>è·å–</li>
<li><code>UITextView</code>é»˜è®¤æºå¸¦ä¸Šä¸‹å·¦å³è¾¹è·(<code>UITextView.textContainerInset</code>)ï¼Œå…¶ä¸­å·¦å³å’Œ<code>lineFragmentPadding</code>ç›¸åŠ </li>
<li>æ­¤å¤„å¹¶æ²¡æœ‰å¯¹<a href="https://github.com/madordie/UITextView-More/blob/master/TruncateTextView.swift" target="_blank" rel="noopener">TruncateTextView</a>è¿›è¡Œè¿‡å¤šçš„è®¾ç½®ï¼Œä¸»è¦æ˜¯å› ä¸ºç»§æ‰¿åœ¨UITextViewä¸‹ï¼Œ<a href="https://github.com/madordie/UITextView-More/blob/master/Untitled.gif" target="_blank" rel="noopener">GIF</a>ä¸­çš„è¿™éƒ¨åˆ†è®¾ç½®æ”¾åœ¨äº†<a href="https://github.com/madordie/UITextView-More/blob/master/Demo-AppStore-More/ViewController.swift" target="_blank" rel="noopener">ViewController.swift</a>ä¸­</li>
<li>æ­¤å¤„ä½¿ç”¨çš„æ˜¯<code>frame</code>ï¼Œå¯ä»¥åœ¨<code>UIView.sizeToFit()</code>ä¹‹åè·å–åˆ°<code>UIView</code>çš„<code>Size</code>ã€‚çº¦æŸä¹Ÿå¤§æŠµå¦‚æ­¤</li>
</ul>
<hr>
<ul>
<li>æ„Ÿè°¢<a href="https://github.com/lexiaoyao20" target="_blank" rel="noopener">ä¹é€é¥</a>æä¾›çš„ä¾‹å­ï¼Œæ‰æ‰¾åˆ°äº†<code>open func truncatedGlyphRange(inLineFragmentForGlyphAt glyphIndex: Int) -&gt; NSRange</code>æ–¹æ³•ğŸ˜‚</li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ•ˆæœ</tag>
      </tags>
  </entry>
  <entry>
    <title>Swift ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–ç¬”è®°</title>
    <url>/post/swift-build-times/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Xcodeåœ¨ç¼–è¯‘Swiftä»£ç çš„æ—¶å€™é€Ÿåº¦ä¼šè¶Šæ¥è¶Šæ…¢ï¼Œå°±æ­¤æŸ¥æ‰¾åŸå› ï¼Œå¹¶åˆ—å‡ºè‡ªå·±çš„ä¼˜åŒ–æ€è·¯ã€‚</p>
<a id="more"></a>

<h3 id="Xcode8-2"><a href="#Xcode8-2" class="headerlink" title="Xcode8.2"></a>Xcode8.2</h3><p>æ·»åŠ <code>User-Defind</code>æ–°çš„<code>SWIFT_WHOLE_MODULE_OPTIMIZATION = YES</code>å¯ä»¥è¿‡æ»¤ä¸ºä¿®æ”¹frameworkã€‚</p>
<h3 id="é’ˆå¯¹è¿ç®—ç¬¦-çš„ä¼˜åŒ–"><a href="#é’ˆå¯¹è¿ç®—ç¬¦-çš„ä¼˜åŒ–" class="headerlink" title="é’ˆå¯¹è¿ç®—ç¬¦??çš„ä¼˜åŒ–"></a>é’ˆå¯¹è¿ç®—ç¬¦<code>??</code>çš„ä¼˜åŒ–</h3><p>åœ¨ä½¿ç”¨<code>??</code>æ—¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½éœ€è¦ä¼˜åŒ–ï¼ŒåŒ…è£¹åœ¨å¾ªç¯ä¸­çš„<code>??</code>ä¼šæ¯”è¾ƒè€—æ—¶æ¯”è¾ƒå‰å®³ï¼Œç›®å‰ä¸çŸ¥é“ä¸ºå•¥ï¼Œä¼°è®¡ç¼–è¯‘çš„æ—¶å€™éœ€è¦æ£€æŸ¥çš„æ­¤æ—¶æ¯”è¾ƒå¤šå§ğŸ˜‚ã€‚</p>
<h4 id="å°è¯•æ˜¾å¼è§£åŒ…"><a href="#å°è¯•æ˜¾å¼è§£åŒ…" class="headerlink" title="å°è¯•æ˜¾å¼è§£åŒ…"></a>å°è¯•æ˜¾å¼è§£åŒ…</h4><p><strong>æ€è·¯__ï¼š<code>??</code>ç¼–è¯‘æ…¢ï¼Œå°±ä¸ç”¨<code>??</code>ï¼Œç›´æ¥ä½¿ç”¨<code>if else</code><br>__å®æ–½</strong>: ç”±äºå·¥ç¨‹ä¸­ä½¿ç”¨çš„<code>??</code>æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æ¯”è¾ƒä¿®æ”¹èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚ä½†æ˜¯å¯ä»¥è§£å†³é—®é¢˜ã€‚çœŸä¸è¡Œå†™æ–¹æ³•è½¬åŒ–è°ƒç”¨å–½ã€‚ã€‚</p>
<h4 id="é”™è¯¯çš„å°è¯•äº†é‡è½½è¿ç®—ç¬¦-æ–¹å¼"><a href="#é”™è¯¯çš„å°è¯•äº†é‡è½½è¿ç®—ç¬¦-æ–¹å¼" class="headerlink" title="é”™è¯¯çš„å°è¯•äº†é‡è½½è¿ç®—ç¬¦??æ–¹å¼"></a>é”™è¯¯çš„å°è¯•äº†é‡è½½è¿ç®—ç¬¦<code>??</code>æ–¹å¼</h4><p><strong>æ€è·¯</strong>: <code>??</code>è¿ç®—ç¬¦ç¼–è¯‘è€—æ—¶è¾ƒå¤šï¼Œç›´è§‰æ˜¯<code>??</code>å®ç°æœ‰å¤æ‚çš„æ“ä½œ,é‡æ–°æŒ‰ç…§æ˜¾å¼è§£åŒ…çš„æ–¹æ¡ˆè¿›è¡Œå®ç°ã€‚<br><strong>å®æ–½</strong>: </p>
<ul>
<li>åˆ†æ<code>??</code>çš„ä½¿ç”¨åœºæ™¯ï¼Œå·¦ä¾§ä¸ºT?,å³ä¾§ä¸ºTï¼Œè¿”å›å€¼T</li>
<li>é‡è½½å‡½æ•°åå®šä¹‰<code>public func ?? &lt;T&gt;(left: T?, right: T) -&gt; T</code></li>
<li>å®ç°</li>
<li>ç¼–è¯‘</li>
<li>errorï¼š<code>Ambiguous use of operator &#39;??&#39;</code></li>
<li>æ€è€ƒï¼šè¿™ä¸«çš„åœ¨é‡è½½è¿ç®—ç¬¦çš„æ—¶å€™ä¸èƒ½ä½¿ç”¨æ³›å‹å§ã€‚ã€‚</li>
<li>æ›´æ”¹å‡½æ•°ä¸º<code>public func ?? &lt;Any&gt;(left: Any?, right: Any) -&gt; Any</code></li>
<li>PL. OKäº†ï¼Œå¯æ˜¯é—®é¢˜æ¥äº†ï¼Œç³»ç»Ÿçš„<code>??</code>æ˜¯å¯ä»¥è¿”å›å¯¹åº”çš„ç±»å‹ï¼Œå¯æ˜¯è¿™æ ·é‡è½½ä¹‹åè¿”å›ä¸€ä¸ª<code>Any</code>ï¼Œä»£ç ä¸­å¦‚æœå‡ºç°<code>let str = str1 ?? &quot;&quot;</code>åˆ™strç±»å‹å°±å˜ä¸º<code>Any</code>è€Œä¸æ˜¯<code>String</code>ã€‚<strong>å·¨å‘</strong></li>
<li>é¡¾ä¸äº†é‚£ä¹ˆå¤šäº†ï¼ŒçœŸä¸è¡Œä¸€ä¸ªä¸€ä¸ªè·‘ã€‚äºæ˜¯å…ˆä¿®æ”¹ä¸€ä¸ªè¾ƒä¸ºä¸¥é‡çš„<code>String</code>ç±»å‹ã€‚</li>
<li>å°è¯•ç¼–è¯‘ï¼Œç»“æœæ—¶é—´æƒŠäººçš„æ²¡æœ‰å˜åŒ–ã€‚ã€‚ä¾æ—§å±…é«˜ä¸ä¸‹</li>
<li>ä»¥å¤±è´¥å‘Šç»ˆã€‚ã€‚</li>
</ul>
<p><strong>æ€»ç»“</strong>: è¿™ä¸ª<code>??</code>è€—æ—¶è¾ƒå¤šå¹¶ä¸æ˜¯å› ä¸º<code>??</code>çš„å®ç°æœ‰é—®é¢˜ï¼Œ__çŒœæµ‹__æ˜¯åœ¨ä¸º<code>??</code>å‡†å¤‡å·¦å³å‚æ•°çš„æ—¶å€™éœ€è¦è¿›è¡Œä¸€å±‚å±‚çš„è§£åŒ…ç¡®å®šç±»å‹ï¼Œå†åŠ ä¸Š<code>??</code>å¯èƒ½æœ‰é‡è½½ç‰ˆæœ¬ï¼Œè¿›è¡Œç±»å‹åŒ¹é…çš„æ—¶å€™æ¯”è¾ƒè€—æ—¶ã€‚</p>
<h4 id="å°è¯•æ‰©å±•æ–¹æ³•è¿›è¡Œä¼˜åŒ–"><a href="#å°è¯•æ‰©å±•æ–¹æ³•è¿›è¡Œä¼˜åŒ–" class="headerlink" title="å°è¯•æ‰©å±•æ–¹æ³•è¿›è¡Œä¼˜åŒ–"></a>å°è¯•æ‰©å±•æ–¹æ³•è¿›è¡Œä¼˜åŒ–</h4><p><strong>æ€è·¯</strong>: æ—¢ç„¶è¿ç®—ç¬¦ä¼šå¯¼è‡´ç¼–è¯‘æ…¢ï¼Œé‚£ä¹ˆå°±å°è¯•ä½¿ç”¨æ–¹æ³•ç›´æ¥è¿›è¡Œè½¬æ¢ã€‚<br><strong>å®ç°</strong>: ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Operator</span> </span>&#123;</span><br><span class="line">    <span class="comment">///  ==&gt; ??</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> `<span class="title">try</span>`&lt;T&gt;<span class="params">(<span class="number">_</span> origin: T?, <span class="number">_</span> then: T)</span></span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> value = origin <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> then</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•å‘ç°ä¸Šè¿°æ–¹æ³•å¯ä»¥ä¼˜åŒ–æ—¶é—´ã€‚</p>
<hr>
<h3 id="ä»¥ä¸‹åŸæ–‡å‡ºè‡ªï¼šå…³äº-Swift-ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ€è€ƒ"><a href="#ä»¥ä¸‹åŸæ–‡å‡ºè‡ªï¼šå…³äº-Swift-ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ€è€ƒ" class="headerlink" title="ä»¥ä¸‹åŸæ–‡å‡ºè‡ªï¼šå…³äº Swift ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ€è€ƒ"></a>ä»¥ä¸‹åŸæ–‡å‡ºè‡ªï¼š<a href="https://github.com/yllziv/gold-miner/blob/1bfbb3deefd27138097415422bec2bb7e98e9715/TODO/regarding-swift-build-time-optimizations.md" target="_blank" rel="noopener">å…³äº Swift ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ€è€ƒ</a></h3><hr>
<blockquote>
<ul>
<li>åŸæ–‡é“¾æ¥ : <a href="https://medium.com/@RobertGummesson/regarding-swift-build-time-optimizations-fc92cdd91e31#.w81y3zhjr" target="_blank" rel="noopener">Regarding Swift build time optimizations</a></li>
</ul>
</blockquote>
<ul>
<li>åŸæ–‡ä½œè€… : <a href="https://medium.com/@RobertGummesson" target="_blank" rel="noopener">Robert Gummesson</a></li>
<li>è¯‘æ–‡å‡ºè‡ª : <a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a></li>
<li>è¯‘è€… : <a href="http://www.yanglonglong.com/" target="_blank" rel="noopener">æ¨é¾™é¾™</a></li>
<li>æ ¡å¯¹è€…: <a href="https://github.com/shenAlexy" target="_blank" rel="noopener">ç”³å† å</a>, <a href="https://github.com/Jack-Kingdom" target="_blank" rel="noopener">Jack King</a></li>
</ul>
<p><img src="http://ww3.sinaimg.cn/large/005SiNxygw1f3p3jimjllj31jk0dwqft.jpg"></p>
<h4 id="å…³äº-Swift-ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ€è€ƒ"><a href="#å…³äº-Swift-ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ€è€ƒ" class="headerlink" title="å…³äº Swift ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ€è€ƒ"></a>å…³äº Swift ç¼–è¯‘æ—¶æ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›æ€è€ƒ</h4><p>ä¸Šå‘¨ï¼Œæˆ‘è¯»äº† <a href="https://medium.com/@nickoneill" target="_blank" rel="noopener">@nickoneill</a> ä¸€ç¯‡ä¼˜ç§€çš„å¸–å­ <a href="https://medium.com/swift-programming/speeding-up-slow-swift-build-times-922feeba5780#.k0pngnkns" target="_blank" rel="noopener">Speeding Up Slow Swift Build Times</a> ä¹‹åï¼Œæˆ‘å‘ç°ç”¨ä¸€ä¸ªç•¥ä¸åŒä»¥å¾€çš„è§’åº¦å»è¯»Swiftä»£ç ï¼Œå¹¶ä¸æ˜¯å¾ˆéš¾ã€‚</p>
<p>ä¸€è¡Œä¹‹å‰å¾ˆç®€æ´çš„ä»£ç ï¼Œç°åœ¨å´å‡ºç°äº†æ–°çš„é—®é¢˜â€”â€”å®ƒæ˜¯å¦åº”è¯¥é‡æ„ä¸º9è¡Œä»£ç æ¥è¾¾åˆ°æ›´å¿«çš„ç¼–è¯‘é€Ÿåº¦ï¼Ÿ (<em>nil coalescing è¿ç®—ç¬¦å°±æ˜¯ä¸€ä¸ªä¾‹å­</em>)å­°è½»å­°é‡ï¼Ÿç®€æ´çš„ä»£ç è¿˜æ˜¯å¯¹ç¼–è¯‘å™¨å‹å¥½çš„ä»£ç ï¼Ÿ æˆ‘è§‰å¾—ï¼Œå®ƒå–å†³äºé¡¹ç›®çš„å¤§å°å’Œå¼€å‘è€…çš„æƒ³æ³•ã€‚</p>
<h4 id="ä½†è¯·ç­‰ç­‰â€¦-è¿™é‡Œæœ‰ä¸€ä¸ªXcodeæ’ä»¶"><a href="#ä½†è¯·ç­‰ç­‰â€¦-è¿™é‡Œæœ‰ä¸€ä¸ªXcodeæ’ä»¶" class="headerlink" title="ä½†è¯·ç­‰ç­‰â€¦ è¿™é‡Œæœ‰ä¸€ä¸ªXcodeæ’ä»¶"></a>ä½†è¯·ç­‰ç­‰â€¦ è¿™é‡Œæœ‰ä¸€ä¸ªXcodeæ’ä»¶</h4><p>åœ¨è®²ä¸€äº›ä¾‹å­ä¹‹å‰ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°äº†é€šè¿‡æ‰‹å·¥æå–æ—¥å¿—ä¿¡æ¯æ˜¯éå¸¸è€—æ—¶çš„äº‹æƒ…ã€‚é€šè¿‡å‘½ä»¤è¡Œå·¥å…·å®ç°ä¼šç›¸å¯¹å®¹æ˜“ä¸€äº›ï¼Œä½†æ˜¯æˆ‘æŠŠå®ƒå¾€å‰æ¨è¿›äº†ä¸€æ­¥ï¼šé›†æˆä¸º<a href="https://github.com/RobertGummesson/BuildTimeAnalyzer-for-Xcode" target="_blank" rel="noopener">Xcodeæ’ä»¶</a>ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/005SiNxygw1f3p3hhivppj30m809lwis.jpg"></p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ€åˆçš„ç›®çš„ä»…ä»…æ˜¯è¯†åˆ«å¹¶ä¿®å¤ä»£ç ä¸­æœ€è€—æ—¶çš„åœ°æ–¹ï¼Œä½†æ˜¯ç°åœ¨æˆ‘è§‰å¾—å®ƒæˆä¸ºäº†ä¸€ä¸ªå¿…é¡»è¦è¿­ä»£çš„è¿‡ç¨‹ã€‚è¿™æ ·æˆ‘æ‰å¯ä»¥æ›´åŠ é«˜æ•ˆåœ°æ„å»ºä»£ç ï¼Œå¹¶ä¸”é˜²æ­¢åœ¨é¡¹ç›®ä¸­å‡ºç°è€—æ—¶çš„å‡½æ•°ã€‚</p>
<h4 id="ä¸å°‘æƒŠå–œ"><a href="#ä¸å°‘æƒŠå–œ" class="headerlink" title="ä¸å°‘æƒŠå–œ"></a>ä¸å°‘æƒŠå–œ</h4><p>æˆ‘ç»å¸¸åœ¨ä¸åŒçš„ Git åˆ†æ”¯ä¸­è·³è½¬ï¼Œå¹¶ä¸”ç­‰å¾…ä¸€ä¸ªæš–æ…¢çš„é¡¹ç›®ç¼–è¯‘ç®€ç›´æ˜¯åœ¨æµªè´¹æˆ‘çš„ç”Ÿå‘½ã€‚å› æ­¤æˆ‘æ€è€ƒäº†å¾ˆé•¿æ—¶é—´ï¼Œä¸€ä¸ªç©å…·é¡¹ç›®ï¼ˆå¤§çº¦ä¸¤ä¸‡è¡Œ Swift ä»£ç ï¼‰ä¼šç¼–è¯‘å¦‚æ­¤é•¿çš„æ—¶é—´ã€‚</p>
<p>å½“æˆ‘çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´å®ƒå¦‚æ­¤æ…¢ä¹‹åï¼Œæˆ‘ä¸å¾—ä¸æ‰¿è®¤æˆ‘éœ‡æƒŠäº†ï¼Œä¸€è¡Œä»£ç å±…ç„¶éœ€è¦å‡ ç§’çš„ç¼–è¯‘æ—¶é—´ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ã€‚</p>
<h4 id="Nil-åˆå¹¶è¿ç®—ç¬¦"><a href="#Nil-åˆå¹¶è¿ç®—ç¬¦" class="headerlink" title="Nil åˆå¹¶è¿ç®—ç¬¦"></a>Nil åˆå¹¶è¿ç®—ç¬¦</h4><p>ç¼–è¯‘å™¨è‚¯å®šä¸å–œæ¬¢è¿™é‡Œçš„ç¬¬ä¸€ç§æ–¹æ³•ã€‚åœ¨å±•å¼€ä¸‹é¢ä¸¤å¤„ç®€å†™çš„ä»£ç ä¹‹åï¼Œæ„å»ºæ—¶é—´å‡å°‘äº† **99.4%**ã€‚</p>
<pre><code>// æ„å»ºæ—¶é—´ï¼š 5238.3ms
return CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height)

// æ„å»ºæ—¶é—´ï¼š 32.4ms
var padding: CGFloat = 22
if let rightView = rightView {
    padding += rightView.bounds.width
}

if let leftView = leftView {
    padding += leftView.bounds.width
}
return CGSizeMake(size.width + padding, bounds.height)</code></pre>
<h4 id="ArrayOfStuff-Stuff"><a href="#ArrayOfStuff-Stuff" class="headerlink" title="ArrayOfStuff + [Stuff]"></a>ArrayOfStuff + [Stuff]</h4><p>è¿™ä¸ªçœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code>return ArrayOfStuff + [Stuff]  
// è€Œä¸æ˜¯  
ArrayOfStuff.append(stuff)  
return ArrayOfStuff</code></pre>
<p>æˆ‘ç»å¸¸è¿™ä¹ˆåšï¼Œå¹¶ä¸”å®ƒå½±å“äº†æ¯æ¬¡æ„å»ºçš„æ—¶é—´ã€‚ä¸‹é¢æ˜¯æœ€ç³Ÿç³•çš„ä¸€ä¸ªä¾‹å­ï¼Œæ”¹å†™åæ„å»ºæ—¶é—´å¯ä»¥å‡å°‘ **97.9%**ã€‚</p>
<pre><code>// æ„å»ºæ—¶é—´ï¼š 1250.3ms
let systemOptions = [ 7, 14, 30, -1 ]
let systemNames = (0...2).map{ String(format: localizedFormat, systemOptions[$0]) } + [NSLocalizedString(&quot;everything&quot;, comment: &quot;&quot;)]
// Some code in-between 
labelNames = Array(systemNames[0..&lt;count]) + [systemNames.last!]

// æ„å»ºæ—¶é—´ï¼š 25.5ms
let systemOptions = [ 7, 14, 30, -1 ]
var systemNames = systemOptions.dropLast().map{ String(format: localizedFormat, $0) }
systemNames.append(NSLocalizedString(&quot;everything&quot;, comment: &quot;&quot;))
// Some code in-between
labelNames = Array(systemNames[0..&lt;count])
labelNames.append(systemNames.last!)</code></pre>
<h4 id="ä¸‰å…ƒè¿ç®—ç¬¦"><a href="#ä¸‰å…ƒè¿ç®—ç¬¦" class="headerlink" title="ä¸‰å…ƒè¿ç®—ç¬¦"></a>ä¸‰å…ƒè¿ç®—ç¬¦</h4><p>ä»…ä»…æ˜¯é€šè¿‡æ›¿æ¢ä¸‰å…ƒè¿ç®—ç¬¦ä¸º if else è¯­å¥å°±èƒ½å‡å°‘ <strong>92.9%</strong> çš„æ„å»ºæ—¶é—´ã€‚å¦‚æœä½¿ç”¨ä¸€ä¸ªforå¾ªç¯æ›¿æ¢ <em>map</em> å‡½æ•°ï¼Œå®ƒåˆèƒ½å‡å°‘å¦ä¸€ä¸ª 75%ï¼ˆä½†æ˜¯æˆ‘çš„çœ¼ç›å¯å°±å—ä¸äº†å’¯ğŸ˜‰ï¼‰ã€‚</p>
<pre><code>// æ„å»ºæ—¶é—´ï¼š 239.0ms
let labelNames = type == 0 ? (1...5).map{type0ToString($0)} : (0...2).map{type1ToString($0)}

// æ„å»ºæ—¶é—´ï¼š 16.9ms
var labelNames: [String]
if type == 0 {
    labelNames = (1...5).map{type0ToString($0)}
} else {
    labelNames = (0...2).map{type1ToString($0)}
}</code></pre>
<h4 id="è½¬æ¢-CGFloat-åˆ°-CGFloat"><a href="#è½¬æ¢-CGFloat-åˆ°-CGFloat" class="headerlink" title="è½¬æ¢ CGFloat åˆ° CGFloat"></a>è½¬æ¢ CGFloat åˆ° CGFloat</h4><p>è¿™é‡Œæˆ‘æ‰€è¯´çš„å¹¶ä¸ä¸€å®šæ­£ç¡®ã€‚å˜é‡å·²ç»ä½¿ç”¨äº† CGFloat å¹¶ä¸”æœ‰ä¸€äº›æ‹¬å·ä¹Ÿæ˜¯å¤šä½™çš„ã€‚åœ¨æ¸…ç†äº†è¿™äº›å†—ä½™ä¹‹åï¼Œæ„å»ºæ—¶é—´èƒ½å‡å°‘ **99.9%**ã€‚</p>
<pre><code>// æ„å»ºæ—¶é—´ï¼š 3431.7 ms
return CGFloat(M_PI) * (CGFloat((hour + hourDelta + CGFloat(minute + minuteDelta) / 60) * 5) - 15) * unit / 180

// æ„å»ºæ—¶é—´ï¼š 3.0ms
return CGFloat(M_PI) * ((hour + hourDelta + (minute + minuteDelta) / 60) * 5 - 15) * unit / 180</code></pre>
<h4 id="Round"><a href="#Round" class="headerlink" title="Round()"></a>Round()</h4><p>è¿™ä¸ªä¸€ä¸ªéå¸¸å¥‡æ€ªçš„ä¾‹å­ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­å˜é‡æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ä¸å®ä¾‹å˜é‡çš„æ··åˆã€‚è¿™ä¸ªé—®é¢˜å¯èƒ½ä¸æ˜¯å››èˆäº”å…¥æœ¬èº«ï¼Œè€Œæ˜¯ç»“åˆä»£ç çš„æ–¹æ³•ã€‚å»æ‰å››èˆäº”å…¥çš„æ–¹æ³•å¤§æ¦‚èƒ½å‡å°‘ <strong>97.6%</strong> çš„æ„å»ºæ—¶é—´ã€‚</p>
<pre><code>// æ„å»ºæ—¶é—´ï¼š 1433.7ms
let expansion = a â€” b â€” c + round(d * 0.66) + e
// æ„å»ºæ—¶é—´ï¼š 34.7ms
let expansion = a â€” b â€” c + d * 0.66 + e</code></pre>
<p>æ³¨æ„ï¼šæ‰€æœ‰çš„æµ‹è¯•éƒ½åœ¨ MacBook Air (13-inch, Mid 2013)ä¸­è¿›è¡Œã€‚</p>
<h4 id="å°è¯•å®ƒ"><a href="#å°è¯•å®ƒ" class="headerlink" title="å°è¯•å®ƒ"></a>å°è¯•å®ƒ</h4><p>æ— è®ºä½ æ˜¯å¦é¢ä¸´è¿‡æ„å»ºæ—¶é—´å¤ªé•¿çš„é—®é¢˜ï¼Œç¼–å†™å¯¹ç¼–è¯‘å™¨å‹å¥½çš„ä»£ç éƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æˆ‘ç¡®å®šä½ è‡ªå·±ä¼šåœ¨å…¶ä¸­æ‰¾åˆ°ä¸€äº›æƒŠå–œã€‚ä½œä¸ºå‚è€ƒï¼Œè¿™é‡Œæœ‰å®Œæ•´çš„ä»£ç ï¼Œåœ¨æˆ‘çš„å·¥ç¨‹ä¸­å¯ä»¥5ç§’å†…å®Œæˆç¼–è¯‘â€¦</p>
<pre><code>import UIKit

class CMExpandingTextField: UITextField {

    func textFieldEditingChanged() {
        invalidateIntrinsicContentSize()
    }

    override func intrinsicContentSize() -&gt; CGSize {
        if isFirstResponder(), let text = text {
            let size = text.sizeWithAttributes(typingAttributes)
            return CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height)
        }
        return super.intrinsicContentSize()
    }
}</code></pre>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>RxSwiftè¯­æ³•ç¬”è®°</title>
    <url>/post/rx-dictionary/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>è®°å½•RxSwiftåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›å¸¸ç”¨è¯­æ³•ã€‚</p>
<a id="more"></a>

<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>æŒ‰ç…§<a href="https://blog.callmewhy.com/2015/09/21/rxswift-getting-started-0/" target="_blank" rel="noopener">RxSwift å…¥å‘æ‰‹å†Œ Part0 - åŸºç¡€æ¦‚å¿µ</a>æ ¼å¼è¿›è¡Œè¡¥å……ã€‚</p>
<h2 id="SupportCode"><a href="#SupportCode" class="headerlink" title="SupportCode"></a>SupportCode</h2><p>åœ¨è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œå…ˆçœ‹ä¸‹é¡¹ç›®é‡Œçš„ <code>SupportCode.swift</code> ï¼Œä¸»è¦ä¸º <code>playground</code> æä¾›äº†ä¸¤ä¸ªä¾¿åˆ©å‡½æ•°ã€‚</p>
<p>ä¸€ä¸ªæ˜¯ <code>example</code> å‡½æ•°ï¼Œä¸“é—¨ç”¨æ¥å†™ç¤ºä¾‹ä»£ç çš„ï¼Œç»Ÿä¸€è¾“å‡º log ä¾¿äºæ ‡è®°æµè§ˆï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒå˜é‡ä¸æ±¡æŸ“å…¨å±€ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">example</span><span class="params">(description: String, action: <span class="params">()</span></span></span> -&gt; ()) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n--- \(description) example ---"</span>)</span><br><span class="line">    action()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦ä¸€ä¸ªæ˜¯ <code>delay</code> å‡½æ•°ï¼Œé€šè¿‡ <code>dispatch_after</code> ç”¨æ¥æ¼”ç¤ºå»¶æ—¶çš„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">delay</span><span class="params">(delay:Double, closure:<span class="params">()</span></span></span>-&gt;()) &#123;</span><br><span class="line">    dispatch_after(</span><br><span class="line">        dispatch_time(</span><br><span class="line">            <span class="type">DISPATCH_TIME_NOW</span>,</span><br><span class="line">            <span class="type">Int64</span>(delay * <span class="type">Double</span>(<span class="type">NSEC_PER_SEC</span>))</span><br><span class="line">        ),</span><br><span class="line">        dispatch_get_main_queue(), closure)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>ä¸»è¦ä»‹ç»äº† Rx çš„åŸºç¡€ï¼š <code>Observable</code> ã€‚ <code>Observable&lt;Element&gt;</code> æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ä¸­è¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸€ä¸ªäº‹ä»¶åºåˆ— (<code>GeneratorType</code>) ï¼Œä¼šå‘è®¢é˜…è€…å‘é€æ–°äº§ç”Ÿçš„äº‹ä»¶ä¿¡æ¯ã€‚äº‹ä»¶ä¿¡æ¯åˆ†ä¸ºä¸‰ç§ï¼š</p>
<ul>
<li>Next(value) è¡¨ç¤ºæ–°çš„äº‹ä»¶æ•°æ®ã€‚</li>
<li>Completed è¡¨ç¤ºäº‹ä»¶åºåˆ—çš„å®Œç»“ã€‚</li>
<li>Error åŒæ ·è¡¨ç¤ºå®Œç»“ï¼Œä½†æ˜¯ä»£è¡¨å¼‚å¸¸å¯¼è‡´çš„å®Œç»“ã€‚<br>ï¼ˆæ‰“ä¸ªå²”ï¼šåè®®å‘½åï¼Œæƒ³èµ·æ¥ä¸Šåˆæ±¤å“¥åœ¨å¾®åšè¯´çš„ä¸€æ®µè¯ï¼š</li>
</ul>
<blockquote>
<p>å¦å¤–ï¼Œæˆ‘è§‰å¾— protocol åå­—ç”¨å½¢å®¹è¯ä¼šæ›´åŠ è¯­ä¹‰åˆ†æ˜ï¼Œæ¯”å¦‚ Swift : Flyable, Killable, Visibleã€‚å…¨ç”¨åè¯çš„è¯æ˜¾å¾—æ¯”è¾ƒç”Ÿç¡¬ï¼Œæ¯”å¦‚ Swift : Head, Wings, Assã€‚</p>
</blockquote>
<h3 id="empty"><a href="#empty" class="headerlink" title="empty"></a>empty</h3><p><code>empty</code> æ˜¯ä¸€ä¸ªç©ºçš„åºåˆ—ï¼Œå®ƒåªå‘é€ <code>.Completed</code> æ¶ˆæ¯ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"empty"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> emptySequence: <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; = empty()</span><br><span class="line">    <span class="keyword">let</span> subscription = emptySequence</span><br><span class="line">        .subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(event)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- empty example ---</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>


<h3 id="never"><a href="#never" class="headerlink" title="never"></a>never</h3><p><code>never</code> æ˜¯æ²¡æœ‰ä»»ä½•å…ƒç´ ã€ä¹Ÿä¸ä¼šå‘é€ä»»ä½•äº‹ä»¶çš„ç©ºåºåˆ—ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"never"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> neverSequence: <span class="type">Observable</span>&lt;<span class="type">String</span>&gt; = never()</span><br><span class="line">    <span class="keyword">let</span> subscription = neverSequence</span><br><span class="line">        .subscribe &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"This block is never called."</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">--- never example ---</span><br></pre></td></tr></table></figure>
<h3 id="just"><a href="#just" class="headerlink" title="just"></a>just</h3><p><code>just</code> æ˜¯åªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„åºåˆ—ï¼Œå®ƒä¼šå…ˆå‘é€ <code>.Next(value)</code> ï¼Œç„¶åå‘é€ <code>.Completed</code> ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"just"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> singleElementSequence = just(<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">let</span> subscription = singleElementSequence</span><br><span class="line">        .subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(event)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- just example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">32</span>)</span><br><span class="line"><span class="type">Completed</span></span><br><span class="line">sequenceOf</span><br></pre></td></tr></table></figure>

<p><code>sequenceOf</code> å¯ä»¥æŠŠä¸€ç³»åˆ—å…ƒç´ è½¬æ¢æˆäº‹ä»¶åºåˆ—ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"sequenceOf"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequenceOfElements<span class="comment">/* : Observable&lt;Int&gt; */</span> = sequenceOf(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">let</span> subscription = sequenceOfElements</span><br><span class="line">        .subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(event)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- sequenceOf example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">0</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">3</span>)</span><br><span class="line"><span class="type">Completed</span></span><br><span class="line">from</span><br></pre></td></tr></table></figure>

<p><code>from</code> æ˜¯é€šè¿‡ <code>asObservable()</code> æ–¹æ³•æŠŠ Swift ä¸­çš„åºåˆ— (<code>SequenceType</code>) è½¬æ¢æˆäº‹ä»¶åºåˆ—ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"from"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequenceFromArray = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].asObservable()</span><br><span class="line">    <span class="keyword">let</span> subscription = sequenceFromArray</span><br><span class="line">        .subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(event)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- from example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">3</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">4</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">5</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="create"><a href="#create" class="headerlink" title="create"></a>create</h3><p><code>create</code> å¯ä»¥é€šè¿‡é—­åŒ…åˆ›å»ºåºåˆ—ï¼Œé€šè¿‡ <code>.on(e: Event)</code> æ·»åŠ äº‹ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"create"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> myJust = &#123; (singleElement: <span class="type">Int</span>) -&gt; <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> create &#123; observer <span class="keyword">in</span></span><br><span class="line">            observer.on(.<span class="type">Next</span>(singleElement))</span><br><span class="line">            observer.on(.<span class="type">Completed</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="type">NopDisposable</span>.instance</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> subscription = myJust(<span class="number">5</span>)</span><br><span class="line">        .subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(event)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- create example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">5</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="failWith"><a href="#failWith" class="headerlink" title="failWith"></a>failWith</h3><p><code>failWith</code> åˆ›å»ºä¸€ä¸ªæ²¡æœ‰å…ƒç´ çš„åºåˆ—ï¼Œåªä¼šå‘é€å¤±è´¥ (<code>.Error</code>) äº‹ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"failWith"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> error = <span class="type">NSError</span>(domain: <span class="string">"Test"</span>, code: -<span class="number">1</span>, userInfo: <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">let</span> erroredSequence: <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; = failWith(error)</span><br><span class="line">    <span class="keyword">let</span> subscription = erroredSequence</span><br><span class="line">        .subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(event)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- failWith example ---</span><br><span class="line"><span class="type">Error</span>(<span class="type">Error</span> <span class="type">Domain</span>=<span class="type">Test</span> <span class="type">Code</span>=-<span class="number">1</span> <span class="string">"The operation couldnâ€™t be completed. (Test error -1.)"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="deferred"><a href="#deferred" class="headerlink" title="deferred"></a>deferred</h3><p><code>deferred</code> ä¼šç­‰åˆ°æœ‰è®¢é˜…è€…çš„æ—¶å€™å†é€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»º <code>Observable</code> å¯¹è±¡ï¼Œæ¯ä¸ªè®¢é˜…è€…è®¢é˜…çš„å¯¹è±¡éƒ½æ˜¯å†…å®¹ç›¸åŒè€Œå®Œå…¨ç‹¬ç«‹çš„åºåˆ—ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"deferred"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> deferredSequence: <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; = deferred &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"creating"</span>)</span><br><span class="line">        <span class="keyword">return</span> create &#123; observer <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"emmiting"</span>)</span><br><span class="line">            observer.on(.<span class="type">Next</span>(<span class="number">0</span>))</span><br><span class="line">            observer.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">            observer.on(.<span class="type">Next</span>(<span class="number">2</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="type">NopDisposable</span>.instance</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"go"</span>)</span><br><span class="line">    deferredSequence</span><br><span class="line">        .subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(event)</span><br><span class="line">    &#125;</span><br><span class="line">    deferredSequence</span><br><span class="line">        .subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(event)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- deferred example ---</span><br><span class="line">go</span><br><span class="line">creating</span><br><span class="line">emmiting</span><br><span class="line"><span class="type">Next</span>(<span class="number">0</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line">creating</span><br><span class="line">emmiting</span><br><span class="line"><span class="type">Next</span>(<span class="number">0</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆéœ€è¦ <code>defferd</code> è¿™æ ·ä¸€ä¸ªå¥‡æ€ªçš„å®¶ä¼™å‘¢ï¼Ÿå…¶å®è¿™ç›¸å½“äºæ˜¯ä¸€ç§å»¶æ—¶åŠ è½½ï¼Œå› ä¸ºåœ¨æ·»åŠ ç›‘å¬çš„æ—¶å€™æ•°æ®æœªå¿…åŠ è½½å®Œæ¯•ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"TestDeferred"</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String?</span> = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">var</span> subscription: <span class="type">Observable</span>&lt;<span class="type">String?</span>&gt; = just(value)</span><br><span class="line">    <span class="comment">// got value</span></span><br><span class="line">    value = <span class="string">"Hello!"</span></span><br><span class="line">    subscription.subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(event)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- <span class="type">TestDeferred</span> example ---</span><br><span class="line"><span class="type">Next</span>(<span class="literal">nil</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨ <code>deffered</code> åˆ™å¯ä»¥æ­£å¸¸æ˜¾ç¤ºæƒ³è¦çš„æ•°æ®ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"TestDeferred"</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String?</span> = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">var</span> subscription: <span class="type">Observable</span>&lt;<span class="type">String?</span>&gt; = deferred &#123;</span><br><span class="line">        <span class="keyword">return</span> just(value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// got value</span></span><br><span class="line">    value = <span class="string">"Hello!"</span></span><br><span class="line">    subscription.subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(event)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- <span class="type">TestDeferred</span> example ---</span><br><span class="line"><span class="type">Next</span>(<span class="type">Optional</span>(<span class="string">"Hello!"</span>))</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h2 id="Subjects"><a href="#Subjects" class="headerlink" title="Subjects"></a>Subjects</h2><p>æ¥ä¸‹æ¥æ˜¯å…³äº <code>Subject</code> çš„å†…å®¹ã€‚ <code>Subject</code> å¯ä»¥çœ‹åšæ˜¯ä¸€ç§ä»£ç†å’Œæ¡¥æ¢ã€‚å®ƒæ—¢æ˜¯è®¢é˜…è€…åˆæ˜¯è®¢é˜…æºï¼Œè¿™æ„å‘³ç€å®ƒæ—¢å¯ä»¥è®¢é˜…å…¶ä»– <code>Observable</code> å¯¹è±¡ï¼ŒåŒæ—¶åˆå¯ä»¥å¯¹å®ƒçš„è®¢é˜…è€…ä»¬å‘é€äº‹ä»¶ã€‚</p>
<p>å¦‚æœæŠŠ <code>Observable</code> ç†è§£æˆä¸æ–­è¾“å‡ºäº‹ä»¶çš„æ°´ç®¡ï¼Œé‚£ <code>Subject</code> å°±æ˜¯å¥—åœ¨ä¸Šé¢çš„æ°´é¾™å¤´ã€‚å®ƒæ—¢æ€¼ç€ä¸€æ ¹ä¸æ–­å‡ºæ°´çš„æ°´ç®¡ï¼ŒåŒæ—¶ä¹Ÿå‘å¤–é¢è¾“é€ç€æ–°é²œæ°´æºã€‚å¦‚æœä½ ç›´æ¥ç”¨æ°´æ¯æ¥ç€æ°´ç®¡çš„æ°´ï¼Œé‚£å¯èƒ½å¯¼å‡ºæ¥ä»€ä¹ˆç‹æ°´èƒ¶æ°´å®Œå…¨æŠŠæŒä¸ä½ï¼›å¦‚æœä½ åœ¨æ°´é¾™å¤´ä¸‹é¢æ¥ç€æ°´ï¼Œé‚£ä½ å¯ä»¥éšå¿ƒæ‰€æ¬²çš„è°ƒæˆä½ æƒ³è¦çš„æ°´é€Ÿå’Œæ°´æ¸©ã€‚</p>
<p>ï¼ˆå¥½å§ä¸Šé¢ä¸€æ®µæ–‡æ¡£é‡Œæ²¡æœ‰ï¼Œæ˜¯æˆ‘çæ°çš„ï¼Œå¦‚æœç†è§£é”™äº†è¿˜æœ›æ‰“è„¸(ï¿£Îµ(#ï¿£)â˜†â•°â•®(ï¿£â–½ï¿£///))</p>
<p>åœ¨å¼€å§‹ä¸‹é¢çš„ä»£ç ä¹‹å‰ï¼Œå…ˆå®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ç”¨äºè¾“å‡ºæ•°æ®ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeSequenceToConsole</span>&lt;O: ObservableType&gt;<span class="params">(name: String, sequence: O)</span></span> &#123;</span><br><span class="line">    sequence</span><br><span class="line">        .subscribe &#123; e <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Subscription: \(name), event: \(e)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PublishSubject"><a href="#PublishSubject" class="headerlink" title="PublishSubject"></a>PublishSubject</h3><p><code>PublishSubject</code> ä¼šå‘é€è®¢é˜…è€…ä»è®¢é˜…ä¹‹åçš„äº‹ä»¶åºåˆ—ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"PublishSubject"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> subject = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line">    writeSequenceToConsole(<span class="string">"1"</span>, sequence: subject)</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"a"</span>))</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"b"</span>))</span><br><span class="line">    writeSequenceToConsole(<span class="string">"2"</span>, sequence: subject)</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"c"</span>))</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"d"</span>))</span><br><span class="line">&#125;</span><br><span class="line">--- <span class="type">PublishSubject</span> example ---</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(a)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(b)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(<span class="built_in">c</span>)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Next</span>(<span class="built_in">c</span>)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(d)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Next</span>(d)</span><br></pre></td></tr></table></figure>

<h3 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h3><p><code>ReplaySubject</code> åœ¨æ–°çš„è®¢é˜…å¯¹è±¡è®¢é˜…çš„æ—¶å€™ä¼šè¡¥å‘æ‰€æœ‰å·²ç»å‘é€è¿‡çš„æ•°æ®é˜Ÿåˆ—ï¼Œ <code>bufferSize</code> æ˜¯ç¼“å†²åŒºçš„å¤§å°ï¼Œå†³å®šäº†è¡¥å‘é˜Ÿåˆ—çš„æœ€å¤§å€¼ã€‚å¦‚æœ <code>bufferSize</code> æ˜¯1ï¼Œé‚£ä¹ˆæ–°çš„è®¢é˜…è€…å‡ºç°çš„æ—¶å€™å°±ä¼šè¡¥å‘ä¸Šä¸€ä¸ªäº‹ä»¶ï¼Œå¦‚æœæ˜¯2ï¼Œåˆ™è¡¥ä¸¤ä¸ªï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"ReplaySubject"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> subject = <span class="type">ReplaySubject</span>&lt;<span class="type">String</span>&gt;.create(bufferSize: <span class="number">1</span>)</span><br><span class="line">    writeSequenceToConsole(<span class="string">"1"</span>, sequence: subject)</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"a"</span>))</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"b"</span>))</span><br><span class="line">    writeSequenceToConsole(<span class="string">"2"</span>, sequence: subject)</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"c"</span>))</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"d"</span>))</span><br><span class="line">&#125;</span><br><span class="line">--- <span class="type">ReplaySubject</span> example ---</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(a)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(b)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Next</span>(b) <span class="comment">// è¡¥äº†ä¸€ä¸ª b</span></span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(<span class="built_in">c</span>)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Next</span>(<span class="built_in">c</span>)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(d)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Next</span>(d)</span><br></pre></td></tr></table></figure>

<h3 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h3><p><code>BehaviorSubject</code> åœ¨æ–°çš„è®¢é˜…å¯¹è±¡è®¢é˜…çš„æ—¶å€™ä¼šå‘é€æœ€è¿‘å‘é€çš„äº‹ä»¶ï¼Œå¦‚æœæ²¡æœ‰åˆ™å‘é€ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"BehaviorSubject"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> subject = <span class="type">BehaviorSubject</span>(value: <span class="string">"z"</span>)</span><br><span class="line">    writeSequenceToConsole(<span class="string">"1"</span>, sequence: subject)</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"a"</span>))</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"b"</span>))</span><br><span class="line">    writeSequenceToConsole(<span class="string">"2"</span>, sequence: subject)</span><br><span class="line">    subject.on(.<span class="type">Next</span>(<span class="string">"c"</span>))</span><br><span class="line">    subject.on(.<span class="type">Completed</span>)</span><br><span class="line">&#125;</span><br><span class="line">--- <span class="type">BehaviorSubject</span> example ---</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(z)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(a)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(b)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Next</span>(b)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(<span class="built_in">c</span>)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Next</span>(<span class="built_in">c</span>)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Completed</span></span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="Variable"><a href="#Variable" class="headerlink" title="Variable"></a>Variable</h3><p><code>Variable</code> æ˜¯åŸºäº <code>BehaviorSubject</code> çš„ä¸€å±‚å°è£…ï¼Œå®ƒçš„ä¼˜åŠ¿æ˜¯ï¼šä¸ä¼šè¢«æ˜¾å¼ç»ˆç»“ã€‚å³ï¼šä¸ä¼šæ”¶åˆ° <code>.Completed</code> å’Œ <code>.Error</code> è¿™ç±»çš„ç»ˆç»“äº‹ä»¶ï¼Œå®ƒä¼šä¸»åŠ¨åœ¨ææ„çš„æ—¶å€™å‘é€ <code>.Complete</code> ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"Variable"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> variable = <span class="type">Variable</span>(<span class="string">"z"</span>)</span><br><span class="line">    writeSequenceToConsole(<span class="string">"1"</span>, sequence: variable)</span><br><span class="line">    variable.value = <span class="string">"a"</span></span><br><span class="line">    variable.value = <span class="string">"b"</span></span><br><span class="line">    writeSequenceToConsole(<span class="string">"2"</span>, sequence: variable)</span><br><span class="line">    variable.value = <span class="string">"c"</span></span><br><span class="line">&#125;</span><br><span class="line">--- <span class="type">Variable</span> example ---</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(z)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(a)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(b)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Next</span>(b)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Next</span>(<span class="built_in">c</span>)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Next</span>(<span class="built_in">c</span>)</span><br><span class="line"><span class="type">Subscription</span>: <span class="number">1</span>, event: <span class="type">Completed</span></span><br><span class="line"><span class="type">Subscription</span>: <span class="number">2</span>, event: <span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h2 id="Transform"><a href="#Transform" class="headerlink" title="Transform"></a>Transform</h2><p>æˆ‘ä»¬å¯ä»¥å¯¹åºåˆ—åšä¸€äº›è½¬æ¢ï¼Œç±»ä¼¼äº <code>Swift</code> ä¸­ <code>CollectionType</code> çš„å„ç§è½¬æ¢ã€‚åœ¨ä»¥å‰çš„å‘ä¸­æ›¾ç»æåˆ°è¿‡ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://blog.callmewhy.com/2015/05/11/functional-reactive-programming-1/#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%9A%84%E5%87%BD%E6%95%B0/" target="_blank" rel="noopener">å‡½æ•°å¼çš„å‡½æ•°</a>ã€‚</p>
<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p><code>map</code> å°±æ˜¯å¯¹æ¯ä¸ªå…ƒç´ éƒ½ç”¨å‡½æ•°åšä¸€æ¬¡è½¬æ¢ï¼ŒæŒ¨ä¸ªæ˜ å°„ä¸€éã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"map"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> originalSequence = sequenceOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">    originalSequence</span><br><span class="line">        .<span class="built_in">map</span> &#123; $<span class="number">0</span> * <span class="number">2</span> &#125;</span><br><span class="line">        .subscribe &#123; <span class="built_in">print</span>($<span class="number">0</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- <span class="built_in">map</span> example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">4</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">6</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h3><p><code>map</code> åœ¨åšè½¬æ¢çš„æ—¶å€™å¾ˆå®¹æ˜“å‡ºç°ã€å‡ç»´ã€çš„æƒ…å†µï¼Œå³ï¼šè½¬å˜ä¹‹åï¼Œä»ä¸€ä¸ªåºåˆ—å˜æˆäº†ä¸€ä¸ªåºåˆ—çš„åºåˆ—ã€‚</p>
<p>ä»€ä¹ˆæ˜¯ã€å‡ç»´ã€ï¼Ÿåœ¨é›†åˆä¸­æˆ‘ä»¬å¯ä»¥ä¸¾è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘æœ‰ä¸€ä¸ªå¥½å‹åˆ—è¡¨ <code>[p1, p2, p3]</code>ï¼Œé‚£ä¹ˆå¦‚æœè¦è·å–æˆ‘å¥½å‹çš„å¥½å‹çš„åˆ—è¡¨ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">myFriends.<span class="built_in">map</span> &#123; $<span class="number">0</span>.getFriends() &#125;</span><br></pre></td></tr></table></figure>
<p>ç»“æœå°±æˆäº† <code>[[p1-1, p1-2, p1-3], [p2-1], [p3-1, p3-2]]</code> ï¼Œè¿™å°±æˆäº†å¥½å‹çš„å¥½å‹åˆ—è¡¨çš„åˆ—è¡¨äº†ã€‚è¿™å°±æ˜¯ä¸€ä¸ªã€å‡ç»´ã€çš„ä¾‹å­ã€‚</p>
<p>ï¼ˆä»¥ä¸Šå†…å®¹æ–‡æ¡£ä¸­ä¾æ—§æ²¡æœ‰ï¼Œä¾æ—§æ˜¯æˆ‘çæ°çš„ï¼Œä¾æ—§æ¬¢è¿æœ‰é”™è¯¯å½“é¢æ‰“è„¸(ï¿£Îµ(#ï¿£)â˜†â•°â•®(ï¿£â–½ï¿£///))</p>
<p>åœ¨ <code>Swift</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>flatMap</code> è¿‡æ»¤æ‰ <code>map</code> ä¹‹åçš„ <code>nil</code> ç»“æœã€‚åœ¨ <code>Rx</code> ä¸­ï¼Œ <code>flatMap</code> å¯ä»¥æŠŠä¸€ä¸ªåºåˆ—è½¬æ¢æˆä¸€ç»„åºåˆ—ï¼Œç„¶åå†æŠŠè¿™ä¸€ç»„åºåˆ—ã€æ‹æ‰ã€æˆä¸€ä¸ªåºåˆ—ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"flatMap"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequenceInt = sequenceOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">let</span> sequenceString = sequenceOf(<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"--"</span>)</span><br><span class="line">    sequenceInt</span><br><span class="line">        .flatMap &#123; int <span class="keyword">in</span></span><br><span class="line">            sequenceString</span><br><span class="line">        &#125;</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- flatMap example ---</span><br><span class="line"><span class="type">Next</span>(<span class="type">A</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="type">B</span>)</span><br><span class="line"><span class="type">Next</span>(--)</span><br><span class="line"><span class="type">Next</span>(<span class="type">A</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="type">B</span>)</span><br><span class="line"><span class="type">Next</span>(--)</span><br><span class="line"><span class="type">Next</span>(<span class="type">A</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="type">B</span>)</span><br><span class="line"><span class="type">Next</span>(--)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h3><p><code>scan</code> æœ‰ç‚¹åƒ <code>reduce</code> ï¼Œå®ƒä¼šæŠŠæ¯æ¬¡çš„è¿ç®—ç»“æœç´¯ç§¯èµ·æ¥ï¼Œä½œä¸ºä¸‹ä¸€æ¬¡è¿ç®—çš„è¾“å…¥å€¼ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"scan"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequenceToSum = sequenceOf(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    sequenceToSum</span><br><span class="line">        .scan(<span class="number">0</span>) &#123; acum, elem <span class="keyword">in</span></span><br><span class="line">            acum + elem</span><br><span class="line">        &#125;</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- scan example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">0</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">3</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">6</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">10</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">15</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h2 id="Filtering"><a href="#Filtering" class="headerlink" title="Filtering"></a>Filtering</h2><p>é™¤äº†ä¸Šé¢çš„å„ç§è½¬æ¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹åºåˆ—è¿›è¡Œè¿‡æ»¤ã€‚</p>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p><code>filter</code> åªä¼šè®©ç¬¦åˆæ¡ä»¶çš„å…ƒç´ é€šè¿‡ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"filter"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> subscription = sequenceOf(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)</span><br><span class="line">        .<span class="built_in">filter</span> &#123;</span><br><span class="line">            $<span class="number">0</span> % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- <span class="built_in">filter</span> example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">0</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">4</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">6</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">8</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="distinctUntilChanged"><a href="#distinctUntilChanged" class="headerlink" title="distinctUntilChanged"></a>distinctUntilChanged</h3><p><code>distinctUntilChanged</code> ä¼šåºŸå¼ƒæ‰é‡å¤çš„äº‹ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"distinctUntilChanged"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> subscription = sequenceOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">        .distinctUntilChanged()</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- distinctUntilChanged example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">3</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">4</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="take"><a href="#take" class="headerlink" title="take"></a>take</h3><p><code>take</code> åªè·å–åºåˆ—ä¸­çš„å‰ <code>n</code> ä¸ªäº‹ä»¶ï¼Œåœ¨æ»¡è¶³æ•°é‡ä¹‹åä¼šè‡ªåŠ¨ <code>.Completed</code> ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"take"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> subscription = sequenceOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">        .take(<span class="number">3</span>)</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- take example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">3</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="throttle-VS-debounce"><a href="#throttle-VS-debounce" class="headerlink" title="throttle VS. debounce"></a>throttle VS. debounce</h3><p><code>throttle</code> å’Œ <code>debounce</code> ç›®çš„éƒ½æ˜¯æ§åˆ¶æŸä¸ªæ—¶é—´æ®µå†…äº‹ä»¶åºåˆ—çš„é€Ÿåº¦ã€‚ä½†æ˜¯åˆæœ‰å·®åˆ«ï¼š</p>
<ul>
<li><code>debounce</code> : <code>ç©ºé—²æ§åˆ¶</code>  ç©ºé—²æ—¶é—´å¿…é¡» <code>&gt;=</code> å›ºå®šçš„æ—¶é—´ï¼Œäº‹ä»¶åºåˆ—æ‰ä¼šè¢«æ”¾è¡Œ</li>
<li><code>throttle</code> : <code>é¢‘ç‡æ§åˆ¶</code>  äº‹ä»¶åºåˆ—æ»¡è¶³ <code>1/delay</code> æ‰ä¼šè¢«æ”¾è¡Œ</li>
</ul>
<p>ä¸€èˆ¬çš„æŒ‰é’®ç‚¹å‡»ã€ç”¨æˆ·è¾“å…¥ã€ç­‰éƒ½å±äºé¢‘ç‡æ§åˆ¶ï¼Œåº”è¯¥ä½¿ç”¨ <code>throttle</code> ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> searchResults = searchBar.rx.text.orEmpty</span><br><span class="line">    .throttle(<span class="number">0.3</span>, scheduler: <span class="type">MainScheduler</span>.instance)</span><br><span class="line">    .distinctUntilChanged()</span><br><span class="line">    .flatMapLatest &#123; query -&gt; <span class="type">Observable</span>&lt;[<span class="type">Repository</span>]&gt; <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> query.isEmpty &#123;</span><br><span class="line">            <span class="keyword">return</span> .just([])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> searchGitHub(query)</span><br><span class="line">            .catchErrorJustReturn([])</span><br><span class="line">    &#125;</span><br><span class="line">    .observeOn(<span class="type">MainScheduler</span>.instance)</span><br></pre></td></tr></table></figure>

<h2 id="Combining"><a href="#Combining" class="headerlink" title="Combining"></a>Combining</h2><p>è¿™éƒ¨åˆ†æ˜¯å…³äºåºåˆ—çš„è¿ç®—ï¼Œå¯ä»¥å°†å¤šä¸ªåºåˆ—æºè¿›è¡Œç»„åˆæ‹¼è£…æˆä¸€ä¸ªæ–°çš„äº‹ä»¶åºåˆ—ã€‚</p>
<h3 id="startWith"><a href="#startWith" class="headerlink" title="startWith"></a>startWith</h3><p><code>startWith</code> ä¼šåœ¨é˜Ÿåˆ—å¼€å§‹ä¹‹å‰æ’å…¥ä¸€ä¸ªäº‹ä»¶å…ƒç´ ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"startWith"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> subscription = sequenceOf(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">        .startWith(<span class="number">3</span>)</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- startWith example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">3</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">4</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">5</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">6</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="combineLatest"><a href="#combineLatest" class="headerlink" title="combineLatest"></a>combineLatest</h3><p>å¦‚æœå­˜åœ¨ä¸¤æ¡äº‹ä»¶é˜Ÿåˆ—ï¼Œéœ€è¦åŒæ—¶ç›‘å¬ï¼Œé‚£ä¹ˆæ¯å½“æœ‰æ–°çš„äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œ<code>combineLatest</code> ä¼šå°†æ¯ä¸ªé˜Ÿåˆ—çš„æœ€æ–°çš„ä¸€ä¸ªå…ƒç´ è¿›è¡Œåˆå¹¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"combineLatest 1"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> intOb1 = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line">    <span class="keyword">let</span> intOb2 = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    combineLatest(intOb1, intOb2) &#123;</span><br><span class="line">        <span class="string">"\($0) \($1)"</span></span><br><span class="line">        &#125;</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    intOb1.on(.<span class="type">Next</span>(<span class="string">"A"</span>))</span><br><span class="line">    intOb2.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    intOb1.on(.<span class="type">Next</span>(<span class="string">"B"</span>))</span><br><span class="line">    intOb2.on(.<span class="type">Next</span>(<span class="number">2</span>))</span><br><span class="line">&#125;</span><br><span class="line">--- combineLatest <span class="number">1</span> example ---</span><br><span class="line"><span class="type">Next</span>(<span class="type">A</span> <span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="type">B</span> <span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="type">B</span> <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h3 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h3><p><code>zip</code> äººå¦‚å…¶åï¼Œå°±æ˜¯åˆå¹¶ä¸¤æ¡é˜Ÿåˆ—ç”¨çš„ï¼Œä¸è¿‡å®ƒä¼šç­‰åˆ°ä¸¤ä¸ªé˜Ÿåˆ—çš„å…ƒç´ ä¸€ä¸€å¯¹åº”åœ°å‡‘é½äº†ä¹‹åå†åˆå¹¶ï¼Œæ­£å¦‚<a href="http://weibo.com/mrgreenhand" target="_blank" rel="noopener">ç™¾æŠ˜ä¸æ’“çš„ç±³æ–¯ç‰¹èœ</a>æ‰€æé†’çš„ï¼Œ <code>zip</code> å°±åƒæ˜¯æ‹‰é“¾ä¸€æ ·ï¼Œä¸¤æ ¹æ‹‰é“¾æ‹‰ç€æ‹‰ç€åˆå¹¶åˆ°äº†ä¸€æ ¹ä¸Šï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"zip 1"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> intOb1 = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line">    <span class="keyword">let</span> intOb2 = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    <span class="built_in">zip</span>(intOb1, intOb2) &#123;</span><br><span class="line">        <span class="string">"\($0) \($1)"</span></span><br><span class="line">        &#125;</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    intOb1.on(.<span class="type">Next</span>(<span class="string">"A"</span>))</span><br><span class="line">    intOb2.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    intOb1.on(.<span class="type">Next</span>(<span class="string">"B"</span>))</span><br><span class="line">    intOb1.on(.<span class="type">Next</span>(<span class="string">"C"</span>))</span><br><span class="line">    intOb2.on(.<span class="type">Next</span>(<span class="number">2</span>))</span><br><span class="line">&#125;</span><br><span class="line">--- <span class="built_in">zip</span> <span class="number">1</span> example ---</span><br><span class="line"><span class="type">Next</span>(<span class="type">A</span> <span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="type">B</span> <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><p><code>merge</code> å°±æ˜¯ <code>merge</code> å•¦ï¼ŒæŠŠä¸¤ä¸ªé˜Ÿåˆ—æŒ‰ç…§é¡ºåºç»„åˆåœ¨ä¸€èµ·ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"merge 1"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> subject1 = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    <span class="keyword">let</span> subject2 = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    sequenceOf(subject1, subject2)</span><br><span class="line">        .merge()</span><br><span class="line">        .subscribeNext &#123; int <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(int)</span><br><span class="line">        &#125;</span><br><span class="line">    subject1.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    subject1.on(.<span class="type">Next</span>(<span class="number">2</span>))</span><br><span class="line">    subject2.on(.<span class="type">Next</span>(<span class="number">3</span>))</span><br><span class="line">    subject1.on(.<span class="type">Next</span>(<span class="number">4</span>))</span><br><span class="line">    subject2.on(.<span class="type">Next</span>(<span class="number">5</span>))</span><br><span class="line">&#125;</span><br><span class="line">--- merge <span class="number">1</span> example ---</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h3><p>å½“ä½ çš„äº‹ä»¶åºåˆ—æ˜¯ä¸€ä¸ªäº‹ä»¶åºåˆ—çš„åºåˆ— (<code>Observable&lt;Observable&lt;T&gt;&gt;</code>) çš„æ—¶å€™ï¼Œï¼ˆå¯ä»¥ç†è§£æˆäºŒç»´åºåˆ—ï¼Ÿï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>switch</code> å°†åºåˆ—çš„åºåˆ—å¹³é“ºæˆä¸€ç»´ï¼Œå¹¶ä¸”åœ¨å‡ºç°æ–°çš„åºåˆ—çš„æ—¶å€™ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°æœ€æ–°çš„é‚£ä¸ªåºåˆ—ä¸Šã€‚å’Œ <code>merge</code> ç›¸ä¼¼çš„æ˜¯ï¼Œå®ƒä¹Ÿæ˜¯èµ·åˆ°äº†å°†å¤šä¸ªåºåˆ—ã€æ‹å¹³ã€æˆä¸€æ¡åºåˆ—çš„ä½œç”¨ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"switchLatest"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> var1 = <span class="type">Variable</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">let</span> var2 = <span class="type">Variable</span>(<span class="number">200</span>)</span><br><span class="line">    <span class="comment">// var3 is like an Observable&lt;Observable&lt;Int&gt;&gt;</span></span><br><span class="line">    <span class="keyword">let</span> var3 = <span class="type">Variable</span>(var1)</span><br><span class="line">    <span class="keyword">let</span> d = var3</span><br><span class="line">        .switchLatest()</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    var1.value = <span class="number">1</span></span><br><span class="line">    var1.value = <span class="number">2</span></span><br><span class="line">    var1.value = <span class="number">3</span></span><br><span class="line">    var1.value = <span class="number">4</span></span><br><span class="line">    var3.value = var2</span><br><span class="line">    var2.value = <span class="number">201</span></span><br><span class="line">    var1.value = <span class="number">5</span></span><br><span class="line">    var3.value = var1</span><br><span class="line">    var2.value = <span class="number">202</span></span><br><span class="line">    var1.value = <span class="number">6</span></span><br><span class="line">&#125;</span><br><span class="line">--- switchLatest example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">0</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">3</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">4</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">200</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">201</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">5</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">6</span>)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè™½ç„¶éƒ½æ˜¯ã€æ‹å¹³ã€ï¼Œä½†æ˜¯å’Œ <code>flatmap</code> æ˜¯ä¸åŒçš„ï¼Œ <code>flatmap</code> æ˜¯å°†ä¸€æ¡åºåˆ—å˜æˆå¦ä¸€æ¡åºåˆ—ï¼Œè€Œè¿™å˜æ¢è¿‡ç¨‹ä¼šè®©ç»´åº¦å˜é«˜ï¼Œæ‰€ä»¥éœ€è¦ã€æ‹å¹³ã€ï¼Œè€Œ <code>switch</code> æ˜¯å°†æœ¬æ¥äºŒç»´çš„åºåˆ—ï¼ˆåºåˆ—çš„åºåˆ—ï¼‰æ‹å¹³æˆäº†ä¸€ç»´çš„åºåˆ—ã€‚</p>
<h2 id="Error-Handling"><a href="#Error-Handling" class="headerlink" title="Error Handling"></a>Error Handling</h2><p>åœ¨äº‹ä»¶åºåˆ—ä¸­ï¼Œé‡åˆ°å¼‚å¸¸ä¹Ÿæ˜¯å¾ˆæ­£å¸¸çš„äº‹æƒ…ï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¤„ç†å¼‚å¸¸çš„æ‰‹æ®µã€‚</p>
<h3 id="catchError"><a href="#catchError" class="headerlink" title="catchError"></a>catchError</h3><p><code>catchError</code> å¯ä»¥æ•è·å¼‚å¸¸äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨åé¢æ— ç¼æ¥ä¸Šå¦ä¸€æ®µäº‹ä»¶åºåˆ—ï¼Œä¸æ¯«æ²¡æœ‰å¼‚å¸¸çš„ç—•è¿¹ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"catchError 1"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequenceThatFails = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    <span class="keyword">let</span> recoverySequence = sequenceOf(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line">    sequenceThatFails</span><br><span class="line">        .catchError &#123; error <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> recoverySequence</span><br><span class="line">        &#125;</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    sequenceThatFails.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    sequenceThatFails.on(.<span class="type">Next</span>(<span class="number">2</span>))</span><br><span class="line">    sequenceThatFails.on(.<span class="type">Error</span>(<span class="type">NSError</span>(domain: <span class="string">"Test"</span>, code: <span class="number">0</span>, userInfo: <span class="literal">nil</span>)))</span><br><span class="line">&#125;</span><br><span class="line">--- catchError <span class="number">1</span> example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">100</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">200</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="retry"><a href="#retry" class="headerlink" title="retry"></a>retry</h3><p><code>retry</code> é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨å‡ºç°å¼‚å¸¸çš„æ—¶å€™ä¼šå†å»ä»å¤´è®¢é˜…äº‹ä»¶åºåˆ—ï¼Œå¦„å›¾é€šè¿‡ã€ä»å¤´å†æ¥ã€è§£å†³å¼‚å¸¸ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"retry"</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span> = <span class="number">1</span> <span class="comment">// bad practice, only for example purposes</span></span><br><span class="line">    <span class="keyword">let</span> funnyLookingSequence: <span class="type">Observable</span>&lt;<span class="type">Int</span>&gt; = create &#123; observer <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> error = <span class="type">NSError</span>(domain: <span class="string">"Test"</span>, code: <span class="number">0</span>, userInfo: <span class="literal">nil</span>)</span><br><span class="line">        observer.on(.<span class="type">Next</span>(<span class="number">0</span>))</span><br><span class="line">        observer.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">count</span> &lt; <span class="number">2</span> &#123;</span><br><span class="line">            observer.on(.<span class="type">Error</span>(error))</span><br><span class="line">            <span class="built_in">count</span>++</span><br><span class="line">        &#125;</span><br><span class="line">        observer.on(.<span class="type">Next</span>(<span class="number">2</span>))</span><br><span class="line">        observer.on(.<span class="type">Completed</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="type">NopDisposable</span>.instance</span><br><span class="line">    &#125;</span><br><span class="line">    funnyLookingSequence</span><br><span class="line">        .retry()</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- retry example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">0</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">0</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h2 id="Utility"><a href="#Utility" class="headerlink" title="Utility"></a>Utility</h2><p>è¿™é‡Œåˆ—ä¸¾äº†é’ˆå¯¹äº‹ä»¶åºåˆ—çš„ä¸€äº›æ–¹æ³•ã€‚</p>
<h3 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h3><p><code>subscribe</code> åœ¨å‰é¢å·²ç»æ¥è§¦è¿‡äº†ï¼Œæœ‰æ–°çš„äº‹ä»¶å°±ä¼šè§¦å‘ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"subscribe"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequenceOfInts = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    sequenceOfInts</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    sequenceOfInts.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    sequenceOfInts.on(.<span class="type">Completed</span>)</span><br><span class="line">&#125;</span><br><span class="line">--- subscribe example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="subscribeNext"><a href="#subscribeNext" class="headerlink" title="subscribeNext"></a>subscribeNext</h3><p><code>subscribeNext</code> ä¹Ÿæ˜¯è®¢é˜…ï¼Œä½†æ˜¯åªè®¢é˜… <code>.Next</code> äº‹ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"subscribeNext"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequenceOfInts = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    sequenceOfInts</span><br><span class="line">        .subscribeNext &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    sequenceOfInts.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    sequenceOfInts.on(.<span class="type">Completed</span>)</span><br><span class="line">&#125;</span><br><span class="line">--- subscribeNext example ---</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="subscribeCompleted"><a href="#subscribeCompleted" class="headerlink" title="subscribeCompleted"></a>subscribeCompleted</h3><p><code>subscribeCompleted</code> æ˜¯åªè®¢é˜… <code>.Completed</code> å®Œæˆäº‹ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"subscribeCompleted"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequenceOfInts = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    sequenceOfInts</span><br><span class="line">        .subscribeCompleted &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"It's completed"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    sequenceOfInts.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    sequenceOfInts.on(.<span class="type">Completed</span>)</span><br><span class="line">&#125;</span><br><span class="line">--- subscribeCompleted example ---</span><br><span class="line"><span class="type">It's</span> completed</span><br></pre></td></tr></table></figure>

<h3 id="subscribeError"><a href="#subscribeError" class="headerlink" title="subscribeError"></a>subscribeError</h3><p><code>subscribeError</code> åªè®¢é˜… <code>.Error</code> å¤±è´¥äº‹ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"subscribeError"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequenceOfInts = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    sequenceOfInts</span><br><span class="line">        .subscribeError &#123; error <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line">    sequenceOfInts.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    sequenceOfInts.on(.<span class="type">Error</span>(<span class="type">NSError</span>(domain: <span class="string">"Examples"</span>, code: -<span class="number">1</span>, userInfo: <span class="literal">nil</span>)))</span><br><span class="line">&#125;</span><br><span class="line">--- subscribeError example ---</span><br><span class="line"><span class="type">Error</span> <span class="type">Domain</span>=<span class="type">Examples</span> <span class="type">Code</span>=-<span class="number">1</span> <span class="string">"The operation couldnâ€™t be completed. (Examples error -1.)"</span></span><br></pre></td></tr></table></figure>

<h3 id="doOn"><a href="#doOn" class="headerlink" title="doOn"></a>doOn</h3><p><code>doOn</code> å¯ä»¥ç›‘å¬äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨äº‹ä»¶å‘ç”Ÿä¹‹å‰è°ƒç”¨ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"doOn"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequenceOfInts = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    sequenceOfInts</span><br><span class="line">        .doOn &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Intercepted event \($0)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    sequenceOfInts.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    sequenceOfInts.on(.<span class="type">Completed</span>)</span><br><span class="line">&#125;</span><br><span class="line">--- doOn example ---</span><br><span class="line"><span class="type">Intercepted</span> event <span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Intercepted</span> event <span class="type">Completed</span></span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h2 id="Conditional"><a href="#Conditional" class="headerlink" title="Conditional"></a>Conditional</h2><p>æˆ‘ä»¬å¯ä»¥å¯¹å¤šä¸ªäº‹ä»¶åºåˆ—åšä¸€äº›å¤æ‚çš„é€»è¾‘åˆ¤æ–­ã€‚</p>
<h3 id="takeUntil"><a href="#takeUntil" class="headerlink" title="takeUntil"></a>takeUntil</h3><p><code>takeUntil</code> å…¶å®å°±æ˜¯ <code>take</code> ï¼Œå®ƒä¼šåœ¨ç»ˆäºç­‰åˆ°é‚£ä¸ªäº‹ä»¶ä¹‹åè§¦å‘ <code>.Completed</code> äº‹ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"takeUntil"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> originalSequence = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    <span class="keyword">let</span> whenThisSendsNextWorldStops = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    originalSequence</span><br><span class="line">        .takeUntil(whenThisSendsNextWorldStops)</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    originalSequence.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    originalSequence.on(.<span class="type">Next</span>(<span class="number">2</span>))</span><br><span class="line">    whenThisSendsNextWorldStops.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    originalSequence.on(.<span class="type">Next</span>(<span class="number">3</span>))</span><br><span class="line">&#125;</span><br><span class="line">--- takeUntil example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h3 id="takeWhile"><a href="#takeWhile" class="headerlink" title="takeWhile"></a>takeWhile</h3><p><code>takeWhile</code> åˆ™æ˜¯å¯ä»¥é€šè¿‡çŠ¶æ€è¯­å¥åˆ¤æ–­æ˜¯å¦ç»§ç»­ <code>take</code> ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"takeWhile"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sequence = <span class="type">PublishSubject</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">    sequence</span><br><span class="line">        .takeWhile &#123; int <span class="keyword">in</span></span><br><span class="line">            int &lt; <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    sequence.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    sequence.on(.<span class="type">Next</span>(<span class="number">2</span>))</span><br><span class="line">    sequence.on(.<span class="type">Next</span>(<span class="number">3</span>))</span><br><span class="line">&#125;</span><br><span class="line">--- takeWhile example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h2 id="Aggregate"><a href="#Aggregate" class="headerlink" title="Aggregate"></a>Aggregate</h2><p>æˆ‘ä»¬å¯ä»¥å¯¹äº‹ä»¶åºåˆ—åšä¸€äº›é›†åˆè¿ç®—ã€‚</p>
<h3 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h3><p><code>concat</code> å¯ä»¥æŠŠå¤šä¸ªäº‹ä»¶åºåˆ—åˆå¹¶èµ·æ¥ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"concat"</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> var1 = <span class="type">BehaviorSubject</span>(value: <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">let</span> var2 = <span class="type">BehaviorSubject</span>(value: <span class="number">200</span>)</span><br><span class="line">    <span class="comment">// var3 is like an Observable&lt;Observable&lt;Int&gt;&gt;</span></span><br><span class="line">    <span class="keyword">let</span> var3 = <span class="type">BehaviorSubject</span>(value: var1)</span><br><span class="line">    <span class="keyword">let</span> d = var3</span><br><span class="line">        .concat()</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    var1.on(.<span class="type">Next</span>(<span class="number">1</span>))</span><br><span class="line">    var1.on(.<span class="type">Next</span>(<span class="number">2</span>))</span><br><span class="line">    var3.on(.<span class="type">Next</span>(var2))</span><br><span class="line">    var2.on(.<span class="type">Next</span>(<span class="number">201</span>))</span><br><span class="line">    var1.on(.<span class="type">Next</span>(<span class="number">3</span>))</span><br><span class="line">    var1.on(.<span class="type">Completed</span>)</span><br><span class="line">    var2.on(.<span class="type">Next</span>(<span class="number">202</span>))</span><br><span class="line">&#125;</span><br><span class="line">--- concat example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">0</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">2</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">3</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">201</span>)</span><br><span class="line"><span class="type">Next</span>(<span class="number">202</span>)</span><br></pre></td></tr></table></figure>

<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p>è¿™é‡Œçš„ <code>reduce</code> å’Œ <code>CollectionType</code> ä¸­çš„ <code>reduce</code> æ˜¯ä¸€ä¸ªæ„æ€ï¼Œéƒ½æ˜¯æŒ‡é€šè¿‡å¯¹ä¸€ç³»åˆ—æ•°æ®çš„è¿ç®—æœ€åç”Ÿæˆä¸€ä¸ªç»“æœã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">example(<span class="string">"reduce"</span>) &#123;</span><br><span class="line">    sequenceOf(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)</span><br><span class="line">        .<span class="built_in">reduce</span>(<span class="number">0</span>, +)</span><br><span class="line">        .subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">--- <span class="built_in">reduce</span> example ---</span><br><span class="line"><span class="type">Next</span>(<span class="number">45</span>)</span><br><span class="line"><span class="type">Completed</span></span><br></pre></td></tr></table></figure>

<h2 id="Connectable"><a href="#Connectable" class="headerlink" title="Connectable"></a>Connectable</h2><p>å‘å¾…å¡«ï¼ŒXcode é‡Œè¿™ä¸ªæ“åœºè·‘ä¸èµ·æ¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å“åº”å¼ç¼–ç¨‹</tag>
        <tag>RxSwift</tag>
      </tags>
  </entry>
  <entry>
    <title>UIFontå­—ä½“ä¿¡æ¯</title>
    <url>/post/uifont-infos/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>iOSç³»ç»Ÿä¸‹å­—ä½“ä¿¡æ¯ã€‚</p>
<a id="more"></a>

<h2 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h2><ul>
<li>iOS12.0(16A5357b)</li>
<li>iPhone6</li>
</ul>
<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> label = <span class="type">UILabel</span>()</span><br><span class="line">label.text = <span class="string">"è¿™æ˜¯å•¥"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> format: (<span class="type">UIFont</span>) -&gt; [<span class="type">String</span>: <span class="type">Any</span>] = &#123; (font) <span class="keyword">in</span></span><br><span class="line">    label.font = font</span><br><span class="line">    label.sizeToFit()</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">"font.familyName"</span>: font.familyName,</span><br><span class="line">            <span class="string">"font.fontName"</span>: font.fontName,</span><br><span class="line">            <span class="string">"font.pointSize"</span>: font.pointSize,</span><br><span class="line">            <span class="string">"font.ascender"</span>: font.ascender,</span><br><span class="line">            <span class="string">"font.descender"</span>: font.descender,</span><br><span class="line">            <span class="string">"font.capHeight"</span>: font.capHeight,</span><br><span class="line">            <span class="string">"font.xHeight"</span>: font.xHeight,</span><br><span class="line">            <span class="string">"font.lineHeight"</span>: font.lineHeight,</span><br><span class="line">            <span class="string">"font.leading"</span>: font.leading,</span><br><span class="line">            <span class="string">"label.sizeToFit"</span>: label.frame.height]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> json: [<span class="type">String</span>: [[<span class="type">String</span>: <span class="type">Any</span>]]] = [:]</span><br><span class="line"><span class="keyword">for</span> family <span class="keyword">in</span> <span class="type">UIFont</span>.familyNames &#123;</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> <span class="type">UIFont</span>.fontNames(forFamilyName: family) &#123;</span><br><span class="line">        <span class="keyword">var</span> list: [[<span class="type">String</span>: <span class="type">Any</span>]] = []</span><br><span class="line">        <span class="keyword">for</span> size <span class="keyword">in</span> <span class="number">5</span>...<span class="number">60</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> font = <span class="type">UIFont</span>.<span class="keyword">init</span>(name: name, size: <span class="type">CGFloat</span>(size)) <span class="keyword">else</span> &#123; <span class="keyword">continue</span> &#125;</span><br><span class="line">            list.append(format(font))</span><br><span class="line">        &#125;</span><br><span class="line">        json[<span class="string">"\(family) -&gt; \(name)"</span>] = list</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="type">String</span>(data:(<span class="keyword">try</span>? <span class="type">JSONSerialization</span>.data(withJSONObject: json, options: .prettyPrinted)) ?? <span class="type">Data</span>(), encoding: .utf8)!)</span><br></pre></td></tr></table></figure>

<h2 id="é•¿é•¿çš„æ•°æ®"><a href="#é•¿é•¿çš„æ•°æ®" class="headerlink" title="é•¿é•¿çš„æ•°æ®"></a>é•¿é•¿çš„æ•°æ®</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç„¶è€Œæ•°æ®å¤ªå¤šåŠ è½½ä¸å‡ºæ¥ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>UIFont</tag>
      </tags>
  </entry>
  <entry>
    <title>UIç´ æä¸ä»£ç è§£è€¦çš„è®¨è®ºä¸æ€è€ƒ</title>
    <url>/post/ui-source-and-code-decoupling/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>ä¸ªäººå¯¹UIç´ æå’Œä»£ç çš„è§£è€¦çš„ä¸€äº›ç²—æµ…çš„çœ‹æ³•ã€‚æ¯”å¦‚ï¼šè§£è€¦æ–¹æ¡ˆã€æ˜¯å¦è¯¥è§£è€¦ã€‚</p>
<a id="more"></a>

<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>  ç¾¤é‡Œå¬åˆ°æœ‰äººè®¨è®ºè¿™ä¸ªè¯é¢˜ï¼Œå½“æ—¶è§‰å¾—æ¯”è¾ƒæ–°é²œï¼Œå°±ååˆ†å¥½å¥‡çš„è¯·æ•™äº†ä¸¤ä½ç»éªŒä¸°å¯Œçš„@kkkã€@AKï¼Œè™½ç„¶æœªå¾—å…¶ä¸­çœŸé«“ï¼Œä½†æ˜¯ä¹Ÿå¾—åˆ°ä¸€äº›è‡ªå·±çš„æ€è€ƒã€‚æ€»ç»“ä¸€ä¸‹ä¸¤äººçš„æ–¹æ¡ˆï¼Œä»¥åŠè‡ªå·±çš„æ€è€ƒï¼Œ</p>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>  ä»£ç å†…éƒ¨å¼•å…¥çš„ç´ æå±äºè®¾è®¡ç®¡ç†ï¼Œä»£ç åˆ™æ˜¯ç å†œç®¡ç†ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ä¸¤ä¸ªå·¥åšéƒ½æœ‰ç å†œç®¡ç†åˆ™æ˜¯ä¸€ç§è€¦åˆï¼Œä¸ºäº†å‡è½»è®¾è®¡å¸ˆé¢‘ç¹æ›´æ¢ç´ æè€Œå¸¦æ¥çš„ç å†œçš„æ— ä¼‘æ­¢çš„åä½œï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œç€æ–¹é¢çš„è§£è—•ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>  å“ªåå“ªè¡¥ã€‚æœ‰é—®é¢˜å°±ä¼šæœ‰è§£å†³æ–¹æ¡ˆã€‚ç¾¤ä¸­è¯´çš„<a href="#%E6%96%B9%E6%A1%88%E4%B8%80">æ–¹æ¡ˆä¸€</a>ç”±äºå½“æ—¶ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰å¼„æ˜ç™½ã€‚<a href="#%E6%96%B9%E6%A1%88%E4%BA%8C">æ–¹æ¡ˆäºŒ</a>ã€<a href="#%E6%96%B9%E6%A1%88%E4%B8%89">æ–¹æ¡ˆä¸‰</a>æ˜¯è‡ªå·±çš„ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a><a name="æ–¹æ¡ˆä¸€">æ–¹æ¡ˆä¸€</a></h3><p>  ç¾¤ä¸­è®¨è®ºçš„æ˜¯ç´ æã€ä»£ç æ”¾åœ¨ä¸€ä¸ªä»“åº“ï¼Œåˆ†æ”¯ä¸åŒï¼Œä½¿ç”¨è„šæœ¬è¿›è¡Œæ•´åˆ(å…¶å®å¹¶æ²¡æœ‰æƒ³æ˜ç™½æ€ä¹ˆå¼„ã€‚ã€‚ä¸‹å‘¨è¯·æ•™ä¸€ä¸‹)ã€‚å¦å¤–ï¼Œ@å¤æ±æ³¡æ³¡ è¿˜æœ‰ä¸€ä¸ªç®€åŒ–å°±æ˜¯è¿™ä¸ªå¤„ç†çš„è„šæœ¬å¯ä»¥æ”¾åœ¨<a href="https://developer.apple.com/library/ios/recipes/xcode_help-project_editor/Articles/AddingaRunScriptBuildPhase.html" target="_blank" rel="noopener">Add Run Script Build Phase</a>ï¼Œæš´éœ²å‡ºæ¥å·²çŸ¥çš„é—®é¢˜ï¼š</p>
<ul>
<li>æ“ä½œéº»çƒ¦</li>
<li>å›¾ç‰‡å¯èƒ½é‡å¤</li>
<li>å‘½åè§„èŒƒ</li>
</ul>
<h3 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a><a name="æ–¹æ¡ˆäºŒ">æ–¹æ¡ˆäºŒ</a></h3><p>  æŒ‰ç…§Podsçš„é›†æˆæ–¹å¼ï¼Œå¯ä»¥å°†ç´ æçœ‹ä½œä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œç›´æ¥å°†ç´ æåšæˆä¸€ä¸ªbundleï¼Œé‡‡ç”¨Podsç§æœ‰åº“æˆ–è€…å…¶ä»–æ–¹å¼æ”¾å…¥å·¥ç¨‹ã€‚æš´éœ²å‡ºæ¥å·²çŸ¥çš„é—®é¢˜ï¼š</p>
<ul>
<li>ä»€ä¹ˆæ—¶å€™æ›´æ–°è¿™ä¸ªbundle</li>
<li>å¤šäººåˆä½œæ—¶è¿™ä¸ªbundleå†²çªé—®é¢˜</li>
<li>å‘½åè§„èŒƒ</li>
</ul>
<h3 id="æ–¹æ¡ˆä¸‰"><a href="#æ–¹æ¡ˆä¸‰" class="headerlink" title="æ–¹æ¡ˆä¸‰"></a><a name="æ–¹æ¡ˆä¸‰">æ–¹æ¡ˆä¸‰</a></h3><p>  å·¥ç¨‹ä½¿ç”¨<code>xcassets</code>è¿›è¡Œç´ ææ‰“åŒ…ï¼Œç„¶åä½¿ç”¨å­åº“è¿›è¡ŒæŒç»­é›†æˆã€‚è¿™æ ·ï¼Œè®¾è®¡å¸ˆçš„ç´ æå¯ä»¥æ”¾åœ¨å¦ä¸€ä¸ªç‹¬ç«‹ç´ æä»“åº“ï¼Œå†…å«æ›´æ–°è„šæœ¬ï¼Œç›´æ¥å°†ç´ æç”Ÿæˆå¯¹åº”çš„<code>xcassets</code>ç»“æ„ï¼Œå¹¶ä¸Šä¼ è‡³å­åº“ã€‚è¿™æ ·è®¾è®¡å¸ˆåšå®Œç´ æç›´æ¥æ‰”åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œè‡ªåŠ¨æˆ–æ‰‹åŠ¨è·‘ä¸€ä¸‹è„šæœ¬å³å¯æ›´æ–°åˆ°ç´ æä»“åº“ã€‚æš´éœ²å‡ºæ¥å·²çŸ¥çš„é—®é¢˜ï¼š</p>
<ul>
<li>ç”±äºæ²¡æœ‰æµ‹è¯•è¿‡ï¼Œä¸çŸ¥é“å¦‚æœç´ ææ¯”è¾ƒå¤šçš„è¯ä¼šä¸ä¼šå‘ç”Ÿå†²çªã€‚å› è¯¥ä¸ä¼šå§ï¼Œéƒ½æ˜¯åŠ æ–‡ä»¶æˆ–è€…ä¿®æ”¹ğŸ˜‚ (æœ‰æ—¶é—´å»ç ”ç©¶ä¸€ä¸‹ä¹‹åæ›´æ–°)</li>
<li>å‘½åè§„èŒƒçš„é—®é¢˜ä¾æ—§å­˜åœ¨</li>
</ul>
<h3 id="æ–¹æ¡ˆå››"><a href="#æ–¹æ¡ˆå››" class="headerlink" title="æ–¹æ¡ˆå››"></a><a name="æ–¹æ¡ˆå››">æ–¹æ¡ˆå››</a></h3><p>  __ å­—ä½“åº“ __ã€‚æœ€è¿‘åŒäº‹æå‡ºå…³äºç”¨å­—ä½“åº“å»å­˜å‚¨ç´ æå›¾ç‰‡çš„æ–¹æ¡ˆã€‚æ„Ÿè§‰éå¸¸çš„èµï¼Œè™½ç„¶å¹¶æœªå®è·µï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆå°±åƒemojiä¸€æ ·ï¼Œä¸ä½†å‡å°‘äº†ç›¸åŒå›¾ç‰‡å†…å®¹ä¹‹é—´å­˜åœ¨å¤šä¸ªä¸åŒå°ºå¯¸ç‰ˆæœ¬çš„é—®é¢˜ï¼Œä¹Ÿèƒ½å¤Ÿæ¯”è¾ƒå¥½çš„è¿›è¡Œå‹ç¼©ç®¡ç†ã€‚è®¾è®¡å¸ˆéœ€è¦åšçš„å°±æ˜¯åšå‡ºä¸€å¥—å­—ä½“åº“ï¼Œç„¶åå°†æ‰€æœ‰çš„ç´ æå›¾å…¨éƒ¨æŒ‰ç…§è®¾è®¡å­—ä½“çš„æ–¹æ¡ˆè¿›è¡Œè®¾è®¡å’Œåˆ¶ä½œï¼Œè¿™æ ·åœ¨ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦å¯¼å…¥ä¸€ä¸ªå­—ä½“æ–‡ä»¶å°±å¥½äº†ã€‚å¯¹äºè¿™ä¸ªå­—ä½“æ–‡ä»¶å¦‚ä½•ç®¡ç†éƒ½å¥½è¯´ï¼Œæ¯•ç«Ÿåªæœ‰ä¸€ä¸ªå­—ä½“æ–‡ä»¶ã€‚å­—ä½“åº“çš„åˆ¶ä½œæ–¹é¢è¿˜ä¸æ˜¯å¾ˆäº†è§£ï¼Œæ‰€ä»¥åªæç€ä¹ˆä¸€ä¸‹å§å˜¿å˜¿ã€‚ã€‚</p>
<h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>  å¥½äº†ï¼Œé‡è¦çš„é—®é¢˜æ¥äº†ï¼Œä¸Šé¢çš„é—®é¢˜éƒ½æ˜¯å­˜åœ¨å‘½åè§„èŒƒçš„é—®é¢˜ã€‚æ­¤é—®é¢˜å¦‚ä½•åŒ–è§£å‘¢ï¼Ÿ</p>
<p>  ç´ æçš„å¼•å…¥éœ€æ ¹æ®ç´ æåå†™å…¥ä»£ç ä¸­ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰èƒ½ä¸ç”¨ç´ æåå‘¢ï¼Ÿé‚£æ—¶ä¸å¯èƒ½çš„ğŸ˜ï¼Œæ¯•ç«Ÿä½ è¦æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦å»æ ‡å¿—ç€ä¸€ä¸ªç´ æã€‚å¯èƒ½æœ‰çš„äººè¯´å¯ä»¥åšä¸€ä¸ªjsonç”¨æ¥ä¿å­˜ä»£ç çš„å‘½åå’Œç´ æçš„å‘½åå‘€ï¼Œæˆ‘åªæƒ³è¯´MDZZï¼Œé‚£ä¸æ˜¯æœ‰ä¸¤å¥—éœ€è¦ç»´æŠ¤çš„å‘½åè§„åˆ™ä¹ˆã€‚ã€‚å¾—ä¸å¿å¤±ã€‚</p>
<p>  è¿™ä¸ªå‘½åçš„é—®é¢˜å…¶å®ä¸èƒ½å¤æ‚åŒ–ã€‚å‚çœ‹iOSçš„é¡¹ç›®å›½é™…åŒ–æ“ä½œï¼Œä½¿ç”¨ä¸€ä¸ªkeyä½œä¸ºæ–‡æ¡ˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œéœ€è¦æ˜¾ç¤ºè¯¥æ–‡æ¡ˆï¼Œé€šè¿‡è¿™ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦å°±èƒ½ç›´æ¥å–åˆ°ã€‚å›å¤´çœ‹ä¸‹ç´ æï¼Œæ˜¯ä¸æ˜¯ä¹Ÿèƒ½ç‚®åˆ¶ä¸€ä¸ªå‘¢ï¼Ÿ</p>
<p>  å¦‚æœç´ æåå­—æœ‰ç»Ÿä¸€çš„è§„åˆ™ï¼Œå°±ä¸éœ€è¦è¿™æ ·çš„keyä½œä¸ºç»Ÿä¸€æ ‡è¯†ç¬¦ï¼Œç›´æ¥ä½¿ç”¨ç´ æåå­—å³å¯ï¼Œè¿™æ ·ç»´æŠ¤ä¸€å¥—ç´ æå‘½åè§„åˆ™æ€»æ¯”ä¸¤å¥—æ›´å®¹æ˜“ç»´æŠ¤ã€‚æ‰€ä»¥ï¼Œç›´æ¥ä½¿ç”¨ç´ æåå³å¯ã€‚</p>
<p>  å¦‚æœç´ æä¸èƒ½ç»Ÿä¸€å‘½åè§„åˆ™ï¼Œé‚£ä¹ˆè¿™æ ·çš„å¯¹ç…§æ–‡ä»¶å­˜åœ¨ä¹Ÿæ˜¯å¾ˆä¸é”™çš„ã€‚è¯åˆè¯´å›æ¥ï¼Œè¦è¿›è¡ŒUIç´ æå’Œä»£ç çš„è§£è€¦ï¼Œç´ æåéƒ½ä¸èƒ½ç»Ÿä¸€ï¼Œè¿˜å¦‚ä½•è§£è€¦ï¼Œæ­¤é—®é¢˜ä¹Ÿä¸å­˜åœ¨äº†ã€‚ã€‚</p>
<p>  é€€ä¸€æ­¥ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è®©ç´ æè®©è®¾è®¡å¸ˆè‡ªå·±ç»´æŠ¤ï¼Œä»£ç ä¸å»ç»´æŠ¤ç´ æã€‚è®¾è®¡å¸ˆå’Œç å†œçš„è€¦åˆåœ¨äºå›¾ç‰‡æœ¬èº«çš„äº¤æ¢æ¯”è¾ƒçƒ¦ã€‚ä¸è®ºé‡‡ç”¨å“ªç§è§£è€¦æ–¹æ¡ˆï¼Œéƒ½æ˜¯æŠŠå›¾ç‰‡çš„è€¦åˆè½¬æ¢ä¸ºå›¾ç‰‡åå­—çš„è€¦åˆ(ä¹Ÿå¯ä»¥ç†è§£ä¸ºç´ æå¯¹åº”çš„KEYçš„è€¦åˆ)ã€‚ç»“æœæ˜¯ __ ä¸ºäº†è§£é™¤ä¸€ä¸ªè€¦åˆ,è€Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„è€¦åˆ __ ã€‚ä¸ªäººè®¤ä¸ºè¿™æ ·æ˜¯ä¸é è°±çš„ã€‚ã€‚é™¤éæœ‰å¼ºåŠ›çš„äººå»æ¨åŠ¨è®¾è®¡å¸ˆèµ°æ ‡å‡†çš„å‘½åã€‚</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>  å…¶å®è¿™ä¸ªé—®é¢˜å¤§å¯ä¸å¿…çº ç»“ï¼Œå¦‚æœæœ‰å¼ºåŠ›çš„äººå»æ¨åŠ¨è¿™ä¸ªæ ‡å‡†æŒç»­èµ°ä¸‹å»é‚£ä¹ˆè¿™ä¸ªé—®é¢˜æ‰æœ‰ä»·å€¼ã€‚å¦‚æœçœŸçš„è¦è¿›è¡Œé¢˜ä¸­è¯´çš„ä»£ç è§£è€¦çš„è¯ï¼Œæˆ‘è®¤ä¸ºç¬¬ä¸‰ç§æ˜¯æ¯”è¾ƒé è°±çš„ã€‚ __ å‘½åæ ‡å‡†ã€å‘½åæ ‡å‡†ã€å‘½åæ ‡å‡†â€¦ __ã€‚</p>
<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>  ç»éªŒæœ‰é™ï¼Œå¦‚æœæœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œæœ›å‘ŠçŸ¥ã€‚æ‹œè°¢ï¼</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>Xcodeæ‰“åŒ…è„šæœ¬</title>
    <url>/post/build-ipa-sh/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Jenkinsè‡ªåŠ¨æ„å»ºè„šæœ¬è§£å†³æ–¹æ¡ˆã€‚</p>
<a id="more"></a>

<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>2017.9.26æ›´æ–°ï¼š<br>xcode9æ›´æ–°åˆæ— æ³•æ„å»ºå’¯</p>
<p>2017.6.14æ›´æ–°:<br><a href="https://github.com/supermarin/xcpretty" target="_blank" rel="noopener">xcpretty</a>æ ¼å¼åŒ–è¾“å‡ºæ—¥å¿—ã€‚å¾ˆæºœï¼Œè¾“å‡ºæ•ˆæœå’Œ <code>fastlane</code> å·®ä¸å¤šå“ˆå“ˆ</p>
<p>2017.1.13æ›´æ–°ï¼š<br>  å¥½å§ï¼Œå…¶å®æœ‰æ›´åŠ å¼ºæ‚çš„æ‰“åŒ…å·¥å…·ï¼Œè™½ç„¶æ—©æœ‰è€³é—»ä½†æ˜¯æ²¡å¼„ã€‚ç„¶åæœ€è¿‘æ­å»ºäº†ä¸€ä¸‹ï¼Œè¿™æ‰“åŒ…è„šæœ¬ä¹Ÿä¸ç”¨äº†ï¼Œæ¯•ç«Ÿæœ‰æˆå¥—å·¥å…·å˜›ã€‚å˜¿å˜¿<br>  ä¸è¿‡æœ€åä¸Šä¼ oscçš„è„šæœ¬è¿˜æ˜¯å¾ˆå¯ä»¥çš„ã€‚<br>  ä¼ é€é—¨ï¼š<a href="../fastlane-note">Fastlaneè‡ªåŠ¨åŒ–ç¬”è®°</a></p>
<h2 id="Xcode8"><a href="#Xcode8" class="headerlink" title="Xcode8"></a>Xcode8</h2><p>å¥½æ‚²å‚¬ï¼ŒXcode8æ›´æ–°ä¹‹åJenkinsæ‰“åŒ…å¤±è´¥äº†ã€‚ã€‚ç”±äºä»£ç åº“ä¸­ä½¿ç”¨äº†swift3è¯­æ³•ï¼Œæ•…å¿…é¡»ä½¿ç”¨Xcode8ã€‚ã€‚</p>
<p>å…ˆæ¥é‡ç‚¹ï¼šå¯ç”¨è„šæœ¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#   è¿½ä¸Šfir API token è‡ªåŠ¨ä¸Šä¼ </span></span><br><span class="line"><span class="comment">#   åŸºäºå½“å‰ä»£ç è¿›è¡Œæ‰“åŒ…æ‰“åŒ…ç›®å½•ï¼šMyProject/build/MyProject_ent.ipa</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> MyProject</span><br><span class="line"></span><br><span class="line">rm -rf ./build/*</span><br><span class="line"></span><br><span class="line">xcodebuild -archivePath <span class="string">"./build/xxx.xcarchive"</span> -workspace MyProject.xcworkspace -sdk iphoneos -scheme <span class="string">"MyProject_ent"</span> -configuration <span class="string">"Release Inhouse"</span> archive</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;?xml version="</span>1.0<span class="string">" encoding="</span>UTF-8<span class="string">"?&gt;&lt;!DOCTYPE plist PUBLIC "</span>-//Apple//DTD PLIST 1.0//EN<span class="string">" "</span>http://www.apple.com/DTDs/PropertyList-1.0.dtd<span class="string">"&gt;&lt;plist version="</span>1.0<span class="string">"&gt;&lt;dict&gt;&lt;key&gt;method&lt;/key&gt;&lt;string&gt;enterprise&lt;/string&gt;&lt;key&gt;compileBitcode&lt;/key&gt;&lt;string&gt;YES&lt;/string&gt;&lt;/dict&gt;&lt;/plist&gt;"</span> &gt; ./build/exportOptionsPlist.plist</span><br><span class="line"></span><br><span class="line">xcodebuild -exportArchive -archivePath <span class="string">"./build/xxx.xcarchive"</span> -exportPath <span class="string">"./build/"</span> -exportOptionsPlist ./build/exportOptionsPlist.plist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> build/</span><br><span class="line"></span><br><span class="line">fir i ./MyProject_ent.ipa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$1</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">    git <span class="built_in">log</span> -10 &gt; git.log</span><br><span class="line">    fir p ./MyProject_ent.ipa -T <span class="variable">$1</span> -c git.log</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹å‰æ¼æ‰äº†ä¸€ä¸ªé”™è¯¯ï¼š<code>The flag -exportFormat cannot be specified along with -exportOptionsPlist</code> å¯¼è‡´äº†æœ€ç»ˆåŒ…ç­¾åé”™è¯¯ï¼Œè€Œæ— æ³•å®‰è£…ã€‚</p>
<p>exportOptionsPlistå‚è€ƒçš„<a href="https://testerhome.com/topics/4619" target="_blank" rel="noopener">iOS æ‰“åŒ…æ€»ç»“</a></p>
<h2 id="æ‰‹åŠ¨ä¸Šä¼ "><a href="#æ‰‹åŠ¨ä¸Šä¼ " class="headerlink" title="æ‰‹åŠ¨ä¸Šä¼ "></a>æ‰‹åŠ¨ä¸Šä¼ </h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">#   è¿½ä¸Šfir API token è‡ªåŠ¨ä¸Šä¼ </span><br><span class="line">#   åŸºäºå½“å‰ä»£ç è¿›è¡Œæ‰“åŒ…æ‰“åŒ…ç›®å½•ï¼šxxxx&#x2F;build&#x2F;xxxx_ent.ipa</span><br><span class="line"></span><br><span class="line">workspace_name&#x3D;xxxx</span><br><span class="line">scheme_name&#x3D;xxxx_ent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd $workspace_name</span><br><span class="line"></span><br><span class="line">rm -rf .&#x2F;build&#x2F;*</span><br><span class="line"></span><br><span class="line">xcodebuild clean -workspace $workspace_name.xcworkspace -scheme $scheme_nam -configuration Release | xcpretty</span><br><span class="line"></span><br><span class="line">xcodebuild archive -archivePath &quot;.&#x2F;build&#x2F;xxx.xcarchive&quot; -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration &quot;Release Inhouse&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; .&#x2F;build&#x2F;exportOptionsPlist.plist</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-&#x2F;&#x2F;Apple&#x2F;&#x2F;DTD PLIST 1.0&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;www.apple.com&#x2F;DTDs&#x2F;PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version&#x3D;&quot;1.0&quot;&gt;</span><br><span class="line">    &lt;dict&gt;</span><br><span class="line">        &lt;key&gt;method&lt;&#x2F;key&gt;</span><br><span class="line">        &lt;string&gt;enterprise&lt;&#x2F;string&gt;</span><br><span class="line">        &lt;key&gt;compileBitcode&lt;&#x2F;key&gt;</span><br><span class="line">            &lt;false&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;dict&gt;</span><br><span class="line">&lt;&#x2F;plist&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">xcodebuild -exportArchive -archivePath &quot;.&#x2F;build&#x2F;xxx.xcarchive&quot; -exportOptionsPlist &quot;.&#x2F;build&#x2F;exportOptionsPlist.plist&quot; -exportPath &quot;.&#x2F;build&#x2F;&quot;</span><br><span class="line"></span><br><span class="line">cd build&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git log -10 &gt; git.log</span><br><span class="line"></span><br><span class="line">#æ‹·è´ipaåˆ°ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­</span><br><span class="line">cp .&#x2F;$scheme_name.ipa .&#x2F;tmp.zip</span><br><span class="line">#å°†ipaè§£å‹</span><br><span class="line">unzip tmp.zip</span><br><span class="line"></span><br><span class="line">#appæ–‡ä»¶ä¸­Info.plistæ–‡ä»¶è·¯å¾„</span><br><span class="line">app_infoplist_path&#x3D;$(pwd)&#x2F;Payload&#x2F;*.app&#x2F;Info.plist</span><br><span class="line">#å–bundleIdentifier</span><br><span class="line">bundleIdentifier&#x3D;$(&#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;print CFBundleIdentifier&quot; $&#123;app_infoplist_path&#125;)</span><br><span class="line">#å–buildå€¼</span><br><span class="line">bundleVersion&#x3D;$(&#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;print CFBundleVersion&quot; $&#123;app_infoplist_path&#125;)</span><br><span class="line">#æ˜¾ç¤ºåç§°</span><br><span class="line">ipa_name&#x3D;$workspace_name</span><br><span class="line"></span><br><span class="line">#ipaä¸‹è½½url</span><br><span class="line">ipa_download_url&#x3D;&quot;https:&#x2F;&#x2F;***&#x2F;install_ipa&#x2F;raw&#x2F;master&#x2F;xxxx_ent.ipa&quot;</span><br><span class="line">#itms-servicesåè®®ä¸²</span><br><span class="line">ios_install_url&#x3D;&quot;itms-services:&#x2F;&#x2F;?action&#x3D;download-manifest&amp;url&#x3D;https:&#x2F;&#x2F;***&#x2F;install_ipa&#x2F;raw&#x2F;master&#x2F;xxxx_ent.plist&quot;</span><br><span class="line"></span><br><span class="line">#ç”Ÿæˆinstall.htmlæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; index.html</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; &#x2F;&gt;</span><br><span class="line">    &lt;title&gt;å®‰è£…&lt;&#x2F;title&gt;</span><br><span class="line">  &lt;&#x2F;head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;p align&#x3D;center&gt;</span><br><span class="line">        &lt;font size&#x3D;&quot;8&quot;&gt;</span><br><span class="line">            &lt;a href&#x3D;&quot;$&#123;ios_install_url&#125;&quot;&gt;ç‚¹å‡»è¿™é‡Œå®‰è£…&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;&#x2F;font&gt;</span><br><span class="line">    &lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">#ç”Ÿæˆplistæ–‡ä»¶</span><br><span class="line">cat &lt;&lt; EOF &gt; $&#123;workspace_name&#125;.plist</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-&#x2F;&#x2F;Apple&#x2F;&#x2F;DTD PLIST 1.0&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;www.apple.com&#x2F;DTDs&#x2F;PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version&#x3D;&quot;1.0&quot;&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">    &lt;key&gt;items&lt;&#x2F;key&gt;</span><br><span class="line">    &lt;array&gt;</span><br><span class="line">        &lt;dict&gt;</span><br><span class="line">            &lt;key&gt;assets&lt;&#x2F;key&gt;</span><br><span class="line">            &lt;array&gt;</span><br><span class="line">                &lt;dict&gt;</span><br><span class="line">                    &lt;key&gt;kind&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;software-package&lt;&#x2F;string&gt;</span><br><span class="line">                    &lt;key&gt;url&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;$&#123;ipa_download_url&#125;&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;&#x2F;dict&gt;</span><br><span class="line">                &lt;dict&gt;</span><br><span class="line">                    &lt;key&gt;kind&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;display-image&lt;&#x2F;string&gt;</span><br><span class="line">                    &lt;key&gt;needs-shine&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;true&#x2F;&gt;</span><br><span class="line">                    &lt;key&gt;url&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;http:&#x2F;&#x2F;git.oschina.net&#x2F;logo.svg&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;&#x2F;dict&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                    &lt;key&gt;kind&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;full-size-image&lt;&#x2F;string&gt;</span><br><span class="line">                    &lt;key&gt;needs-shine&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;true&#x2F;&gt;</span><br><span class="line">                    &lt;key&gt;url&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;http:&#x2F;&#x2F;git.oschina.net&#x2F;logo.svg&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;&#x2F;dict&gt;</span><br><span class="line">            &lt;&#x2F;array&gt;&lt;key&gt;metadata&lt;&#x2F;key&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                &lt;key&gt;bundle-identifier&lt;&#x2F;key&gt;</span><br><span class="line">                &lt;string&gt;$&#123;bundleIdentifier&#125;&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;key&gt;bundle-version&lt;&#x2F;key&gt;</span><br><span class="line">                &lt;string&gt;$&#123;bundleVersion&#125;&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;key&gt;kind&lt;&#x2F;key&gt;</span><br><span class="line">                &lt;string&gt;software&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;key&gt;subtitle&lt;&#x2F;key&gt;</span><br><span class="line">                &lt;string&gt;$&#123;ipa_name&#125;&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;key&gt;title&lt;&#x2F;key&gt;</span><br><span class="line">                &lt;string&gt;$&#123;ipa_name&#125;&lt;&#x2F;string&gt;</span><br><span class="line">            &lt;&#x2F;dict&gt;</span><br><span class="line">        &lt;&#x2F;dict&gt;</span><br><span class="line">    &lt;&#x2F;array&gt;</span><br><span class="line">&lt;&#x2F;dict&gt;</span><br><span class="line">&lt;&#x2F;plist&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">fir i $scheme_name.ipa</span><br></pre></td></tr></table></figure>

<h2 id="æ‰‹åŠ¨ä¸Šä¼ åˆ°OSCè„šæœ¬"><a href="#æ‰‹åŠ¨ä¸Šä¼ åˆ°OSCè„šæœ¬" class="headerlink" title="æ‰‹åŠ¨ä¸Šä¼ åˆ°OSCè„šæœ¬"></a>æ‰‹åŠ¨ä¸Šä¼ åˆ°OSCè„šæœ¬</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">root_path&#x3D;$(pwd)</span><br><span class="line">workspace_name&#x3D;Fangduoduo</span><br><span class="line">scheme_name&#x3D;XXX</span><br><span class="line"></span><br><span class="line"># ç¼–è¯‘</span><br><span class="line">cd $root_path</span><br><span class="line">cd $workspace_name</span><br><span class="line"></span><br><span class="line">rm -rf .&#x2F;build&#x2F;*</span><br><span class="line"></span><br><span class="line">xcodebuild -archivePath .&#x2F;build&#x2F;$scheme_name.xcarchive -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration &quot;Release Inhouse&quot; archive</span><br><span class="line"></span><br><span class="line">echo &quot;&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-&#x2F;&#x2F;Apple&#x2F;&#x2F;DTD PLIST 1.0&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;www.apple.com&#x2F;DTDs&#x2F;PropertyList-1.0.dtd&quot;&gt;&lt;plist version&#x3D;&quot;1.0&quot;&gt;&lt;dict&gt;&lt;key&gt;method&lt;&#x2F;key&gt;&lt;string&gt;enterprise&lt;&#x2F;string&gt;&lt;key&gt;compileBitcode&lt;&#x2F;key&gt;&lt;false&#x2F;&gt;&lt;&#x2F;dict&gt;&lt;&#x2F;plist&gt;&quot; &gt; .&#x2F;build&#x2F;exportOptionsPlist.plist</span><br><span class="line"></span><br><span class="line">xcodebuild -exportArchive -archivePath .&#x2F;build&#x2F;$scheme_name.xcarchive -exportOptionsPlist &quot;.&#x2F;build&#x2F;exportOptionsPlist.plist&quot; -exportPath &quot;.&#x2F;build&#x2F;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd build&#x2F;</span><br><span class="line"></span><br><span class="line">if [ ! -f $scheme_name.ipa ]; then</span><br><span class="line">    echo &quot;*** æ— æ³•æ‰“åŒ… ***&quot;</span><br><span class="line">    exit -1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">fir i .&#x2F;$scheme_name.ipa</span><br><span class="line"></span><br><span class="line">git log -10 &gt; git.log</span><br><span class="line">git_log&#x3D;$(cat git.log)</span><br><span class="line"># fir ä¸Šä¼ </span><br><span class="line">if [ -n &quot;$1&quot; ]; then</span><br><span class="line">    fir p .&#x2F;$scheme_name.ipa -T $1 -c git.log</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ ¡éªŒHTMLå¹¶ä¸Šä¼ </span><br><span class="line"></span><br><span class="line">public_git_path&#x3D;$root_path&#x2F;public_ipa_tmp&#x2F;</span><br><span class="line">public_git_root&#x3D;&quot;install_ipa&quot;</span><br><span class="line">public_git&#x3D;&quot;https:&#x2F;&#x2F;***&#x2F;install_ipa.git&quot;</span><br><span class="line">#ipaä¸‹è½½url</span><br><span class="line">ipa_download_url&#x3D;&quot;https:&#x2F;&#x2F;***&#x2F;install_ipa&#x2F;raw&#x2F;master&#x2F;XXX.ipa&quot;</span><br><span class="line">#itms-servicesåè®®ä¸²</span><br><span class="line">ios_install_url&#x3D;&quot;itms-services:&#x2F;&#x2F;?action&#x3D;download-manifest&amp;url&#x3D;https:&#x2F;&#x2F;***&#x2F;install_ipa&#x2F;raw&#x2F;master&#x2F;XXX.plist&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd $root_path&#x2F;</span><br><span class="line"># checkout path is OK</span><br><span class="line">if [ ! -e $public_git_path ]; then</span><br><span class="line">    mkdir $public_git_path</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -n $public_git_path ]; then</span><br><span class="line">    rm -rf $public_git_path</span><br><span class="line">fi</span><br><span class="line">mkdir $public_git_path</span><br><span class="line">cd $public_git_path</span><br><span class="line">git init</span><br><span class="line">git remote add origin $public_git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd $root_path&#x2F;$workspace_name&#x2F;build&#x2F;</span><br><span class="line"></span><br><span class="line">#æ‹·è´ipaåˆ°ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­</span><br><span class="line">cp .&#x2F;$scheme_name.ipa .&#x2F;tmp.zip</span><br><span class="line">rm -rf Payload</span><br><span class="line">#å°†ipaè§£å‹</span><br><span class="line">unzip tmp.zip</span><br><span class="line"></span><br><span class="line">#appæ–‡ä»¶ä¸­Info.plistæ–‡ä»¶è·¯å¾„</span><br><span class="line">app_infoplist_path&#x3D;$(pwd)&#x2F;Payload&#x2F;*.app&#x2F;Info.plist</span><br><span class="line">#å–bundleIdentifier</span><br><span class="line">bundleIdentifier&#x3D;$(&#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;print CFBundleIdentifier&quot; $&#123;app_infoplist_path&#125;)</span><br><span class="line">#å–buildå€¼</span><br><span class="line">bundleVersion&#x3D;$(&#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;print CFBundleVersion&quot; $&#123;app_infoplist_path&#125;)</span><br><span class="line">#å–shortVersionbuildå€¼</span><br><span class="line">shortVersion&#x3D;$(&#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;print CFBundleShortVersionString&quot; $&#123;app_infoplist_path&#125;)</span><br><span class="line">#æ˜¾ç¤ºåç§°</span><br><span class="line">ipa_name&#x3D;$(&#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;print CFBundleDisplayName&quot; $&#123;app_infoplist_path&#125;)</span><br><span class="line">nowTime&#x3D;$(date +%Y-%m-%d\ %H:%M)</span><br><span class="line">log_url&#x3D;&quot;https:&#x2F;&#x2F;madordie.github.io&#x2F;uploads&#x2F;avatar.png&quot;</span><br><span class="line"></span><br><span class="line">#ç”Ÿæˆinstall.htmlæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; index.html</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; &#x2F;&gt;</span><br><span class="line">&lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width,initial-scale&#x3D;1,minimum-scale&#x3D;1,maximum-scale&#x3D;1,user-scalable&#x3D;0&quot;&gt;</span><br><span class="line">&lt;title&gt;$&#123;ipa_name&#125;å®‰è£…&lt;&#x2F;title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.containor &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    margin: 0 auto;</span><br><span class="line">    width: 100%;</span><br><span class="line">    max-width: 640px;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line">.logo &#123;</span><br><span class="line">    width: 120px;</span><br><span class="line">    margin-top: 30px;</span><br><span class="line">&#125;</span><br><span class="line">.title,</span><br><span class="line">.version_history,</span><br><span class="line">.update_time &#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">    color: #999;</span><br><span class="line">    font-size: 16px;</span><br><span class="line">&#125;</span><br><span class="line">.title &#123;</span><br><span class="line">    margin-top: 10px;</span><br><span class="line">&#125;</span><br><span class="line">.version_history,</span><br><span class="line">.update_time &#123;</span><br><span class="line">    margin-top: 5px;</span><br><span class="line">&#125;</span><br><span class="line">.download &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    width: 150px;</span><br><span class="line">    height: 30px;</span><br><span class="line">    line-height: 30px;</span><br><span class="line">    margin: 0 auto;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">    border: 1px solid #eee;</span><br><span class="line">    border-radius: 20px;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">    color: #999;</span><br><span class="line">&#125;</span><br><span class="line">.log_title &#123;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">    font-size: 18px;</span><br><span class="line">    color: #333;</span><br><span class="line">&#125;</span><br><span class="line">.log &#123;</span><br><span class="line">    color: #aaa;</span><br><span class="line">    padding: 20px;</span><br><span class="line">    text-align: left;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">    line-height: 15px;</span><br><span class="line">    white-space: pre-wrap;</span><br><span class="line">    word-wrap: break-word;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;containor&quot;&gt;</span><br><span class="line">    &lt;img class&#x3D;&quot;logo&quot; src&#x3D;$&#123;log_url&#125; &#x2F;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;title&quot;&gt;$ipa_name&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;version_history&quot;&gt;$&#123;shortVersion&#125;(bundle:$&#123;bundleVersion&#125;)&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;update_time&quot;&gt;$&#123;nowTime&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;a class&#x3D;&quot;download&quot; href&#x3D;&quot;$&#123;ios_install_url&#125;&quot;&gt;ç‚¹å‡»è¿™é‡Œå®‰è£…&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;log_title&quot;&gt;æ›´æ–°æ—¥å¿—&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;log&quot;&gt; $&#123;git_log&#125; &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">#ç”Ÿæˆplistæ–‡ä»¶</span><br><span class="line">cat &lt;&lt; EOF &gt; $&#123;scheme_name&#125;.plist</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-&#x2F;&#x2F;Apple&#x2F;&#x2F;DTD PLIST 1.0&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;www.apple.com&#x2F;DTDs&#x2F;PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version&#x3D;&quot;1.0&quot;&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">    &lt;key&gt;items&lt;&#x2F;key&gt;</span><br><span class="line">    &lt;array&gt;</span><br><span class="line">        &lt;dict&gt;</span><br><span class="line">            &lt;key&gt;assets&lt;&#x2F;key&gt;</span><br><span class="line">            &lt;array&gt;</span><br><span class="line">                &lt;dict&gt;</span><br><span class="line">                    &lt;key&gt;kind&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;software-package&lt;&#x2F;string&gt;</span><br><span class="line">                    &lt;key&gt;url&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;$&#123;ipa_download_url&#125;&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;&#x2F;dict&gt;</span><br><span class="line">                &lt;dict&gt;</span><br><span class="line">                    &lt;key&gt;kind&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;display-image&lt;&#x2F;string&gt;</span><br><span class="line">                    &lt;key&gt;needs-shine&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;true&#x2F;&gt;</span><br><span class="line">                    &lt;key&gt;url&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;http:&#x2F;&#x2F;git.oschina.net&#x2F;logo.svg&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;&#x2F;dict&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                    &lt;key&gt;kind&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;full-size-image&lt;&#x2F;string&gt;</span><br><span class="line">                    &lt;key&gt;needs-shine&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;true&#x2F;&gt;</span><br><span class="line">                    &lt;key&gt;url&lt;&#x2F;key&gt;</span><br><span class="line">                    &lt;string&gt;http:&#x2F;&#x2F;git.oschina.net&#x2F;logo.svg&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;&#x2F;dict&gt;</span><br><span class="line">            &lt;&#x2F;array&gt;&lt;key&gt;metadata&lt;&#x2F;key&gt;</span><br><span class="line">            &lt;dict&gt;</span><br><span class="line">                &lt;key&gt;bundle-identifier&lt;&#x2F;key&gt;</span><br><span class="line">                &lt;string&gt;$&#123;bundleIdentifier&#125;&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;key&gt;bundle-version&lt;&#x2F;key&gt;</span><br><span class="line">                &lt;string&gt;$&#123;bundleVersion&#125;&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;key&gt;kind&lt;&#x2F;key&gt;</span><br><span class="line">                &lt;string&gt;software&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;key&gt;subtitle&lt;&#x2F;key&gt;</span><br><span class="line">                &lt;string&gt;$&#123;ipa_name&#125;&lt;&#x2F;string&gt;</span><br><span class="line">                &lt;key&gt;title&lt;&#x2F;key&gt;</span><br><span class="line">                &lt;string&gt;$&#123;ipa_name&#125;&lt;&#x2F;string&gt;</span><br><span class="line">            &lt;&#x2F;dict&gt;</span><br><span class="line">        &lt;&#x2F;dict&gt;</span><br><span class="line">    &lt;&#x2F;array&gt;</span><br><span class="line">&lt;&#x2F;dict&gt;</span><br><span class="line">&lt;&#x2F;plist&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">#fir i $scheme_name.ipa</span><br><span class="line">cp $scheme_name.ipa $public_git_path</span><br><span class="line">cp $scheme_name.plist $public_git_path</span><br><span class="line">cp index.html $public_git_path</span><br><span class="line"></span><br><span class="line">cd $public_git_path</span><br><span class="line">ls -l &gt; README.md</span><br><span class="line">if [ ! -e &quot;.&#x2F;.git&#x2F;&quot; ]; then</span><br><span class="line">    echo &quot;*** OSCçš„gitç›®å½•ä¸å®Œæ•´ï¼Œæ— æ³•ä¸Šä¼ ï¼Œè¯·è”ç³»å¼€å‘! ***&quot;</span><br><span class="line">    exit -1</span><br><span class="line">fi</span><br><span class="line">echo &quot;commit and pushing ...&quot;</span><br><span class="line">git add .</span><br><span class="line">git commit -am $bundleVersion</span><br><span class="line">git push -f origin master</span><br></pre></td></tr></table></figure>

<h2 id="å°†ç¬¦å·è¡¨dsymä¸Šä¼ è‡³bugly"><a href="#å°†ç¬¦å·è¡¨dsymä¸Šä¼ è‡³bugly" class="headerlink" title="å°†ç¬¦å·è¡¨dsymä¸Šä¼ è‡³bugly"></a>å°†ç¬¦å·è¡¨dsymä¸Šä¼ è‡³bugly</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">path=<span class="string">'/Users/xx/.jenkins/workspace/xzx'</span></span><br><span class="line">schem=<span class="string">'xx'</span></span><br><span class="line">package=<span class="string">'xx'</span></span><br><span class="line">bugly_id=<span class="string">'xx'</span></span><br><span class="line">bugly_key=<span class="string">'xx'</span></span><br><span class="line"></span><br><span class="line">cp <span class="variable">$&#123;path&#125;</span>/xx/Info.plist ./Info.plist</span><br><span class="line">cp <span class="variable">$&#123;path&#125;</span>/xx.app.dSYM.zip ./dsym.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------ post dsym ------------ #</span></span><br><span class="line"></span><br><span class="line">unzip -o dsym.zip -d dsym</span><br><span class="line">app_infoplist_path=<span class="string">'Info.plist'</span></span><br><span class="line">version=$(/usr/libexec/PlistBuddy -c <span class="string">"print CFBundleVersion"</span> <span class="variable">$&#123;app_infoplist_path&#125;</span>)</span><br><span class="line"></span><br><span class="line">java -jar ./bugly/buglySymboliOS.jar \</span><br><span class="line">    -i dsym/<span class="variable">$&#123;scheme&#125;</span> \</span><br><span class="line">    -dsym \</span><br><span class="line">    -u \</span><br><span class="line">    -id <span class="variable">$&#123;bugly_id&#125;</span> \</span><br><span class="line">    -key <span class="variable">$&#123;bugly_key&#125;</span> \</span><br><span class="line">    -package <span class="variable">$&#123;package&#125;</span> \</span><br><span class="line">    -version <span class="variable">$&#123;version&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------ UUID ------------ #</span></span><br><span class="line"></span><br><span class="line">unzip -o ./dsym/<span class="variable">$&#123;scheme&#125;</span>.zip</span><br><span class="line">xcrun dwarfdump --uuid ./<span class="variable">$&#123;scheme&#125;</span> &gt;&gt; ./uuids-<span class="variable">$&#123;version&#125;</span>.txt</span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹ç¯å¢ƒä»£ç "><a href="#ä¿®æ”¹ç¯å¢ƒä»£ç " class="headerlink" title="ä¿®æ”¹ç¯å¢ƒä»£ç "></a>ä¿®æ”¹ç¯å¢ƒä»£ç </h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">''</span> <span class="string">"s/#define RELEASE_MODE [[:digit:]]/#define RELEASE_MODE <span class="variable">$&#123;mode&#125;</span>/g"</span> ./Fangduoduo/config/AppConfig.h</span><br></pre></td></tr></table></figure>

<h2 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ul>
<li><a href="http://flummox-engineering.blogspot.com/2016/01/installing-jenkins-os-x-homebrew.html" target="_blank" rel="noopener">Installing Jenkins OS X Homebrew</a></li>
</ul>
<h3 id="åå°è¿è¡Œ"><a href="#åå°è¿è¡Œ" class="headerlink" title="åå°è¿è¡Œ"></a>åå°è¿è¡Œ</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">brew services start jenkins</span><br></pre></td></tr></table></figure>
<p>æ— æ³•è¯†åˆ«gerritâ€¦.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nohup jenkins &gt; ~/fdd-backup/jenkins.log g 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>æ— æ³•ç­¾åâ€¦</p>
<p>ä¸Šé¢2ä¸ªæ–¹æ¡ˆå¹¶ä¸æ˜¯ä¸èƒ½è¿è¡Œï¼Œè€Œæ˜¯éœ€è¦é¢å¤–é…ç½®ã€‚ã€‚ğŸ˜‚</p>
<hr>
<ul>
<li><a href="https://gxnotes.com/article/61107.html" target="_blank" rel="noopener">https://gxnotes.com/article/61107.html</a></li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS11-beta</title>
    <url>/post/ios11-beta/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>iOS11 é¢„è§ˆç‰ˆå®‰è£…ä½“éªŒç¬”è®°ã€‚</p>
<a id="more"></a>

<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æ¯•ç«Ÿbetaç‰ˆï¼Œå‡çº§éœ€è°¨æ…ã€‚ç›®å‰æ¥çœ‹ä½“éªŒä¸Šè¿˜æ˜¯æœ‰ç‚¹å¡çš„ï½ï½ğŸ˜‚</p>
<p>å¡é¡¿è®©æˆ‘å®åœ¨æ— æ³•å¿å—ï¼Œå¹¶ä¸6.15å·é‡ç½®å›iOS10.3.2 ã€‚ã€‚ã€‚</p>
<p>9.13 GMå‡ºæ¥äº†ï¼Œå†å®‰è£…ï½ï½</p>
<p>é€‚é…æœ‰å…ˆåï¼ŒiOS11é©¬ä¸Šå°±è¦å‘äº†ï¼Œè€ŒiPhoneXè¿˜éœ€è¦ç­‰ä¸€å°æ®µæ—¶é—´ã€‚æ‰€ä»¥iOS11çš„é€‚é…æ¯”iPhoneXæœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï½</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="å¤±æ•ˆçš„automaticallyAdjustsScrollViewInsets"><a href="#å¤±æ•ˆçš„automaticallyAdjustsScrollViewInsets" class="headerlink" title="å¤±æ•ˆçš„automaticallyAdjustsScrollViewInsets"></a><a name='automaticallyAdjustsScrollViewInsets'>å¤±æ•ˆçš„<code>automaticallyAdjustsScrollViewInsets</code></a></h3><p>iOS11 ç‰ˆæœ¬ä¸­ __ç«‹å³å¤±æ•ˆ__ã€‚</p>
<p>æœ€å®¹æ˜“å‡ºé—®é¢˜çš„å°±æ˜¯æ— å¯¼èˆªçš„é¡¶éƒ¨åˆ·æ–°ä¼šè«åå…¶å¦™çš„ç¼©ä¸è¿›å»ï½ï½</p>
<p><img src="/images/ios11-beta-1.jpg" alt="æ•ˆæœå›¾"></p>
<p>è¿˜æœ‰å°±æ˜¯å¦‚æœæ²¡æœ‰ä½¿ç”¨è¿™ä¸ª<code>automaticallyAdjustsScrollViewInsets</code>ï¼Œä¸ºäº†è¾¾åˆ°é‚£ç§æˆ³è¿›å»çš„ä»£ç ç›´æ¥è®¾ç½®<code>frame.y = 0</code>ã€‚è¿™ç§æ“ä½œä¸ä½†ä¼šå‡ºç°å¯¼èˆªæ è«åå…¶å¦™çš„æˆ³å‡ºæ¥ï¼Œè¿˜æœ‰<code>UITableView.section.header</code>è«åé”™ä½çš„é—®é¢˜ã€‚</p>
<p><img src="/images/ios11-beta-2.gif" alt="æ•ˆæœå›¾"></p>
<p>API å£°æ˜ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">2.0</span>, *)</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UIViewController</span> : <span class="title">UIResponder</span>, ... </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="meta">@available</span>(iOS, introduced: <span class="number">7.0</span>, deprecated: <span class="number">11.0</span>)</span><br><span class="line">	<span class="keyword">open</span> <span class="keyword">var</span> automaticallyAdjustsScrollViewInsets: <span class="type">Bool</span> <span class="comment">// Defaults to YES</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›¸åº”çš„çš„æ›¿æ¢æ–¹æ¡ˆï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">2.0</span>, *)</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UIScrollView</span> : <span class="title">UIView</span>, ... </span>&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">/* Configure the behavior of adjustedContentInset.</span></span><br><span class="line"><span class="comment">     Default is UIScrollViewContentInsetAdjustmentAutomatic.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">11.0</span>, *)</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> contentInsetAdjustmentBehavior: <span class="type">UIScrollViewContentInsetAdjustmentBehavior</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="decisionHandler-allow-was-called-more-than-once"><a href="#decisionHandler-allow-was-called-more-than-once" class="headerlink" title="decisionHandler(.allow) was called more than once"></a><a name='decisionHandler'><code>decisionHandler(.allow)</code> was called more than once</a></h3><p>å´©æºƒä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#0 Thread</span><br><span class="line">NSInternalInconsistencyException</span><br><span class="line">Completion handler passed to -[WKWebViewJavascriptBridge webView:decidePolicyForNavigationAction:decisionHandler:] was called more than once</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="noopener">WebViewJavascriptBridge</a>åœ¨iOS11ä¸Šçš„ä¸€ä¸ª<a href="https://github.com/marcuswestin/WebViewJavascriptBridge/issues/302" target="_blank" rel="noopener">Issues#302</a>ã€‚</p>
<p>æ®åŒäº‹è¯´å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è§£å†³ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="type">WebViewJavascriptBridgeBase</span>().isWebViewJavascriptBridgeURL(url) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">decisionHandler(.allow)</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•äº†ä¸€ä¸‹ç¡®å®ä¸å´©æºƒäº†ï¼Œä½†æ˜¯å…·ä½“çš„è§£å†³æ–¹æ¡ˆè¿˜è¦çœ‹ä½œè€…çš„åœ¨<a href="https://github.com/marcuswestin/WebViewJavascriptBridge/issues/302" target="_blank" rel="noopener">Issues#302</a>ä¸­çš„å›å¤ã€‚</p>
<h3 id="ç…§ç‰‡å­˜å‚¨æ—¶å€™æŸäº›è®¾å¤‡å¿…crash"><a href="#ç…§ç‰‡å­˜å‚¨æ—¶å€™æŸäº›è®¾å¤‡å¿…crash" class="headerlink" title="ç…§ç‰‡å­˜å‚¨æ—¶å€™æŸäº›è®¾å¤‡å¿…crash"></a><a name='savePhoto'>ç…§ç‰‡å­˜å‚¨æ—¶å€™æŸäº›è®¾å¤‡å¿…crash</a></h3><p>å´©æºƒä¿¡æ¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2017-09-29 11:36:17.338816+0800 Demo-iOS11-crash-save-photo[636:139456]</span><br><span class="line"> [access] This app has crashed because it attempted to access privacy-sensitive data without a usage description. </span><br><span class="line"> The app&#39;s Info.plist must contain an NSPhotoLibraryAddUsageDescription key with a string value explaining to the user how the app uses this data.</span><br></pre></td></tr></table></figure>

<p>æ˜¯çš„ï¼Œè¿™ä¸ª<a href="https://github.com/madordie/Demo-iOS11-crash-save-photo" target="_blank" rel="noopener">Demo</a>è¿˜æœ‰ä¸€ä¸ªcrashçš„æç¤ºã€‚ä½†æ˜¯åœ¨å¤§å·¥ç¨‹ä¸­ï¼Œæˆ‘å¹¶æ²¡æœ‰çœ‹åˆ°è¿™æ ·çš„ç©æ„è¾“å‡ºå‡ºæ¥ã€‚ã€‚æˆ‘åšçš„å¤ç°æ“ä½œè¾ƒç®€å•ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> img = <span class="type">UIImage</span>(named: <span class="string">"278.jpg"</span>)</span><br><span class="line"><span class="keyword">let</span> library = <span class="type">ALAssetsLibrary</span>()</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> orientation = <span class="type">ALAssetOrientation</span>(rawValue: img?.imageOrientation.rawValue ?? <span class="number">0</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">library.writeImage(toSavedPhotosAlbum: img?.cgImage, orientation: orientation) &#123; (url, error) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span> error != <span class="literal">nil</span> <span class="keyword">else</span> &#123; <span class="built_in">print</span>(<span class="string">"no crash"</span>); <span class="keyword">return</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°±è¿™ä¹ˆå¤šä»£ç ï¼Œä¸ç®¡æ˜¯æ‰“æ²¡æ‰“<code>Swift Error</code>ã€<code>All Exceptions</code>éƒ½æ— æ³•å®šä½åˆ°ä¸Šé¢ä»£ç å—ï¼Œè¿™æ‰æ˜¯æœ€å‘çš„ã€‚</p>
<p>ä¸Šé¢ä»£ç æ¼äº†ä¸€å¥å…³é”®çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">guard</span> <span class="type">ALAssetsLibrary</span>.authorizationStatus() == .authorized <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šé¢ä»£ç ä¹‹åˆ¤æ–­äº†æ˜¯å¦æœ‰æƒé™ï¼Œä½†æ˜¯åœ¨iOS11ä¸Šå¹¶ä¸ä¼šå¼¹å‡ºä»€ä¹ˆæˆæƒæç¤ºã€‚å°±ç®—åœ¨<code>Info.plist</code>ä¸­æ·»åŠ <code>NSPhotoLibraryUsageDescription</code>ä¾æ—§æ— æµäºäº‹ã€‚</p>
<p>ç›®å‰æ¥çœ‹ï¼ŒiOS11ä¸­<strong>åªæœ‰</strong>æ·»åŠ <code>NSPhotoLibraryAddUsageDescription</code>æ‰å¯ä»¥ã€‚</p>
<h3 id="navigationItem-titleView-ç‚¹å‡»åŒºåŸŸåç§»"><a href="#navigationItem-titleView-ç‚¹å‡»åŒºåŸŸåç§»" class="headerlink" title="navigationItem.titleView ç‚¹å‡»åŒºåŸŸåç§»"></a>navigationItem.titleView ç‚¹å‡»åŒºåŸŸåç§»</h3><p>æ‰€è®¾ç½®çš„Viewéœ€è¦å®ç°ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">@implementation <span class="type">DNImageFoldTitleView</span></span><br><span class="line">- (<span class="type">CGSize</span>)intrinsicContentSize &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">UILayoutFittingExpandedSize</span>;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>iOS</category>
      </categories>
  </entry>
  <entry>
    <title>Fastlaneè‡ªåŠ¨åŒ–ç¬”è®°</title>
    <url>/post/fastlane-note/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>ä¹‹å‰åœ¨æ­å»ºJenkinsçš„æ—¶å€™ï¼Œç”±äºçœ‹åˆ°Fastlaneçš„é…ç½®å¥½å¤æ‚ï¼Œé‚£ä¹ˆå¤šï¼Œè€Œå½“æ—¶çš„éœ€æ±‚å°±æ˜¯è‡ªåŠ¨æ‰“åŒ…ã€‚ã€‚æ‰€ä»¥æ²¡æœ‰ç”¨ï¼Œç°åœ¨æƒ³æ¥å¥½æ°”ï¼ä»Šå¤©ç¿»åˆ°InfoQçš„ä¸€ä¸ªæ–‡ç« ï¼Œåˆè¯¦ç»†çš„äº†è§£äº†Fastlaneä¹‹åï¼Œè§‰å¾—æ­¤å¤§æ³•ç”šå¥½ï¼Œè§£å†³å¾ˆå¤šç—›ç‚¹ï¼å†³å®šæé€šè¿™ä¸€åˆ‡ï¼<br>å›çœ‹ä¹‹å‰çš„<a href="../build-ipa-sh">build-ipa-sh.md</a>ç¡®å®æ¯”è¾ƒåƒµç¡¬ã€‚è‡ªåŠ¨åŒ–è¿˜æ˜¯å¾ˆæ£’çš„ã€‚</p>
<a id="more"></a>

<h1 id="åŸºæœ¬çŸ¥è¯†"><a href="#åŸºæœ¬çŸ¥è¯†" class="headerlink" title="åŸºæœ¬çŸ¥è¯†"></a>åŸºæœ¬çŸ¥è¯†</h1><p>  (<a href="http://icyleaf.com/" target="_blank" rel="noopener">@icyleaf</a>)åœ¨<a href="https://icyleaf.com/2016/07/intro-fastlane-automation-for-ios-and-android/" target="_blank" rel="noopener">Fastlane - iOS å’Œ Android çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·</a>ä¸­è¯´åˆ°ï¼š</p>
<blockquote>
<p>Fastlane æä¾›çš„æµç¨‹çš„ä¼—å¤šå·¥å…·éƒ½æ˜¯å¯ä»¥ç‹¬ç«‹å­˜åœ¨å’Œä½¿ç”¨ï¼ˆæä¾› cli å‘½ä»¤ï¼‰ï¼Œä¹Ÿå¯ä»¥ç»Ÿä¸€ç”± fastlane æ¥æ§åˆ¶ã€‚å®ƒåœ¨ä½¿ç”¨ä¸­æå‡ºäº†ä¸¤ä¸ªæ¦‚å¿µï¼š</p>
</blockquote>
<pre><code>- action: Fastlane çš„æ’ä»¶ï¼Œæˆªè‡³å½“å‰å†…ç½® 165 ä¸ªè‡³å¤šï¼Œä¸è¿‡æ¯ä¸ªåŠ¨ä½œçš„é¢—ç²’åº¦å¤§å°ä¸ä¸€ã€‚æŸ¥çœ‹è¯¦æƒ…
- lane: Fastlane çš„ä»»åŠ¡ï¼ˆæˆ–è€…å¯ä»¥ç†è§£ä¸ºå‘½ä»¤ï¼‰ï¼Œä¸€ä¸ªå¯ä»¥åŒ…å«å¤šä¸ª lanesï¼Œé€šè¿‡ fastlane cli ä¼ å…¥åˆ¶å®šçš„ lane æ¥æ‰§è¡Œã€‚</code></pre>
<p>  è‡ªæˆ‘æ„Ÿè§‰è¿™å¥è¯è¿™ä¸ªå¯¹ç†è§£å’Œä½¿ç”¨å¾ˆé‡è¦ï¼</p>
<h1 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h1><p>  Fastlaneå·²è¢«Fabricæ”¶è´­ï¼Œæ‰€ä»¥æŒ‰ç…§å…¶å®‰è£…ä¹Ÿå¾ˆéšæ„(<a href="https://fabric.io/features/distribution" target="_blank" rel="noopener">æˆ³æˆ‘é…ç½®</a>)ã€‚<br>  å¯¹äºæ‰“åŒ…ï¼Œ</p>
<h1 id="æ–‡ç« "><a href="#æ–‡ç« " class="headerlink" title="æ–‡ç« "></a>æ–‡ç« </h1><ul>
<li><a href="http://icyleaf.com/2016/07/fastlane-in-action/" target="_blank" rel="noopener">æ·±å…¥æµ…å‡º Fastlane ä¸€çœ‹ä½ å°±æ‡‚</a></li>
<li><a href="http://blog.fir.im/fir_im_weekly160505" target="_blank" rel="noopener">fir.im weekly - ã€Œ æŒç»­é›†æˆ ã€å®è·µæ•™ç¨‹åˆé›†</a></li>
<li><a href="https://everettjf.github.io/2015/09/08/ios-ci-with-fastlane" target="_blank" rel="noopener">ä½¿ç”¨fastlaneå®ç°iOSæŒç»­é›†æˆ</a></li>
<li><a href="https://docs.fastlane.tools/" target="_blank" rel="noopener">fastlane docs</a></li>
<li><a href="https://github.com/fastlane/fastlane" target="_blank" rel="noopener">fastlane GitHub</a></li>
<li><a href="http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part01" target="_blank" rel="noopener">Fastlaneå®æˆ˜ï¼ˆä¸€ï¼‰ï¼šç§»åŠ¨å¼€å‘è‡ªåŠ¨åŒ–ä¹‹é“</a></li>
<li><a href="http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part02" target="_blank" rel="noopener">Fastlaneå®æˆ˜ï¼ˆäºŒï¼‰ï¼šActionå’ŒPluginæœºåˆ¶</a></li>
<li><a href="http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part03" target="_blank" rel="noopener">Fastlaneå®æˆ˜ï¼ˆä¸‰ï¼‰ï¼šFastlaneåœ¨Androidå¹³å°çš„åº”ç”¨</a></li>
<li><a href="http://www.infoq.com/cn/articles/fastlane-automatic-testing" target="_blank" rel="noopener">Fastlaneå®æˆ˜ï¼ˆå››ï¼‰ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•ç¯‡</a></li>
<li><a href="http://www.infoq.com/cn/articles/fastlane-pro-tips" target="_blank" rel="noopener">Fastlaneå®æˆ˜ï¼ˆäº”ï¼‰ï¼šé«˜çº§ç”¨æ³•</a></li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ„å»º</tag>
        <tag>Fastlane</tag>
      </tags>
  </entry>
  <entry>
    <title>å‡†å¤‡é£Ÿç”¨RAC(ReactiveCocoa)çš„é¡¾è™‘</title>
    <url>/post/reactivecocoa-ready-to-use/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>å¯¹äºç›®å‰çš„é¡¹ç›®ï¼Œå¦‚æœå¼•ç”¨RACï¼Œä¼šå¯¹é¡¹ç›®é€ æˆå“ªäº›å½±å“çš„ç›¸å…³æ€è€ƒã€‚</p>
<a id="more"></a>

<h1 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒRACå¾ˆç«ï¼Œæœ‰å¾ˆå¤šå´‡æ‹œè€…ã€‚æœ¬æ–‡åªæ˜¯ä¸€ä¸ªæ–°æ‰‹ç¬¬ä¸€æ¬¡ä½¿ç”¨RACæ—¶å€™æ‰€é¡¾å¿Œçš„ä¸€äº›é—®é¢˜ï¼Œå¦‚æœæœ‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆåŠæ—¶å‘ŠçŸ¥æˆ‘ï¼Œæˆ‘ä¼šåŠæ—¶æ›´æ”¹ã€‚</p>
<h1 id="OCç®€å•é£Ÿç”¨æ–¹æ³•"><a href="#OCç®€å•é£Ÿç”¨æ–¹æ³•" class="headerlink" title="OCç®€å•é£Ÿç”¨æ–¹æ³•"></a>OCç®€å•é£Ÿç”¨æ–¹æ³•</h1><p>å…ˆæ¥ä¸ªä¾‹å­ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">RACSignal *RSignal = [[<span class="keyword">self</span>.R rac_newValueChannelWithNilValue:@<span class="number">0</span>] startWith:@(<span class="keyword">self</span>.R.value)];</span><br><span class="line">RACSignal *GSignal = [[<span class="keyword">self</span>.G rac_newValueChannelWithNilValue:@<span class="number">0</span>] startWith:@(<span class="keyword">self</span>.G.value)];</span><br><span class="line">RACSignal *BSignal = [[<span class="keyword">self</span>.B rac_newValueChannelWithNilValue:@<span class="number">0</span>] startWith:@(<span class="keyword">self</span>.B.value)];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span>*(^valueFormat)(<span class="built_in">NSNumber</span> *value) = ^(<span class="built_in">NSNumber</span> *value) &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%.0f"</span>, [value doubleValue]*<span class="number">255</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[RSignal subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">    <span class="keyword">self</span>.RVaule.text = valueFormat(x);</span><br><span class="line">&#125;];</span><br><span class="line">[GSignal subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">    <span class="keyword">self</span>.GValue.text = valueFormat(x);</span><br><span class="line">&#125;];</span><br><span class="line">[BSignal subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">    <span class="keyword">self</span>.BValue.text = valueFormat(x);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸æ˜¯è¶…çº§ç®€å•ï¼</p>
<h2 id="é¡¾è™‘"><a href="#é¡¾è™‘" class="headerlink" title="é¡¾è™‘"></a>é¡¾è™‘</h2><p>å¯æ˜¯æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>OCå±äºè¿è¡Œæ—¶è¯­æ³•ï¼Œè¿™ä¸ªé‡Œé¢çš„<code>id x</code>çš„ä¸ç¡®å®šå› ç´ å¯èƒ½ä¼šå¯¼è‡´ç±»å‹è¯†åˆ«å‡ºç°é”™è¯¯ã€‚å¦‚æœè¯´é¡¹ç›®æ˜¯å¤šäººç»´æŠ¤ï¼Œé‚£ä¹ˆAå¯èƒ½ä¸çŸ¥é“Bå†™çš„Signalèµ°çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜å°±ä¸é€‚ç”¨äºæ¾æ•£çš„å¤šäººå¼€å‘ã€‚å¦‚æœéœ€è¦ä½¿ç”¨RACææ€•éœ€è¦åœ¨é¡¹ç›®å¯åŠ¨æ—¶è¿›è¡Œè§„é¿è¿™äº›ä¸ç¡®å®šçš„é—®é¢˜æ‰èƒ½å¼•å…¥ã€‚</li>
</ul>
<h1 id="Swiftç®€å•é£Ÿç”¨æ–¹æ³•"><a href="#Swiftç®€å•é£Ÿç”¨æ–¹æ³•" class="headerlink" title="Swiftç®€å•é£Ÿç”¨æ–¹æ³•"></a>Swiftç®€å•é£Ÿç”¨æ–¹æ³•</h1><p>åœ¨<a href="https://github.com/ReactiveCocoa/ReactiveCocoa" target="_blank" rel="noopener">ReactiveCocoa</a>çš„<a href="https://github.com/ReactiveCocoa/ReactiveCocoa#objective-c-and-swift" target="_blank" rel="noopener">README.md</a>ä¸­æœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼š</p>
<blockquote>
<h2 id="Objective-C-and-Swift"><a href="#Objective-C-and-Swift" class="headerlink" title="Objective-C and Swift"></a>Objective-C and Swift</h2></blockquote>
<p>  Although ReactiveCocoa was started as an Objective-C framework, as of [version<br>  3.0][CHANGELOG], all major feature development is concentrated on the [Swift API][].</p>
<blockquote>
</blockquote>
<p>  RACâ€™s [Objective-C API][] and Swift API are entirely separate, but there is<br>  a [bridge][Objective-C Bridging] to convert between the two. This<br>  is mostly meant as a compatibility layer for older ReactiveCocoa projects, or to<br>  use Cocoa extensions which havenâ€™t been added to the Swift API yet.</p>
<blockquote>
</blockquote>
<p>  The Objective-C API will continue to exist and be supported for the foreseeable<br>  future, but it wonâ€™t receive many improvements. For more information about using<br>  this API, please consult our [legacy documentation][].</p>
<blockquote>
</blockquote>
<p>  <strong>We highly recommend that all new projects use the Swift API.</strong></p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ReactiveCocoa</tag>
      </tags>
  </entry>
  <entry>
    <title>é¡¹ç›®ä¸­çš„UITableView</title>
    <url>/post/about-project-tableview/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>å‰ä¸¤å¤©å¬åˆ°æœ‰äººè¯´å¤šäººåˆä½œçš„é¡¹ç›®å¹¶ä¸éœ€è¦å¤„ç†å¾ˆå¤šäº‹æƒ…ï¼Œåªéœ€è¦å¤„ç†å¥½è‡ªå·±çš„é‚£éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘å°±å¥½äº†ã€‚æ„Ÿè§‰è¿™æ˜¯ä¸€ä¸ªå¾ˆä¸è´Ÿè´£ä»»çš„è¯´æ³•ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªAPPçš„å¼€å‘è€…ï¼Œè‡ªå·±è´Ÿè´£çš„äº‹å…¶ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œä½†æ˜¯éƒ½æ˜¯è¿™ä¸ªAPPçš„å¼€å‘è€…ï¼Œä¹Ÿè¦å¾€é‡Œé¢å¡ä»£ç ï¼Œå¦‚æœæ¯ä¸ªäººéƒ½ç”¨ä¸åŒçš„é€»è¾‘é£æ ¼å»ç»„ç»‡ä»£ç ã€‚é‚£ä¹ˆæ•´ä¸ªé¡¹ç›®å°±æ˜¯ä¸€å¨å¨å¨ï¼Œè¿™ä¸ªå¨ä¼šå½±å“é¡¹ç›®çš„æ¼”è¿›ã€æ—¥åçš„å‘å±•ã€‚</p>
<p>å½“ç„¶æœ‰çš„æ˜¯çœ‹ä¸å‡ºæ¥çš„ï¼Œæ¯”å¦‚è¯´ï¼šå½“ä¸€ä¸ªè¯·å‡çš„äººå†™çš„ä»£ç å‡ºç°ä¸€ä¸ªBUGï¼Œéœ€è¦ä¿®å¤ä¸Šçº¿çš„æ—¶å€™ï¼Œå¯¹äºä¸åŒçš„ä»£ç é£æ ¼ï¼Œéœ€è¦æ‰¾åˆ°é—®é¢˜çš„å…³é”®ä»£ç ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ’•å¿ƒè£‚è‚ºçš„ï¼Œä½†æ˜¯å¦‚æœåŒä¸€å¥—ä»£ç é£æ ¼ï¼Œå¿ƒä¸­å°±ä¼šæœ‰ä¸€ä¸ªå¤§è‡´çš„ä½ç½®ï¼Œå»ä¿®æ”¹æ—¶å€™å°±ä¼šæ¯”è¾ƒå¿«é€Ÿçš„å®šä½é—®é¢˜ã€‚</p>
<a id="more"></a>

<h1 id="ä»åè®®å…¥æ‰‹"><a href="#ä»åè®®å…¥æ‰‹" class="headerlink" title="ä»åè®®å…¥æ‰‹"></a>ä»åè®®å…¥æ‰‹</h1><p><code>UITableView</code>æ˜¯é¡¹ç›®ä¸­éå¸¸å¸¸è§çš„iOSé«˜çº§æ§ä»¶ï¼Œåœ¨é¡µé¢ä¸­æ‰€æœ‰ç›¸ä¼¼çš„é¡µé¢å‡ ä¹éƒ½æ˜¯ç”±è¯¥æ§ä»¶è¿›è¡Œå®Œæˆã€‚å…¶å¹¿æ³›è¿ç”¨çš„ä¸æ­¢æ˜¯ä½¿ç”¨æ–¹ä¾¿ï¼Œæœ€ä¸»è¦çš„æ˜¯å†…éƒ¨çš„å¤ç”¨ä¼˜åŒ–ä¹Ÿæ˜¯ç›¸å½“ç»™åŠ›çš„ã€‚</p>
<h2 id="åè®®æ¨¡å¼ä¸‹çš„UITableView"><a href="#åè®®æ¨¡å¼ä¸‹çš„UITableView" class="headerlink" title="åè®®æ¨¡å¼ä¸‹çš„UITableView"></a>åè®®æ¨¡å¼ä¸‹çš„UITableView</h2><p><code>UITableView</code>æ˜¯å…¸å‹çš„ <strong>åè®®-ä»£ç†æ¨¡å¼</strong> ï¼Œæ¯”ä¾‹<code>id &lt;UITableViewDataSource&gt; dataSource</code>å’Œ<code>id &lt;UITableViewDelegate&gt; delegate</code>ï¼Œæ‰€ä»¥ä½¿ç”¨å¯¹äºè¿™ç§æ¯”è¾ƒè§„æ•´çš„åˆ—è¡¨æ¥è¯´æŠŠåè®®ç»§ç»­æ‰©å±•åˆ°ä¸‹ä¸€çº§ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p>ä¸ºäº†ç»Ÿä¸€<code>UITableView.dataSource</code>å’Œ<code>UITableView.delegate</code>ï¼Œæ„å»ºå¦‚ä¸‹åè®®ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  ç›´æ¥å¡«å……Cellçš„cellModel</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">CellModelProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)cellClassName;  <span class="comment">//  cellModelç»‘å®šçš„ç±»å</span></span><br><span class="line">- (<span class="keyword">void</span>)cellModelForCell:(<span class="built_in">UITableViewCell</span> *)cell; <span class="comment">//  cellModelå¡«å……ä¸Šé¢ç»‘å®šçš„cell</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>


<p>é‚£ä¹ˆåªéœ€è¦åœ¨ä»£ç†ä¸­åšå¦‚ä¸‹è®¾ç½®:</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark <span class="meta-string">&lt;UITableViewDelegate, UITableViewDataSource&gt;</span></span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span>*)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span>*)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.viewModel.dataSource.count;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UITableViewCell</span>*)tableView:(<span class="built_in">UITableView</span>*)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span>*)indexPath</span><br><span class="line">&#123;</span><br><span class="line">      <span class="keyword">id</span>&lt;CellModelProtocol&gt; cellModel = <span class="keyword">self</span>.viewModel.dataSource[indexPath.row];</span><br><span class="line">      <span class="built_in">UITableViewCell</span>* cell = [tableView dequeueReusableCellWithIdentifier:[cellModel cellClassName]];</span><br><span class="line">      cell.frame = tableView.bounds;</span><br><span class="line">      [cellModel cellModelForCell:cell];</span><br><span class="line">      [cell sizeToFit];</span><br><span class="line">      <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span>*)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span>*)indexPath</span><br><span class="line">&#123;</span><br><span class="line">      <span class="keyword">id</span>&lt;CellModelProtocol&gt; cellModel = <span class="keyword">self</span>.viewModel.dataSource[indexPath.row];</span><br><span class="line">      <span class="built_in">UITableViewCell</span>* cell = [tableView ktj_cacheHeightCellForReuseIDFA:[cellModel cellClassName]];</span><br><span class="line">      [cellModel cellModelForCell:cell];</span><br><span class="line">      <span class="keyword">return</span> [cell sizeThatFits:tableView.bounds.size].height;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œåœ¨cellä¸­ï¼Œé»˜è®¤åœ¨<code>sizeThatFits:</code>ä¸­è¿›è¡Œå¸ƒå±€çš„è®¾ç½®å’Œç®—é«˜å³å¯ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  xxxCell.m</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGSize</span>)sizeThatFits:(<span class="built_in">CGSize</span>)size &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="built_in">CGRectZero</span>;</span><br><span class="line">    <span class="comment">//  æ ¹æ®Cellçš„å®é™…å†…å®¹è¿›è¡Œå¸ƒå±€å¹¶è®¾ç½®é«˜åº¦</span></span><br><span class="line">    frame.origin = <span class="built_in">CGPointMake</span>(<span class="number">10</span>, <span class="number">15</span>);</span><br><span class="line">    frame.size = [<span class="keyword">self</span>.infoLabel sizeThatFits:<span class="built_in">CGSizeMake</span>(size.width-frame.origin.x*<span class="number">2</span>, size.height)];</span><br><span class="line">    <span class="keyword">self</span>.infoLabel.frame = frame;</span><br><span class="line">    </span><br><span class="line">    size.height = <span class="built_in">CGRectGetMaxY</span>(<span class="keyword">self</span>.infoLabel.frame)+frame.origin.y;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœcellé‡‡ç”¨autolayoutï¼Œåˆ™è®¡ç®—é‡‡ç”¨<a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell/blob/e3ee86ce419d18d3ff735056f1474f2863e43003/Classes/UITableView%2BFDTemplateLayoutCell.m" target="_blank" rel="noopener">UITableView-FDTemplateLayoutCell</a>çš„è®¡ç®—æ–¹æ³•ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UITableViewCell</span> (<span class="title">KTJCellAutoLayoutForSize</span>)</span></span><br><span class="line"><span class="comment">//  autoloutå¸ƒå±€è®¡ç®—é«˜åº¦</span></span><br><span class="line">- (<span class="built_in">CGSize</span>)ktj_ALCellSizeThatFits:(<span class="built_in">CGSize</span>)size &#123;</span><br><span class="line">    <span class="comment">// Add a hard width constraint to make dynamic content views (like labels) expand vertically instead</span></span><br><span class="line">    <span class="comment">// of growing horizontally, in a flow-layout manner.</span></span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *tempWidthConstraint =</span><br><span class="line">    [<span class="built_in">NSLayoutConstraint</span> constraintWithItem:<span class="keyword">self</span>.contentView</span><br><span class="line">                                 attribute:<span class="built_in">NSLayoutAttributeWidth</span></span><br><span class="line">                                 relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                    toItem:<span class="literal">nil</span></span><br><span class="line">                                 attribute:<span class="built_in">NSLayoutAttributeNotAnAttribute</span></span><br><span class="line">                                multiplier:<span class="number">1.0</span></span><br><span class="line">                                  constant:size.width];</span><br><span class="line">    [<span class="keyword">self</span>.contentView addConstraint:tempWidthConstraint];</span><br><span class="line">    <span class="comment">// Auto layout engine does its math</span></span><br><span class="line">    size = [<span class="keyword">self</span>.contentView systemLayoutSizeFittingSize:<span class="built_in">UILayoutFittingCompressedSize</span>];</span><br><span class="line">    size.height += <span class="number">1</span>;</span><br><span class="line">    [<span class="keyword">self</span>.contentView removeConstraint:tempWidthConstraint];</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>å¦å¤–åœ¨<code>&lt;UITableViewDelegate, UITableViewDataSource&gt;</code>ä¸­åªå†™äº†1ç»„ï¼Œåªæœ‰cellï¼Œæ²¡æœ‰headerã€footerçš„æƒ…å†µï¼Œå¦‚æœéœ€è¦ï¼Œç‚®åˆ¶å³å¯ã€‚</p>
<p>è¯´ä¸€ä¸‹è¿™ä¸ªå…¶ä¸­çš„<code>ktj_cacheHeightCellForReuseIDFA:</code>ç±»åˆ«æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†ç®—é«˜è¿›è¡Œç¼“å­˜çš„ä¸€ä¸ªcellï¼Œè¿™ä¸ªcellä¿å­˜åœ¨ <code>NSCache</code>ä¸­ã€‚æ‰€ä»¥ä¸ºäº†ç»Ÿä¸€ï¼Œéœ€è¦åœ¨æ•°æ®åˆå§‹åŒ–æ—¶å€™æ³¨å†Œæ‰€æœ‰çš„cellã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ ¹æ®ç±»åç›´æ¥ç”Ÿæˆï¼Œè¿™ä¸ªè‡ªä¸»å†³å®šã€‚</p>
<p>è¯´åˆ°ç®—é«˜ï¼Œéœ€è¦è¯´ä¸€ä¸‹è¿™å…¶ä¸­çš„<code>dequeueReusableCellWithIdentifier:</code>æ–¹æ³•ã€‚è¯¥æ–¹æ³•æ˜¯ä»tableViewçš„ç¼“å­˜æ± ä¸­å–å‡ºæŒ‡å®šIDçš„cellã€‚è¯·æ³¨æ„æ˜¯ <strong>å–å‡º</strong> ï¼Œå¹¶ä¸”<code>UITableView</code>å¹¶æ²¡æœ‰æš´éœ²å‡ºå¦‚ä½•æ”¾è¿›ç¼“å­˜æ± ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦æš´éœ²å‡ºæ”¾è¿›ç¼“å­˜æ± çš„æ–¹æ³•ã€‚</p>
<p>è€Œä¸”<code>UITableView</code>åªæœ‰ä¸€ä¸ªåœ°æ–¹èƒ½å¤Ÿæ¥æ”¶Cellé‚£å°±æ˜¯<code>tableView:cellForRowAtIndexPath:</code>ã€‚æ‰€ä»¥è¯·ä¿è¯<code>dequeueReusableCellWithIdentifier:</code>å–å‡ºçš„æ–¹æ³• <strong>éœ€è¦é€šè¿‡<code>tableView:cellForRowAtIndexPath:</code>è¿”å›ç»™<code>UITableView</code></strong> ã€‚è¿™å°±æ˜¯æˆ‘ä¸Šé¢è¯´çš„<code>ktj_cacheHeightCellForReuseIDFA:</code>æ–¹æ³•ä¸ºä½•è¦åšä¸€ä¸ª cacheå»ç¼“å­˜æˆ‘å–å‡ºçš„cellï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘cellçš„æµªè´¹ã€‚</p>
<p>åŒç†ï¼Œå¯¹äº<code>UITableView</code>çš„<code>headerView</code>ã€<code>footerView</code>æ¥è¯´ï¼Œå¯ä»¥ç‚®åˆ¶ä»¥ä¸Šåè®®ã€æ–¹æ³•ã€‚ä¸å†èµ˜è¿°</p>
<p>PS.</p>
<ol>
<li><a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell" target="_blank" rel="noopener">UITableView-FDTemplateLayoutCell</a>: <a href="https://github.com/sunnyxx" target="_blank" rel="noopener">sunnyxx</a>æ‰“é€ çš„ä¼˜åŒ–UITableViewçš„ä¸€ä¸ªåº“ï¼Œ6000çš„starï¼Œå¾ˆèµã€‚</li>
</ol>
<h1 id="è§„èŒƒåŒ–çš„ä»£ç é£æ ¼"><a href="#è§„èŒƒåŒ–çš„ä»£ç é£æ ¼" class="headerlink" title="è§„èŒƒåŒ–çš„ä»£ç é£æ ¼"></a>è§„èŒƒåŒ–çš„ä»£ç é£æ ¼</h1><p>å¯¹äºå¤šäººå¼€å‘ï¼Œæœ€å´©æºƒçš„äº‹æƒ…å°±è¦æ•°å»è¯»åˆ«äººçš„ä»£ç ã€‚å°±ç®—ä¸æ˜¯å¤šäººå¼€å‘ï¼Œæ¥æ‰‹åˆ«äººçš„ä»£ç ä¹Ÿæ˜¯è®©äººæœ€å´©æºƒçš„äº‹æƒ…ã€‚å¦‚æœæœ‰ä¸ç”¨è€ƒè™‘è¿™ä»¶äº‹çš„å«æˆ‘ï¼</p>
<p>ä¸åŒçš„å…¬å¸å¯ä»¥æœ‰ä¸åŒçš„ä»£ç é£æ ¼ï¼Œä½†æ˜¯ä¸€ä¸ªå…¬å¸çš„ä»£ç é£æ ¼éœ€è¦ä¿æŒä¸€è‡´ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°ä¸€äººè¯·å‡ï¼Œæ— äººèƒ½æ¥å—é¡¹ç›®çš„å°´å°¬å±€é¢ï¼Œå°±ç®—èƒ½æ¥ï¼Œä¹Ÿæ˜¯éœ€è¦ä¸ºäº†åŠ ä¸€ä¸ªé€»è¾‘åˆ¤æ–­ï¼Œéœ€è¦èŠ±è´¹å¾ˆå¤§çš„ç²¾åŠ›å»å¤„ç†ã€‚</p>
<p>è‡³äºå…¶ä¸­çš„ä»£ç ä¸ç»Ÿä¸€çš„å‘ï¼Œææ€•è¦ç­‰è¸©è¿‡æ‰çŸ¥é“å§ğŸ˜‚ã€‚</p>
<h1 id="ä¸šåŠ¡é€»è¾‘çš„æ‹†åˆ†"><a href="#ä¸šåŠ¡é€»è¾‘çš„æ‹†åˆ†" class="headerlink" title="ä¸šåŠ¡é€»è¾‘çš„æ‹†åˆ†"></a>ä¸šåŠ¡é€»è¾‘çš„æ‹†åˆ†</h1><p>å¯¹äºå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¯¹å…¶æ‹†åˆ†æ˜¯éå¸¸é‡è¦çš„ï¼Œä¸æ‹†åˆ†å¾ˆå¯èƒ½å†™å‡ºæ¥çš„ä»£ç ä¸€ä¸ªæ–‡ä»¶ &gt;1000 è¡Œã€‚å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å¯¹äºå†™å‡ºæ¥éœ€è¦ä¸€æ°”å‘µæˆï¼Œä¿®æ”¹èµ·æ¥ä¹Ÿå°±å‡ºç°äº†ç‰µä¸€å‘åŠ¨å…¨èº«(è™½ç„¶æ‹†åˆ†å®Œæˆä¹‹åå¯èƒ½ä¹Ÿä¼šå…³é”®é€»è¾‘ä»£ç ä¸å¯æ‹†åˆ†ï¼Œä½†æ˜¯ä¼šå¥½å¾ˆå¤š)ã€‚</p>
<h2 id="ç­›é€‰é‡æ„"><a href="#ç­›é€‰é‡æ„" class="headerlink" title="ç­›é€‰é‡æ„"></a>ç­›é€‰é‡æ„</h2><p>ç­›é€‰ä¸»è¦å¤„ç†çš„æ˜¯ç­›é€‰é¡¹ï¼Œé’ˆå¯¹ä¼—å¤šç­›é€‰æ¡ä»¶æ‹†åˆ†ä¸ºä¸åŒçš„ä¸šåŠ¡é€»è¾‘æ¨¡å—æ˜¯å¿…é¡»çš„ã€‚éµç…§æ‹†åˆ†çš„åŸåˆ™ï¼Œäºæ˜¯ä¹æ ¹æ®UIåˆ’åˆ†å‡ºæ¥ä½ç½®ã€ä»·æ ¼ã€æˆ·å‹ã€ç­›é€‰ã€æ’åºè¿™ä¹ˆå‡ ä¸ªæ¨¡å—ã€‚é’ˆå¯¹æ¯ä¸ªæ¨¡å—è‡ªè¡Œå¤„ç†é€‰ä¸­æ•°æ®ã€UIå±•ç¤ºã€‚å¯¹å¤–åªæš´éœ²é€‰ä¸­é¡¹è¾“å…¥å’Œé€‰ä¸­å›è°ƒã€‚</p>
<p>å¯¹äºæ¯ä¸ªæ•°æ®å¤§è‡´éƒ½å¯åˆ†ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œç„¶åå¯é€‰ä¸­1é¡¹æˆ–å¤šé¡¹ã€‚äºæ˜¯ä¹ï¼Œè¿™ä¸ªä»£ç å¦‚æœä¸æ‹‰å‡ºæ¥æ˜¯è¦å†™å¥½å¤šæ¬¡çš„ï¼Œæ‹‰å‡ºæ¥ï¼Œä½†æ˜¯é€‰ä¸­éœ€è¦æŠŠé€‰ä¸­çš„é€»è¾‘æ‰”å‡ºæ¥ï¼Œæ–¹ä¾¿è‡ªå®šä¹‰ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>UITableView</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Œè½¬ã€Unowned è¿˜æ˜¯ Weakï¼Ÿç”Ÿå‘½å‘¨æœŸå’Œæ€§èƒ½å¯¹æ¯”</title>
    <url>/post/swiftgg-unowned-or-weak-lifetime-and-performance/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>ä½œè€…ï¼šUmberto Raimondiï¼ŒåŸæ–‡é“¾æ¥ï¼ŒåŸæ–‡æ—¥æœŸï¼š2016-10-27<br>è¯‘è€…ï¼šshanksï¼›æ ¡å¯¹ï¼šCrystal Sunï¼›å®šç¨¿ï¼šCMB</p>
</blockquote>
<p>æ¯å½“å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆretain cyclesï¼‰æ—¶ï¼Œéœ€è¦è€ƒé‡å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæ¥é€‰æ‹©unownedæˆ–è€…weakæ ‡è¯†ç¬¦ï¼Œè¿™å·²ç»æˆä¸ºäº†ä¸€ä¸ªå…±è¯†ã€‚ä½†æ˜¯æœ‰æ—¶ä»ç„¶ä¼šå¿ƒå­˜ç–‘é—®ï¼Œåœ¨å…·ä½“çš„ä½¿ç”¨ä¸­åº”è¯¥é€‰æ‹©å“ªä¸€ä¸ªï¼Œæˆ–è€…é€€ä¸€æ­¥è®²ï¼Œä¿å®ˆçš„åªä½¿ç”¨ weak æ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©å‘¢ï¼Ÿ</p>
<p>æœ¬æ–‡é¦–å…ˆå¯¹å¾ªç¯å¼•ç”¨çš„åŸºç¡€çŸ¥è¯†åšä¸€ä¸ªç®€è¦ä»‹ç»ï¼Œç„¶åä¼šåˆ†æ Swift æºä»£ç çš„ä¸€äº›ç‰‡æ®µï¼Œè®²è§£ unowned å’Œ weak åœ¨ç”Ÿå‘½å‘¨æœŸå’Œæ€§èƒ½ä¸Šçš„å·®å¼‚ç‚¹ï¼Œå¸Œæœ›çœ‹å®Œæœ¬æ–‡ä»¥åï¼Œåœ¨çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œèƒ½ä½¿ç”¨æ­£ç¡®çš„å¼±å¼•ç”¨ç±»å‹ã€‚</p>
<a id="more"></a>

<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•:"></a>ç›®å½•:</h2><ul>
<li>åŸºç¡€çŸ¥è¯†</li>
<li>é—®é¢˜æ¥äº†: unowened è¿˜æ˜¯ weak?</li>
<li>æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢</li>
<li>æ•è·åˆ—è¡¨å¤„ç†è§£æ</li>
<li>ç»“è®º</li>
<li>è„šæ³¨</li>
</ul>
<blockquote>
<p>ä» GitHub æˆ–è€… zipped è·å–æœ¬æ–‡ç›¸å…³çš„ Playground ä»£ç ã€‚ç„¶åä»è¿™é‡Œè·å–é—­åŒ…æ¡ˆä¾‹å’Œ SILï¼ŒSILGen ä»¥åŠ LLVM IR çš„è¾“å‡ºã€‚</p>
</blockquote>
<h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒSwift åˆ©ç”¨å¤è€å¹¶ä¸”æœ‰æ•ˆçš„è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼ˆARC, Automatic Reference Countingï¼‰æ¥ç®¡ç†å†…å­˜ï¼Œå¸¦æ¥çš„åæœå’Œåœ¨ Objective-C ä¸­ä½¿ç”¨çš„æƒ…å†µç±»ä¼¼ï¼Œéœ€è¦æ‰‹åŠ¨ä½¿ç”¨å¼±å¼•ç”¨æ¥è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</p>
<p>å¦‚æœå¯¹ ARC ä¸äº†è§£ï¼Œåªéœ€è¦çŸ¥é“çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªå¼•ç”¨ç±»å‹å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°ä¸ä¹‹å…³è”ï¼Œè¿™ä¸ªå¼•ç”¨è®¡æ•°ç”¨æ¥è®°å½•è¿™ä¸ªå¯¹è±¡å®ä¾‹æ­£åœ¨è¢«å˜é‡æˆ–å¸¸é‡å¼•ç”¨çš„æ€»æ¬¡æ•°ã€‚å½“å¼•ç”¨è®¡æ•°å˜ä¸º 0 æ—¶ï¼Œå®ä¾‹å°†ä¼šè¢«ææ„ï¼Œå®ä¾‹å æœ‰çš„å†…å­˜å’Œèµ„æºéƒ½å°†å˜å¾—é‡æ–°å¯ç”¨ã€‚</p>
<p>å½“æœ‰ä¸¤ä¸ªå®ä¾‹é€šè¿‡æŸç§å½¢å¼äº’ç›¸å¼•ç”¨æ—¶ï¼Œå°±ä¼šå½¢æˆå¾ªç¯å¼•ç”¨ï¼ˆæ¯”å¦‚ï¼šä¸¤ä¸ªç±»å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå±æ€§æŒ‡å‘å¯¹æ–¹çš„ç±»å®ä¾‹ï¼›åŒå‘é“¾è¡¨ä¸­ä¸¤ä¸ªç›¸é‚»çš„èŠ‚ç‚¹å®ä¾‹ç­‰â€¦ï¼‰, ç”±äºä¸¤ä¸ªå®ä¾‹çš„å¼•ç”¨è®¡æ•°éƒ½ä¸€ç›´å¤§äº 0ï¼Œ å¾ªç¯å¼•ç”¨å°†ä¼šé˜»æ­¢è¿™äº›å®ä¾‹çš„ææ„ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå’Œå…¶ä»–ä¸€äº›æœ‰ç±»ä¼¼é—®é¢˜çš„è¯­è¨€ä¸€æ ·ï¼Œ åœ¨ Swift ä¸­ï¼Œå¼±å¼•ç”¨ çš„æ¦‚å¿µè¢«æäº†å‡ºæ¥ï¼Œå¼±å¼•ç”¨ä¸ä¼šè¢« ARC è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªå¼±å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¼•ç”¨ç±»å‹å®ä¾‹æ—¶ï¼Œå¼•ç”¨è®¡æ•°ä¸ä¼šå¢åŠ ã€‚</p>
<p>å¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å®ä¾‹çš„ææ„, åªéœ€è¦è®°ä½çš„æ˜¯ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå¼±å¼•ç”¨éƒ½ä¸ä¼šæ‹¥æœ‰å®ƒæŒ‡å‘çš„å¯¹è±¡ã€‚åœ¨æ­£å¼çš„åœºæ™¯ä¸­ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å¤„ç†è¿™ç±»å¼•ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æ„è¯†åˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>åœ¨ Swift ä¸­æœ‰ 2 ç§ å¼± å¼•ç”¨å½¢å¼ï¼Œunowned å’Œ weakã€‚</p>
<p>è™½ç„¶å®ƒä»¬çš„ä½œç”¨ç±»ä¼¼ï¼Œä½†ä¸å®ƒä»¬ç›¸å…³å®ä¾‹ç”Ÿå‘½å‘¨æœŸçš„å‡è®¾ä¼šç•¥æœ‰ä¸åŒï¼Œå¹¶ä¸”å…·æœ‰ä¸åŒçš„æ€§èƒ½ç‰¹å¾ã€‚</p>
<p>ä¸ºäº†ä¸¾ä¾‹è¯´æ˜å¾ªç¯å¼•ç”¨ï¼Œè¿™é‡Œä¸ä½¿ç”¨å¤§å®¶æœŸæœ›çœ‹åˆ°çš„ç±»ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ï¼Œè€Œä½¿ç”¨é—­åŒ…çš„ä¸Šä¸‹æ–‡æ¡ˆä¾‹ï¼Œè¿™åœ¨ Objective-C æ—¥å¸¸å¼€å‘ä¸­å¤„ç†å¾ªç¯å¼•ç”¨æ—¶ç»å¸¸ä¼šé‡åˆ°çš„æƒ…å†µã€‚å’Œç±»çš„å¾ªç¯å¼•ç”¨ç±»ä¼¼ï¼Œé€šè¿‡åˆ›å»ºä¸€ä¸ªå¼ºå¼•ç”¨æŒ‡å‘å¤–éƒ¨å®ä¾‹ï¼Œæˆ–æ•è·å®ƒï¼Œé˜»æ­¢å®ƒææ„ã€‚</p>
<p>åœ¨ Objective-C ï¼ŒæŒ‰ç…§æ ‡å‡†çš„åšæ³•ï¼Œå®šä¹‰ä¸€ä¸ªå¼±å¼•ç”¨æŒ‡å‘é—­åŒ…å¤–éƒ¨çš„å®ä¾‹ï¼Œç„¶ååœ¨é—­åŒ…å†…éƒ¨å®šä¹‰å¼ºå¼•ç”¨æŒ‡å‘è¿™ä¸ªå®ä¾‹ï¼Œåœ¨é—­åŒ…æ‰§è¡ŒæœŸé—´ä½¿ç”¨å®ƒã€‚å½“ç„¶ï¼Œæœ‰å¿…è¦åœ¨ä½¿ç”¨å‰æ£€æŸ¥å¼•ç”¨çš„æœ‰æ•ˆæ€§ã€‚</p>
<p>ä¸ºäº†æ›´æ–¹ä¾¿çš„å¤„ç†å¾ªç¯å¼•ç”¨ï¼ŒSwift å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œç”¨äºç®€åŒ–å’Œæ›´åŠ æ˜æ˜¾åœ°è¡¨è¾¾åœ¨é—­åŒ…å†…éƒ¨å¤–éƒ¨å˜é‡çš„æ•è·ï¼šæ•è·åˆ—è¡¨ï¼ˆcapture listï¼‰ã€‚ä½¿ç”¨æ•è·åˆ—è¡¨ï¼Œå¯ä»¥åœ¨å‡½æ•°çš„å¤´éƒ¨å®šä¹‰å’ŒæŒ‡å®šé‚£äº›éœ€è¦ç”¨åœ¨å†…éƒ¨çš„å¤–éƒ¨å˜é‡ï¼Œå¹¶ä¸”æŒ‡å®šå¼•ç”¨ç±»å‹(è¯‘è€…æ³¨ï¼šè¿™é‡Œæ˜¯æŒ‡ unowned å’Œ weakï¼‰ã€‚</p>
<p>æ¥ä¸‹æ¥ä¸¾ä¸€äº›ä¾‹å­ï¼Œåœ¨å„ç§æƒ…å†µä¸‹æ•è·å˜é‡çš„è¡¨ç°ã€‚</p>
<p>å½“ä¸ä½¿ç”¨æ•è·åˆ—è¡¨æ—¶ï¼Œé—­åŒ…å°†ä¼šåˆ›å»ºä¸€ä¸ªå¤–éƒ¨å˜é‡çš„å¼ºå¼•ç”¨ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> i1 = <span class="number">1</span>, i2 = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fStrong = &#123;</span><br><span class="line">    i1 += <span class="number">1</span></span><br><span class="line">    i2 += <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fStrong()</span><br><span class="line"><span class="built_in">print</span>(i1,i2) <span class="comment">//Prints 2 and 3</span></span><br></pre></td></tr></table></figure>

<p>é—­åŒ…å†…éƒ¨å¯¹å˜é‡çš„ä¿®æ”¹å°†ä¼šæ”¹å˜å¤–éƒ¨åŸå§‹å˜é‡çš„å€¼ï¼Œè¿™ä¸é¢„æœŸæ˜¯ä¸€è‡´çš„ã€‚</p>
<p>ä½¿ç”¨æ•è·åˆ—è¡¨ï¼Œé—­åŒ…å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯ç”¨å¸¸é‡ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå¸¸é‡ä¿®é¥°ç¬¦ï¼Œé—­åŒ…å°†ä¼šç®€å•åœ°æ‹·è´åŸå§‹å€¼åˆ°æ–°çš„å˜é‡ä¸­ï¼Œå¯¹äºå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fCopy = &#123; [i1] <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(i1,i2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fStrong()</span><br><span class="line"><span class="built_in">print</span>(i1,i2) <span class="comment">//æ‰“å°ç»“æœæ˜¯ 2 å’Œ 3  </span></span><br><span class="line"></span><br><span class="line">fCopy()  <span class="comment">//æ‰“å°ç»“æœæ˜¯ 1 å’Œ 3</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨è°ƒç”¨ fStrong ä¹‹å‰å®šä¹‰å‡½æ•° fCopy ,åœ¨è¯¥å‡½æ•°å®šä¹‰çš„æ—¶å€™ï¼Œç§æœ‰å¸¸é‡å·²ç»è¢«åˆ›å»ºäº†ã€‚æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå½“è°ƒç”¨ç¬¬äºŒä¸ªå‡½æ•°æ—¶å€™ï¼Œä»ç„¶æ‰“å° i1 çš„åŸå§‹å€¼ã€‚</p>
<p>å¯¹äºå¤–éƒ¨å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œåœ¨æ•è·åˆ—è¡¨ä¸­æŒ‡å®š weak æˆ– unownedï¼Œè¿™ä¸ªå¸¸é‡å°†ä¼šè¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªå¼±å¼•ç”¨ï¼ŒæŒ‡å‘åŸå§‹å€¼ï¼Œè¿™ç§æŒ‡å®šçš„æ•è·æ–¹å¼å°±æ˜¯ç”¨æ¥å¤„ç†å¾ªç¯å¼•ç”¨çš„æ–¹å¼ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aClass</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c1 = aClass()</span><br><span class="line"><span class="keyword">var</span> c2 = aClass()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fSpec = &#123; [<span class="keyword">unowned</span> c1, <span class="keyword">weak</span> c2] <span class="keyword">in</span></span><br><span class="line">    c1.value += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> c2 = c2 &#123;</span><br><span class="line">        c2.value += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fSpec()</span><br><span class="line"><span class="built_in">print</span>(c1.value,c2.value) <span class="comment">//Prints 2 and 2</span></span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ª aClass æ•è·å®ä¾‹çš„ä¸åŒçš„å®šä¹‰æ–¹å¼ï¼Œå†³å®šäº†å®ƒä»¬åœ¨é—­åŒ…ä¸­ä¸åŒçš„ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>unowned å¼•ç”¨ä½¿ç”¨çš„åœºæ™¯æ˜¯ï¼ŒåŸå§‹å®ä¾‹æ°¸è¿œä¸ä¼šä¸º nilï¼Œé—­åŒ…å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”ç›´æ¥å®šä¹‰ä¸ºæ˜¾å¼è§£åŒ…å¯é€‰å€¼ã€‚å½“åŸå§‹å®ä¾‹è¢«ææ„åï¼Œåœ¨é—­åŒ…ä¸­ä½¿ç”¨è¿™ä¸ªæ•è·å€¼å°†å¯¼è‡´å´©æºƒã€‚</p>
<p>å¦‚æœæ•è·åŸå§‹å®ä¾‹åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¸º nil ï¼Œå¿…é¡»å°†å¼•ç”¨å£°æ˜ä¸º weakï¼Œ å¹¶ä¸”åœ¨ä½¿ç”¨ä¹‹å‰éªŒè¯è¿™ä¸ªå¼•ç”¨çš„æœ‰æ•ˆæ€§ã€‚</p>
<h2 id="é—®é¢˜æ¥äº†-unowened-è¿˜æ˜¯-weak"><a href="#é—®é¢˜æ¥äº†-unowened-è¿˜æ˜¯-weak" class="headerlink" title="é—®é¢˜æ¥äº†: unowened è¿˜æ˜¯ weak?"></a>é—®é¢˜æ¥äº†: unowened è¿˜æ˜¯ weak?</h2><p>åœ¨å®é™…ä½¿ç”¨ä¸­å¦‚ä½•é€‰æ‹©è¿™ä¸¤ç§å¼±å¼•ç”¨ç±»å‹å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¯ä»¥ç®€å•ç”±åŸå§‹å¯¹è±¡å’Œå¼•ç”¨å®ƒçš„é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸæ¥è§£é‡Šã€‚</p>
<p><img src="/images/unownedbig.png" alt="unownedbig"></p>
<p>æœ‰ä¸¤ä¸ªå¯èƒ½å‡ºç°çš„åœºæ™¯ï¼š</p>
<ul>
<li><p>é—­åŒ…å’Œæ•è·å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œæ‰€ä»¥å¯¹è±¡å¯ä»¥è¢«è®¿é—®ï¼Œä¹Ÿå°±æ„å‘³ç€é—­åŒ…ä¹Ÿå¯ä»¥è¢«è®¿é—®ã€‚å¤–éƒ¨å¯¹è±¡å’Œé—­åŒ…æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ(æ¯”å¦‚ï¼šå¯¹è±¡å’Œå®ƒçš„çˆ¶å¯¹è±¡çš„ç®€å•è¿”å›å¼•ç”¨ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥æŠŠå¼•ç”¨å®šä¹‰ä¸º unownedã€‚</p>
<p>  ä¸€ä¸ªç»å…¸çš„æ¡ˆä¾‹æ˜¯: [unowned self], ä¸»è¦ç”¨åœ¨é—­åŒ…ä¸­ï¼Œè¿™ç§é—­åŒ…ä¸»è¦åœ¨ä»–ä»¬çš„çˆ¶èŠ‚ç‚¹ä¸Šä¸‹æ–‡ä¸­åšä¸€äº›äº‹æƒ…ï¼Œæ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹è¢«å¼•ç”¨æˆ–ä¼ é€’ï¼Œä¸èƒ½ä½œç”¨åœ¨çˆ¶èŠ‚ç‚¹ä¹‹å¤–ã€‚</p>
</li>
<li><p>é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸå’Œæ•è·å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸äº’ç‹¬ç«‹ï¼Œå½“å¯¹è±¡ä¸èƒ½å†ä½¿ç”¨æ—¶ï¼Œé—­åŒ…ä¾ç„¶èƒ½å¤Ÿè¢«å¼•ç”¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥æŠŠå¼•ç”¨å®šä¹‰ä¸º weakï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨å®ƒä¹‹å‰éªŒè¯ä¸€ä¸‹å®ƒæ˜¯å¦ä¸º nilï¼ˆè¯·ä¸è¦å¯¹å®ƒè¿›è¡Œå¼ºåˆ¶è§£åŒ…).</p>
<p>  ä¸€ä¸ªç»å…¸çš„æ¡ˆä¾‹æ˜¯: [weak delegate = self.delegate!]ï¼Œå¯ä»¥åœ¨æŸäº›ä½¿ç”¨é—­åŒ…çš„åœºæ™¯ä¸­çœ‹åˆ°ï¼Œé—­åŒ…ä½¿ç”¨çš„æ˜¯å®Œå…¨æ— å…³ï¼ˆç”Ÿå‘½å‘¨æœŸç‹¬ç«‹ï¼‰çš„ä»£ç†å¯¹è±¡ã€‚</p>
</li>
</ul>
<p>å½“æ— æ³•ç¡®è®¤ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´ç”Ÿå‘½å‘¨æœŸçš„å…³ç³»æ—¶ï¼Œæ˜¯å¦ä¸åº”è¯¥å»å†’é™©é€‰æ‹©ä¸€ä¸ªæ— æ•ˆ unowned å¼•ç”¨ï¼Ÿè€Œæ˜¯ä¿å®ˆé€‰æ‹© weak å¼•ç”¨æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Ÿ<br>ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºå¯¹è±¡ç”Ÿå‘½å‘¨æœŸäº†è§£æ˜¯ä¸€ä»¶å¿…è¦çš„äº‹æƒ…ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªä¿®é¥°ç¬¦åœ¨æ€§èƒ½ç‰¹æ€§ä¸Šä¹Ÿæœ‰å¾ˆå¤§çš„ä¸åŒã€‚</p>
<p>å¼±å¼•ç”¨æœ€å¸¸è§çš„å®ç°æ˜¯ï¼Œæ¯æ¬¡ä¸€ä¸ªæ–°çš„å¼•ç”¨ç”Ÿæˆæ—¶ï¼Œéƒ½ä¼šæŠŠæ¯ä¸ªå¼±å¼•ç”¨å’Œå®ƒæŒ‡å‘çš„å¯¹è±¡ä¿¡æ¯å­˜å‚¨åˆ°ä¸€ä¸ªé™„åŠ è¡¨ä¸­ã€‚</p>
<p>å½“æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡æ—¶ï¼ŒSwift è¿è¡Œæ—¶ä¼šå¯åŠ¨ææ„è¿‡ç¨‹ï¼Œä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œè¿è¡Œæ—¶ä¼šæŠŠæ‰€æœ‰ç›¸å…³çš„å¼±å¼•ç”¨ç½®ä¸º nil ã€‚å¼±å¼•ç”¨çš„è¿™ç§å®ç°æ–¹å¼æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€é›¶å’Œå¼±å¼•ç”¨â€ã€‚</p>
<p>è¿™ç§å®ç°æœ‰å®é™…çš„å¼€é”€ï¼Œè€ƒè™‘åˆ°éœ€è¦é¢å¤–å®ç°çš„æ•°æ®ç»“æ„ï¼Œéœ€è¦ç¡®ä¿åœ¨å¹¶å‘è®¿é—®æƒ…å†µä¸‹ï¼Œå¯¹è¿™ä¸ªå…¨å±€å¼•ç”¨ç»“æ„æ‰€æœ‰æ“ä½œçš„æ­£ç¡®æ€§ã€‚ä¸€æ—¦ææ„è¿‡ç¨‹å¼€å§‹äº†ï¼Œåœ¨ä»»ä½•ç¯å¢ƒä¸­ï¼Œéƒ½ä¸å…è®¸è®¿é—®å¼±å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡äº†ã€‚</p>
<p>å¼±å¼•ç”¨ï¼ˆåŒ…æ‹¬ unowned å’Œä¸€äº›å˜ä½“çš„ weak)åœ¨ Swift ä½¿ç”¨äº†æ›´ç®€å•å’Œå¿«é€Ÿçš„å®ç°æœºåˆ¶ã€‚</p>
<p>Swift ä¸­çš„æ¯ä¸ªå¯¹è±¡ä¿æŒäº†ä¸¤ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œä¸€ä¸ªæ˜¯å¼ºå¼•ç”¨è®¡æ•°å™¨ï¼Œç”¨æ¥å†³å®š ARC ä»€ä¹ˆæ—¶å€™å¯ä»¥å®‰å…¨åœ°ææ„è¿™ä¸ªå¯¹è±¡ï¼Œå¦å¤–ä¸€ä¸ªé™„åŠ çš„å¼±å¼•ç”¨è®¡æ•°å™¨ï¼Œç”¨æ¥è®¡ç®—åˆ›å»ºäº†å¤šå°‘ä¸ªæŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„ unowned æˆ–è€… weak å¼•ç”¨ï¼Œå½“è¿™ä¸ªè®¡æ•°å™¨ä¸ºé›¶æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å°†è¢« ææ„ ã€‚</p>
<p>éœ€è¦é‡ç‚¹ç†è§£çš„æ˜¯ï¼Œåªæœ‰ç­‰åˆ°æ‰€æœ‰ unowned å¼•ç”¨è¢«é‡Šæ”¾åï¼Œè¿™ä¸ªå¯¹è±¡æ‰ä¼šè¢«çœŸæ­£åœ°ææ„ï¼Œç„¶åå¯¹è±¡å°†ä¼šä¿æŒæœªè§£æå¯è®¿é—®çŠ¶æ€ï¼Œå½“ææ„å‘ç”Ÿåï¼Œå¯¹è±¡çš„å†…å®¹æ‰ä¼šè¢«å›æ”¶ã€‚</p>
<p>æ¯å½“ unowned å¼•ç”¨è¢«å®šä¹‰æ—¶ï¼Œå¯¹åº”çš„ unowned å¼•ç”¨è®¡æ•°ä¼šè¿›è¡ŒåŸå­çº§åˆ«åœ°å¢åŠ (ä½¿ç”¨åŸå­gcc/llvmæ“ä½œï¼Œè¿›è¡Œä¸€ç³»åˆ—å¿«é€Ÿä¸”çº¿ç¨‹å®‰å…¨çš„åŸºæœ¬æ“ä½œï¼Œä¾‹å¦‚ï¼šå¢åŠ ï¼Œå‡å°‘ï¼Œæ¯”è¾ƒï¼Œäº¤æ¢ç­‰)ï¼Œä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚åœ¨å¢åŠ è®¡æ•°ä¹‹å‰ï¼Œä¼šæ£€æŸ¥å¼ºå¼•ç”¨è®¡æ•°ä»¥ç¡®ä¿å¯¹è±¡æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>è¯•å›¾è®¿é—®ä¸€ä¸ªæ— æ•ˆçš„å¯¹è±¡ï¼Œå°†ä¼šå¯¼è‡´é”™è¯¯çš„æ–­è¨€ï¼Œä½ çš„åº”ç”¨åœ¨è¿è¡Œæ—¶ä¸­ä¼šæŠ¥é”™(è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œçš„ unownd å®ç°æ–¹å¼å«åš unowned(safe) å®ç°)<br>ä¸ºäº†æ›´å¥½çš„ä¼˜åŒ–ï¼Œåº”ç”¨ç¼–è¯‘æ—¶å¸¦æœ‰ -OFastï¼Œunowned å¼•ç”¨ä¸ä¼šå»éªŒè¯å¼•ç”¨å¯¹è±¡çš„æœ‰æ•ˆæ€§ï¼Œunowned å¼•ç”¨çš„è¡Œä¸ºå°±ä¼šåƒ Objective-C ä¸­çš„ __unsafe_unretained ä¸€æ ·ã€‚å¦‚æœå¼•ç”¨å¯¹è±¡æ— æ•ˆï¼Œunowned å¼•ç”¨å°†ä¼šæŒ‡å‘å·²ç»é‡Šæ”¾åƒåœ¾å†…å­˜ï¼ˆè¿™ç§å®ç°ç§°ä¹‹ unowned(unsafe)ï¼‰ã€‚</p>
<p>å½“ä¸€ä¸ª unowned å¼•ç”¨è¢«é‡Šæ”¾åï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰å…¶ä»–å¼ºå¼•ç”¨æˆ– unowned å¼•ç”¨æŒ‡å‘è¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿™ä¸ªå¯¹è±¡å°†è¢«ææ„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ªå¼•ç”¨å¯¹è±¡ä¸èƒ½åœ¨å¼ºå¼•ç”¨è®¡æ•°å™¨ç­‰äºé›¶çš„æƒ…å†µä¸‹ï¼Œè¢«ææ„çš„åŸå› ï¼Œæ‰€æœ‰çš„å¼•ç”¨è®¡æ•°å™¨å¿…é¡»èƒ½å¤Ÿè¢«è®¿é—®ç”¨æ¥éªŒè¯ unowned å¼•ç”¨å’Œå¼ºå¼•ç”¨æ•°é‡ã€‚</p>
<p>Swift çš„ weak å¼•ç”¨æ·»åŠ äº†é™„åŠ å±‚ï¼Œé—´æ¥åœ°æŠŠ unowned å¼•ç”¨åŒ…è£¹åˆ°äº†ä¸€ä¸ªå¯é€‰å®¹å™¨é‡Œé¢ï¼Œåœ¨æŒ‡å‘çš„å¯¹è±¡ææ„ä¹‹åå˜æˆç©ºçš„æƒ…å†µä¸‹ï¼Œè¿™æ ·å¤„ç†ä¼šæ›´åŠ çš„æ¸…æ™°ã€‚ä½†æ˜¯éœ€è¦ä»˜å‡ºçš„ä»£ä»·æ˜¯ï¼Œé™„åŠ çš„æœºåˆ¶éœ€è¦æ­£ç¡®åœ°å¤„ç†å¯é€‰å€¼ã€‚</p>
<p>è€ƒè™‘åˆ°ä»¥ä¸Šå› ç´ ï¼Œåœ¨å¯¹è±¡å…³ç³»ç”Ÿå‘½å‘¨æœŸå…è®¸çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆé€‰æ‹©ä½¿ç”¨ unowned å¼•ç”¨ã€‚ä½†æ˜¯è¿™ä¸æ˜¯æ­¤æ•…äº‹çš„ç»“å±€ï¼Œæ¥ä¸‹æ¥æ¯”è¾ƒä¸€ä¸‹ä¸¤è€…æ€§èƒ½1ä¸Šçš„å·®åˆ«ã€‚</p>
<h2 id="æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢"><a href="#æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢" class="headerlink" title="æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢"></a>æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢</h2><p>åœ¨æŸ¥çœ‹ Swift é¡¹ç›®æºç éªŒè¯ä¹‹å‰ï¼Œéœ€è¦ç†è§£ ARC å¦‚ä½•ç®¡ç†è¿™ä¸¤ç§å¼•ç”¨ç±»å‹ï¼Œå¹¶ä¸”è¿˜éœ€è¦è§£é‡Š swiftcï¼ŒLLVM å’Œ SIL çš„ç›¸å…³çŸ¥è¯†ã€‚</p>
<p>æ¥ä¸‹æ¥è¯•ç€ç®€è¦ä»‹ç»æœ¬æ–‡æ‰€éœ€è¦çš„å¿…å¤‡çŸ¥è¯†ç‚¹ï¼Œå¦‚æœæƒ³äº†è§£æ›´å¤šï¼Œå°†åœ¨æœ€åçš„è„šæ³¨ä¸­æ‰¾åˆ°ä¸€äº›æœ‰ç”¨çš„é“¾æ¥ã€‚</p>
<p>ä½¿ç”¨ä¸€ä¸ªå›¾æ¥è§£é‡Š swiftc æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹çš„åŒ…å«çš„æ¨¡å—ï¼š</p>
<p><img src="/images/swiftc.png" alt="swiftc"></p>
<p>Swiftc å’Œ clang ä¸€æ ·æ„å»ºåœ¨ LLVM ä¸Šï¼Œéµå¾ª clang ç¼–è¯‘å™¨ç›¸ä¼¼çš„ç¼–è¯‘æµç¨‹ã€‚</p>
<p>åœ¨ç¼–è¯‘è¿‡ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨ä¸€ä¸ªç‰¹å®šè¯­è¨€å‰ç«¯è¿›è¡Œç®¡ç†ï¼Œswift æºä»£ç è¢«è§£é‡Šç”Ÿæˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘(AST)è¡¨è¾¾2ï¼Œç„¶åæŠ½è±¡è¯­æ³•æ ‘çš„ç»“æœä»è¯­ä¹‰è§’åº¦è¿›è¡Œåˆ†æï¼Œæ‰¾å‡ºè¯­ä¹‰é”™è¯¯ã€‚</p>
<p>åœ¨è¿™ä¸ªç‚¹ä¸Šï¼Œå¯¹äºå…¶ä»–çš„åŸºäº LLVM çš„ç¼–è¯‘å™¨æ¥è®²ï¼Œåœ¨é€šè¿‡ä¸€ä¸ªé™„åŠ æ­¥éª¤å¯¹æºä»£ç è¿›è¡Œé™æ€åˆ†æåï¼ˆå¿…è¦æ—¶å¯ä»¥æ˜¾ç¤ºé”™è¯¯å’Œè­¦å‘Šï¼‰ï¼Œæ¥ç€ IRGen æ¨¡å— ä¼šæŠŠ AST çš„å†…å®¹ä¼šè½¬æ¢æˆä¸€ä¸ªè½»é‡çš„å’Œåº•å±‚çš„æœºå™¨æ— å…³çš„è¡¨ç¤ºï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º LLVM IR(LLVM ä¸­é—´è¡¨ç¤º)ã€‚</p>
<p>å°½ç®¡ä¸¤ä¸ªæ¨¡å—éƒ½éœ€è¦åšä¸€äº›ç›¸åŒæ£€æŸ¥ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ¨¡å—æ˜¯åŒºåˆ†å¼€çš„ï¼Œåœ¨ä¸¤ä¸ªæ¨¡å—ä¹‹é—´ä¹Ÿå­˜åœ¨è®¸å¤šé‡å¤çš„ä»£ç ã€‚</p>
<p>IR æ˜¯ä¸€ç§é™æ€å•èµ‹å€¼å½¢å¼ï¼ˆSSA-formï¼‰ä¸€è‡´è¯­è¨€ï¼Œå¯ä»¥çœ‹åšæ³¨å…¥äº† LLVM çš„è™šæ‹Ÿæœºä¸‹çš„ RISC ç±»å‹æ±‡ç¼–è¯­è¨€ã€‚åŸºäº SSA å°†ç®€åŒ–æ¥ä¸‹æ¥çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œä»è¯­è¨€å‰ç«¯æä¾›çš„ä¸­é—´è¡¨è¾¾ä¼šåœ¨ IR è¿›è¡Œå¤šé‡ä¼˜åŒ–ã€‚</p>
<p>éœ€è¦é‡ç‚¹æ³¨æ„çš„æ˜¯ï¼ŒIR å…¶ä¸­ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œå®ƒå…·æœ‰ä¸‰ç§ä¸åŒçš„å½¢å¼ï¼šå†…å­˜è¡¨è¾¾ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰ï¼Œåºåˆ—åŒ–ä½ä»£ç å½¢å¼ï¼ˆä½ å·²ç»çŸ¥é“çš„ä½ä»£ç å½¢å¼ï¼‰å’Œå¯è¯»å½¢å¼ã€‚</p>
<p>æœ€åä¸€ç§å½¢å¼éå¸¸æœ‰ç”¨ï¼Œç”¨æ¥éªŒè¯ IR ä»£ç çš„æœ€ç»ˆç»“æ„ï¼Œè¿™ä¸ªç»“æ„å°†ä¼šä¼ å…¥åˆ°æ•´ä¸ªè¿‡ç¨‹ä¸­çš„æœ€åä¸€æ­¥ï¼Œå°†ä¼šä»æœºå™¨ç‹¬ç«‹çš„ IR ä»£ç è½¬æ¢æˆå¹³å°ç›¸å…³çš„è¡¨è¾¾(æ¯”å¦‚ï¼šx86ï¼ŒARM ç­‰ç­‰)ã€‚æœ€åä¸€æ­¥å°†è¢« LLVM å¹³å°åç«¯æ‰§è¡Œã€‚</p>
<p>é‚£ä¹ˆ swiftc å’Œå…¶ä»–åŸºäº LLVM çš„ç¼–è¯‘å™¨æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ<br>swiftc å’Œå…¶ä»–ç¼–è¯‘å™¨ä»ç»“æ„å½¢å¼ä¸Šçš„å·®åˆ«ä¸»è¦ä½“ç°åœ¨ä¸€ä¸ªé™„åŠ ç»„ä»¶ï¼Œè¿™ä¸ªé™„åŠ ç»„ä»¶æ˜¯ SILGen ï¼Œåœ¨ IRGen ä¹‹å‰ï¼Œæ‰§è¡Œä»£ç çš„ç›‘æµ‹å’Œä¼˜åŒ–ï¼Œç”Ÿæˆä¸€ä¸ªé«˜çº§çš„ä¸­é—´è¡¨è¾¾ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º SIL ï¼ˆSwift Intermediate Languageï¼ŒSwift ä¸­é—´è¯­è¨€ï¼‰ï¼Œæœ€å SIL å°†ä¼šè½¬æ¢æˆ LLVM IRã€‚è¿™ä¸€æ­¥åŠ å¼ºäº†åœ¨å•ä¸ªè½¯ä»¶æ¨¡å—ä¸Šæ‰€æœ‰å…·ä½“è¯­è¨€çš„æ£€æŸ¥ï¼Œå¹¶ä¸”ç®€åŒ–äº† IRGenã€‚</p>
<p>ä» AST åˆ° IR çš„è½¬æ¢åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ã€‚SILGen æŠŠ AST æºä»£ç è½¬æ¢ä¸ºåŸå§‹ SIL ï¼Œç„¶åç¼–è¯‘å™¨è¿›è¡Œ Swift è¯­æ³•æ£€æŸ¥ï¼ˆéœ€è¦æ—¶æ‰“å°é”™è¯¯æˆ–è€…è­¦å‘Šä¿¡æ¯ï¼‰ï¼Œä¼˜åŒ–æœ‰æ•ˆçš„åŸå§‹ SIL ï¼Œé€šè¿‡ä¸€äº›æ­¥éª¤æœ€åç”Ÿæˆæ ‡å‡†åŒ– SIL ã€‚å¦‚ä¸Šé¢çš„ç¤ºæ„å›¾æ˜¾ç¤ºé‚£æ ·ï¼Œæ ‡å‡†åŒ– SIL çš„æœ€åè½¬åŒ–ä¸º LLVM IRã€‚</p>
<p>å†æ¬¡å¼ºè°ƒï¼ŒSIL æ˜¯ä¸€ä¸ª SSA ç±»å‹è¯­è¨€ï¼Œä½¿ç”¨é™„åŠ çš„ç»“æ„æ‰©å±•äº† Swift çš„è¯­æ³•ã€‚å®ƒä¾èµ– Swift çš„ç±»å‹ç³»ç»Ÿï¼Œå¹¶ä¸”èƒ½ç†è§£ Swift çš„å®šä¹‰ï¼Œä½†æ˜¯éœ€è¦é‡ç‚¹è®°ä½çš„æ˜¯ï¼Œå½“ç¼–è¯‘ä¸€ä¸ªæ‰‹å†™çš„ SIL æºç ï¼ˆæ˜¯çš„ï¼Œå¯ä»¥æ‰‹åŠ¨å†™ SIL ç„¶åç¼–è¯‘å®ƒï¼‰æ—¶ï¼Œé«˜é˜¶çš„ Swift ä»£ç æˆ–è€…å‡½æ•°å†…å®¹å°†è¢«ç¼–è¯‘å™¨å¿½ç•¥ã€‚</p>
<p>åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ï¼Œæˆ‘ä»¬å°†åˆ†æä¸€ä¸ªæ ‡å‡†åŒ– SIL çš„æ¡ˆä¾‹ï¼Œæ¥ç†è§£ unowned å’Œ weak å¼•ç”¨å¦‚ä½•è¢«ç¼–è¯‘å™¨å¤„ç†ã€‚ä¸€ä¸ªåŒ…å«æ•è·åˆ—è¡¨çš„åŸºæœ¬é—­åŒ…çš„ä¾‹å­ï¼ŒæŸ¥çœ‹è¿™ä¸ªä¾‹å­ç”Ÿæˆçš„ SIL ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°è¢«ç¼–è¯‘å™¨æ·»åŠ çš„æ‰€æœ‰ ARC ç›¸å…³çš„å‡½æ•°è°ƒç”¨ã€‚</p>
<blockquote>
<p>ä» GitHub æˆ–è€… zipped è·å–æœ¬æ–‡ç›¸å…³çš„ Playground ä»£ç ã€‚ç„¶åä»è¿™é‡Œè·å–é—­åŒ…æ¡ˆä¾‹å’Œ SIL ï¼ŒSILGen ä»¥åŠ LLVM IR çš„è¾“å‡ºã€‚</p>
</blockquote>
<h2 id="æ•è·åˆ—è¡¨å¤„ç†è§£æ"><a href="#æ•è·åˆ—è¡¨å¤„ç†è§£æ" class="headerlink" title="æ•è·åˆ—è¡¨å¤„ç†è§£æ"></a>æ•è·åˆ—è¡¨å¤„ç†è§£æ</h2><p>æ¥ä¸‹æ¥çœ‹çœ‹ä¸€ä¸ªç®€å•çš„ Swift çš„ä¾‹å­ï¼Œå®šä¹‰ä¸¤ä¸ªç±»å˜é‡ï¼Œç„¶ååœ¨ä¸€ä¸ªé—­åŒ…ä¸­å¯¹ä»–ä»¬è¿›è¡Œå¼±å¼•ç”¨çš„æ•è·ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aClass</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c1 = aClass()</span><br><span class="line"><span class="keyword">var</span> c2 = aClass()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fSpec = &#123; </span><br><span class="line">    [<span class="keyword">unowned</span> c1, <span class="keyword">weak</span> c2] <span class="keyword">in</span></span><br><span class="line">    c1.value = <span class="number">42</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> c2o = c2 &#123;</span><br><span class="line">        c2o.value = <span class="number">42</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fSpec()</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ xcrun swiftc -emit-sil sample.swift ç¼–è¯‘ swift æºä»£ç ï¼Œç”Ÿæˆæ ‡å‡†åŒ– SIL ä»£ç ã€‚åŸå§‹SIL å¯ä»¥ä½¿ç”¨ -emit-silgen é€‰é¡¹æ¥ç”Ÿæˆã€‚</p>
<p>è¿è¡Œä»¥ä¸Šå‘½ä»¤ä»¥åï¼Œä¼šå‘ç° swiftc äº§ç”Ÿäº†è®¸å¤šä»£ç ã€‚é€šè¿‡æŸ¥çœ‹ swiftc è¾“å‡ºä»£ç çš„ç‰‡æ®µï¼Œå­¦ä¹ ä¸€ä¸‹åŸºæœ¬çš„ SIL æŒ‡ä»¤ï¼Œç†è§£æ•´ä¸ªç»“æ„ã€‚</p>
<p>åœ¨ä¸‹é¢ä»£ç ä¸­éœ€è¦çš„åœ°æ–¹æ·»åŠ äº†ä¸€äº›å¤šè¡Œæ³¨é‡Šï¼ˆç¼–è¯‘å™¨ä¹Ÿç”Ÿæˆäº†ä¸€äº›å•è¡Œæ³¨é‡Šï¼‰ï¼Œå¸Œæœ›è¿™äº›æ³¨é‡Šå·²ç»è¶³å¤Ÿè¯´æ¸…æ¥šå‘ç”Ÿäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  æ­¤æ–‡ä»¶åŒ…å«å…¸å‹ SIL ä»£ç </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">sil_stage canonical             </span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  åªæœ‰åœ¨ SIL å†…éƒ¨ä½¿ç”¨çš„ç‰¹æ®Šçš„å¯¼å…¥</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> Builtin                  </span><br><span class="line"><span class="keyword">import</span> Swift</span><br><span class="line"><span class="keyword">import</span> SwiftShims</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	ä¸‰ä¸ªå…¨å±€å˜é‡çš„å®šä¹‰ï¼ŒåŒ…æ‹¬ c1ï¼Œc2 å’Œ é—­åŒ… fSpecã€‚</span></span><br><span class="line"><span class="comment">  	@_Tv4clos2c1CS_6aClassæ˜¯å˜é‡çš„ç¬¦å·ï¼Œ$aClass æ˜¯å®ƒçš„ç±»å‹ï¼ˆç±»å‹å‰ç¼€ä¸º$)ã€‚</span></span><br><span class="line"><span class="comment">  	å˜é‡ååœ¨è¿™é‡Œçœ‹èµ·æ¥å¾ˆä¹±ï¼Œä½†æ˜¯åœ¨åé¢çš„ä»£ç ä¸­å°†å˜å¾—æ›´åŠ å¯è¯»ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// c1</span></span><br><span class="line">sil_global hidden @_Tv4sample2c1CS_6aClass : $aClass</span><br><span class="line"></span><br><span class="line"><span class="comment">// c2</span></span><br><span class="line">sil_global hidden @_Tv4sample2c2CS_6aClass : $aClass</span><br><span class="line"></span><br><span class="line"><span class="comment">// fSpec</span></span><br><span class="line">sil_global hidden @_Tv4sample5fSpecFT_T_ : $@callee_owned () -&gt; ()</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  å±‚æ¬¡ä½œç”¨åŸŸå®šä¹‰è¡¨ç¤ºåŸå§‹ä»£ç çš„ä½ç½®ã€‚</span></span><br><span class="line"><span class="comment">  æ¯ä¸ª SIL æŒ‡ç¤ºå°†ä¼šæŒ‡å‘å®ƒç”Ÿæˆçš„ `sil_scope`ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">sil_scope <span class="number">1</span> &#123;  parent @main : $<span class="meta">@convention</span>(<span class="built_in">c</span>) (<span class="type">Int32</span>, <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;&gt;) -&gt; <span class="type">Int32</span> &#125;</span><br><span class="line">sil_scope <span class="number">2</span> &#123; loc <span class="string">"sample.swift"</span>:<span class="number">14</span>:<span class="number">1</span> parent <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	è‡ªåŠ¨ç”Ÿæˆçš„ @main å‡½æ•°åŒ…å«äº†æˆ‘ä»¬åŸå§‹å…¨éƒ¨ä½œç”¨åŸŸçš„ä»£ç ã€‚</span></span><br><span class="line"><span class="comment"> 	è¿™é‡Œæ²¿ç”¨äº†ç†Ÿæ‚‰çš„ c main() å‡½æ•°ç»“æ„ï¼Œæ¥æ”¶å‚æ•°ä¸ªæ•°å’Œå‚æ•°æ•°ç»„ä¸¤ä¸ªè¾“å…¥ï¼Œè¿™ä¸ªå‡½æ•°éµå¾ª c è°ƒç”¨çº¦å®šã€‚</span></span><br><span class="line"><span class="comment">  	è¿™ä¸ªå‡½æ•°åŒ…å«äº†éœ€è¦è°ƒç”¨é—­åŒ…çš„æŒ‡ä»¤ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line">sil @main : $<span class="meta">@convention</span>(<span class="built_in">c</span>) (<span class="type">Int32</span>, <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;&gt;) -&gt; <span class="type">Int32</span> &#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  å…¥å£å®šä¹‰å¤´éƒ¨ä¸º % ç¬¦å·ï¼Œåé¢è·Ÿéšä¸€ä¸ªæ•°å­— idã€‚</span></span><br><span class="line"><span class="comment">  æ¯å½“ä¸€ä¸ªæ–°çš„å…¥å£å®šä¹‰æ—¶ï¼ˆæˆ–è€…å‡½æ•°å¼€å¤´å®šä¹‰å‡½æ•°å‚æ•°ï¼‰ï¼Œç¼–è¯‘å™¨åœ¨å…¥å£è¡Œå°¾æ ¹æ®å®ƒçš„å€¼ï¼ˆå«åš usersï¼‰æ·»åŠ ä¸€ä¸ªæ³¨é‡Šã€‚</span></span><br><span class="line"><span class="comment">  å¯¹äºå…¶ä»–æŒ‡ä»¤ï¼Œéœ€è¦æä¾› id å·ã€‚</span></span><br><span class="line"><span class="comment">  åœ¨è¿™é‡Œï¼Œå…¥å£ 0 å°†è¢«ç”¨æ¥è®¡ç®—å…¥å£ 4 çš„å†…å®¹ï¼Œå…¥å£ 1 å°†è¢«ç”¨æ¥åˆ›å»ºå…¥å£ 10 çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// %0                                             // user: %4</span></span><br><span class="line"><span class="comment">// %1                                             // user: %10</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  æ¯ä¸€ä¸ªå‡½æ•°è¢«åˆ†è§£æˆä¸€ç³»åˆ—çš„åŸºæœ¬æŒ‡ä»¤å—ï¼Œæ¯ä¸€ä¸ªæŒ‡ä»¤å—ç»“æŸäºä¸€ä¸ªç»ˆæ­¢æŒ‡ä»¤ï¼ˆä¸€ä¸ªåˆ†æ”¯æˆ–è€…ä¸€ä¸ªè¿”å›ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">  è¿™ä¸€ç³»åˆ—çš„æŒ‡ä»¤å—è¡¨ç¤ºå‡½æ•°æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">bb0(%<span class="number">0</span> : $<span class="type">Int32</span>, %<span class="number">1</span> : $<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;&gt;):</span><br><span class="line">...</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ¯ä¸€ä¸ª SIL æŒ‡ä»¤éƒ½åŒ…å«ä¸€ä¸ªå¼•ç”¨ï¼ŒæŒ‡å‘æºä»£ç çš„ä½ç½®ï¼ŒåŒ…æ‹¬æŒ‡ä»¤å…·ä½“ä»æºä»£ç ä¸­å“ªä¸ªåœ°æ–¹æ¥ï¼Œå±äºå“ªä¸€ä¸ªä½œç”¨åŸŸã€‚</span></span><br><span class="line"><span class="comment">    åœ¨åé¢åˆ†æå…·ä½“çš„æ–¹æ³•ä¼šçœ‹åˆ°è¿™äº›å†…å®¹ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  unowned_retain %<span class="number">27</span> : $@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// id: %28</span></span><br><span class="line">  store %<span class="number">27</span> to %<span class="number">2</span> : $*@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// id: %29</span></span><br><span class="line">  %<span class="number">30</span> = alloc_box $@sil_weak <span class="type">Optional</span>&lt;aClass&gt;, <span class="keyword">var</span>, name <span class="string">"c2"</span>, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// users: %46, %44, %43, %31</span></span><br><span class="line">  %<span class="number">31</span> = project_box %<span class="number">30</span> : $@box @sil_weak <span class="type">Optional</span>&lt;aClass&gt;, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// user: %35</span></span><br><span class="line">  %<span class="number">32</span> = load %<span class="number">19</span> : $*aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// users: %34, %33</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  ä¸‹é¢æ˜¯ä¸€ç³»åˆ—è‡ªåŠ¨ç”Ÿæˆçš„`aClass`çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š init/deinit, setter/getter å’Œå…¶ä»–ä¸€äº›å·¥å…·æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">  æ¯ä¸ªæ–¹æ³•å‰çš„æ³¨é‡Šæ˜¯ç¼–è¯‘å™¨æ·»åŠ çš„ï¼Œç”¨æ¥è¯´æ˜ä»£ç çš„å…·ä½“ä½œç”¨ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  éšè—æ–¹æ³•åªåœ¨å®ƒä»¬æ¨¡å—ä¸­å¯è§ã€‚</span></span><br><span class="line"><span class="comment">  @convention(æ–¹æ³•å)æ˜¯ Swift ä¸­æ–¹æ³•è°ƒç”¨é»˜è®¤çš„çº¦å®šï¼Œåœ¨å°¾éƒ¨æœ‰ä¸€ä¸ªé™„åŠ çš„å‚æ•°æŒ‡å‘å®ƒè‡ªå·±ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// aClass.__deallocating_deinit</span></span><br><span class="line">sil hidden @_TFC4clos6aClassD : $<span class="meta">@convention</span>(method) (@owned aClass) -&gt; () &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  @guaranteed å‚æ•°è¡¨ç¤ºä¿è¯åœ¨æ•´ä¸ªå‘¨æœŸå†…è°ƒç”¨æ­¤æ–¹æ³•éƒ½æœ‰æ•ˆã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// aClass.deinit</span></span><br><span class="line">sil hidden @_TFC4clos6aClassd : $<span class="meta">@convention</span>(method) (@guaranteed aClass) -&gt; @owned <span class="type">Builtin</span>.<span class="type">NativeObject</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  [transparent] ä¿®é¥°çš„æ–¹æ³•æ˜¯å†…è”çš„å°æ–¹æ³•</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// aClass.value.getter</span></span><br><span class="line">sil hidden [transparent] @_TFC4clos6aClassg5valueSi : $<span class="meta">@convention</span>(method) (@guaranteed aClass) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// aClass.value.setter</span></span><br><span class="line">sil hidden [transparent] @_TFC4clos6aClasss5valueSi : $<span class="meta">@convention</span>(method) (<span class="type">Int</span>, @guaranteed aClass) -&gt; () &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// aClass.value.materializeForSet</span></span><br><span class="line">sil hidden [transparent] @_TFC4clos6aClassm5valueSi : $<span class="meta">@convention</span>(method) (<span class="type">Builtin</span>.<span class="type">RawPointer</span>, @<span class="keyword">inout</span> <span class="type">Builtin</span>.<span class="type">UnsafeValueBuffer</span>, @guaranteed aClass) -&gt; (<span class="type">Builtin</span>.<span class="type">RawPointer</span>, <span class="type">Optional</span>&lt;<span class="type">Builtin</span>.<span class="type">RawPointer</span>&gt;) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  @owned ä¿®é¥°ç¬¦è¡¨ç¤ºè¿™ä¸ªå¯¹è±¡å°†è¢«è°ƒç”¨è€…æ‹¥æœ‰ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// aClass.init() -&gt; aClass</span></span><br><span class="line">sil hidden @_TFC4clos6aClasscfT_S0_ : $<span class="meta">@convention</span>(method) (@owned aClass) -&gt; @owned aClass &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// aClass.__allocating_init() -&gt; aClass</span></span><br><span class="line">sil hidden @_TFC4clos6aClassCfT_S0_ : $<span class="meta">@convention</span>(method) (@thick aClass.<span class="type">Type</span>) -&gt; @owned aClass &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  æ¥ä¸‹é¢æ˜¯é—­åŒ…ä»£ç æ®µ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// (closure #1)</span></span><br><span class="line">sil shared @_TF4closU_FT_T_ : $<span class="meta">@convention</span>(thin) (@owned @sil_unowned aClass, @owned @box @sil_weak <span class="type">Optional</span>&lt;aClass&gt;) -&gt; () &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">/* å…³äºé—­åŒ…çš„ SIL ä»£ç ï¼Œ è§ä¸‹æ–‡ */</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  sil_vtable å®šä¹‰æ‰€æœ‰å…³äº aClass ç±»çš„è™šå‡½æ•°è¡¨ã€‚</span></span><br><span class="line"><span class="comment">  sil_vtable åŒ…å«äº†æœŸæœ›çš„æ‰€æœ‰è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">sil_vtable aClass &#123;</span><br><span class="line">  #aClass.<span class="keyword">deinit</span>!deallocator: _TFC4clos6aClassD	<span class="comment">// aClass.__deallocating_deinit</span></span><br><span class="line">  #aClass.value!getter.<span class="number">1</span>: _TFC4clos6aClassg5valueSi	<span class="comment">// aClass.value.getter</span></span><br><span class="line">  #aClass.value!setter.<span class="number">1</span>: _TFC4clos6aClasss5valueSi	<span class="comment">// aClass.value.setter</span></span><br><span class="line">  #aClass.value!materializeForSet.<span class="number">1</span>: _TFC4clos6aClassm5valueSi	<span class="comment">// aClass.value.materializeForSet</span></span><br><span class="line">  #aClass.<span class="keyword">init</span>!initializer.<span class="number">1</span>: _TFC4clos6aClasscfT_S0_	<span class="comment">// aClass.init() -&gt; aClass</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å›åˆ°ä¸»å‡½æ•°ï¼Œçœ‹çœ‹ä¸¤ä¸ªç±»å®ä¾‹å¦‚ä½•è¢«è·å–åˆ°ï¼Œå¹¶å¦‚ä½•ä¼ é€’ç»™è°ƒç”¨ä»–ä»¬çš„é—­åŒ…ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæ‰€æœ‰æ ‡è¯†éƒ½è¢«é‡æ–°æ•´ç†ï¼Œä½¿å¾—ä»£ç ç‰‡æ®µæ›´åŠ å¯è¯»ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main</span></span><br><span class="line">sil @main : $<span class="meta">@convention</span>(<span class="built_in">c</span>) (<span class="type">Int32</span>, <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;&gt;) -&gt; <span class="type">Int32</span> &#123;</span><br><span class="line"><span class="comment">// %0                                             // user: %4</span></span><br><span class="line"><span class="comment">// %1                                             // user: %10</span></span><br><span class="line">bb0(%<span class="number">0</span> : $<span class="type">Int32</span>, %<span class="number">1</span> : $<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;&gt;):</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å…¨å±€å˜é‡çš„å¼•ç”¨ä½¿ç”¨ä¸‰ä¸ªå…¥å£æ¥æ”¾ç½®ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  %<span class="number">13</span> = global_addr @clos.c1 : $*aClass, loc <span class="string">"sample.swift"</span>:<span class="number">5</span>:<span class="number">5</span>, scope <span class="number">1</span> <span class="comment">// users: %26, %17</span></span><br><span class="line">  ...</span><br><span class="line">  %<span class="number">19</span> = global_addr @clos.c2 : $*aClass, loc <span class="string">"sample.swift"</span>:<span class="number">6</span>:<span class="number">5</span>, scope <span class="number">1</span> <span class="comment">// users: %32, %23</span></span><br><span class="line">  ...</span><br><span class="line">  %<span class="number">25</span> = global_addr @clos.fSpec : $*@callee_owned () -&gt; (), loc <span class="string">"sample.swift"</span>:<span class="number">8</span>:<span class="number">5</span>, scope <span class="number">1</span> <span class="comment">// users: %48, %45</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    c1 æ˜¯ unowned_retained çš„ã€‚</span></span><br><span class="line"><span class="comment">    ä¸‹é¢çš„æŒ‡ä»¤å¢åŠ å˜é‡çš„ unowned å¼•ç”¨è®¡æ•°ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  %<span class="number">26</span> = load %<span class="number">13</span> : $*aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// user: %27</span></span><br><span class="line">  %<span class="number">27</span> = ref_to_unowned %<span class="number">26</span> : $aClass to $@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// users: %47, %38, %39, %29, %28</span></span><br><span class="line">  unowned_retain %<span class="number">27</span> : $@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// id: %28</span></span><br><span class="line">  store %<span class="number">27</span> to %<span class="number">2</span> : $*@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// id: %29</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹ c2 çš„å¤„ç†ä¼šæ›´åŠ å¤æ‚ä¸€äº›ã€‚</span></span><br><span class="line"><span class="comment">	alloc_box åˆ›å»ºäº†ä¸€ä¸ªè¿™ä¸ªå˜é‡çš„å¼•ç”¨æ•°å®¹å™¨ï¼Œå˜é‡å°†ä¼šå­˜åœ¨è¿™ä¸ªå®¹å™¨çš„å †ä¸­ã€‚</span></span><br><span class="line"><span class="comment">    å®¹å™¨åˆ›å»ºä»¥åï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªå¯é€‰å˜é‡ï¼ŒæŒ‡å‘ c2ï¼Œå¹¶ä¸”å¯é€‰å˜é‡ä¼šå­˜å‚¨åœ¨å®¹å™¨é‡Œã€‚å®¹å™¨ä¼šå¢åŠ æ‰€åŒ…å«å€¼çš„æŠ€æœ¯ï¼Œæ­£å¦‚ä¸‹é¢çœ‹åˆ°çš„ä¸€æ ·ï¼Œä¸€æ—¦å®¹å™¨è¢«è¿ç§»ï¼Œå¯é€‰å€¼å°±ä¼šè¢«é‡Šæ”¾ã€‚</span></span><br><span class="line"><span class="comment">    åœ¨è¿™é‡Œï¼Œc2 çš„å€¼å°†è¢«å­˜å‚¨åœ¨è¿™ä¸ªå¯é€‰å€¼ä¸­ï¼Œå¯¹è±¡å°†æš‚æ—¶strong_retained ç„¶åé‡Šæ”¾ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  %<span class="number">30</span> = alloc_box $@sil_weak <span class="type">Optional</span>&lt;aClass&gt;, <span class="keyword">var</span>, name <span class="string">"c2"</span>, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// users: %46, %44, %43, %31</span></span><br><span class="line">  %<span class="number">31</span> = project_box %<span class="number">30</span> : $@box @sil_weak <span class="type">Optional</span>&lt;aClass&gt;, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// user: %35</span></span><br><span class="line">  %<span class="number">32</span> = load %<span class="number">19</span> : $*aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// users: %34, %33</span></span><br><span class="line">  strong_retain %<span class="number">32</span> : $aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// id: %33</span></span><br><span class="line">  %<span class="number">34</span> = <span class="class"><span class="keyword">enum</span> <span class="title">$Optional</span>&lt;<span class="title">aClass</span>&gt;, #<span class="title">Optional</span>.<span class="title">some</span>!<span class="title">enumelt</span>.1, %32 : <span class="title">$aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":9:23, <span class="title">scope</span> 2 // <span class="title">users</span>: %36, %35</span></span><br><span class="line"><span class="class">  <span class="title">store_weak</span> %34 <span class="title">to</span> [<span class="title">initialization</span>] %31 : <span class="title">$</span>*@<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":9:23, <span class="title">scope</span> 2 // <span class="title">id</span>: %35</span></span><br><span class="line"><span class="class">  <span class="title">release_value</span> %34 : <span class="title">$Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":9:23, <span class="title">scope</span> 2 // <span class="title">id</span>: %36</span></span><br><span class="line"><span class="class">  /*</span></span><br><span class="line"><span class="class">    è·å–åˆ°é—­åŒ…çš„å¼•ç”¨ã€‚</span></span><br><span class="line"><span class="class">  */</span></span><br><span class="line"><span class="class">  // <span class="title">function_ref</span> (<span class="title">closure</span> #1)</span></span><br><span class="line"><span class="class">  %37 = <span class="title">function_ref</span> @<span class="title">sample</span>.(<span class="title">closure</span> #1) : <span class="title">$</span>@<span class="title">convention</span>(<span class="title">thin</span>) (@<span class="title">owned</span> @<span class="title">sil_unowned</span> <span class="title">aClass</span>, @<span class="title">owned</span> @<span class="title">box</span> @<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">user</span>: %44</span></span><br><span class="line"><span class="class">  /*</span></span><br><span class="line"><span class="class">    <span class="title">c1</span> å°†è¢«æ ‡è®°ä¸º <span class="title">tagged</span>ï¼Œå¹¶ä¸”å˜é‡å˜ä¸º <span class="title">unowned_retained</span>ã€‚</span></span><br><span class="line"><span class="class">  */</span></span><br><span class="line"><span class="class">  <span class="title">strong_retain_unowned</span> %27 : <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">id</span>: %38</span></span><br><span class="line"><span class="class">  %39 = <span class="title">unowned_to_ref</span> %27 : <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span> <span class="title">to</span> <span class="title">$aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">users</span>: %42, %40</span></span><br><span class="line"><span class="class">  %40 = <span class="title">ref_to_unowned</span> %39 : <span class="title">$aClass</span> <span class="title">to</span> <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">users</span>: %44, %41</span></span><br><span class="line"><span class="class">  <span class="title">unowned_retain</span> %40 : <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">id</span>: %41</span></span><br><span class="line"><span class="class">  <span class="title">strong_release</span> %39 : <span class="title">$aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">id</span>: %42</span></span><br><span class="line"><span class="class">  /*</span></span><br><span class="line"><span class="class">    åŒ…å« <span class="title">c2</span> çš„å¯é€‰å€¼å®¹å™¨æ˜¯ <span class="title">strong_retained</span> çš„ã€‚</span></span><br><span class="line"><span class="class">  */</span></span><br><span class="line"><span class="class">  <span class="title">strong_retain</span> %30 : <span class="title">$</span>@<span class="title">box</span> @<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">id</span>: %43</span></span><br><span class="line"><span class="class">  /*</span></span><br><span class="line"><span class="class">    åˆ›å»ºä¸€ä¸ªé—­åŒ…å¯¹è±¡ï¼Œç»‘å®šæ–¹æ³•åˆ°å‚æ•°ä¸­ã€‚</span></span><br><span class="line"><span class="class">  */</span></span><br><span class="line"><span class="class">  %44 = <span class="title">partial_apply</span> %37(%40, %30) : <span class="title">$</span>@<span class="title">convention</span>(<span class="title">thin</span>) (@<span class="title">owned</span> @<span class="title">sil_unowned</span> <span class="title">aClass</span>, @<span class="title">owned</span> @<span class="title">box</span> @<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">user</span>: %45</span></span><br><span class="line"><span class="class">  <span class="title">store</span> %44 <span class="title">to</span> %25 : <span class="title">$</span>*@<span class="title">callee_owned</span> () -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">id</span>: %45</span></span><br><span class="line"><span class="class">  /*</span></span><br><span class="line"><span class="class">    </span></span><br><span class="line"><span class="class">    å¯¹ <span class="title">c1</span> å’Œ <span class="title">c2</span> çš„å®¹å™¨å˜é‡è¿›è¡Œé‡Šæ”¾ï¼ˆä½¿ç”¨ å¯¹åº”åŒ¹é…çš„ *<span class="title">_release</span> æ–¹æ³•ï¼‰ã€‚</span></span><br><span class="line"><span class="class">  */</span></span><br><span class="line"><span class="class">  <span class="title">strong_release</span> %30 : <span class="title">$</span>@<span class="title">box</span> @<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":14:1, <span class="title">scope</span> 2 // <span class="title">id</span>: %46</span></span><br><span class="line"><span class="class">  <span class="title">unowned_release</span> %27 : <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":9:14, <span class="title">scope</span> 2 // <span class="title">id</span>: %47</span></span><br><span class="line"><span class="class">  /*</span></span><br><span class="line"><span class="class">     åŠ è½½åŸå…ˆå­˜å‚¨çš„é—­åŒ…å¯¹è±¡ï¼Œå¢åŠ å¼ºå¼•ç”¨ç„¶åè°ƒç”¨å®ƒã€‚</span></span><br><span class="line"><span class="class">  */</span></span><br><span class="line"><span class="class">   %48 = <span class="title">load</span> %25 : <span class="title">$</span>*@<span class="title">callee_owned</span> () -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":17:1, <span class="title">scope</span> 2 // <span class="title">users</span>: %50, %49</span></span><br><span class="line"><span class="class">  <span class="title">strong_retain</span> %48 : <span class="title">$</span>@<span class="title">callee_owned</span> () -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":17:1, <span class="title">scope</span> 2 // <span class="title">id</span>: %49</span></span><br><span class="line"><span class="class">  %50 = <span class="title">apply</span> %48() : <span class="title">$</span>@<span class="title">callee_owned</span> () -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":17:7, <span class="title">scope</span> 2</span></span><br><span class="line"><span class="class">  ...</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>

<p>é—­åŒ…æœ‰ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ç»“æ„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  é—­åŒ…å‚æ•°è¢«æ ‡è®°ä¸º @sil, æŒ‡å®šå‚æ•°å¦‚ä½•è¢«è®¡æ•°ï¼Œæœ‰ä¸€ä¸ª unowned çš„ aClass ç±»å˜é‡ c2, å’Œå¦å¤–ä¸€ä¸ªåŒ…å« c2 çš„å¯é€‰å€¼å®¹å™¨ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// (closure #1)</span></span><br><span class="line">sil shared @clos.fSpec: $<span class="meta">@convention</span>(thin) (@owned @sil_unowned aClass, @owned @box @sil_weak <span class="type">Optional</span>&lt;aClass&gt;) -&gt; () &#123;</span><br><span class="line"><span class="comment">// %0                                             // users: %24, %6, %5, %2</span></span><br><span class="line"><span class="comment">// %1                                             // users: %23, %3</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  ä¸‹é¢çš„å‡½æ•°åŒ…å«ä¸‰å—ï¼Œåé¢ä¸¤å—çš„æ‰§è¡Œä¾èµ–å¯é€‰å€¼ c2 å…·ä½“çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">bb0(%<span class="number">0</span> : $@sil_unowned aClass, %<span class="number">1</span> : $@box @sil_weak <span class="type">Optional</span>&lt;aClass&gt;):</span><br><span class="line">...</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    c1 è¢«å¼ºè®¡æ•°ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  strong_retain_unowned %<span class="number">0</span> : $@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">10</span>:<span class="number">5</span>, scope <span class="number">17</span> <span class="comment">// id: %5</span></span><br><span class="line">  %<span class="number">6</span> = unowned_to_ref %<span class="number">0</span> : $@sil_unowned aClass to $aClass, loc <span class="string">"sample.swift"</span>:<span class="number">10</span>:<span class="number">5</span>, scope <span class="number">17</span> <span class="comment">// users: %11, %10, %9</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ä½¿ç”¨å†…éƒ¨è‡ªå¸¦åŒ…ï¼Œä¼ å…¥ä¸€ä¸ªæ•´å‹å­—é¢é‡åˆ°æ•´å‹ç»“æ„ä¸­ï¼Œåˆå§‹åŒ–äº†ä¸€ä¸ªå€¼ä¸º 42 çš„æ•´å‹å€¼ã€‚</span></span><br><span class="line"><span class="comment">    è¿™ä¸ªå€¼å°†è¢«è®¾ç½®ä¸º c1 çš„æ–°å€¼ï¼Œå®Œæˆä»¥åè¿™ä¸ªå˜é‡å°†ä¼šè¢«é‡Šæ”¾ã€‚</span></span><br><span class="line"><span class="comment">    åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡çœ‹åˆ° class_method æŒ‡ä»¤ï¼Œç”¨äºè·å– vtable ä¸­çš„å‡½æ•°å¼•ç”¨ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  %<span class="number">7</span> = integer_literal $<span class="type">Builtin</span>.<span class="type">Int64</span>, <span class="number">42</span>, loc <span class="string">"sample.swift"</span>:<span class="number">10</span>:<span class="number">16</span>, scope <span class="number">17</span> <span class="comment">// user: %8</span></span><br><span class="line">  %<span class="number">8</span> = <span class="class"><span class="keyword">struct</span> <span class="title">$Int</span> (%7 : <span class="title">$Builtin</span>.<span class="title">Int64</span>), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":10:16, <span class="title">scope</span> 17 // <span class="title">user</span>: %10</span></span><br><span class="line"><span class="class">  %9 = <span class="title">class_method</span> %6 : <span class="title">$aClass</span>, #<span class="title">aClass</span>.<span class="title">value</span>!<span class="title">setter</span>.1 : (<span class="title">aClass</span>) -&gt; (<span class="title">Int</span>) -&gt; () , <span class="title">$</span>@<span class="title">convention</span>(<span class="title">method</span>) (<span class="title">Int</span>, @<span class="title">guaranteed</span> <span class="title">aClass</span>) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":10:14, <span class="title">scope</span> 17 // <span class="title">user</span>: %10</span></span><br><span class="line"><span class="class">  %10 = <span class="title">apply</span> %9(%8, %6) : <span class="title">$</span>@<span class="title">convention</span>(<span class="title">method</span>) (<span class="title">Int</span>, @<span class="title">guaranteed</span> <span class="title">aClass</span>) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":10:14, <span class="title">scope</span> 17</span></span><br><span class="line"><span class="class">  <span class="title">strong_release</span> %6 : <span class="title">$aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":10:16, <span class="title">scope</span> 17 // <span class="title">id</span>: %11</span></span><br><span class="line"><span class="class">  /*</span></span><br><span class="line"><span class="class">    æ¥ä¸‹æ¥è®¨è®º <span class="title">c2</span>ã€‚</span></span><br><span class="line"><span class="class">    è·å–å¯é€‰å€¼ï¼Œç„¶åæ ¹æ®å®ƒçš„å†…å®¹æ‰§è¡Œæ¥ä¸‹æ¥çš„åˆ†æ”¯è¯­å¥ã€‚</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">If</span> <span class="title">the</span> <span class="title">optional</span> <span class="title">has</span> <span class="title">a</span> <span class="title">value</span> <span class="title">the</span> <span class="title">bb2</span> <span class="title">block</span> <span class="title">will</span> <span class="title">be</span> <span class="title">executed</span> <span class="title">before</span> <span class="title">jumping</span> </span></span><br><span class="line"><span class="class">    <span class="title">to</span> <span class="title">bb3</span>, <span class="title">if</span> <span class="title">it</span> <span class="title">doesn</span>'<span class="title">t</span> <span class="title">after</span> <span class="title">a</span> <span class="title">brief</span> <span class="title">jump</span> <span class="title">to</span> <span class="title">bb1</span>, <span class="title">the</span> <span class="title">function</span> <span class="title">will</span> <span class="title">proceed</span> <span class="title">to</span> <span class="title">bb3</span> <span class="title">releasing</span></span></span><br><span class="line"><span class="class">    <span class="title">the</span> <span class="title">retained</span> <span class="title">parameters</span>.</span></span><br><span class="line"><span class="class">    </span></span><br><span class="line"><span class="class">  */</span></span><br><span class="line"><span class="class">  %12 = <span class="title">load_weak</span> %3 : <span class="title">$</span>*@<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":11:18, <span class="title">scope</span> 18 // <span class="title">user</span>: %13</span></span><br><span class="line"><span class="class">  <span class="title">switch_enum</span> %12 : <span class="title">$Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">case</span> #<span class="title">Optional</span>.<span class="title">some</span>!<span class="title">enumelt</span>.1: <span class="title">bb2</span>, <span class="title">default</span> <span class="title">bb1</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":11:18, <span class="title">scope</span> 18 // <span class="title">id</span>: %13</span></span><br><span class="line"><span class="class">  <span class="title">bb1</span>:                                              // <span class="title">Preds</span>: <span class="title">bb0</span></span></span><br><span class="line"><span class="class">  /*</span></span><br><span class="line"><span class="class">    è·³è½¬åˆ°é—­åŒ…çš„ç»“å°¾ã€‚</span></span><br><span class="line"><span class="class">  */</span></span><br><span class="line"><span class="class">  <span class="title">br</span> <span class="title">bb3</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":11:18, <span class="title">scope</span> 16        // <span class="title">id</span>: %14</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">// %15                                            // <span class="title">users</span>: %21, %20, %19, %16</span></span><br><span class="line"><span class="class"><span class="title">bb2</span>(%15 : <span class="title">$aClass</span>):                               // <span class="title">Preds</span>: <span class="title">bb0</span></span></span><br><span class="line"><span class="class">  /*</span></span><br><span class="line"><span class="class">    è°ƒç”¨ <span class="title">aClass</span> çš„ <span class="title">setter</span>ï¼Œè®¾ç½®å®ƒçš„å€¼ä¸º 42.</span></span><br><span class="line"><span class="class">  */</span></span><br><span class="line"><span class="class">  ...</span></span><br><span class="line"><span class="class">  %17 = <span class="title">integer_literal</span> <span class="title">$Builtin</span>.<span class="title">Int64</span>, 42, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":12:21, <span class="title">scope</span> 19 // <span class="title">user</span>: %18</span></span><br><span class="line"><span class="class">  %18 = <span class="title">struct</span> <span class="title">$Int</span> (%17 : <span class="title">$Builtin</span>.<span class="title">Int64</span>), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":12:21, <span class="title">scope</span> 19 // <span class="title">user</span>: %20</span></span><br><span class="line"><span class="class">  %19 = <span class="title">class_method</span> %15 : <span class="title">$aClass</span>, #<span class="title">aClass</span>.<span class="title">value</span>!<span class="title">setter</span>.1 : (<span class="title">aClass</span>) -&gt; (<span class="title">Int</span>) -&gt; () , <span class="title">$</span>@<span class="title">convention</span>(<span class="title">method</span>) (<span class="title">Int</span>, @<span class="title">guaranteed</span> <span class="title">aClass</span>) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":12:19, <span class="title">scope</span> 19 // <span class="title">user</span>: %20</span></span><br><span class="line"><span class="class">  %20 = <span class="title">apply</span> %19(%18, %15) : <span class="title">$</span>@<span class="title">convention</span>(<span class="title">method</span>) (<span class="title">Int</span>, @<span class="title">guaranteed</span> <span class="title">aClass</span>) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":12:19, <span class="title">scope</span> 19</span></span><br><span class="line"><span class="class">  <span class="title">strong_release</span> %15 : <span class="title">$aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":13:5, <span class="title">scope</span> 18 // <span class="title">id</span>: %21</span></span><br><span class="line"><span class="class">  <span class="title">br</span> <span class="title">bb3</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":13:5, <span class="title">scope</span> 18         // <span class="title">id</span>: %22</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">bb3</span>:                                              // <span class="title">Preds</span>: <span class="title">bb1</span> <span class="title">bb2</span></span></span><br><span class="line"><span class="class">  /*</span></span><br><span class="line"><span class="class">    é‡Šæ”¾æ‰€æœ‰è·å–çš„å˜é‡ç„¶åè¿”å›ã€‚</span></span><br><span class="line"><span class="class">  */</span></span><br><span class="line"><span class="class">  <span class="title">strong_release</span> %1 : <span class="title">$</span>@<span class="title">box</span> @<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":14:1, <span class="title">scope</span> 17 // <span class="title">id</span>: %23</span></span><br><span class="line"><span class="class">  <span class="title">unowned_release</span> %0 : <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":14:1, <span class="title">scope</span> 17 // <span class="title">id</span>: %24</span></span><br><span class="line"><span class="class">  %25 = <span class="title">tuple</span> (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":14:1, <span class="title">scope</span> 17 // <span class="title">user</span>: %26</span></span><br><span class="line"><span class="class">  <span class="title">return</span> %25 : <span class="title">$</span>(), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":14:1, <span class="title">scope</span> 17 // <span class="title">id</span>: %26</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œå¿½ç•¥æ‰ä¸åŒçš„ ARC æŒ‡ä»¤å¸¦æ¥çš„æ€§èƒ½çš„å·®å¼‚ç‚¹ï¼Œå¯¹ä¸åŒé˜¶æ®µæ¯ç§ç±»å‹çš„æ•è·å˜é‡åšä¸€ä¸ªå¿«é€Ÿçš„å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th>åŠ¨ä½œ</th>
<th>Unowned</th>
<th>Weak</th>
</tr>
</thead>
<tbody><tr>
<td>é¢„å…ˆè°ƒç”¨ #1</td>
<td>å¯¹è±¡è¿›è¡Œ unowned_retain</td>
<td>åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶ä¸”å¯¹è±¡è¿›è¡Œ strong_retain æ“ä½œã€‚åˆ›å»ºä¸€ä¸ªå¯é€‰å€¼ï¼Œå­˜å…¥åˆ°å®¹å™¨ä¸­ï¼Œç„¶åé‡Šæ”¾å¯é€‰å€¼</td>
</tr>
<tr>
<td>é¢„å…ˆè°ƒç”¨ #2</td>
<td>strong_retain_unownedï¼Œunowned_retain å’Œ strong_release</td>
<td>strong_retain</td>
</tr>
<tr>
<td>é—­åŒ…æ‰§è¡Œ</td>
<td>strong_retain_unownedï¼Œunowned_release</td>
<td>load_weak, æ‰“å¼€å¯é€‰å€¼, strong_release</td>
</tr>
<tr>
<td>è°ƒç”¨ä¹‹å</td>
<td>unowned_release</td>
<td>strong_release</td>
</tr>
</tbody></table>
<p>æ­£å¦‚ä¸Šé¢çœ‹åˆ°çš„ SIL ä»£ç æ®µé‚£æ ·ï¼Œå¤„ç† weak å¼•ç”¨ä¼šæ¶‰åŠåˆ°æ›´å¤šçš„å·¥ä½œï¼Œå› ä¸ºéœ€è¦å¤„ç†å¼•ç”¨éœ€è¦çš„å¯é€‰å€¼ã€‚</p>
<p>å‚ç…§å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼Œè¿™é‡Œå¯¹æ¶‰åŠåˆ°çš„æ‰€æœ‰ ARC æŒ‡ä»¤åšä¸€ä¸ªç®€è¦çš„è§£é‡Šï¼š</p>
<ul>
<li>unowned_retainï¼šå¢åŠ å †å¯¹è±¡ä¸­çš„ unowned å¼•ç”¨è®¡æ•°ã€‚</li>
<li>strong_retain_unowned ï¼šæ–­è¨€å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°å¤§äº 0ï¼Œç„¶åå¢åŠ è¿™ä¸ªå¼•ç”¨è®¡æ•°ã€‚</li>
<li>strong_retainï¼šå¢åŠ å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°ã€‚</li>
<li>load_weakï¼šä¸æ˜¯çœŸæ­£çš„ ARC è°ƒç”¨ï¼Œä½†æ˜¯å®ƒå°†å¢åŠ å¯é€‰å€¼æŒ‡å‘å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°ã€‚</li>
<li>strong_releaseï¼šå‡å°‘å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°ã€‚å¦‚æœé‡Šæ”¾æ“ä½œæŠŠå¯¹è±¡å¼ºå¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œå¯¹è±¡å°†è¢«é”€æ¯ï¼Œç„¶åå¼±å¼•ç”¨å°†è¢«æ¸…é™¤ã€‚å½“æ•´ä¸ªå¼ºå¼•ç”¨è®¡æ•°å’Œ unowned å¼•ç”¨è®¡æ•°éƒ½ä¸º0æ—¶ï¼Œå¯¹è±¡çš„å†…å­˜æ‰ä¼šè¢«é‡Šæ”¾ã€‚</li>
<li>unowned_releaseï¼šå‡å°‘å¯¹è±¡çš„ unowned å¼•ç”¨è®¡æ•°ã€‚å½“æ•´ä¸ªå¼ºå¼•ç”¨è®¡æ•°å’Œ unowned å¼•ç”¨è®¡æ•°éƒ½ä¸º 0 æ—¶ï¼Œå¯¹è±¡çš„å†…å­˜æ‰ä¼šè¢«é‡Šæ”¾ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥æ·±å…¥åˆ° Swift è¿è¡Œæ—¶çœ‹çœ‹ï¼Œè¿™äº›æŒ‡ä»¤éƒ½æ˜¯å¦‚ä½•è¢«å®ç°çš„ï¼Œç›¸å…³çš„ä»£ç æ–‡ä»¶æœ‰ï¼šHeapObject.cppï¼ŒHeapObject.hï¼ŒRefCount.h å’Œ Heap.cppã€ SwiftObject.mm ä¸­çš„å°‘é‡å®šä¹‰ã€‚å®¹å™¨å®ç°å¯ä»¥åœ¨ MetadataImpl.h æ‰¾åˆ°ï¼Œä½†æ˜¯æœ¬æ–‡ä¸å±•å¼€è®¨è®ºã€‚</p>
<p>è¿™äº›æ–‡ä»¶ä¸­å®šä¹‰å¤§å¤šæ•°çš„ ARC æ–¹æ³•éƒ½æœ‰ä¸‰ç§å˜ä½“ï¼Œä¸€ç§æ˜¯å¯¹ Swift å¯¹è±¡çš„åŸºç¡€å®ç°ï¼Œå¦å¤–ä¸¤ç§å®ç°æ˜¯é’ˆå¯¹éåŸç”Ÿ Swift å¯¹è±¡çš„ï¼šæ¡¥æ¥å¯¹è±¡å’ŒæœªçŸ¥å¯¹è±¡ã€‚åé¢ä¸¤ç§å˜ä½“è¿™é‡Œä¸äºˆè®¨è®ºã€‚</p>
<p>ç¬¬ä¸€ä¸ªè®¨è®ºæŒ‡ä»¤é›†å’Œ unowned å¼•ç”¨ç›¸å…³ã€‚</p>
<p>åœ¨ HeapObject.cpp æ–‡ä»¶ä¸­é—´å¯ä»¥çœ‹åˆ°å¯¹ unowned_retain å’Œ unowned_release çš„å®ç°æ–¹æ³•ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">SWIFT_RT_ENTRY_VISIBILITY</span></span><br><span class="line">void swift::swift_unownedRetain(<span class="type">HeapObject</span> *object)</span><br><span class="line">    <span class="type">SWIFT_CC</span>(<span class="type">RegisterPreservingCC_IMPL</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!object)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  object-&gt;weakRefCount.increment();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">SWIFT_RT_ENTRY_VISIBILITY</span></span><br><span class="line">void swift::swift_unownedRelease(<span class="type">HeapObject</span> *object)</span><br><span class="line">    <span class="type">SWIFT_CC</span>(<span class="type">RegisterPreservingCC_IMPL</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!object)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (object-&gt;weakRefCount.decrementShouldDeallocate()) &#123;</span><br><span class="line">    <span class="comment">// Only class objects can be weak-retained and weak-released.</span></span><br><span class="line">    auto metadata = object-&gt;metadata;</span><br><span class="line">    <span class="built_in">assert</span>(metadata-&gt;isClassObject());</span><br><span class="line">    auto classMetadata = static_cast&lt;const <span class="type">ClassMetadata</span>*&gt;(metadata);</span><br><span class="line">    <span class="built_in">assert</span>(classMetadata-&gt;isTypeMetadata());</span><br><span class="line">    <span class="type">SWIFT_RT_ENTRY_CALL</span>(swift_slowDealloc)</span><br><span class="line">        (object, classMetadata-&gt;getInstanceSize(),</span><br><span class="line">         classMetadata-&gt;getInstanceAlignMask());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>swift_unownedRetain æ˜¯ unowned_retain çš„å…·ä½“å®ç°ï¼Œç®€å•åœ°è¿›è¡Œ unowned å¼•ç”¨è®¡æ•°çš„åŸå­å¢åŠ æ“ä½œï¼ˆè¿™é‡Œå®šä¹‰ä¸ºweakRefCountï¼‰ï¼Œswift_unownedRelease æ›´åŠ å¤æ‚ï¼ŒåŸå› ä¹‹å‰ä¹Ÿæè¿°è¿‡ï¼Œå½“æ²¡æœ‰å…¶ä»– unowned å¼•ç”¨å­˜åœ¨æ—¶ï¼Œå®ƒéœ€è¦æ‰§è¡Œå¯¹è±¡çš„ææ„æ“ä½œã€‚</p>
<p>ä½†æ˜¯æ•´ä½“æ¥è®²éƒ½ä¸å¤æ‚ï¼Œåœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ° doDecrementShouldDeallocate æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ä¸Šé¢ä»£ç ä¸­è¢«ä¸€ä¸ªå‘½åç±»ä¼¼çš„æ–¹æ³•è°ƒç”¨äº†ã€‚è¿™ä¸ªæ–¹æ³•æ²¡æœ‰åšå¤ªå¤šï¼Œswift_slowDealloc åªæ˜¯é‡Šæ”¾ç»™å®šçš„æŒ‡é’ˆã€‚</p>
<p>åˆ°æ­¤å·²ç»æœ‰äº†ä¸€ä¸ªå¯¹è±¡çš„ unowned å¼•ç”¨ï¼Œå¦å¤–ä¸€ä¸ªæŒ‡ä»¤ï¼Œstrong_retain_unowned ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¼ºå¼•ç”¨ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">SWIFT_RT_ENTRY_VISIBILITY</span></span><br><span class="line">void swift::swift_unownedRetainStrong(<span class="type">HeapObject</span> *object)</span><br><span class="line">    <span class="type">SWIFT_CC</span>(<span class="type">RegisterPreservingCC_IMPL</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!object)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  <span class="built_in">assert</span>(object-&gt;weakRefCount.getCount() &amp;&amp;</span><br><span class="line">         <span class="string">"object is not currently weakly retained"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (! object-&gt;refCount.tryIncrement())</span><br><span class="line">    _swift_abortRetainUnowned(object);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºå¼±å¼•ç”¨åº”è¯¥æŒ‡å‘äº†è¿™ä¸ªå¯¹è±¡ï¼Œè¦ä½¿ç”¨æ–­è¨€æ¥éªŒè¯å¯¹è±¡æ˜¯å¦è¢«å¼±å¼•ç”¨ï¼Œä¸€æ—¦æ–­è¨€é€šè¿‡ï¼Œå°†å°è¯•è¿›è¡Œå¢åŠ å¼ºå¼•ç”¨è®¡æ•°çš„æ“ä½œã€‚ä¸€æ—¦å¯¹è±¡åœ¨è¿›ç¨‹ä¸­å·²ç»è¢«é‡Šæ”¾ï¼Œå°è¯•å°†ä¼šå¤±è´¥ã€‚</p>
<p>æ‰€æœ‰ç±»ä¼¼äº tryIncrement é€šè¿‡æŸç§å½¢å¼ä¿®æ”¹å¼•ç”¨è®¡æ•°çš„æ–¹æ³•éƒ½æ”¾åˆ° RefCount.h ä¸­ï¼Œéœ€è¦ä½¿ç”¨åŸå­æ“ä½œè¿›è¡Œè¿™äº›ä»»åŠ¡ã€‚</p>
<p>æ¥ä¸‹æ¥è®¨è®ºä¸‹ weak å¼•ç”¨çš„çš„å®ç°ï¼Œæ­£å¦‚ä¹‹å‰çœ‹åˆ°çš„é‚£æ ·ï¼Œswift_weakLoadStrong ç”¨æ¥è·å–å®¹å™¨ä¸­å¯é€‰å€¼ä¸­å¼ºå¼•ç”¨çš„å¯¹è±¡ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">HeapObject</span> *swift::swift_weakLoadStrong(<span class="type">WeakReference</span> *ref) &#123;</span><br><span class="line">  <span class="keyword">if</span> (ref-&gt;<span class="type">Value</span> == (uintptr_t)nullptr) &#123;</span><br><span class="line">    <span class="keyword">return</span> nullptr;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ref å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®</span></span><br><span class="line">  auto ptr = __atomic_fetch_or(&amp;ref-&gt;<span class="type">Value</span>, <span class="type">WR_READING</span>, __ATOMIC_RELAXED);</span><br><span class="line">  <span class="keyword">while</span> (ptr &amp; <span class="type">WR_READING</span>) &#123;</span><br><span class="line">    short <span class="built_in">c</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (__atomic_load_n(&amp;ref-&gt;<span class="type">Value</span>, __ATOMIC_RELAXED) &amp; <span class="type">WR_READING</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (++<span class="built_in">c</span> == <span class="type">WR_SPINLIMIT</span>) &#123;</span><br><span class="line">        std::this_thread::yield();</span><br><span class="line">        <span class="built_in">c</span> -= <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ptr = __atomic_fetch_or(&amp;ref-&gt;<span class="type">Value</span>, <span class="type">WR_READING</span>, __ATOMIC_RELAXED);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  auto object = (<span class="type">HeapObject</span>*)(ptr &amp; ~<span class="type">WR_NATIVE</span>);</span><br><span class="line">  <span class="keyword">if</span> (object == nullptr) &#123;</span><br><span class="line">    __atomic_store_n(&amp;ref-&gt;<span class="type">Value</span>, (uintptr_t)nullptr, __ATOMIC_RELAXED);</span><br><span class="line">    <span class="keyword">return</span> nullptr;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (object-&gt;refCount.isDeallocating()) &#123;</span><br><span class="line">    __atomic_store_n(&amp;ref-&gt;<span class="type">Value</span>, (uintptr_t)nullptr, __ATOMIC_RELAXED);</span><br><span class="line">    <span class="type">SWIFT_RT_ENTRY_CALL</span>(swift_unownedRelease)(object);</span><br><span class="line">    <span class="keyword">return</span> nullptr;</span><br><span class="line">  &#125;</span><br><span class="line">  auto result = swift_tryRetain(object);</span><br><span class="line">  __atomic_store_n(&amp;ref-&gt;<span class="type">Value</span>, ptr, __ATOMIC_RELAXED);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œè·å–ä¸€ä¸ªå¼ºå¼•ç”¨éœ€è¦æ›´å¤šå¤æ‚åŒæ­¥æ“ä½œï¼Œåœ¨å¤šçº¿ç¨‹ç«äº‰ä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œä¼šå¸¦æ¥æ€§èƒ½æŸè€—ã€‚</p>
<p>åœ¨è¿™é‡Œç¬¬ä¸€æ¬¡å‡ºç°çš„ WeakReference å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªç®€å•çš„ç»“æ„ä½“ï¼ŒåŒ…å«ä¸€ä¸ªæ•´å‹å€¼å­—æ®µæŒ‡å‘ç›®æ ‡å¯¹è±¡ï¼Œç›®æ ‡å¯¹è±¡æ˜¯ä½¿ç”¨ HeapObject ç±»æ¥æ‰¿è½½çš„æ¯ä¸€ä¸ªè¿è¡Œæ—¶çš„ Swift å¯¹è±¡ã€‚</p>
<p>åœ¨ weak å¼•ç”¨è¯¢é—®å½“å‰çº¿ç¨‹è®¾ç½®çš„ WR_READING æ ‡è¯†ä¹‹åï¼Œä» WeakReference å®¹å™¨ä¸­è·å– Swift å¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸å†æœ‰æ•ˆï¼Œæˆ–è€…åœ¨ç­‰å¾…è·å–èµ„æºæ—¶ï¼Œå®ƒå˜æˆå¯ä»¥è¿›è¡Œææ„ï¼Œå½“å‰çš„å¼•ç”¨ä¼šè¢«è®¾ç½®ä¸º nullã€‚</p>
<p>å¦‚æœå¯¹è±¡ä¾ç„¶æœ‰æ•ˆï¼Œè·å–å¯¹è±¡çš„å°è¯•å°†ä¼šæˆåŠŸã€‚</p>
<p>å› æ­¤ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è®²ï¼Œå¯¹ weak å¼•ç”¨çš„å¸¸è§„æ“ä½œæ€§èƒ½æ¯” unowned å¼•ç”¨çš„æ›´ä½ï¼ˆä½†æ˜¯ä¸»è¦çš„é—®é¢˜è¿˜æ˜¯åœ¨å¯é€‰å€¼æ“ä½œä¸Šé¢ï¼‰ã€‚</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ä¿å®ˆçš„ä½¿ç”¨ weak å¼•ç”¨æ˜¯å¦æ˜æ™ºå‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œæ— è®ºæ˜¯ä»æ€§èƒ½çš„è§’åº¦è¿˜æ˜¯ä»£ç æ¸…æ™°çš„è§’åº¦è€Œè¨€ã€‚</p>
<p>ä½¿ç”¨æ­£ç¡®çš„æ•è·ä¿®é¥°ç¬¦ç±»å‹ï¼Œæ˜ç¡®çš„è¡¨æ˜ä»£ç ä¸­çš„ç”Ÿå‘½å‘¨æœŸç‰¹æ€§ï¼Œå½“å…¶ä»–äººæˆ–è€…ä½ è‡ªå·±åœ¨è¯»ä½ çš„ä»£ç æ—¶ä¸å®¹æ˜“è¯¯è§£ã€‚</p>
<h2 id="è„šæ³¨"><a href="#è„šæ³¨" class="headerlink" title="è„šæ³¨"></a>è„šæ³¨</h2><p>1ã€è‹¹æœç¬¬ä¸€æ¬¡è®¨è®º weak/unowned äº‰è®®å¯ä»¥æŸ¥çœ‹è¿™é‡Œï¼Œä¹‹ååœ¨ twitter ä¸Š Joe Groff å¯¹æ­¤ä¹Ÿè¿›è¡Œäº†è®¨è®ºï¼Œå¹¶ä¸”è¢« Michael Tsai æ€»ç»“æˆæ–‡ã€‚<br>è¿™ç¯‡æ–‡ç« ä»æ„å›¾è§’åº¦å‡ºå‘ï¼Œæä¾›äº†å®Œæ•´å¹¶ä¸”å¯æ“ä½œçš„è§£é‡Šã€‚</p>
<p>2ã€ä»ç»´åŸºç™¾ç§‘ä¸­å¯ä»¥æ‰¾åˆ°å…³äº AST çš„è§£é‡Šï¼Œè¿˜å¯ä»¥ä» Slava Pestov çš„è¿™ç¯‡æ–‡ç« ä¸­çœ‹åˆ°å…³äº Swift ç¼–è¯‘å™¨ä¸­å¦‚ä½•å®ç° AST çš„ä¸€äº›ç»†èŠ‚ã€‚</p>
<p>3ã€å…³äº SIL çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹è¯¦å°½çš„å®˜æ–¹ SIL æŒ‡å—ï¼Œè¿˜æœ‰ 2015 LLVM å¼€å‘è€…ä¼šè®®çš„è§†é¢‘ã€‚Lex Chou å†™çš„ SIL å¿«é€ŸæŒ‡å—å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚</p>
<p>4ã€æŸ¥çœ‹åœ¨ Swift ä¸­å¦‚ä½•è¿›è¡Œåç§°ç²‰ç¢ï¼ˆname manglingï¼‰çš„ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹ Lex Chou çš„è¿™ç¯‡æ–‡ç« ã€‚</p>
<p>5ã€Mike Ash åœ¨ä»–çš„ Friday Q&amp;A ä¸­çš„ä¸€ç¯‡æ–‡ç« ä¸­è®¨è®ºäº†å¦‚ä½•å®ç° weak å¼•ç”¨çš„ä¸€ç§å®è·µæ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•ä¸ç›®å‰ Swift çš„æ–¹æ³•å¯¹æ¯”èµ·æ¥æœ‰ä¸€äº›è¿‡æ—¶ï¼Œä½†æ˜¯å…¶ä¸­çš„è§£é‡Šä¾ç„¶å€¼å¾—å‚è€ƒã€‚</p>
<blockquote>
<p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.gg./" target="_blank" rel="noopener">http://swift.ggã€‚</a></p>
</blockquote>
<hr>
<p>æ–‡ç« è½¬è‡ª <a href="http://swift.gg/2017/05/16/unowned-or-weak-lifetime-and-performance/" target="_blank" rel="noopener">SwiftGG</a></p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Unownedä¸Weak</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Œè½¬ã€iOSå›¾ç‰‡åŠ è½½é€Ÿåº¦æé™ä¼˜åŒ–â€”FastImageCacheè§£æ</title>
    <url>/post/bang-fastimagecache/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>åŸæ–‡ï¼š<a href="http://blog.cnbang.net/tech/2578/" target="_blank" rel="noopener">iOSå›¾ç‰‡åŠ è½½é€Ÿåº¦æé™ä¼˜åŒ–â€”FastImageCacheè§£æ</a></p>
<p><a href="https://github.com/path/FastImageCache" target="_blank" rel="noopener">FastImageCache</a>æ˜¯Pathå›¢é˜Ÿå¼€å‘çš„ä¸€ä¸ªå¼€æºåº“ï¼Œç”¨äºæå‡å›¾ç‰‡çš„åŠ è½½å’Œæ¸²æŸ“é€Ÿåº¦ï¼Œè®©åŸºäºå›¾ç‰‡çš„åˆ—è¡¨æ»‘åŠ¨èµ·æ¥æ›´é¡ºç•…ï¼Œæ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåšçš„ã€‚</p>
<a id="more"></a>

<h2 id="ä¼˜åŒ–ç‚¹"><a href="#ä¼˜åŒ–ç‚¹" class="headerlink" title="ä¼˜åŒ–ç‚¹"></a>ä¼˜åŒ–ç‚¹</h2><p>iOSä»ç£ç›˜åŠ è½½ä¸€å¼ å›¾ç‰‡ï¼Œä½¿ç”¨UIImageVIewæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œéœ€è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>ä»ç£ç›˜æ‹·è´æ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒº</li>
<li>ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´</li>
<li>ç”ŸæˆUIImageViewï¼ŒæŠŠå›¾åƒæ•°æ®èµ‹å€¼ç»™UIImageView</li>
<li>å¦‚æœå›¾åƒæ•°æ®ä¸ºæœªè§£ç çš„PNG/JPGï¼Œè§£ç ä¸ºä½å›¾æ•°æ®</li>
<li>CATransactionæ•è·åˆ°UIImageView layeræ ‘çš„å˜åŒ–</li>
<li>ä¸»çº¿ç¨‹Runloopæäº¤CATransactionï¼Œå¼€å§‹è¿›è¡Œå›¾åƒæ¸²æŸ“<br> 6.1 å¦‚æœæ•°æ®æ²¡æœ‰å­—èŠ‚å¯¹é½ï¼ŒCore Animationä¼šå†æ‹·è´ä¸€ä»½æ•°æ®ï¼Œè¿›è¡Œå­—èŠ‚å¯¹é½ã€‚<br> 6.2 GPUå¤„ç†ä½å›¾æ•°æ®ï¼Œè¿›è¡Œæ¸²æŸ“ã€‚</li>
</ol>
<p>FastImageCacheåˆ†åˆ«ä¼˜åŒ–äº†2,4,6.1ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ä½¿ç”¨mmapå†…å­˜æ˜ å°„ï¼Œçœå»äº†ä¸Šè¿°ç¬¬2æ­¥æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„æ“ä½œã€‚</li>
<li>ç¼“å­˜è§£ç åçš„ä½å›¾æ•°æ®åˆ°ç£ç›˜ï¼Œä¸‹æ¬¡ä»ç£ç›˜è¯»å–æ—¶çœå»ç¬¬4æ­¥è§£ç çš„æ“ä½œã€‚</li>
<li>ç”Ÿæˆå­—èŠ‚å¯¹é½çš„æ•°æ®ï¼Œé˜²æ­¢ä¸Šè¿°ç¬¬6.1æ­¥CoreAnimationåœ¨æ¸²æŸ“æ—¶å†æ‹·è´ä¸€ä»½æ•°æ®ã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥å…·ä½“ä»‹ç»è¿™ä¸‰ä¸ªä¼˜åŒ–ç‚¹ä»¥åŠå®ƒçš„å®ç°ã€‚</p>
<h3 id="å†…å­˜æ˜ å°„"><a href="#å†…å­˜æ˜ å°„" class="headerlink" title="å†…å­˜æ˜ å°„"></a>å†…å­˜æ˜ å°„</h3><p>å¹³å¸¸æˆ‘ä»¬è¯»å–ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸Šå±‚APIè°ƒç”¨åˆ°æœ€åä¼šä½¿ç”¨ç³»ç»Ÿæ–¹æ³•read()è¯»å–æ•°æ®ï¼Œå†…æ ¸æŠŠç£ç›˜æ•°æ®è¯»å…¥å†…æ ¸ç¼“å†²åŒºï¼Œç”¨æˆ·å†ä»å†…æ ¸ç¼“å†²åŒºè¯»å–æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·å†…å­˜ç©ºé—´ï¼Œè¿™é‡Œæœ‰ä¸€æ¬¡å†…å­˜æ‹·è´çš„æ—¶é—´æ¶ˆè€—ï¼Œå¹¶ä¸”è¯»å–åæ•´ä¸ªæ–‡ä»¶æ•°æ®å°±å·²ç»å­˜åœ¨äºç”¨æˆ·å†…å­˜ä¸­ï¼Œå ç”¨äº†è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>FastImageCacheé‡‡ç”¨äº†å¦ä¸€ç§è¯»å†™æ–‡ä»¶çš„æ–¹æ³•ï¼Œå°±æ˜¯ç”¨mmapæŠŠæ–‡ä»¶æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´é‡Œçš„è™šæ‹Ÿå†…å­˜ï¼Œæ–‡ä»¶ä¸­çš„ä½ç½®åœ¨è™šæ‹Ÿå†…å­˜ä¸­æœ‰äº†å¯¹åº”çš„åœ°å€ï¼Œå¯ä»¥åƒæ“ä½œå†…å­˜ä¸€æ ·æ“ä½œè¿™ä¸ªæ–‡ä»¶ï¼Œç›¸å½“äºå·²ç»æŠŠæ•´ä¸ªæ–‡ä»¶æ”¾å…¥å†…å­˜ï¼Œä½†åœ¨çœŸæ­£ä½¿ç”¨åˆ°è¿™äº›æ•°æ®å‰å´ä¸ä¼šæ¶ˆè€—ç‰©ç†å†…å­˜ï¼Œä¹Ÿä¸ä¼šæœ‰è¯»å†™ç£ç›˜çš„æ“ä½œï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨è¿™äº›æ•°æ®æ—¶ï¼Œä¹Ÿå°±æ˜¯å›¾åƒå‡†å¤‡æ¸²æŸ“åœ¨å±å¹•ä¸Šæ—¶ï¼Œè™šæ‹Ÿå†…å­˜ç®¡ç†ç³»ç»ŸVMSæ‰æ ¹æ®ç¼ºé¡µåŠ è½½çš„æœºåˆ¶ä»ç£ç›˜åŠ è½½å¯¹åº”çš„æ•°æ®å—åˆ°ç‰©ç†å†…å­˜ï¼Œå†è¿›è¡Œæ¸²æŸ“ã€‚è¿™æ ·çš„æ–‡ä»¶è¯»å†™æ–‡ä»¶æ–¹å¼å°‘äº†æ•°æ®ä»å†…æ ¸ç¼“å­˜åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚</p>
<h3 id="è§£ç å›¾åƒ"><a href="#è§£ç å›¾åƒ" class="headerlink" title="è§£ç å›¾åƒ"></a>è§£ç å›¾åƒ</h3><p>ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨çš„å›¾åƒæ˜¯JPG/PNGï¼Œè¿™äº›å›¾åƒæ•°æ®ä¸æ˜¯ä½å›¾ï¼Œè€Œæ˜¯æ˜¯ç»è¿‡ç¼–ç å‹ç¼©åçš„æ•°æ®ï¼Œä½¿ç”¨å®ƒæ¸²æŸ“åˆ°å±å¹•ä¹‹å‰éœ€è¦è¿›è¡Œè§£ç è½¬æˆä½å›¾æ•°æ®ï¼Œè¿™ä¸ªè§£ç æ“ä½œæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œå¹¶ä¸”æ²¡æœ‰GPUç¡¬è§£ç ï¼Œåªèƒ½é€šè¿‡CPUï¼ŒiOSé»˜è®¤ä¼šåœ¨ä¸»çº¿ç¨‹å¯¹å›¾åƒè¿›è¡Œè§£ç ã€‚å¾ˆå¤šåº“éƒ½è§£å†³äº†å›¾åƒè§£ç çš„é—®é¢˜ï¼Œä¸è¿‡ç”±äºè§£ç åçš„å›¾åƒå¤ªå¤§ï¼Œä¸€èˆ¬ä¸ä¼šç¼“å­˜åˆ°ç£ç›˜ï¼ŒSDWebImageçš„åšæ³•æ˜¯æŠŠè§£ç æ“ä½œä»ä¸»çº¿ç¨‹ç§»åˆ°å­çº¿ç¨‹ï¼Œè®©è€—æ—¶çš„è§£ç æ“ä½œä¸å ç”¨ä¸»çº¿ç¨‹çš„æ—¶é—´ã€‚</p>
<p>FastImageCacheä¹Ÿæ˜¯åœ¨å­çº¿ç¨‹è§£ç å›¾åƒï¼Œä¸åŒçš„æ˜¯å®ƒä¼šç¼“å­˜è§£ç åçš„å›¾åƒåˆ°ç£ç›˜ã€‚å› ä¸ºè§£ç åçš„å›¾åƒä½“ç§¯å¾ˆå¤§ï¼ŒFastImageCacheå¯¹è¿™äº›å›¾åƒæ•°æ®åšäº†ç³»åˆ—ç¼“å­˜ç®¡ç†ï¼Œè¯¦è§ä¸‹æ–‡å®ç°éƒ¨åˆ†ã€‚å¦å¤–ç¼“å­˜çš„å›¾åƒä½“ç§¯å¤§ä¹Ÿæ˜¯ä½¿ç”¨å†…å­˜æ˜ å°„è¯»å–æ–‡ä»¶çš„åŸå› ï¼Œå°æ–‡ä»¶ä½¿ç”¨å†…å­˜æ˜ å°„æ— ä¼˜åŠ¿ï¼Œå†…å­˜æ‹·è´çš„é‡å°‘ï¼Œæ‹·è´åå ç”¨ç”¨æˆ·å†…å­˜ä¹Ÿä¸é«˜ï¼Œæ–‡ä»¶è¶Šå¤§å†…å­˜æ˜ å°„ä¼˜åŠ¿è¶Šå¤§ã€‚</p>
<h3 id="å­—èŠ‚å¯¹é½"><a href="#å­—èŠ‚å¯¹é½" class="headerlink" title="å­—èŠ‚å¯¹é½"></a>å­—èŠ‚å¯¹é½</h3><p>Core Animationåœ¨å›¾åƒæ•°æ®éå­—èŠ‚å¯¹é½çš„æƒ…å†µä¸‹æ¸²æŸ“å‰ä¼šå…ˆæ‹·è´ä¸€ä»½å›¾åƒæ•°æ®ï¼Œå®˜æ–¹æ–‡æ¡£æ²¡æœ‰å¯¹è¿™æ¬¡æ‹·è´è¡Œä¸ºä½œè¯´æ˜ï¼Œæ¨¡æ‹Ÿå™¨å’ŒInstrumenté‡Œæœ‰é«˜äº®æ˜¾ç¤ºâ€œcopied imagesâ€çš„åŠŸèƒ½ï¼Œä½†ä¼¼ä¹å®ƒæœ‰bugï¼Œå³ä½¿æŸå¼ å›¾ç‰‡æ²¡æœ‰è¢«é«˜äº®æ˜¾ç¤ºå‡ºæ¸²æŸ“æ—¶è¢«copyï¼Œä»è°ƒç”¨å †æ ˆä¸Šä¹Ÿè¿˜æ˜¯èƒ½çœ‹åˆ°è°ƒç”¨äº†CA::Render::copy_imageæ–¹æ³•ï¼š</p>
<p><img src="/images/fastImageCache1.png" alt="fastImageCache1"></p>
<p>é‚£ä»€ä¹ˆæ˜¯å­—èŠ‚å¯¹é½å‘¢ï¼ŒæŒ‰æˆ‘çš„ç†è§£ï¼Œä¸ºäº†æ€§èƒ½ï¼Œåº•å±‚æ¸²æŸ“å›¾åƒæ—¶ä¸æ˜¯ä¸€ä¸ªåƒç´ ä¸€ä¸ªåƒç´ æ¸²æŸ“ï¼Œè€Œæ˜¯ä¸€å—ä¸€å—æ¸²æŸ“ï¼Œæ•°æ®æ˜¯ä¸€å—å—åœ°å–ï¼Œå°±å¯èƒ½é‡åˆ°è¿™ä¸€å—è¿ç»­çš„å†…å­˜æ•°æ®é‡Œç»“å°¾çš„æ•°æ®ä¸æ˜¯å›¾åƒçš„å†…å®¹ï¼Œæ˜¯å†…å­˜é‡Œå…¶ä»–çš„æ•°æ®ï¼Œå¯èƒ½è¶Šç•Œè¯»å–å¯¼è‡´ä¸€äº›å¥‡æ€ªçš„ä¸œè¥¿æ··å…¥ï¼Œæ‰€ä»¥åœ¨æ¸²æŸ“ä¹‹å‰CoreAnimationè¦æŠŠæ•°æ®æ‹·è´ä¸€ä»½è¿›è¡Œå¤„ç†ï¼Œç¡®ä¿æ¯ä¸€å—éƒ½æ˜¯å›¾åƒæ•°æ®ï¼Œå¯¹äºä¸è¶³ä¸€å—çš„æ•°æ®ç½®ç©ºã€‚å¤§è‡´å›¾ç¤ºï¼š(pixelæ˜¯å›¾åƒåƒç´ æ•°æ®ï¼Œdataæ˜¯å†…å­˜é‡Œå…¶ä»–æ•°æ®)</p>
<p><img src="/images/fastImageCache2.png" alt="fastImageCache2"></p>
<p>å—çš„å¤§å°åº”è¯¥æ˜¯è·ŸCPU cache lineæœ‰å…³ï¼ŒARMv7æ˜¯32byteï¼ŒA9æ˜¯64byteï¼Œåœ¨A9ä¸‹CoreAnimationåº”è¯¥æ˜¯æŒ‰64byteä½œä¸ºä¸€å—æ•°æ®å»è¯»å–å’Œæ¸²æŸ“ï¼Œè®©å›¾åƒæ•°æ®å¯¹é½64byteå°±å¯ä»¥é¿å…CoreAnimationå†æ‹·è´ä¸€ä»½æ•°æ®è¿›è¡Œä¿®è¡¥ã€‚FastImageCacheåšçš„å­—èŠ‚å¯¹é½å°±æ˜¯è¿™ä¸ªäº‹æƒ…ã€‚</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>FastImageCacheæŠŠåŒä¸ªç±»å‹å’Œå°ºå¯¸çš„å›¾åƒéƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œæ ¹æ®æ–‡ä»¶åç§»å–å•å¼ å›¾ç‰‡ï¼Œç±»ä¼¼webçš„cssé›ªç¢§å›¾ï¼Œè¿™é‡Œç§°ä¸ºImageTableã€‚è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿ç»Ÿä¸€ç®¡ç†å›¾ç‰‡ç¼“å­˜ï¼Œæ§åˆ¶ç¼“å­˜çš„å¤§å°ï¼Œæ•´ä¸ªFastImageCacheå°±æ˜¯åœ¨ç®¡ç†ä¸€ä¸ªä¸ªImageTableçš„æ•°æ®ã€‚æ•´ä½“å®ç°çš„æ•°æ®ç»“æ„å¦‚å›¾ï¼š</p>
<p><img src="/images/fastImageCache3.png" alt="fastImageCache3"></p>
<p>ä¸€äº›è¡¥å……å’Œè¯´æ˜ï¼š</p>
<h3 id="ImageTable"><a href="#ImageTable" class="headerlink" title="ImageTable"></a>ImageTable</h3><ol>
<li>ä¸€ä¸ªImageFormatå¯¹åº”ä¸€ä¸ªImageTableï¼ŒImageFormatæŒ‡å®šäº†ImageTableé‡Œå›¾åƒæ¸²æŸ“æ ¼å¼/å¤§å°ç­‰ä¿¡æ¯ï¼ŒImageTableé‡Œçš„å›¾åƒæ•°æ®éƒ½ç”±ImageFormatè§„å®šäº†ç»Ÿä¸€çš„å°ºå¯¸ï¼Œæ¯å¼ å›¾åƒå¤§å°éƒ½æ˜¯ä¸€æ ·çš„ã€‚</li>
<li>ä¸€ä¸ªImageTableä¸€ä¸ªå®ä½“æ–‡ä»¶ï¼Œå¹¶æœ‰å¦ä¸€ä¸ªæ–‡ä»¶ä¿å­˜è¿™ä¸ªImageTableçš„metaä¿¡æ¯ã€‚</li>
<li>å›¾åƒä½¿ç”¨entityUUIDä½œä¸ºå”¯ä¸€æ ‡ç¤ºç¬¦ï¼Œç”±ç”¨æˆ·å®šä¹‰ï¼Œé€šå¸¸æ˜¯å›¾åƒurlçš„hashå€¼ã€‚ImageTable Metaçš„indexMapè®°å½•äº†entityUUID-&gt;entryIndexçš„æ˜ å°„ï¼Œé€šè¿‡indexMapå°±å¯ä»¥ç”¨å›¾åƒçš„entityUUIDæ‰¾åˆ°ç¼“å­˜æ•°æ®åœ¨ImageTableå¯¹åº”çš„ä½ç½®ã€‚</li>
</ol>
<h3 id="ImageTableEntry"><a href="#ImageTableEntry" class="headerlink" title="ImageTableEntry"></a>ImageTableEntry</h3><ol>
<li>ImageTableçš„å®ä½“æ•°æ®æ˜¯ImageTableEntryï¼Œæ¯ä¸ªentryæœ‰ä¸¤éƒ¨åˆ†æ•°æ®ï¼Œä¸€éƒ¨åˆ†æ˜¯å¯¹é½åçš„å›¾åƒæ•°æ®ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯metaä¿¡æ¯ï¼Œmetaä¿å­˜è¿™å¼ å›¾åƒçš„UUIDå’ŒåŸå›¾UUIDï¼Œç”¨äºæ ¡éªŒå›¾åƒæ•°æ®çš„æ­£ç¡®æ€§ã€‚</li>
<li>Entryæ•°æ®æ˜¯æŒ‰å†…å­˜åˆ†é¡µå¤§å°å¯¹é½çš„ï¼Œæ•°æ®å¤§å°æ˜¯å†…å­˜åˆ†é¡µå¤§å°çš„æ•´æ•°å€ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è™šæ‹Ÿå†…å­˜ç¼ºé¡µåŠ è½½æ—¶ä½¿ç”¨æœ€å°‘çš„å†…å­˜é¡µåŠ è½½ä¸€å¼ å›¾åƒã€‚</li>
<li>å›¾åƒæ•°æ®åšäº†å­—èŠ‚å¯¹é½å¤„ç†ï¼ŒCoreAnimationä½¿ç”¨æ—¶æ— éœ€å†å¤„ç†æ‹·è´ã€‚å…·ä½“åšæ³•æ˜¯CGBitmapContextCreateåˆ›å»ºä½å›¾ç”»å¸ƒæ—¶bytesPerRowå‚æ•°ä¼ 64å€æ•°ã€‚</li>
</ol>
<h3 id="Chunk"><a href="#Chunk" class="headerlink" title="Chunk"></a>Chunk</h3><ul>
<li>ImageTableå’Œå®ä½“æ•°æ®Entryé—´å¤šäº†å±‚Chunkï¼ŒChunkæ˜¯é€»è¾‘ä¸Šçš„æ•°æ®åˆ’åˆ†ï¼ŒNä¸ªEntryä½œä¸ºä¸€ä¸ªChunkï¼Œå†…å­˜æ˜ å°„mmapæ“ä½œæ˜¯ä»¥chunkä¸ºå•ä½çš„ï¼Œæ¯ä¸€ä¸ªchunkæ‰§è¡Œä¸€æ¬¡mmapæŠŠè¿™ä¸ªchunkçš„å†…å®¹æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ã€‚ä¸ºä»€ä¹ˆè¦å¤šä¸€å±‚chunkå‘¢ï¼ŒæŒ‰æˆ‘çš„ç†è§£ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†çµæ´»æ§åˆ¶mmapçš„å¤§å°å’Œè°ƒç”¨æ¬¡æ•°ï¼Œè‹¥å¯¹æ•´ä¸ªImageTableæ‰§è¡Œmmapï¼Œè½½å…¥è™šæ‹Ÿå†…å­˜çš„æ–‡ä»¶è¿‡å¤§ï¼Œè‹¥å¯¹æ¯ä¸ªEntryåšmmapï¼Œè°ƒç”¨æ¬¡æ•°ä¼šå¤ªå¤šã€‚</li>
</ul>
<h3 id="ç¼“å­˜ç®¡ç†"><a href="#ç¼“å­˜ç®¡ç†" class="headerlink" title="ç¼“å­˜ç®¡ç†"></a>ç¼“å­˜ç®¡ç†</h3><ul>
<li>ç”¨æˆ·å¯ä»¥å®šä¹‰æ•´ä¸ªImageTableé‡Œæœ€å¤§ç¼“å­˜çš„å›¾åƒæ•°é‡ï¼Œåœ¨æœ‰æ–°å›¾åƒéœ€è¦ç¼“å­˜æ—¶ï¼Œå¦‚æœç¼“å­˜æ²¡æœ‰è¶…è¿‡é™åˆ¶ï¼Œä¼šä»¥chunkä¸ºå•ä½æ‰©å±•æ–‡ä»¶å¤§å°ï¼Œé¡ºåºå†™ä¸‹å»ã€‚å¦‚æœå·²è¶…è¿‡æœ€å¤§ç¼“å­˜é™åˆ¶ï¼Œä¼šæŠŠæœ€å°‘ä½¿ç”¨çš„ç¼“å­˜æ›¿æ¢æ‰ï¼Œå®ç°æ–¹æ³•æ˜¯æ¯æ¬¡ä½¿ç”¨å›¾åƒéƒ½ä¼šæŠŠUUIDæ’å…¥åˆ°MRUEntriesæ•°ç»„çš„å¼€å¤´ï¼ŒMRUEntriesæŒ‰æœ€è¿‘ä½¿ç”¨é¡ºåºæ’åˆ—äº†å›¾åƒUUIDï¼Œæ•°ç»„é‡Œæœ€åä¸€ä¸ªå›¾åƒå°±æ˜¯æœ€å°‘ä½¿ç”¨çš„ã€‚è¢«æ›¿æ¢æ‰çš„å›¾ç‰‡ä¸‹æ¬¡éœ€è¦å†ä½¿ç”¨æ—¶ï¼Œå†èµ°ä¸€æ¬¡å–åŸå›¾â€”è§£å‹â€”å­˜å‚¨çš„æµç¨‹ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>FastImageCacheé€‚åˆç”¨äºtableViewé‡Œç¼“å­˜æ¯ä¸ªcellä¸ŠåŒæ ·è§„æ ¼çš„å›¾åƒï¼Œä¼˜ç‚¹æ˜¯èƒ½æå¤§åŠ å¿«ç¬¬ä¸€æ¬¡ä»ç£ç›˜åŠ è½½è¿™äº›å›¾åƒçš„é€Ÿåº¦ã€‚ä½†å®ƒæœ‰ä¸¤ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼šä¸€æ˜¯å ç©ºé—´å¤§ã€‚å› ä¸ºç¼“å­˜äº†è§£ç åçš„ä½å›¾åˆ°ç£ç›˜ï¼Œä½å›¾æ˜¯å¾ˆå¤§çš„ï¼Œå®½é«˜100<em>100çš„å›¾åƒåœ¨2xçš„é«˜æ¸…å±è®¾å¤‡ä¸‹å°±éœ€è¦200</em>200*4byte/pixel=156KBï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆFastImageCacheè¦å¤§è´¹å‘¨ç« é™åˆ¶ç¼“å­˜å¤§å°ã€‚äºŒæ˜¯æ¥å£ä¸å‹å¥½ï¼Œéœ€é¢„å®šä¹‰å¥½ç¼“å­˜çš„å›¾åƒå°ºå¯¸ã€‚FastImageCacheæ— æ³•åƒSDWebImageé‚£æ ·æ— ç¼æ¥å…¥UIImageViewï¼Œä½¿ç”¨å®ƒéœ€è¦é…ç½®ImageTableï¼Œå®šä¹‰å¥½å°ºå¯¸ï¼Œæ‰‹åŠ¨æä¾›çš„åŸå›¾ï¼Œæ¯ç§å®ä½“å›¾åƒè¦å®šä¹‰ä¸€ä¸ªFICEntityæ¨¡å‹ï¼Œä½¿é€»è¾‘å˜å¤æ‚ã€‚</p>
<p>FastImageCacheå·²ç»å±äºæé™ä¼˜åŒ–ï¼Œåšå›¾åƒåŠ è½½/æ¸²æŸ“ä¼˜åŒ–æ—¶åº”è¯¥ä¼˜å…ˆè€ƒè™‘ä¸€äº›ä½ä»£ä»·é«˜å›æŠ¥çš„ä¼˜åŒ–ç‚¹ï¼Œä¾‹å¦‚CALayerä»£æ›¿UIImageVIewï¼Œå‡å°‘GPUè®¡ç®—ï¼ˆå»é€æ˜/åƒç´ å¯¹é½ï¼‰ï¼Œå›¾åƒå­çº¿ç¨‹è§£ç ï¼Œé¿å…Offscreen-Renderç­‰ã€‚åœ¨å…¶ä»–ä¼˜åŒ–éƒ½åšåˆ°ä½ï¼Œå›¾åƒçš„æ¸²æŸ“è¿˜æ˜¯æœ‰æ€§èƒ½é—®é¢˜çš„å‰æä¸‹æ‰è€ƒè™‘ä½¿ç”¨FastImageCacheè¿›ä¸€æ­¥æå‡é¦–æ¬¡åŠ è½½çš„æ€§èƒ½ï¼Œä¸è¿‡å­—èŠ‚å¯¹é½çš„ä¼˜åŒ–å€’æ˜¯å¯ä»¥è„±ç¦»FastImageCacheç›´æ¥è¿ç”¨åœ¨é¡¹ç›®ä¸Šï¼Œåªéœ€è¦åœ¨è§£ç å›¾åƒæ—¶bitmapç”»å¸ƒçš„bytesPerRowè®¾ä¸º64çš„å€æ•°å³å¯ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>FastImageCache</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Œè½¬ã€ä¸€å¼ æ€ç»´å¯¼å›¾ï¼Œè®©æ­£åˆ™è¡¨è¾¾å¼ä¸å†éš¾æ‡‚</title>
    <url>/post/reprinted-regular-mind-map/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><img src="/images/bruch-up-regular-expressions-1.png" alt="æ€ç»´å¯¼å›¾"></p>
<a id="more"></a>

<h2 id="å­—ç¬¦"><a href="#å­—ç¬¦" class="headerlink" title="å­—ç¬¦"></a>å­—ç¬¦</h2><ul>
<li><p>æ™®é€šå­—ç¬¦ï¼šå­—æ¯ã€æ•°å­—ã€æ±‰å­—ã€ä¸‹åˆ’çº¿ï¼ŒåŒ¹é…ä¸ä¹‹ç›¸åŒçš„ä¸€ä¸ªå­—ç¬¦</p>
</li>
<li><p>ç®€å•è½¬ä¹‰å­—ç¬¦ï¼š\nï¼ˆæ¢è¡Œï¼‰,\tï¼ˆåˆ¶è¡¨ï¼‰,\ï¼ˆ\æœ¬èº«ï¼‰å’Œ ^â€¦ï¼ˆ^ç­‰æœ‰ç‰¹æ®Šä½œç”¨çš„ç¬¦å·å¦‚è¦åŒ¹é…è‡ªå·±çš„è¯è¦ç”¨è½¬ä¹‰ï¼‰</p>
</li>
<li><p>æ ‡å‡†å­—ç¬¦é›†åˆ<br>æ³¨æ„åŒºåˆ†å¤§å°å†™ï¼Œå¤§å†™æ˜¯ç›¸åçš„æ„æ€ï¼ŒåŒ¹é…ç›¸åæ˜¯ä¸åŒ¹é…</p>
<ul>
<li>\d<br>  ä»»æ„ä¸€ä¸ªæ•°å­—ï¼Œ0~9</li>
<li>\w<br>  ä»»æ„ä¸€ä¸ªå­—æ¯ã€æ•°å­—ã€æ±‰å­—æˆ–ä¸‹åˆ’çº¿ï¼ŒA<del>Zã€a</del>zã€0~9ã€_å’Œä»»æ„ä¸€ä¸ªæ±‰å­—</li>
<li>\s<br>  ä»»æ„ç©ºç™½ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦</li>
<li>.<br>  å°æ•°ç‚¹å¯ä»¥åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œæ¢è¡Œé™¤å¤–ï¼ˆå¦‚æœè¦åŒ¹é…åŒ…æ‹¬â€\nâ€åœ¨å†…çš„æ‰€æœ‰å­—ç¬¦ï¼Œä¸€èˆ¬ç”¨[\s\S]ï¼‰</li>
</ul>
</li>
<li><p>è‡ªå®šä¹‰å­—ç¬¦é›†åˆ<br>[ ]æ–¹æ‹¬å·åŒ¹é…æ–¹å¼ï¼Œèƒ½å¤ŸåŒ¹é…æ–¹æ‹¬å·ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦,^è¡¨ç¤ºå–å</p>
<ul>
<li>[ab5@]<br>  åŒ¹é…â€aâ€æˆ–â€bâ€æˆ–â€5â€æˆ–â€@â€</li>
<li>[^abc]<br>  åŒ¹é…aã€bã€cä¹‹å¤–çš„ä»»æ„å­—ç¬¦</li>
<li>[f-k]<br>  åŒ¹é…â€œfâ€åˆ°â€kâ€ä¹‹é—´çš„å­—ç¬¦</li>
<li>[^A-F0-3]<br>  åŒ¹é…â€œAâ€-â€œFâ€,â€0â€-â€œ3â€ä¹‹å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦</li>
</ul>
</li>
</ul>
<h2 id="é‡è¯-Quantifier"><a href="#é‡è¯-Quantifier" class="headerlink" title="é‡è¯(Quantifier)"></a>é‡è¯(Quantifier)</h2><p>ä¿®é¥°å‰é¢çš„ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¦‚æœè¦ä¿®é¥°å¤šä¸ªè¡¨è¾¾å¼ï¼Œå°±ç”¨( )æŠŠè¡¨è¾¾å¼åŒ…èµ·æ¥</p>
<ul>
<li>{n}<br>  è¡¨è¾¾å¼é‡å¤næ¬¡â€‹</li>
<li>{m,n}<br>  è¡¨è¾¾å¼è‡³å°‘é‡å¤mæ¬¡ï¼Œæœ€å¤šé‡å¤næ¬¡<ul>
<li>è´ªå©ªæ¨¡å¼ ï¼ˆé»˜è®¤ï¼‰<br>åŒ¹é…ç¬¦åˆçš„æœ€é•¿çš„å­—ç¬¦ä¸²</li>
<li>éè´ªå©ªæ¨¡å¼ ï¼ˆåœ¨é‡è¯åé¢åŠ  ? ä¾‹ï¼š{m,n}? )<br>  åŒ¹é…ç¬¦åˆçš„æœ€çŸ­çš„å­—ç¬¦ä¸²</li>
</ul>
</li>
<li>{m,}<br>  è¡¨è¾¾å¼è‡³å°‘é‡å¤mæ¬¡</li>
<li>ï¼Ÿ<br>  åŒ¹é…è¡¨è¾¾å¼0æˆ–1æ¬¡ï¼Œç›¸å½“äº{0,1}</li>
<li>+<br>  è¡¨è¾¾å¼è‡³å°‘å‡ºç°ä¸€æ¬¡ï¼Œç›¸å½“äº{1,}</li>
<li>*<br>  è¡¨è¾¾å¼ä¸å‡ºç°æˆ–å‡ºç°ä»»æ„æ¬¡ï¼Œç›¸å½“äº{0,}</li>
</ul>
<h2 id="å­—ç¬¦è¾¹ç•Œ"><a href="#å­—ç¬¦è¾¹ç•Œ" class="headerlink" title="å­—ç¬¦è¾¹ç•Œ"></a>å­—ç¬¦è¾¹ç•Œ</h2><pre><code>é›¶å®½ï¼šåŒ¹é…çš„ä¸æ˜¯å­—ç¬¦è€Œæ˜¯ä½ç½®ï¼Œç¬¦åˆæŸç§æ¡ä»¶çš„ä½ç½®</code></pre>
<ul>
<li>^<br>  ä¸å­—ç¬¦ä¸²å¼€å§‹çš„åœ°æ–¹åŒ¹é…</li>
<li>$<br>  ä¸å­—ç¬¦ä¸²ç»“æŸçš„åœ°æ–¹åŒ¹é…</li>
<li>\b<br>  åŒ¹é…ä¸€ä¸ªå•è¯çš„è¾¹ç•Œï¼Œå½“å‰ä½ç½®å‰é¢çš„å­—ç¬¦å’Œåé¢çš„å­—ç¬¦ä¸å…¨æ˜¯\w</li>
</ul>
<h2 id="é¢„æœç´¢ï¼ˆé›¶å®½æ–­è¨€ã€ç¯è§†ï¼‰"><a href="#é¢„æœç´¢ï¼ˆé›¶å®½æ–­è¨€ã€ç¯è§†ï¼‰" class="headerlink" title="é¢„æœç´¢ï¼ˆé›¶å®½æ–­è¨€ã€ç¯è§†ï¼‰"></a>é¢„æœç´¢ï¼ˆé›¶å®½æ–­è¨€ã€ç¯è§†ï¼‰</h2><p>é›¶å®½ï¼šåŒ¹é…çš„ä¸æ˜¯å­—ç¬¦è€Œæ˜¯ä½ç½®ï¼Œç¬¦åˆæŸç§æ¡ä»¶çš„ä½ç½®</p>
<ul>
<li>(?=exp)<br>  æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„åé¢èƒ½åŒ¹é…è¡¨è¾¾å¼exp</li>
<li>(?!exp)<br>  æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„åé¢ä¸èƒ½åŒ¹é…è¡¨è¾¾å¼exp</li>
<li>(?&lt;=exp)<br>  æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„å‰é¢èƒ½åŒ¹é…è¡¨è¾¾å¼exp</li>
<li>(?&lt;!exp)<br>  æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„å‰é¢ä¸èƒ½åŒ¹é…è¡¨è¾¾å¼exp</li>
</ul>
<h2 id="åŒ¹é…æ¨¡å¼"><a href="#åŒ¹é…æ¨¡å¼" class="headerlink" title="åŒ¹é…æ¨¡å¼"></a>åŒ¹é…æ¨¡å¼</h2><p>å¯¹æ–‡æœ¬çš„å¤„ç†æ–¹å¼</p>
<ul>
<li>IGNORECASE å¿½ç•¥å¤§å°å†™æ¨¡å¼<br>  åŒ¹é…æ—¶å¿½ç•¥å¤§å°å†™<br>  é»˜è®¤æ˜¯åŒºåˆ†å¤§å°å†™çš„</li>
<li>SINGLELINE å•è¡Œæ¨¡å¼<br>  æ•´ä¸ªæ–‡æœ¬çœ‹ä½œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåªæœ‰ä¸€ä¸ªå¼€å¤´ä¸€ä¸ªç»“å°¾<br>  ä½¿å°æ•°ç‚¹â€.â€å¯ä»¥åŒ¹é…åŒ…å«æ¢è¡Œç¬¦(\n)åœ¨å†…çš„ä»»æ„å­—ç¬¦</li>
<li>MULTILINE å¤šè¡Œæ¨¡å¼<br>  æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²<br>  åœ¨å¤šè¡Œæ¨¡å¼ä¸‹ï¼Œå¦‚æœéœ€è¦ä»…åŒ¹é…å­—ç¬¦ä¸²å¼€å§‹å’Œç»“æŸä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨\Aå’Œ\Z</li>
</ul>
<h2 id="é€‰æ‹©ç¬¦å’Œåˆ†ç»„"><a href="#é€‰æ‹©ç¬¦å’Œåˆ†ç»„" class="headerlink" title="é€‰æ‹©ç¬¦å’Œåˆ†ç»„"></a>é€‰æ‹©ç¬¦å’Œåˆ†ç»„</h2><p>åˆ†æ”¯ç»“æ„ã€æ•è·ç»„åˆéæ•è·ç»„</p>
<ul>
<li>| åˆ†æ”¯ç»“æ„â€‹<br>  å·¦å³è¡¨è¾¾å¼ä¹‹é—´â€œæˆ–â€å…³ç³»ï¼ŒåŒ¹é…å·¦è¾¹æˆ–å³è¾¹</li>
<li>( ) æ•è·ç»„<br>  ï¼ˆ1ï¼‰ã€åœ¨è¢«ä¿®é¥°åŒ¹é…æ¬¡æ•°çš„æ—¶å€™ï¼Œæ‹¬å·ä¸­çš„è¡¨è¾¾å¼å¯ä»¥ä½œä¸ºæ•´ä½“è¢«ä¿®é¥°<br>  ï¼ˆ2ï¼‰ã€å–åŒ¹é…ç»“æœçš„æ—¶å€™ï¼Œæ‹¬å·ä¸­çš„è¡¨è¾¾å¼åŒ¹é…åˆ°çš„å†…å®¹å¯ä»¥è¢«å•ç‹¬å¾—åˆ°<br>  ï¼ˆ3ï¼‰ã€æ¯ä¸€å¯¹æ‹¬å·ä¼šåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œä½¿ç”¨ï¼ˆï¼‰çš„æ•è·æ ¹æ®å·¦æ‹¬å·çš„é¡ºåºä»1å¼€å§‹è‡ªåŠ¨ç¼–å·ã€‚æ•è·ç¼–å·ä¸ºé›¶çš„ç¬¬ä¸€ä¸ªæ•è·æ˜¯æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…çš„æ–‡æœ¬<br>   åå‘å¼•ç”¨ï¼šé€šè¿‡åå‘å¼•ç”¨ï¼Œå¯ä»¥å¯¹åˆ†ç»„å·²æ•è·çš„å­—ç¬¦ä¸²è¿›è¡Œå¼•ç”¨ã€‚</li>
<li>(?:Expression) éæ•è·ç»„<br>  ä¸€äº›è¡¨è¾¾å¼ä¸­ï¼Œä¸å¾—ä¸ä½¿ç”¨ï¼ˆï¼‰ï¼Œä½†åˆä¸éœ€è¦ä¿å­˜ï¼ˆï¼‰ä¸­å­è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ï¼Œè¿™æ—¶å¯ä»¥ç”¨éæ•è·ç»„æ¥æŠµæ¶ˆï¼ˆï¼‰å¸¦æ¥çš„å‰¯ä½œç”¨ã€‚</li>
</ul>
<hr>
<p>åŸæ–‡ï¼š<a href="https://my.oschina.net/u/3080373/blog/1550653" target="_blank" rel="noopener">ä¸€å¼ æ€ç»´å¯¼å›¾ï¼Œè®©æ­£åˆ™è¡¨è¾¾å¼ä¸å†éš¾æ‡‚</a></p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>æ­£åˆ™è¡¨è¾¾å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Œè½¬ã€çœŸå®ä¸–ç•Œä¸­çš„ Swift æ€§èƒ½ä¼˜åŒ–</title>
    <url>/post/real-world-swift-performance/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://realm.io/cn/news/real-world-swift-performance/" target="_blank" rel="noopener">çœŸå®ä¸–ç•Œä¸­çš„ Swift æ€§èƒ½ä¼˜åŒ–</a></p>
<a id="more"></a>

<hr>
<p>æœ‰å¤ªå¤šçš„å› ç´ ä¼šå¯¼è‡´æ‚¨çš„åº”ç”¨å˜å¾—ç¼“æ…¢ã€‚åœ¨æœ¬æ¬¡è®²æ¼”ä¸­ï¼Œæˆ‘ä»¬å°†è‡ªåº•å‘ä¸Šåœ°æ¥æ¢ç´¢åº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–ã€‚æ¥çœ‹ä¸€çœ‹åœ¨çœŸå®ä¸–ç•Œä¸­è¿›è¡Œæ•°æ®è§£æã€æ•°æ®æ˜ å°„å’Œæ•°æ®å­˜å‚¨çš„æ—¶å€™ï¼ŒSwift çš„ç‰¹æ€§ï¼ˆåè®®ã€æ³›å‹ã€ç»“æ„ä½“å’Œç±»ï¼‰æ˜¯å¦‚ä½•å½±å“åº”ç”¨æ€§èƒ½çš„ï¼Œæˆ‘ä»¬å°†ç¡®å®šå½±å“æ€§èƒ½æå‡çš„ç“¶é¢ˆæ‰€åœ¨ï¼Œå¹¶ä½“éªŒ Swift å¸¦æ¥çš„ã€Œè¿…æ·ã€ä½“éªŒã€‚</p>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>ä»Šå¤©æˆ‘æ‰“ç®—åŒå¤§å®¶è°ˆè®º Swift æ€§èƒ½ä¼˜åŒ–æ–¹é¢çš„å†…å®¹ã€‚å½“æˆ‘ä»¬æ„å»ºè½¯ä»¶çš„æ—¶å€™ï¼Œç‰¹åˆ«æ˜¯ç§»åŠ¨è½¯ä»¶ï¼Œç”±äºäººä»¬çš„ç²¾åŠ›ã€æ—¶é—´æœ‰é™ï¼Œäººä»¬å¾€å¾€æ›´å–œæ¬¢æœ‰ä¸€ä¸ªæµç•…çš„ç”¨æˆ·ä½“éªŒï¼Œè€Œä¸æ˜¯ç­‰ç€æ‚¨çš„åº”ç”¨åœ¨é‚£åŠ è½½ã€‚å¦‚æœåº”ç”¨è¿è¡Œé€Ÿåº¦è¿‡æ…¢ï¼Œå¹¶ä¸”ä¸èƒ½ç»™ç”¨æˆ·å¸¦æ¥ä»–ä»¬æ‰€æƒ³è¦çš„ç»“æœçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¼šè®©äººä»¬æ„Ÿåˆ°ä¸çˆ½ã€‚å› æ­¤ï¼Œè®©æ‚¨çš„ä»£ç èƒ½å¤Ÿå¿«é€Ÿè¿è¡Œæ˜¯æ— æ¯”é‡è¦çš„ä¸€ä»¶äº‹ã€‚</p>
<p>é‚£ä¹ˆæœ‰ä»€ä¹ˆå› ç´ ä¼šå¯¼è‡´ä»£ç è¿è¡Œç¼“æ…¢å‘¢ï¼Ÿå½“æ‚¨åœ¨ç¼–å†™ä»£ç å¹¶é€‰æ‹©æ¶æ„çš„æ—¶å€™ï¼Œæ·±åˆ»è®¤è¯†åˆ°è¿™äº›æ¶æ„æ‰€å¸¦æ¥çš„å½±å“æ˜¯éå¸¸é‡è¦çš„ã€‚æˆ‘å°†é¦–å…ˆè°ˆä¸€è°ˆï¼šå¦‚ä½•ç†è§£å†…è”ã€åŠ¨æ€è°ƒåº¦ä¸é™æ€è°ƒåº¦ä¹‹é—´çš„æƒè¡¡ï¼Œä»¥åŠç›¸å…³ç»“æ„æ˜¯å¦‚ä½•åˆ†é…å†…å­˜çš„ï¼Œè¿˜æœ‰æ€æ ·é€‰æ‹©æœ€é€‚åˆçš„æ¶æ„ã€‚</p>
<h2 id="å†…å­˜åˆ†é…"><a href="#å†…å­˜åˆ†é…" class="headerlink" title="å†…å­˜åˆ†é…"></a>å†…å­˜åˆ†é…</h2><p>å¯¹è±¡çš„å†…å­˜åˆ†é… (allocation) å’Œå†…å­˜é‡Šæ”¾ (deallocation) æ˜¯ä»£ç ä¸­æœ€å¤§çš„å¼€é”€ä¹‹ä¸€ï¼ŒåŒæ—¶é€šå¸¸ä¹Ÿæ˜¯ä¸å¯é¿å…çš„ã€‚Swift ä¼šè‡ªè¡Œåˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼Œæ­¤å¤–å®ƒå­˜åœ¨ä¸¤ç§ç±»å‹çš„åˆ†é…æ–¹å¼ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯åŸºäºæ ˆ (stack-based) çš„å†…å­˜åˆ†é…ã€‚Swift ä¼šå°½å¯èƒ½é€‰æ‹©åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ã€‚æ ˆæ˜¯ä¸€ç§éå¸¸ç®€å•çš„æ•°æ®ç»“æ„ï¼›æ•°æ®ä»æ ˆçš„åº•éƒ¨æ¨å…¥ (push)ï¼Œä»æ ˆçš„é¡¶éƒ¨å¼¹å‡º (pop)ã€‚ç”±äºæˆ‘ä»¬åªèƒ½å¤Ÿä¿®æ”¹æ ˆçš„æœ«ç«¯ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘æ ˆæœ«ç«¯çš„æŒ‡é’ˆæ¥å®ç°è¿™ç§æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”åœ¨å…¶ä¸­è¿›è¡Œå†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾åªéœ€è¦é‡æ–°åˆ†é…è¯¥æ•´æ•°å³å¯ã€‚</p>
<p>ç¬¬äºŒä¸ªæ˜¯åŸºäºå † (heap-based) çš„å†…å­˜åˆ†é…ã€‚è¿™ä½¿å¾—å†…å­˜åˆ†é…å°†å…·å¤‡æ›´åŠ åŠ¨æ€çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†æ˜¯è¿™éœ€è¦æ›´ä¸ºå¤æ‚çš„æ•°æ®ç»“æ„ã€‚è¦åœ¨å †ä¸Šè¿›è¡Œå†…å­˜åˆ†é…çš„è¯ï¼Œæ‚¨éœ€è¦é”å®šå †å½“ä¸­çš„ä¸€ä¸ªç©ºé—²å— (free block)ï¼Œå…¶å¤§å°èƒ½å¤Ÿå®¹çº³æ‚¨çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœªä½¿ç”¨çš„å—ï¼Œç„¶ååœ¨å…¶ä¸­åˆ†é…å†…å­˜ã€‚å½“æˆ‘ä»¬éœ€è¦é‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¿…é¡»æœç´¢ä½•å¤„èƒ½å¤Ÿé‡æ–°æ’å…¥è¯¥å†…å­˜å—ã€‚è¿™ä¸ªæ“ä½œå¾ˆç¼“æ…¢ã€‚ä¸»è¦æ˜¯ä¸ºäº†çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬å¿…é¡»è¦å¯¹è¿™äº›ä¸œè¥¿è¿›è¡Œé”å®šå’ŒåŒæ­¥ã€‚</p>
<h2 id="å¼•ç”¨è®¡æ•°"><a href="#å¼•ç”¨è®¡æ•°" class="headerlink" title="å¼•ç”¨è®¡æ•°"></a>å¼•ç”¨è®¡æ•°</h2><p>æˆ‘ä»¬è¿˜æœ‰å¼•ç”¨è®¡æ•° (reference counting) çš„æ¦‚å¿µï¼Œè¿™ä¸ªæ“ä½œç›¸å¯¹ä¸æ€ä¹ˆè€—è´¹æ€§èƒ½ï¼Œä½†æ˜¯ç”±äºä½¿ç”¨æ¬¡æ•°å¾ˆå¤šï¼Œå› æ­¤å®ƒå¸¦æ¥çš„æ€§èƒ½å½±å“ä»ç„¶æ˜¯å¾ˆå¤§çš„ã€‚å¼•ç”¨è®¡æ•°æ˜¯ Objective-C å’Œ Swift ä¸­ç”¨äºç¡®å®šä½•æ—¶è¯¥é‡Šæ”¾å¯¹è±¡çš„å®‰å…¨æœºåˆ¶ã€‚ç›®å‰ï¼ŒSwift å½“ä¸­çš„å¼•ç”¨è®¡æ•°æ˜¯å¼ºåˆ¶è‡ªåŠ¨ç®¡ç†çš„ï¼Œè¿™æ„å‘³ç€å®ƒå¾ˆå®¹æ˜“è¢«å¼€å‘è€…ä»¬æ‰€å¿½ç•¥ã€‚ç„¶è€Œï¼Œå½“æ‚¨æ‰“å¼€ Instrument æŸ¥çœ‹ä½•å¤„å½±å“äº†ä»£ç è¿è¡Œçš„é€Ÿåº¦çš„æ—¶å€™ï¼Œæ‚¨ä¼šå‘ç° 20,000 å¤šæ¬¡çš„ Swift æŒæœ‰ (retain) å’Œé‡Šæ”¾ (release)ï¼Œè¿™äº›æ“ä½œå ç”¨äº† 90% çš„ä»£ç è¿è¡Œæ—¶é—´ï¼</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">perform</span><span class="params">(with object: Object)</span></span> &#123;</span><br><span class="line">    object.doAThing()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºå¦‚æœæœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°æ¥æ”¶äº†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”æ‰§è¡Œäº†è¿™ä¸ªå¯¹è±¡çš„ doAThing() æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ’å…¥å¯¹è±¡æŒæœ‰å’Œé‡Šæ”¾æ“ä½œï¼Œä»¥ç¡®ä¿åœ¨è¿™ä¸ªæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸå½“ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä¼šè¢«å›æ”¶æ‰ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">perform</span><span class="params">(with object: Object)</span></span> &#123;</span><br><span class="line">    __swift_retain(object)</span><br><span class="line">    object.doAThing()</span><br><span class="line">    __swift_release(object)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™äº›å¯¹è±¡æŒæœ‰å’Œé‡Šæ”¾æ“ä½œæ˜¯åŸå­æ“ä½œ (atomic operations)ï¼Œæ‰€ä»¥å®ƒä»¬è¿è½¬ç¼“æ…¢å°±å¾ˆæ­£å¸¸äº†ã€‚æˆ–è€…ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“å¦‚ä½•è®©å®ƒä»¬èƒ½å¤Ÿè¿è¡Œå¾—æ›´å¿«ä¸€äº›ã€‚</p>
<h2 id="è°ƒåº¦ä¸å¯¹è±¡"><a href="#è°ƒåº¦ä¸å¯¹è±¡" class="headerlink" title="è°ƒåº¦ä¸å¯¹è±¡"></a>è°ƒåº¦ä¸å¯¹è±¡</h2><p>æ­¤å¤–è¿˜æœ‰è°ƒåº¦ (dispatch) çš„æ¦‚å¿µã€‚Swift æ‹¥æœ‰ä¸‰ç§ç±»å‹çš„è°ƒåº¦æ–¹å¼ã€‚Swift ä¼šå°½å¯èƒ½å°†å‡½æ•°å†…è” (inline)ï¼Œè¿™æ ·çš„è¯ä½¿ç”¨è¿™ä¸ªå‡½æ•°å°†ä¸ä¼šæœ‰é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚é™æ€è°ƒåº¦ (static dispatch) æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ V-table è¿›è¡Œçš„æŸ¥æ‰¾å’Œè·³è½¬ï¼Œè¿™ä¸ªæ“ä½œä¼šèŠ±è´¹ä¸€çº³ç§’çš„æ—¶é—´ã€‚ç„¶ååŠ¨æ€è°ƒåº¦ (dynamic dispatch) å°†ä¼šèŠ±è´¹å¤§æ¦‚äº”çº³ç§’çš„æ—¶é—´ï¼Œå¦‚æœæ‚¨åªæœ‰å‡ ä¸ªè¿™æ ·çš„æ–¹æ³•è°ƒç”¨çš„è¯ï¼Œè¿™å®é™…ä¸Šå¹¶ä¸ä¼šå¸¦æ¥å¤šå¤§çš„é—®é¢˜ï¼Œé—®é¢˜æ˜¯å½“æ‚¨åœ¨ä¸€ä¸ªåµŒå¥—å¾ªç¯æˆ–è€…æ‰§è¡Œä¸Šåƒæ¬¡æ“ä½œå½“ä¸­ä½¿ç”¨äº†åŠ¨æ€è°ƒåº¦çš„è¯ï¼Œé‚£ä¹ˆå®ƒæ‰€å¸¦æ¥çš„æ€§èƒ½è€—è´¹å°†æˆç™¾ä¸Šåƒåœ°ç´¯ç§¯èµ·æ¥ï¼Œæœ€ç»ˆå½±å“åº”ç”¨æ€§èƒ½ã€‚</p>
<p>Swift åŒæ ·ä¹Ÿæœ‰ä¸¤ç§ç±»å‹çš„å¯¹è±¡ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> section: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> item: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="type">Index</span>(section: <span class="number">1</span>,</span><br><span class="line">                item: <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªç±»ï¼Œç±»å½“ä¸­çš„æ•°æ®éƒ½ä¼šåœ¨å †ä¸Šåˆ†é…å†…å­˜ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º Index çš„ç±»ã€‚å…¶ä¸­åŒ…å«äº†ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ª section å’Œä¸€ä¸ª itemã€‚å½“æˆ‘ä»¬åˆ›å»ºäº†è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå †ä¸Šä¾¿åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘æ­¤ Index çš„æŒ‡é’ˆï¼Œå› æ­¤åœ¨å †ä¸Šä¾¿å­˜æ”¾äº†è¿™ä¸ª section å’Œ item çš„æ•°æ®å’Œç©ºé—´ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å¯¹å…¶å»ºç«‹å¼•ç”¨ï¼Œå°±ä¼šå‘ç°æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªæŒ‡å‘å †ä¸Šç›¸åŒåŒºåŸŸçš„æŒ‡é’ˆäº†ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯å…±äº«å†…å­˜çš„ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> section: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> item: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="type">Index</span>(section: <span class="number">1</span>,</span><br><span class="line">                item: <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i2 = i</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™ï¼ŒSwift ä¼šè‡ªåŠ¨æ’å…¥å¯¹è±¡æŒæœ‰æ“ä½œã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> section: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> item: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="type">Index</span>(section: <span class="number">1</span>,</span><br><span class="line">                item: <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">__swift_retain(i)</span><br><span class="line"><span class="keyword">let</span> i2 = i</span><br></pre></td></tr></table></figure>
<h2 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h2><p>å¾ˆå¤šäººéƒ½ä¼šè¯´ï¼šè¦ç¼–å†™æ€§èƒ½ä¼˜å¼‚çš„ Swift ä»£ç ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ç»“æ„ä½“äº†ï¼Œç»“æ„ä½“é€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»“æ„ï¼Œå› ä¸ºç»“æ„ä½“ä¼šå­˜å‚¨åœ¨æ ˆä¸Šï¼Œå¹¶ä¸”é€šå¸¸ä¼šä½¿ç”¨é™æ€è°ƒåº¦æˆ–è€…å†…è”è°ƒåº¦ã€‚</p>
<p>å­˜å‚¨åœ¨æ ˆä¸Šçš„ Swift ç»“æ„ä½“å°†å ç”¨ä¸‰ä¸ª Word å¤§å°ã€‚å¦‚æœæ‚¨çš„ç»“æ„ä½“å½“ä¸­çš„æ•°æ®æ•°é‡ä½äºä¸‰ç§çš„è¯ï¼Œé‚£ä¹ˆç»“æ„ä½“çš„å€¼ä¼šè‡ªåŠ¨åœ¨æ ˆä¸Šå†…è”ã€‚Word æ˜¯ CPU å½“ä¸­å†…ç½®æ•´æ•°çš„å¤§å°ï¼Œå®ƒæ˜¯ CPU æ‰€å·¥ä½œçš„åŒºå—ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> section: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> item: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="type">Index</span>(section: <span class="number">1</span>, item: <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œæ‚¨å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªç»“æ„ä½“çš„æ—¶å€™ï¼Œå¸¦æœ‰ section å’Œ item å€¼å¾— Index ç»“æ„ä½“å°†ä¼šç›´æ¥ä¸‹æ”¾åˆ°æ ˆå½“ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ä¸ä¼šæœ‰é¢å¤–çš„å†…å­˜åˆ†é…å‘ç”Ÿã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬åœ¨åˆ«å¤„å°†å…¶èµ‹å€¼åˆ°å¦ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> section: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> item: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="type">Index</span>(section: <span class="number">1</span>, item: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> i2 = i</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬å°† i èµ‹ç»™ i2ï¼Œè¿™ä¼šå°†æˆ‘ä»¬å­˜å‚¨åœ¨æ ˆå½“ä¸­çš„å€¼ç›´æ¥å†æ¬¡å¤åˆ¶ä¸€éï¼Œè¿™ä¸ªæ—¶å€™å¹¶ä¸ä¼šå‡ºç°å¼•ç”¨çš„æƒ…å†µã€‚è¿™å°±æ˜¯æ‰€è°“çš„ã€Œå€¼ç±»å‹ã€ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœç»“æ„ä½“å½“ä¸­å­˜æ”¾äº†å¼•ç”¨ç±»å‹çš„è¯åˆä¼šæ€æ ·å‘¢ï¼ŸæŒæœ‰å†…è”æŒ‡é’ˆçš„ç»“æ„ä½“ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> u = <span class="type">User</span>(name: <span class="string">"Joe"</span>, id: <span class="string">"1234"</span>)</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬å°†å…¶èµ‹å€¼ç»™åˆ«çš„å˜é‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æŒæœ‰äº†å…±äº«ä¸¤ä¸ªç»“æ„ä½“çš„ç›¸åŒæŒ‡é’ˆï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¦å¯¹è¿™ä¸¤ä¸ªæŒ‡é’ˆè¿›è¡ŒæŒæœ‰æ“ä½œï¼Œè€Œä¸æ˜¯åœ¨å¯¹è±¡ä¸Šæ‰§è¡Œå•ç‹¬çš„æŒæœ‰æ“ä½œã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> u = <span class="type">User</span>(name: <span class="string">"Joe"</span>,</span><br><span class="line">             id: <span class="string">"1234"</span>)</span><br><span class="line">__swift_retain(u.name._textStorage)</span><br><span class="line">__swift_retain(u.id._textStorage)</span><br><span class="line"><span class="keyword">let</span> u2 = u</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå…¶ä¸­åŒ…å«äº†ç±»çš„è¯ï¼Œé‚£ä¹ˆæ€§èƒ½è€—è´¹ä¼šæ›´å¤§ã€‚</p>
<h2 id="æŠ½è±¡ç±»å‹"><a href="#æŠ½è±¡ç±»å‹" class="headerlink" title="æŠ½è±¡ç±»å‹"></a>æŠ½è±¡ç±»å‹</h2><p>æ­£å¦‚æˆ‘ä»¬æ­¤å‰æ‰€è¿°ï¼ŒSwift æä¾›äº†è®¸å¤šä¸åŒçš„æŠ½è±¡ç±»å‹ (abstraction)ï¼Œä»è€Œå…è®¸æˆ‘ä»¬è‡ªè¡Œå†³å®šä»£ç è¯¥å¦‚ä½•è¿è¡Œï¼Œä»¥åŠå†³å®šä»£ç çš„æ€§èƒ½ç‰¹æ€§ã€‚ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹æŠ½è±¡ç±»å‹æ˜¯å¦‚ä½•åœ¨å®é™…ç¯å¢ƒå½“ä¸­ä½¿ç”¨çš„ã€‚è¿™é‡Œæœ‰ä¸€æ®µå¾ˆç®€å•çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> radius: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">let</span> center: <span class="type">Point</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">draw</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> circles = (<span class="number">1</span>..&lt;<span class="number">100_000_000</span>).<span class="built_in">map</span> &#123; <span class="number">_</span> <span class="keyword">in</span> <span class="type">Circle</span>(...) &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> circle <span class="keyword">in</span> circles &#123;</span><br><span class="line">    circle.draw()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå¸¦æœ‰ radius å’Œ center å±æ€§çš„ Circle ç»“æ„ä½“ã€‚å®ƒå°†å ç”¨ä¸‰ä¸ª Word å¤§å°çš„ç©ºé—´ï¼Œå¹¶å­˜å‚¨åœ¨æ ˆä¸Šã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€äº¿ä¸ª Circleï¼Œç„¶åæˆ‘ä»¬éå†è¿™äº› Circle å¹¶è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚åœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œè¿™æ®µæ“ä½œåœ¨å‘å¸ƒæ¨¡å¼ä¸‹è€—è´¹äº† 0.3 ç§’çš„æ—¶é—´ã€‚é‚£ä¹ˆå½“éœ€æ±‚å‘ç”Ÿå˜æ›´çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬ä¸ä»…éœ€è¦ç»˜åœ†ï¼Œè¿˜éœ€è¦èƒ½å¤Ÿå¤„ç†å¤šç§ç±»å‹çš„å½¢çŠ¶ã€‚è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬è¿˜éœ€è¦ç»˜çº¿ã€‚æˆ‘éå¸¸å–œæ¬¢é¢å‘åè®®ç¼–ç¨‹ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘åœ¨ä¸ä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µä¸‹å®ç°å¤šæ€æ€§ï¼Œå¹¶ä¸”å®ƒå…è®¸æˆ‘ä»¬åªéœ€è¦è€ƒè™‘è¿™ä¸ªã€ŒæŠ½è±¡ç±»å‹ã€å³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">protocol Drawable &#123;</span><br><span class="line">    func draw()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Circle: Drawable &#123;</span><br><span class="line">    let radius: Double</span><br><span class="line">    let center: Point</span><br><span class="line">    func draw() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let drawables: [Drawable] &#x3D; (1..&lt;100_000_000).map &#123; _ in Circle(...) &#125;</span><br><span class="line"></span><br><span class="line">for drawable in drawables &#123;</span><br><span class="line">    drawable.draw()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬éœ€è¦åšçš„ï¼Œå°±æ˜¯å°†è¿™ä¸ª draw æ–¹æ³•æå–åˆ°åè®®å½“ä¸­ï¼Œç„¶åå°†æ•°ç»„çš„å¼•ç”¨ç±»å‹å˜æ›´ä¸ºè¿™ä¸ªåè®®ï¼Œè¿™æ ·åšå¯¼è‡´è¿™æ®µä»£ç èŠ±è´¹äº† 4.0 ç§’çš„æ—¶é—´æ¥è¿è¡Œã€‚é€Ÿç‡å‡æ…¢äº† 1300%ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>è¿™æ˜¯å› ä¸ºæ­¤å‰çš„ä»£ç å¯ä»¥è¢«é™æ€è°ƒåº¦ï¼Œä»è€Œåœ¨æ²¡æœ‰ä»»ä½•å †åº”ç”¨å»ºç«‹çš„æƒ…å†µä¸‹ä»èƒ½å¤Ÿæ‰§è¡Œã€‚è¿™å°±æ˜¯åè®®æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚å¤§å®¶æ‰€è§ï¼Œè¿™é‡Œæ˜¯æˆ‘ä»¬æ­¤å‰çš„ Circle ç»“æ„ä½“ã€‚åœ¨è¿™ä¸ª for å¾ªç¯å½“ä¸­ï¼ŒSwift ç¼–è¯‘å™¨æ‰€åšçš„å°±æ˜¯å‰å¾€ V-table è¿›è¡ŒæŸ¥æ‰¾ï¼Œæˆ–è€…ç›´æ¥å°† draw å‡½æ•°å†…è”ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">struct Circle &#123;</span><br><span class="line">    let radius: Double</span><br><span class="line">    let center: Point</span><br><span class="line">    func draw() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var circles &#x3D; (1..&lt;100_000_000).map &#123; _ in Circle(...) &#125;</span><br><span class="line"></span><br><span class="line">for circle in circles &#123;</span><br><span class="line">    circle.draw()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬ç”¨åè®®æ¥æ›¿ä»£çš„æ—¶å€™ï¼Œæ­¤æ—¶å®ƒå¹¶ä¸çŸ¥é“è¿™ä¸ªå¯¹è±¡æ˜¯ç»“æ„ä½“è¿˜æ˜¯ç±»ã€‚å› ä¸ºè¿™é‡Œå¯èƒ½æ˜¯ä»»ä½•ä¸€ä¸ªå®ç°æ­¤åè®®çš„ç±»å‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">protocol Drawable &#123;</span><br><span class="line">    func draw()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Circle: Drawable &#123;</span><br><span class="line">    let radius: Double</span><br><span class="line">    let center: Point</span><br><span class="line"></span><br><span class="line">    func draw() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var drawables: [Drawable] &#x3D; (1..&lt;100_000_000).map &#123; _ in return Circle(...) &#125;</span><br><span class="line"></span><br><span class="line">for drawable in drawables &#123;</span><br><span class="line">    drawable.draw()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å»è°ƒåº¦è¿™ä¸ª draw å‡½æ•°å‘¢ï¼Ÿç­”æ¡ˆå°±ä½äºåè®®è®°å½•è¡¨ (protocol witness tableï¼Œä¹Ÿç§°ä¸ºè™šå‡½æ•°è¡¨) å½“ä¸­ã€‚å®ƒå…¶ä¸­å­˜æ”¾äº†æ‚¨åº”ç”¨å½“ä¸­æ¯ä¸ªå®ç°åè®®çš„å¯¹è±¡åï¼Œå¹¶ä¸”åœ¨åº•å±‚å®ç°å½“ä¸­ï¼Œè¿™ä¸ªè¡¨æœ¬è´¨ä¸Šå……å½“äº†è¿™äº›ç±»å‹çš„åˆ«åã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">protocol Drawable &#123;</span><br><span class="line">    func draw()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Circle: Drawable &#123;</span><br><span class="line">    let radius: Double</span><br><span class="line">    let center: Point</span><br><span class="line"></span><br><span class="line">    func draw() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var drawables: [Drawable] &#x3D; (1..&lt;100_000_000).map &#123; _ in</span><br><span class="line">    return Circle(...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for drawable in drawables &#123;</span><br><span class="line">    drawable.draw()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œçš„ä»£ç å½“ä¸­ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è·å–åè®®è®°å½•è¡¨å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä»è¿™ä¸ªæ—¢æœ‰å®¹å™¨ (existential container) å½“ä¸­è·å–ï¼Œè¿™ä¸ªå®¹å™¨ç›®å‰æ‹¥æœ‰ä¸€ä¸ªä¸‰ä¸ªå­—å¤§å°çš„ç»“æ„ä½“ï¼Œå¹¶ä¸”å­˜æ”¾åœ¨å…¶å†…éƒ¨çš„å€¼ç¼“å†²åŒºå½“ä¸­ï¼Œæ­¤å¤–è¿˜ä¸åè®®è®°å½•è¡¨å»ºç«‹äº†å¼•ç”¨å…³ç³»ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">struct Circle: Drawable &#123;</span><br><span class="line">    let radius: Double</span><br><span class="line">    let center: Point</span><br><span class="line"></span><br><span class="line">    func draw() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ Circle ç±»å‹å­˜æ”¾åœ¨äº†ä¸‰ä¸ªå­—å¤§å°çš„ç¼“å†²åŒºå½“ä¸­ï¼Œå¹¶ä¸”ä¸ä¼šè¢«å•ç‹¬å¼•ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">struct Line: Drawable &#123;</span><br><span class="line">    let origin: Point</span><br><span class="line">    let end: Point</span><br><span class="line"></span><br><span class="line">    func draw() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºæˆ‘ä»¬çš„ Line ç±»å‹æ¥è¯´ï¼Œå®ƒå…¶ä¸­åŒ…å«äº†å››ä¸ªå­—çš„å­˜å‚¨ç©ºé—´ï¼Œå› ä¸ºå®ƒæ‹¥æœ‰ä¸¤ä¸ªç‚¹ç±»å‹ã€‚è¿™ä¸ª Line ç»“æ„ä½“éœ€è¦è¶…è¿‡å››ä¸ªå­—ä»¥ä¸Šçš„å­˜å‚¨ç©ºé—´ã€‚æˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†å®ƒå‘¢ï¼Ÿè¿™ä¼šå¯¹æ€§èƒ½æœ‰å½±å“ä¹ˆï¼Ÿå¥½å§ï¼Œå®ƒçš„ç¡®ä¼šï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">protocol Drawable &#123;</span><br><span class="line">    func draw()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Line: Drawable &#123;</span><br><span class="line">    let origin: Point</span><br><span class="line">    let end: Point</span><br><span class="line">    func draw() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let drawables: [Drawable] &#x3D; (1..&lt;100_000_000).map &#123; _ in Line(...) &#125;</span><br><span class="line"></span><br><span class="line">for drawable in drawables &#123;</span><br><span class="line">    drawable.draw()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™éœ€è¦èŠ±è´¹ 45 ç§’é’Ÿçš„æ—¶é—´æ¥è¿è¡Œã€‚ä¸ºä»€ä¹ˆè¿™é‡Œè¦èŠ±è¿™ä¹ˆä¹…çš„æ—¶é—´å‘¢ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆäº‹å‘¢ï¼Ÿ</p>
<p>ç»å¤§éƒ¨åˆ†çš„æ—¶é—´éƒ½èŠ±è´¹åœ¨å¯¹ç»“æ„ä½“è¿›è¡Œå†…å­˜åˆ†é…ä¸Šäº†ï¼Œå› ä¸ºç°åœ¨å®ƒä»¬æ— æ³•å­˜æ”¾åœ¨åªæœ‰ä¸‰ä¸ªå­—å¤§å°çš„ç¼“å†²åŒºå½“ä¸­äº†ã€‚å› æ­¤è¿™äº›ç»“æ„ä¼šåœ¨å †ä¸Šè¿›è¡Œå†…å­˜åˆ†é…ï¼Œæ­¤å¤–è¿™ä¹Ÿä¸åè®®æœ‰ä¸€ç‚¹å…³ç³»ã€‚ç”±äºæ—¢æœ‰å®¹å™¨åªèƒ½å¤Ÿå­˜å‚¨ä¸‰ä¸ªå­—å¤§å°çš„ç»“æ„ä½“ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä¸å¯¹è±¡å»ºç«‹å¼•ç”¨å…³ç³»ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦æŸç§åä¸ºå€¼è®°å½•è¡¨ (value witness table)ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ç”¨æ¥å¤„ç†ä»»æ„å€¼çš„ä¸œè¥¿ã€‚</p>
<p>å› æ­¤åœ¨è¿™é‡Œï¼Œç¼–è¯‘å™¨å°†åˆ›å»ºä¸€ä¸ªå€¼è®°å½•è¡¨ï¼Œå¯¹æ¯ä¸ªï¿½ï¿½ï¿½ç¼“å†²åŒºã€å†…æ•›ç»“æ„ä½“æ¥è¯´ï¼Œéƒ½æœ‰ä¸‰ä¸ªå­—å¤§å°çš„ç¼“å†²åŒºï¼Œç„¶åå®ƒå°†è´Ÿè´£å¯¹å€¼æˆ–è€…ç±»è¿›è¡Œå†…å­˜åˆ†é…ã€æ‹·è´ã€é”€æ¯å’Œå†…å­˜é‡Šæ”¾ç­‰æ“ä½œã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">func draw(drawable: Drawable) &#123;</span><br><span class="line">    drawable.draw()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let value: Drawable &#x3D; Line()</span><br><span class="line">draw(local: value)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Generates</span><br><span class="line">func draw(value: ECTDrawable) &#123;</span><br><span class="line">    var drawable: ECTDrawable &#x3D; ECTDrawable()</span><br><span class="line">    let vwt &#x3D; value.vwt</span><br><span class="line">    let pwt &#x3D; value.pwt</span><br><span class="line">    drawable.vwt &#x3D; value.vwt</span><br><span class="line">    drawable.pwt &#x3D; value.pwt</span><br><span class="line">    vwt.allocateBuffAndCopyValue(&amp;drawable, value)</span><br><span class="line">    pwt.draw(vwt.projectBuffer(&amp;drawable)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¿™å°±æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„ä¸­é—´äº§ç‰©ã€‚å¦‚æœæˆ‘ä»¬åªæœ‰ä¸€ä¸ª draw å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šæ¥å—æˆ‘ä»¬åˆ›å»ºçš„ Line ä½œä¸ºå‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬å°†å®ƒä¼ é€’ç»™è¿™ä¸ª draw å‡½æ•°å³å¯ã€‚</p>
<p>å®é™…æƒ…å†µæ—¶ï¼Œå®ƒå°†è¿™ä¸ª Drawable åè®®ä¼ é€’åˆ°æ—¢æœ‰å®¹å™¨å½“ä¸­ï¼Œç„¶ååœ¨å‡½æ•°å†…éƒ¨å†æ¬¡è¿›è¡Œåˆ›å»ºã€‚è¿™ä¼šå¯¹å€¼å’Œåè®®è®°å½•è¡¨è¿›è¡Œèµ‹å€¼ï¼Œç„¶ååˆ†é…ä¸€ä¸ªæ–°çš„ç¼“å†²åŒºï¼Œç„¶åå°†å…¶ä»–ç»“æ„ã€ç±»æˆ–è€…ç±»ä¼¼å¯¹è±¡çš„å€¼æ‹·è´è¿›è¿™ä¸ªç¼“å†²åŒºå½“ä¸­ã€‚ç„¶åå°±ä½¿ç”¨åè®®è®°å½•è¡¨å½“ä¸­çš„ draw å‡½æ•°ï¼ŒæŠŠçœŸå®çš„ Drable å¯¹è±¡ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°ã€‚</p>
<p>æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œå€¼è®°å½•è¡¨å’Œåè®®è®°å½•è¡¨å°†ä¼šå­˜æ”¾åœ¨æ ˆä¸Šï¼Œè€Œ Line å°†ä¼šè¢«å­˜æ”¾åœ¨å †ä¸Šï¼Œä»è€Œæœ€åå°†çº¿ç»˜åˆ¶å‡ºæ¥ã€‚</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å¯¹æˆ‘ä»¬è¿›è¡Œæ•°æ®å»ºæ¨¡çš„æ–¹å¼è¿›è¡Œç®€å•çš„æ›´æ”¹å°†ä¼šå¯¹æ€§èƒ½é€ æˆå·¨å¤§çš„å½±å“ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹è¯¥å¦‚ä½•æ¥é¿å…è¿™äº›æƒ…å†µçš„å‘ç”Ÿã€‚</p>
<p>é¦–å…ˆè®©æˆ‘ä»¬æ¥è¯´ä¸€è¯´æ³›å‹ã€‚å¤§å®¶å¯èƒ½ä¼šè¯´äº†ï¼Œæˆ‘ç»™å„ä½å±•ç¤ºäº†åè®®ä¼šå¯¼è‡´æ€§èƒ½çš„ä¸‹é™ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨æ³›å‹å‘¢ï¼Ÿç­”æ¡ˆåœ¨äºï¼šæ³›å‹å…è®¸æˆ‘ä»¬åšä»€ä¹ˆã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">struct Stack&lt;T: Type&gt; &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‡è®¾æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªå¸¦æœ‰æ³›å‹ T çš„ Stack ç»“æ„ä½“ï¼Œå®ƒå—åˆ°ä¸€ä¸ªåè®®ç±»å‹çš„çº¦æŸã€‚ç¼–è¯‘å™¨æ‰€è¦åšçš„ï¼Œå°±æ˜¯å°†è¿™ä¸ª T ææ¢æˆç›¸åº”çš„åè®®ï¼Œæˆ–è€…æ›¿æ¢ä¸ºæˆ‘ä»¬ä¼ å…¥çš„å…·ä½“ç±»å‹ã€‚è¿™äº›æ“ä½œä¼šä¸€ç›´æ²¿ç€å‡½æ•°é“¾ (function chain) æ‰§è¡Œï¼Œå¹¶ä¸”ç¼–è¯‘å™¨ä¼šåˆ›å»ºç›´æ¥å¯¹æ­¤ç±»å‹è¿›è¡Œæ“ä½œçš„ä¸“ç”¨ç‰ˆæœ¬ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±æ— éœ€å†ä½¿ç”¨å€¼è®°å½•è¡¨æˆ–è€…åè®®è®°å½•è¡¨äº†ï¼Œå¹¶ä¸”è¿˜ç§»é™¤äº†æ—¢æœ‰å®¹å™¨ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„è§£å†³æ–¹å¼ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿå†™å‡ºçœŸæ­£å¿«é€Ÿè¿è¡Œçš„æ³›å‹ä»£ç ï¼Œå¹¶ä¸”è¿˜å…·å¤‡ Swift æ‰€æä¾›çš„è‰¯å¥½å¤šæ€æ€§ã€‚è¿™å°±æ˜¯æ‰€è°“çš„é™æ€å¤šæ€æ€§ (static polymorphism)ã€‚</p>
<p>æ‚¨è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨æšä¸¾æ¥æ”¹è¿›æ•°æ®æ¨¡å‹ï¼Œè€Œä¸æ˜¯ä»æœåŠ¡å™¨ä¸­è·å–å¤§é‡çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æ­£åœ¨æ„å»ºä¸€ä¸ªç¤¾äº¤åº”ç”¨ï¼Œæ‚¨éœ€è¦å¯¹è´¦æˆ·å»ºç«‹çŠ¶æ€çš„ç®¡ç†ï¼Œä»¥å‰æ‚¨å¯èƒ½ä¼šä½¿ç”¨å­—ç¬¦ä¸²æ¥è¿›è¡Œæ§åˆ¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">enum AccountStatus: String, RawRepresentable &#123;</span><br><span class="line">case .banned, .verified, incomplete</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬æ”¹ç”¨æšä¸¾çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— éœ€è¿›è¡Œå†…å­˜åˆ†é…äº†ï¼Œå½“æˆ‘ä»¬ä¼ é€’è¿™ä¸ªç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªæ˜¯å°†æšä¸¾å€¼è¿›è¡Œä¼ é€’ï¼Œè¿™æ˜¯ä¸€ä¸ªåŠ å¿«ä»£ç è¿è¡Œé€Ÿåº¦çš„å¥½æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¸ºæ•´ä¸ªåº”ç”¨ç¨‹åºæä¾›æ›´å®‰å…¨ã€æ›´å¯è¯»çš„ä»£ç ã€‚</p>
<p>æ­¤å¤–ï¼Œä½¿ç”¨ u-æ¨¡å‹æˆ–è€…æ¼”ç¤ºè€… (Presenter) æˆ–è€…ä¸åŒçš„æŠ½è±¡ç±»å‹çš„å½¢å¼ï¼Œæ¥æ„å»ºç‰¹å®šç±»å‹çš„æ¨¡å‹ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿç²¾ç®€æ‰åº”ç”¨å½“ä¸­è®¸å¤šä¸å¿…è¦çš„éƒ¨åˆ†ã€‚</p>
<p>å¥½çš„ï¼Œæˆ‘çš„è®²æ¼”åˆ°æ­¤ç»“æŸï¼Œå†…å®¹å¾ˆçŸ­ï¼Œæ„Ÿè°¢è¯¸ä½çš„å‚ä¸ï¼</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSé€†å‘-monkeydevå·¥å…·</title>
    <url>/post/reverse-ios-monkeydev/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>MonkeyDev wiki<br>è¿™æ˜¯ä¸€ä¸ªä¸ºè¶Šç‹±å’Œéè¶Šç‹±å¼€å‘äººå‘˜å‡†å¤‡çš„å·¥å…·ï¼Œä¸»è¦åŒ…æ‹¬å››ä¸ªæ¨¡å—:</p>
</blockquote>
<blockquote>
<p> Logos Tweak</p>
</blockquote>
<blockquote>
<p>ä½¿ç”¨theosæä¾›çš„logify.plå·¥å…·å°†*.xmæ–‡ä»¶è½¬æˆ*.mmæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œé›†æˆäº†CydiaSubstrateï¼Œå¯ä»¥ä½¿ç”¨MSHookMessageExå’ŒMSHookFunctionæ¥Hook OCå‡½æ•°å’ŒæŒ‡å®šåœ°å€ã€‚</p>
</blockquote>
<blockquote>
<p>CaptainHook Tweak</p>
</blockquote>
<blockquote>
<p>ä½¿ç”¨CaptainHookæä¾›çš„å¤´æ–‡ä»¶è¿›è¡ŒOC å‡½æ•°çš„Hookï¼Œä»¥åŠå±æ€§çš„è·å–ã€‚</p>
</blockquote>
<blockquote>
<p>Command-line Tool</p>
</blockquote>
<blockquote>
<p>å¯ä»¥ç›´æ¥åˆ›å»ºè¿è¡Œäºè¶Šç‹±è®¾å¤‡çš„å‘½ä»¤è¡Œå·¥å…·</p>
</blockquote>
<blockquote>
<p>MonkeyApp</p>
</blockquote>
<blockquote>
<p>è¿™æ˜¯è‡ªåŠ¨ç»™ç¬¬ä¸‰æ–¹åº”ç”¨é›†æˆRevealã€Cycriptå’Œæ³¨å…¥dylibçš„æ¨¡å—ï¼Œæ”¯æŒè°ƒè¯•dylibå’Œç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæ”¯æŒPodç»™ç¬¬ä¸‰æ”¾åº”ç”¨é›†æˆSDKï¼Œåªéœ€è¦å‡†å¤‡ä¸€ä¸ªç ¸å£³åçš„ipaæˆ–è€…appæ–‡ä»¶å³å¯ã€‚</p>
</blockquote>
<a id="more"></a>


<hr>
<ul>
<li><a href="https://github.com/AloneMonkey/MonkeyDev/wiki" target="_blank" rel="noopener">MonkeyDev wiki</a></li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSé€†å‘-class-dumpå·¥å…·</title>
    <url>/post/reverse-ios-class-dump/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="å®‰è£…class-dump"><a href="#å®‰è£…class-dump" class="headerlink" title="å®‰è£…class-dump"></a>å®‰è£…class-dump</h2><p>å»<a href="http://stevenygard.com/projects/class-dump/" target="_blank" rel="noopener">stevenygard.com</a>ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚</p>
<p>å°†åŒ…ä¸­çš„<code>class-dump</code>å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°<code>/opt/class-dump</code>ã€‚(æˆ‘çš„é€†å‘ç›¸å…³å·¥å…·å‡åœ¨è¿™ä¸‹é¢ğŸ˜‚ï¼‰</p>
<p>åœ¨<code>~/.base_profile</code>ä¸­æ·»åŠ <code>export PATH=/opt/class-dump:$PATH</code></p>
<p>è¿è¡Œ<code>source ~/.base_profile</code></p>
<p>æœ€åç¡®è®¤ä¸€ä¸‹å®‰è£…OK ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> class-dump --v</span></span><br><span class="line">class-dump 3.5 (64 bit) compiled Nov 16 2013 12:22:33</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><p>ä½¿ç”¨ä¸€ä¸ªè®°å½•ä¸€ä¸ªå§ï½</p>
<h3 id="ç”¨æ¥å¯¼å‡ºipa-decryptedå¤´æ–‡ä»¶"><a href="#ç”¨æ¥å¯¼å‡ºipa-decryptedå¤´æ–‡ä»¶" class="headerlink" title="ç”¨æ¥å¯¼å‡ºipa/.decryptedå¤´æ–‡ä»¶"></a>ç”¨æ¥å¯¼å‡º<code>ipa</code>/<code>.decrypted</code>å¤´æ–‡ä»¶</h3><p>æ­¤å¤„åªèƒ½å¯¼å‡ºæœªåŠ å¯†çš„<code>ipa</code>ï¼Œæˆ–è€…ç ¸è¿‡å£³çš„ã€‚<a href="../reverse-ios-dump-decrypted/">å…·ä½“ç ¸å£³è¿‡ç¨‹ä¼ é€é—¨</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ls WeChat.decrypted</span></span><br><span class="line">WeChat.decrypted</span><br><span class="line"><span class="meta">$</span><span class="bash"> class-dump -H WeChat.decrypted -o ./Headers/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls Headers</span></span><br><span class="line">Headers</span><br></pre></td></tr></table></figure>

<p>å³å¾—å¤´æ–‡ä»¶ç›®å½•ï¼š<code>Headers</code></p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºæ—¥å¿—æ‰“å°å’Œè¿‡æ»¤çš„é‚£ç‚¹ç ´äº‹</title>
    <url>/post/reverse-ios-socat-watch-filter/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>å‰ä¸¤å¤©ï¼Œé‡å¯ç”µè„‘çªç„¶å‘ç°æˆ‘çš„<code>iOS8</code>è®¾å¤‡æ— æ³•è¿æ¥åˆ°<code>MacOS</code>äº†ã€‚ã€‚</p>
<p>MMPï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰åŠæ³•ä½¿ç”¨Xcodeè°ƒè¯•ã€ä¹‹å‰ä½¿ç”¨çš„æ—¥å¿—æŸ¥çœ‹ä¹Ÿæ²¡æœ‰åŠæ³•ç»§ç»­ã€‚ã€‚</p>
<p>å…·ä½“æŠ¥é”™å¦‚ä¸‹ï¼š<br><code>Xcode&lt;Version 9.4 (9F1027a)&gt;</code>æŠ¥é”™å¦‚ä¸‹: (æˆ‘å®‰è£…è¿‡<code>Xcode10 beta1</code>)<br><img src="/images/2018-06-15-10-13-16.png" alt="XcodeæŠ¥é”™"></p>
<p><code>iTunes</code>æŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iTunes æ— æ³•è¿æ¥ iPhone â€œiPhoneâ€ï¼Œå› ä¸ºæ”¶åˆ°æ¥è‡ªæ­¤è®¾å¤‡çš„æ— æ•ˆå“åº”ã€‚</span><br></pre></td></tr></table></figure>

<p><img src="/images/2018-06-15-10-06-16.png" alt="iTunesæŠ¥é”™"></p>
<p><code>Apple Configurator2</code>æŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å·²æ”¶åˆ°è®¾å¤‡ä¸Šçš„æ„å¤–å“åº”ã€‚</span><br></pre></td></tr></table></figure>

<p><img src="/images/2018-06-15-10-09-33.png" alt="Apple Configurator2æŠ¥é”™"></p>
<a id="more"></a>

<p>è¿˜æ˜¯ å…ˆæ¥èŠä¸€ä¸‹æ—¥å¿—æ‰“å°çš„å‡ ç§æ–¹æ¡ˆå§ã€‚</p>
<h2 id="æ‰‹æœºå¯ä»¥è¿æ¥åˆ°MacOS"><a href="#æ‰‹æœºå¯ä»¥è¿æ¥åˆ°MacOS" class="headerlink" title="æ‰‹æœºå¯ä»¥è¿æ¥åˆ°MacOS"></a>æ‰‹æœºå¯ä»¥è¿æ¥åˆ°MacOS</h2><p>è¿™ç§æƒ…å†µæ˜¯æœ€å¸¸è§çš„ï¼Œå°±æ˜¯èƒ½åœ¨Xcodeä¸‹Debugâ€¦.</p>
<h3 id="æ–¹æ¡ˆä¸€ï¼šConsole-app-æ§åˆ¶å°"><a href="#æ–¹æ¡ˆä¸€ï¼šConsole-app-æ§åˆ¶å°" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šConsole.app(æ§åˆ¶å°)"></a>æ–¹æ¡ˆä¸€ï¼šConsole.app(æ§åˆ¶å°)</h3><p>è¿™æ˜¯MacOSè‡ªå¸¦çš„æ—¥å¿—ç¥å™¨ï½ æ•ˆæœé¡¶å‘±å‘±ğŸ‘ğŸ‘ğŸ‘ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š<br><img src="/images/2018-06-15-10-23-02.png" alt="Console.app"></p>
<p>å…·ä½“ç”¨æ³•æˆ‘å°±ä¸è¯´äº†ã€‚ã€‚ã€‚æ¯•ç«Ÿéƒ½æ˜¯ä¸­æ–‡ğŸ˜‚</p>
<h3 id="æ–¹æ¡ˆäºŒï¼šLogGuru"><a href="#æ–¹æ¡ˆäºŒï¼šLogGuru" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šLogGuru"></a>æ–¹æ¡ˆäºŒï¼šLogGuru</h3><p><a href="https://github.com/madordie/LogGuru" target="_blank" rel="noopener">madordie/LogGuru</a> ä¹Ÿä¸é”™ï¼Œå¾ˆä¹…ä¹‹å‰forkè‡ª<a href="https://github.com/FIRHQ/LogGuru" target="_blank" rel="noopener">FIRHQ/LogGuru</a>ï¼Œå¢åŠ äº†ç›´æ¥è¿‡æ»¤çš„åŠŸèƒ½ï¼Œè¦ä¸ç„¶é€Ÿåº¦çœŸçš„å¾ˆæ…¢ã€‚ã€‚</p>
<p>åªè¦æ’å…¥USBï¼Œå³å¯æ˜¾ç¤ºæ—¥å¿—ï¼Œè¿˜æ˜¯ä¸é”™æ»´ã€‚ã€‚</p>
<p><img src="/images/2018-06-15-10-29-07.png" alt="åŸæ¥çš„æˆªå›¾"></p>
<h3 id="æ–¹æ¡ˆä¸‰-å…¶ä»–çš„"><a href="#æ–¹æ¡ˆä¸‰-å…¶ä»–çš„" class="headerlink" title="æ–¹æ¡ˆä¸‰: å…¶ä»–çš„"></a>æ–¹æ¡ˆä¸‰: å…¶ä»–çš„</h3><p>è¿˜æœ‰å¾ˆå¤šæ–¹æ¡ˆï¼Œæ¯”å¦‚è¯´å‘½ä»¤è¡Œå•Šã€å…¶ä»–çš„å·¥å…·å•Šï¼Œæˆ‘å°±ä¸è¯´äº†ï¼Œæˆ‘è§‰å¾— <strong>Console.app(æ§åˆ¶å°)</strong> å°±å¤Ÿäº†ğŸ˜‚</p>
<h2 id="æ‰‹æœºæ— æ³•é“¾æ¥è¿›MacOS"><a href="#æ‰‹æœºæ— æ³•é“¾æ¥è¿›MacOS" class="headerlink" title="æ‰‹æœºæ— æ³•é“¾æ¥è¿›MacOS"></a>æ‰‹æœºæ— æ³•é“¾æ¥è¿›MacOS</h2><p>ä¹Ÿå°±æ˜¯æœ€å¼€å§‹è¯´çš„æŠ¥é”™çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è¿æ¥è¿›MacOSçš„æ–¹æ¡ˆå‡æ— æ³•ä½¿ç”¨ã€‚è‹¦é€¼ï¼Œåªèƒ½è®©iOSæ‰“å°æ—¥å¿—äº†ã€‚ã€‚</p>
<p>ä¸‹é¢éƒ½æ˜¯ <strong>è¶Šç‹±ç¯å¢ƒ</strong> ä¸‹çš„ã€‚ã€‚ä¸è¶Šç‹±è¿˜æœ‰äººç”¨iOS8ä¹ˆğŸ˜‚</p>
<p>å…ˆæ¥çœ‹ä¸ªæ–‡æ¡£ï¼š<a href="https://www.theiphonewiki.com/wiki/System_Log" target="_blank" rel="noopener">The iPhone Wiki/System Log</a>,è¿™é‡Œæä¾›äº†å¾ˆå¤šæ–¹æ¡ˆï¼Œä¹Ÿéå¸¸å…¨é¢ï¼Œå€¼å¾—ä¸€è¯•ã€‚</p>
<p>è‹¦é€¼çš„äº‹æƒ…æ˜¯æˆ‘æ‰‹ä¸Šçš„iOS8.4.1æ— æ³•ä½¿ç”¨<code>syslogd to /var/log/syslog</code>æ’ä»¶ï¼Œå°è¯•ä½¿ç”¨<a href="https://www.theiphonewiki.com/wiki/System_Log#On-device_with_saving_to_a_file_via_a_Python_script" target="_blank" rel="noopener">On-device with saving to a file via a Python script</a>çš„æ–¹æ¡ˆå»è§£å†³ä¹Ÿå¹¶ä¸å¦‚æ„ã€‚ã€‚</p>
<p>å¼€å§‹ç”¨<a href="https://www.theiphonewiki.com/wiki/System_Log#On-device_with_socat" target="_blank" rel="noopener">On-device with socat</a>ï¼ˆ åœ¨<a href="http://bbs.iosre.com/" target="_blank" rel="noopener">iosre</a>ä¸­ä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„æ–‡ç« ï¼š<a href="http://bbs.iosre.com/t/ios-socat/139" target="_blank" rel="noopener">iOSæŸ¥çœ‹æ—¥å¿—åˆ©å™¨ â€”â€” socat</a>ï¼‰ï¼Œè¯´çš„éƒ½æ˜¯ç›¸å½“çš„è¯¦ç»†ã€‚</p>
<h3 id="socatçš„å‘"><a href="#socatçš„å‘" class="headerlink" title="socatçš„å‘"></a>socatçš„å‘</h3><h4 id="stopæ²¡æœ‰ç”¨"><a href="#stopæ²¡æœ‰ç”¨" class="headerlink" title="stopæ²¡æœ‰ç”¨"></a>stopæ²¡æœ‰ç”¨</h4><p>å¦‚<a href="http://bbs.iosre.com/t/ios-socat/139" target="_blank" rel="noopener">iOSæŸ¥çœ‹æ—¥å¿—åˆ©å™¨ â€”â€” socat</a>æ‰€è¯´ï¼š</p>
<blockquote>
<p>è¾“å…¥watchæŸ¥çœ‹ï¼Œè¾“å…¥stopåœæ­¢ï¼ˆä¸è¿‡åœæ­¢è²Œä¼¼æ²¡ç”¨ï¼Œä¹Ÿä¸çŸ¥é“ä¸ºå•¥ï¼ŒçŸ¥é“çš„è¯·å‘Šè¯‰æˆ‘ï¼‰</p>
</blockquote>
<p>è¿™ä¸ªçœŸçš„æ˜¯æ²¡æœ‰ç”¨ï¼Œæ‰€ä»¥<code>watch</code>åŠŸèƒ½å°±å¾ˆé¸¡è‚‹ã€‚ã€‚</p>
<h4 id="æ²¡æœ‰åŠæ³•å®æ—¶è¿‡æ»¤"><a href="#æ²¡æœ‰åŠæ³•å®æ—¶è¿‡æ»¤" class="headerlink" title="æ²¡æœ‰åŠæ³•å®æ—¶è¿‡æ»¤"></a>æ²¡æœ‰åŠæ³•å®æ—¶è¿‡æ»¤</h4><p>æ–‡ä¸­æåˆ°äº†å¾ˆå¤šè¿‡æ»¤æ¡ä»¶ï¼Œä½†æ˜¯ä¸€æ—¦å¼€å¯è¿‡æ»¤ï¼Œå°±æ²¡æœ‰åŠæ³•æ˜¾ç¤ºå®æ—¶æ—¥å¿—ã€‚ã€‚ä¹Ÿå°±æ˜¯è¯´æ— æ³•å’Œ<code>watch</code>å…±å­˜ã€‚ã€‚ã€‚</p>
<h3 id="æ¢ä¸ªå§¿åŠ¿ä½¿ç”¨socat"><a href="#æ¢ä¸ªå§¿åŠ¿ä½¿ç”¨socat" class="headerlink" title="æ¢ä¸ªå§¿åŠ¿ä½¿ç”¨socat"></a>æ¢ä¸ªå§¿åŠ¿ä½¿ç”¨socat</h3><p><code>socat</code>çš„æ—¥å¿—éƒ½åœ¨ç»ˆç«¯ä¸Šï¼Œä¸ç€è‰²ä¸è¯´è¿˜æœ‰ä¸Šé¢çš„ä¸¤ä¸ªå¾ˆå½±å“ä½¿ç”¨çš„é—®é¢˜ã€‚ã€‚ã€‚äºæ˜¯ä¹ï¼Œä¸ºäº†å¢åŠ è¿‡æ»¤åŠŸèƒ½ï¼Œéœ€è¦é€šè¿‡ç®¡é“å°†è¾“å‡ºæ¥å…¥å¦å¤–çš„å‘½ä»¤å¦‚ï¼š<code>grep</code>ç­‰ã€‚</p>
<p><code>socat</code>å‘½ä»¤éœ€è¦æ‰‹åŠ¨è¾“å…¥<code>watch</code>æ‰èƒ½æ˜¾ç¤ºå‡ºå®æ—¶å‘½ä»¤ï¼Œè¿™ä¸ªè®©ç®¡é“å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚è¿™é‡Œéœ€è¦å€ŸåŠ©<code>expect</code>å‘½ä»¤ã€‚</p>
<p>å¥½äº†æ‰€æœ‰çš„ç‚¹éƒ½é€šäº†ï¼Œå¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h4 id="åœ¨macä¸Šå®‰è£…expect"><a href="#åœ¨macä¸Šå®‰è£…expect" class="headerlink" title="åœ¨macä¸Šå®‰è£…expect"></a>åœ¨macä¸Šå®‰è£…expect</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">brew install expect</span><br></pre></td></tr></table></figure>

<h4 id="åœ¨macçš„ï½-bash-profileé…ç½®"><a href="#åœ¨macçš„ï½-bash-profileé…ç½®" class="headerlink" title="åœ¨macçš„ï½/.bash_profileé…ç½®"></a>åœ¨macçš„ï½/.bash_profileé…ç½®</h4><p>æ­¤å¤„å‡è®¾ä½ çš„è®¾å¤‡å·²ç»æŒ‰ç…§<a href="../reverse-ios-ssh">iOSé€†å‘-è®¾å¤‡sshå…å¯†ç™»å½•</a>é…ç½®å¥½äº†ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> ios-<span class="function"><span class="title">socat</span></span>() &#123;</span><br><span class="line">    expect -c <span class="string">"</span></span><br><span class="line"><span class="string">        spawn ssh i5s \"socat - UNIX-CONNECT:/var/run/lockdown/syslog.sock\"</span></span><br><span class="line"><span class="string">        expect &#123;</span></span><br><span class="line"><span class="string">            \"&gt; \" &#123;send \"watch\n\";&#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    interact"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ios-socat</code> å‡½æ•°åï¼Œåœ¨å‘½ä»¤è¡Œå¯ä»¥ç›´æ¥è¾“å…¥å‡½æ•°åè°ƒç”¨è¯¥å‡½æ•°</li>
<li><code>i5s</code> åœ¨<code>~/.ssh/config</code>ä¸­é…ç½®çš„åå­—</li>
</ul>
<p>å¦‚æœæ²¡æœ‰é…ç½®sshå…å¯†å‘¢éœ€è¦è¿™æ ·ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> ios-<span class="function"><span class="title">socat</span></span>() &#123;</span><br><span class="line">    expect -c <span class="string">"</span></span><br><span class="line"><span class="string">        spawn ssh -p22 root@ios's_ip \"socat - UNIX-CONNECT:/var/run/lockdown/syslog.sock\"</span></span><br><span class="line"><span class="string">        expect &#123;</span></span><br><span class="line"><span class="string">            \"*password: \" &#123;send \"mypassword\n\";&#125;</span></span><br><span class="line"><span class="string">            \"&gt; \" &#123;send \"watch\n\";&#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    interact"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-p22</code> ç«¯å£å·ï¼Œ22æ˜¯é»˜è®¤ä¸ç”¨å†™ï¼Œä½†æ˜¯å…¶ä»–çš„éœ€è¦å†™ã€‚</li>
<li><code>ios&#39;s_ip</code> iOSè®¾å¤‡çš„ipã€‚</li>
<li><code>mypassword</code> iOSè®¾å¤‡å¯†ç </li>
<li>è¿™ä¸ªæˆ‘æ²¡æµ‹ã€‚ã€‚å¤§è‡´å¦‚æ­¤ï¼Œæˆ‘å¯¹<code>expect</code>çš„è¯­æ³•ä¹Ÿä¸æ˜¯å¾ˆç†Ÿ</li>
</ul>
<p>æœ€ååˆ«å¿˜äº†è®©<code>~/.bash_profile</code>ç”Ÿæ•ˆï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>

<p>ç„¶ååªéœ€è¦åœ¨å‘½ä»¤è¡Œè¾“å…¥<code>ios-socat</code>å°±å¯ä»¥çœ‹åˆ°è¹­è¹­è¹­çš„æ—¥å¿—æ‰“å°å’¯ã€‚ã€‚è‡³äºç”¨ä»€ä¹ˆç®¡é“å•Šéƒ½ä¸æ˜¯é—®é¢˜ã€‚</p>
<p>æ¯”å¦‚ï¼š<br>åªæ˜¾ç¤ºåŒ…å«<code>iosre</code>å…³é”®å­—çš„æ—¥å¿—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ios-socat | grep iosre</span><br></pre></td></tr></table></figure>

<h4 id="æ™‹çº§ç”¨æ³•"><a href="#æ™‹çº§ç”¨æ³•" class="headerlink" title="æ™‹çº§ç”¨æ³•"></a>æ™‹çº§ç”¨æ³•</h4><ul>
<li><p>æˆ‘çš„iOSè®¾å¤‡é€šè¿‡<code>iproxy</code>æ¥è¿›è¡Œç«¯å£æ˜ å°„ã€‚å…·ä½“ç”¨æ³•ç§»æ­¥<a href="https://www.google.com/search?q=iproxy&oq=iproxy" target="_blank" rel="noopener">Google</a></p>
</li>
<li><p>é€šè¿‡<code>ios-socat &gt; ~/Desktop/ios.log</code> ç„¶åä¸‹è½½<a href="https://itunes.apple.com/cn/app/logtail/id1073404370?mt=12" target="_blank" rel="noopener">LogTail</a>ï¼Œå‰©ä¸‹çš„æ‘¸ç´¢ä¸€ä¸‹å’¯</p>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2></li>
</ul>
<p>æˆ‘è¿˜ä¸æ¸…æ¥šç©¶ç«Ÿä»€ä¹ˆåŸå› å¯¼è‡´äº†<code>æ”¶åˆ°æ¥è‡ªæ­¤è®¾å¤‡çš„æ— æ•ˆå“åº”</code>é”™è¯¯ï¼Œå¸ƒå‰å²›ç³»ç»Ÿä¿®æ”¹äº†ä»€ä¹ˆã€‚æˆ‘å°è¯•é‡æ–°å®‰è£…iTunesã€Xcodeéƒ½æ— æ•ˆï¼ˆæ®è¯´é™Œé™Œçš„å¼€å‘ä¸ºè¿™ä¸ªæ— æ³•è°ƒè¯•ç›´æ¥å°†ç³»ç»Ÿé™çº§æ˜¯å¯ä»¥çš„ğŸ˜‚ï¼‰ã€‚ã€‚æœ‰è€é“æ‡‚å¾—æŒ‡ç‚¹ä¸‹ï½ï½</p>
<p>ç›®å‰è™½ç„¶ä¸Šé¢éƒ½å¯ä»¥ç”¨ï¼Œä½†æ˜¯çœ‹ä¸ªæ—¥å¿—å¹¶ä¸èƒ½æ»¡è¶³æˆ‘çš„é‡å¿ƒï¼Œæœ€ååœ¨ç§»åŠ¨ç¡¬ç›˜é‡Œåšäº†ä¸€ä¸ª10.12çš„ç³»ç»ŸğŸ˜‚ï¼Œç”¨äº†Console.appâ€¦</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSé€†å‘-ç ¸å£³(cycript/clutch)</title>
    <url>/post/reverse-ios-dump-decrypted/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><ul>
<li>è¶Šç‹±è®¾å¤‡</li>
</ul>
<p>ç›®å‰æœ‰ä¸¤ç§ç ¸å£³å·¥å…·ï¼Œå¹¶ä¸è‚©å¹¶è‚©ï¼Œä¸€ä¸ªä¸è¡Œå°±ç”¨å¦ä¸€ä¸ªå‘—ï¼Œä¿©éƒ½ä¸è¡Œå°±Googleå§ï½ï½</p>
<p>ä¸‹é¢åˆ†åˆ«å¯¹<code>cycript</code>ã€<code>clutch</code>è¿›è¡Œç ¸å£³:</p>
<a id="more"></a>

<h1 id="ä½¿ç”¨cycriptè¿›è¡Œç ¸å£³"><a href="#ä½¿ç”¨cycriptè¿›è¡Œç ¸å£³" class="headerlink" title="ä½¿ç”¨cycriptè¿›è¡Œç ¸å£³"></a>ä½¿ç”¨cycriptè¿›è¡Œç ¸å£³</h1><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><ul>
<li><code>Cydia</code>ä¸­æœç´¢<code>cycript</code>å¹¶å®‰è£… </li>
</ul>
<h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><h3 id="åˆ¶ä½œå¹¶ä¸Šä¼ dumpdecrypted-dylib-ï¼ˆå·²ç»OKçš„å¯å¿½ç•¥"><a href="#åˆ¶ä½œå¹¶ä¸Šä¼ dumpdecrypted-dylib-ï¼ˆå·²ç»OKçš„å¯å¿½ç•¥" class="headerlink" title="åˆ¶ä½œå¹¶ä¸Šä¼ dumpdecrypted.dylib ï¼ˆå·²ç»OKçš„å¯å¿½ç•¥"></a>åˆ¶ä½œå¹¶ä¸Šä¼ <code>dumpdecrypted.dylib</code> ï¼ˆå·²ç»OKçš„å¯å¿½ç•¥</h3><h4 id="åˆ¶ä½œ"><a href="#åˆ¶ä½œ" class="headerlink" title="åˆ¶ä½œ"></a>åˆ¶ä½œ</h4><p>ç›®å‰æˆ‘åˆ¶ä½œç›®å½•æš‚æ—¶åœ¨<code>~/Desktop</code>ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/stefanesser/dumpdecrypted.git ~/Desktop</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ï½ï¼Desktop/dumpdecrypted</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls dumpdecrypted.dylib</span></span><br></pre></td></tr></table></figure>

<p>æ²¡ä»€ä¹ˆé”™è¯¯çš„è¯ï¼Œå³å¾—<code>dumpdecrypted.dylib</code>ã€‚</p>
<h4 id="ä¸Šä¼ "><a href="#ä¸Šä¼ " class="headerlink" title="ä¸Šä¼ "></a>ä¸Šä¼ </h4><p>å°†<code>dumpdecrypted.dylib</code>æ”¾åœ¨è¶Šç‹±è®¾å¤‡çš„<code>/var/root/</code>ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ls dumpdecrypted.dylib</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> scp dumpdecrypted.dylib root@10.12.14.16:/var/root/</span></span><br><span class="line">root@10.12.14.16's password:</span><br><span class="line">dumpdecrypted.dylib                           100%  193KB   3.0MB/s   00:00</span><br><span class="line"><span class="meta">$</span></span><br></pre></td></tr></table></figure>

<h3 id="ç™»å½•è¿›è¶Šç‹±è®¾å¤‡"><a href="#ç™»å½•è¿›è¶Šç‹±è®¾å¤‡" class="headerlink" title="ç™»å½•è¿›è¶Šç‹±è®¾å¤‡"></a>ç™»å½•è¿›è¶Šç‹±è®¾å¤‡</h3><p>å¯ä»¥ä½¿ç”¨<code>ssh root@IP</code>è¿›è¡Œç™»å½•ã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨<code>ssh ipad</code>ï¼Œè¿™æ ·å…å¯†ç™»å½•ç™»å½•ã€‚ <a href="../reverse-ios-ssh/">é…ç½®ä¼ é€é—¨</a></p>
<h3 id="æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„"><a href="#æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„" class="headerlink" title="æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„"></a>æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„</h3><p>è¿™é‡Œä»¥<code>WeChat</code>ä¸ºä¾‹å­å•¦ï½</p>
<p>è®°å¾—å…ˆæ‰“å¼€å‘€ï½ï½ï½</p>
<p><code>ps -e</code>ï¼š æ˜¾ç¤ºæ‰€æœ‰ç¨‹åº<br><code>grep</code>: è¿™é‡Œæ˜¯è¿‡æ»¤ä¸€ä¸‹ã€‚ã€‚å…·ä½“ç”¨æ³•Googleã€‚æ‰€æœ‰çš„ç¨‹åºæœ‰ç‚¹å¤šï¼Œæˆ‘çŸ¥é“åå­—ï¼Œæ‰€ä»¥ç›´æ¥è¿‡æ»¤ä¸€ä¸‹ã€‚ä¹Ÿå¯å¿½ç•¥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ps -e | grep WeChat</span></span><br><span class="line">705 ??         0:02.20 /var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat</span><br><span class="line">707 ttys000    0:00.01 grep WeChat</span><br><span class="line"><span class="meta">$</span><span class="bash"> cycript -p 705</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cycript -p 705</span></span><br><span class="line"><span class="meta">cy#</span><span class="bash"> [[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask][0]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">"file:///var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/"</span></span></span><br><span class="line"><span class="meta">cy#</span><span class="bash"> <span class="built_in">exit</span>(0)</span></span><br><span class="line">MS:Error: _krncall(mach_vm_read_overwrite(task, data, sizeof(*baton), reinterpret_cast&lt;mach_vm_address_t&gt;(baton), &amp;error)) =4</span><br><span class="line">*** _assert(status == 0):../Inject.cpp(143):InjectLibrary</span><br><span class="line"><span class="meta">$</span></span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„è·å¾—ä¸¤ä¸ªç›®å½•ï¼š</p>
<ul>
<li><code>/var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat</code></li>
<li><code>/var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/</code></li>
</ul>
<h3 id="å¼€ç ¸"><a href="#å¼€ç ¸" class="headerlink" title="å¼€ç ¸"></a>å¼€ç ¸</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ~</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp dumpdecrypted.dylib /var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat</span></span><br><span class="line">mach-o decryption dumper</span><br><span class="line"></span><br><span class="line">DISCLAIMER: This tool is only meant for security research purposes, not for application crackers.</span><br><span class="line"></span><br><span class="line">[+] detected 64bit ARM binary in memory.</span><br><span class="line">[+] offset to cryptid found: @0x1000c0ca8(from 0x1000c0000) = ca8</span><br><span class="line">[+] Found encrypted data at address 00004000 of length 51200000 bytes - type 1.</span><br><span class="line">[+] Opening /private/var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat for reading.</span><br><span class="line">[+] Reading header</span><br><span class="line">[+] Detecting header type</span><br><span class="line">[+] Executable is a plain MACH-O image</span><br><span class="line">[+] Opening WeChat.decrypted for writing.</span><br><span class="line">[+] Copying the not encrypted start of the file</span><br><span class="line">[+] Dumping the decrypted data into the file</span><br><span class="line">[+] Copying the not encrypted remainder of the file</span><br><span class="line">[+] Setting the LC_ENCRYPTION_INFO-&gt;cryptid to 0 at offset ca8</span><br><span class="line">[+] Closing original file</span><br><span class="line">[+] Closing dump file</span><br><span class="line"><span class="meta">$</span><span class="bash"> ls WeChat.decrypted</span></span><br><span class="line">WeChat.decrypted</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">pwd</span></span></span><br><span class="line">/var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents</span><br></pre></td></tr></table></figure>
<p>æœ€åå¾—åˆ°æ–‡ä»¶:</p>
<ul>
<li><code>/var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/WeChat.decrypted</code></li>
</ul>
<h3 id="å°†-decryptedæ‹·è´å‡ºæ¥"><a href="#å°†-decryptedæ‹·è´å‡ºæ¥" class="headerlink" title="å°†*.decryptedæ‹·è´å‡ºæ¥"></a>å°†<code>*.decrypted</code>æ‹·è´å‡ºæ¥</h3><p>æˆ‘è¿™é‡Œç›´æ¥ä½¿ç”¨<code>scp</code>å§ï½ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /Users/Madordie/Desktop/Madordie/iOS/xxx</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> scp root@10.12.14.16:/var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/WeChat.decrypted .</span></span><br><span class="line">root@10.12.14.16's password:</span><br><span class="line">WeChat.decrypted                              100%   61MB   4.7MB/s   00:12</span><br><span class="line"><span class="meta">$</span><span class="bash"> ls WeChat.decrypted</span></span><br><span class="line">WeChat.decrypted</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤åœ¨ä¸»æœºä¸Šå¾—åˆ°ï¼š</p>
<ul>
<li><code>/Users/Madordie/Desktop/Madordie/iOS/xxx/WeChat.decrypted</code></li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>ä¸ºä»€ä¹ˆå°†<code>dumpdecrypted.dylib</code>  <code>copy</code> è‡³<code>*/Documents/</code>ä¸‹ï¼Ÿ<br>  ï¼šåˆ«çš„ç›®å½•æ²¡æœ‰æƒé™ï½ï½ï¼ˆ<code>dumpdecrypted.dylib: stat() failed with errno=1</code> ï¼‰</li>
</ul>
<h1 id="ä½¿ç”¨clutchè¿›è¡Œç ¸å£³"><a href="#ä½¿ç”¨clutchè¿›è¡Œç ¸å£³" class="headerlink" title="ä½¿ç”¨clutchè¿›è¡Œç ¸å£³"></a>ä½¿ç”¨clutchè¿›è¡Œç ¸å£³</h1><h2 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><h3 id="ä¸‹è½½ä¸Šä¼ clutch-æ— é¡»é‡å¤åš"><a href="#ä¸‹è½½ä¸Šä¼ clutch-æ— é¡»é‡å¤åš" class="headerlink" title="ä¸‹è½½ä¸Šä¼ clutch(æ— é¡»é‡å¤åš)"></a>ä¸‹è½½ä¸Šä¼ clutch(æ— é¡»é‡å¤åš)</h3><p><code>clutch</code>å¯ä»¥ä»<a href="https://github.com/KJCracks/Clutch" target="_blank" rel="noopener">https://github.com/KJCracks/Clutch</a>ä¸‹è½½ç¼–è¯‘ã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä»<a href="https://github.com/KJCracks/Clutch/releases" target="_blank" rel="noopener">https://github.com/KJCracks/Clutch/releases</a>ç›´æ¥ä¸‹è½½ã€‚</p>
<p>ç›®å‰ä¸‹è½½åˆ°ç›®å½•<code>~/Clutch-2.0.4</code></p>
<p>ä¸Šä¼ åˆ°è®¾å¤‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ~</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> scp Clutch-2.0.4 root@10.12.14.16:/usr/bin/</span></span><br><span class="line">root@10.12.14.16's password:</span><br><span class="line">Clutch-2.0.4                                  100% 1204KB   4.7MB/s   00:00</span><br></pre></td></tr></table></figure>

<h3 id="ç™»å½•è¿›è¶Šç‹±è®¾å¤‡-1"><a href="#ç™»å½•è¿›è¶Šç‹±è®¾å¤‡-1" class="headerlink" title="ç™»å½•è¿›è¶Šç‹±è®¾å¤‡"></a>ç™»å½•è¿›è¶Šç‹±è®¾å¤‡</h3><p>å¯ä»¥ä½¿ç”¨<code>ssh root@IP</code>è¿›è¡Œç™»å½•ã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨<code>ssh ipad</code>ï¼Œè¿™æ ·å…å¯†ç™»å½•ç™»å½•ã€‚ <a href="../reverse-ios-ssh/">é…ç½®ä¼ é€é—¨</a></p>
<h3 id="ä¿®æ”¹æƒé™"><a href="#ä¿®æ”¹æƒé™" class="headerlink" title="ä¿®æ”¹æƒé™"></a>ä¿®æ”¹æƒé™</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ~</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /usr/bin</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv Clutch-2.0.4 clutch</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod +x clutch</span></span><br></pre></td></tr></table></figure>

<h3 id="ç ¸å£³"><a href="#ç ¸å£³" class="headerlink" title="ç ¸å£³"></a>ç ¸å£³</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> clutch -i</span></span><br><span class="line">Installed apps:</span><br><span class="line">1:   é’‰é’‰ &lt;com.laiwang.DingTalk&gt;</span><br><span class="line">2:   éŸ©å‰§TV-æœ€æ–°çƒ­é—¨éŸ©å‰§å¤§å…¨ &lt;com.baoyun.hanju&gt;</span><br><span class="line">3:   PG Client - a better client for dribbble &lt;com.az.azdribbble&gt;</span><br><span class="line">4:   çªç‰›ï¼è®¾è®¡è£…ä¿®æˆ‘ä»¬çš„å®¶ &lt;com.lingduohome.acorn&gt;</span><br><span class="line"><span class="meta">$</span><span class="bash"> clutch -d 1</span></span><br><span class="line">com.laiwang.DingTalk contains watchOS 2 compatible application. It's not possible to dump watchOS 2 apps with Clutch 2.0.4 at this moment.</span><br><span class="line">Zipping DingTalk.app</span><br><span class="line">ASLR slide: 0x10001c000</span><br><span class="line">Dumping &lt;DingTalk&gt; (arm64)</span><br><span class="line">Patched cryptid (64bit segment)</span><br><span class="line">Writing new checksum</span><br><span class="line">DONE: /private/var/mobile/Documents/Dumped/com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ipa</span><br><span class="line">Finished dumping com.laiwang.DingTalk in 40.6 seconds</span><br><span class="line"><span class="meta">$</span></span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆæœ€ç»ˆè·¯å¾„:</p>
<ul>
<li><code>/private/var/mobile/Documents/Dumped/com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ipa</code></li>
</ul>
<h3 id="ä¼ è‡³æœ¬åœ°"><a href="#ä¼ è‡³æœ¬åœ°" class="headerlink" title="ä¼ è‡³æœ¬åœ°"></a>ä¼ è‡³æœ¬åœ°</h3><p>æ³¨æ„è·¯å¾„ä¸­æœ‰<code>()</code>è¿™æ ·çš„å­—ç¬¦ï¼Œéœ€è¦è½¬ä¹‰ä¸€ä¸‹ã€‚å¦‚ä¸‹ï¼š</p>
<p>åœ¨æœ¬åœ°ç»ˆç«¯ä¸­ä½¿ç”¨<code>scp</code>æ‹‰å–ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> scp root@10.12.14.16:<span class="string">'/private/var/mobile/Documents/Dumped/com.laiwang.DingTalk-iOS7.0-\(Clutch-2.0.4\).ipa'</span> .</span></span><br><span class="line">root@10.12.14.16's password:</span><br><span class="line">com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ip 100%   48MB   3.6MB/s   00:13</span><br><span class="line"><span class="meta">$</span><span class="bash"> ls com.laiwang.DingTalk-iOS7.0-\(Clutch-2.0.4\).ipa</span></span><br><span class="line">com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ipa</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">pwd</span></span></span><br><span class="line">/Users/Madordie/Desktop/Madordie/ios-reverse</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤åœ¨ä¸»æœºä¸Šå¾—åˆ°ï¼š</p>
<ul>
<li><code>/Users/Madordie/Desktop/Madordie/ios-reverse/com.laiwang.DingTalk-iOS7.0-\(Clutch-2.0.4\).ipa</code></li>
</ul>
<h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ”¯æŒè¿™ç§å·¥å…·ç ¸å£³ï¼Œå¤±è´¥äº†ç”¨ç¬¬ä¸€ç§è¯•è¯•ã€‚ã€‚ã€‚</li>
</ul>
<h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>ç›®å‰å‘ç°è¿™ä¸¤ç§ç ¸å£³å·¥å…·ã€‚ä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªAPPéƒ½å¯ä»¥ä½¿ç”¨2ç§å·¥å…·ã€‚æœ‰çš„åªæœ‰ä¸€ä¸ªæœ‰æ•ˆï¼Œæœ‰çš„ä¸¤ä¸ªéƒ½æœ‰æ•ˆï¼Œè¿˜æœ‰ä¸€ç§ä¸¤ä¸ªéƒ½å¤±è´¥çš„ğŸ˜‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSé€†å‘-åˆ›å»ºCydiaæº</title>
    <url>/post/reverse-ios-creat-cydia-sources/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>æ­å»ºè‡ªå·±çš„cydiaæºã€‚</p>
<a id="more"></a>

<h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><ul>
<li>Ubuntu 16.04 LTS</li>
</ul>
<h3 id="å®‰è£…å·¥å…·"><a href="#å®‰è£…å·¥å…·" class="headerlink" title="å®‰è£…å·¥å…·"></a>å®‰è£…å·¥å…·</h3><h4 id="dpkg-dev"><a href="#dpkg-dev" class="headerlink" title="dpkg-dev"></a>dpkg-dev</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ apt-get update</span><br><span class="line">$ apt-get install dpkg-dev</span><br><span class="line">$ dpkg-scanpackages --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h4 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">apt-get install nginx</span><br></pre></td></tr></table></figure>

<h3 id="å¼€å·¥"><a href="#å¼€å·¥" class="headerlink" title="å¼€å·¥"></a>å¼€å·¥</h3><h4 id="å‡†å¤‡deb"><a href="#å‡†å¤‡deb" class="headerlink" title="å‡†å¤‡deb"></a>å‡†å¤‡deb</h4><p>æ­¤å¤„ç›®å½•ä¸º<code>/opt/cydia/debs</code>ï¼Œå¯ä»¥ä¸ºåˆ«çš„ï¼Œä½†æ˜¯å»ºè®®ä½ ä¹Ÿè¿™æ ·åš:)ã€‚</p>
<h4 id="ç”Ÿæˆä¾èµ–"><a href="#ç”Ÿæˆä¾èµ–" class="headerlink" title="ç”Ÿæˆä¾èµ–"></a>ç”Ÿæˆä¾èµ–</h4><p>æ›´æ–°æ’ä»¶éœ€è¦é‡æ–°æ‰§è¡Œå“Ÿã€‚ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/cydia</span><br><span class="line">$ dpkg-scanpackages -m ./debs /dev/null &gt; Packages</span><br><span class="line">$ bzip2 Packages</span><br></pre></td></tr></table></figure>

<h4 id="æ·»åŠ sources-list"><a href="#æ·»åŠ sources-list" class="headerlink" title="æ·»åŠ sources.list"></a>æ·»åŠ sources.list</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"deb file:///opt/cydia ./debs/"</span> &gt;&gt; /etc/apt/sources.list</span><br></pre></td></tr></table></figure>

<p>ps. æ³¨æ„è·¯å¾„ä¿¡æ¯</p>
<h4 id="æ›´æ–°ä¸€ä¸‹"><a href="#æ›´æ–°ä¸€ä¸‹" class="headerlink" title="æ›´æ–°ä¸€ä¸‹"></a>æ›´æ–°ä¸€ä¸‹</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ apt-get update</span><br></pre></td></tr></table></figure>

<h4 id="æ‰”å‡ºå»"><a href="#æ‰”å‡ºå»" class="headerlink" title="æ‰”å‡ºå»"></a>æ‰”å‡ºå»</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /var/www/html</span><br><span class="line">$ ln -s /opt/cydia cydia</span><br><span class="line">$ /etc/init.d/nginx start</span><br></pre></td></tr></table></figure>

<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul>
<li><a href="http://www.saurik.com/id/7" target="_blank" rel="noopener">http://www.saurik.com/id/7</a></li>
<li><a href="https://bbs.feng.com/read-htm-tid-8052646.html" target="_blank" rel="noopener">https://bbs.feng.com/read-htm-tid-8052646.html</a></li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSé€†å‘-è®¾å¤‡sshå…å¯†ç™»å½•</title>
    <url>/post/reverse-ios-ssh/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h2><ul>
<li>å·²è¶Šç‹±è®¾å¤‡</li>
<li>è¶Šç‹±è®¾å¤‡å®‰è£…OpenSSH(âš ï¸è®°å¾—ä¿®æ”¹é»˜è®¤çš„â€™alpineâ€™ç™»å½•å¯†ç )</li>
<li>ç”µè„‘å’Œè®¾å¤‡åŒå±€åŸŸç½‘ã€‚ï¼ˆæˆ‘è¿™é‡Œè®¾å¤‡IPï¼š10.11.12.13ï¼Œå¹¶ä¸”è®¾ç½®æˆé™æ€IPäº†ğŸ˜‚ï¼‰</li>
</ul>
<a id="more"></a>

<h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><h3 id="ç”ŸæˆRSAè¯ä¹¦"><a href="#ç”ŸæˆRSAè¯ä¹¦" class="headerlink" title="ç”ŸæˆRSAè¯ä¹¦"></a>ç”ŸæˆRSAè¯ä¹¦</h3><p>æˆ‘è¿™é‡Œç”Ÿæˆçš„è¯ä¹¦ä¸º:<code>ipad</code>ï¼Œå¯è‡ªå·±éœ€è¦å®šä¹‰ã€‚ï¼ˆæ³¨æ„å¦‚æœç›´æ¥å›è½¦ä¼šè¦†ç›–<code>~/.ssh/id_rsa</code>ï¼‰</p>
<p>æ‰§è¡Œå‘½ä»¤<code>ssh-keygen</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ~/.ssh/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/Users/Madordie/.ssh/id_rsa): ipad</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in ipad.</span><br><span class="line">Your public key has been saved in ipad.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:GpQBeAf+oqUzWlUhtItDcVyVFz2wd0EcIgD+BZLPK8U Madordie@Bingo.local</span><br><span class="line">The key's randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|  .+*+*++o++.o+. |</span><br><span class="line">|  .+o+o=...oo... |</span><br><span class="line">|  ..o.=+ .o ...  |</span><br><span class="line">| . . = .E. . .   |</span><br><span class="line">|  o = o.S.       |</span><br><span class="line">|   * ..o.        |</span><br><span class="line">|  *   ..         |</span><br><span class="line">| o o             |</span><br><span class="line">|.                |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls ~/.ssh/ipad*</span></span><br><span class="line">/Users/Madordie/.ssh/ipad     /Users/Madordie/.ssh/ipad.pub</span><br></pre></td></tr></table></figure>

<h3 id="å°†å…¬é’¥æ¨é€è‡³è¶Šç‹±è®¾å¤‡"><a href="#å°†å…¬é’¥æ¨é€è‡³è¶Šç‹±è®¾å¤‡" class="headerlink" title="å°†å…¬é’¥æ¨é€è‡³è¶Šç‹±è®¾å¤‡"></a>å°†å…¬é’¥æ¨é€è‡³è¶Šç‹±è®¾å¤‡</h3><p>é»˜è®¤æ˜¯æ²¡æœ‰<code>~/.ssh</code>ç›®å½•çš„ï¼Œæš‚æ—¶æ”¾ç½®åœ¨<code>/var/root</code>ä¸‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> scp ~/.ssh/ipad.pub root@10.11.12.13:/var/root</span></span><br></pre></td></tr></table></figure>

<p><code>scp</code> é»˜è®¤ç«¯å£ä¸º<code>22</code> å¦‚æœéœ€è¦è‡ªå®šä¹‰ç«¯å£å¯ä»¥åœ¨è·¯å¾„å‰æ·»åŠ <code>-P ç«¯å£å·</code>å‚æ•°ã€‚</p>
<h3 id="é…ç½®æœ¬æœº-ssh-configæ–‡ä»¶"><a href="#é…ç½®æœ¬æœº-ssh-configæ–‡ä»¶" class="headerlink" title="é…ç½®æœ¬æœº~/.ssh/configæ–‡ä»¶"></a>é…ç½®æœ¬æœº<code>~/.ssh/config</code>æ–‡ä»¶</h3><p>ä½¿ç”¨é¡ºæ‰‹çš„å·¥å…·ç¼–è¾‘<code>~/.ssh/config</code>æ–‡ä»¶ã€‚ï¼ˆæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªå•¦ï½</p>
<p>æŒ‰ç…§å¦‚ä¸‹æ ¼å¼å¡«å†™ã€‚é»˜è®¤<code>ssh</code>ç™»å½•ç«¯å£ä¸º<code>22</code>å¯ä»¥ä¸å†™ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Host ipad</span><br><span class="line">    Hostname 10.11.12.13</span><br><span class="line">    User root</span><br><span class="line">    Port 22</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile ~&#x2F;.ssh&#x2F;ipad</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®è¶Šç‹±è®¾å¤‡"><a href="#é…ç½®è¶Šç‹±è®¾å¤‡" class="headerlink" title="é…ç½®è¶Šç‹±è®¾å¤‡"></a>é…ç½®è¶Šç‹±è®¾å¤‡</h3><p>å…ˆç”¨<code>ssh root@10.11.12.13</code>ç™»å½•è¿›è®¾å¤‡(å¦‚æœä½ æ²¡æœ‰ä¿®æ”¹å¯†ç é‚£ä¹ˆé»˜è®¤æ˜¯<code>alpine</code>,è¿™ä¸ªåœ¨<a href="https://cydia.saurik.com/openssh.html" target="_blank" rel="noopener">OpenSSH</a>ä¸Š)ã€‚åˆšæ‰æˆ‘ä»¬å°†<code>ipad.pub</code>é€šè¿‡<code>scp</code>æ”¾åœ¨äº†<code>/var/root</code>ä¸‹ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹<code>/var/root/.ssh</code>æ˜¯ä¸å­˜åœ¨çš„ï¼Œä½¿ç”¨å‘½ä»¤<code>mkdir -p /var/root/.ssh</code>å³å¯åˆ›å»ºã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat ipad.pub &gt;&gt; /var/root/.ssh/authorized_keys</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¼ºè¿«ç—‡çš„å¯ä»¥ä½¿ç”¨<code>rm -rf ipad.pub</code>åˆ é™¤å•¦ï½</p>
<p>å¯¹äº†ï¼Œé€€å‡º<code>ssh</code>ç™»å½•çš„è®¾å¤‡ä½¿ç”¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line">logout</span><br><span class="line">Connection to 10.11.12.13 closed.</span><br></pre></td></tr></table></figure>

<h3 id="èµ¶ç´§æµ‹è¯•ä¸€ä¸‹è¿œç¨‹ç™»å½•æ•ˆæœ"><a href="#èµ¶ç´§æµ‹è¯•ä¸€ä¸‹è¿œç¨‹ç™»å½•æ•ˆæœ" class="headerlink" title="èµ¶ç´§æµ‹è¯•ä¸€ä¸‹è¿œç¨‹ç™»å½•æ•ˆæœ"></a>èµ¶ç´§æµ‹è¯•ä¸€ä¸‹è¿œç¨‹ç™»å½•æ•ˆæœ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh ipad</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åä½ ä¼šå‘ç°ä½ å·²ç»å®Œæˆäº†å…å¯†ç ç™»å½•è¶Šç‹±è®¾å¤‡ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å…¶å®è¿™å¹¶ä¸æ˜¯åªæœ‰è¶Šç‹±iOSè®¾å¤‡æ‰èƒ½ä½¿ç”¨çš„å…ç™»å½•ï¼Œè€Œæ˜¯<code>ssh</code>æ‰€æ”¯æŒçš„ã€‚ç”¨é€”ä¹Ÿå¾ˆæ–¹ä¾¿ï½</p>
<p>PS. è¿™é‡Œé¢çš„IPåœ°å€(10.11.12.13) æ˜¯ä½ è®¾å¤‡çš„IPã€‚å¦‚æœè¶…æ—¶çš„è¯æˆ–è€…pingä¸é€šæˆ–è€…ç½‘é€Ÿæ¯”è¾ƒå·®çš„è¯ï¼Œå¯ä»¥é‡‡ç”¨<a href="http://iphonedevwiki.net/index.php/SSH_Over_USB" target="_blank" rel="noopener">usbmux</a>æ–¹æ¡ˆè¿›è¡Œï¼Œæ–‡æ¡£å·²ç›¸å½“è¯¦ç»†ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>æè¿°æ–‡ä»¶è·å–UDID</title>
    <url>/post/ios-tool-configurator-get-udid/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="UDID"><a href="#UDID" class="headerlink" title="UDID"></a>UDID</h3><p>å¯¹ï¼Œå°±æ˜¯åœ¨iTunesç­‰å·¥å…·ä¸Šçœ‹åˆ°çš„UDID..</p>
<a id="more"></a>

<h3 id="å·¥å…·åŠæ–‡æ¡£"><a href="#å·¥å…·åŠæ–‡æ¡£" class="headerlink" title="å·¥å…·åŠæ–‡æ¡£"></a>å·¥å…·åŠæ–‡æ¡£</h3><p>å—¯ï¼ŒAppleå‡ºçš„ä¸ºæ•°ä¸å¤šçš„mac app:<a href="https://itunes.apple.com/cn/app/apple-configurator-2/id1037126344?mt=12" target="_blank" rel="noopener">Apple Configurator 2</a></p>
<p>è¿™ä¸ªå·¥å…·æ˜¯æœ‰ä¸­æ–‡æ–‡æ¡£çš„ï¼š<a href="http://help.apple.com/configurator/mac/2.3/" target="_blank" rel="noopener">Apple Configurator 2 å®˜æ–¹æ–‡æ¡£</a></p>
<p>å½“ç„¶è¿˜æœ‰æ¯”è¾ƒæš´åŠ›çš„ç›´æ¥å†™xml: <a href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/iPhoneOTAConfiguration/ConfigurationProfileExamples/ConfigurationProfileExamples.html" target="_blank" rel="noopener">Appleçš„ç›¸å…³æ–‡æ¡£</a></p>
<hr>
<ul>
<li><a href="http://www.skyfox.org/safari-ios-device-udid.html" target="_blank" rel="noopener">é€šè¿‡Safariæµè§ˆå™¨è·å–iOSè®¾å¤‡UDID(è®¾å¤‡å”¯ä¸€æ ‡è¯†ç¬¦)</a></li>
<li><a href="http://www.skyfox.org/ios-mobileconfig-sign.html" target="_blank" rel="noopener">ä¸ºiOSçš„mobileconfigæ–‡ä»¶è¿›è¡Œç­¾å</a></li>
</ul>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>tool</tag>
        <tag>UDID</tag>
      </tags>
  </entry>
  <entry>
    <title>logio</title>
    <url>/post/logio-brief/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="log-io"><a href="#log-io" class="headerlink" title="log.io"></a>log.io</h1><p><a href="https://madordie.github.io/post/logio-brief-zh-cn/">ä¸­æ–‡</a></p>
<p>Real-time log monitoring in your browser.</p>
<a id="more"></a>

<h1 id="How-does-it-work"><a href="#How-does-it-work" class="headerlink" title="How does it work"></a>How does it work</h1><blockquote>
<p>Harvesters watch log files for changes, send new log messages to the server, which broadcasts to web clients. Log messages are tagged with stream, node, and log level information based on user configuration.</p>
<p>Log.io has no persistence layer. Harvesters are informed of file changes via inotify, and log messages hop from harvester to server to web client via TCP and socket.io, respectively.</p>
<p><img src="/images/2019-05-17-10-03-13.png" alt="work io"></p>
</blockquote>
<h2 id="Activate-streams-amp-nodes-to-watch-log-messages"><a href="#Activate-streams-amp-nodes-to-watch-log-messages" class="headerlink" title="Activate streams &amp; nodes to watch log messages"></a>Activate streams &amp; nodes to watch log messages</h2><blockquote>
<p><img src="/images/2019-05-17-10-12-25.png" alt="Activate streams &amp; nodes to watch log messages"></p>
</blockquote>
<h2 id="Simple-TCP-interface"><a href="#Simple-TCP-interface" class="headerlink" title="Simple TCP interface"></a><a name="Simple TCP interface">Simple TCP interface</a></h2><blockquote>
<p>Log.io uses a stateless TCP API to receive log messages.</p>
<p>Writing a third party harvester is easy. Open a TCP connection to the &gt; server and begin writing properly formatted messages to the socket.</p>
<p>Read the <a href="https://github.com/NarrativeScience/Log.io" target="_blank" rel="noopener">API documentation</a>.</p>
</blockquote>
<h3 id="Send-a-log-message"><a href="#Send-a-log-message" class="headerlink" title="Send a log message"></a>Send a log message</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+log|my_stream|my_node|info|this is log message\r\n</span><br></pre></td></tr></table></figure>

<h3 id="Register-a-new-node-with-stream-associations"><a href="#Register-a-new-node-with-stream-associations" class="headerlink" title="Register a new node, with stream associations"></a>Register a new node, with stream associations</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+node|my_node|my_stream1,my_stream2\r\n</span><br></pre></td></tr></table></figure>

<h3 id="Remove-a-node"><a href="#Remove-a-node" class="headerlink" title="Remove a node"></a>Remove a node</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-node|my_node\r\n</span><br></pre></td></tr></table></figure>

<h1 id="Install-Log-io"><a href="#Install-Log-io" class="headerlink" title="Install Log.io"></a>Install Log.io</h1><p>The original project <a href="https://github.com/NarrativeScience/Log.io" target="_blank" rel="noopener">NarrativeScience/Log.io</a> has been unavailable due to lack of maintenance for a long time.</p>
<p>Fortunately, the <a href="https://github.com/blacklabelops-legacy/logio" target="_blank" rel="noopener">blacklabelops-legacy/logio</a> can also be used.</p>
<p>So we can install the project like thisï¼š</p>
<h2 id="Install-and-start-docker"><a href="#Install-and-start-docker" class="headerlink" title="Install and start docker"></a>Install and start docker</h2><p>The <a href="https://docs.docker.com/install/" target="_blank" rel="noopener">docs.docker.com</a> is very detailed.</p>
<p>Support <a href="https://docs.docker.com/install/" target="_blank" rel="noopener">Cloud</a>ã€ <a href="https://docs.docker.com/docker-for-mac/install/" target="_blank" rel="noopener">MacOS</a> ã€<a href="https://docs.docker.com/install/" target="_blank" rel="noopener">Linux</a> ã€ <a href="https://docs.docker.com/docker-for-windows/install/" target="_blank" rel="noopener">Windows</a></p>
<h2 id="Pull-image"><a href="#Pull-image" class="headerlink" title="Pull image"></a>Pull image</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker pull blacklabelops/logio</span><br></pre></td></tr></table></figure>

<h2 id="Start-the-server"><a href="#Start-the-server" class="headerlink" title="Start the server"></a>Start the server</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">    -p 28778:28778 \</span><br><span class="line">    -p 28777:28777 \</span><br><span class="line">    --name logio \</span><br><span class="line">    blacklabelops/logio</span><br></pre></td></tr></table></figure>

<h2 id="Other-configure"><a href="#Other-configure" class="headerlink" title="Other configure"></a>Other configure</h2><p><a href="https://github.com/blacklabelops-legacy/logio" target="_blank" rel="noopener">blacklabelops-legacy/logio</a>.</p>
<h2 id="Complete"><a href="#Complete" class="headerlink" title="Complete"></a>Complete</h2><p>Browser: <a href="http://localhost:28778/" target="_blank" rel="noopener">http://localhost:28778/</a><br><img src="/images/2019-05-17-10-40-18.png" alt="log.io server"></p>
<p>Now we can write logs to port 28777. ğŸ‰ğŸ‰ğŸ‰</p>
<h1 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h1><p>We only need to perform TCP communication according to the rules <a href="#Simple TCP interface">Simple TCP interface</a>, and the log can be displayed on the browser.</p>
<h2 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h2><p><a href="https://github.com/madordie/logio" target="_blank" rel="noopener">logio for iOS</a></p>
<hr>
<ul>
<li><a href="http://logio.org/" target="_blank" rel="noopener">logio.org</a></li>
</ul>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>tool</tag>
        <tag>logio</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨CollectionViewç®€åŒ–ä»£ç ï¼Œä¸“æ³¨äºä¸šåŠ¡å’ŒUI</title>
    <url>/post/ios-tool-collectionview-simplify-business/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><code>UITableView</code>ä½œä¸ºé«˜çº§æ§ä»¶è¢«å¼€å‘è€…å¹¿æ³›ä½¿ç”¨ï¼ŒåŒæ ·çš„ï¼Œ<code>UICollectionView</code>ç”±äºå…¶NBçš„å¸ƒå±€ä¹Ÿè¢«å¹¿æ³›ä½¿ç”¨ã€‚ä½†æ˜¯åè€…åœ¨ä½¿ç”¨çš„æ—¶å€™å¤§å¤šæ•°éƒ½å±äºè‡ªå®šä¹‰çš„æ¯”è¾ƒå¤šï¼Œå‰è€…åˆ™ç›¸å¯¹æ™®é€šï¼ŒliståŸºæœ¬ä¸Šéƒ½ç”¨ã€‚</p>
<p>åœ¨ä¸šåŠ¡éœ€æ±‚ä¸­ï¼Œå¸¸è§„å¸ƒå±€ï¼Œå¤§å¤šæ•°éƒ½æ˜¯é‡‡ç”¨<code>UITableView</code>è¿›è¡Œçš„ï¼Œä½†æ˜¯æœ‰ç—›ç‚¹ï¼š</p>
<ul>
<li>å½“ä½¿åœ¨APPå†…ç”¨è¿‡ä¸€æ¬¡ç€‘å¸ƒæµä¹‹åï¼Œè®¾è®¡å¸ˆä¼šçªç„¶çš„è®©ä½ åœ¨æ­£å¸¸çš„listä¸­åº•éƒ¨è¿½åŠ ç€‘å¸ƒæµã€‚ã€‚è™½ç„¶æ˜¯åœ¨åº•éƒ¨è¿½åŠ ï¼Œä½†æ˜¯è¦ä»<code>UITableView</code>è¿ç§»åˆ°<code>UICollectionView</code></li>
<li><code>UITableViewDelegate</code>ã€<code>UITableViewDataSource</code> ææ€•æ¯å¤„ä½¿ç”¨éƒ½è¦å†™ç¹ççš„ç›¸åŒçš„ä»£ç å§ï½</li>
<li>å¾ˆå¤šäººä¹Ÿä¼šå¯¹å…¶è¿›è¡Œé«˜åº¦ç¼“å­˜å•Šç¥é©¬çš„ä¼˜åŒ–ç­–ç•¥</li>
<li>ä¸çŸ¥ä¸è§‰è¿™äº›ä»£ç å †åœ¨ä¸€èµ·å·²ç»å°†<code>UIViewController</code>å †çš„ç›¸å½“çš„é«˜</li>
</ul>
<p>ç„¶åå‘¢ï¼Œæˆ‘ä»¬ç°åœ¨ä½¿ç”¨ä¸€ä¸ª<code>CollectionView</code>å°†è¿™äº›æ“ä½œåŒ…è£…ä¸€ä¸‹ï¼Œè¾¾åˆ°è¿™æ ·ä¸€ä¸ªæµç¨‹:</p>
<ol>
<li><p>è‡ªå®šä¹‰Cellã€CellModel</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LabelCell</span>: <span class="title">UICollectionViewCell</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> info = <span class="type">UILabel</span>()</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">sizeThatFits</span><span class="params">(<span class="number">_</span> size: CGSize)</span></span> -&gt; <span class="type">CGSize</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> <span class="type">CGSize</span>(width: size.width, height: info.frame.maxY + info.frame.minY)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LabelCell</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Model</span>: <span class="title">ListItemDefaultProtocol</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> info: <span class="type">String?</span></span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">fillModel</span><span class="params">(view: LabelCell)</span></span> &#123;</span><br><span class="line">            view.info.text = info</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¯·æ±‚ã€å¤„ç†æ•°æ®æ ¼å¼åŒ–ä¸º<code>LabelCell.Model</code>è¿™æ ·çš„ç±»</p>
</li>
<li><p>å¤„ç†å¥½çš„æ•°æ®äº¤ç»™<code>CollectionView</code></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">list.sections = model.format(...)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¼‘æ¯ä¸€ä¼šï¼Œå®Œå·¥äº†ï½</p>
</li>
</ol>
<p>ç„¶åï¼Œæ¥çœ‹çœ‹<code>Collection</code>é‡Œé¢éƒ½åšäº†ä»€ä¹ˆæ“ä½œ</p>
<a id="more"></a>

<h3 id="CollectionView"><a href="#CollectionView" class="headerlink" title="CollectionView"></a>CollectionView</h3><p>ä¸ºäº†è¾¾åˆ°ä¸Šé¢æ•ˆæœä¸­çš„ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª<code>CollectionView</code>æ¥å¤„ç†åˆ·æ–°æ•°æ®ã€è®¾ç½®ä»£ç†ã€è®¾ç½®æ•°æ®æºã€æ³¨å†Œcellã€ç­‰æ“ä½œã€‚</p>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæ­¤å¤„ä½¿ç”¨<a href="https://github.com/chiahsien/CHTCollectionViewWaterfallLayout" target="_blank" rel="noopener"><code>CHTCollectionViewWaterfallLayout</code></a>æ¥å¤„ç†ç€‘å¸ƒæµã€‚</p>
<p>åˆ›å»ºä¸€ä¸ª<code>CollectionViewSection</code>çš„ç±»/ç»“æ„ä½“æ¥ä¿å­˜sectionä¿¡æ¯ã€‚æ¯”å¦‚è¯´ï¼š<code>sectionInset</code>ã€<code>minimumColumnSpacing</code>ã€<code>minimumInteritemSpacing</code>ã€<code>columnCount</code>ã€ç­‰</p>
<p>åœ¨<code>CollectionView</code>ä¸­è®¾ç½®ä¸€ä¸ª<code>var sections = [KTJCollectionViewSection]()</code>ç”¨äºä¿å­˜sections</p>
<p>å®ç°<code>UICollectionViewDataSource</code>ã€ <code>UICollectionViewDelegate</code>ã€‚æ­¤å¤„çœç•¥çº¦1åƒå­—â€¦</p>
<h3 id="ListItemDefaultProtocolï¼šç»‘å®šCellå’ŒModel"><a href="#ListItemDefaultProtocolï¼šç»‘å®šCellå’ŒModel" class="headerlink" title="ListItemDefaultProtocolï¼šç»‘å®šCellå’ŒModel"></a>ListItemDefaultProtocolï¼šç»‘å®šCellå’ŒModel</h3><p>ä¸Šé¢<code>çœç•¥çº¦1åƒå­—</code>ä¸­æœ‰ä¸€ä¸ªå¹¶æ²¡æœ‰è¯´ï¼š<code>CollectionViewSection</code>çš„<code>header</code>ã€<code>items</code>ã€<code>footer</code>å¦‚ä½•å®ç°ã€‚ğŸ˜‚</p>
<p>å¥½äº†ï¼Œæ­¤å¤„è¿™ä¸‰ä¸ªå‡é‡‡ç”¨åè®®<code>ListItemDefaultProtocol</code>æ¥å®ç°ã€‚ï¼ˆPSï¼šå¤§å®¶éƒ½å–œæ¬¢ç”¨çˆ¶ç±»ï¼Œä½†çˆ¶ç±»åªæœ‰ä¸€ä¸ªï¼Œä¸ºäº†å…¼å®¹å’Œå†²çªï¼Œè¿™é‡Œåè®®æ˜¯æœ€å¥½ä¸è¿‡çš„ï½ï¼Œç‰¹åˆ«æ˜¯swiftä¸­çš„åè®®ï¼‰</p>
<p>åè®®éœ€è¦ç»™å‡ºè¿™ä¹ˆå‡ ä¸ªä¿¡æ¯ï¼š</p>
<ul>
<li><code>reuseIdentifier</code> ç”¨æ¥å¤ç”¨çš„é‡ç”¨æ ‡è¯†ç¬¦</li>
<li><code>cellClass</code> ç”¨æ¥æ³¨å†Œç”¨çš„ç±»å</li>
<li><code>func fillModel(item: AnyObject)</code> ç”¨æ¥ç»™cellå¡«å……modelçš„æ–¹æ³•</li>
</ul>
<p>é‚£ä¹ˆè¿™ä¸ªåè®®å°±å‡ºæ¥äº†ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">KTJListItemProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> identifa: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> registClass: <span class="type">AnyClass</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fillModel</span><span class="params">(item: AnyObject)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<strong>swift</strong>åè®®æ”¯æŒé»˜è®¤å®ç°ï¼Œäºæ˜¯ä¹ï¼Œå°±å¯ä»¥å†å†™ä¸€ä¸ª:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ListItemDefaultProtocol</span>: <span class="title">KTJListItemProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">ItemType</span>: <span class="type">UIView</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fillModel</span><span class="params">(view: ItemType)</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ListItemDefaultProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> identifa: <span class="type">String</span> &#123; <span class="keyword">return</span>  <span class="type">NSStringFromClass</span>(<span class="type">ItemType</span>.<span class="keyword">self</span>)&#125;</span><br><span class="line">    <span class="keyword">var</span> registClass: <span class="type">AnyClass</span> &#123; <span class="keyword">return</span> <span class="type">ItemType</span>.<span class="keyword">self</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fillModel</span><span class="params">(item: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> reusableView = item <span class="keyword">as</span>? <span class="type">ItemType</span> &#123;</span><br><span class="line">            fillModel(view: reusableView)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œå°±å¯ä»¥æ„‰å¿«çš„ç©è€äº†ï½ï½</p>
<p>æœ€åCellä¸­çš„çš„ä»£ç æ•ˆæœå°±æ˜¯<a href="https://github.com/madordie/collectionview-simplify-business/blob/master/CollectionView-simplify-business/LabelCell.swift" target="_blank" rel="noopener">è¿™ä¸ªæ ·å­</a>ã€‚<br>å†åŠ ä¸Š<a href="https://github.com/madordie/collectionview-simplify-business/blob/master/CollectionView-simplify-business/ViewController.swift" target="_blank" rel="noopener">æ•°æ®å¡«å……</a>æ˜¯ä¸æ˜¯å¾ˆç®€å•äº†å‘¢ï½ï½</p>
<h3 id="ä»¥åå¦‚ä½•å¼€å‘"><a href="#ä»¥åå¦‚ä½•å¼€å‘" class="headerlink" title="ä»¥åå¦‚ä½•å¼€å‘"></a>ä»¥åå¦‚ä½•å¼€å‘</h3><p>çœŸçš„å¦‚åŒå‰é¢çš„ä¾‹å­ä¸€æ ·ï¼Œåªéœ€è¦è¿™ä¹ˆå‡ æ­¥ç»•ä¸è¿‡å»çš„ï¼š</p>
<ol>
<li>å¤„ç†æ¥å£åå‡ºæ¥çš„æ•°æ®ã€‚</li>
<li>åˆ›å»ºæ–°çš„UIæ ·å¼ï¼Œå¹¶åšå¥½æ¥å£æ•°æ®ä¸­é—´ä»¶ã€‚</li>
<li>ç‚¹å‡»äº‹ä»¶åœ¨å¤„ç†æ•°æ®çš„æ—¶å€™é¢„å…ˆåŸ‹å¥½ï¼Œæ‰€æœ‰çš„æ•°æ®ã€é€»è¾‘å’ŒUIæ•°æ®ä¸€èµ·è¢«ä¼ é€’ï¼Œä¸éœ€è¦å¤šæ¬¡ç±»å‹åˆ¤æ–­ã€‚</li>
</ol>
<p>ç»Ÿä¸€ä½¿ç”¨<code>CollectionView</code>è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼šä¸ç®¡å‰é¢è°å†™çš„ä¸€ä¸ªUIï¼Œéƒ½èƒ½æ‹‰è¿‡æ¥ç”¨ã€‚ä¸ç”¨åšä¸­é—´å±‚å»ä»<code>TableViewCell</code>è½¬<code>CollectionViewCell</code>ã€‚</p>
<p>å¼€å‘åªéœ€è¦å…³å¿ƒä¸šåŠ¡ï¼Œä¸šåŠ¡ã€‚å®‰å®‰å¿ƒå¿ƒåšä¸€ä¸ªå†™ä¸šåŠ¡çš„ç¨‹åºå‘˜å§ï½</p>
<h3 id="å…³äºCellçš„è·³è½¬å¤„ç†"><a href="#å…³äºCellçš„è·³è½¬å¤„ç†" class="headerlink" title="å…³äºCellçš„è·³è½¬å¤„ç†"></a>å…³äºCellçš„è·³è½¬å¤„ç†</h3><p>ä¹ä¸€çœ‹ï¼Œå®Œç¾äº†ã€‚ä¸è¿‡è¿˜æœ‰ä¸€ä¸ªå·¨çƒ¦çš„è·³è½¬å¤„ç†ã€‚ã€‚ã€‚ä¸è¿‡ï¼Œ<strong>è«æ€•</strong></p>
<p>è·³è½¬ï¼Œæœ‰è¿™ä¹ˆå‡ ç§ï¼š</p>
<ul>
<li>æ”¯æŒè·¯ç”±çš„URLè·³è½¬ï¼Œè¿™ä¸ªæ˜¯æœ€ç®€å•çš„ï¼Œä¹Ÿæ˜¯æœ€çˆ½çš„</li>
<li>åªèƒ½å¤æ‚çš„è¿›è¡Œåˆ›å»ºç±»ã€èµ‹å€¼ã€pushå•Šç¥é©¬çš„</li>
</ul>
<p>ç”±äºæˆ‘ä»¬å°†æ•°æ®å…¨éƒ¨å¤„ç†å¥½åæ‰”ç»™äº†<code>cellmodel</code>ï¼Œè€Œè·³è½¬ã€æ‰“ç‚¹æ‰€éœ€è¦çš„å‚æ•°å‡åœ¨æ­¤å¤„ä¸ºæœ€å…¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å›è°ƒä½œä¸ºæ•°æ®ä¸€èµ·ä¼ é€’ã€‚ã€‚</p>
<p>å—¯, äº‹ä»¶éœ€è¦ä¼ é€’çš„å¯¹è±¡å¤§çº¦è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Jmp</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// æ”¯æŒURLè·³è½¬çš„URL</span></span><br><span class="line">    <span class="keyword">let</span> url: <span class="type">String?</span></span><br><span class="line">    <span class="comment">/// æ‰“ç‚¹äº‹ä»¶å</span></span><br><span class="line">    <span class="keyword">let</span> event: <span class="type">String?</span></span><br><span class="line">    <span class="comment">/// æ‰“ç‚¹å‚æ•°</span></span><br><span class="line">    <span class="keyword">let</span> attr: [<span class="type">AnyHashable</span>: <span class="type">Any</span>]?</span><br><span class="line">    <span class="comment">/// ä¸æ”¯æŒURLçš„ç›´æ¥å›è°ƒ</span></span><br><span class="line">    <span class="keyword">let</span> eventCallback: (() -&gt; <span class="type">Void</span>)?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åcellå¯¹åº”çš„å¦ä¸€ä¸ªç±»æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KTJJmp</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> info: <span class="type">Jmp?</span></span><br><span class="line">    <span class="keyword">let</span> action = #selector(topVCJmp)</span><br><span class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">topVCJmp</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ... <span class="comment">// æ‰“ç‚¹</span></span><br><span class="line">        <span class="type">KTJURLJump</span>.jumpToViewOnTopVC(jmp: info)</span><br><span class="line">        info?.eventCallback?()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tap</span><span class="params">()</span></span> -&gt; <span class="type">UITapGestureRecognizer</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">UITapGestureRecognizer</span>(target: <span class="keyword">self</span>, action: #selector(topVCJmp))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªç±»å…±åŒä½œç”¨å°±æ˜¯ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JmpCell</span>: <span class="title">UICollectionViewCell</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> jmp = <span class="type">JmpCellModel</span>()</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        jmpBtn.addTarget(jmp, action: jmp.action, <span class="keyword">for</span>: .touchUpInside)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JmpCellModel</span>: <span class="title">ListItemDefaultProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> jmp: <span class="type">Jmp?</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fillModel</span><span class="params">(view: JmpCell)</span></span> &#123;</span><br><span class="line">        view.jmp.info = jmp</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡³äºè¿™ä¸ª<code>JmpCellModel.jmp</code>æ€ä¹ˆç”Ÿæˆï¼Œè¿™é‡Œå°±ä¸è¯´äº†ã€‚</p>
<h3 id="å…³äºç®—é«˜é‚£ç‚¹äº‹"><a href="#å…³äºç®—é«˜é‚£ç‚¹äº‹" class="headerlink" title="å…³äºç®—é«˜é‚£ç‚¹äº‹"></a>å…³äºç®—é«˜é‚£ç‚¹äº‹</h3><h4 id="ç®—é«˜ä½ç½®çš„é€‰æ‹©"><a href="#ç®—é«˜ä½ç½®çš„é€‰æ‹©" class="headerlink" title="ç®—é«˜ä½ç½®çš„é€‰æ‹©"></a>ç®—é«˜ä½ç½®çš„é€‰æ‹©</h4><p>æˆ‘ä¹Ÿæ›¾çº ç»“è¿‡frameçš„ä»£ç åº”è¯¥å†™åœ¨å“ªé‡Œã€‚ã€‚æœ‰å†™åœ¨åˆå§‹åŒ–çš„ï¼Œæœ‰å•ç‹¬å†™ä¸€ä¸ªæ–¹æ³•çš„ï¼Œè¿˜æœ‰å†™åœ¨<code>func sizeThatFits(:) -&gt; CGSize</code></p>
<p>ç”±äºå½“å¹´å¯¹<a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell" target="_blank" rel="noopener">UITableView-FDTemplateLayoutCell</a>ä¸­æ¯’è¾ƒæ·±ï¼Œæ‰€ä»¥æ²¿ç”¨äº†æœ€åä¸€ç§æ–¹æ¡ˆã€‚</p>
<h4 id="ç®—é«˜ä½¿ç”¨çš„viewçš„é€‰æ‹©"><a href="#ç®—é«˜ä½¿ç”¨çš„viewçš„é€‰æ‹©" class="headerlink" title="ç®—é«˜ä½¿ç”¨çš„viewçš„é€‰æ‹©"></a>ç®—é«˜ä½¿ç”¨çš„viewçš„é€‰æ‹©</h4><p>åœ¨ç®—é«˜çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼š<strong>é«˜åº¦æ˜¯æ•°æ®å’Œå½“å‰æœ€å¤§å®½åº¦å…±åŒå†³å®šçš„</strong>ï¼Œæ‰€ä»¥åœ¨ç®—é«˜çš„æ—¶å€™éœ€è¦æ‹¿ç€æ•°æ®ã€viewç„¶åæ‰èƒ½å»ç®—é«˜ï¼ˆPSï¼šè‡³äºé‚£äº›æ‹¿ç€æ•°æ®ç¡¬ç®—å‡ºä¸€ä¸ªé«˜åº¦çš„ä»£ç ï¼Œæ­¤å¤„ä¸å‘è¡¨çœ‹æ³•ğŸ˜‚ï¼Œæ—©æ™šä¼šåæ‚”çš„ï¼‰</p>
<p>ç„¶åå°±æ˜¯<code>UITableView</code>ã€<code>UICollectionView</code>çš„ç®—é«˜æ˜¯é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ä»£ç†å»è·å–çš„ï¼Œå¹¶ä¸æä¾›viewå»è®¡ç®—ã€‚ã€‚è¿™å°±æ˜¯çŸ›ç›¾çš„åœ°æ–¹ã€‚</p>
<p>è™½ç„¶<code>UITableView</code>ã€<code>UICollectionView</code>åœ¨ç®—é«˜çš„åœ°æ–¹ä¸æä¾›View,ä½†æ˜¯æœ‰ä¸€ä¸ª<code>dequeueReusableCell....</code>çš„æ–¹æ³•å¯ä»¥è·å–åˆ°ç¼“å­˜æ± ä¸­çš„<code>Cell</code>å‘€</p>
<p>å¦‚æœä½ è¿™æ ·åšäº†ï¼Œé‚£ä¹ˆä½ å°†ä¼šä»˜å‡ºæƒ¨é‡çš„ä»£ç ã€‚è¿™ä¸ªæ–¹æ¡ˆæˆ‘åœ¨<a href="http://www.cnblogs.com/madordie" target="_blank" rel="noopener">åšå®¢å›­</a>2015.03.17çš„<a href="http://www.cnblogs.com/madordie/p/4344209.html" target="_blank" rel="noopener">â€œiOS ä¼˜åŒ–æ€§èƒ½ä¹‹TableViewâ€</a>ä¸­å·²ç»è¯´äº†ï¼š</p>
<blockquote>
<p>dequeueReusableCellWithIdentifier:æ­¤å‡½æ•°çš„è°ƒç”¨è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š<br>    i.æ­¤å‡½æ•°çš„è¿”å›å€¼æ˜¯åšä¸ºtableView:cellForRowAtIndexPath:çš„è¿”å›å€¼çš„ã€‚è¿™æ ·ä¿è¯æ‹¿å‡ºæ¥çš„å®Œæ•´è¿˜ç»™TableViewã€‚<br>    ii.å¦‚æœæ­¤å‡½æ•°çš„è¿”å›å€¼ä¸æ˜¯ä¸ºäº†ç»™tableView:cellForRowAtIndexPath:åšè¿”å›å€¼ï¼Œé‚£ä¹ˆä½ è¦æ³¨æ„è¿™æ˜¯åœ¨ä¸€ä¸ªæ‹¿å–åˆ«äººç¨€ç¼ºèµ„æºçš„æ“ä½œï¼Œéœ€è¦æ³¨æ„çæƒœè¿™ä¸ªè¿”å›å€¼ï¼Œèƒ½ä¸æµªè´¹å°±ä¸è¦æµªè´¹ã€‚<br>    iii.å¯¹äºALè‡ªåŠ¨é€‚åº”çš„TableViewå–Cellæ—¶å€™è¦æ³¨æ„ä¿å­˜ã€‚ä¸ªäººå»ºè®®å°è£…TableViewï¼Œç„¶åç”¨æ¥è®¡ç®—é«˜åº¦çš„Cellä¿å­˜åœ¨TableViewä¸­ã€‚å¯¹äºå¤šç§ç±»å‹çš„Cellï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¤ç”¨æ ‡è¯†ç¬¦ä½œä¸ºKeyçš„å­—å…¸æ¥å­˜å‚¨ã€‚è¿™æ ·èƒ½å¤Ÿæœ‰æ•ˆèŠ‚çº¦dequeueReusableCellWithIdentifier:è°ƒç”¨æ¬¡æ•°ã€‚</p>
</blockquote>
<p><code>UICollectionView</code>ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥ä½¿ç”¨<code>dequeueReusableCell....</code>æ–¹æ³•æ˜¯<strong>å¾ˆä¸é è°±çš„</strong>ã€‚</p>
<p>åœ¨<a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell/blob/912b3ce4a61198c0b79a3d85b977f8fdacd153ea/Classes/UITableView%2BFDTemplateLayoutCell.m#L134-#L155" target="_blank" rel="noopener">UITableView-FDTemplateLayoutCell</a>ä¸­ä½¿ç”¨äº†å­—å…¸ä¿å­˜ç¼“å­˜ç®—é«˜çš„Viewï¼Œä¹Ÿæ˜¯æ¯”è¾ƒèµçš„ã€‚</p>
<p>ä½†æ˜¯ç°åœ¨æœ‰äº†<code>CollectionView</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨OCçš„<code>objc_setAssociatedObject(,,,)</code>å»å¤„ç†è€Œç›´æ¥ä½¿ç”¨äº†<code>NSCache</code>å»å¤„ç†å°±è¡Œäº†ï½</p>
<p>å¦‚æœçœ‹äº†<a href="https://github.com/madordie/collectionview-simplify-business/blob/master/CollectionView.swift" target="_blank" rel="noopener"><code>CollectionView</code></a>å°±ä¼šå‘ç°ï¼Œ<code>ListItemProtocol</code>è¿˜æœ‰ä¸€ä¸ªgetæ–¹æ³•<code>var newItem: AnyObject { get }</code>è¿™ä¸ªæ˜¯ç”¨æ¥ç®—é«˜çš„ã€‚</p>
<p>åœ¨<a href="https://github.com/madordie/collectionview-simplify-business/blob/master/CollectionView.swift" target="_blank" rel="noopener">CollectionView.swift</a>å…³äºé«˜åº¦çš„ä»£ç†è®¾ç½®ä¸­å¯ä»¥çœ‹åˆ°ç›¸å…³è·å–å’Œè®¾ç½®ã€‚</p>
<h4 id="ç®—é«˜çš„æ—¶å€™å˜å±€çš„æ§åˆ¶"><a href="#ç®—é«˜çš„æ—¶å€™å˜å±€çš„æ§åˆ¶" class="headerlink" title="ç®—é«˜çš„æ—¶å€™å˜å±€çš„æ§åˆ¶"></a>ç®—é«˜çš„æ—¶å€™å˜å±€çš„æ§åˆ¶</h4><p>é«˜åº¦çš„è®¡ç®—ç°åœ¨å·²ç»å¯ä»¥æ­£å¸¸è®¡ç®—ï¼Œä½†æ˜¯å¯¹äº<code>columnCount &gt; 1</code>çš„æ—¶å€™ï¼Œç‰µæ‰¯åˆ°é—´éš™çš„è®¡ç®—éœ€è¦æ³¨æ„ä¸€æ¬¡å•Šã€‚æ¯•ç«Ÿ<code>CHTCollectionViewWaterfallLayout</code>åŠŸèƒ½æ›´å¼ºå¤§ã€‚</p>
<p>ç›¸å…³ä»£ç åœ¨<a href="https://github.com/madordie/collectionview-simplify-business/blob/master/CollectionView.swift" target="_blank" rel="noopener">CollectionView.swift</a>çš„<code>func collectionView(:,layout:,sizeForItemAt:) -&gt; CGSize</code>å‡½æ•°ä¸­ã€‚</p>
<h3 id="å…³äºä»£ç†é‚£ç‚¹äº‹"><a href="#å…³äºä»£ç†é‚£ç‚¹äº‹" class="headerlink" title="å…³äºä»£ç†é‚£ç‚¹äº‹"></a>å…³äºä»£ç†é‚£ç‚¹äº‹</h3><p>ä¸«çš„ï¼Œéœ€æ±‚æ€»æ˜¯æ¯”æƒ³çš„å¤šï¼Œä½†æ˜¯åŠæ³•ä¹Ÿæ¯”é—®é¢˜å¤šã€‚</p>
<p>å¯¹äº<code>CollectionView</code>æ¥è¯´ï¼Œä»£ç†éƒ½è®¾ç½®æˆäº†selfï¼Œè¿™æ ·ä¼šå¯¼è‡´æœ‰æ—¶å€™éœ€è¦<code>UIScrollViewDelegate</code>å¹²äº›äº‹æƒ…çš„æ—¶å€™æ€»æ˜¯ä¸é‚£ä¹ˆè‡ªç”±ã€‚ã€‚ã€‚å®ä¹ƒæ–°ç—›ç‚¹ï¼Œä¸è¿‡æœ‰åŠæ³•ã€‚</p>
<p>ä¸‹é¢æ˜¯å‡ ç§æ–¹æ¡ˆï¼š</p>
<h4 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h4><p>ç›´æ¥KVOåˆ°<code>self.contentOffset</code>ï¼Œè¿™æ ·ä¸€äº†ç™¾äº†ã€‚å†™ä»€ä¹ˆä»£ç†ï¼Œè¦ä»€ä¹ˆè‡ªè¡Œè½¦ï¼ï¼ˆPSï¼šswiftæä¾›é—­åŒ…çš„ä»£ç†ï¼Œä¹Ÿæ˜¯å¾ˆå¥½ç”¨çš„ï¼‰</p>
<p>å¦‚æœä¸ä¼šï¼Œè¯·è‡ªè¡Œ<a href="https://www.google.com/" target="_blank" rel="noopener">Google</a>ã€‚<a href="https://objccn.io/issue-7-3/" target="_blank" rel="noopener">ObjC-ä¸­å›½ï¼šKVC å’Œ KVO</a>ï¼Œæˆ‘åªèƒ½å¸®ä½ åˆ°è¿™é‡Œ</p>
<h4 id="Rxç³»"><a href="#Rxç³»" class="headerlink" title="Rxç³»"></a>Rxç³»</h4><p>å¾ˆæŠ±æ­‰ï¼Œä½ ä¸èƒ½ç”¨<code>self.rx.contentOffset</code>ã€‚åŸå› æ˜¯<a href="https://github.com/chiahsien/CHTCollectionViewWaterfallLayout" target="_blank" rel="noopener"><code>CHTCollectionViewWaterfallLayout</code></a>ä¸­æœ‰è¿™ä¹ˆä¸€è¡Œæ–­è¨€ï¼š</p>
<blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">NSAssert</span>([<span class="keyword">self</span>.delegate conformsToProtocol:@<span class="class"><span class="keyword">protocol</span>(<span class="title">CHTCollectionViewDelegateWaterfallLayout</span>)], @"<span class="title">UICollectionView</span>'<span class="title">s</span> <span class="title">delegate</span> <span class="title">should</span> <span class="title">conform</span> <span class="title">to</span> <span class="title">CHTCollectionViewDelegateWaterfallLayout</span> <span class="title">protocol</span>"); </span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>ä½†æ˜¯</strong>ï¼Œä½ å¯ä»¥ä½¿ç”¨Rxé‡Œé¢çš„KVOå‘€ï½ä¹Ÿæ˜¯è´¼æ–¹ä¾¿</p>
<h4 id="RACç³»"><a href="#RACç³»" class="headerlink" title="RACç³»"></a>RACç³»</h4><p>æŠ±æ­‰ï¼Œæˆ‘ä¸ä¼šã€‚åŸå› åœ¨æ­¤<a href="../reactivecocoa-ready-to-use">å‡†å¤‡é£Ÿç”¨RAC(ReactiveCocoa)çš„é¡¾è™‘</a></p>
<h4 id="ä»£ç†ä¼ é€’"><a href="#ä»£ç†ä¼ é€’" class="headerlink" title="ä»£ç†ä¼ é€’"></a>ä»£ç†ä¼ é€’</h4><p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç†è¿›è¡Œä¼ é€’å‡ºå»ã€‚å¤§è‡´è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">CollectionViewDelegate</span>: <span class="title">NSObjectProtocol</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath)</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollectionView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> allDelegate: <span class="type">CollectionViewDelegate?</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.allDelegate?.collectionView(<span class="keyword">self</span>, didSelectItemAt: indexPath)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ–¹æ¡ˆæ²¡å•¥èŠçš„ã€‚ã€‚</p>
<h3 id="OCå’‹åŠï¼Ÿ"><a href="#OCå’‹åŠï¼Ÿ" class="headerlink" title="OCå’‹åŠï¼Ÿ"></a>OCå’‹åŠï¼Ÿ</h3><p>è¿™ä¸ªOCä¹Ÿèƒ½ç”¨ï¼Œåªä¸è¿‡éœ€è¦ä¸€äº›æ‰‹æ®µï¼Œæ¯”å¦‚è¯´ï¼šç»§æ‰¿ã€æ‰©å±•ã€ç­‰</p>
<p><code>ListItemProtocol</code>å°±æ˜¯ä¸ºäº†ç»™OCä½¿ç”¨ç•™çš„ï¼Œè¿˜æœ‰å°±æ˜¯<code>CollectionViewSection</code>ä½¿ç”¨äº†ç±»ï¼Œè€Œä¸æ˜¯ç»“æ„ä½“ã€‚</p>
<p>ä¸è¿‡å…·ä½“æ²¡æœ‰ä¾‹å­ï¼Œä¸æƒ³å†™OCä»£ç ï¼Œå¤ªéº»çƒ¦äº†ã€‚ã€‚ä¸»è¦æ˜¯è¿™ç§æ€è·¯:)</p>
<h3 id="å¡«å……Cellçš„æ•°æ®ä¸ºä»€ä¹ˆä¼šåœ¨CellModelä¸­ï¼Ÿ"><a href="#å¡«å……Cellçš„æ•°æ®ä¸ºä»€ä¹ˆä¼šåœ¨CellModelä¸­ï¼Ÿ" class="headerlink" title="å¡«å……Cellçš„æ•°æ®ä¸ºä»€ä¹ˆä¼šåœ¨CellModelä¸­ï¼Ÿ"></a>å¡«å……Cellçš„æ•°æ®ä¸ºä»€ä¹ˆä¼šåœ¨CellModelä¸­ï¼Ÿ</h3><p>å¯¹äºCellæ¥è¯´ï¼ŒCellæ˜¯å¹²å‡€çš„ï¼Œæ²¡æœ‰ä»»ä½•ç»§æ‰¿ã€åè®®æ¥é™åˆ¶Cellå¦‚ä½•å¤„ç†ã€‚é‚£ä¹ˆCellå°±å¯ä»¥æ¥å—æ¥è‡ªä»»ä½•æ¨¡å—çš„å„ç§é£æ ¼çš„Cellï¼Œè¿™æ˜¯æˆ‘æƒ³è¦çš„å‡å°‘ä¾µå…¥ã€‚</p>
<p>cellModelä¸­å®šä¹‰äº†Cellæ‰€å¯¹åº”çš„å¡«å……æ•°æ®æ ¼å¼ï¼Œåœ¨ç¬¬ä¸€æ¬¡å†™çš„æ—¶å€™éš¾å…ä¼šæŒ‰ç…§ä¸šåŠ¡é€»è¾‘èµ·ä¸€äº›ä¸šåŠ¡é€»è¾‘çš„åå­—ï¼Œåœ¨å¤ç”¨çš„æ—¶å€™åˆä¸èƒ½æ”¹åå­—ï¼Œä¼šå¯¹ç»´æŠ¤å’Œå¼€å‘åŠ äº†ä¸€å®šé‡çš„å¤æ‚åº¦ï¼Œè¿™ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚ã€‚</p>
<p>äºæ˜¯ä¹æ¯ä¸ªCellModelæ ¹æ®è‡ªå·±çš„éœ€è¦ç»‘å®šéœ€è¦ç»‘å®šçš„Cellï¼Œå»å¡«å……Cellæ‰€å¯¹åº”çš„æ•°æ®å°±å¥½ã€‚åªéœ€è¦ä¾µå…¥cellModelå³å¯ã€‚ä»£ä»·æœ€å°ï¼Œå—ç›Šæœ€å¤§ã€‚</p>
<p>PS.å¯¹äºåŒä¸€ä¸ªListï¼Œéœ€è¦æ³¨æ„cellçš„å¤ç”¨å’Œå¤šä¸ªcellModelåŒæ—¶ç»‘å®šä¸€ä¸ªcellæ—¶ï¼Œå±æ€§çš„è®¾ç½®ã€‚</p>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p><a href="https://github.com/madordie/collectionview-simplify-business" target="_blank" rel="noopener">Demo</a>éƒ¨åˆ†æ²¡æœ‰å†™è·³è½¬ç›¸å…³å†…å®¹ï¼Œä½†æ˜¯åˆ«çš„éƒ½æœ‰äº†ğŸ˜‚</p>
<h3 id="åˆ«çš„"><a href="#åˆ«çš„" class="headerlink" title="åˆ«çš„"></a>åˆ«çš„</h3><p>å¥½åƒæ²¡äº†å§ï½ï¼Œæƒ³èµ·æ¥äº†å†è¡¥å……å’¯</p>
<h3 id="å¶ç„¶çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼çš„æ–‡ç« "><a href="#å¶ç„¶çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼çš„æ–‡ç« " class="headerlink" title="å¶ç„¶çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼çš„æ–‡ç« "></a>å¶ç„¶çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼çš„æ–‡ç« </h3><blockquote>
<p><a href="https://www.appcoda.com.tw/tableview-mvvm/" target="_blank" rel="noopener">Table View å¤ªè¤‡é›œï¼Ÿåˆ©ç”¨ MVVM å’Œ Protocol å°±å¯ä»¥ç‚ºå®ƒé‡æ§‹ç˜¦èº«ï¼</a></p>
</blockquote>
<p>æ˜¨å¤©(2018.7.24)ç¿»æ–‡ç« çš„æ—¶å€™çœ‹åˆ°è¿™ä¸ªæ–‡ç« ï¼Œç„¶åå°†æ–‡ç« å’Œä»£ç æ‹äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™æ‰æ˜¯MVVMå§ã€‚è§‰å¾—ä¸é”™ï¼Œè´´å‡ºæ¥ï½</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>tool</tag>
        <tag>UICollectionView</tag>
      </tags>
  </entry>
  <entry>
    <title>å®æ—¶æ˜¾ç¤ºæ—¥å¿—logio</title>
    <url>/post/logio-brief-zh-cn/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="log-io"><a href="#log-io" class="headerlink" title="log.io"></a>log.io</h1><p><a href="https://madordie.github.io/post/logio-brief/">English</a></p>
<p>ä¸€ä¸ªèƒ½åœ¨æµè§ˆå™¨ä¸Šå®æ—¶æ˜¾ç¤ºæ—¥å¿—çš„å·¥å…·ã€‚</p>
<a id="more"></a>

<h1 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h1><p>ä»¥ä¸‹æ‘˜è‡ª<a href="http://logio.org/" target="_blank" rel="noopener">logio.org</a>ï¼Œæˆ‘è§‰å¾—å·²ç»éå¸¸çš„è¯¦ç»†äº†ï¼Œè¿™é‡Œå°±ä¸å•°å—¦äº†ã€‚</p>
<blockquote>
<p>Harvesters watch log files for changes, send new log messages to the server, which broadcasts to web clients. Log messages are tagged with stream, node, and log level information based on user configuration.</p>
<p>Log.io has no persistence layer. Harvesters are informed of file changes via inotify, and log messages hop from harvester to server to web client via TCP and socket.io, respectively.</p>
<p><img src="/images/2019-05-17-10-03-13.png" alt="work io"><br><img src="/images/2019-05-17-10-12-25.png" alt="Activate streams &amp; nodes to watch log messages"></p>
</blockquote>
<h2 id="é€šä¿¡ä½¿ç”¨çš„TCPæ¥å£"><a href="#é€šä¿¡ä½¿ç”¨çš„TCPæ¥å£" class="headerlink" title="é€šä¿¡ä½¿ç”¨çš„TCPæ¥å£"></a><a name="Simple TCP interface">é€šä¿¡ä½¿ç”¨çš„TCPæ¥å£</a></h2><blockquote>
<p>Log.io uses a stateless TCP API to receive log messages.</p>
<p>Writing a third party harvester is easy. Open a TCP connection to the &gt; server and begin writing properly formatted messages to the socket.</p>
<p>Read the <a href="https://github.com/NarrativeScience/Log.io" target="_blank" rel="noopener">API documentation</a>.</p>
</blockquote>
<h3 id="æ¶ˆæ¯å‘é€"><a href="#æ¶ˆæ¯å‘é€" class="headerlink" title="æ¶ˆæ¯å‘é€"></a>æ¶ˆæ¯å‘é€</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+log|my_stream|my_node|info|this is log message\r\n</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨å†Œä¸€ä¸ªæ–°çš„nodeå’Œstream"><a href="#æ³¨å†Œä¸€ä¸ªæ–°çš„nodeå’Œstream" class="headerlink" title="æ³¨å†Œä¸€ä¸ªæ–°çš„nodeå’Œstream"></a>æ³¨å†Œä¸€ä¸ªæ–°çš„nodeå’Œstream</h3><p>å¦‚æœåŸæ¥å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆè¿˜æ˜¯åŸæ¥çš„é‚£ä¸ªã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+node|my_node|my_stream1,my_stream2\r\n</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤node"><a href="#åˆ é™¤node" class="headerlink" title="åˆ é™¤node"></a>åˆ é™¤node</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-node|my_node\r\n</span><br></pre></td></tr></table></figure>

<h1 id="å®‰è£…Log-ioæœåŠ¡ç«¯"><a href="#å®‰è£…Log-ioæœåŠ¡ç«¯" class="headerlink" title="å®‰è£…Log.ioæœåŠ¡ç«¯"></a>å®‰è£…Log.ioæœåŠ¡ç«¯</h1><p>è¿™ä¸ªå¹´ä¹…å¤±ä¿®çš„åŸå§‹é¡¹ç›®<a href="https://github.com/NarrativeScience/Log.io" target="_blank" rel="noopener">NarrativeScience/Log.io</a>å·²ç»æ²¡åŠæ³•æ­£å¸¸å·¥ä½œäº†ã€‚ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œdockerç‰ˆæœ¬çš„<a href="https://github.com/blacklabelops-legacy/logio" target="_blank" rel="noopener">blacklabelops-legacy/logio</a>è¿˜å¯ä»¥ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç”¨è¿™ä¸ªå§ã€‚</p>
<h2 id="å®‰è£…å¹¶å¼€å¯docker"><a href="#å®‰è£…å¹¶å¼€å¯docker" class="headerlink" title="å®‰è£…å¹¶å¼€å¯docker"></a>å®‰è£…å¹¶å¼€å¯docker</h2><p>dockerçš„æ–‡æ¡£<a href="https://docs.docker.com/install/" target="_blank" rel="noopener">docs.docker.com</a>ä¾æ—§éå¸¸è¯¦ç»†ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯æ”¯æŒçš„å¹³å°æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š<a href="https://docs.docker.com/install/" target="_blank" rel="noopener">Cloud</a>ã€ <a href="https://docs.docker.com/docker-for-mac/install/" target="_blank" rel="noopener">MacOS</a> ã€<a href="https://docs.docker.com/install/" target="_blank" rel="noopener">Linux</a> ã€ <a href="https://docs.docker.com/docker-for-windows/install/" target="_blank" rel="noopener">Windows</a></p>
<h2 id="pull-é•œåƒ"><a href="#pull-é•œåƒ" class="headerlink" title="pull é•œåƒ"></a>pull é•œåƒ</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker pull blacklabelops/logio</span><br></pre></td></tr></table></figure>

<h2 id="å¼€å¯æœåŠ¡"><a href="#å¼€å¯æœåŠ¡" class="headerlink" title="å¼€å¯æœåŠ¡"></a>å¼€å¯æœåŠ¡</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">    -p 28778:28778 \</span><br><span class="line">    -p 28777:28777 \</span><br><span class="line">    --name logio \</span><br><span class="line">    blacklabelops/logio</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒåŸæ–‡æ¡£<a href="https://github.com/blacklabelops-legacy/logio" target="_blank" rel="noopener">blacklabelops-legacy/logio</a>ä¸­æ˜¯æ²¡æœ‰<code>-p 28777:28777</code>å‚æ•°çš„ï¼Œä¼šå¯¼è‡´å…¶28777ç«¯å£æ— å“åº”ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªæ‰‹è¯¯æˆ–è€…ç‰¹æ®Šéœ€è¦ï¼Ÿåæ­£è¿™é‡Œæ‰“å¼€å°±å¥½äº†ã€‚</p>
<h2 id="å…¶ä»–é…ç½®"><a href="#å…¶ä»–é…ç½®" class="headerlink" title="å…¶ä»–é…ç½®"></a>å…¶ä»–é…ç½®</h2><p>å…¶ä»–é…ç½®åœ¨<a href="https://github.com/blacklabelops-legacy/logio" target="_blank" rel="noopener">blacklabelops-legacy/logio</a>ä¸­ä¹Ÿå¾ˆè¯¦ç»†ğŸ˜‚ï¼Œéœ€è¦çš„è¯·è‡ªå–ã€‚æ¯”å¦‚è¯´æ—¥å¿—ã€httpsã€ç­‰</p>
<h2 id="æœ€ç»ˆæ•ˆæœå›¾"><a href="#æœ€ç»ˆæ•ˆæœå›¾" class="headerlink" title="æœ€ç»ˆæ•ˆæœå›¾"></a>æœ€ç»ˆæ•ˆæœå›¾</h2><p>åœ¨æµè§ˆå™¨ä¸Šæ‰“å¼€<a href="http://localhost:28778/%E5%8D%B3%E5%8F%AF%E3%80%82%EF%BC%88localhost" target="_blank" rel="noopener">http://localhost:28778/å³å¯ã€‚ï¼ˆlocalhost</a> æ˜¯å®‰è£…serverçš„IPï¼‰<br><img src="/images/2019-05-17-10-40-18.png" alt="log.io server"></p>
<p>äºæ˜¯ä¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘localhost:28778ç–¯ç‹‚çš„å†™æ—¥å¿—äº†. ğŸ‰ğŸ‰ğŸ‰</p>
<h1 id="æ”¯æŒçš„æ’ä»¶"><a href="#æ”¯æŒçš„æ’ä»¶" class="headerlink" title="æ”¯æŒçš„æ’ä»¶"></a>æ”¯æŒçš„æ’ä»¶</h1><p>è¿™ä¸ªæ—¥å¿—æœåŠ¡<a href="#Simple TCP interface">å¯¹å¤–æ¥å£</a>æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ¥è®²ï¼Œåªéœ€è¦å¯ä»¥è¿›è¡ŒTCPé€šä¿¡çš„åŒ…å‡å¯ä»¥æ”¯æŒï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå®‰å“ã€iOSã€‚</p>
<h2 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h2><p><a href="https://github.com/madordie/logio" target="_blank" rel="noopener">iOSç‰ˆæœ¬</a>åŸºäº<a href="https://cocoapods.org/" target="_blank" rel="noopener">CocoaPods</a>çš„é¡¹ç›®åªéœ€è¦åœ¨Podfileä¸­æ·»åŠ ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">pod <span class="string">'LogIO'</span>, <span class="symbol">:git</span> =&gt; <span class="string">'https://github.com/madordie/logio.git'</span></span><br></pre></td></tr></table></figure>

<p>å…¶iOSç‰ˆæœ¬å·²ç»æ”¾åœ¨äº†è¿™é‡Œï¼š<a href="https://github.com/madordie/logio" target="_blank" rel="noopener">madordie/logio</a></p>
<p>iOSä¸Šä¹‹å‰æœ‰ä¸€ä¸ªç±»ä¼¼çš„<a href="https://github.com/s4nchez/LogIO-CocoaLumberjack" target="_blank" rel="noopener">LogIO-CocoaLumberjack</a>, æˆ‘è¿™é‡Œåšäº†ç®€å•çš„æ›´æ–°ï¼Œç›®çš„æ˜¯ä¸ç»‘å®š<a href="https://github.com/robbiehanson/CocoaAsyncSocket" target="_blank" rel="noopener">CocoaAsyncSocket</a>ã€‚</p>
<hr>
<ul>
<li><a href="http://logio.org/" target="_blank" rel="noopener">logio.org</a></li>
</ul>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>tool</tag>
        <tag>logio</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Œè½¬ã€ä¸€ä¸ªNBçš„è¡¥æ•‘é¡¹ç›®å›½é™…åŒ–çš„æ–¹æ¡ˆ</title>
    <url>/post/yi-ge-nb-de-bu-jiu-xiang-mu-guo-ji-hua-de-fang-an/</url>
    <content><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p><a href="http://www.devashen.com/blog/2016/01/15/localized02/" target="_blank" rel="noopener">â€ƒiOS å¤šè¯­è¨€ç‰ˆæœ¬çš„å¼€å‘ï¼ˆäºŒï¼‰</a> ä¸­æˆ‘ä»¬å®ç°äº†å¦‚ä½•è®©ç”¨æˆ·è‡ªå·±å»åˆ‡æ¢ç³»ç»Ÿè¯­è¨€çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬è¿˜å†™äº†<a href="https://github.com/Ashen-Zhao/easyLocalized" target="_blank" rel="noopener">Demo</a> ä»¥ä¾›è¾…åŠ©å­¦ä¹ ï¼›ä½†æ˜¯ï¼Œç»§ä»¥ä¸Šä¸¤ç¯‡æ–‡ç« éƒ½æ˜¯å»ºç«‹åœ¨é¡¹ç›®åˆšåˆšå¯åŠ¨æˆ–å¯åŠ¨ä¸ä¹…ï¼Œé¡¹ç›®ä¸­å­˜åœ¨çš„ä¸­æ–‡å­—ç¬¦ä¸²è¿˜ä¸æ˜¯å¾ˆå¤šï¼Œæ‰‹åŠ¨æ”¹èµ·æ¥ä¹Ÿè¿˜å¯ä»¥æ¥å—; é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœé¡¹ç›®å·²ç»ç«£å·¥æˆ–è€…å·²ç»è¿­ä»£å‡ ä¸ªç‰ˆæœ¬äº†ï¼Œé‚£è¯¥å¦‚ä½•å®ç°äº†ï¼Ÿæ‰‹åŠ¨æ”¹èµ·æ¥ä¹Ÿä¸å¤ªç°å®ï¼Œè€—æ—¶è€—åŠ›ä¸è®¨å¥½çš„æ‰‹åŠ¨ï¼Œåœ¨è¿™é‡Œå°±ä¸ç”¨è€ƒè™‘äº†ã€‚ ä¸è®©è€ƒè™‘ï¼Œæ˜¯å› ä¸ºæˆ‘æœ‰æ›´ç®€å•å¿«æ·é«˜æ•ˆçš„æ–¹æ³•ï¼Œè®©æˆ‘æ…¢æ…¢ä¸æ‚¨é“æ¥ï¼›</p>
<h2 id="å¦‚ä½•è¾¨åˆ«é¡¹ç›®ä¸­çš„ä¸­æ–‡å­—ç¬¦ä¸²"><a href="#å¦‚ä½•è¾¨åˆ«é¡¹ç›®ä¸­çš„ä¸­æ–‡å­—ç¬¦ä¸²" class="headerlink" title="å¦‚ä½•è¾¨åˆ«é¡¹ç›®ä¸­çš„ä¸­æ–‡å­—ç¬¦ä¸²?"></a>å¦‚ä½•è¾¨åˆ«é¡¹ç›®ä¸­çš„ä¸­æ–‡å­—ç¬¦ä¸²?</h2><p>â€ƒæ—¢ç„¶è¦æ›¿æ¢é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå‰æå°±å¿…é¡»è¦å…ˆæ‰¾åˆ°è¿™äº›ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åå°†è¿™äº›å­—ç¬¦ä¸²ï¼Œæ›¿æ¢æˆæˆ‘ä»¬å®šä¹‰çš„å®ï¼Œ ä¸ºäº†æ›¿æ¢æ–¹ä¾¿ï¼Œå¯å°†è¿™äº›å­—ç¬¦ä¸²è‡ªèº«ä½œä¸ºkeyï¼Œ è¿™é‡Œä¸ç†è§£çš„ä¸è¦ç´§ï¼Œä¸‹é¢æˆ‘è¿˜ä¼šè®²åˆ°ã€‚ æ—¢ç„¶æ˜¯è¾¨åˆ«ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´åœ¨é¡¹ç›®æ–‡ä»¶ä¸­è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾ï¼Œè¯´åˆ°åŒ¹é…ï¼Œé‚£å°±éœ€è¦æ­£åˆ™è¡¨è¾¾å¼äº†ï¼Œç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…Xcodeä¸­çš„ä½¿ç”¨çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œä½¿ç”¨<code>(@&quot;[^&quot;]*[\u4E00-\u9FA5]+[^&quot;\n]*?&quot;)\s*</code> å³å¯ï¼Œ æ‰“å¼€ä½ çš„Xcode è¯•è¯•çœ‹ï¼Œåˆ‡è®°find åé¢çš„é€‰é¡¹è¦é€‰æ‹© <code>Regular Expression</code>, é»˜è®¤é€‰ä¸­çš„æ˜¯<code>Text</code>, å¦‚å›¾</p>
<p><img src="/images/2018-05-25-13-32-53.png" alt="å•Šç¥å¤šè¯­è¨€"></p>
<h2 id="å¦‚ä½•å–å‡ºè¯†åˆ«åˆ°çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Ÿ"><a href="#å¦‚ä½•å–å‡ºè¯†åˆ«åˆ°çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Ÿ" class="headerlink" title="å¦‚ä½•å–å‡ºè¯†åˆ«åˆ°çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Ÿ"></a>å¦‚ä½•å–å‡ºè¯†åˆ«åˆ°çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Ÿ</h2><p>â€ƒæˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•è¯†åˆ«é¡¹ç›®ä¸­çš„å­—ç¬¦ä¸²äº†ï¼Œä½†æ˜¯å¦‚ä½•å–å‡ºæ¥ä½¿ç”¨å‘¢ï¼Ÿ è¿™å°±éœ€è¦éå†é¡¹ç›®ä¸­æ‰€æœ‰çš„æŒ‡å®šåç¼€ï¼ˆe.g: .hã€.mç­‰ï¼‰çš„æ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨æ­£åˆ™è¡¨è¾¾åŒ¹é…æ‰€æœ‰ä½¿ç”¨åˆ°çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œå¹¶å†™å…¥æ–‡ä»¶ä¸­ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘å°†æ­¤è¿‡ç¨‹å†™äº†ä¸€ä¸ªMacå®¢æˆ·ç«¯<a href="https://github.com/Ashen-Zhao/ReadChinese" target="_blank" rel="noopener">å°åº”ç”¨</a>ï¼Œå¯ç›´æ¥å°†é€‰ä¸­çš„é¡¹ç›®ä¸­æ‰€æœ‰çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œå¯¼å‡ºåˆ°æŒ‡å®šçš„è·¯å¾„ä¸‹ï¼›è¯¥åº”ç”¨è¿˜å¯ä»¥é€‰æ‹©å¯¹äºé‡å¤å‡ºç°çš„ä¸­æ–‡å­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ï¼Œä»¥åŠè¿˜å¯ä»¥å°†ä¸­æ–‡å­—ç¬¦ä¸²å¯¼å‡ºä¸ºç¹ä½“ï¼› <a href="https://github.com/Ashen-Zhao/ReadChinese" target="_blank" rel="noopener">å°åº”ç”¨</a>æ›´å€¼å¾—å…³æ³¨çš„æ˜¯å®ƒå¯¼å‡ºçš„æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥å½“åšå¤šè¯­è¨€æ–‡ä»¶ä¸­çš„<code>key=value</code> ä½¿ç”¨ï¼Œéå¸¸ç®€å•ï¼Œå–œæ¬¢çš„å¯ä»¥å»<a href="https://github.com/Ashen-Zhao/ReadChinese" target="_blank" rel="noopener">ä¸‹è½½çœ‹çœ‹</a>ï¼Œ å«æœ‰æºç çš„å“¦ï¼›å°åº”ç”¨è¿è¡Œå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/images/2018-05-25-13-48-12.png" alt="å•Šç¥å¤šè¯­è¨€"></p>
<h2 id="å¦‚ä½•ä½¿ç”¨å–å‡ºçš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨å–å‡ºçš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨å–å‡ºçš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨å–å‡ºçš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Ÿ</h2><p>â€ƒå·²ç»æ‹¿åˆ°å–å‡ºçš„ä¸­æ–‡å­—ç¬¦ä¸²æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨åšå¤šè¯­è¨€æ–‡ä»¶ä½¿ç”¨çš„ï¼Œå°åº”ç”¨å¯¼å‡ºçš„æ–‡ä»¶ï¼Œåªå¯ä»¥ç”¨äºä¸­æ–‡ä»¥åŠç¹ä½“å¤šè¯­è¨€æ–‡ä»¶ï¼Œè€Œå¯¹äºå…¶ä»–çš„è¯­è¨€ï¼Œå°±éœ€è¦ä½ æ‹¿ç€å¯¼å‡ºçš„æ–‡ä»¶ï¼Œæ‰¾ä½ ä»¬å…¬å¸çš„ç¿»è¯‘äººå‘˜ï¼Œè¿›è¡Œç¿»è¯‘ï¼› æ‹¿ç¹ä½“ç‰ˆæ¥ä¸¾ä¸ªä¾‹å­ï¼Œå¯¼å‡ºæ¥çš„ç¹ä½“æ–‡ä»¶å¦‚ä¸‹ï¼ˆæ”¶ç•™æˆ‘Appå¯¼å‡ºçš„æ–‡ä»¶ï¼‰ï¼š</p>
<p><img src="/images/2018-05-25-13-48-38.png" alt="å•Šç¥å¤šè¯­è¨€"></p>
<p>è¿™ä¸ªç¹ä½“æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½œä¸ºç¹ä½“å¤šè¯­è¨€ä½¿ç”¨ï¼Œå¦‚ä½•æƒ³è¦ç¿»è¯‘æˆè‹±æ–‡ï¼Œå¯ä»¥å°†æ­¤æ–‡ä»¶æ‹·è´ä¸€ä»½ï¼Œäº¤ç»™ç¿»è¯‘äººå‘˜ï¼Œè®©å…¶ç¿»è¯‘ã€‚ç¿»è¯‘çš„æ—¶å€™ï¼Œä½ ä¸€å®šè¦ç»™ç¿»è¯‘äººå‘˜æ²Ÿé€šå¥½ï¼Œè®©å…¶åªç¿»è¯‘<code>value</code>, ä¹Ÿå°±æ˜¯å›¾ä¸­<code>=</code> åé¢åŒå¼•å·ä¸­çš„å†…å®¹ï¼Œæ ¼å¼ä»€ä¹ˆçš„ä¹Ÿä¸è¦è®©ä»–ä¹±æ”¹ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°é—®é¢˜ï¼Œå¯¼è‡´keyä¸valueå¯¹ä¸ä¸Šå·ã€‚ ä¸€åˆ‡æ²Ÿé€šå¦¥å½“åï¼Œç­‰ç¿»è¯‘æŠŠæ–‡ä»¶ç»™ä½ åï¼Œç›´æ¥å°†æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¤åˆ¶åˆ°å¤šè¯­è¨€æ–‡ä»¶çš„è‹±è¯­æ–‡ä»¶ä¸­å³å¯ï¼›</p>
<h2 id="å¦‚ä½•å°†é¡¹ç›®ä¸­çš„ä¸­æ–‡å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢"><a href="#å¦‚ä½•å°†é¡¹ç›®ä¸­çš„ä¸­æ–‡å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢" class="headerlink" title="å¦‚ä½•å°†é¡¹ç›®ä¸­çš„ä¸­æ–‡å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢"></a>å¦‚ä½•å°†é¡¹ç›®ä¸­çš„ä¸­æ–‡å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢</h2><p>â€ƒå¤šè¯­è¨€æ–‡ä»¶å·²ç»é…ç½®å®Œæˆï¼Œåˆ°äº†è¿™é‡Œï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬åªæ˜¯å–å‡ºé¡¹ç›®ä¸­ä½¿ç”¨çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œç„¶åå°†å­—ç¬¦ä¸²å°è£…æˆå¤šè¯­è¨€æ–‡ä»¶ï¼Œä½†æ˜¯å¯¹äºé¡¹ç›®ä¸­ä½¿ç”¨çš„ä¸­æ–‡å­—ç¬¦ä¸²ä¾ç„¶è¿˜æ˜¯ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¿˜å¹¶æ²¡æœ‰è¿›è¡Œæ›¿æ¢å¤„ç†ã€‚å½“ç„¶ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬æ˜¯ä¸èƒ½å¤Ÿå¿˜äº†ï¼Œç”±äºæ˜¯æ›¿æ¢é¡¹ç›®ä¸­æ‰€æœ‰çš„ä½¿ç”¨ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¿˜æ˜¯è°¨æ…ä¸ºå¥½ï¼Œé¦–å…ˆå°†ä½ çš„é¡¹ç›®è¿›è¡Œå¤‡ä»½ã€å¤‡ä»½ã€å¤‡ä»½ï¼Œéå¸¸é‡è¦çš„äº‹æƒ…è¯´ä¸‰ç¯‡ï¼Œåˆ‡è®°ä¸€å®šè¦å¤‡ä»½ã€‚å¤‡ä»½å¥½åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ›¿æ¢å·¥ä½œäº†ï¼Œæ²¡æœ‰å¤‡ä»½çš„ä¸è¦å¾€ä¸‹çœ‹äº†ï¼Œèµ¶ç´§å¤‡ä»½å»ï¼›<br>â€ƒå‡è®¾ä½ å·²ç»å¤‡ä»½å¥½äº†ï¼Œä½ å°±å¯ä»¥å¼€å§‹æ›¿æ¢å·¥ä½œäº†ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡è®©ä¸­æ–‡å­—ç¬¦ä¸²è‡ªèº«ä½œä¸ºkey è¿›è¡Œæ›¿æ¢ï¼Œä¹‹æ‰€ä»¥è®©å…¶è‡ªèº«ä½œä¸ºkey, æ˜¯å› ä¸ºè¿™æ ·å¯ä»¥å¤§å¤§å‡è½»æ›¿æ¢çš„å›°éš¾åº¦ï¼Œè€Œä¸”è¿˜æœ‰åˆ©äºä»£ç çš„å¯è¯»æ€§ï¼ŒåŸºæœ¬ä¸Šç®—æ˜¯ä¿æŒåŸæœ‰ä»£ç ï¼›æ—¢ç„¶è¦æ›¿æ¢é¡¹ç›®ä¸­çš„ä½¿ç”¨ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œå°±è¦ç”¨åˆ°Xcode è‡ªå¸¦çš„å­—ç¬¦ä¸²æ›¿æ¢åŠŸèƒ½ï¼Œé¦–å…ˆè¿˜éœ€è¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼<code>(@&quot;[^&quot;]*[\u4E00-\u9FA5]+[^&quot;\n]*?&quot;)\s*</code>ï¼ŒåŒ¹é…å‡ºé¡¹ç›®ä¸­ä½¿ç”¨çš„ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œç„¶ååœ¨å¯¹å…¶è¿›è¡Œæ›¿æ¢å¤„ç†ã€‚</p>
<p>â€ƒç”±äºæˆ‘ä»¬åœ¨<a href="http://www.devashen.com/blog/2016/01/15/localized02/" target="_blank" rel="noopener">iOS å¤šè¯­è¨€ç‰ˆæœ¬çš„å¼€å‘ï¼ˆäºŒï¼‰</a>ä¸­ï¼Œå¯¹å–keyå¯¹åº”çš„è¯­è¨€å†…å®¹ï¼Œè¿›è¡Œäº†å®çš„å°è£…, è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°†åŒ¹é…åˆ°çš„ä½¿ç”¨ä¸­æ–‡å­—ç¬¦ç›´æ¥æ›¿æ¢æˆæˆ‘ä»¬å®šä¹‰çš„å®çš„ä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#define ASLocalizedString(key)  [NSString stringWithFormat:@&quot;%@&quot;, [[NSBundle bundleWithPath:[[NSBundle mainBundle] pathForResource:[NSString stringWithFormat:@&quot;%@&quot;,[[NSUserDefaults standardUserDefaults] objectForKey:@&quot;appLanguage&quot;]] ofType:@&quot;lproj&quot;]] localizedStringForKey:(key) value:nil table:@&quot;ASLocalized&quot;]]</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ˜¯å®çš„å®šä¹‰ï¼Œæˆ‘ä»¬éœ€è¦å°†å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢æˆå®çš„ä½¿ç”¨ï¼Œå¦‚ï¼š<br>â€ƒæ›¿æ¢å‰æ˜¯è¿™æ ·çš„<code>_lbl.text = @&quot;æˆ‘æ˜¯å¤šè¯­è¨€&quot;;</code><br>â€ƒæ›¿æ¢å<code>_lbl.text = ASLocalizedString(@&quot;æˆ‘æ˜¯å¤šè¯­è¨€&quot;)</code></p>
<p>æ›¿æ¢è§„åˆ™å¦‚å›¾ï¼š</p>
<p><img src="/images/2018-05-25-13-50-18.png" alt="å•Šç¥å¤šè¯­è¨€"></p>
<p>è¿™æ¬¡é€‰ä¸­çš„æ˜¯<code>Replace</code>, ä¸æ˜¯<code>Find</code>ã€‚æŒ‰å›¾ä¸­æ‰€ç¤ºï¼Œé€‰æ‹©å®Œæ¯•åï¼Œç‚¹å‡»<code>ReplaceAll</code>, ä¼šå‡ºæ¥ä¸€ä¸ªå¼¹æ¡†ï¼Œä¸ç”¨ç®¡å®ƒç›´æ¥ç»§ç»­ï¼Œå³å¯ï¼Œç„¶åä½ åœ¨çœ‹é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„ä¸­æ–‡å­—ç¬¦ä¸²æ˜¯å¦å·²ç»æ›¿æ¢æ‰äº†ï¼Œåˆ°è¿™é‡ŒåŸºæœ¬ä¸Šå¤§åŠŸå‘Šæˆäº†ï¼›</p>
<h2 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h2><p>1ã€æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸æ‡‚å¾—å¯ä»¥å…ˆç…§æ–‡ç« é‡Œå†™å°±è¡Œï¼Œç„¶åå†å»å­¦ä¹ ä¸‹ï¼Œ<a href="http://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="noopener">è¿™é‡Œæœ‰ç¯‡åŸºç¡€æ–‡ç« </a><br>2ã€ASLocalizedString(key) ï¼Œ è¯¥å®ä½¿ç”¨é¢ç§¯å¹¿ï¼Œå¯ä»¥å°†å…¶å®šä¹‰æˆå…¬å…±å¤´æ–‡ä»¶ä¸­ï¼Œç„¶åç”¨æ—¶å¼•ç”¨å¤´æ–‡ä»¶å³å¯ï¼Œä¹Ÿå¯å°†æ–‡ä»¶å°è£…è¿›pchæ–‡ä»¶ä¸­ï¼Œè¿™æ ·æ— éœ€ä½¿ç”¨å¤´æ–‡ä»¶æ¥å£ä½¿ç”¨<br>3ã€æ›¿æ¢åï¼Œå¯èƒ½ä¼šæœ‰äº›åœ°æ–¹æŠ¥é”™ï¼Œcommand + b ç¼–è¯‘ä¸‹ï¼Œçœ‹çœ‹æŠ¥é”™çš„åœ°æ–¹ï¼Œè¿›è¡Œç›¸åº”ä¿®æ”¹å³å¯ã€‚æŠ¥é”™åŸå› ï¼ša. å¯èƒ½æ˜¯ä½ å®šä¹‰çš„å¸¸é‡å­—ç¬¦ä¸²ï¼› b. å¯èƒ½æ˜¯å®šä¹‰çš„å®ï¼› c. å¯èƒ½æ˜¯æ›¿æ¢åæ²¡æœ‰æ¢è¡Œï¼› åŸºæœ¬ä¸ŠæŠ¥çš„é”™è¯¯å¾ˆæ˜æ˜¾ï¼Œè¿›è¡Œä¿®æ”¹å³å¯ï¼›<br>4ã€åœ¨è¿­ä»£ç‰ˆæœ¬ä¸­ï¼Œå†æ¬¡ä½¿ç”¨ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œå°±éœ€è¦ä½¿ç”¨<code>ASLocalizedString(key)</code>ï¼Œ æ¥ä»£æ›¿äº†ï¼Œç„¶åå†å¤šè¯­è¨€æ–‡ä»¶ä¸­ï¼Œè¿›è¡Œ<code>key=value</code> é…ç½®ï¼›</p>
<blockquote>
<p>ç›¸å…³æ–‡ç« </p>
</blockquote>
<blockquote>
<p>iOS å¤šè¯­è¨€ç‰ˆæœ¬çš„å¼€å‘ï¼ˆä¸€ï¼‰</p>
</blockquote>
<blockquote>
<p>iOS å¤šè¯­è¨€ç‰ˆæœ¬çš„å¼€å‘ï¼ˆäºŒï¼‰</p>
</blockquote>
<hr>
<p>æ–‡ç« è½¬è‡ª <a href="http://www.devashen.com/blog/2016/01/18/localized03/" target="_blank" rel="noopener">iOS å¤šè¯­è¨€ç‰ˆæœ¬çš„å¼€å‘ï¼ˆä¸‰ï¼‰</a></p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å›½é™…åŒ–</tag>
      </tags>
  </entry>
</search>
