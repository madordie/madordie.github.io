<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ç»§åˆšçš„åšå®¢</title>
  <subtitle>ä¸ç–¯é­”,ä¸æˆæ´»</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://madordie.github.io/"/>
  <updated>2018-01-02T11:18:34.562Z</updated>
  <id>https://madordie.github.io/</id>
  
  <author>
    <name>ç»§åˆš</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iOSé€†å‘-åˆ›å»ºCydiaæº</title>
    <link href="https://madordie.github.io/post/reverse-ios-creat-cydia-sources/"/>
    <id>https://madordie.github.io/post/reverse-ios-creat-cydia-sources/</id>
    <published>2018-01-01T16:00:00.000Z</published>
    <updated>2018-01-02T11:18:34.562Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>å…ˆç¬”è®°ã€‚</p>
<a id="more"></a>
<h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><ul>
<li>Ubuntu 16.04 LTS</li>
</ul>
<h3 id="å®‰è£…å·¥å…·"><a href="#å®‰è£…å·¥å…·" class="headerlink" title="å®‰è£…å·¥å…·"></a>å®‰è£…å·¥å…·</h3><h4 id="dpkg-dev"><a href="#dpkg-dev" class="headerlink" title="dpkg-dev"></a>dpkg-dev</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ apt-get update</div><div class="line">$ apt-get install dpkg-dev</div><div class="line">$ dpkg-scanpackages --help</div></pre></td></tr></table></figure>
<h4 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt-get install nginx</div></pre></td></tr></table></figure>
<h3 id="å¼€å·¥"><a href="#å¼€å·¥" class="headerlink" title="å¼€å·¥"></a>å¼€å·¥</h3><h4 id="å‡†å¤‡deb"><a href="#å‡†å¤‡deb" class="headerlink" title="å‡†å¤‡deb"></a>å‡†å¤‡deb</h4><p>æ­¤å¤„ç›®å½•ä¸º<code>/opt/cydia/debs</code>ï¼Œå¯ä»¥ä¸ºåˆ«çš„ï¼Œä½†æ˜¯å»ºè®®ä½ ä¹Ÿè¿™æ ·åš:)ã€‚</p>
<h4 id="ç”Ÿæˆä¾èµ–"><a href="#ç”Ÿæˆä¾èµ–" class="headerlink" title="ç”Ÿæˆä¾èµ–"></a>ç”Ÿæˆä¾èµ–</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> /opt/cydia</div><div class="line">$ dpkg-scanpackages debs/  /dev/null | gzip&gt; debs/Packages.gz</div><div class="line">$ tar zcvf Packages.gz Packages</div><div class="line">$ bzip2 -k Packages Packages.bz2</div></pre></td></tr></table></figure>
<h4 id="æ·»åŠ sources-list"><a href="#æ·»åŠ sources-list" class="headerlink" title="æ·»åŠ sources.list"></a>æ·»åŠ sources.list</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">echo</span> <span class="string">"deb file:///opt/cydia ./debs/"</span> &gt;&gt; /etc/apt/sources.list</div></pre></td></tr></table></figure>
<p>ps. æ³¨æ„è·¯å¾„ä¿¡æ¯</p>
<h4 id="æ›´æ–°ä¸€ä¸‹"><a href="#æ›´æ–°ä¸€ä¸‹" class="headerlink" title="æ›´æ–°ä¸€ä¸‹"></a>æ›´æ–°ä¸€ä¸‹</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ apt-get update</div></pre></td></tr></table></figure>
<h4 id="æ‰”å‡ºå»"><a href="#æ‰”å‡ºå»" class="headerlink" title="æ‰”å‡ºå»"></a>æ‰”å‡ºå»</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ln <span class="_">-s</span> /opt/cydia cydia</div><div class="line">$ /etc/init.d/nginx start</div></pre></td></tr></table></figure>
<h3 id="ç­¾å"><a href="#ç­¾å" class="headerlink" title="ç­¾å"></a>ç­¾å</h3><p>ï¼ˆç­‰æˆ‘è¯•ä¸€ä¸‹æ›´æ–°å†æ›´å§ğŸ˜‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul>
<li><a href="http://www.saurik.com/id/7" target="_blank" rel="external">http://www.saurik.com/id/7</a></li>
<li><a href="https://bbs.feng.com/read-htm-tid-8052646.html" target="_blank" rel="external">https://bbs.feng.com/read-htm-tid-8052646.html</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å…ˆç¬”è®°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="é€†å‘" scheme="https://madordie.github.io/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>æè¿°æ–‡ä»¶è·å–UDID</title>
    <link href="https://madordie.github.io/post/ios-tool-configurator-get-udid/"/>
    <id>https://madordie.github.io/post/ios-tool-configurator-get-udid/</id>
    <published>2017-12-06T16:00:00.000Z</published>
    <updated>2017-12-07T10:00:29.377Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h3 id="UDID"><a href="#UDID" class="headerlink" title="UDID"></a>UDID</h3><p>å¯¹ï¼Œå°±æ˜¯åœ¨iTunesç­‰å·¥å…·ä¸Šçœ‹åˆ°çš„UDID..</p>
<a id="more"></a>
<h3 id="å·¥å…·åŠæ–‡æ¡£"><a href="#å·¥å…·åŠæ–‡æ¡£" class="headerlink" title="å·¥å…·åŠæ–‡æ¡£"></a>å·¥å…·åŠæ–‡æ¡£</h3><p>å—¯ï¼ŒAppleå‡ºçš„ä¸ºæ•°ä¸å¤šçš„mac app:<a href="https://itunes.apple.com/cn/app/apple-configurator-2/id1037126344?mt=12" target="_blank" rel="external">Apple Configurator 2</a></p>
<p>è¿™ä¸ªå·¥å…·æ˜¯æœ‰ä¸­æ–‡æ–‡æ¡£çš„ï¼š<a href="http://help.apple.com/configurator/mac/2.3/?lang=zh-cn" target="_blank" rel="external">Apple Configurator 2 å®˜æ–¹æ–‡æ¡£</a></p>
<p>å½“ç„¶è¿˜æœ‰æ¯”è¾ƒæš´åŠ›çš„ç›´æ¥å†™xml: <a href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/iPhoneOTAConfiguration/ConfigurationProfileExamples/ConfigurationProfileExamples.html" target="_blank" rel="external">Appleçš„ç›¸å…³æ–‡æ¡£</a></p>
<hr>
<ul>
<li><a href="http://www.skyfox.org/safari-ios-device-udid.html" target="_blank" rel="external">é€šè¿‡Safariæµè§ˆå™¨è·å–iOSè®¾å¤‡UDID(è®¾å¤‡å”¯ä¸€æ ‡è¯†ç¬¦)</a></li>
<li><a href="http://www.skyfox.org/ios-mobileconfig-sign.html" target="_blank" rel="external">ä¸ºiOSçš„mobileconfigæ–‡ä»¶è¿›è¡Œç­¾å</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;UDID&quot;&gt;&lt;a href=&quot;#UDID&quot; class=&quot;headerlink&quot; title=&quot;UDID&quot;&gt;&lt;/a&gt;UDID&lt;/h3&gt;&lt;p&gt;å¯¹ï¼Œå°±æ˜¯åœ¨iTunesç­‰å·¥å…·ä¸Šçœ‹åˆ°çš„UDID..&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="tool" scheme="https://madordie.github.io/tags/tool/"/>
    
      <category term="UDID" scheme="https://madordie.github.io/tags/UDID/"/>
    
  </entry>
  
  <entry>
    <title>ã€Œè½¬ã€ä¸€å¼ æ€ç»´å¯¼å›¾ï¼Œè®©æ­£åˆ™è¡¨è¾¾å¼ä¸å†éš¾æ‡‚</title>
    <link href="https://madordie.github.io/post/reprinted-regular-mind-map/"/>
    <id>https://madordie.github.io/post/reprinted-regular-mind-map/</id>
    <published>2017-10-15T16:00:00.000Z</published>
    <updated>2017-10-16T02:26:02.834Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><img src="/images/bruch-up-regular-expressions-1.png" alt="æ€ç»´å¯¼å›¾"></p>
<a id="more"></a>
<h2 id="å­—ç¬¦"><a href="#å­—ç¬¦" class="headerlink" title="å­—ç¬¦"></a>å­—ç¬¦</h2><ul>
<li>æ™®é€šå­—ç¬¦ï¼šå­—æ¯ã€æ•°å­—ã€æ±‰å­—ã€ä¸‹åˆ’çº¿ï¼ŒåŒ¹é…ä¸ä¹‹ç›¸åŒçš„ä¸€ä¸ªå­—ç¬¦</li>
<li>ç®€å•è½¬ä¹‰å­—ç¬¦ï¼š\nï¼ˆæ¢è¡Œï¼‰,\tï¼ˆåˆ¶è¡¨ï¼‰,\ï¼ˆ\æœ¬èº«ï¼‰å’Œ \^â€¦ï¼ˆ\^ç­‰æœ‰ç‰¹æ®Šä½œç”¨çš„ç¬¦å·å¦‚è¦åŒ¹é…è‡ªå·±çš„è¯è¦ç”¨è½¬ä¹‰ï¼‰</li>
<li><p>æ ‡å‡†å­—ç¬¦é›†åˆ<br>æ³¨æ„åŒºåˆ†å¤§å°å†™ï¼Œå¤§å†™æ˜¯ç›¸åçš„æ„æ€ï¼ŒåŒ¹é…ç›¸åæ˜¯ä¸åŒ¹é…</p>
<ul>
<li>\d<br>  ä»»æ„ä¸€ä¸ªæ•°å­—ï¼Œ0~9</li>
<li>\w<br>  ä»»æ„ä¸€ä¸ªå­—æ¯ã€æ•°å­—ã€æ±‰å­—æˆ–ä¸‹åˆ’çº¿ï¼ŒA~Zã€a~zã€0~9ã€_å’Œä»»æ„ä¸€ä¸ªæ±‰å­—</li>
<li>\s<br>  ä»»æ„ç©ºç™½ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦</li>
<li>.<br>  å°æ•°ç‚¹å¯ä»¥åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œæ¢è¡Œé™¤å¤–ï¼ˆå¦‚æœè¦åŒ¹é…åŒ…æ‹¬â€\nâ€åœ¨å†…çš„æ‰€æœ‰å­—ç¬¦ï¼Œä¸€èˆ¬ç”¨[\s\S]ï¼‰</li>
</ul>
</li>
<li><p>è‡ªå®šä¹‰å­—ç¬¦é›†åˆ<br>[ ]æ–¹æ‹¬å·åŒ¹é…æ–¹å¼ï¼Œèƒ½å¤ŸåŒ¹é…æ–¹æ‹¬å·ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦,^è¡¨ç¤ºå–å</p>
<ul>
<li>[ab5@]<br>  åŒ¹é…â€aâ€æˆ–â€bâ€æˆ–â€5â€æˆ–â€@â€</li>
<li>[^abc]<br>  åŒ¹é…aã€bã€cä¹‹å¤–çš„ä»»æ„å­—ç¬¦</li>
<li>[f-k]<br>  åŒ¹é…â€œfâ€åˆ°â€kâ€ä¹‹é—´çš„å­—ç¬¦</li>
<li>[^A-F0-3]<br>  åŒ¹é…â€œAâ€-â€œFâ€,â€0â€-â€œ3â€ä¹‹å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦</li>
</ul>
</li>
</ul>
<h2 id="é‡è¯-Quantifier"><a href="#é‡è¯-Quantifier" class="headerlink" title="é‡è¯(Quantifier)"></a>é‡è¯(Quantifier)</h2><p>ä¿®é¥°å‰é¢çš„ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¦‚æœè¦ä¿®é¥°å¤šä¸ªè¡¨è¾¾å¼ï¼Œå°±ç”¨( )æŠŠè¡¨è¾¾å¼åŒ…èµ·æ¥</p>
<ul>
<li>{n}<br>  è¡¨è¾¾å¼é‡å¤næ¬¡â€‹</li>
<li>{m,n}<br>  è¡¨è¾¾å¼è‡³å°‘é‡å¤mæ¬¡ï¼Œæœ€å¤šé‡å¤næ¬¡<ul>
<li>è´ªå©ªæ¨¡å¼ ï¼ˆé»˜è®¤ï¼‰<br>åŒ¹é…ç¬¦åˆçš„æœ€é•¿çš„å­—ç¬¦ä¸²</li>
<li>éè´ªå©ªæ¨¡å¼ ï¼ˆåœ¨é‡è¯åé¢åŠ  ? ä¾‹ï¼š{m,n}? )<br>  åŒ¹é…ç¬¦åˆçš„æœ€çŸ­çš„å­—ç¬¦ä¸²</li>
</ul>
</li>
<li>{m,}<br>  è¡¨è¾¾å¼è‡³å°‘é‡å¤mæ¬¡</li>
<li>ï¼Ÿ<br>  åŒ¹é…è¡¨è¾¾å¼0æˆ–1æ¬¡ï¼Œç›¸å½“äº{0,1}</li>
<li>+<br>  è¡¨è¾¾å¼è‡³å°‘å‡ºç°ä¸€æ¬¡ï¼Œç›¸å½“äº{1,}</li>
<li>*<br>  è¡¨è¾¾å¼ä¸å‡ºç°æˆ–å‡ºç°ä»»æ„æ¬¡ï¼Œç›¸å½“äº{0,}</li>
</ul>
<h2 id="å­—ç¬¦è¾¹ç•Œ"><a href="#å­—ç¬¦è¾¹ç•Œ" class="headerlink" title="å­—ç¬¦è¾¹ç•Œ"></a>å­—ç¬¦è¾¹ç•Œ</h2><pre><code>é›¶å®½ï¼šåŒ¹é…çš„ä¸æ˜¯å­—ç¬¦è€Œæ˜¯ä½ç½®ï¼Œç¬¦åˆæŸç§æ¡ä»¶çš„ä½ç½®
</code></pre><ul>
<li>^<br>  ä¸å­—ç¬¦ä¸²å¼€å§‹çš„åœ°æ–¹åŒ¹é…</li>
<li>$<br>  ä¸å­—ç¬¦ä¸²ç»“æŸçš„åœ°æ–¹åŒ¹é…</li>
<li>\b<br>  åŒ¹é…ä¸€ä¸ªå•è¯çš„è¾¹ç•Œï¼Œå½“å‰ä½ç½®å‰é¢çš„å­—ç¬¦å’Œåé¢çš„å­—ç¬¦ä¸å…¨æ˜¯\w</li>
</ul>
<h2 id="é¢„æœç´¢ï¼ˆé›¶å®½æ–­è¨€ã€ç¯è§†ï¼‰"><a href="#é¢„æœç´¢ï¼ˆé›¶å®½æ–­è¨€ã€ç¯è§†ï¼‰" class="headerlink" title="é¢„æœç´¢ï¼ˆé›¶å®½æ–­è¨€ã€ç¯è§†ï¼‰"></a>é¢„æœç´¢ï¼ˆé›¶å®½æ–­è¨€ã€ç¯è§†ï¼‰</h2><p>é›¶å®½ï¼šåŒ¹é…çš„ä¸æ˜¯å­—ç¬¦è€Œæ˜¯ä½ç½®ï¼Œç¬¦åˆæŸç§æ¡ä»¶çš„ä½ç½®</p>
<ul>
<li>(?=exp)<br>  æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„åé¢èƒ½åŒ¹é…è¡¨è¾¾å¼exp</li>
<li>(?!exp)<br>  æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„åé¢ä¸èƒ½åŒ¹é…è¡¨è¾¾å¼exp</li>
<li>(?&lt;=exp)<br>  æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„å‰é¢èƒ½åŒ¹é…è¡¨è¾¾å¼exp</li>
<li>(?&lt;!exp)<br>  æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„å‰é¢ä¸èƒ½åŒ¹é…è¡¨è¾¾å¼exp</li>
</ul>
<h2 id="åŒ¹é…æ¨¡å¼"><a href="#åŒ¹é…æ¨¡å¼" class="headerlink" title="åŒ¹é…æ¨¡å¼"></a>åŒ¹é…æ¨¡å¼</h2><p>å¯¹æ–‡æœ¬çš„å¤„ç†æ–¹å¼</p>
<ul>
<li>IGNORECASE å¿½ç•¥å¤§å°å†™æ¨¡å¼<br>  åŒ¹é…æ—¶å¿½ç•¥å¤§å°å†™<br>  é»˜è®¤æ˜¯åŒºåˆ†å¤§å°å†™çš„</li>
<li>SINGLELINE å•è¡Œæ¨¡å¼<br>  æ•´ä¸ªæ–‡æœ¬çœ‹ä½œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåªæœ‰ä¸€ä¸ªå¼€å¤´ä¸€ä¸ªç»“å°¾<br>  ä½¿å°æ•°ç‚¹â€.â€å¯ä»¥åŒ¹é…åŒ…å«æ¢è¡Œç¬¦(\n)åœ¨å†…çš„ä»»æ„å­—ç¬¦</li>
<li>MULTILINE å¤šè¡Œæ¨¡å¼<br>  æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²<br>  åœ¨å¤šè¡Œæ¨¡å¼ä¸‹ï¼Œå¦‚æœéœ€è¦ä»…åŒ¹é…å­—ç¬¦ä¸²å¼€å§‹å’Œç»“æŸä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨\Aå’Œ\Z</li>
</ul>
<h2 id="é€‰æ‹©ç¬¦å’Œåˆ†ç»„"><a href="#é€‰æ‹©ç¬¦å’Œåˆ†ç»„" class="headerlink" title="é€‰æ‹©ç¬¦å’Œåˆ†ç»„"></a>é€‰æ‹©ç¬¦å’Œåˆ†ç»„</h2><p>åˆ†æ”¯ç»“æ„ã€æ•è·ç»„åˆéæ•è·ç»„</p>
<ul>
<li>| åˆ†æ”¯ç»“æ„â€‹<br>  å·¦å³è¡¨è¾¾å¼ä¹‹é—´â€œæˆ–â€å…³ç³»ï¼ŒåŒ¹é…å·¦è¾¹æˆ–å³è¾¹</li>
<li>( ) æ•è·ç»„<br>  ï¼ˆ1ï¼‰ã€åœ¨è¢«ä¿®é¥°åŒ¹é…æ¬¡æ•°çš„æ—¶å€™ï¼Œæ‹¬å·ä¸­çš„è¡¨è¾¾å¼å¯ä»¥ä½œä¸ºæ•´ä½“è¢«ä¿®é¥°<br>  ï¼ˆ2ï¼‰ã€å–åŒ¹é…ç»“æœçš„æ—¶å€™ï¼Œæ‹¬å·ä¸­çš„è¡¨è¾¾å¼åŒ¹é…åˆ°çš„å†…å®¹å¯ä»¥è¢«å•ç‹¬å¾—åˆ°<br>  ï¼ˆ3ï¼‰ã€æ¯ä¸€å¯¹æ‹¬å·ä¼šåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œä½¿ç”¨ï¼ˆï¼‰çš„æ•è·æ ¹æ®å·¦æ‹¬å·çš„é¡ºåºä»1å¼€å§‹è‡ªåŠ¨ç¼–å·ã€‚æ•è·ç¼–å·ä¸ºé›¶çš„ç¬¬ä¸€ä¸ªæ•è·æ˜¯æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…çš„æ–‡æœ¬<br>   åå‘å¼•ç”¨ï¼šé€šè¿‡åå‘å¼•ç”¨ï¼Œå¯ä»¥å¯¹åˆ†ç»„å·²æ•è·çš„å­—ç¬¦ä¸²è¿›è¡Œå¼•ç”¨ã€‚</li>
<li>(?:Expression) éæ•è·ç»„<br>  ä¸€äº›è¡¨è¾¾å¼ä¸­ï¼Œä¸å¾—ä¸ä½¿ç”¨ï¼ˆï¼‰ï¼Œä½†åˆä¸éœ€è¦ä¿å­˜ï¼ˆï¼‰ä¸­å­è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ï¼Œè¿™æ—¶å¯ä»¥ç”¨éæ•è·ç»„æ¥æŠµæ¶ˆï¼ˆï¼‰å¸¦æ¥çš„å‰¯ä½œç”¨ã€‚</li>
</ul>
<hr>
<p>åŸæ–‡ï¼š<a href="https://my.oschina.net/u/3080373/blog/1550653" target="_blank" rel="external">ä¸€å¼ æ€ç»´å¯¼å›¾ï¼Œè®©æ­£åˆ™è¡¨è¾¾å¼ä¸å†éš¾æ‡‚</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/bruch-up-regular-expressions-1.png&quot; alt=&quot;æ€ç»´å¯¼å›¾&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://madordie.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="æ­£åˆ™è¡¨è¾¾å¼" scheme="https://madordie.github.io/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨CollectionViewç®€åŒ–ä»£ç ï¼Œä¸“æ³¨äºä¸šåŠ¡å’ŒUI</title>
    <link href="https://madordie.github.io/post/ios-tool-collectionview-simplify-business/"/>
    <id>https://madordie.github.io/post/ios-tool-collectionview-simplify-business/</id>
    <published>2017-10-11T16:00:00.000Z</published>
    <updated>2017-10-31T03:44:10.160Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><code>UITableView</code>ä½œä¸ºé«˜çº§æ§ä»¶è¢«å¼€å‘è€…å¹¿æ³›ä½¿ç”¨ï¼ŒåŒæ ·çš„ï¼Œ<code>UICollectionView</code>ç”±äºå…¶NBçš„å¸ƒå±€ä¹Ÿè¢«å¹¿æ³›ä½¿ç”¨ã€‚ä½†æ˜¯åè€…åœ¨ä½¿ç”¨çš„æ—¶å€™å¤§å¤šæ•°éƒ½å±äºè‡ªå®šä¹‰çš„æ¯”è¾ƒå¤šï¼Œå‰è€…åˆ™ç›¸å¯¹æ™®é€šï¼ŒliståŸºæœ¬ä¸Šéƒ½ç”¨ã€‚</p>
<p>åœ¨ä¸šåŠ¡éœ€æ±‚ä¸­ï¼Œå¸¸è§„å¸ƒå±€ï¼Œå¤§å¤šæ•°éƒ½æ˜¯é‡‡ç”¨<code>UITableView</code>è¿›è¡Œçš„ï¼Œä½†æ˜¯æœ‰ç—›ç‚¹ï¼š</p>
<ul>
<li>å½“ä½¿åœ¨APPå†…ç”¨è¿‡ä¸€æ¬¡ç€‘å¸ƒæµä¹‹åï¼Œè®¾è®¡å¸ˆä¼šçªç„¶çš„è®©ä½ åœ¨æ­£å¸¸çš„listä¸­åº•éƒ¨è¿½åŠ ç€‘å¸ƒæµã€‚ã€‚è™½ç„¶æ˜¯åœ¨åº•éƒ¨è¿½åŠ ï¼Œä½†æ˜¯è¦ä»<code>UITableView</code>è¿ç§»åˆ°<code>UICollectionView</code></li>
<li><code>UITableViewDelegate</code>ã€<code>UITableViewDataSource</code> ææ€•æ¯å¤„ä½¿ç”¨éƒ½è¦å†™ç¹ççš„ç›¸åŒçš„ä»£ç å§ï½</li>
<li>å¾ˆå¤šäººä¹Ÿä¼šå¯¹å…¶è¿›è¡Œé«˜åº¦ç¼“å­˜å•Šç¥é©¬çš„ä¼˜åŒ–ç­–ç•¥</li>
<li>ä¸çŸ¥ä¸è§‰è¿™äº›ä»£ç å †åœ¨ä¸€èµ·å·²ç»å°†<code>UIViewController</code>å †çš„ç›¸å½“çš„é«˜</li>
</ul>
<p>ç„¶åå‘¢ï¼Œæˆ‘ä»¬ç°åœ¨ä½¿ç”¨ä¸€ä¸ª<code>CollectionView</code>å°†è¿™äº›æ“ä½œåŒ…è£…ä¸€ä¸‹ï¼Œè¾¾åˆ°è¿™æ ·ä¸€ä¸ªæµç¨‹:</p>
<ol>
<li><p>è‡ªå®šä¹‰Cellã€CellModel</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LabelCell</span>: <span class="title">UICollectionViewCell</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> info = <span class="type">UILabel</span>()</div><div class="line">    ...</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">sizeThatFits</span><span class="params">(<span class="number">_</span> size: CGSize)</span></span> -&gt; <span class="type">CGSize</span> &#123;</div><div class="line">        ...</div><div class="line">        <span class="keyword">return</span> <span class="type">CGSize</span>(width: size.width, height: info.frame.maxY + info.frame.minY)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LabelCell</span> </span>&#123;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Model</span>: <span class="title">ListItemDefaultProtocol</span> </span>&#123;</div><div class="line">        <span class="keyword">var</span> info: <span class="type">String</span>?</div><div class="line">        <span class="function"><span class="keyword">func</span> <span class="title">fillModel</span><span class="params">(view: LabelCell)</span></span> &#123;</div><div class="line">            view.info.text = info</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>è¯·æ±‚ã€å¤„ç†æ•°æ®æ ¼å¼åŒ–ä¸º<code>LabelCell.Model</code>è¿™æ ·çš„ç±»</p>
</li>
<li><p>å¤„ç†å¥½çš„æ•°æ®äº¤ç»™<code>CollectionView</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">list.sections = model.format(...)</div></pre></td></tr></table></figure>
</li>
<li><p>ä¼‘æ¯ä¸€ä¼šï¼Œå®Œå·¥äº†ï½</p>
</li>
</ol>
<p>ç„¶åï¼Œæ¥çœ‹çœ‹<code>Collection</code>é‡Œé¢éƒ½åšäº†ä»€ä¹ˆæ“ä½œ</p>
<a id="more"></a>
<h3 id="CollectionView"><a href="#CollectionView" class="headerlink" title="CollectionView"></a>CollectionView</h3><p>ä¸ºäº†è¾¾åˆ°ä¸Šé¢æ•ˆæœä¸­çš„ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª<code>CollectionView</code>æ¥å¤„ç†åˆ·æ–°æ•°æ®ã€è®¾ç½®ä»£ç†ã€è®¾ç½®æ•°æ®æºã€æ³¨å†Œcellã€ç­‰æ“ä½œã€‚</p>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæ­¤å¤„ä½¿ç”¨<a href="https://github.com/chiahsien/CHTCollectionViewWaterfallLayout" target="_blank" rel="external"><code>CHTCollectionViewWaterfallLayout</code></a>æ¥å¤„ç†ç€‘å¸ƒæµã€‚</p>
<p>åˆ›å»ºä¸€ä¸ª<code>CollectionViewSection</code>çš„ç±»/ç»“æ„ä½“æ¥ä¿å­˜sectionä¿¡æ¯ã€‚æ¯”å¦‚è¯´ï¼š<code>sectionInset</code>ã€<code>minimumColumnSpacing</code>ã€<code>minimumInteritemSpacing</code>ã€<code>columnCount</code>ã€ç­‰</p>
<p>åœ¨<code>CollectionView</code>ä¸­è®¾ç½®ä¸€ä¸ª<code>var sections = [KTJCollectionViewSection]()</code>ç”¨äºä¿å­˜sections</p>
<p>å®ç°<code>UICollectionViewDataSource</code>ã€ <code>UICollectionViewDelegate</code>ã€‚æ­¤å¤„çœç•¥çº¦1åƒå­—â€¦</p>
<h3 id="ListItemDefaultProtocolï¼šç»‘å®šCellå’ŒModel"><a href="#ListItemDefaultProtocolï¼šç»‘å®šCellå’ŒModel" class="headerlink" title="ListItemDefaultProtocolï¼šç»‘å®šCellå’ŒModel"></a>ListItemDefaultProtocolï¼šç»‘å®šCellå’ŒModel</h3><p>ä¸Šé¢<code>çœç•¥çº¦1åƒå­—</code>ä¸­æœ‰ä¸€ä¸ªå¹¶æ²¡æœ‰è¯´ï¼š<code>CollectionViewSection</code>çš„<code>header</code>ã€<code>items</code>ã€<code>footer</code>å¦‚ä½•å®ç°ã€‚ğŸ˜‚</p>
<p>å¥½äº†ï¼Œæ­¤å¤„è¿™ä¸‰ä¸ªå‡é‡‡ç”¨åè®®<code>ListItemDefaultProtocol</code>æ¥å®ç°ã€‚ï¼ˆPSï¼šå¤§å®¶éƒ½å–œæ¬¢ç”¨çˆ¶ç±»ï¼Œä½†çˆ¶ç±»åªæœ‰ä¸€ä¸ªï¼Œä¸ºäº†å…¼å®¹å’Œå†²çªï¼Œè¿™é‡Œåè®®æ˜¯æœ€å¥½ä¸è¿‡çš„ï½ï¼Œç‰¹åˆ«æ˜¯swiftä¸­çš„åè®®ï¼‰</p>
<p>åè®®éœ€è¦ç»™å‡ºè¿™ä¹ˆå‡ ä¸ªä¿¡æ¯ï¼š</p>
<ul>
<li><code>reuseIdentifier</code> ç”¨æ¥å¤ç”¨çš„é‡ç”¨æ ‡è¯†ç¬¦</li>
<li><code>cellClass</code> ç”¨æ¥æ³¨å†Œç”¨çš„ç±»å</li>
<li><code>func fillModel(item: AnyObject)</code> ç”¨æ¥ç»™cellå¡«å……modelçš„æ–¹æ³•</li>
</ul>
<p>é‚£ä¹ˆè¿™ä¸ªåè®®å°±å‡ºæ¥äº†ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">KTJListItemProtocol</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> identifa: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</div><div class="line">    <span class="keyword">var</span> registClass: <span class="type">AnyClass</span> &#123; <span class="keyword">get</span> &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fillModel</span><span class="params">(item: AnyObject)</span></span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨<strong>swift</strong>åè®®æ”¯æŒé»˜è®¤å®ç°ï¼Œäºæ˜¯ä¹ï¼Œå°±å¯ä»¥å†å†™ä¸€ä¸ª:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ListItemDefaultProtocol</span>: <span class="title">KTJListItemProtocol</span> </span>&#123;</div><div class="line">    associatedtype <span class="type">ItemType</span>: <span class="type">UIView</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fillModel</span><span class="params">(view: ItemType)</span></span></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ListItemDefaultProtocol</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> identifa: <span class="type">String</span> &#123; <span class="keyword">return</span>  <span class="type">NSStringFromClass</span>(<span class="type">ItemType</span>.<span class="keyword">self</span>)&#125;</div><div class="line">    <span class="keyword">var</span> registClass: <span class="type">AnyClass</span> &#123; <span class="keyword">return</span> <span class="type">ItemType</span>.<span class="keyword">self</span> &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fillModel</span><span class="params">(item: AnyObject)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> reusableView = item <span class="keyword">as</span>? <span class="type">ItemType</span> &#123;</div><div class="line">            fillModel(view: reusableView)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç„¶åï¼Œå°±å¯ä»¥æ„‰å¿«çš„ç©è€äº†ï½ï½</p>
<p>æœ€åCellä¸­çš„çš„ä»£ç æ•ˆæœå°±æ˜¯<a href="https://github.com/madordie/collectionview-simplify-business/blob/master/CollectionView-simplify-business/LabelCell.swift" target="_blank" rel="external">è¿™ä¸ªæ ·å­</a>ã€‚<br>å†åŠ ä¸Š<a href="https://github.com/madordie/collectionview-simplify-business/blob/master/CollectionView-simplify-business/ViewController.swift" target="_blank" rel="external">æ•°æ®å¡«å……</a>æ˜¯ä¸æ˜¯å¾ˆç®€å•äº†å‘¢ï½ï½</p>
<h3 id="ä»¥åå¦‚ä½•å¼€å‘"><a href="#ä»¥åå¦‚ä½•å¼€å‘" class="headerlink" title="ä»¥åå¦‚ä½•å¼€å‘"></a>ä»¥åå¦‚ä½•å¼€å‘</h3><p>çœŸçš„å¦‚åŒå‰é¢çš„ä¾‹å­ä¸€æ ·ï¼Œåªéœ€è¦è¿™ä¹ˆå‡ æ­¥ç»•ä¸è¿‡å»çš„ï¼š</p>
<ol>
<li>å¤„ç†æ¥å£åå‡ºæ¥çš„æ•°æ®ã€‚</li>
<li>åˆ›å»ºæ–°çš„UIæ ·å¼ï¼Œå¹¶åšå¥½æ¥å£æ•°æ®ä¸­é—´ä»¶ã€‚</li>
<li>ç‚¹å‡»äº‹ä»¶åœ¨å¤„ç†æ•°æ®çš„æ—¶å€™é¢„å…ˆåŸ‹å¥½ï¼Œæ‰€æœ‰çš„æ•°æ®ã€é€»è¾‘å’ŒUIæ•°æ®ä¸€èµ·è¢«ä¼ é€’ï¼Œä¸éœ€è¦å¤šæ¬¡ç±»å‹åˆ¤æ–­ã€‚</li>
</ol>
<p>ç»Ÿä¸€ä½¿ç”¨<code>CollectionView</code>è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼šä¸ç®¡å‰é¢è°å†™çš„ä¸€ä¸ªUIï¼Œéƒ½èƒ½æ‹‰è¿‡æ¥ç”¨ã€‚ä¸ç”¨åšä¸­é—´å±‚å»ä»<code>TableViewCell</code>è½¬<code>CollectionViewCell</code>ã€‚</p>
<p>å¼€å‘åªéœ€è¦å…³å¿ƒä¸šåŠ¡ï¼Œä¸šåŠ¡ã€‚å®‰å®‰å¿ƒå¿ƒåšä¸€ä¸ªå†™ä¸šåŠ¡çš„ç¨‹åºå‘˜å§ï½</p>
<h3 id="å…³äºCellçš„è·³è½¬å¤„ç†"><a href="#å…³äºCellçš„è·³è½¬å¤„ç†" class="headerlink" title="å…³äºCellçš„è·³è½¬å¤„ç†"></a>å…³äºCellçš„è·³è½¬å¤„ç†</h3><p>ä¹ä¸€çœ‹ï¼Œå®Œç¾äº†ã€‚ä¸è¿‡è¿˜æœ‰ä¸€ä¸ªå·¨çƒ¦çš„è·³è½¬å¤„ç†ã€‚ã€‚ã€‚ä¸è¿‡ï¼Œ<strong>è«æ€•</strong></p>
<p>è·³è½¬ï¼Œæœ‰è¿™ä¹ˆå‡ ç§ï¼š</p>
<ul>
<li>æ”¯æŒè·¯ç”±çš„URLè·³è½¬ï¼Œè¿™ä¸ªæ˜¯æœ€ç®€å•çš„ï¼Œä¹Ÿæ˜¯æœ€çˆ½çš„</li>
<li>åªèƒ½å¤æ‚çš„è¿›è¡Œåˆ›å»ºç±»ã€èµ‹å€¼ã€pushå•Šç¥é©¬çš„</li>
</ul>
<p>ç”±äºæˆ‘ä»¬å°†æ•°æ®å…¨éƒ¨å¤„ç†å¥½åæ‰”ç»™äº†<code>cellmodel</code>ï¼Œè€Œè·³è½¬ã€æ‰“ç‚¹æ‰€éœ€è¦çš„å‚æ•°å‡åœ¨æ­¤å¤„ä¸ºæœ€å…¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å›è°ƒä½œä¸ºæ•°æ®ä¸€èµ·ä¼ é€’ã€‚ã€‚</p>
<p>å—¯, äº‹ä»¶éœ€è¦ä¼ é€’çš„å¯¹è±¡å¤§çº¦è¿™ä¸ªæ ·å­ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Jmp</span> </span>&#123;</div><div class="line">    <span class="comment">/// æ”¯æŒURLè·³è½¬çš„URL</span></div><div class="line">    <span class="keyword">let</span> url: <span class="type">String</span>?</div><div class="line">    <span class="comment">/// æ‰“ç‚¹äº‹ä»¶å</span></div><div class="line">    <span class="keyword">let</span> event: <span class="type">String</span>?</div><div class="line">    <span class="comment">/// æ‰“ç‚¹å‚æ•°</span></div><div class="line">    <span class="keyword">let</span> attr: [<span class="type">AnyHashable</span>: <span class="type">Any</span>]?</div><div class="line">    <span class="comment">/// ä¸æ”¯æŒURLçš„ç›´æ¥å›è°ƒ</span></div><div class="line">    <span class="keyword">let</span> eventCallback: (() -&gt; <span class="type">Void</span>)?</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç„¶åcellå¯¹åº”çš„å¦ä¸€ä¸ªç±»æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">KTJJmp</span>: <span class="title">NSObject</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> info: <span class="type">Jmp</span>?</div><div class="line">    <span class="keyword">let</span> action = #selector(topVCJmp)</div><div class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">topVCJmp</span><span class="params">()</span></span> &#123;</div><div class="line">        ... <span class="comment">// æ‰“ç‚¹</span></div><div class="line">        <span class="type">KTJURLJump</span>.jumpToViewOnTopVC(jmp: info)</div><div class="line">        info?.eventCallback?()</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tap</span><span class="params">()</span></span> -&gt; <span class="type">UITapGestureRecognizer</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">UITapGestureRecognizer</span>(target: <span class="keyword">self</span>, action: #selector(topVCJmp))</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸¤ä¸ªç±»å…±åŒä½œç”¨å°±æ˜¯ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JmpCell</span>: <span class="title">UICollectionViewCell</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> jmp = <span class="type">JmpCellModel</span>()</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</div><div class="line">        ...</div><div class="line">        jmpBtn.addTarget(jmp, action: jmp.action, <span class="keyword">for</span>: .touchUpInside)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JmpCellModel</span>: <span class="title">ListItemDefaultProtocol</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> jmp: <span class="type">Jmp</span>?</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fillModel</span><span class="params">(view: JmpCell)</span></span> &#123;</div><div class="line">        view.jmp.info = jmp</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è‡³äºè¿™ä¸ª<code>JmpCellModel.jmp</code>æ€ä¹ˆç”Ÿæˆï¼Œè¿™é‡Œå°±ä¸è¯´äº†ã€‚</p>
<h3 id="å…³äºç®—é«˜é‚£ç‚¹äº‹"><a href="#å…³äºç®—é«˜é‚£ç‚¹äº‹" class="headerlink" title="å…³äºç®—é«˜é‚£ç‚¹äº‹"></a>å…³äºç®—é«˜é‚£ç‚¹äº‹</h3><h4 id="ç®—é«˜ä½ç½®çš„é€‰æ‹©"><a href="#ç®—é«˜ä½ç½®çš„é€‰æ‹©" class="headerlink" title="ç®—é«˜ä½ç½®çš„é€‰æ‹©"></a>ç®—é«˜ä½ç½®çš„é€‰æ‹©</h4><p>æˆ‘ä¹Ÿæ›¾çº ç»“è¿‡frameçš„ä»£ç åº”è¯¥å†™åœ¨å“ªé‡Œã€‚ã€‚æœ‰å†™åœ¨åˆå§‹åŒ–çš„ï¼Œæœ‰å•ç‹¬å†™ä¸€ä¸ªæ–¹æ³•çš„ï¼Œè¿˜æœ‰å†™åœ¨<code>func sizeThatFits(:) -&gt; CGSize</code></p>
<p>ç”±äºå½“å¹´å¯¹<a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell" target="_blank" rel="external">UITableView-FDTemplateLayoutCell</a>ä¸­æ¯’è¾ƒæ·±ï¼Œæ‰€ä»¥æ²¿ç”¨äº†æœ€åä¸€ç§æ–¹æ¡ˆã€‚</p>
<h4 id="ç®—é«˜ä½¿ç”¨çš„viewçš„é€‰æ‹©"><a href="#ç®—é«˜ä½¿ç”¨çš„viewçš„é€‰æ‹©" class="headerlink" title="ç®—é«˜ä½¿ç”¨çš„viewçš„é€‰æ‹©"></a>ç®—é«˜ä½¿ç”¨çš„viewçš„é€‰æ‹©</h4><p>åœ¨ç®—é«˜çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼š<strong>é«˜åº¦æ˜¯æ•°æ®å’Œå½“å‰æœ€å¤§å®½åº¦å…±åŒå†³å®šçš„</strong>ï¼Œæ‰€ä»¥åœ¨ç®—é«˜çš„æ—¶å€™éœ€è¦æ‹¿ç€æ•°æ®ã€viewç„¶åæ‰èƒ½å»ç®—é«˜ï¼ˆPSï¼šè‡³äºé‚£äº›æ‹¿ç€æ•°æ®ç¡¬ç®—å‡ºä¸€ä¸ªé«˜åº¦çš„ä»£ç ï¼Œæ­¤å¤„ä¸å‘è¡¨çœ‹æ³•ğŸ˜‚ï¼Œæ—©æ™šä¼šåæ‚”çš„ï¼‰</p>
<p>ç„¶åå°±æ˜¯<code>UITableView</code>ã€<code>UICollectionView</code>çš„ç®—é«˜æ˜¯é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ä»£ç†å»è·å–çš„ï¼Œå¹¶ä¸æä¾›viewå»è®¡ç®—ã€‚ã€‚è¿™å°±æ˜¯çŸ›ç›¾çš„åœ°æ–¹ã€‚</p>
<p>è™½ç„¶<code>UITableView</code>ã€<code>UICollectionView</code>åœ¨ç®—é«˜çš„åœ°æ–¹ä¸æä¾›View,ä½†æ˜¯æœ‰ä¸€ä¸ª<code>dequeueReusableCell....</code>çš„æ–¹æ³•å¯ä»¥è·å–åˆ°ç¼“å­˜æ± ä¸­çš„<code>Cell</code>å‘€</p>
<p>å¦‚æœä½ è¿™æ ·åšäº†ï¼Œé‚£ä¹ˆä½ å°†ä¼šä»˜å‡ºæƒ¨é‡çš„ä»£ç ã€‚è¿™ä¸ªæ–¹æ¡ˆæˆ‘åœ¨<a href="http://www.cnblogs.com/madordie" target="_blank" rel="external">åšå®¢å›­</a>2015.03.17çš„<a href="http://www.cnblogs.com/madordie/p/4344209.html" target="_blank" rel="external">â€œiOS ä¼˜åŒ–æ€§èƒ½ä¹‹TableViewâ€</a>ä¸­å·²ç»è¯´äº†ï¼š</p>
<blockquote>
<p>dequeueReusableCellWithIdentifier:æ­¤å‡½æ•°çš„è°ƒç”¨è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š<br>    i.æ­¤å‡½æ•°çš„è¿”å›å€¼æ˜¯åšä¸ºtableView:cellForRowAtIndexPath:çš„è¿”å›å€¼çš„ã€‚è¿™æ ·ä¿è¯æ‹¿å‡ºæ¥çš„å®Œæ•´è¿˜ç»™TableViewã€‚<br>    ii.å¦‚æœæ­¤å‡½æ•°çš„è¿”å›å€¼ä¸æ˜¯ä¸ºäº†ç»™tableView:cellForRowAtIndexPath:åšè¿”å›å€¼ï¼Œé‚£ä¹ˆä½ è¦æ³¨æ„è¿™æ˜¯åœ¨ä¸€ä¸ªæ‹¿å–åˆ«äººç¨€ç¼ºèµ„æºçš„æ“ä½œï¼Œéœ€è¦æ³¨æ„çæƒœè¿™ä¸ªè¿”å›å€¼ï¼Œèƒ½ä¸æµªè´¹å°±ä¸è¦æµªè´¹ã€‚<br>    iii.å¯¹äºALè‡ªåŠ¨é€‚åº”çš„TableViewå–Cellæ—¶å€™è¦æ³¨æ„ä¿å­˜ã€‚ä¸ªäººå»ºè®®å°è£…TableViewï¼Œç„¶åç”¨æ¥è®¡ç®—é«˜åº¦çš„Cellä¿å­˜åœ¨TableViewä¸­ã€‚å¯¹äºå¤šç§ç±»å‹çš„Cellï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¤ç”¨æ ‡è¯†ç¬¦ä½œä¸ºKeyçš„å­—å…¸æ¥å­˜å‚¨ã€‚è¿™æ ·èƒ½å¤Ÿæœ‰æ•ˆèŠ‚çº¦dequeueReusableCellWithIdentifier:è°ƒç”¨æ¬¡æ•°ã€‚</p>
</blockquote>
<p><code>UICollectionView</code>ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥ä½¿ç”¨<code>dequeueReusableCell....</code>æ–¹æ³•æ˜¯<strong>å¾ˆä¸é è°±çš„</strong>ã€‚</p>
<p>åœ¨<a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell/blob/912b3ce4a61198c0b79a3d85b977f8fdacd153ea/Classes/UITableView%2BFDTemplateLayoutCell.m#L134-#L155" target="_blank" rel="external">UITableView-FDTemplateLayoutCell</a>ä¸­ä½¿ç”¨äº†å­—å…¸ä¿å­˜ç¼“å­˜ç®—é«˜çš„Viewï¼Œä¹Ÿæ˜¯æ¯”è¾ƒèµçš„ã€‚</p>
<p>ä½†æ˜¯ç°åœ¨æœ‰äº†<code>CollectionView</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨OCçš„<code>objc_setAssociatedObject(,,,)</code>å»å¤„ç†è€Œç›´æ¥ä½¿ç”¨äº†<code>NSCache</code>å»å¤„ç†å°±è¡Œäº†ï½</p>
<p>å¦‚æœçœ‹äº†<a href="https://github.com/madordie/collectionview-simplify-business/blob/master/CollectionView.swift" target="_blank" rel="external"><code>CollectionView</code></a>å°±ä¼šå‘ç°ï¼Œ<code>ListItemProtocol</code>è¿˜æœ‰ä¸€ä¸ªgetæ–¹æ³•<code>var newItem: AnyObject { get }</code>è¿™ä¸ªæ˜¯ç”¨æ¥ç®—é«˜çš„ã€‚</p>
<p>åœ¨<a href="https://github.com/madordie/collectionview-simplify-business/blob/master/CollectionView.swift" target="_blank" rel="external">CollectionView.swift</a>å…³äºé«˜åº¦çš„ä»£ç†è®¾ç½®ä¸­å¯ä»¥çœ‹åˆ°ç›¸å…³è·å–å’Œè®¾ç½®ã€‚</p>
<h4 id="ç®—é«˜çš„æ—¶å€™å˜å±€çš„æ§åˆ¶"><a href="#ç®—é«˜çš„æ—¶å€™å˜å±€çš„æ§åˆ¶" class="headerlink" title="ç®—é«˜çš„æ—¶å€™å˜å±€çš„æ§åˆ¶"></a>ç®—é«˜çš„æ—¶å€™å˜å±€çš„æ§åˆ¶</h4><p>é«˜åº¦çš„è®¡ç®—ç°åœ¨å·²ç»å¯ä»¥æ­£å¸¸è®¡ç®—ï¼Œä½†æ˜¯å¯¹äº<code>columnCount &gt; 1</code>çš„æ—¶å€™ï¼Œç‰µæ‰¯åˆ°é—´éš™çš„è®¡ç®—éœ€è¦æ³¨æ„ä¸€æ¬¡å•Šã€‚æ¯•ç«Ÿ<code>CHTCollectionViewWaterfallLayout</code>åŠŸèƒ½æ›´å¼ºå¤§ã€‚</p>
<p>ç›¸å…³ä»£ç åœ¨<a href="https://github.com/madordie/collectionview-simplify-business/blob/master/CollectionView.swift" target="_blank" rel="external">CollectionView.swift</a>çš„<code>func collectionView(:,layout:,sizeForItemAt:) -&gt; CGSize</code>å‡½æ•°ä¸­ã€‚</p>
<h3 id="å…³äºä»£ç†é‚£ç‚¹äº‹"><a href="#å…³äºä»£ç†é‚£ç‚¹äº‹" class="headerlink" title="å…³äºä»£ç†é‚£ç‚¹äº‹"></a>å…³äºä»£ç†é‚£ç‚¹äº‹</h3><p>ä¸«çš„ï¼Œéœ€æ±‚æ€»æ˜¯æ¯”æƒ³çš„å¤šï¼Œä½†æ˜¯åŠæ³•ä¹Ÿæ¯”é—®é¢˜å¤šã€‚</p>
<p>å¯¹äº<code>CollectionView</code>æ¥è¯´ï¼Œä»£ç†éƒ½è®¾ç½®æˆäº†selfï¼Œè¿™æ ·ä¼šå¯¼è‡´æœ‰æ—¶å€™éœ€è¦<code>UIScrollViewDelegate</code>å¹²äº›äº‹æƒ…çš„æ—¶å€™æ€»æ˜¯ä¸é‚£ä¹ˆè‡ªç”±ã€‚ã€‚ã€‚å®ä¹ƒæ–°ç—›ç‚¹ï¼Œä¸è¿‡æœ‰åŠæ³•ã€‚</p>
<p>ä¸‹é¢æ˜¯å‡ ç§æ–¹æ¡ˆï¼š</p>
<h4 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h4><p>ç›´æ¥KVOåˆ°<code>self.contentOffset</code>ï¼Œè¿™æ ·ä¸€äº†ç™¾äº†ã€‚å†™ä»€ä¹ˆä»£ç†ï¼Œè¦ä»€ä¹ˆè‡ªè¡Œè½¦ï¼ï¼ˆPSï¼šswiftæä¾›é—­åŒ…çš„ä»£ç†ï¼Œä¹Ÿæ˜¯å¾ˆå¥½ç”¨çš„ï¼‰</p>
<p>å¦‚æœä¸ä¼šï¼Œè¯·è‡ªè¡Œ<a href="https://www.google.com" target="_blank" rel="external">Google</a>ã€‚<a href="https://objccn.io/issue-7-3/" target="_blank" rel="external">ObjC-ä¸­å›½ï¼šKVC å’Œ KVO</a>ï¼Œæˆ‘åªèƒ½å¸®ä½ åˆ°è¿™é‡Œ</p>
<h4 id="Rxç³»"><a href="#Rxç³»" class="headerlink" title="Rxç³»"></a>Rxç³»</h4><p>å¾ˆæŠ±æ­‰ï¼Œä½ ä¸èƒ½ç”¨<code>self.rx.contentOffset</code>ã€‚åŸå› æ˜¯<a href="https://github.com/chiahsien/CHTCollectionViewWaterfallLayout" target="_blank" rel="external"><code>CHTCollectionViewWaterfallLayout</code></a>ä¸­æœ‰è¿™ä¹ˆä¸€è¡Œæ–­è¨€ï¼š</p>
<blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="type">NSAssert</span>([<span class="keyword">self</span>.delegate conformsToProtocol:@<span class="class"><span class="keyword">protocol</span>(<span class="title">CHTCollectionViewDelegateWaterfallLayout</span>)], @"<span class="title">UICollectionView</span>'<span class="title">s</span> <span class="title">delegate</span> <span class="title">should</span> <span class="title">conform</span> <span class="title">to</span> <span class="title">CHTCollectionViewDelegateWaterfallLayout</span> <span class="title">protocol</span>");</span></div></pre></td></tr></table></figure>
</blockquote>
<p><strong>ä½†æ˜¯</strong>ï¼Œä½ å¯ä»¥ä½¿ç”¨Rxé‡Œé¢çš„KVOå‘€ï½ä¹Ÿæ˜¯è´¼æ–¹ä¾¿</p>
<h4 id="RACç³»"><a href="#RACç³»" class="headerlink" title="RACç³»"></a>RACç³»</h4><p>æŠ±æ­‰ï¼Œæˆ‘ä¸ä¼šã€‚åŸå› åœ¨æ­¤<a href="../reactivecocoa-ready-to-use">å‡†å¤‡é£Ÿç”¨RAC(ReactiveCocoa)çš„é¡¾è™‘</a></p>
<h4 id="ä»£ç†ä¼ é€’"><a href="#ä»£ç†ä¼ é€’" class="headerlink" title="ä»£ç†ä¼ é€’"></a>ä»£ç†ä¼ é€’</h4><p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç†è¿›è¡Œä¼ é€’å‡ºå»ã€‚å¤§è‡´è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">CollectionViewDelegate</span>: <span class="title">NSObjectProtocol</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath)</span></span></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollectionView</span> </span>&#123;</div><div class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> allDelegate: <span class="type">CollectionViewDelegate</span>?</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath)</span></span> &#123;</div><div class="line">    <span class="keyword">self</span>.allDelegate?.collectionView(<span class="keyword">self</span>, didSelectItemAt: indexPath)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ–¹æ¡ˆæ²¡å•¥èŠçš„ã€‚ã€‚</p>
<h3 id="OCå’‹åŠï¼Ÿ"><a href="#OCå’‹åŠï¼Ÿ" class="headerlink" title="OCå’‹åŠï¼Ÿ"></a>OCå’‹åŠï¼Ÿ</h3><p>è¿™ä¸ªOCä¹Ÿèƒ½ç”¨ï¼Œåªä¸è¿‡éœ€è¦ä¸€äº›æ‰‹æ®µï¼Œæ¯”å¦‚è¯´ï¼šç»§æ‰¿ã€æ‰©å±•ã€ç­‰</p>
<p><code>ListItemProtocol</code>å°±æ˜¯ä¸ºäº†ç»™OCä½¿ç”¨ç•™çš„ï¼Œè¿˜æœ‰å°±æ˜¯<code>CollectionViewSection</code>ä½¿ç”¨äº†ç±»ï¼Œè€Œä¸æ˜¯ç»“æ„ä½“ã€‚</p>
<p>ä¸è¿‡å…·ä½“æ²¡æœ‰ä¾‹å­ï¼Œä¸æƒ³å†™OCä»£ç ï¼Œå¤ªéº»çƒ¦äº†ã€‚ã€‚ä¸»è¦æ˜¯è¿™ç§æ€è·¯:)</p>
<h3 id="å¡«å……Cellçš„æ•°æ®ä¸ºä»€ä¹ˆä¼šåœ¨CellModelä¸­ï¼Ÿ"><a href="#å¡«å……Cellçš„æ•°æ®ä¸ºä»€ä¹ˆä¼šåœ¨CellModelä¸­ï¼Ÿ" class="headerlink" title="å¡«å……Cellçš„æ•°æ®ä¸ºä»€ä¹ˆä¼šåœ¨CellModelä¸­ï¼Ÿ"></a>å¡«å……Cellçš„æ•°æ®ä¸ºä»€ä¹ˆä¼šåœ¨CellModelä¸­ï¼Ÿ</h3><p>å¯¹äºCellæ¥è¯´ï¼ŒCellæ˜¯å¹²å‡€çš„ï¼Œæ²¡æœ‰ä»»ä½•ç»§æ‰¿ã€åè®®æ¥é™åˆ¶Cellå¦‚ä½•å¤„ç†ã€‚é‚£ä¹ˆCellå°±å¯ä»¥æ¥å—æ¥è‡ªä»»ä½•æ¨¡å—çš„å„ç§é£æ ¼çš„Cellï¼Œè¿™æ˜¯æˆ‘æƒ³è¦çš„å‡å°‘ä¾µå…¥ã€‚</p>
<p>cellModelä¸­å®šä¹‰äº†Cellæ‰€å¯¹åº”çš„å¡«å……æ•°æ®æ ¼å¼ï¼Œåœ¨ç¬¬ä¸€æ¬¡å†™çš„æ—¶å€™éš¾å…ä¼šæŒ‰ç…§ä¸šåŠ¡é€»è¾‘èµ·ä¸€äº›ä¸šåŠ¡é€»è¾‘çš„åå­—ï¼Œåœ¨å¤ç”¨çš„æ—¶å€™åˆä¸èƒ½æ”¹åå­—ï¼Œä¼šå¯¹ç»´æŠ¤å’Œå¼€å‘åŠ äº†ä¸€å®šé‡çš„å¤æ‚åº¦ï¼Œè¿™ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚ã€‚</p>
<p>äºæ˜¯ä¹æ¯ä¸ªCellModelæ ¹æ®è‡ªå·±çš„éœ€è¦ç»‘å®šéœ€è¦ç»‘å®šçš„Cellï¼Œå»å¡«å……Cellæ‰€å¯¹åº”çš„æ•°æ®å°±å¥½ã€‚åªéœ€è¦ä¾µå…¥cellModelå³å¯ã€‚ä»£ä»·æœ€å°ï¼Œå—ç›Šæœ€å¤§ã€‚</p>
<p>PS.å¯¹äºåŒä¸€ä¸ªListï¼Œéœ€è¦æ³¨æ„cellçš„å¤ç”¨å’Œå¤šä¸ªcellModelåŒæ—¶ç»‘å®šä¸€ä¸ªcellæ—¶ï¼Œå±æ€§çš„è®¾ç½®ã€‚</p>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p><a href="https://github.com/madordie/collectionview-simplify-business" target="_blank" rel="external">Demo</a>éƒ¨åˆ†æ²¡æœ‰å†™è·³è½¬ç›¸å…³å†…å®¹ï¼Œä½†æ˜¯åˆ«çš„éƒ½æœ‰äº†ğŸ˜‚</p>
<h3 id="åˆ«çš„"><a href="#åˆ«çš„" class="headerlink" title="åˆ«çš„"></a>åˆ«çš„</h3><p>å¥½åƒæ²¡äº†å§ï½ï¼Œæƒ³èµ·æ¥äº†å†è¡¥å……å’¯</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;UITableView&lt;/code&gt;ä½œä¸ºé«˜çº§æ§ä»¶è¢«å¼€å‘è€…å¹¿æ³›ä½¿ç”¨ï¼ŒåŒæ ·çš„ï¼Œ&lt;code&gt;UICollectionView&lt;/code&gt;ç”±äºå…¶NBçš„å¸ƒå±€ä¹Ÿè¢«å¹¿æ³›ä½¿ç”¨ã€‚ä½†æ˜¯åè€…åœ¨ä½¿ç”¨çš„æ—¶å€™å¤§å¤šæ•°éƒ½å±äºè‡ªå®šä¹‰çš„æ¯”è¾ƒå¤šï¼Œå‰è€…åˆ™ç›¸å¯¹æ™®é€šï¼ŒliståŸºæœ¬ä¸Šéƒ½ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸šåŠ¡éœ€æ±‚ä¸­ï¼Œå¸¸è§„å¸ƒå±€ï¼Œå¤§å¤šæ•°éƒ½æ˜¯é‡‡ç”¨&lt;code&gt;UITableView&lt;/code&gt;è¿›è¡Œçš„ï¼Œä½†æ˜¯æœ‰ç—›ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ä½¿åœ¨APPå†…ç”¨è¿‡ä¸€æ¬¡ç€‘å¸ƒæµä¹‹åï¼Œè®¾è®¡å¸ˆä¼šçªç„¶çš„è®©ä½ åœ¨æ­£å¸¸çš„listä¸­åº•éƒ¨è¿½åŠ ç€‘å¸ƒæµã€‚ã€‚è™½ç„¶æ˜¯åœ¨åº•éƒ¨è¿½åŠ ï¼Œä½†æ˜¯è¦ä»&lt;code&gt;UITableView&lt;/code&gt;è¿ç§»åˆ°&lt;code&gt;UICollectionView&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;UITableViewDelegate&lt;/code&gt;ã€&lt;code&gt;UITableViewDataSource&lt;/code&gt; ææ€•æ¯å¤„ä½¿ç”¨éƒ½è¦å†™ç¹ççš„ç›¸åŒçš„ä»£ç å§ï½&lt;/li&gt;
&lt;li&gt;å¾ˆå¤šäººä¹Ÿä¼šå¯¹å…¶è¿›è¡Œé«˜åº¦ç¼“å­˜å•Šç¥é©¬çš„ä¼˜åŒ–ç­–ç•¥&lt;/li&gt;
&lt;li&gt;ä¸çŸ¥ä¸è§‰è¿™äº›ä»£ç å †åœ¨ä¸€èµ·å·²ç»å°†&lt;code&gt;UIViewController&lt;/code&gt;å †çš„ç›¸å½“çš„é«˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åå‘¢ï¼Œæˆ‘ä»¬ç°åœ¨ä½¿ç”¨ä¸€ä¸ª&lt;code&gt;CollectionView&lt;/code&gt;å°†è¿™äº›æ“ä½œåŒ…è£…ä¸€ä¸‹ï¼Œè¾¾åˆ°è¿™æ ·ä¸€ä¸ªæµç¨‹:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;è‡ªå®šä¹‰Cellã€CellModel&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;LabelCell&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;UICollectionViewCell&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; info = &lt;span class=&quot;type&quot;&gt;UILabel&lt;/span&gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;sizeThatFits&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; size: CGSize)&lt;/span&gt;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;type&quot;&gt;CGSize&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;CGSize&lt;/span&gt;(width: size.width, height: info.frame.maxY + info.frame.minY)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;LabelCell&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Model&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;ListItemDefaultProtocol&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; info: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;?&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;fillModel&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(view: LabelCell)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            view.info.text = info&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è¯·æ±‚ã€å¤„ç†æ•°æ®æ ¼å¼åŒ–ä¸º&lt;code&gt;LabelCell.Model&lt;/code&gt;è¿™æ ·çš„ç±»&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¤„ç†å¥½çš„æ•°æ®äº¤ç»™&lt;code&gt;CollectionView&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;list.sections = model.format(...)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä¼‘æ¯ä¸€ä¼šï¼Œå®Œå·¥äº†ï½&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç„¶åï¼Œæ¥çœ‹çœ‹&lt;code&gt;Collection&lt;/code&gt;é‡Œé¢éƒ½åšäº†ä»€ä¹ˆæ“ä½œ&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="tool" scheme="https://madordie.github.io/tags/tool/"/>
    
      <category term="UICollectionView" scheme="https://madordie.github.io/tags/UICollectionView/"/>
    
  </entry>
  
  <entry>
    <title>mac10.13 pods å‘½ä»¤é”™è¯¯</title>
    <link href="https://madordie.github.io/post/macos-high-sierra-cocoapods/"/>
    <id>https://madordie.github.io/post/macos-high-sierra-cocoapods/</id>
    <published>2017-09-29T06:03:58.000Z</published>
    <updated>2017-10-10T06:08:43.664Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>æ¯é€¢å‡çº§å¤§ç‰ˆæœ¬æ€»è¦è¿‡æç‚¹äº‹æƒ…ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ pod env</div><div class="line">-bash: /usr/<span class="built_in">local</span>/bin/pod: /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/bin/ruby: bad interpreter: No such file or directory</div></pre></td></tr></table></figure>
<p>ä¸è®ºæ˜¯<code>pod env</code>ã€<code>pod update</code> ç­‰ç­‰å‡æŠ¥ä¸Šé¢çš„é”™è¯¯ã€‚</p>
<p>å¦‚æœGoogleå‘ç°ï¼š</p>
<ul>
<li><a href="https://stackoverflow.com/questions/44396215/cocoapods-not-working-in-macos-high-sierra" target="_blank" rel="external">ruby - CocoaPods not working in macOS High Sierra - Stack Overflow</a></li>
<li><a href="https://github.com/CocoaPods/CocoaPods/issues/6778" target="_blank" rel="external">CocoaPods CLI fails in High Sierra due to change of Ruby version #6778</a></li>
<li><a href="https://github.com/CocoaPods/CocoaPods/issues/6898#issuecomment-332060096" target="_blank" rel="external">High Sierra: bad interpreter #6898</a></li>
</ul>
<p>äº‹æƒ…çš„ç¼˜ç”±å°±æ˜¯è¿™æ ·ã€‚</p>
<p><a href="https://github.com/CocoaPods/CocoaPods/issues/6898#issuecomment-332060096" target="_blank" rel="external">#6898</a>ä¸­é“å‡ºäº†ç®€å•ç›´æ¥çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<blockquote>
<p>for all others:</p>
<p><code>gem install -n /usr/local/bin cocoapods</code></p>
<p>fixes it</p>
</blockquote>
<p><strong>ç»¼åˆèµ·æ¥</strong>è§£å†³è¿™ä¸ªé—®é¢˜æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ gem update --system</div><div class="line">$ gem uninstall cocoapods</div><div class="line">$ <span class="built_in">echo</span> <span class="string">'gem: --bindir /usr/local/bin'</span> &gt;&gt; ~/.gemrc</div><div class="line">$ sudo gem install cocoapods</div></pre></td></tr></table></figure>
<p>æ„‰å¿«çš„ä½¿ç”¨cocoapodså§ï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css&quot;&gt;&lt;p&gt;æ¯é€¢å‡çº§å¤§ç‰ˆæœ¬æ€»è¦è¿‡æç‚¹äº‹æƒ…ã€‚&lt;/p&gt;
&lt;figure class=&quot;hig
    
    </summary>
    
      <category term="macOS" scheme="https://madordie.github.io/categories/macOS/"/>
    
    
      <category term="cocoapods" scheme="https://madordie.github.io/tags/cocoapods/"/>
    
  </entry>
  
  <entry>
    <title>mac10.13ä¾æ—§è®©Xcodeæ”¯æŒæ‰“å¼€ç»ˆç«¯</title>
    <link href="https://madordie.github.io/post/mac-high-sierra-open-with-external/"/>
    <id>https://madordie.github.io/post/mac-high-sierra-open-with-external/</id>
    <published>2017-09-28T11:06:47.000Z</published>
    <updated>2017-10-09T04:59:40.197Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>åœ¨macOS10.13ä»¥å‰æ˜¯æ”¯æŒXcodeä¸­ç›´æ¥æ‰“å¼€ç»ˆç«¯çš„ï¼Œæ­¥éª¤å‘¢å°±æ˜¯ä¸‹é¢è¿™æ ·å­ï¼š</p>
<p><img src="/images/mac-high-sierra-open-with-external-1.gif" alt="æ•ˆæœå›¾"></p>
<ol>
<li>å³å‡»å·¥ç¨‹</li>
<li>Open With External Editor</li>
<li>ç»ˆç«¯å¼¹å‡ºæ¥äº†ã€‚ã€‚</li>
</ol>
<p>å¦‚æœæ²¡æœ‰ç”Ÿæ•ˆï¼Œå°±æ˜¯ä½ çš„ç”µè„‘ä¸Šè£…äº†ä»€ä¹ˆå¯ä»¥æ‰“å¼€<code>xx.xcodeproj</code>çš„åº”ç”¨ç¨‹åºï¼Œä¹Ÿå°±æ˜¯åœ¨<code>Finder</code>ä¸‹å³å‡»å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ ·å¼ï¼š</p>
<p><img src="/images/mac-high-sierra-open-with-external-2.jpg" alt="æ•ˆæœå›¾"></p>
<p>å‘ï½ Xcodeä¸ºé»˜è®¤ï¼Œå¤‡å¿˜å½•ä¸ºé»˜è®¤ä¸‹é¢çš„ç¬¬ä¸€ä¸ªï½ï½</p>
<p>å¯¹ï¼Œå¦‚æœè¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šé¢3æ­¥ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼šè¿™ä¸ªæ–‡ä»¶è¢«è«åå…¶å¦™çš„ä¿å­˜åœ¨äº†å¤‡å¿˜å½•ï½ï½  </p>
<p>è¿™ä¸æ˜¯æˆ‘ä»¬è¦çš„ğŸ¤·â€â™‚ï¸ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¿®æ”¹<code>å¤‡å¿˜å½•.app</code>çš„é…ç½®æ–‡ä»¶æ¥è¾¾åˆ°æˆ‘ä»¬çš„æ•ˆæœã€‚</p>
<a id="more"></a>
<h3 id="æˆå› "><a href="#æˆå› " class="headerlink" title="æˆå› "></a>æˆå› </h3><p>macSO10.13åŠ å¼ºäº†å¤‡å¿˜å½•ï¼Œå—¯çš„ç¡®å˜å¼ºäº†ï¼Œå¯æ˜¯å¹¶æ²¡æœ‰Xcodeå’Œç»ˆç«¯å¸¸ç”¨ã€‚</p>
<p>å¤‡å¿˜å½•å¢åŠ äº†å¯¼å…¥çš„åŠŸèƒ½ï¼Œæ”¯æŒäº†ä¸€äº›æ–‡ä»¶çš„æ‰“å¼€(åªæ˜¯å¯¼å…¥è€Œå·²ã€‚ã€‚)ï¼Œä½†æ˜¯å¹¶ä¸é€‚åˆæˆ‘ã€‚äºæ˜¯æ”¹ä¸€ä¸‹å§ï½ï½</p>
<h3 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h3><ol>
<li>åœ¨<code>åº”ç”¨ç¨‹åº</code>ä¸­æ‰¾åˆ°<code>å¤‡å¿˜å½•</code></li>
<li>æ˜¾ç¤ºåŒ…å†…å®¹</li>
<li>æ‰¾åˆ° æˆ‘ä»¬è¦ä¿®æ”¹çš„plistæ–‡ä»¶ï¼š <code>Contents/Info.plist</code></li>
<li>åšä¸€ä¸‹å¤‡ä»½ï¼šå¤åˆ¶ä¸€ä¸‹ã€‚ã€‚</li>
<li>ç¡®ä¿ <4> å·²å®Œæˆ</4></li>
<li>ç›´æ¥ä¿®æ”¹<code>Info.plist</code>ä¼šæç¤ºæ²¡æœ‰æƒé™ï¼Œä½¿ç”¨<code>sudo vim Info.plist</code>ä¿®æ”¹</li>
<li><p>ä¸ç®¡ä½ ç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œåˆ é™¤ä¸‹é¢çš„è¿™äº›ä»£ç </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleTypeName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>General files and folders<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>CFBundleTypeRole<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>Viewer<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>LSItemContentTypes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>public.data<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>public.directory<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p><code>:wq</code></p>
</li>
<li>é‡å¯ä¸€ä¸‹ ï¼ˆç›®çš„ï¼šé‡å»ºç´¢å¼•ï¼‰</li>
</ol>
<h3 id="è‡³äºæˆ‘åšäº†ä»€ä¹ˆ"><a href="#è‡³äºæˆ‘åšäº†ä»€ä¹ˆ" class="headerlink" title="è‡³äºæˆ‘åšäº†ä»€ä¹ˆ"></a>è‡³äºæˆ‘åšäº†ä»€ä¹ˆ</h3><p>è®²é“ç†ï¼Œç”¨Xcodeçš„éƒ½çŸ¥é“å§ï¼Ÿè¿™ä¸ªæ˜¯æ³¨å†Œçš„appæ”¯æŒçš„æ–‡ä»¶ç±»å‹ã€‚ åˆ é™¤ä¹‹åå°±å¯ä»¥äº†ï¼Œå°±è¿™ä¹ˆå¤šğŸ˜‚</p>
<h3 id="æ³¨æ„ä¸€ä¸‹"><a href="#æ³¨æ„ä¸€ä¸‹" class="headerlink" title="æ³¨æ„ä¸€ä¸‹"></a>æ³¨æ„ä¸€ä¸‹</h3><p><code>æ“ä½œ</code>ä¸­çš„<code>æ­¥éª¤9</code>å¯ä»¥æœ‰è„šæœ¬ï¼Œä½†æ˜¯è¿˜æ˜¯è€å®é‡å¯ä¸€ä¸‹å§ï¼Œæœ‰çš„è„šæœ¬ä¼šä½¿éƒ¨åˆ†å›¾æ ‡å¤±æ•ˆï¼Œå·¨çƒ¦ã€‚ã€‚è¿˜æ˜¯é‡å¯ä¸€ä¸‹æ¯”è¾ƒé è°±ã€‚æ¯•ç«Ÿä¸ç€æ€¥</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨macOS10.13ä»¥å‰æ˜¯æ”¯æŒXcodeä¸­ç›´æ¥æ‰“å¼€ç»ˆç«¯çš„ï¼Œæ­¥éª¤å‘¢å°±æ˜¯ä¸‹é¢è¿™æ ·å­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/mac-high-sierra-open-with-external-1.gif&quot; alt=&quot;æ•ˆæœå›¾&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å³å‡»å·¥ç¨‹&lt;/li&gt;
&lt;li&gt;Open With External Editor&lt;/li&gt;
&lt;li&gt;ç»ˆç«¯å¼¹å‡ºæ¥äº†ã€‚ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰ç”Ÿæ•ˆï¼Œå°±æ˜¯ä½ çš„ç”µè„‘ä¸Šè£…äº†ä»€ä¹ˆå¯ä»¥æ‰“å¼€&lt;code&gt;xx.xcodeproj&lt;/code&gt;çš„åº”ç”¨ç¨‹åºï¼Œä¹Ÿå°±æ˜¯åœ¨&lt;code&gt;Finder&lt;/code&gt;ä¸‹å³å‡»å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ ·å¼ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/mac-high-sierra-open-with-external-2.jpg&quot; alt=&quot;æ•ˆæœå›¾&quot;&gt;&lt;/p&gt;
&lt;p&gt;å‘ï½ Xcodeä¸ºé»˜è®¤ï¼Œå¤‡å¿˜å½•ä¸ºé»˜è®¤ä¸‹é¢çš„ç¬¬ä¸€ä¸ªï½ï½&lt;/p&gt;
&lt;p&gt;å¯¹ï¼Œå¦‚æœè¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šé¢3æ­¥ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼šè¿™ä¸ªæ–‡ä»¶è¢«è«åå…¶å¦™çš„ä¿å­˜åœ¨äº†å¤‡å¿˜å½•ï½ï½  &lt;/p&gt;
&lt;p&gt;è¿™ä¸æ˜¯æˆ‘ä»¬è¦çš„ğŸ¤·â€â™‚ï¸ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¿®æ”¹&lt;code&gt;å¤‡å¿˜å½•.app&lt;/code&gt;çš„é…ç½®æ–‡ä»¶æ¥è¾¾åˆ°æˆ‘ä»¬çš„æ•ˆæœã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="macOS" scheme="https://madordie.github.io/categories/macOS/"/>
    
    
      <category term="Xcode" scheme="https://madordie.github.io/tags/Xcode/"/>
    
  </entry>
  
  <entry>
    <title>Xcode9ç¼–è¯‘å¤±è´¥</title>
    <link href="https://madordie.github.io/post/debug-xcode9-build-ipa/"/>
    <id>https://madordie.github.io/post/debug-xcode9-build-ipa/</id>
    <published>2017-09-26T06:16:32.000Z</published>
    <updated>2017-10-11T03:37:39.832Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="é”™è¯¯è¾“å‡º"><a href="#é”™è¯¯è¾“å‡º" class="headerlink" title="é”™è¯¯è¾“å‡º"></a>é”™è¯¯è¾“å‡º</h2><blockquote>
<p>error: exportArchive: â€œFangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features.</p>
<p>Error Domain=IDEProvisioningErrorDomain Code=9 â€œâ€Fangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features.â€ UserInfo={NSLocalizedDescription=â€Fangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features., NSLocalizedRecoverySuggestion=Add a profile to the â€œprovisioningProfilesâ€ dictionary in your Export Options property list.}</p>
</blockquote>
<a id="more"></a>
<h2 id="é”™è¯¯åŸå› "><a href="#é”™è¯¯åŸå› " class="headerlink" title="é”™è¯¯åŸå› "></a>é”™è¯¯åŸå› </h2><p>åœ¨å‡çº§Xcode9æ­£å¼ç‰ˆä¹‹åï¼ŒJenkinsä¹Ÿå°±å‡çº§äº†ï¼Œäºæ˜¯ä¹ç”¨åŸæ¥çš„å¥—è·¯æ‰“åŒ…ä¹‹åå°±æ˜¯ä¸Šé¢çš„é”™è¯¯ 5555â€¦</p>
<p>å¦‚æœä½¿ç”¨<code>xcodebuild</code>è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªä¼šå‘ç”Ÿåœ¨é€‰æ‹©è¯ä¹¦çš„æ­¥éª¤ï¼Œé”™è¯¯å¤§è‡´å°±æ˜¯è¿™æ ·ã€‚</p>
<p><code>$xcodebuild --help</code> å¯ä»¥çœ‹åˆ°ä¸€äº›ä¿¡æ¯ï¼Œè€Œä¸”åœ¨æœ€åè¿˜ç‰¹æ„æå‡ºäº†ä¸€ä¸ªâ€œ-exportOptionsPlistâ€å‚æ•°ã€‚å…·ä½“å†…å®¹è§<code>xcodebuild --help</code></p>
<h2 id="è§£å†³é—®é¢˜æ‰æ˜¯å…³é”®"><a href="#è§£å†³é—®é¢˜æ‰æ˜¯å…³é”®" class="headerlink" title="è§£å†³é—®é¢˜æ‰æ˜¯å…³é”®"></a>è§£å†³é—®é¢˜æ‰æ˜¯å…³é”®</h2><ol>
<li><p>ä½¿ç”¨xcode9è¿›è¡Œä¸€æ¬¡<code>archive</code></p>
</li>
<li><p>é€‰æ‹©ç›¸å…³è¯ä¹¦å•Šç¥é©¬çš„ï¼Œä¿æŒ<code>thinning</code>ä¸å˜å°±å¥½</p>
</li>
<li><p>å¯¼å‡º</p>
</li>
<li><p>å¯¼å‡ºç›®å½•æœ‰ä¸€ä¸ª<code>ExportOptionsPlist.plist</code>ï¼Œè¿™ä¸ªå°±æ˜¯æ‰“åŒ…æ—¶å€™éœ€è¦çš„plist</p>
</li>
</ol>
<h2 id="è„šæœ¬æ„å»º"><a href="#è„šæœ¬æ„å»º" class="headerlink" title="è„šæœ¬æ„å»º"></a>è„šæœ¬æ„å»º</h2><p><code>ipa</code>å³ä¸ºç›®æ ‡å˜é‡ï¼Œå…·ä½“çš„å‚çœ‹<a href="../build-ipa-sh">æ‰“åŒ…è„šæœ¬</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">rm -rf ./build/*</div><div class="line">cat &lt;&lt; EOF &gt; ./build/<span class="built_in">export</span>OptionsPlist.plist</div><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</div><div class="line">&lt;!DOCTYPE plist PUBLIC <span class="string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;</div><div class="line">&lt;plist version=<span class="string">"1.0"</span>&gt;</div><div class="line">&lt;dict&gt;</div><div class="line">    &lt;key&gt;compileBitcode&lt;/key&gt;</div><div class="line">    &lt;<span class="literal">true</span>/&gt;</div><div class="line">    &lt;key&gt;method&lt;/key&gt;</div><div class="line">    &lt;string&gt;enterprise&lt;/string&gt;</div><div class="line">    &lt;key&gt;provisioningProfiles&lt;/key&gt;</div><div class="line">    &lt;dict&gt;</div><div class="line">        &lt;key&gt;ershoufanglzg.fangdd.com&lt;/key&gt;</div><div class="line">        &lt;string&gt;ershoufanglzg_dis&lt;/string&gt;</div><div class="line">    &lt;/dict&gt;</div><div class="line">    &lt;key&gt;signingCertificate&lt;/key&gt;</div><div class="line">    &lt;string&gt;iPhone Distribution&lt;/string&gt;</div><div class="line">    &lt;key&gt;signingStyle&lt;/key&gt;</div><div class="line">    &lt;string&gt;manual&lt;/string&gt;</div><div class="line">    &lt;key&gt;stripSwiftSymbols&lt;/key&gt;</div><div class="line">    &lt;<span class="literal">true</span>/&gt;</div><div class="line">    &lt;key&gt;teamID&lt;/key&gt;</div><div class="line">    &lt;string&gt;J3B467DURT&lt;/string&gt;</div><div class="line">    &lt;key&gt;thinning&lt;/key&gt;</div><div class="line">    &lt;string&gt;&amp;lt;none&amp;gt;&lt;/string&gt;</div><div class="line">&lt;/dict&gt;</div><div class="line">&lt;/plist&gt;</div><div class="line">EOF</div><div class="line"></div><div class="line">xcodebuild -archivePath <span class="string">"./build/xxx.xcarchive"</span> -workspace Fangduoduo.xcworkspace -sdk iphoneos -scheme <span class="string">"Fangduoduo_ent"</span> -configuration <span class="string">"Release Inhouse"</span> archive</div><div class="line">xcodebuild -exportArchive -archivePath <span class="string">"./build/xxx.xcarchive"</span> -exportPath <span class="string">"./build/"</span> -exportOptionsPlist ./build/<span class="built_in">export</span>OptionsPlist.plist</div><div class="line"></div><div class="line">ipa=$(<span class="built_in">pwd</span>)/$(ls ./build/*.ipa)</div></pre></td></tr></table></figure>
<h2 id="xcodebuild-â€“help"><a href="#xcodebuild-â€“help" class="headerlink" title="xcodebuild â€“help"></a>xcodebuild â€“help</h2><blockquote>
<p>Available keys for -exportOptionsPlist:</p>
<p>compileBitcode : Bool</p>
<p>For non-App Store exports, should Xcode re-compile the app from bitcode? Defaults to YES.</p>
<p>embedOnDemandResourcesAssetPacksInBundle : Bool</p>
<p>For non-App Store exports, if the app uses On Demand Resources and this is YES, asset packs are embedded in the app bundle so that the app can be tested without a server to host asset packs. Defaults to YES unless onDemandResourcesAssetPacksBaseURL is specified.</p>
<p>iCloudContainerEnvironment : String</p>
<p>If the app is using CloudKit, this configures the â€œcom.apple.developer.icloud-container-environmentâ€ entitlement. Available options vary depending on the type of provisioning profile used, but may include: Development and Production.</p>
<p>installerSigningCertificate : String</p>
<p>For manual signing only. Provide a certificate name, SHA-1 hash, or automatic selector to use for signing. Automatic selectors allow Xcode to pick the newest installed certificate of a particular type. The available automatic selectors are â€œMac Installer Distributionâ€ and â€œDeveloper ID Installerâ€. Defaults to an automatic certificate selector matching the current distribution method.</p>
<p>manifest : Dictionary</p>
<p>For non-App Store exports, users can download your app over the web by opening your distribution manifest file in a web browser. To generate a distribution manifest, the value of this key should be a dictionary with three sub-keys: appURL, displayImageURL, fullSizeImageURL. The additional sub-key assetPackManifestURL is required when using on-demand resources.</p>
<p>method : String</p>
<p>Describes how Xcode should export the archive. Available options: app-store, package, ad-hoc, enterprise, development, developer-id, and mac-application. The list of options varies based on the type of archive. Defaults to development.</p>
<p>onDemandResourcesAssetPacksBaseURL : String</p>
<p>For non-App Store exports, if the app uses On Demand Resources and embedOnDemandResourcesAssetPacksInBundle isnâ€™t YES, this should be a base URL specifying where asset packs are going to be hosted. This configures the app to download asset packs from the specified URL.</p>
<p>provisioningProfiles : Dictionary</p>
<p>For manual signing only. Specify the provisioning profile to use for each executable in your app. Keys in this dictionary are the bundle identifiers of executables; values are the provisioning profile name or UUID to use.</p>
<p>signingCertificate : String</p>
<p>For manual signing only. Provide a certificate name, SHA-1 hash, or automatic selector to use for signing. Automatic selectors allow Xcode to pick the newest installed certificate of a particular type. The available automatic selectors are â€œMac App Distributionâ€, â€œiOS Developerâ€, â€œiOS Distributionâ€, â€œDeveloper ID Applicationâ€, and â€œMac Developerâ€. Defaults to an automatic certificate selector matching the current distribution method.</p>
<p>signingStyle : String</p>
<p>The signing style to use when re-signing the app for distribution. Options are manual or automatic. Apps that were automatically signed when archived can be signed manually or automatically during distribution, and default to automatic. Apps that were manually signed when archived must be manually signed during distribtion, so the value of signingStyle is ignored.</p>
<p>stripSwiftSymbols : Bool</p>
<p>Should symbols be stripped from Swift libraries in your IPA? Defaults to YES.</p>
<p>teamID : String</p>
<p>The Developer Portal team to use for this export. Defaults to the team used to build the archive.</p>
<p>thinning : String</p>
<p>For non-App Store exports, should Xcode thin the package for one or more device variants? Available options: <none> (Xcode produces a non-thinned universal app), <thin-for-all-variants> (Xcode produces a universal app and all available thinned variants), or a model identifier for a specific device (e.g. â€œiPhone7,1â€). Defaults to <none>.</none></thin-for-all-variants></none></p>
<p>uploadBitcode : Bool</p>
<p>For App Store exports, should the package include bitcode? Defaults to YES.</p>
<p>uploadSymbols : Bool</p>
<p>For App Store exports, should the package include symbols? Defaults to YES.</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;é”™è¯¯è¾“å‡º&quot;&gt;&lt;a href=&quot;#é”™è¯¯è¾“å‡º&quot; class=&quot;headerlink&quot; title=&quot;é”™è¯¯è¾“å‡º&quot;&gt;&lt;/a&gt;é”™è¯¯è¾“å‡º&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;error: exportArchive: â€œFangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features.&lt;/p&gt;
&lt;p&gt;Error Domain=IDEProvisioningErrorDomain Code=9 â€œâ€Fangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features.â€ UserInfo={NSLocalizedDescription=â€Fangduoduo_ent.appâ€ requires a provisioning profile with the Push Notifications and Associated Domains features., NSLocalizedRecoverySuggestion=Add a profile to the â€œprovisioningProfilesâ€ dictionary in your Export Options property list.}&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="æ„å»º" scheme="https://madordie.github.io/tags/%E6%9E%84%E5%BB%BA/"/>
    
      <category term="DEBUG" scheme="https://madordie.github.io/tags/DEBUG/"/>
    
  </entry>
  
  <entry>
    <title>iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹</title>
    <link href="https://madordie.github.io/post/ios-automation-jenkins-build/"/>
    <id>https://madordie.github.io/post/ios-automation-jenkins-build/</id>
    <published>2017-09-14T09:27:15.000Z</published>
    <updated>2017-10-10T06:05:41.268Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><ul>
<li><a href="../ios-automation-jenkins-configuration">iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º</a></li>
<li><a href="../ios-automation-jenkins-build">iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹</a></li>
</ul>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Jenkinsç¯å¢ƒå·²æ­å»ºå¥½ï¼Œç°åœ¨æˆ‘ä»¬æ¥å¼€å§‹æ„‰å¿«çš„ä¸ºiOSæ‰“åŒ…å§ï½</p>
<p>ä»è¿™ä¸ªæ–‡ç« ä¸­ä½ å°†è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>åœ¨Jenkinsåˆ›å»ºå·¥ç¨‹</li>
<li>buildå‡ºipa</li>
<li>å°†ipaä¸Šä¼ è‡³fir</li>
<li>é’‰é’‰æœºå™¨äººç¾¤é€šçŸ¥</li>
<li>å°†dsymä¸Šä¼ è‡³bugly</li>
</ul>
<a id="more"></a>
<h2 id="è„šæœ¬ç¯å¢ƒå®‰è£…"><a href="#è„šæœ¬ç¯å¢ƒå®‰è£…" class="headerlink" title="è„šæœ¬ç¯å¢ƒå®‰è£…"></a>è„šæœ¬ç¯å¢ƒå®‰è£…</h2><p>è¿™é‡Œå¤§å¤šæ•°æ“ä½œéƒ½æ˜¯ç”¨è„šæœ¬æ¥è¿›è¡Œçš„ï¼Œä¸ä¸ºåˆ«çš„ï¼Œå°±ä¸ºè‡ªç”±å’Œä»¥åï½</p>
<h3 id="fastlane"><a href="#fastlane" class="headerlink" title="fastlane"></a>fastlane</h3><p>æ­¤ä¹ƒè‡ªåŠ¨åŒ–ç¥å™¨ã€‚<a href="https://docs.fastlane.tools" target="_blank" rel="external">æ–‡æ¡£åœ¨æ­¤</a>ã€‚<a href="https://github.com/fastlane/fastlane" target="_blank" rel="external">å¼€æºå“Ÿï½</a></p>
<p>æ­¤å¤„ä¸»è¦ç”¨æ¥ç¼–è¯‘ã€æ‰“åŒ…ã€‚</p>
<p>å®‰è£…æ–¹æ³•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ brew cask install fastlane</div></pre></td></tr></table></figure>
<p>æ­¤ç¥å™¨é™¤äº†ä¸Šè¿°åŠŸèƒ½ï¼Œè¿˜æä¾›å¾ˆå¤šå¾ˆå¤šå¾ˆå¤šå¾ˆå¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç¥é©¬çš„éƒ½æ”¯æŒã€‚éœ€è¦çš„å¯ä»¥å»æ–‡æ¡£é‡Œé¢ç¿»ç¿»ã€‚</p>
<p>åœ¨Xcode9 æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬2.14.1æ‰“åŒ…å‡ºé—®é¢˜äº†ã€‚ã€‚å…·ä½“åœ¨è¿™é‡Œè¯¦è§<a href="../debug-xcode9-build-ipa">Xcode9ç¼–è¯‘å¤±è´¥</a>ã€‚äºæ˜¯å‘¼é‡‡ç”¨äº†<code>xcodebuild</code>è¿›è¡Œæ‰“åŒ…</p>
<h3 id="fir-im-cli"><a href="#fir-im-cli" class="headerlink" title="fir.im-cli"></a>fir.im-cli</h3><p><a href="https://fir.im" target="_blank" rel="external">fir.im</a>æä¾›çš„åº”ç”¨å†…æµ‹æ‰˜ç®¡å·¥å…·ã€‚<a href="https://github.com/FIRHQ/fir-cli/blob/master/README.md" target="_blank" rel="external">å¼€æºå®˜ç½‘</a>ã€‚</p>
<p>å®‰è£…æ–¹æ³•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gem install fir-cli</div></pre></td></tr></table></figure>
<p>æ­¤å·¥å…·ä¹Ÿæä¾›æ‰“åŒ…ipaã€apkã€ä¸Šä¼ ç¬¦å·è¡¨è‡³BugHDã€ç­‰åŠŸèƒ½ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹©äº†<code>fastlane gym</code></p>
<p>ä¸Šä¼ åŠ é€Ÿï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sh -c <span class="string">"<span class="variable">$(curl -sSL https://gist.githubusercontent.com/trawor/5dda140dee86836b8e60/raw/turbo-qiniu.sh)</span>"</span></div></pre></td></tr></table></figure>
<p>ä¸Šä¼ åŠ é€Ÿä»£ç å·²ç»<a href="http://blog.fir.im/turbo-qiniu/" target="_blank" rel="external">å¼€æºè‡³æ­¤</a>ã€‚</p>
<p><a href="http://bughd.com" target="_blank" rel="external">BugHD</a>: å·²åœæ­¢çº¿ä¸Šå…è´¹æœåŠ¡ï¼Œå¼€å§‹å–ç§æœ‰éƒ¨ç½²äº†ã€‚</p>
<p>å¦å¤–ï¼Œfir ä¹Ÿæœ‰<a href="http://blog.fir.im/jenkins/" target="_blank" rel="external">Jenkinsæ’ä»¶</a>ï¼Œä½†æ˜¯è¿™é‡Œé€‰æ‹©è„šæœ¬æ–¹å¼ã€‚</p>
<h2 id="æ’ä»¶å®‰è£…"><a href="#æ’ä»¶å®‰è£…" class="headerlink" title="æ’ä»¶å®‰è£…"></a>æ’ä»¶å®‰è£…</h2><p>æ‰€æœ‰çš„æ’ä»¶å¯ä»¥åœ¨<code>ç³»ç»Ÿç®¡ç† -&gt; æ’ä»¶ç®¡ç†</code>ä¸­è¿›è¡Œå®‰è£…ã€å¸è½½ã€é™çº§ã€æ›´æ–°ã€ç­‰æ“ä½œã€‚</p>
<p>ç¡®ä¿ä»¥ä¸‹æ’ä»¶å·²ç»è¢«å®‰è£…ï¼š</p>
<ul>
<li>æºä»£ç ç®¡ç†ï¼š<a href="https://wiki.jenkins.io/display/JENKINS/Git+Plugin" target="_blank" rel="external">Git Plugin</a></li>
<li>ç¼–è¯‘è„šæœ¬ç¯å¢ƒå˜é‡ï¼š<a href="http://wiki.hudson-ci.org/display/HUDSON/Tool+Environment+Plugin" target="_blank" rel="external">Tool Environment Plugin</a></li>
</ul>
<p>å—¯ï¼Œå¼€å§‹åˆ›å»ºå·¥ç¨‹ï¼Œç„¶åé…ç½®æ‰“åŒ…å§ï¼</p>
<h2 id="å·¥ç¨‹ç›¸å…³é…ç½®"><a href="#å·¥ç¨‹ç›¸å…³é…ç½®" class="headerlink" title="å·¥ç¨‹ç›¸å…³é…ç½®"></a>å·¥ç¨‹ç›¸å…³é…ç½®</h2><p>å·¦ä¾§çš„<code>æ–°å»º(New Item)</code>æˆ‘å°±ä¸è¯´äº†å§ï½ï¼Œç‚¹å‡»è¾“å…¥é¡¹ç›®åå­—ï¼Œç„¶åé€‰æ‹©ç¬¬ä¸€ä¸ª<code>æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®</code>å°±è¡Œå•¦ï½ï½</p>
<p>æ­¤å¤„é¡¹ç›®åå­—æš‚ä¸”æˆä¸º<code>test</code>ã€‚è¿™é‡Œåªè¯´ä¸€äº›æ¯”è¾ƒé‡è¦çš„ï¼Œæ²¡æœ‰æ´»ä¸æˆçš„é‚£ç§é…ç½®ã€‚åˆ«çš„è‡ªå·±ç ”ç©¶ä¸€ä¸‹æˆ–è€…ç‚¹å‡»å³ä¾§â“å°±èƒ½çœ‹åˆ°ä»‹ç»ã€‚</p>
<h3 id="æºç ç®¡ç†"><a href="#æºç ç®¡ç†" class="headerlink" title="æºç ç®¡ç†"></a>æºç ç®¡ç†</h3><p>æ­¤å¤„ç‚¹å‡»<code>Git</code>ï¼Œå±•å¼€ä¹‹åè¾“å…¥<code>Repository URL</code>å³å¯ã€‚</p>
<p><code>Repository URL</code>è¾“å…¥å®Œæ¯•ä¹‹åç‚¹å‡»åˆ«å¤„ï¼ŒJenkinsçš„Gitæ’ä»¶ä¼šè‡ªåŠ¨æ ¡éªŒè¯¥URLæ˜¯å¦èƒ½å¤Ÿcloneä¸‹æ¥ä»£ç ã€‚å‡ºç°çº¢è‰²å°±è‡ªå·±æ ¹æ®é”™è¯¯ä¿®æ”¹ä¸€ä¸‹å’¯ã€‚ã€‚</p>
<p>å¦å¤–æ­¤å¤„æ”¯æŒ<code>ssh</code> çš„æ–¹å¼ï¼Œå¤§è‡´æ ·å¼ä¸ºï¼š<code>ssh://sunjigang@github.com:29418/projects/aaa</code>ã€‚</p>
<p><code>Branches to build</code> å†™ä¸Šä½ çš„æ„å»ºåˆ†æ”¯ï½ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚æ¥ï¼Œ<code>master</code>ä¸€èˆ¬ä¸ºä»“åº“çš„é»˜è®¤åˆ†æ”¯ã€‚</p>
<h3 id="æ„å»ºè§¦å‘å™¨"><a href="#æ„å»ºè§¦å‘å™¨" class="headerlink" title="æ„å»ºè§¦å‘å™¨"></a>æ„å»ºè§¦å‘å™¨</h3><p>æ­¤å¤„è¡¨ç¤ºè¯¥é¡¹ç›®çš„æ„å»ºè§¦å‘æ¡ä»¶ã€‚ï¼ˆå¯é€‰ï¼‰</p>
<p>æˆ‘ä»¬è¿™é‡Œè¯´ä¸€ä¸‹<code>Poll SCM</code>ï¼š</p>
<p>å®šæ—¶æ£€æŸ¥æºç å˜æ›´ã€‚æ¡ä»¶æ˜¯ ä¸€å®šè¦é…ç½®<code>Git</code>è¿™æ ·çš„æºç ç®¡ç†ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<ul>
<li><code>H/15 * * * *</code>ï¼šæ¯15åˆ†é’Ÿæ„å»ºä¸€æ¬¡</li>
<li><code>0 2 * * *</code>ï¼š æ¯å¤©2:00æ„å»ºä¸€æ¬¡</li>
</ul>
<h3 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><p>æ­¤å¤„ä¸ºæ„å»ºçš„æ ¸å¿ƒğŸ˜‚ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¸ºäº†è‡ªç”±ï¼Œæ­¤å¤„å…¨éƒ¨ä½¿ç”¨<code>shell</code>è„šæœ¬ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># å·¥ç¨‹å</span></div><div class="line">workspace=<span class="string">'xxx.xcworkspace'</span></div><div class="line"><span class="comment"># æ„å»ºscheme</span></div><div class="line">scheme=<span class="string">'xxx'</span></div><div class="line"><span class="comment"># æ‰“åŒ…ç±»å‹ï¼šapp-store, ad-hoc, package, enterprise, development, and developer-id.</span></div><div class="line">export_method=<span class="string">'enterprise'</span></div><div class="line"><span class="comment"># firçš„tokenï¼Œåœ¨fir-&gt;ç”¨æˆ·-&gt;token è·å–</span></div><div class="line">fir_token=<span class="string">'c5077e0368888b9750ae848b9fe00***'</span></div><div class="line"><span class="comment"># firä¸Šä¼ çŸ­é“¾æ¥ï¼Œæ•ˆæœä¸º https://fir.im/xxx</span></div><div class="line">fir_url=<span class="string">'xxx'</span></div><div class="line"><span class="comment"># é’‰é’‰æœºå™¨äººtoken</span></div><div class="line">dingtalk_token=<span class="string">'6d09e43ddc62e540be914ff2e901e28b921d55c5ad457f6f3571f9f881287***'</span></div><div class="line"><span class="comment"># é’‰é’‰æœºå™¨äººå‘é€çš„å†…å®¹</span></div><div class="line">dingtalk_content=<span class="string">"iOSXXXå·²ç»ä¸Šä¼ è‡³ http://fir.im/<span class="variable">$&#123;fir_url&#125;</span> ,å§å•¦å§å•¦å§å•¦ï½"</span></div><div class="line"></div><div class="line"><span class="comment"># æ„å»º</span></div><div class="line">fastlane gym</div><div class="line">    --workspace <span class="variable">$workspace</span> \</div><div class="line">    --scheme <span class="variable">$scheme</span> \</div><div class="line">    --export_method <span class="variable">$export_method</span> \</div><div class="line">    clean</div><div class="line"></div><div class="line"><span class="comment"># fir</span></div><div class="line">ipa=$(<span class="built_in">pwd</span>)/$(ls *.ipa)</div><div class="line">git <span class="built_in">log</span> -10 &gt; git.log</div><div class="line">fir p <span class="variable">$ipa</span> -T <span class="variable">$fir_token</span> <span class="_">-s</span> <span class="variable">$fir_url</span> -c git.log</div><div class="line"></div><div class="line"><span class="comment"># é’‰é’‰é€šçŸ¥</span></div><div class="line">curl <span class="string">"https://oapi.dingtalk.com/robot/send?access_token=<span class="variable">$&#123;dingtalk_token&#125;</span>"</span> -H <span class="string">'Content-Type: application/json'</span>    <span class="_">-d</span> <span class="string">'</span></div><div class="line">    &#123;"msgtype": "text",</div><div class="line">        "text": &#123;</div><div class="line">            "content":$&#123;dingtalk_content&#125;</div><div class="line">        &#125;</div><div class="line">    &#125;'</div></pre></td></tr></table></figure>
<p>è‡³æ­¤ å·²ç»å®Œæˆäº†æ‰“åŒ…ã€ä¸Šä¼ firã€é’‰é’‰æœºå™¨äººé€šçŸ¥ã€‚</p>
<p>ä¸Šè¿°è„šæœ¬åªæ˜¯é…ç½®çš„ä¾‹å­ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚ï¼Œè‡ªå·±ç¼–å†™å’Œé…ç½®ã€‚ç‰¹åˆ«æ˜¯</p>
<ul>
<li><code>.xcworkspace</code>çš„ä½ç½®ï¼Œè¦æ‰¾æ¸…æ¥šå‘€</li>
<li><code>scheme</code>æ— æ³•æ‰¾åˆ°æ˜¯å› ä¸ºä½ åœ¨æäº¤ä»£ç çš„æ—¶å€™æ²¡æœ‰å°†å…¶è®¾ç½®ä¸ºshared</li>
<li><code>fastlane gym</code> æ”¯æŒå¾ˆå¤šå‚æ•°ï¼Œæ˜¯å¯¹<code>xcodebuild</code>çš„å°è£…ï¼Œ<a href="https://github.com/fastlane/fastlane/tree/master/gym" target="_blank" rel="external">æºç åŠæ–‡æ¡£åœ¨æ­¤</a></li>
</ul>
<h3 id="ä¸Šä¼ dSYMè‡³Bugly"><a href="#ä¸Šä¼ dSYMè‡³Bugly" class="headerlink" title="ä¸Šä¼ dSYMè‡³Bugly"></a>ä¸Šä¼ dSYMè‡³Bugly</h3><p>è¿™ä¸ªè¿˜æ˜¯æœ‰ç‚¹ç‚¹å¤æ‚çš„ï¼Œå› ä¸ºbuglyå¹¶æœªæä¾›å®Œæ•´çš„cliå·¥å…·é“¾ï¼Œéœ€è¦æ‰‹åŠ¨è·‘jaråŒ…ã€‚ä¸è¿‡éƒ½æ˜¯å¯ä»¥å®Œæˆçš„ã€‚</p>
<p>ä¸ºäº†éš”ç¦»å¼€æ‰“åŒ…å’Œä¸Šä¼ ï¼Œè¿™é‡Œåœ¨Jenkinsä¸Šæ–°å»ºä¸€ä¸ªé¡¹ç›®ç”¨æ¥ä¸Šä¼ dSYM</p>
<p>å…¶ä¸­éœ€è¦è¡”æ¥çš„åœ°æ–¹å°±æ˜¯ä¸Šé¢çš„è¾“å‡ºè¦ä½œä¸ºè¿™ä¸ªçš„è¾“å‡ºã€‚æ‰€ä»¥éœ€è¦å‰åå¯¹åº”ä½ç½®ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># è·¯å¾„ä¸»è¦ç”¨æ¥æå–Info.plistä»¥åŠdsymæ–‡ä»¶</span></div><div class="line">path=<span class="string">'/Users/FDD/.jenkins/workspace/fdd-ios-app/fdd-app-ios/Fangduoduo'</span></div><div class="line"><span class="comment"># scheme name</span></div><div class="line">scheme=<span class="string">'Fangduoduo_ent'</span></div><div class="line"><span class="comment"># ipa bundleId</span></div><div class="line">package=<span class="string">'xx.xx.com'</span></div><div class="line"><span class="comment"># bugly id</span></div><div class="line">bugly_id=<span class="string">'9xxx'</span></div><div class="line"><span class="comment"># bugly key</span></div><div class="line">bugly_key=<span class="string">'wHzxcxxx'</span></div><div class="line"></div><div class="line">rm -rf *dSYM*</div><div class="line">cp <span class="variable">$&#123;path&#125;</span>/Fangduoduo/Fangduoduo_ent-Info.plist ./Info.plist</div><div class="line">cp -rf <span class="variable">$&#123;path&#125;</span>/build/*.xcarchive/dSYMs .</div><div class="line"></div><div class="line"><span class="comment"># ------------ post dsym ------------ #</span></div><div class="line"></div><div class="line">app_infoplist_path=<span class="string">'Info.plist'</span></div><div class="line">version=$(/usr/libexec/PlistBuddy -c <span class="string">"print CFBundleVersion"</span> <span class="variable">$&#123;app_infoplist_path&#125;</span>)</div><div class="line"></div><div class="line">java -jar ./bugly/buglySymboliOS.jar \</div><div class="line">	-i dSYMs/<span class="variable">$&#123;scheme&#125;</span>.app.dSYM \</div><div class="line">    -dsym \</div><div class="line">    -u \</div><div class="line">    -id <span class="variable">$&#123;bugly_id&#125;</span> \</div><div class="line">    -key <span class="variable">$&#123;bugly_key&#125;</span> \</div><div class="line">    -package <span class="variable">$&#123;package&#125;</span> \</div><div class="line">    -version <span class="variable">$&#123;version&#125;</span></div><div class="line">        </div><div class="line"><span class="comment"># @bugly jaræ‰§è¡Œçš„æ—¶å€™è¿”å›çŠ¶æ€ç æœ‰é—®é¢˜ã€‚å·²åé¦ˆï¼Œä½†æ˜¯ä¸è§ä¿®æ”¹ã€‚ã€‚</span></div><div class="line">    </div><div class="line"><span class="comment"># ------------ UUID ------------ #</span></div><div class="line"></div><div class="line">unzip -o ./dSYMs/<span class="variable">$&#123;scheme&#125;</span>.app.dSYM.zip</div><div class="line">xcrun dwarfdump --uuid ./<span class="variable">$&#123;scheme&#125;</span> &gt;&gt; ./uuids-<span class="variable">$&#123;version&#125;</span>.txt</div></pre></td></tr></table></figure>
<p>å€¼å¾—è¯´çš„æ˜¯ï¼Œå¦‚æœä¸Šé¢çš„æŠ¥é”™ï¼Œé‚£ä¹ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯è·¯å¾„ä»€ä¹ˆçš„å†™é”™äº†ã€‚ã€‚ã€‚</p>
<p>å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥åœ¨<a href="../../about">å…³äº</a>ä¸­æ‰¾åˆ°æˆ‘ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../ios-automation-jenkins-configuration&quot;&gt;iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../ios-automation-jenkins-build&quot;&gt;iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h2&gt;&lt;p&gt;Jenkinsç¯å¢ƒå·²æ­å»ºå¥½ï¼Œç°åœ¨æˆ‘ä»¬æ¥å¼€å§‹æ„‰å¿«çš„ä¸ºiOSæ‰“åŒ…å§ï½&lt;/p&gt;
&lt;p&gt;ä»è¿™ä¸ªæ–‡ç« ä¸­ä½ å°†è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨Jenkinsåˆ›å»ºå·¥ç¨‹&lt;/li&gt;
&lt;li&gt;buildå‡ºipa&lt;/li&gt;
&lt;li&gt;å°†ipaä¸Šä¼ è‡³fir&lt;/li&gt;
&lt;li&gt;é’‰é’‰æœºå™¨äººç¾¤é€šçŸ¥&lt;/li&gt;
&lt;li&gt;å°†dsymä¸Šä¼ è‡³bugly&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="æ„å»º" scheme="https://madordie.github.io/tags/%E6%9E%84%E5%BB%BA/"/>
    
      <category term="Jenkins" scheme="https://madordie.github.io/tags/Jenkins/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•å®ç°AppStoreæŸ¥çœ‹æ›´å¤šçš„æ–¹æ³•</title>
    <link href="https://madordie.github.io/post/appstore-truncate/"/>
    <id>https://madordie.github.io/post/appstore-truncate/</id>
    <published>2017-09-14T03:46:18.000Z</published>
    <updated>2017-10-10T05:34:54.501Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="UITextView-More"><a href="#UITextView-More" class="headerlink" title="UITextView-More"></a><a href="https://github.com/madordie/UITextView-More" target="_blank" rel="external">UITextView-More</a></h2><p>ä½¿ç”¨UITextKit å®ç°â€œæ›´å¤šâ€çš„æŠ˜å æ•ˆæœ</p>
<p><img src="https://github.com/madordie/UITextView-More/blob/master/Untitled.gif?raw=true" alt="é¢„è§ˆ"></p>
<a id="more"></a>
<h2 id="ä¸»è¦ä»£ç "><a href="#ä¸»è¦ä»£ç " class="headerlink" title="ä¸»è¦ä»£ç "></a>ä¸»è¦ä»£ç </h2><h3 id="è·å–æœ€åä¸€è¡ŒRect"><a href="#è·å–æœ€åä¸€è¡ŒRect" class="headerlink" title="è·å–æœ€åä¸€è¡ŒRect"></a>è·å–æœ€åä¸€è¡ŒRect</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> lastRect = <span class="type">CGRect</span>.zero</div><div class="line">layoutManager.enumerateEnclosingRects(forGlyphRange: <span class="type">NSRange</span>(location: <span class="number">0</span>, length: textStorage.string.characters.<span class="built_in">count</span>), withinSelectedGlyphRange: <span class="type">NSRange</span>(location: <span class="type">NSNotFound</span>, length: <span class="number">0</span>), <span class="keyword">in</span>: textContainer, using: &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (rect, isStop) <span class="keyword">in</span></div><div class="line"><span class="keyword">guard</span> <span class="keyword">let</span> _self = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</div><div class="line"><span class="keyword">var</span> newRect = rect</div><div class="line">newRect.origin.y += _self.textContainerInset.top</div><div class="line">lastRect = newRect</div><div class="line">&#125;)</div><div class="line"><span class="built_in">print</span>(lastRect)</div></pre></td></tr></table></figure>
<h3 id="å¢åŠ -exclusionPaths"><a href="#å¢åŠ -exclusionPaths" class="headerlink" title="å¢åŠ  exclusionPaths"></a>å¢åŠ  <code>exclusionPaths</code></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">textContainer.exclusionPaths = [<span class="type">UIBezierPath</span>.<span class="keyword">init</span>(rect: rect)]</div></pre></td></tr></table></figure>
<h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><ul>
<li><code>UITextView</code>é»˜è®¤æºå¸¦å·¦å³è¾¹è·ï¼Œé€šè¿‡<code>UITextView.textContainer.lineFragmentPadding</code>è·å–</li>
<li><code>UITextView</code>é»˜è®¤æºå¸¦ä¸Šä¸‹å·¦å³è¾¹è·(<code>UITextView.textContainerInset</code>)ï¼Œå…¶ä¸­å·¦å³å’Œ<code>lineFragmentPadding</code>ç›¸åŠ </li>
<li>æ­¤å¤„å¹¶æ²¡æœ‰å¯¹<a href="https://github.com/madordie/UITextView-More/blob/master/TruncateTextView.swift" target="_blank" rel="external">TruncateTextView</a>è¿›è¡Œè¿‡å¤šçš„è®¾ç½®ï¼Œä¸»è¦æ˜¯å› ä¸ºç»§æ‰¿åœ¨UITextViewä¸‹ï¼Œ<a href="https://github.com/madordie/UITextView-More/blob/master/Untitled.gif" target="_blank" rel="external">GIF</a>ä¸­çš„è¿™éƒ¨åˆ†è®¾ç½®æ”¾åœ¨äº†<a href="https://github.com/madordie/UITextView-More/blob/master/Demo-AppStore-More/ViewController.swift" target="_blank" rel="external">ViewController.swift</a>ä¸­</li>
<li>æ­¤å¤„ä½¿ç”¨çš„æ˜¯<code>frame</code>ï¼Œå¯ä»¥åœ¨<code>UIView.sizeToFit()</code>ä¹‹åè·å–åˆ°<code>UIView</code>çš„<code>Size</code>ã€‚çº¦æŸä¹Ÿå¤§æŠµå¦‚æ­¤</li>
</ul>
<hr>
<ul>
<li>æ„Ÿè°¢<a href="https://github.com/lexiaoyao20" target="_blank" rel="external">ä¹é€é¥</a>æä¾›çš„ä¾‹å­ï¼Œæ‰æ‰¾åˆ°äº†<code>open func truncatedGlyphRange(inLineFragmentForGlyphAt glyphIndex: Int) -&gt; NSRange</code>æ–¹æ³•ğŸ˜‚</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;UITextView-More&quot;&gt;&lt;a href=&quot;#UITextView-More&quot; class=&quot;headerlink&quot; title=&quot;UITextView-More&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://github.com/madordie/UITextView-More&quot;&gt;UITextView-More&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;ä½¿ç”¨UITextKit å®ç°â€œæ›´å¤šâ€çš„æŠ˜å æ•ˆæœ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/madordie/UITextView-More/blob/master/Untitled.gif?raw=true&quot; alt=&quot;é¢„è§ˆ&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="æ•ˆæœ" scheme="https://madordie.github.io/tags/%E6%95%88%E6%9E%9C/"/>
    
  </entry>
  
  <entry>
    <title>iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º</title>
    <link href="https://madordie.github.io/post/ios-automation-jenkins-configuration/"/>
    <id>https://madordie.github.io/post/ios-automation-jenkins-configuration/</id>
    <published>2017-09-10T01:49:32.000Z</published>
    <updated>2017-10-09T04:56:16.540Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><ul>
<li><a href="../ios-automation-jenkins-configuration">iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º</a></li>
<li><a href="../ios-automation-jenkins-build">iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹</a></li>
</ul>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><blockquote>
<p> <strong>Jenkins</strong><br><em>Build great things at any scale</em><br>The leading open source automation server, Jenkins provides hundreds of plugins to support building, deploying and automating any project.</p>
</blockquote>
<p>å¦‚<a href="https://jenkins.io" target="_blank" rel="external">å®˜ç½‘</a>æ‰€è¯´<code>Build great things at any scale</code></p>
<p>ä»è¿™ç¯‡æ–‡ç« ä¸­ä½ å°†ä¼šå®ç°ï¼š</p>
<ul>
<li>åœ¨Macä¸Šå¤šç§æ–¹æ¡ˆå®‰è£…å¹¶å¯åŠ¨jenkins</li>
<li>åœ¨å±€åŸŸç½‘ä¸­æ­£å¸¸è®¿é—®jenkins</li>
</ul>
<a id="more"></a>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å½“ç„¶ä½ é¦–å…ˆéœ€è¦ä¸€ä¸ªmacOSçš„ç³»ç»Ÿï¼Œä¸ºåæ¥çš„æ„å»ºåšåŸºç¡€ã€‚</p>
<p>Jenkinsä¸­å¯ä»¥ä½¿ç”¨<code>pkg</code>ã€<code>war</code>çš„æ–¹å¼è¿è¡Œï¼Œå½“ç„¶è¿˜æœ‰åœ¨<a href="https://jenkins.io/doc/book/getting-started/installing/" target="_blank" rel="external">Installing Jenkins</a>ä¸­æä¾›ä¸€äº›å®‰è£…æ–¹å¼ï¼š</p>
<blockquote>
<p> <strong>macOS</strong><br>To install from the website, using a package:</p>
<ul>
<li>Download the latest package</li>
<li>Open the package and follow the instructions</li>
</ul>
<p>Jenkins can also be installed using brew:</p>
<ul>
<li><p>Install the latest release version</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install jenkins</div></pre></td></tr></table></figure>
</li>
<li><p>Install the LTS version</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install jenkins-lts</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p>è¿™é‡Œä½¿ç”¨<code>brew</code>ï¼Œå› ä¸º<strong>å¾ˆæ–¹ä¾¿</strong>ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># å®‰è£…</span></div><div class="line">$ brew update &amp;&amp; brew install jenkins</div><div class="line"></div><div class="line"><span class="comment"># æ›´æ–°</span></div><div class="line">$ brew update &amp; brew upgrade jenkins</div><div class="line"></div><div class="line"><span class="comment"># åå°è¿è¡Œ è¿˜æ”¯æŒ`stop`ã€`restart`ç­‰ (è¿™ç§æ–¹å¼è¿˜æ˜¯æœ‰å·®åˆ«çš„ï¼Œä¸‹é¢ä¼šè¯´æ˜)</span></div><div class="line">$ brew services start jenkins</div></pre></td></tr></table></figure></p>
<h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><p>å»ºè®®å…ˆæ¥çœ‹ä¸€æ³¢<code>--help</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ jenkins --help</div></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯å¸¸ç”¨çš„å‡ ç§æ–¹æ¡ˆï¼Œæ­¤å¤„å¦‚æœç¬¬ä¸€æ¬¡å®‰è£…ï¼Œå»ºè®®é‡‡ç”¨<code>æ–¹æ¡ˆä¸€</code>æˆ–è€…<code>æ–¹æ¡ˆäºŒ</code>ï¼Œæš‚æ—¶ä¸å»ºè®®æ–°æ‰‹ä½¿ç”¨åå°è¿è¡Œçš„æ–¹æ¡ˆï½ï½ï¼ˆä¼šåœ¨æ‰“åŒ…çš„æ—¶å€™å‡ºç°è¯ä¹¦çš„é—®é¢˜ï¼‰</p>
<h3 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h3><p>ç›´æ¥è¿è¡Œ<code>jenkins</code>å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—è¾“å‡ºï¼Œä½†æ˜¯ä¸èƒ½é€€å‡ºå‘½ä»¤ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ jenkins</div></pre></td></tr></table></figure>
<p>ç»è¿‡æ¼«é•¿çš„åˆå§‹åŒ–ï¼Œä¼šå°†</p>
<ul>
<li><code>~/.jenkins</code>ç›®å½•ä½œä¸º<code>JENKINS_HOME</code></li>
<li><code>localhost:8080</code>ä½œä¸ºé»˜è®¤URL</li>
</ul>
<p>ç»ˆç«¯è¾“å‡º<code>Started initialization</code>ä¸€è¡Œä¹‹åå°±å¯ä»¥æ­£å¸¸æ‰“å¼€äº†ã€‚</p>
<p>åœ¨æµè§ˆå™¨æ‰“å¼€<a href="http://10.12.12.10:8080" target="_blank" rel="external">http://10.12.12.10:8080</a>å°±å¯ä»¥æ­£å¸¸åŠ è½½å•¦ï½</p>
<p>é€€å‡ºè¿è¡Œï¼š<code>control + C</code> ç»„åˆé”®ã€‚</p>
<h3 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h3><p>ç›´æ¥<code>open</code>ï¼Œçœ‹ä¸åˆ°æ—¥å¿—è¾“å‡ºï¼Œæ‰€å¯¹åº”çš„è¿è¡Œç¯å¢ƒå’Œæ–¹æ¡ˆä¸€ç›¸åŒã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ open /usr/<span class="built_in">local</span>/opt/jenkins/libexec/jenkins.war</div></pre></td></tr></table></figure>
<p>å‘½ä»¤ç»“æŸï¼Œç¨ç­‰ç‰‡åˆ»(åˆå§‹åŒ–ç›¸å…³ç›®å½•ã€ç¯å¢ƒ)ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€<a href="http://10.12.12.10:8080" target="_blank" rel="external">http://10.12.12.10:8080</a>å°±å¯ä»¥æ­£å¸¸åŠ è½½å•¦ï½</p>
<h3 id="æ–¹æ¡ˆä¸‰"><a href="#æ–¹æ¡ˆä¸‰" class="headerlink" title="æ–¹æ¡ˆä¸‰"></a>æ–¹æ¡ˆä¸‰</h3><p>ä½¿ç”¨<code>brew</code>ç›´æ¥æŒ‚åœ¨åå°ä½œä¸ºæœåŠ¡è¿è¡Œèµ·æ¥</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo brew services start jenkins</div></pre></td></tr></table></figure>
<p><code>brew</code>è¿˜æä¾›å…¶ä»–çš„å‚æ•°ï¼Œæ¯”å¦‚è¯´<code>restart</code>ã€<code>list</code>ã€<code>stop</code> ç­‰ç­‰ã€‚</p>
<p>æ­¤æ–¹æ¡ˆå’Œä¸Šé¢çš„è¿è¡Œç¯å¢ƒæ˜¯ä¸ä¸€æ ·çš„ï¼Œä¼šæœ‰äº›æƒé™çš„å·®åˆ«ã€‚</p>
<h3 id="å…¶ä»–æ–¹æ¡ˆ"><a href="#å…¶ä»–æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–æ–¹æ¡ˆ"></a>å…¶ä»–æ–¹æ¡ˆ</h3><p>ä½¿ç”¨<code>launchctl</code>ã€<code>nohup</code> ç­‰å…¶ä»–æ–¹æ¡ˆè¿›è¡Œçš„åå°è¿è¡Œï¼ŒåŒæ–¹æ¡ˆä¸‰å·®ä¸å¤šã€‚</p>
<p>éœ€è¦è¯´çš„æ˜¯<code>launchctl</code>æ˜¯macOSä¸‹ç³»ç»Ÿæä¾›çš„åå°è¿è¡Œæ–¹æ¡ˆï¼Œ<code>brew</code>ç­‰ï¼Œå‡æ¥è‡ªäºæ­¤ã€‚</p>
<p>åœ¨<code>launchctl</code>åå°ä¸­éœ€è¦ä¸€ä¸ª<code>plist</code>ï¼Œä½†æ˜¯<code>brew</code>å·²ç»åšå¥½äº†ï¼Œæ”¾ç½®åœ¨<code>~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist</code>ã€‚éœ€è¦è¯´çš„æ˜¯<code>launchctl</code>æ˜¯macOSä¸‹ç³»ç»Ÿæä¾›çš„åå°è¿è¡Œæ–¹æ¡ˆï¼Œ<code>brew</code>ç­‰ï¼Œå‡æ¥è‡ªäºæ­¤ï¼Œå…·ä½“çš„é…ç½®å‚æ•°éƒ½å’Œ<code>launchctl</code>ä¸€æ ·çš„ï¼Œæœç´¢ä¸€ä¸‹å¾ˆå¤šã€‚<code>brew</code>ä¸ºæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ä¸€ä¸ªï¼Œç›´æ¥ä½¿ç”¨<code>æ–¹æ¡ˆä¸‰</code>å°±è¡Œã€‚</p>
<p>å…·ä½“æ“ä½œå¯ä»¥Googleä¸€ä¸‹ï¼Œå¾ˆå¤šçš„ï½</p>
<h2 id="å®‰è£…å®Œæˆåçš„é…ç½®"><a href="#å®‰è£…å®Œæˆåçš„é…ç½®" class="headerlink" title="å®‰è£…å®Œæˆåçš„é…ç½®"></a>å®‰è£…å®Œæˆåçš„é…ç½®</h2><p>åœ¨Jenkinsåˆå§‹åŒ–å®Œæ¯•ä¸ºäº†éªŒè¯ç®¡ç†å‘˜èº«ä»½ï¼Œéœ€è¦å°†Jenkinsæœºå™¨ä¸Šçš„ä¸€ä¸ªå­—ç¬¦ä¸²è¾“å…¥åˆ°<a href="http://10.12.12.10:8080" target="_blank" rel="external">http://10.12.12.10:8080</a>ä¸­è¿›è¡ŒéªŒè¯ï¼Œå…·ä½“æ–‡ä»¶ç›®å½•åœ¨è¾“å…¥çš„ç•Œé¢å°±èƒ½çœ‹åˆ°ï¼Œä¸è¦å¤§æƒŠå°æ€ªã€‚</p>
<p>ä¹‹åå¼€å§‹é€‰æ‹©å®‰è£…æ’ä»¶ã€‚è¿™é‡Œå¯ä»¥é€‰æ‹©æ¨èçš„ï½ï½ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å‹¾é€‰ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œç›´æ¥é€‰æ‹©æ¨èçš„æ–¹æ¡ˆè¿›è¡Œå®‰è£…ã€‚</p>
<p>ç»è¿‡æ¼«é•¿çš„ç­‰å¾…ï¼Œç»ˆäºå°†æ’ä»¶å®‰è£…å®Œæ¯•ï¼Œå¹¶å¯åŠ¨äº†èµ·æ¥ï½ï½</p>
<p>Jenkinsæƒé™ï¼Œå—¯ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œå¯ä»¥å»<code>ç³»ç»Ÿç®¡ç† -&gt; Configure Global Security</code>  ä¸­è¿›è¡Œè®¾ç½®ã€‚</p>
<p>æ¥ä¸‹æ¥å¼€å§‹å»é…ç½®å·¥ç¨‹å§ï¼ä¼ é€é—¨ï¼š<a href="../ios-automation-jenkins-build">iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹</a></p>
<h2 id="å¯èƒ½ä¼šç¢°åˆ°çš„é”™è¯¯"><a href="#å¯èƒ½ä¼šç¢°åˆ°çš„é”™è¯¯" class="headerlink" title="å¯èƒ½ä¼šç¢°åˆ°çš„é”™è¯¯"></a>å¯èƒ½ä¼šç¢°åˆ°çš„é”™è¯¯</h2><h3 id="Error-Permission-denied"><a href="#Error-Permission-denied" class="headerlink" title="Error: Permission denied - *"></a>Error: Permission denied - <em>*</em></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ brew services start jenkins</div><div class="line">Error: Permission denied - ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist</div></pre></td></tr></table></figure>
<p>è¿™ç§å¾ˆæ˜æ˜¾<code>Permission denied</code>ï¼Œåœ¨å‘½ä»¤è¡Œå‰æ·»åŠ <code>sudo</code>ï¼Œç„¶åè¾“å…¥å¯†ç å³å¯ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo brew services start jenkins</div></pre></td></tr></table></figure>
<h3 id="æ–¹æ¡ˆäºŒåçš„åœ°å€å“ªé‡Œæ¥çš„ï¼Ÿ"><a href="#æ–¹æ¡ˆäºŒåçš„åœ°å€å“ªé‡Œæ¥çš„ï¼Ÿ" class="headerlink" title="æ–¹æ¡ˆäºŒåçš„åœ°å€å“ªé‡Œæ¥çš„ï¼Ÿ"></a><code>æ–¹æ¡ˆäºŒ</code>åçš„åœ°å€å“ªé‡Œæ¥çš„ï¼Ÿ</h3><p>è¿™é‡Œæ¨èçš„å®‰è£…æ–¹æ¡ˆæ˜¯<code>brew install jenkins</code></p>
<p>é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ‰¾åˆ°<code>brew</code>å®‰è£…çš„ä½ç½®</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ brew services list</div><div class="line">Name       Status  User Plist</div><div class="line">beanstalkd stopped</div><div class="line">influxdb   stopped</div><div class="line">jenkins    started keith  ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist</div><div class="line">nginx      stopped</div><div class="line">sonarqube  stopped</div><div class="line">FDDdeiMac:~ FDD$ cat ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist</div><div class="line">...</div><div class="line">&lt;string&gt;/usr/<span class="built_in">local</span>/opt/jenkins/libexec/jenkins.war&lt;/string&gt;</div><div class="line">...</div></pre></td></tr></table></figure>
<h3 id="ç»™Jenkinsç»‘å®šä¸€ä¸ªIP"><a href="#ç»™Jenkinsç»‘å®šä¸€ä¸ªIP" class="headerlink" title="ç»™Jenkinsç»‘å®šä¸€ä¸ªIP"></a>ç»™Jenkinsç»‘å®šä¸€ä¸ªIP</h3><p>è®²é“ç†è¿™ä¸ªä¸åº”è¯¥åœ¨è¿™é‡ŒèŠçš„ğŸ˜‚ï¼Œä¸è¿‡è¿˜æ˜¯è¯´ä¸€ä¸‹å§ã€‚ã€‚</p>
<p>ä¸€èˆ¬å±€åŸŸç½‘ä¸­éƒ½æ˜¯ç›´æ¥è‡ªåŠ¨è·å–IPä¿¡æ¯çš„ä¹Ÿå°±æ˜¯DHCPï¼Œä½†æ˜¯Jenkinsæ€»æ”¹IPä¹Ÿä¸å¥½ã€‚ã€‚äºæ˜¯ç»‘å®šä¸€ä¸‹å§ã€‚</p>
<p>åœ¨mac ä¸­ <code>ç³»ç»Ÿåå¥½è®¾ç½® -&gt; ç½‘ç»œ</code> è®°å½•ä¸‹æ¥å½“å‰è·å–åˆ°çš„IPã€‚</p>
<p>åœ¨<code>é«˜çº§</code>ä¸­å°†<code>ä½¿ç”¨DHCP</code>ä¿®æ”¹ä¸º<code>ä½¿ç”¨DHCP(æ‰‹åŠ¨è®¾å®šåœ°å€)</code>ï¼Œç„¶åå°†ä¸Šé¢çš„åœ°å€å¡«è¿›å»å°±å¥½å•¦ï½</p>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–çš„åœ°å€ï¼Œåªè¦åˆ«äººæ²¡æœ‰å ç”¨ğŸ˜‚ï¼Œä½ å¼€å¿ƒå°±å¥½ï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../ios-automation-jenkins-configuration&quot;&gt;iOSè‡ªåŠ¨åŒ–-Jenkinsç¯å¢ƒæ­å»º&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../ios-automation-jenkins-build&quot;&gt;iOSè‡ªåŠ¨åŒ–-Jenkinsç¼–è¯‘å·¥ç¨‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt; &lt;strong&gt;Jenkins&lt;/strong&gt;&lt;br&gt;&lt;em&gt;Build great things at any scale&lt;/em&gt;&lt;br&gt;The leading open source automation server, Jenkins provides hundreds of plugins to support building, deploying and automating any project.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚&lt;a href=&quot;https://jenkins.io&quot;&gt;å®˜ç½‘&lt;/a&gt;æ‰€è¯´&lt;code&gt;Build great things at any scale&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä»è¿™ç¯‡æ–‡ç« ä¸­ä½ å°†ä¼šå®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨Macä¸Šå¤šç§æ–¹æ¡ˆå®‰è£…å¹¶å¯åŠ¨jenkins&lt;/li&gt;
&lt;li&gt;åœ¨å±€åŸŸç½‘ä¸­æ­£å¸¸è®¿é—®jenkins&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="æ„å»º" scheme="https://madordie.github.io/tags/%E6%9E%84%E5%BB%BA/"/>
    
      <category term="Jenkins" scheme="https://madordie.github.io/tags/Jenkins/"/>
    
  </entry>
  
  <entry>
    <title>iOSé€†å‘-monkeydevå·¥å…·</title>
    <link href="https://madordie.github.io/post/reverse-ios-monkeydev/"/>
    <id>https://madordie.github.io/post/reverse-ios-monkeydev/</id>
    <published>2017-08-14T03:05:57.000Z</published>
    <updated>2018-01-02T10:39:33.212Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>MonkeyDev wiki<br>è¿™æ˜¯ä¸€ä¸ªä¸ºè¶Šç‹±å’Œéè¶Šç‹±å¼€å‘äººå‘˜å‡†å¤‡çš„å·¥å…·ï¼Œä¸»è¦åŒ…æ‹¬å››ä¸ªæ¨¡å—:</p>
<p> Logos Tweak</p>
<p>ä½¿ç”¨theosæä¾›çš„logify.plå·¥å…·å°†<em>.xmæ–‡ä»¶è½¬æˆ</em>.mmæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œé›†æˆäº†CydiaSubstrateï¼Œå¯ä»¥ä½¿ç”¨MSHookMessageExå’ŒMSHookFunctionæ¥Hook OCå‡½æ•°å’ŒæŒ‡å®šåœ°å€ã€‚</p>
<p>CaptainHook Tweak</p>
<p>ä½¿ç”¨CaptainHookæä¾›çš„å¤´æ–‡ä»¶è¿›è¡ŒOC å‡½æ•°çš„Hookï¼Œä»¥åŠå±æ€§çš„è·å–ã€‚</p>
<p>Command-line Tool</p>
<p>å¯ä»¥ç›´æ¥åˆ›å»ºè¿è¡Œäºè¶Šç‹±è®¾å¤‡çš„å‘½ä»¤è¡Œå·¥å…·</p>
<p>MonkeyApp</p>
<p>è¿™æ˜¯è‡ªåŠ¨ç»™ç¬¬ä¸‰æ–¹åº”ç”¨é›†æˆRevealã€Cycriptå’Œæ³¨å…¥dylibçš„æ¨¡å—ï¼Œæ”¯æŒè°ƒè¯•dylibå’Œç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæ”¯æŒPodç»™ç¬¬ä¸‰æ”¾åº”ç”¨é›†æˆSDKï¼Œåªéœ€è¦å‡†å¤‡ä¸€ä¸ªç ¸å£³åçš„ipaæˆ–è€…appæ–‡ä»¶å³å¯ã€‚</p>
</blockquote>
<a id="more"></a>
<hr>
<ul>
<li><a href="https://github.com/AloneMonkey/MonkeyDev/wiki" target="_blank" rel="external">MonkeyDev wiki</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;MonkeyDev wiki&lt;br&gt;è¿™æ˜¯ä¸€ä¸ªä¸ºè¶Šç‹±å’Œéè¶Šç‹±å¼€å‘äººå‘˜å‡†å¤‡çš„å·¥å…·ï¼Œä¸»è¦åŒ…æ‹¬å››ä¸ªæ¨¡å—:&lt;/p&gt;
&lt;p&gt; Logos Tweak&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨theosæä¾›çš„logify.plå·¥å…·å°†&lt;em&gt;.xmæ–‡ä»¶è½¬æˆ&lt;/em&gt;.mmæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œé›†æˆäº†CydiaSubstrateï¼Œå¯ä»¥ä½¿ç”¨MSHookMessageExå’ŒMSHookFunctionæ¥Hook OCå‡½æ•°å’ŒæŒ‡å®šåœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;CaptainHook Tweak&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨CaptainHookæä¾›çš„å¤´æ–‡ä»¶è¿›è¡ŒOC å‡½æ•°çš„Hookï¼Œä»¥åŠå±æ€§çš„è·å–ã€‚&lt;/p&gt;
&lt;p&gt;Command-line Tool&lt;/p&gt;
&lt;p&gt;å¯ä»¥ç›´æ¥åˆ›å»ºè¿è¡Œäºè¶Šç‹±è®¾å¤‡çš„å‘½ä»¤è¡Œå·¥å…·&lt;/p&gt;
&lt;p&gt;MonkeyApp&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯è‡ªåŠ¨ç»™ç¬¬ä¸‰æ–¹åº”ç”¨é›†æˆRevealã€Cycriptå’Œæ³¨å…¥dylibçš„æ¨¡å—ï¼Œæ”¯æŒè°ƒè¯•dylibå’Œç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæ”¯æŒPodç»™ç¬¬ä¸‰æ”¾åº”ç”¨é›†æˆSDKï¼Œåªéœ€è¦å‡†å¤‡ä¸€ä¸ªç ¸å£³åçš„ipaæˆ–è€…appæ–‡ä»¶å³å¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="é€†å‘" scheme="https://madordie.github.io/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>iOSé€†å‘-class-dumpå·¥å…·</title>
    <link href="https://madordie.github.io/post/reverse-ios-class-dump/"/>
    <id>https://madordie.github.io/post/reverse-ios-class-dump/</id>
    <published>2017-08-10T04:40:27.000Z</published>
    <updated>2017-10-09T04:57:22.748Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="å®‰è£…class-dump"><a href="#å®‰è£…class-dump" class="headerlink" title="å®‰è£…class-dump"></a>å®‰è£…class-dump</h2><p>å»<a href="http://stevenygard.com/projects/class-dump/" target="_blank" rel="external">stevenygard.com</a>ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚</p>
<p>å°†åŒ…ä¸­çš„<code>class-dump</code>å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°<code>/opt/class-dump</code>ã€‚(æˆ‘çš„é€†å‘ç›¸å…³å·¥å…·å‡åœ¨è¿™ä¸‹é¢ğŸ˜‚ï¼‰</p>
<p>åœ¨<code>~/.base_profile</code>ä¸­æ·»åŠ <code>export PATH=/opt/class-dump:$PATH</code></p>
<p>è¿è¡Œ<code>source ~/.base_profile</code></p>
<p>æœ€åç¡®è®¤ä¸€ä¸‹å®‰è£…OK ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ class-dump --v</div><div class="line">class-dump 3.5 (64 bit) compiled Nov 16 2013 12:22:33</div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><p>ä½¿ç”¨ä¸€ä¸ªè®°å½•ä¸€ä¸ªå§ï½</p>
<h3 id="ç”¨æ¥å¯¼å‡ºipa-decryptedå¤´æ–‡ä»¶"><a href="#ç”¨æ¥å¯¼å‡ºipa-decryptedå¤´æ–‡ä»¶" class="headerlink" title="ç”¨æ¥å¯¼å‡ºipa/.decryptedå¤´æ–‡ä»¶"></a>ç”¨æ¥å¯¼å‡º<code>ipa</code>/<code>.decrypted</code>å¤´æ–‡ä»¶</h3><p>æ­¤å¤„åªèƒ½å¯¼å‡ºæœªåŠ å¯†çš„<code>ipa</code>ï¼Œæˆ–è€…ç ¸è¿‡å£³çš„ã€‚<a href="../reverse-ios-dump-decrypted/">å…·ä½“ç ¸å£³è¿‡ç¨‹ä¼ é€é—¨</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ ls WeChat.decrypted</div><div class="line">WeChat.decrypted</div><div class="line">$ class-dump -H WeChat.decrypted -o ./Headers/</div><div class="line">$ ls Headers</div><div class="line">Headers</div></pre></td></tr></table></figure>
<p>å³å¾—å¤´æ–‡ä»¶ç›®å½•ï¼š<code>Headers</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å®‰è£…class-dump&quot;&gt;&lt;a href=&quot;#å®‰è£…class-dump&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…class-dump&quot;&gt;&lt;/a&gt;å®‰è£…class-dump&lt;/h2&gt;&lt;p&gt;å»&lt;a href=&quot;http://stevenygard.com/projects/class-dump/&quot;&gt;stevenygard.com&lt;/a&gt;ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;å°†åŒ…ä¸­çš„&lt;code&gt;class-dump&lt;/code&gt;å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°&lt;code&gt;/opt/class-dump&lt;/code&gt;ã€‚(æˆ‘çš„é€†å‘ç›¸å…³å·¥å…·å‡åœ¨è¿™ä¸‹é¢ğŸ˜‚ï¼‰&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;~/.base_profile&lt;/code&gt;ä¸­æ·»åŠ &lt;code&gt;export PATH=/opt/class-dump:$PATH&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œ&lt;code&gt;source ~/.base_profile&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æœ€åç¡®è®¤ä¸€ä¸‹å®‰è£…OK ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ class-dump --v&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;class-dump 3.5 (64 bit) compiled Nov 16 2013 12:22:33&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="é€†å‘" scheme="https://madordie.github.io/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>iOSé€†å‘-ç ¸å£³(cycript/clutch)</title>
    <link href="https://madordie.github.io/post/reverse-ios-dump-decrypted/"/>
    <id>https://madordie.github.io/post/reverse-ios-dump-decrypted/</id>
    <published>2017-08-09T12:31:50.000Z</published>
    <updated>2017-10-09T04:57:30.933Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><ul>
<li>è¶Šç‹±è®¾å¤‡</li>
</ul>
<p>ç›®å‰æœ‰ä¸¤ç§ç ¸å£³å·¥å…·ï¼Œå¹¶ä¸è‚©å¹¶è‚©ï¼Œä¸€ä¸ªä¸è¡Œå°±ç”¨å¦ä¸€ä¸ªå‘—ï¼Œä¿©éƒ½ä¸è¡Œå°±Googleå§ï½ï½</p>
<p>ä¸‹é¢åˆ†åˆ«å¯¹<code>cycript</code>ã€<code>clutch</code>è¿›è¡Œç ¸å£³:</p>
<a id="more"></a>
<h1 id="ä½¿ç”¨cycriptè¿›è¡Œç ¸å£³"><a href="#ä½¿ç”¨cycriptè¿›è¡Œç ¸å£³" class="headerlink" title="ä½¿ç”¨cycriptè¿›è¡Œç ¸å£³"></a>ä½¿ç”¨cycriptè¿›è¡Œç ¸å£³</h1><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><ul>
<li><code>Cydia</code>ä¸­æœç´¢<code>cycript</code>å¹¶å®‰è£… </li>
</ul>
<h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><h3 id="åˆ¶ä½œå¹¶ä¸Šä¼ dumpdecrypted-dylib-ï¼ˆå·²ç»OKçš„å¯å¿½ç•¥"><a href="#åˆ¶ä½œå¹¶ä¸Šä¼ dumpdecrypted-dylib-ï¼ˆå·²ç»OKçš„å¯å¿½ç•¥" class="headerlink" title="åˆ¶ä½œå¹¶ä¸Šä¼ dumpdecrypted.dylib ï¼ˆå·²ç»OKçš„å¯å¿½ç•¥"></a>åˆ¶ä½œå¹¶ä¸Šä¼ <code>dumpdecrypted.dylib</code> ï¼ˆå·²ç»OKçš„å¯å¿½ç•¥</h3><h4 id="åˆ¶ä½œ"><a href="#åˆ¶ä½œ" class="headerlink" title="åˆ¶ä½œ"></a>åˆ¶ä½œ</h4><p>ç›®å‰æˆ‘åˆ¶ä½œç›®å½•æš‚æ—¶åœ¨<code>~/Desktop</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git clone https://github.com/stefanesser/dumpdecrypted.git ~/Desktop</div><div class="line">$ cd ï½ï¼Desktop/dumpdecrypted</div><div class="line">$ make</div><div class="line">$ ls dumpdecrypted.dylib</div></pre></td></tr></table></figure>
<p>æ²¡ä»€ä¹ˆé”™è¯¯çš„è¯ï¼Œå³å¾—<code>dumpdecrypted.dylib</code>ã€‚</p>
<h4 id="ä¸Šä¼ "><a href="#ä¸Šä¼ " class="headerlink" title="ä¸Šä¼ "></a>ä¸Šä¼ </h4><p>å°†<code>dumpdecrypted.dylib</code>æ”¾åœ¨è¶Šç‹±è®¾å¤‡çš„<code>/var/root/</code>ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ ls dumpdecrypted.dylib</div><div class="line">$ scp dumpdecrypted.dylib root@10.12.14.16:/var/root/</div><div class="line">root@10.12.14.16&apos;s password:</div><div class="line">dumpdecrypted.dylib                           100%  193KB   3.0MB/s   00:00</div><div class="line">$</div></pre></td></tr></table></figure>
<h3 id="ç™»å½•è¿›è¶Šç‹±è®¾å¤‡"><a href="#ç™»å½•è¿›è¶Šç‹±è®¾å¤‡" class="headerlink" title="ç™»å½•è¿›è¶Šç‹±è®¾å¤‡"></a>ç™»å½•è¿›è¶Šç‹±è®¾å¤‡</h3><p>å¯ä»¥ä½¿ç”¨<code>ssh root@IP</code>è¿›è¡Œç™»å½•ã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨<code>ssh ipad</code>ï¼Œè¿™æ ·å…å¯†ç™»å½•ç™»å½•ã€‚ <a href="../reverse-ios-ssh/">é…ç½®ä¼ é€é—¨</a></p>
<h3 id="æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„"><a href="#æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„" class="headerlink" title="æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„"></a>æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„</h3><p>è¿™é‡Œä»¥<code>WeChat</code>ä¸ºä¾‹å­å•¦ï½</p>
<p>è®°å¾—å…ˆæ‰“å¼€å‘€ï½ï½ï½</p>
<p><code>ps -e</code>ï¼š æ˜¾ç¤ºæ‰€æœ‰ç¨‹åº<br><code>grep</code>: è¿™é‡Œæ˜¯è¿‡æ»¤ä¸€ä¸‹ã€‚ã€‚å…·ä½“ç”¨æ³•Googleã€‚æ‰€æœ‰çš„ç¨‹åºæœ‰ç‚¹å¤šï¼Œæˆ‘çŸ¥é“åå­—ï¼Œæ‰€ä»¥ç›´æ¥è¿‡æ»¤ä¸€ä¸‹ã€‚ä¹Ÿå¯å¿½ç•¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ ps -e | grep WeChat</div><div class="line">705 ??         0:02.20 /var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat</div><div class="line">707 ttys000    0:00.01 grep WeChat</div><div class="line">$ cycript -p 705</div><div class="line">$ cycript -p 705</div><div class="line">cy# [[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask][0]</div><div class="line">#&quot;file:///var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/&quot;</div><div class="line">cy# exit(0)</div><div class="line">MS:Error: _krncall(mach_vm_read_overwrite(task, data, sizeof(*baton), reinterpret_cast&lt;mach_vm_address_t&gt;(baton), &amp;error)) =4</div><div class="line">*** _assert(status == 0):../Inject.cpp(143):InjectLibrary</div><div class="line">$</div></pre></td></tr></table></figure>
<p>æ­¤å¤„è·å¾—ä¸¤ä¸ªç›®å½•ï¼š</p>
<ul>
<li><code>/var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat</code></li>
<li><code>/var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/</code></li>
</ul>
<h3 id="å¼€ç ¸"><a href="#å¼€ç ¸" class="headerlink" title="å¼€ç ¸"></a>å¼€ç ¸</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">$ cd ~</div><div class="line">$ cp dumpdecrypted.dylib /var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/</div><div class="line">$ cd /var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/</div><div class="line">$ DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat</div><div class="line">mach-o decryption dumper</div><div class="line"></div><div class="line">DISCLAIMER: This tool is only meant for security research purposes, not for application crackers.</div><div class="line"></div><div class="line">[+] detected 64bit ARM binary in memory.</div><div class="line">[+] offset to cryptid found: @0x1000c0ca8(from 0x1000c0000) = ca8</div><div class="line">[+] Found encrypted data at address 00004000 of length 51200000 bytes - type 1.</div><div class="line">[+] Opening /private/var/mobile/Containers/Bundle/Application/3AE519BF-2FD2-43FC-A14B-2893190B8E1E/WeChat.app/WeChat for reading.</div><div class="line">[+] Reading header</div><div class="line">[+] Detecting header type</div><div class="line">[+] Executable is a plain MACH-O image</div><div class="line">[+] Opening WeChat.decrypted for writing.</div><div class="line">[+] Copying the not encrypted start of the file</div><div class="line">[+] Dumping the decrypted data into the file</div><div class="line">[+] Copying the not encrypted remainder of the file</div><div class="line">[+] Setting the LC_ENCRYPTION_INFO-&gt;cryptid to 0 at offset ca8</div><div class="line">[+] Closing original file</div><div class="line">[+] Closing dump file</div><div class="line">$ ls WeChat.decrypted</div><div class="line">WeChat.decrypted</div><div class="line">$ pwd</div><div class="line">/var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents</div></pre></td></tr></table></figure>
<p>æœ€åå¾—åˆ°æ–‡ä»¶:</p>
<ul>
<li><code>/var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/WeChat.decrypted</code></li>
</ul>
<h3 id="å°†-decryptedæ‹·è´å‡ºæ¥"><a href="#å°†-decryptedæ‹·è´å‡ºæ¥" class="headerlink" title="å°†*.decryptedæ‹·è´å‡ºæ¥"></a>å°†<code>*.decrypted</code>æ‹·è´å‡ºæ¥</h3><p>æˆ‘è¿™é‡Œç›´æ¥ä½¿ç”¨<code>scp</code>å§ï½ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ cd /Users/Madordie/Desktop/Madordie/iOS/xxx</div><div class="line">$ scp root@10.12.14.16:/var/mobile/Containers/Data/Application/54EF9A70-8E3A-4B6D-B7F4-554AB256C48B/Documents/WeChat.decrypted .</div><div class="line">root@10.12.14.16&apos;s password:</div><div class="line">WeChat.decrypted                              100%   61MB   4.7MB/s   00:12</div><div class="line">$ ls WeChat.decrypted</div><div class="line">WeChat.decrypted</div></pre></td></tr></table></figure>
<p>è‡³æ­¤åœ¨ä¸»æœºä¸Šå¾—åˆ°ï¼š</p>
<ul>
<li><code>/Users/Madordie/Desktop/Madordie/iOS/xxx/WeChat.decrypted</code></li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>ä¸ºä»€ä¹ˆå°†<code>dumpdecrypted.dylib</code>  <code>copy</code> è‡³<code>*/Documents/</code>ä¸‹ï¼Ÿ<br>  ï¼šåˆ«çš„ç›®å½•æ²¡æœ‰æƒé™ï½ï½ï¼ˆ<code>dumpdecrypted.dylib: stat() failed with errno=1</code> ï¼‰</li>
</ul>
<h1 id="ä½¿ç”¨clutchè¿›è¡Œç ¸å£³"><a href="#ä½¿ç”¨clutchè¿›è¡Œç ¸å£³" class="headerlink" title="ä½¿ç”¨clutchè¿›è¡Œç ¸å£³"></a>ä½¿ç”¨clutchè¿›è¡Œç ¸å£³</h1><h2 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><h3 id="ä¸‹è½½ä¸Šä¼ clutch-æ— é¡»é‡å¤åš"><a href="#ä¸‹è½½ä¸Šä¼ clutch-æ— é¡»é‡å¤åš" class="headerlink" title="ä¸‹è½½ä¸Šä¼ clutch(æ— é¡»é‡å¤åš)"></a>ä¸‹è½½ä¸Šä¼ clutch(æ— é¡»é‡å¤åš)</h3><p><code>clutch</code>å¯ä»¥ä»<a href="https://github.com/KJCracks/Clutch" target="_blank" rel="external">https://github.com/KJCracks/Clutch</a>ä¸‹è½½ç¼–è¯‘ã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä»<a href="https://github.com/KJCracks/Clutch/releases" target="_blank" rel="external">https://github.com/KJCracks/Clutch/releases</a>ç›´æ¥ä¸‹è½½ã€‚</p>
<p>ç›®å‰ä¸‹è½½åˆ°ç›®å½•<code>~/Clutch-2.0.4</code></p>
<p>ä¸Šä¼ åˆ°è®¾å¤‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ cd ~</div><div class="line">$ scp Clutch-2.0.4 root@10.12.14.16:/usr/bin/</div><div class="line">root@10.12.14.16&apos;s password:</div><div class="line">Clutch-2.0.4                                  100% 1204KB   4.7MB/s   00:00</div></pre></td></tr></table></figure>
<h3 id="ç™»å½•è¿›è¶Šç‹±è®¾å¤‡-1"><a href="#ç™»å½•è¿›è¶Šç‹±è®¾å¤‡-1" class="headerlink" title="ç™»å½•è¿›è¶Šç‹±è®¾å¤‡"></a>ç™»å½•è¿›è¶Šç‹±è®¾å¤‡</h3><p>å¯ä»¥ä½¿ç”¨<code>ssh root@IP</code>è¿›è¡Œç™»å½•ã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨<code>ssh ipad</code>ï¼Œè¿™æ ·å…å¯†ç™»å½•ç™»å½•ã€‚ <a href="../reverse-ios-ssh/">é…ç½®ä¼ é€é—¨</a></p>
<h3 id="ä¿®æ”¹æƒé™"><a href="#ä¿®æ”¹æƒé™" class="headerlink" title="ä¿®æ”¹æƒé™"></a>ä¿®æ”¹æƒé™</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ cd ~</div><div class="line">$ cd /usr/bin</div><div class="line">$ mv Clutch-2.0.4 clutch</div><div class="line">$ chmod +x clutch</div></pre></td></tr></table></figure>
<h3 id="ç ¸å£³"><a href="#ç ¸å£³" class="headerlink" title="ç ¸å£³"></a>ç ¸å£³</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$ clutch -i</div><div class="line">Installed apps:</div><div class="line">1:   é’‰é’‰ &lt;com.laiwang.DingTalk&gt;</div><div class="line">2:   éŸ©å‰§TV-æœ€æ–°çƒ­é—¨éŸ©å‰§å¤§å…¨ &lt;com.baoyun.hanju&gt;</div><div class="line">3:   PG Client - a better client for dribbble &lt;com.az.azdribbble&gt;</div><div class="line">4:   çªç‰›ï¼è®¾è®¡è£…ä¿®æˆ‘ä»¬çš„å®¶ &lt;com.lingduohome.acorn&gt;</div><div class="line">$ clutch -d 1</div><div class="line">com.laiwang.DingTalk contains watchOS 2 compatible application. It&apos;s not possible to dump watchOS 2 apps with Clutch 2.0.4 at this moment.</div><div class="line">Zipping DingTalk.app</div><div class="line">ASLR slide: 0x10001c000</div><div class="line">Dumping &lt;DingTalk&gt; (arm64)</div><div class="line">Patched cryptid (64bit segment)</div><div class="line">Writing new checksum</div><div class="line">DONE: /private/var/mobile/Documents/Dumped/com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ipa</div><div class="line">Finished dumping com.laiwang.DingTalk in 40.6 seconds</div><div class="line">$</div></pre></td></tr></table></figure>
<p>ç”Ÿæˆæœ€ç»ˆè·¯å¾„:</p>
<ul>
<li><code>/private/var/mobile/Documents/Dumped/com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ipa</code></li>
</ul>
<h3 id="ä¼ è‡³æœ¬åœ°"><a href="#ä¼ è‡³æœ¬åœ°" class="headerlink" title="ä¼ è‡³æœ¬åœ°"></a>ä¼ è‡³æœ¬åœ°</h3><p>æ³¨æ„è·¯å¾„ä¸­æœ‰<code>()</code>è¿™æ ·çš„å­—ç¬¦ï¼Œéœ€è¦è½¬ä¹‰ä¸€ä¸‹ã€‚å¦‚ä¸‹ï¼š</p>
<p>åœ¨æœ¬åœ°ç»ˆç«¯ä¸­ä½¿ç”¨<code>scp</code>æ‹‰å–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ scp root@10.12.14.16:&apos;/private/var/mobile/Documents/Dumped/com.laiwang.DingTalk-iOS7.0-\(Clutch-2.0.4\).ipa&apos; .</div><div class="line">root@10.12.14.16&apos;s password:</div><div class="line">com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ip 100%   48MB   3.6MB/s   00:13</div><div class="line">$ ls com.laiwang.DingTalk-iOS7.0-\(Clutch-2.0.4\).ipa</div><div class="line">com.laiwang.DingTalk-iOS7.0-(Clutch-2.0.4).ipa</div><div class="line">$ pwd</div><div class="line">/Users/Madordie/Desktop/Madordie/ios-reverse</div></pre></td></tr></table></figure>
<p>è‡³æ­¤åœ¨ä¸»æœºä¸Šå¾—åˆ°ï¼š</p>
<ul>
<li><code>/Users/Madordie/Desktop/Madordie/ios-reverse/com.laiwang.DingTalk-iOS7.0-\(Clutch-2.0.4\).ipa</code></li>
</ul>
<h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ”¯æŒè¿™ç§å·¥å…·ç ¸å£³ï¼Œå¤±è´¥äº†ç”¨ç¬¬ä¸€ç§è¯•è¯•ã€‚ã€‚ã€‚</li>
</ul>
<h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>ç›®å‰å‘ç°è¿™ä¸¤ç§ç ¸å£³å·¥å…·ã€‚ä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªAPPéƒ½å¯ä»¥ä½¿ç”¨2ç§å·¥å…·ã€‚æœ‰çš„åªæœ‰ä¸€ä¸ªæœ‰æ•ˆï¼Œæœ‰çš„ä¸¤ä¸ªéƒ½æœ‰æ•ˆï¼Œè¿˜æœ‰ä¸€ç§ä¸¤ä¸ªéƒ½å¤±è´¥çš„ğŸ˜‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‡†å¤‡å·¥ä½œ&quot;&gt;&lt;a href=&quot;#å‡†å¤‡å·¥ä½œ&quot; class=&quot;headerlink&quot; title=&quot;å‡†å¤‡å·¥ä½œ&quot;&gt;&lt;/a&gt;å‡†å¤‡å·¥ä½œ&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;è¶Šç‹±è®¾å¤‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®å‰æœ‰ä¸¤ç§ç ¸å£³å·¥å…·ï¼Œå¹¶ä¸è‚©å¹¶è‚©ï¼Œä¸€ä¸ªä¸è¡Œå°±ç”¨å¦ä¸€ä¸ªå‘—ï¼Œä¿©éƒ½ä¸è¡Œå°±Googleå§ï½ï½&lt;/p&gt;
&lt;p&gt;ä¸‹é¢åˆ†åˆ«å¯¹&lt;code&gt;cycript&lt;/code&gt;ã€&lt;code&gt;clutch&lt;/code&gt;è¿›è¡Œç ¸å£³:&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="é€†å‘" scheme="https://madordie.github.io/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>iOSé€†å‘-è®¾å¤‡sshå…å¯†ç™»å½•</title>
    <link href="https://madordie.github.io/post/reverse-ios-ssh/"/>
    <id>https://madordie.github.io/post/reverse-ios-ssh/</id>
    <published>2017-08-09T07:31:30.000Z</published>
    <updated>2017-10-09T04:57:48.373Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h2><ul>
<li>å·²è¶Šç‹±è®¾å¤‡</li>
<li>è¶Šç‹±è®¾å¤‡å®‰è£…OpenSSH(âš ï¸è®°å¾—ä¿®æ”¹é»˜è®¤çš„â€™alpineâ€™ç™»å½•å¯†ç )</li>
<li>ç”µè„‘å’Œè®¾å¤‡åŒå±€åŸŸç½‘ã€‚ï¼ˆæˆ‘è¿™é‡Œè®¾å¤‡IPï¼š10.11.12.13ï¼Œå¹¶ä¸”è®¾ç½®æˆé™æ€IPäº†ğŸ˜‚ï¼‰</li>
</ul>
<a id="more"></a>
<h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><h3 id="ç”ŸæˆRSAè¯ä¹¦"><a href="#ç”ŸæˆRSAè¯ä¹¦" class="headerlink" title="ç”ŸæˆRSAè¯ä¹¦"></a>ç”ŸæˆRSAè¯ä¹¦</h3><p>æˆ‘è¿™é‡Œç”Ÿæˆçš„è¯ä¹¦ä¸º:<code>ipad</code>ï¼Œå¯è‡ªå·±éœ€è¦å®šä¹‰ã€‚ï¼ˆæ³¨æ„å¦‚æœç›´æ¥å›è½¦ä¼šè¦†ç›–<code>~/.ssh/id_rsa</code>ï¼‰</p>
<p>æ‰§è¡Œå‘½ä»¤<code>ssh-keygen</code>ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">$ cd ~/.ssh/</div><div class="line">$ ssh-keygen</div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file in which to save the key (/Users/Madordie/.ssh/id_rsa): ipad</div><div class="line">Enter passphrase (empty for no passphrase):</div><div class="line">Enter same passphrase again:</div><div class="line">Your identification has been saved in ipad.</div><div class="line">Your public key has been saved in ipad.pub.</div><div class="line">The key fingerprint is:</div><div class="line">SHA256:GpQBeAf+oqUzWlUhtItDcVyVFz2wd0EcIgD+BZLPK8U Madordie@Bingo.local</div><div class="line">The key&apos;s randomart image is:</div><div class="line">+---[RSA 2048]----+</div><div class="line">|  .+*+*++o++.o+. |</div><div class="line">|  .+o+o=...oo... |</div><div class="line">|  ..o.=+ .o ...  |</div><div class="line">| . . = .E. . .   |</div><div class="line">|  o = o.S.       |</div><div class="line">|   * ..o.        |</div><div class="line">|  *   ..         |</div><div class="line">| o o             |</div><div class="line">|.                |</div><div class="line">+----[SHA256]-----+</div><div class="line"></div><div class="line">$ ls ~/.ssh/ipad*</div><div class="line">/Users/Madordie/.ssh/ipad     /Users/Madordie/.ssh/ipad.pub</div></pre></td></tr></table></figure></p>
<h3 id="å°†å…¬é’¥æ¨é€è‡³è¶Šç‹±è®¾å¤‡"><a href="#å°†å…¬é’¥æ¨é€è‡³è¶Šç‹±è®¾å¤‡" class="headerlink" title="å°†å…¬é’¥æ¨é€è‡³è¶Šç‹±è®¾å¤‡"></a>å°†å…¬é’¥æ¨é€è‡³è¶Šç‹±è®¾å¤‡</h3><p>é»˜è®¤æ˜¯æ²¡æœ‰<code>~/.ssh</code>ç›®å½•çš„ï¼Œæš‚æ—¶æ”¾ç½®åœ¨<code>/var/root</code>ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ scp ~/.ssh/ipad.pub root@10.11.12.13:/var/root</div></pre></td></tr></table></figure>
<p><code>scp</code> é»˜è®¤ç«¯å£ä¸º<code>22</code> å¦‚æœéœ€è¦è‡ªå®šä¹‰ç«¯å£å¯ä»¥åœ¨è·¯å¾„å‰æ·»åŠ <code>-P ç«¯å£å·</code>å‚æ•°ã€‚</p>
<h3 id="é…ç½®æœ¬æœº-ssh-configæ–‡ä»¶"><a href="#é…ç½®æœ¬æœº-ssh-configæ–‡ä»¶" class="headerlink" title="é…ç½®æœ¬æœº~/.ssh/configæ–‡ä»¶"></a>é…ç½®æœ¬æœº<code>~/.ssh/config</code>æ–‡ä»¶</h3><p>ä½¿ç”¨é¡ºæ‰‹çš„å·¥å…·ç¼–è¾‘<code>~/.ssh/config</code>æ–‡ä»¶ã€‚ï¼ˆæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªå•¦ï½</p>
<p>æŒ‰ç…§å¦‚ä¸‹æ ¼å¼å¡«å†™ã€‚é»˜è®¤<code>ssh</code>ç™»å½•ç«¯å£ä¸º<code>22</code>å¯ä»¥ä¸å†™ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Host ipad</div><div class="line">    Hostname 10.11.12.13</div><div class="line">    User root</div><div class="line">    Port 22</div><div class="line">    PreferredAuthentications publickey</div><div class="line">    IdentityFile ~/.ssh/ipad</div></pre></td></tr></table></figure></p>
<h3 id="é…ç½®è¶Šç‹±è®¾å¤‡"><a href="#é…ç½®è¶Šç‹±è®¾å¤‡" class="headerlink" title="é…ç½®è¶Šç‹±è®¾å¤‡"></a>é…ç½®è¶Šç‹±è®¾å¤‡</h3><p>å…ˆç”¨<code>ssh root@10.11.12.13</code>ç™»å½•è¿›è®¾å¤‡ã€‚åˆšæ‰æˆ‘ä»¬å°†<code>ipad.pub</code>é€šè¿‡<code>scp</code>æ”¾åœ¨äº†<code>/var/root</code>ä¸‹ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹<code>/var/root/.ssh</code>æ˜¯ä¸å­˜åœ¨çš„ï¼Œä½¿ç”¨å‘½ä»¤<code>mkdir -p /var/root/.ssh</code>å³å¯åˆ›å»ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat ipad.pub &gt;&gt; /var/root/.ssh/authorized_keys</div></pre></td></tr></table></figure>
<p>ç„¶åå¼ºè¿«ç—‡çš„å¯ä»¥ä½¿ç”¨<code>rm -rf ipad.pub</code>åˆ é™¤å•¦ï½</p>
<p>å¯¹äº†ï¼Œé€€å‡º<code>ssh</code>ç™»å½•çš„è®¾å¤‡ä½¿ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ exit</div><div class="line">logout</div><div class="line">Connection to 10.11.12.13 closed.</div></pre></td></tr></table></figure>
<h3 id="èµ¶ç´§æµ‹è¯•ä¸€ä¸‹è¿œç¨‹ç™»å½•æ•ˆæœ"><a href="#èµ¶ç´§æµ‹è¯•ä¸€ä¸‹è¿œç¨‹ç™»å½•æ•ˆæœ" class="headerlink" title="èµ¶ç´§æµ‹è¯•ä¸€ä¸‹è¿œç¨‹ç™»å½•æ•ˆæœ"></a>èµ¶ç´§æµ‹è¯•ä¸€ä¸‹è¿œç¨‹ç™»å½•æ•ˆæœ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ssh ipad</div></pre></td></tr></table></figure>
<p>ç„¶åä½ ä¼šå‘ç°ä½ å·²ç»å®Œæˆäº†å…å¯†ç ç™»å½•è¶Šç‹±è®¾å¤‡ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å…¶å®è¿™å¹¶ä¸æ˜¯åªæœ‰è¶Šç‹±iOSè®¾å¤‡æ‰èƒ½ä½¿ç”¨çš„å…ç™»å½•ï¼Œè€Œæ˜¯<code>ssh</code>æ‰€æ”¯æŒçš„ã€‚ç”¨é€”ä¹Ÿå¾ˆæ–¹ä¾¿ï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰ææ¡ä»¶&quot;&gt;&lt;a href=&quot;#å‰ææ¡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;å‰ææ¡ä»¶&quot;&gt;&lt;/a&gt;å‰ææ¡ä»¶&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å·²è¶Šç‹±è®¾å¤‡&lt;/li&gt;
&lt;li&gt;è¶Šç‹±è®¾å¤‡å®‰è£…OpenSSH(âš ï¸è®°å¾—ä¿®æ”¹é»˜è®¤çš„â€™alpineâ€™ç™»å½•å¯†ç )&lt;/li&gt;
&lt;li&gt;ç”µè„‘å’Œè®¾å¤‡åŒå±€åŸŸç½‘ã€‚ï¼ˆæˆ‘è¿™é‡Œè®¾å¤‡IPï¼š10.11.12.13ï¼Œå¹¶ä¸”è®¾ç½®æˆé™æ€IPäº†ğŸ˜‚ï¼‰&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="é€†å‘" scheme="https://madordie.github.io/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªå®šä¹‰æ•°æ®å¡«å……Sketchæ’ä»¶</title>
    <link href="https://madordie.github.io/post/format-sketchplugin/"/>
    <id>https://madordie.github.io/post/format-sketchplugin/</id>
    <published>2017-07-17T06:45:12.000Z</published>
    <updated>2017-10-09T04:59:31.525Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="å…ˆæ¥ä¸ªREADME-md"><a href="#å…ˆæ¥ä¸ªREADME-md" class="headerlink" title="å…ˆæ¥ä¸ªREADME.md"></a>å…ˆæ¥ä¸ªREADME.md</h2><blockquote>
<h2 id="format-sketchplugin"><a href="#format-sketchplugin" class="headerlink" title="format-sketchplugin"></a><a href="https://github.com/madordie/format-sketchplugin" target="_blank" rel="external">format-sketchplugin</a></h2><p>ä¸ºSketchè‡ªåŠ¨ç”Ÿæˆè‡ªå®šä¹‰å¡«å……æ•°æ®æºæ’ä»¶ã€‚</p>
<p><img src="https://github.com/madordie/format-sketchplugin/blob/master/Images/Untitled.gif?raw=true" alt="é¢„è§ˆ"></p>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><ul>
<li>ä¸‹è½½<a href="https://github.com/madordie/format-sketchplugin/releases" target="_blank" rel="external">Release</a>ä¸Šçš„åŒ…ï¼Œå¹¶åŒå‡»æ‰“å¼€</li>
<li>é€‰æ‹©è¦éšæœºå¡«å……çš„æ–‡æœ¬æ•°æ®(æ”¯æŒå¤šé€‰ï¼Œæ–‡æœ¬æ•°æ®æŒ‰ç…§å›è½¦è¿›è¡Œéšæœºï¼Œä¼šé»˜è®¤åˆ é™¤ç©ºæ•°æ®)</li>
<li>é€‰æ‹©éšæœºå¡«å……çš„å›¾ç‰‡æ–‡ä»¶å¤¹(åªæ”¯æŒå•é€‰æ–‡ä»¶å¤¹ï¼Œé€‰ä¸­æ–‡ä»¶å¤¹å†…çš„<code>.png</code>ã€ <code>.PNG</code>ã€ <code>.jpg</code>ã€ <code>.JPG</code>ã€ <code>.jpeg</code>ã€ <code>.JPEG</code>ã€ <code>.gif</code>ã€ <code>.GIF</code>æ–‡ä»¶å°†ä¼šè¢«è¯†åˆ«å¹¶ä½œä¸ºæ•°æ®æº)</li>
<li>å°†æ’ä»¶ç”Ÿæˆç›®å½•æ‹–æ‹½è‡³çª—å£å³å®Œæˆè®¾ç½®</li>
<li>æ–‡æœ¬ã€å›¾ç‰‡æ–‡ä»¶å¤¹ å¯åœ¨ä¿å­˜å‰é‡å¤å¤šæ¬¡é€‰æ‹©</li>
<li>ç‚¹å‡»<code>åˆ¶ä½œ</code>ï¼Œå³å¯åœ¨ç”Ÿæˆç›®å½•çœ‹åˆ°æ’ä»¶ç”Ÿæˆ</li>
</ul>
<h2 id="ç”Ÿæˆè¯´æ˜"><a href="#ç”Ÿæˆè¯´æ˜" class="headerlink" title="ç”Ÿæˆè¯´æ˜"></a>ç”Ÿæˆè¯´æ˜</h2><ul>
<li>æ–‡æœ¬æ•°æ®æŒ‰ç…§æ–‡æœ¬æ–‡ä»¶åä½œä¸ºæ ‡ç¤º</li>
<li>å›¾ç‰‡æ–‡ä»¶å¤¹æŒ‰ç…§å›¾ç‰‡æ–‡ä»¶å¤¹åä½œä¸ºæ ‡ç¤º</li>
<li>ä¿å­˜æ—¶ï¼Œæ–‡æœ¬æ•°æ®ä¼šè¯»å–è‡³æ’ä»¶å†…</li>
<li>ä¿å­˜æ—¶ï¼Œå›¾ç‰‡æ–‡ä»¶å¤¹ä¼šå¤åˆ¶è‡³æ’ä»¶å†…(ä¸è¯†åˆ«å­ç›®å½•ï¼Œå¹¶åªæ‹·è´å¯è¯†åˆ«çš„ç´ æ)</li>
</ul>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css&quot;&gt;&lt;h2 id=&quot;å…ˆæ¥ä¸ªREADME-md&quot;&gt;&lt;a href=&quot;#å…ˆæ¥ä¸ªREADME
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://madordie.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Sketchplugin" scheme="https://madordie.github.io/tags/Sketchplugin/"/>
    
  </entry>
  
  <entry>
    <title>iOS11-beta</title>
    <link href="https://madordie.github.io/post/ios11-beta/"/>
    <id>https://madordie.github.io/post/ios11-beta/</id>
    <published>2017-06-12T09:20:58.000Z</published>
    <updated>2017-11-22T06:03:26.443Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>iOS11 é¢„è§ˆç‰ˆå®‰è£…ä½“éªŒç¬”è®°ã€‚</p>
<a id="more"></a>
<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æ¯•ç«Ÿbetaç‰ˆï¼Œå‡çº§éœ€è°¨æ…ã€‚ç›®å‰æ¥çœ‹ä½“éªŒä¸Šè¿˜æ˜¯æœ‰ç‚¹å¡çš„ï½ï½ğŸ˜‚</p>
<p>å¡é¡¿è®©æˆ‘å®åœ¨æ— æ³•å¿å—ï¼Œå¹¶ä¸6.15å·é‡ç½®å›iOS10.3.2 ã€‚ã€‚ã€‚</p>
<p>9.13 GMå‡ºæ¥äº†ï¼Œå†å®‰è£…ï½ï½</p>
<p>é€‚é…æœ‰å…ˆåï¼ŒiOS11é©¬ä¸Šå°±è¦å‘äº†ï¼Œè€ŒiPhoneXè¿˜éœ€è¦ç­‰ä¸€å°æ®µæ—¶é—´ã€‚æ‰€ä»¥iOS11çš„é€‚é…æ¯”iPhoneXæœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï½</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="å¤±æ•ˆçš„automaticallyAdjustsScrollViewInsets"><a href="#å¤±æ•ˆçš„automaticallyAdjustsScrollViewInsets" class="headerlink" title="å¤±æ•ˆçš„automaticallyAdjustsScrollViewInsets"></a><a name="automaticallyAdjustsScrollViewInsets">å¤±æ•ˆçš„<code>automaticallyAdjustsScrollViewInsets</code></a></h3><p>iOS11 ç‰ˆæœ¬ä¸­ <strong>ç«‹å³å¤±æ•ˆ</strong>ã€‚</p>
<p>æœ€å®¹æ˜“å‡ºé—®é¢˜çš„å°±æ˜¯æ— å¯¼èˆªçš„é¡¶éƒ¨åˆ·æ–°ä¼šè«åå…¶å¦™çš„ç¼©ä¸è¿›å»ï½ï½</p>
<p><img src="/images/ios11-beta-1.jpg" alt="æ•ˆæœå›¾"></p>
<p>è¿˜æœ‰å°±æ˜¯å¦‚æœæ²¡æœ‰ä½¿ç”¨è¿™ä¸ª<code>automaticallyAdjustsScrollViewInsets</code>ï¼Œä¸ºäº†è¾¾åˆ°é‚£ç§æˆ³è¿›å»çš„ä»£ç ç›´æ¥è®¾ç½®<code>frame.y = 0</code>ã€‚è¿™ç§æ“ä½œä¸ä½†ä¼šå‡ºç°å¯¼èˆªæ è«åå…¶å¦™çš„æˆ³å‡ºæ¥ï¼Œè¿˜æœ‰<code>UITableView.section.header</code>è«åé”™ä½çš„é—®é¢˜ã€‚</p>
<p><img src="/images/ios11-beta-2.gif" alt="æ•ˆæœå›¾"></p>
<p>API å£°æ˜ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@available</span>(iOS <span class="number">2.0</span>, *)</div><div class="line">open <span class="class"><span class="keyword">class</span> <span class="title">UIViewController</span> : <span class="title">UIResponder</span>, ... </span>&#123;</div><div class="line">	...</div><div class="line">	<span class="meta">@available</span>(iOS, introduced: <span class="number">7.0</span>, deprecated: <span class="number">11.0</span>)</div><div class="line">	open <span class="keyword">var</span> automaticallyAdjustsScrollViewInsets: <span class="type">Bool</span> <span class="comment">// Defaults to YES</span></div><div class="line">	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç›¸åº”çš„çš„æ›¿æ¢æ–¹æ¡ˆï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@available</span>(iOS <span class="number">2.0</span>, *)</div><div class="line">open <span class="class"><span class="keyword">class</span> <span class="title">UIScrollView</span> : <span class="title">UIView</span>, ... </span>&#123;</div><div class="line">	...</div><div class="line">    <span class="comment">/* Configure the behavior of adjustedContentInset.</span></div><div class="line">     Default is UIScrollViewContentInsetAdjustmentAutomatic.</div><div class="line">     */</div><div class="line">    <span class="meta">@available</span>(iOS <span class="number">11.0</span>, *)</div><div class="line">    open <span class="keyword">var</span> contentInsetAdjustmentBehavior: <span class="type">UIScrollViewContentInsetAdjustmentBehavior</span></div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="decisionHandler-allow-was-called-more-than-once"><a href="#decisionHandler-allow-was-called-more-than-once" class="headerlink" title="decisionHandler(.allow) was called more than once"></a><a name="decisionHandler"><code>decisionHandler(.allow)</code> was called more than once</a></h3><p>å´©æºƒä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#0 Thread</div><div class="line">NSInternalInconsistencyException</div><div class="line">Completion handler passed to -[WKWebViewJavascriptBridge webView:decidePolicyForNavigationAction:decisionHandler:] was called more than once</div></pre></td></tr></table></figure>
<p>è¿™æ˜¯<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">WebViewJavascriptBridge</a>åœ¨iOS11ä¸Šçš„ä¸€ä¸ª<a href="https://github.com/marcuswestin/WebViewJavascriptBridge/issues/302" target="_blank" rel="external">Issues#302</a>ã€‚</p>
<p>æ®åŒäº‹è¯´å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è§£å†³ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="type">WebViewJavascriptBridgeBase</span>().isWebViewJavascriptBridgeURL(url) &#123;</div><div class="line">    <span class="keyword">return</span></div><div class="line">&#125;</div><div class="line">decisionHandler(.allow)</div></pre></td></tr></table></figure></p>
<p>æµ‹è¯•äº†ä¸€ä¸‹ç¡®å®ä¸å´©æºƒäº†ï¼Œä½†æ˜¯å…·ä½“çš„è§£å†³æ–¹æ¡ˆè¿˜è¦çœ‹ä½œè€…çš„åœ¨<a href="https://github.com/marcuswestin/WebViewJavascriptBridge/issues/302" target="_blank" rel="external">Issues#302</a>ä¸­çš„å›å¤ã€‚</p>
<h3 id="ç…§ç‰‡å­˜å‚¨æ—¶å€™æŸäº›è®¾å¤‡å¿…crash"><a href="#ç…§ç‰‡å­˜å‚¨æ—¶å€™æŸäº›è®¾å¤‡å¿…crash" class="headerlink" title="ç…§ç‰‡å­˜å‚¨æ—¶å€™æŸäº›è®¾å¤‡å¿…crash"></a><a name="savePhoto">ç…§ç‰‡å­˜å‚¨æ—¶å€™æŸäº›è®¾å¤‡å¿…crash</a></h3><p>å´©æºƒä¿¡æ¯:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2017-09-29 11:36:17.338816+0800 Demo-iOS11-crash-save-photo[636:139456]</div><div class="line"> [access] This app has crashed because it attempted to access privacy-sensitive data without a usage description. </div><div class="line"> The app&apos;s Info.plist must contain an NSPhotoLibraryAddUsageDescription key with a string value explaining to the user how the app uses this data.</div></pre></td></tr></table></figure>
<p>æ˜¯çš„ï¼Œè¿™ä¸ª<a href="https://github.com/madordie/Demo-iOS11-crash-save-photo" target="_blank" rel="external">Demo</a>è¿˜æœ‰ä¸€ä¸ªcrashçš„æç¤ºã€‚ä½†æ˜¯åœ¨å¤§å·¥ç¨‹ä¸­ï¼Œæˆ‘å¹¶æ²¡æœ‰çœ‹åˆ°è¿™æ ·çš„ç©æ„è¾“å‡ºå‡ºæ¥ã€‚ã€‚æˆ‘åšçš„å¤ç°æ“ä½œè¾ƒç®€å•ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> img = <span class="type">UIImage</span>(named: <span class="string">"278.jpg"</span>)</div><div class="line"><span class="keyword">let</span> library = <span class="type">ALAssetsLibrary</span>()</div><div class="line"><span class="keyword">guard</span> <span class="keyword">let</span> orientation = <span class="type">ALAssetOrientation</span>(rawValue: img?.imageOrientation.rawValue ?? <span class="number">0</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</div><div class="line">library.writeImage(toSavedPhotosAlbum: img?.cgImage, orientation: orientation) &#123; (url, error) <span class="keyword">in</span></div><div class="line">    <span class="keyword">guard</span> error != <span class="literal">nil</span> <span class="keyword">else</span> &#123; <span class="built_in">print</span>(<span class="string">"no crash"</span>); <span class="keyword">return</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å°±è¿™ä¹ˆå¤šä»£ç ï¼Œä¸ç®¡æ˜¯æ‰“æ²¡æ‰“<code>Swift Error</code>ã€<code>All Exceptions</code>éƒ½æ— æ³•å®šä½åˆ°ä¸Šé¢ä»£ç å—ï¼Œè¿™æ‰æ˜¯æœ€å‘çš„ã€‚</p>
<p>ä¸Šé¢ä»£ç æ¼äº†ä¸€å¥å…³é”®çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">guard</span> <span class="type">ALAssetsLibrary</span>.authorizationStatus() == .authorized <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</div></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šé¢ä»£ç ä¹‹åˆ¤æ–­äº†æ˜¯å¦æœ‰æƒé™ï¼Œä½†æ˜¯åœ¨iOS11ä¸Šå¹¶ä¸ä¼šå¼¹å‡ºä»€ä¹ˆæˆæƒæç¤ºã€‚å°±ç®—åœ¨<code>Info.plist</code>ä¸­æ·»åŠ <code>NSPhotoLibraryUsageDescription</code>ä¾æ—§æ— æµäºäº‹ã€‚</p>
<p>ç›®å‰æ¥çœ‹ï¼ŒiOS11ä¸­<strong>åªæœ‰</strong>æ·»åŠ <code>NSPhotoLibraryAddUsageDescription</code>æ‰å¯ä»¥ã€‚</p>
<h3 id="navigationItem-titleView-ç‚¹å‡»åŒºåŸŸåç§»"><a href="#navigationItem-titleView-ç‚¹å‡»åŒºåŸŸåç§»" class="headerlink" title="navigationItem.titleView ç‚¹å‡»åŒºåŸŸåç§»"></a>navigationItem.titleView ç‚¹å‡»åŒºåŸŸåç§»</h3><p>æ‰€è®¾ç½®çš„Viewéœ€è¦å®ç°ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@implementation <span class="type">DNImageFoldTitleView</span></div><div class="line">- (<span class="type">CGSize</span>)intrinsicContentSize &#123;</div><div class="line">    <span class="keyword">return</span> <span class="type">UILayoutFittingExpandedSize</span>;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;iOS11 é¢„è§ˆç‰ˆå®‰è£…ä½“éªŒç¬”è®°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€Œè½¬ã€Unowned è¿˜æ˜¯ Weakï¼Ÿç”Ÿå‘½å‘¨æœŸå’Œæ€§èƒ½å¯¹æ¯”</title>
    <link href="https://madordie.github.io/post/swiftgg-unowned-or-weak-lifetime-and-performance/"/>
    <id>https://madordie.github.io/post/swiftgg-unowned-or-weak-lifetime-and-performance/</id>
    <published>2017-05-18T12:55:17.000Z</published>
    <updated>2017-10-09T04:58:36.437Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote>
<p>ä½œè€…ï¼šUmberto Raimondiï¼ŒåŸæ–‡é“¾æ¥ï¼ŒåŸæ–‡æ—¥æœŸï¼š2016-10-27<br>è¯‘è€…ï¼šshanksï¼›æ ¡å¯¹ï¼šCrystal Sunï¼›å®šç¨¿ï¼šCMB</p>
</blockquote>
<p>æ¯å½“å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆretain cyclesï¼‰æ—¶ï¼Œéœ€è¦è€ƒé‡å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæ¥é€‰æ‹©unownedæˆ–è€…weakæ ‡è¯†ç¬¦ï¼Œè¿™å·²ç»æˆä¸ºäº†ä¸€ä¸ªå…±è¯†ã€‚ä½†æ˜¯æœ‰æ—¶ä»ç„¶ä¼šå¿ƒå­˜ç–‘é—®ï¼Œåœ¨å…·ä½“çš„ä½¿ç”¨ä¸­åº”è¯¥é€‰æ‹©å“ªä¸€ä¸ªï¼Œæˆ–è€…é€€ä¸€æ­¥è®²ï¼Œä¿å®ˆçš„åªä½¿ç”¨ weak æ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©å‘¢ï¼Ÿ</p>
<p>æœ¬æ–‡é¦–å…ˆå¯¹å¾ªç¯å¼•ç”¨çš„åŸºç¡€çŸ¥è¯†åšä¸€ä¸ªç®€è¦ä»‹ç»ï¼Œç„¶åä¼šåˆ†æ Swift æºä»£ç çš„ä¸€äº›ç‰‡æ®µï¼Œè®²è§£ unowned å’Œ weak åœ¨ç”Ÿå‘½å‘¨æœŸå’Œæ€§èƒ½ä¸Šçš„å·®å¼‚ç‚¹ï¼Œå¸Œæœ›çœ‹å®Œæœ¬æ–‡ä»¥åï¼Œåœ¨çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œèƒ½ä½¿ç”¨æ­£ç¡®çš„å¼±å¼•ç”¨ç±»å‹ã€‚</p>
<a id="more"></a>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•:"></a>ç›®å½•:</h2><ul>
<li>åŸºç¡€çŸ¥è¯†</li>
<li>é—®é¢˜æ¥äº†: unowened è¿˜æ˜¯ weak?</li>
<li>æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢</li>
<li>æ•è·åˆ—è¡¨å¤„ç†è§£æ</li>
<li>ç»“è®º</li>
<li>è„šæ³¨</li>
</ul>
<blockquote>
<p>ä» GitHub æˆ–è€… zipped è·å–æœ¬æ–‡ç›¸å…³çš„ Playground ä»£ç ã€‚ç„¶åä»è¿™é‡Œè·å–é—­åŒ…æ¡ˆä¾‹å’Œ SILï¼ŒSILGen ä»¥åŠ LLVM IR çš„è¾“å‡ºã€‚</p>
</blockquote>
<h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒSwift åˆ©ç”¨å¤è€å¹¶ä¸”æœ‰æ•ˆçš„è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼ˆARC, Automatic Reference Countingï¼‰æ¥ç®¡ç†å†…å­˜ï¼Œå¸¦æ¥çš„åæœå’Œåœ¨ Objective-C ä¸­ä½¿ç”¨çš„æƒ…å†µç±»ä¼¼ï¼Œéœ€è¦æ‰‹åŠ¨ä½¿ç”¨å¼±å¼•ç”¨æ¥è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</p>
<p>å¦‚æœå¯¹ ARC ä¸äº†è§£ï¼Œåªéœ€è¦çŸ¥é“çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªå¼•ç”¨ç±»å‹å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°ä¸ä¹‹å…³è”ï¼Œè¿™ä¸ªå¼•ç”¨è®¡æ•°ç”¨æ¥è®°å½•è¿™ä¸ªå¯¹è±¡å®ä¾‹æ­£åœ¨è¢«å˜é‡æˆ–å¸¸é‡å¼•ç”¨çš„æ€»æ¬¡æ•°ã€‚å½“å¼•ç”¨è®¡æ•°å˜ä¸º 0 æ—¶ï¼Œå®ä¾‹å°†ä¼šè¢«ææ„ï¼Œå®ä¾‹å æœ‰çš„å†…å­˜å’Œèµ„æºéƒ½å°†å˜å¾—é‡æ–°å¯ç”¨ã€‚</p>
<p>å½“æœ‰ä¸¤ä¸ªå®ä¾‹é€šè¿‡æŸç§å½¢å¼äº’ç›¸å¼•ç”¨æ—¶ï¼Œå°±ä¼šå½¢æˆå¾ªç¯å¼•ç”¨ï¼ˆæ¯”å¦‚ï¼šä¸¤ä¸ªç±»å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå±æ€§æŒ‡å‘å¯¹æ–¹çš„ç±»å®ä¾‹ï¼›åŒå‘é“¾è¡¨ä¸­ä¸¤ä¸ªç›¸é‚»çš„èŠ‚ç‚¹å®ä¾‹ç­‰â€¦ï¼‰, ç”±äºä¸¤ä¸ªå®ä¾‹çš„å¼•ç”¨è®¡æ•°éƒ½ä¸€ç›´å¤§äº 0ï¼Œ å¾ªç¯å¼•ç”¨å°†ä¼šé˜»æ­¢è¿™äº›å®ä¾‹çš„ææ„ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå’Œå…¶ä»–ä¸€äº›æœ‰ç±»ä¼¼é—®é¢˜çš„è¯­è¨€ä¸€æ ·ï¼Œ åœ¨ Swift ä¸­ï¼Œå¼±å¼•ç”¨ çš„æ¦‚å¿µè¢«æäº†å‡ºæ¥ï¼Œå¼±å¼•ç”¨ä¸ä¼šè¢« ARC è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªå¼±å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¼•ç”¨ç±»å‹å®ä¾‹æ—¶ï¼Œå¼•ç”¨è®¡æ•°ä¸ä¼šå¢åŠ ã€‚</p>
<p>å¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å®ä¾‹çš„ææ„, åªéœ€è¦è®°ä½çš„æ˜¯ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå¼±å¼•ç”¨éƒ½ä¸ä¼šæ‹¥æœ‰å®ƒæŒ‡å‘çš„å¯¹è±¡ã€‚åœ¨æ­£å¼çš„åœºæ™¯ä¸­ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å¤„ç†è¿™ç±»å¼•ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æ„è¯†åˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>åœ¨ Swift ä¸­æœ‰ 2 ç§ å¼± å¼•ç”¨å½¢å¼ï¼Œunowned å’Œ weakã€‚</p>
<p>è™½ç„¶å®ƒä»¬çš„ä½œç”¨ç±»ä¼¼ï¼Œä½†ä¸å®ƒä»¬ç›¸å…³å®ä¾‹ç”Ÿå‘½å‘¨æœŸçš„å‡è®¾ä¼šç•¥æœ‰ä¸åŒï¼Œå¹¶ä¸”å…·æœ‰ä¸åŒçš„æ€§èƒ½ç‰¹å¾ã€‚</p>
<p>ä¸ºäº†ä¸¾ä¾‹è¯´æ˜å¾ªç¯å¼•ç”¨ï¼Œè¿™é‡Œä¸ä½¿ç”¨å¤§å®¶æœŸæœ›çœ‹åˆ°çš„ç±»ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ï¼Œè€Œä½¿ç”¨é—­åŒ…çš„ä¸Šä¸‹æ–‡æ¡ˆä¾‹ï¼Œè¿™åœ¨ Objective-C æ—¥å¸¸å¼€å‘ä¸­å¤„ç†å¾ªç¯å¼•ç”¨æ—¶ç»å¸¸ä¼šé‡åˆ°çš„æƒ…å†µã€‚å’Œç±»çš„å¾ªç¯å¼•ç”¨ç±»ä¼¼ï¼Œé€šè¿‡åˆ›å»ºä¸€ä¸ªå¼ºå¼•ç”¨æŒ‡å‘å¤–éƒ¨å®ä¾‹ï¼Œæˆ–æ•è·å®ƒï¼Œé˜»æ­¢å®ƒææ„ã€‚</p>
<p>åœ¨ Objective-C ï¼ŒæŒ‰ç…§æ ‡å‡†çš„åšæ³•ï¼Œå®šä¹‰ä¸€ä¸ªå¼±å¼•ç”¨æŒ‡å‘é—­åŒ…å¤–éƒ¨çš„å®ä¾‹ï¼Œç„¶ååœ¨é—­åŒ…å†…éƒ¨å®šä¹‰å¼ºå¼•ç”¨æŒ‡å‘è¿™ä¸ªå®ä¾‹ï¼Œåœ¨é—­åŒ…æ‰§è¡ŒæœŸé—´ä½¿ç”¨å®ƒã€‚å½“ç„¶ï¼Œæœ‰å¿…è¦åœ¨ä½¿ç”¨å‰æ£€æŸ¥å¼•ç”¨çš„æœ‰æ•ˆæ€§ã€‚</p>
<p>ä¸ºäº†æ›´æ–¹ä¾¿çš„å¤„ç†å¾ªç¯å¼•ç”¨ï¼ŒSwift å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œç”¨äºç®€åŒ–å’Œæ›´åŠ æ˜æ˜¾åœ°è¡¨è¾¾åœ¨é—­åŒ…å†…éƒ¨å¤–éƒ¨å˜é‡çš„æ•è·ï¼šæ•è·åˆ—è¡¨ï¼ˆcapture listï¼‰ã€‚ä½¿ç”¨æ•è·åˆ—è¡¨ï¼Œå¯ä»¥åœ¨å‡½æ•°çš„å¤´éƒ¨å®šä¹‰å’ŒæŒ‡å®šé‚£äº›éœ€è¦ç”¨åœ¨å†…éƒ¨çš„å¤–éƒ¨å˜é‡ï¼Œå¹¶ä¸”æŒ‡å®šå¼•ç”¨ç±»å‹(è¯‘è€…æ³¨ï¼šè¿™é‡Œæ˜¯æŒ‡ unowned å’Œ weakï¼‰ã€‚</p>
<p>æ¥ä¸‹æ¥ä¸¾ä¸€äº›ä¾‹å­ï¼Œåœ¨å„ç§æƒ…å†µä¸‹æ•è·å˜é‡çš„è¡¨ç°ã€‚</p>
<p>å½“ä¸ä½¿ç”¨æ•è·åˆ—è¡¨æ—¶ï¼Œé—­åŒ…å°†ä¼šåˆ›å»ºä¸€ä¸ªå¤–éƒ¨å˜é‡çš„å¼ºå¼•ç”¨ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> i1 = <span class="number">1</span>, i2 = <span class="number">1</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> fStrong = &#123;</div><div class="line">    i1 += <span class="number">1</span></div><div class="line">    i2 += <span class="number">2</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">fStrong()</div><div class="line"><span class="built_in">print</span>(i1,i2) <span class="comment">//Prints 2 and 3</span></div></pre></td></tr></table></figure>
<p>é—­åŒ…å†…éƒ¨å¯¹å˜é‡çš„ä¿®æ”¹å°†ä¼šæ”¹å˜å¤–éƒ¨åŸå§‹å˜é‡çš„å€¼ï¼Œè¿™ä¸é¢„æœŸæ˜¯ä¸€è‡´çš„ã€‚</p>
<p>ä½¿ç”¨æ•è·åˆ—è¡¨ï¼Œé—­åŒ…å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯ç”¨å¸¸é‡ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå¸¸é‡ä¿®é¥°ç¬¦ï¼Œé—­åŒ…å°†ä¼šç®€å•åœ°æ‹·è´åŸå§‹å€¼åˆ°æ–°çš„å˜é‡ä¸­ï¼Œå¯¹äºå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fCopy = &#123; [i1] <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(i1,i2)</div><div class="line">&#125;</div><div class="line"></div><div class="line">fStrong()</div><div class="line"><span class="built_in">print</span>(i1,i2) <span class="comment">//æ‰“å°ç»“æœæ˜¯ 2 å’Œ 3  </span></div><div class="line"></div><div class="line">fCopy()  <span class="comment">//æ‰“å°ç»“æœæ˜¯ 1 å’Œ 3</span></div></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨è°ƒç”¨ fStrong ä¹‹å‰å®šä¹‰å‡½æ•° fCopy ,åœ¨è¯¥å‡½æ•°å®šä¹‰çš„æ—¶å€™ï¼Œç§æœ‰å¸¸é‡å·²ç»è¢«åˆ›å»ºäº†ã€‚æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå½“è°ƒç”¨ç¬¬äºŒä¸ªå‡½æ•°æ—¶å€™ï¼Œä»ç„¶æ‰“å° i1 çš„åŸå§‹å€¼ã€‚</p>
<p>å¯¹äºå¤–éƒ¨å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œåœ¨æ•è·åˆ—è¡¨ä¸­æŒ‡å®š weak æˆ– unownedï¼Œè¿™ä¸ªå¸¸é‡å°†ä¼šè¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªå¼±å¼•ç”¨ï¼ŒæŒ‡å‘åŸå§‹å€¼ï¼Œè¿™ç§æŒ‡å®šçš„æ•è·æ–¹å¼å°±æ˜¯ç”¨æ¥å¤„ç†å¾ªç¯å¼•ç”¨çš„æ–¹å¼ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">aClass</span></span>&#123;</div><div class="line">    <span class="keyword">var</span> value = <span class="number">1</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> c1 = aClass()</div><div class="line"><span class="keyword">var</span> c2 = aClass()</div><div class="line"></div><div class="line"><span class="keyword">var</span> fSpec = &#123; [<span class="keyword">unowned</span> c1, <span class="keyword">weak</span> c2] <span class="keyword">in</span></div><div class="line">    c1.value += <span class="number">1</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> c2 = c2 &#123;</div><div class="line">        c2.value += <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">fSpec()</div><div class="line"><span class="built_in">print</span>(c1.value,c2.value) <span class="comment">//Prints 2 and 2</span></div></pre></td></tr></table></figure>
<p>ä¸¤ä¸ª aClass æ•è·å®ä¾‹çš„ä¸åŒçš„å®šä¹‰æ–¹å¼ï¼Œå†³å®šäº†å®ƒä»¬åœ¨é—­åŒ…ä¸­ä¸åŒçš„ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>unowned å¼•ç”¨ä½¿ç”¨çš„åœºæ™¯æ˜¯ï¼ŒåŸå§‹å®ä¾‹æ°¸è¿œä¸ä¼šä¸º nilï¼Œé—­åŒ…å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”ç›´æ¥å®šä¹‰ä¸ºæ˜¾å¼è§£åŒ…å¯é€‰å€¼ã€‚å½“åŸå§‹å®ä¾‹è¢«ææ„åï¼Œåœ¨é—­åŒ…ä¸­ä½¿ç”¨è¿™ä¸ªæ•è·å€¼å°†å¯¼è‡´å´©æºƒã€‚</p>
<p>å¦‚æœæ•è·åŸå§‹å®ä¾‹åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¸º nil ï¼Œå¿…é¡»å°†å¼•ç”¨å£°æ˜ä¸º weakï¼Œ å¹¶ä¸”åœ¨ä½¿ç”¨ä¹‹å‰éªŒè¯è¿™ä¸ªå¼•ç”¨çš„æœ‰æ•ˆæ€§ã€‚</p>
<h2 id="é—®é¢˜æ¥äº†-unowened-è¿˜æ˜¯-weak"><a href="#é—®é¢˜æ¥äº†-unowened-è¿˜æ˜¯-weak" class="headerlink" title="é—®é¢˜æ¥äº†: unowened è¿˜æ˜¯ weak?"></a>é—®é¢˜æ¥äº†: unowened è¿˜æ˜¯ weak?</h2><p>åœ¨å®é™…ä½¿ç”¨ä¸­å¦‚ä½•é€‰æ‹©è¿™ä¸¤ç§å¼±å¼•ç”¨ç±»å‹å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¯ä»¥ç®€å•ç”±åŸå§‹å¯¹è±¡å’Œå¼•ç”¨å®ƒçš„é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸæ¥è§£é‡Šã€‚</p>
<p><img src="/images/unownedbig.png" alt="unownedbig"></p>
<p>æœ‰ä¸¤ä¸ªå¯èƒ½å‡ºç°çš„åœºæ™¯ï¼š</p>
<ul>
<li><p>é—­åŒ…å’Œæ•è·å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œæ‰€ä»¥å¯¹è±¡å¯ä»¥è¢«è®¿é—®ï¼Œä¹Ÿå°±æ„å‘³ç€é—­åŒ…ä¹Ÿå¯ä»¥è¢«è®¿é—®ã€‚å¤–éƒ¨å¯¹è±¡å’Œé—­åŒ…æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ(æ¯”å¦‚ï¼šå¯¹è±¡å’Œå®ƒçš„çˆ¶å¯¹è±¡çš„ç®€å•è¿”å›å¼•ç”¨ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥æŠŠå¼•ç”¨å®šä¹‰ä¸º unownedã€‚</p>
<p>  ä¸€ä¸ªç»å…¸çš„æ¡ˆä¾‹æ˜¯: [unowned self], ä¸»è¦ç”¨åœ¨é—­åŒ…ä¸­ï¼Œè¿™ç§é—­åŒ…ä¸»è¦åœ¨ä»–ä»¬çš„çˆ¶èŠ‚ç‚¹ä¸Šä¸‹æ–‡ä¸­åšä¸€äº›äº‹æƒ…ï¼Œæ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹è¢«å¼•ç”¨æˆ–ä¼ é€’ï¼Œä¸èƒ½ä½œç”¨åœ¨çˆ¶èŠ‚ç‚¹ä¹‹å¤–ã€‚</p>
</li>
<li><p>é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸå’Œæ•è·å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸äº’ç‹¬ç«‹ï¼Œå½“å¯¹è±¡ä¸èƒ½å†ä½¿ç”¨æ—¶ï¼Œé—­åŒ…ä¾ç„¶èƒ½å¤Ÿè¢«å¼•ç”¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥æŠŠå¼•ç”¨å®šä¹‰ä¸º weakï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨å®ƒä¹‹å‰éªŒè¯ä¸€ä¸‹å®ƒæ˜¯å¦ä¸º nilï¼ˆè¯·ä¸è¦å¯¹å®ƒè¿›è¡Œå¼ºåˆ¶è§£åŒ…).</p>
<p>  ä¸€ä¸ªç»å…¸çš„æ¡ˆä¾‹æ˜¯: [weak delegate = self.delegate!]ï¼Œå¯ä»¥åœ¨æŸäº›ä½¿ç”¨é—­åŒ…çš„åœºæ™¯ä¸­çœ‹åˆ°ï¼Œé—­åŒ…ä½¿ç”¨çš„æ˜¯å®Œå…¨æ— å…³ï¼ˆç”Ÿå‘½å‘¨æœŸç‹¬ç«‹ï¼‰çš„ä»£ç†å¯¹è±¡ã€‚</p>
</li>
</ul>
<p>å½“æ— æ³•ç¡®è®¤ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´ç”Ÿå‘½å‘¨æœŸçš„å…³ç³»æ—¶ï¼Œæ˜¯å¦ä¸åº”è¯¥å»å†’é™©é€‰æ‹©ä¸€ä¸ªæ— æ•ˆ unowned å¼•ç”¨ï¼Ÿè€Œæ˜¯ä¿å®ˆé€‰æ‹© weak å¼•ç”¨æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Ÿ<br>ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºå¯¹è±¡ç”Ÿå‘½å‘¨æœŸäº†è§£æ˜¯ä¸€ä»¶å¿…è¦çš„äº‹æƒ…ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªä¿®é¥°ç¬¦åœ¨æ€§èƒ½ç‰¹æ€§ä¸Šä¹Ÿæœ‰å¾ˆå¤§çš„ä¸åŒã€‚</p>
<p>å¼±å¼•ç”¨æœ€å¸¸è§çš„å®ç°æ˜¯ï¼Œæ¯æ¬¡ä¸€ä¸ªæ–°çš„å¼•ç”¨ç”Ÿæˆæ—¶ï¼Œéƒ½ä¼šæŠŠæ¯ä¸ªå¼±å¼•ç”¨å’Œå®ƒæŒ‡å‘çš„å¯¹è±¡ä¿¡æ¯å­˜å‚¨åˆ°ä¸€ä¸ªé™„åŠ è¡¨ä¸­ã€‚</p>
<p>å½“æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡æ—¶ï¼ŒSwift è¿è¡Œæ—¶ä¼šå¯åŠ¨ææ„è¿‡ç¨‹ï¼Œä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œè¿è¡Œæ—¶ä¼šæŠŠæ‰€æœ‰ç›¸å…³çš„å¼±å¼•ç”¨ç½®ä¸º nil ã€‚å¼±å¼•ç”¨çš„è¿™ç§å®ç°æ–¹å¼æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€é›¶å’Œå¼±å¼•ç”¨â€ã€‚</p>
<p>è¿™ç§å®ç°æœ‰å®é™…çš„å¼€é”€ï¼Œè€ƒè™‘åˆ°éœ€è¦é¢å¤–å®ç°çš„æ•°æ®ç»“æ„ï¼Œéœ€è¦ç¡®ä¿åœ¨å¹¶å‘è®¿é—®æƒ…å†µä¸‹ï¼Œå¯¹è¿™ä¸ªå…¨å±€å¼•ç”¨ç»“æ„æ‰€æœ‰æ“ä½œçš„æ­£ç¡®æ€§ã€‚ä¸€æ—¦ææ„è¿‡ç¨‹å¼€å§‹äº†ï¼Œåœ¨ä»»ä½•ç¯å¢ƒä¸­ï¼Œéƒ½ä¸å…è®¸è®¿é—®å¼±å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡äº†ã€‚</p>
<p>å¼±å¼•ç”¨ï¼ˆåŒ…æ‹¬ unowned å’Œä¸€äº›å˜ä½“çš„ weak)åœ¨ Swift ä½¿ç”¨äº†æ›´ç®€å•å’Œå¿«é€Ÿçš„å®ç°æœºåˆ¶ã€‚</p>
<p>Swift ä¸­çš„æ¯ä¸ªå¯¹è±¡ä¿æŒäº†ä¸¤ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œä¸€ä¸ªæ˜¯å¼ºå¼•ç”¨è®¡æ•°å™¨ï¼Œç”¨æ¥å†³å®š ARC ä»€ä¹ˆæ—¶å€™å¯ä»¥å®‰å…¨åœ°ææ„è¿™ä¸ªå¯¹è±¡ï¼Œå¦å¤–ä¸€ä¸ªé™„åŠ çš„å¼±å¼•ç”¨è®¡æ•°å™¨ï¼Œç”¨æ¥è®¡ç®—åˆ›å»ºäº†å¤šå°‘ä¸ªæŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„ unowned æˆ–è€… weak å¼•ç”¨ï¼Œå½“è¿™ä¸ªè®¡æ•°å™¨ä¸ºé›¶æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å°†è¢« ææ„ ã€‚</p>
<p>éœ€è¦é‡ç‚¹ç†è§£çš„æ˜¯ï¼Œåªæœ‰ç­‰åˆ°æ‰€æœ‰ unowned å¼•ç”¨è¢«é‡Šæ”¾åï¼Œè¿™ä¸ªå¯¹è±¡æ‰ä¼šè¢«çœŸæ­£åœ°ææ„ï¼Œç„¶åå¯¹è±¡å°†ä¼šä¿æŒæœªè§£æå¯è®¿é—®çŠ¶æ€ï¼Œå½“ææ„å‘ç”Ÿåï¼Œå¯¹è±¡çš„å†…å®¹æ‰ä¼šè¢«å›æ”¶ã€‚</p>
<p>æ¯å½“ unowned å¼•ç”¨è¢«å®šä¹‰æ—¶ï¼Œå¯¹åº”çš„ unowned å¼•ç”¨è®¡æ•°ä¼šè¿›è¡ŒåŸå­çº§åˆ«åœ°å¢åŠ (ä½¿ç”¨åŸå­gcc/llvmæ“ä½œï¼Œè¿›è¡Œä¸€ç³»åˆ—å¿«é€Ÿä¸”çº¿ç¨‹å®‰å…¨çš„åŸºæœ¬æ“ä½œï¼Œä¾‹å¦‚ï¼šå¢åŠ ï¼Œå‡å°‘ï¼Œæ¯”è¾ƒï¼Œäº¤æ¢ç­‰)ï¼Œä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚åœ¨å¢åŠ è®¡æ•°ä¹‹å‰ï¼Œä¼šæ£€æŸ¥å¼ºå¼•ç”¨è®¡æ•°ä»¥ç¡®ä¿å¯¹è±¡æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>è¯•å›¾è®¿é—®ä¸€ä¸ªæ— æ•ˆçš„å¯¹è±¡ï¼Œå°†ä¼šå¯¼è‡´é”™è¯¯çš„æ–­è¨€ï¼Œä½ çš„åº”ç”¨åœ¨è¿è¡Œæ—¶ä¸­ä¼šæŠ¥é”™(è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œçš„ unownd å®ç°æ–¹å¼å«åš unowned(safe) å®ç°)<br>ä¸ºäº†æ›´å¥½çš„ä¼˜åŒ–ï¼Œåº”ç”¨ç¼–è¯‘æ—¶å¸¦æœ‰ -OFastï¼Œunowned å¼•ç”¨ä¸ä¼šå»éªŒè¯å¼•ç”¨å¯¹è±¡çš„æœ‰æ•ˆæ€§ï¼Œunowned å¼•ç”¨çš„è¡Œä¸ºå°±ä¼šåƒ Objective-C ä¸­çš„ __unsafe_unretained ä¸€æ ·ã€‚å¦‚æœå¼•ç”¨å¯¹è±¡æ— æ•ˆï¼Œunowned å¼•ç”¨å°†ä¼šæŒ‡å‘å·²ç»é‡Šæ”¾åƒåœ¾å†…å­˜ï¼ˆè¿™ç§å®ç°ç§°ä¹‹ unowned(unsafe)ï¼‰ã€‚</p>
<p>å½“ä¸€ä¸ª unowned å¼•ç”¨è¢«é‡Šæ”¾åï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰å…¶ä»–å¼ºå¼•ç”¨æˆ– unowned å¼•ç”¨æŒ‡å‘è¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿™ä¸ªå¯¹è±¡å°†è¢«ææ„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ªå¼•ç”¨å¯¹è±¡ä¸èƒ½åœ¨å¼ºå¼•ç”¨è®¡æ•°å™¨ç­‰äºé›¶çš„æƒ…å†µä¸‹ï¼Œè¢«ææ„çš„åŸå› ï¼Œæ‰€æœ‰çš„å¼•ç”¨è®¡æ•°å™¨å¿…é¡»èƒ½å¤Ÿè¢«è®¿é—®ç”¨æ¥éªŒè¯ unowned å¼•ç”¨å’Œå¼ºå¼•ç”¨æ•°é‡ã€‚</p>
<p>Swift çš„ weak å¼•ç”¨æ·»åŠ äº†é™„åŠ å±‚ï¼Œé—´æ¥åœ°æŠŠ unowned å¼•ç”¨åŒ…è£¹åˆ°äº†ä¸€ä¸ªå¯é€‰å®¹å™¨é‡Œé¢ï¼Œåœ¨æŒ‡å‘çš„å¯¹è±¡ææ„ä¹‹åå˜æˆç©ºçš„æƒ…å†µä¸‹ï¼Œè¿™æ ·å¤„ç†ä¼šæ›´åŠ çš„æ¸…æ™°ã€‚ä½†æ˜¯éœ€è¦ä»˜å‡ºçš„ä»£ä»·æ˜¯ï¼Œé™„åŠ çš„æœºåˆ¶éœ€è¦æ­£ç¡®åœ°å¤„ç†å¯é€‰å€¼ã€‚</p>
<p>è€ƒè™‘åˆ°ä»¥ä¸Šå› ç´ ï¼Œåœ¨å¯¹è±¡å…³ç³»ç”Ÿå‘½å‘¨æœŸå…è®¸çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆé€‰æ‹©ä½¿ç”¨ unowned å¼•ç”¨ã€‚ä½†æ˜¯è¿™ä¸æ˜¯æ­¤æ•…äº‹çš„ç»“å±€ï¼Œæ¥ä¸‹æ¥æ¯”è¾ƒä¸€ä¸‹ä¸¤è€…æ€§èƒ½1ä¸Šçš„å·®åˆ«ã€‚</p>
<h2 id="æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢"><a href="#æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢" class="headerlink" title="æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢"></a>æ€§èƒ½ï¼šæ·±åº¦æ¢ç´¢</h2><p>åœ¨æŸ¥çœ‹ Swift é¡¹ç›®æºç éªŒè¯ä¹‹å‰ï¼Œéœ€è¦ç†è§£ ARC å¦‚ä½•ç®¡ç†è¿™ä¸¤ç§å¼•ç”¨ç±»å‹ï¼Œå¹¶ä¸”è¿˜éœ€è¦è§£é‡Š swiftcï¼ŒLLVM å’Œ SIL çš„ç›¸å…³çŸ¥è¯†ã€‚</p>
<p>æ¥ä¸‹æ¥è¯•ç€ç®€è¦ä»‹ç»æœ¬æ–‡æ‰€éœ€è¦çš„å¿…å¤‡çŸ¥è¯†ç‚¹ï¼Œå¦‚æœæƒ³äº†è§£æ›´å¤šï¼Œå°†åœ¨æœ€åçš„è„šæ³¨ä¸­æ‰¾åˆ°ä¸€äº›æœ‰ç”¨çš„é“¾æ¥ã€‚</p>
<p>ä½¿ç”¨ä¸€ä¸ªå›¾æ¥è§£é‡Š swiftc æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹çš„åŒ…å«çš„æ¨¡å—ï¼š</p>
<p><img src="/images/swiftc.png" alt="swiftc"></p>
<p>Swiftc å’Œ clang ä¸€æ ·æ„å»ºåœ¨ LLVM ä¸Šï¼Œéµå¾ª clang ç¼–è¯‘å™¨ç›¸ä¼¼çš„ç¼–è¯‘æµç¨‹ã€‚</p>
<p>åœ¨ç¼–è¯‘è¿‡ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨ä¸€ä¸ªç‰¹å®šè¯­è¨€å‰ç«¯è¿›è¡Œç®¡ç†ï¼Œswift æºä»£ç è¢«è§£é‡Šç”Ÿæˆä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘(AST)è¡¨è¾¾2ï¼Œç„¶åæŠ½è±¡è¯­æ³•æ ‘çš„ç»“æœä»è¯­ä¹‰è§’åº¦è¿›è¡Œåˆ†æï¼Œæ‰¾å‡ºè¯­ä¹‰é”™è¯¯ã€‚</p>
<p>åœ¨è¿™ä¸ªç‚¹ä¸Šï¼Œå¯¹äºå…¶ä»–çš„åŸºäº LLVM çš„ç¼–è¯‘å™¨æ¥è®²ï¼Œåœ¨é€šè¿‡ä¸€ä¸ªé™„åŠ æ­¥éª¤å¯¹æºä»£ç è¿›è¡Œé™æ€åˆ†æåï¼ˆå¿…è¦æ—¶å¯ä»¥æ˜¾ç¤ºé”™è¯¯å’Œè­¦å‘Šï¼‰ï¼Œæ¥ç€ IRGen æ¨¡å— ä¼šæŠŠ AST çš„å†…å®¹ä¼šè½¬æ¢æˆä¸€ä¸ªè½»é‡çš„å’Œåº•å±‚çš„æœºå™¨æ— å…³çš„è¡¨ç¤ºï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º LLVM IR(LLVM ä¸­é—´è¡¨ç¤º)ã€‚</p>
<p>å°½ç®¡ä¸¤ä¸ªæ¨¡å—éƒ½éœ€è¦åšä¸€äº›ç›¸åŒæ£€æŸ¥ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ¨¡å—æ˜¯åŒºåˆ†å¼€çš„ï¼Œåœ¨ä¸¤ä¸ªæ¨¡å—ä¹‹é—´ä¹Ÿå­˜åœ¨è®¸å¤šé‡å¤çš„ä»£ç ã€‚</p>
<p>IR æ˜¯ä¸€ç§é™æ€å•èµ‹å€¼å½¢å¼ï¼ˆSSA-formï¼‰ä¸€è‡´è¯­è¨€ï¼Œå¯ä»¥çœ‹åšæ³¨å…¥äº† LLVM çš„è™šæ‹Ÿæœºä¸‹çš„ RISC ç±»å‹æ±‡ç¼–è¯­è¨€ã€‚åŸºäº SSA å°†ç®€åŒ–æ¥ä¸‹æ¥çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œä»è¯­è¨€å‰ç«¯æä¾›çš„ä¸­é—´è¡¨è¾¾ä¼šåœ¨ IR è¿›è¡Œå¤šé‡ä¼˜åŒ–ã€‚</p>
<p>éœ€è¦é‡ç‚¹æ³¨æ„çš„æ˜¯ï¼ŒIR å…¶ä¸­ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œå®ƒå…·æœ‰ä¸‰ç§ä¸åŒçš„å½¢å¼ï¼šå†…å­˜è¡¨è¾¾ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰ï¼Œåºåˆ—åŒ–ä½ä»£ç å½¢å¼ï¼ˆä½ å·²ç»çŸ¥é“çš„ä½ä»£ç å½¢å¼ï¼‰å’Œå¯è¯»å½¢å¼ã€‚</p>
<p>æœ€åä¸€ç§å½¢å¼éå¸¸æœ‰ç”¨ï¼Œç”¨æ¥éªŒè¯ IR ä»£ç çš„æœ€ç»ˆç»“æ„ï¼Œè¿™ä¸ªç»“æ„å°†ä¼šä¼ å…¥åˆ°æ•´ä¸ªè¿‡ç¨‹ä¸­çš„æœ€åä¸€æ­¥ï¼Œå°†ä¼šä»æœºå™¨ç‹¬ç«‹çš„ IR ä»£ç è½¬æ¢æˆå¹³å°ç›¸å…³çš„è¡¨è¾¾(æ¯”å¦‚ï¼šx86ï¼ŒARM ç­‰ç­‰)ã€‚æœ€åä¸€æ­¥å°†è¢« LLVM å¹³å°åç«¯æ‰§è¡Œã€‚</p>
<p>é‚£ä¹ˆ swiftc å’Œå…¶ä»–åŸºäº LLVM çš„ç¼–è¯‘å™¨æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ<br>swiftc å’Œå…¶ä»–ç¼–è¯‘å™¨ä»ç»“æ„å½¢å¼ä¸Šçš„å·®åˆ«ä¸»è¦ä½“ç°åœ¨ä¸€ä¸ªé™„åŠ ç»„ä»¶ï¼Œè¿™ä¸ªé™„åŠ ç»„ä»¶æ˜¯ SILGen ï¼Œåœ¨ IRGen ä¹‹å‰ï¼Œæ‰§è¡Œä»£ç çš„ç›‘æµ‹å’Œä¼˜åŒ–ï¼Œç”Ÿæˆä¸€ä¸ªé«˜çº§çš„ä¸­é—´è¡¨è¾¾ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º SIL ï¼ˆSwift Intermediate Languageï¼ŒSwift ä¸­é—´è¯­è¨€ï¼‰ï¼Œæœ€å SIL å°†ä¼šè½¬æ¢æˆ LLVM IRã€‚è¿™ä¸€æ­¥åŠ å¼ºäº†åœ¨å•ä¸ªè½¯ä»¶æ¨¡å—ä¸Šæ‰€æœ‰å…·ä½“è¯­è¨€çš„æ£€æŸ¥ï¼Œå¹¶ä¸”ç®€åŒ–äº† IRGenã€‚</p>
<p>ä» AST åˆ° IR çš„è½¬æ¢åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ã€‚SILGen æŠŠ AST æºä»£ç è½¬æ¢ä¸ºåŸå§‹ SIL ï¼Œç„¶åç¼–è¯‘å™¨è¿›è¡Œ Swift è¯­æ³•æ£€æŸ¥ï¼ˆéœ€è¦æ—¶æ‰“å°é”™è¯¯æˆ–è€…è­¦å‘Šä¿¡æ¯ï¼‰ï¼Œä¼˜åŒ–æœ‰æ•ˆçš„åŸå§‹ SIL ï¼Œé€šè¿‡ä¸€äº›æ­¥éª¤æœ€åç”Ÿæˆæ ‡å‡†åŒ– SIL ã€‚å¦‚ä¸Šé¢çš„ç¤ºæ„å›¾æ˜¾ç¤ºé‚£æ ·ï¼Œæ ‡å‡†åŒ– SIL çš„æœ€åè½¬åŒ–ä¸º LLVM IRã€‚</p>
<p>å†æ¬¡å¼ºè°ƒï¼ŒSIL æ˜¯ä¸€ä¸ª SSA ç±»å‹è¯­è¨€ï¼Œä½¿ç”¨é™„åŠ çš„ç»“æ„æ‰©å±•äº† Swift çš„è¯­æ³•ã€‚å®ƒä¾èµ– Swift çš„ç±»å‹ç³»ç»Ÿï¼Œå¹¶ä¸”èƒ½ç†è§£ Swift çš„å®šä¹‰ï¼Œä½†æ˜¯éœ€è¦é‡ç‚¹è®°ä½çš„æ˜¯ï¼Œå½“ç¼–è¯‘ä¸€ä¸ªæ‰‹å†™çš„ SIL æºç ï¼ˆæ˜¯çš„ï¼Œå¯ä»¥æ‰‹åŠ¨å†™ SIL ç„¶åç¼–è¯‘å®ƒï¼‰æ—¶ï¼Œé«˜é˜¶çš„ Swift ä»£ç æˆ–è€…å‡½æ•°å†…å®¹å°†è¢«ç¼–è¯‘å™¨å¿½ç•¥ã€‚</p>
<p>åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ï¼Œæˆ‘ä»¬å°†åˆ†æä¸€ä¸ªæ ‡å‡†åŒ– SIL çš„æ¡ˆä¾‹ï¼Œæ¥ç†è§£ unowned å’Œ weak å¼•ç”¨å¦‚ä½•è¢«ç¼–è¯‘å™¨å¤„ç†ã€‚ä¸€ä¸ªåŒ…å«æ•è·åˆ—è¡¨çš„åŸºæœ¬é—­åŒ…çš„ä¾‹å­ï¼ŒæŸ¥çœ‹è¿™ä¸ªä¾‹å­ç”Ÿæˆçš„ SIL ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°è¢«ç¼–è¯‘å™¨æ·»åŠ çš„æ‰€æœ‰ ARC ç›¸å…³çš„å‡½æ•°è°ƒç”¨ã€‚</p>
<blockquote>
<p>ä» GitHub æˆ–è€… zipped è·å–æœ¬æ–‡ç›¸å…³çš„ Playground ä»£ç ã€‚ç„¶åä»è¿™é‡Œè·å–é—­åŒ…æ¡ˆä¾‹å’Œ SIL ï¼ŒSILGen ä»¥åŠ LLVM IR çš„è¾“å‡ºã€‚</p>
</blockquote>
<h2 id="æ•è·åˆ—è¡¨å¤„ç†è§£æ"><a href="#æ•è·åˆ—è¡¨å¤„ç†è§£æ" class="headerlink" title="æ•è·åˆ—è¡¨å¤„ç†è§£æ"></a>æ•è·åˆ—è¡¨å¤„ç†è§£æ</h2><p>æ¥ä¸‹æ¥çœ‹çœ‹ä¸€ä¸ªç®€å•çš„ Swift çš„ä¾‹å­ï¼Œå®šä¹‰ä¸¤ä¸ªç±»å˜é‡ï¼Œç„¶ååœ¨ä¸€ä¸ªé—­åŒ…ä¸­å¯¹ä»–ä»¬è¿›è¡Œå¼±å¼•ç”¨çš„æ•è·ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">aClass</span></span>&#123;</div><div class="line">    <span class="keyword">var</span> value = <span class="number">1</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> c1 = aClass()</div><div class="line"><span class="keyword">var</span> c2 = aClass()</div><div class="line"></div><div class="line"><span class="keyword">var</span> fSpec = &#123; </div><div class="line">    [<span class="keyword">unowned</span> c1, <span class="keyword">weak</span> c2] <span class="keyword">in</span></div><div class="line">    c1.value = <span class="number">42</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> c2o = c2 &#123;</div><div class="line">        c2o.value = <span class="number">42</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">fSpec()</div></pre></td></tr></table></figure>
<p>é€šè¿‡ xcrun swiftc -emit-sil sample.swift ç¼–è¯‘ swift æºä»£ç ï¼Œç”Ÿæˆæ ‡å‡†åŒ– SIL ä»£ç ã€‚åŸå§‹SIL å¯ä»¥ä½¿ç”¨ -emit-silgen é€‰é¡¹æ¥ç”Ÿæˆã€‚</p>
<p>è¿è¡Œä»¥ä¸Šå‘½ä»¤ä»¥åï¼Œä¼šå‘ç° swiftc äº§ç”Ÿäº†è®¸å¤šä»£ç ã€‚é€šè¿‡æŸ¥çœ‹ swiftc è¾“å‡ºä»£ç çš„ç‰‡æ®µï¼Œå­¦ä¹ ä¸€ä¸‹åŸºæœ¬çš„ SIL æŒ‡ä»¤ï¼Œç†è§£æ•´ä¸ªç»“æ„ã€‚</p>
<p>åœ¨ä¸‹é¢ä»£ç ä¸­éœ€è¦çš„åœ°æ–¹æ·»åŠ äº†ä¸€äº›å¤šè¡Œæ³¨é‡Šï¼ˆç¼–è¯‘å™¨ä¹Ÿç”Ÿæˆäº†ä¸€äº›å•è¡Œæ³¨é‡Šï¼‰ï¼Œå¸Œæœ›è¿™äº›æ³¨é‡Šå·²ç»è¶³å¤Ÿè¯´æ¸…æ¥šå‘ç”Ÿäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">  æ­¤æ–‡ä»¶åŒ…å«å…¸å‹ SIL ä»£ç </div><div class="line">*/</div><div class="line">sil_stage canonical             </div><div class="line"></div><div class="line"><span class="comment">/* </span></div><div class="line">  åªæœ‰åœ¨ SIL å†…éƒ¨ä½¿ç”¨çš„ç‰¹æ®Šçš„å¯¼å…¥</div><div class="line">*/</div><div class="line"><span class="keyword">import</span> Builtin                  </div><div class="line"><span class="keyword">import</span> Swift</div><div class="line"><span class="keyword">import</span> SwiftShims</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">	ä¸‰ä¸ªå…¨å±€å˜é‡çš„å®šä¹‰ï¼ŒåŒ…æ‹¬ c1ï¼Œc2 å’Œ é—­åŒ… fSpecã€‚</div><div class="line">  	@_Tv4clos2c1CS_6aClassæ˜¯å˜é‡çš„ç¬¦å·ï¼Œ$aClass æ˜¯å®ƒçš„ç±»å‹ï¼ˆç±»å‹å‰ç¼€ä¸º$)ã€‚</div><div class="line">  	å˜é‡ååœ¨è¿™é‡Œçœ‹èµ·æ¥å¾ˆä¹±ï¼Œä½†æ˜¯åœ¨åé¢çš„ä»£ç ä¸­å°†å˜å¾—æ›´åŠ å¯è¯»ã€‚</div><div class="line">*/</div><div class="line"><span class="comment">// c1</span></div><div class="line">sil_global hidden @_Tv4sample2c1CS_6aClass : $aClass</div><div class="line"></div><div class="line"><span class="comment">// c2</span></div><div class="line">sil_global hidden @_Tv4sample2c2CS_6aClass : $aClass</div><div class="line"></div><div class="line"><span class="comment">// fSpec</span></div><div class="line">sil_global hidden @_Tv4sample5fSpecFT_T_ : $@callee_owned () -&gt; ()</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">  å±‚æ¬¡ä½œç”¨åŸŸå®šä¹‰è¡¨ç¤ºåŸå§‹ä»£ç çš„ä½ç½®ã€‚</div><div class="line">  æ¯ä¸ª SIL æŒ‡ç¤ºå°†ä¼šæŒ‡å‘å®ƒç”Ÿæˆçš„ `sil_scope`ã€‚</div><div class="line">*/</div><div class="line">sil_scope <span class="number">1</span> &#123;  parent @main : $<span class="meta">@convention</span>(<span class="built_in">c</span>) (<span class="type">Int32</span>, <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;&gt;) -&gt; <span class="type">Int32</span> &#125;</div><div class="line">sil_scope <span class="number">2</span> &#123; loc <span class="string">"sample.swift"</span>:<span class="number">14</span>:<span class="number">1</span> parent <span class="number">1</span> &#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">	è‡ªåŠ¨ç”Ÿæˆçš„ @main å‡½æ•°åŒ…å«äº†æˆ‘ä»¬åŸå§‹å…¨éƒ¨ä½œç”¨åŸŸçš„ä»£ç ã€‚</div><div class="line"> 	è¿™é‡Œæ²¿ç”¨äº†ç†Ÿæ‚‰çš„ c main() å‡½æ•°ç»“æ„ï¼Œæ¥æ”¶å‚æ•°ä¸ªæ•°å’Œå‚æ•°æ•°ç»„ä¸¤ä¸ªè¾“å…¥ï¼Œè¿™ä¸ªå‡½æ•°éµå¾ª c è°ƒç”¨çº¦å®šã€‚</div><div class="line">  	è¿™ä¸ªå‡½æ•°åŒ…å«äº†éœ€è¦è°ƒç”¨é—­åŒ…çš„æŒ‡ä»¤ã€‚</div><div class="line">*/</div><div class="line"><span class="comment">// main</span></div><div class="line">sil @main : $<span class="meta">@convention</span>(<span class="built_in">c</span>) (<span class="type">Int32</span>, <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;&gt;) -&gt; <span class="type">Int32</span> &#123;</div><div class="line"><span class="comment">/*</span></div><div class="line">  å…¥å£å®šä¹‰å¤´éƒ¨ä¸º % ç¬¦å·ï¼Œåé¢è·Ÿéšä¸€ä¸ªæ•°å­— idã€‚</div><div class="line">  æ¯å½“ä¸€ä¸ªæ–°çš„å…¥å£å®šä¹‰æ—¶ï¼ˆæˆ–è€…å‡½æ•°å¼€å¤´å®šä¹‰å‡½æ•°å‚æ•°ï¼‰ï¼Œç¼–è¯‘å™¨åœ¨å…¥å£è¡Œå°¾æ ¹æ®å®ƒçš„å€¼ï¼ˆå«åš usersï¼‰æ·»åŠ ä¸€ä¸ªæ³¨é‡Šã€‚</div><div class="line">  å¯¹äºå…¶ä»–æŒ‡ä»¤ï¼Œéœ€è¦æä¾› id å·ã€‚</div><div class="line">  åœ¨è¿™é‡Œï¼Œå…¥å£ 0 å°†è¢«ç”¨æ¥è®¡ç®—å…¥å£ 4 çš„å†…å®¹ï¼Œå…¥å£ 1 å°†è¢«ç”¨æ¥åˆ›å»ºå…¥å£ 10 çš„å€¼ã€‚</div><div class="line">*/</div><div class="line"><span class="comment">// %0                                             // user: %4</span></div><div class="line"><span class="comment">// %1                                             // user: %10</span></div><div class="line"><span class="comment">/*</span></div><div class="line">  æ¯ä¸€ä¸ªå‡½æ•°è¢«åˆ†è§£æˆä¸€ç³»åˆ—çš„åŸºæœ¬æŒ‡ä»¤å—ï¼Œæ¯ä¸€ä¸ªæŒ‡ä»¤å—ç»“æŸäºä¸€ä¸ªç»ˆæ­¢æŒ‡ä»¤ï¼ˆä¸€ä¸ªåˆ†æ”¯æˆ–è€…ä¸€ä¸ªè¿”å›ï¼‰ã€‚</div><div class="line">  è¿™ä¸€ç³»åˆ—çš„æŒ‡ä»¤å—è¡¨ç¤ºå‡½æ•°æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ã€‚</div><div class="line">*/</div><div class="line">bb0(%<span class="number">0</span> : $<span class="type">Int32</span>, %<span class="number">1</span> : $<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;&gt;):</div><div class="line">...</div><div class="line">  <span class="comment">/*</span></div><div class="line">    æ¯ä¸€ä¸ª SIL æŒ‡ä»¤éƒ½åŒ…å«ä¸€ä¸ªå¼•ç”¨ï¼ŒæŒ‡å‘æºä»£ç çš„ä½ç½®ï¼ŒåŒ…æ‹¬æŒ‡ä»¤å…·ä½“ä»æºä»£ç ä¸­å“ªä¸ªåœ°æ–¹æ¥ï¼Œå±äºå“ªä¸€ä¸ªä½œç”¨åŸŸã€‚</div><div class="line">    åœ¨åé¢åˆ†æå…·ä½“çš„æ–¹æ³•ä¼šçœ‹åˆ°è¿™äº›å†…å®¹ã€‚</div><div class="line">  */</div><div class="line">  unowned_retain %<span class="number">27</span> : $@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// id: %28</span></div><div class="line">  store %<span class="number">27</span> to %<span class="number">2</span> : $*@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// id: %29</span></div><div class="line">  %<span class="number">30</span> = alloc_box $@sil_weak <span class="type">Optional</span>&lt;aClass&gt;, <span class="keyword">var</span>, name <span class="string">"c2"</span>, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// users: %46, %44, %43, %31</span></div><div class="line">  %<span class="number">31</span> = project_box %<span class="number">30</span> : $@box @sil_weak <span class="type">Optional</span>&lt;aClass&gt;, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// user: %35</span></div><div class="line">  %<span class="number">32</span> = load %<span class="number">19</span> : $*aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// users: %34, %33</span></div><div class="line">  ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment">/* </span></div><div class="line">  ä¸‹é¢æ˜¯ä¸€ç³»åˆ—è‡ªåŠ¨ç”Ÿæˆçš„`aClass`çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š init/deinit, setter/getter å’Œå…¶ä»–ä¸€äº›å·¥å…·æ–¹æ³•ã€‚</div><div class="line">  æ¯ä¸ªæ–¹æ³•å‰çš„æ³¨é‡Šæ˜¯ç¼–è¯‘å™¨æ·»åŠ çš„ï¼Œç”¨æ¥è¯´æ˜ä»£ç çš„å…·ä½“ä½œç”¨ã€‚</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">  éšè—æ–¹æ³•åªåœ¨å®ƒä»¬æ¨¡å—ä¸­å¯è§ã€‚</div><div class="line">  @convention(æ–¹æ³•å)æ˜¯ Swift ä¸­æ–¹æ³•è°ƒç”¨é»˜è®¤çš„çº¦å®šï¼Œåœ¨å°¾éƒ¨æœ‰ä¸€ä¸ªé™„åŠ çš„å‚æ•°æŒ‡å‘å®ƒè‡ªå·±ã€‚</div><div class="line">*/</div><div class="line"><span class="comment">// aClass.__deallocating_deinit</span></div><div class="line">sil hidden @_TFC4clos6aClassD : $<span class="meta">@convention</span>(method) (@owned aClass) -&gt; () &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">  @guaranteed å‚æ•°è¡¨ç¤ºä¿è¯åœ¨æ•´ä¸ªå‘¨æœŸå†…è°ƒç”¨æ­¤æ–¹æ³•éƒ½æœ‰æ•ˆã€‚</div><div class="line">*/</div><div class="line"><span class="comment">// aClass.deinit</span></div><div class="line">sil hidden @_TFC4clos6aClassd : $<span class="meta">@convention</span>(method) (@guaranteed aClass) -&gt; @owned <span class="type">Builtin</span>.<span class="type">NativeObject</span> &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">  [transparent] ä¿®é¥°çš„æ–¹æ³•æ˜¯å†…è”çš„å°æ–¹æ³•</div><div class="line">*/</div><div class="line"><span class="comment">// aClass.value.getter</span></div><div class="line">sil hidden [transparent] @_TFC4clos6aClassg5valueSi : $<span class="meta">@convention</span>(method) (@guaranteed aClass) -&gt; <span class="type">Int</span> &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// aClass.value.setter</span></div><div class="line">sil hidden [transparent] @_TFC4clos6aClasss5valueSi : $<span class="meta">@convention</span>(method) (<span class="type">Int</span>, @guaranteed aClass) -&gt; () &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"><span class="comment">// aClass.value.materializeForSet</span></div><div class="line">sil hidden [transparent] @_TFC4clos6aClassm5valueSi : $<span class="meta">@convention</span>(method) (<span class="type">Builtin</span>.<span class="type">RawPointer</span>, @<span class="keyword">inout</span> <span class="type">Builtin</span>.<span class="type">UnsafeValueBuffer</span>, @guaranteed aClass) -&gt; (<span class="type">Builtin</span>.<span class="type">RawPointer</span>, <span class="type">Optional</span>&lt;<span class="type">Builtin</span>.<span class="type">RawPointer</span>&gt;) &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">  @owned ä¿®é¥°ç¬¦è¡¨ç¤ºè¿™ä¸ªå¯¹è±¡å°†è¢«è°ƒç”¨è€…æ‹¥æœ‰ã€‚</div><div class="line">*/</div><div class="line"><span class="comment">// aClass.init() -&gt; aClass</span></div><div class="line">sil hidden @_TFC4clos6aClasscfT_S0_ : $<span class="meta">@convention</span>(method) (@owned aClass) -&gt; @owned aClass &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// aClass.__allocating_init() -&gt; aClass</span></div><div class="line">sil hidden @_TFC4clos6aClassCfT_S0_ : $<span class="meta">@convention</span>(method) (@thick aClass.<span class="type">Type</span>) -&gt; @owned aClass &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* </span></div><div class="line">  æ¥ä¸‹é¢æ˜¯é—­åŒ…ä»£ç æ®µ</div><div class="line">*/</div><div class="line"><span class="comment">// (closure #1)</span></div><div class="line">sil shared @_TF4closU_FT_T_ : $<span class="meta">@convention</span>(thin) (@owned @sil_unowned aClass, @owned @box @sil_weak <span class="type">Optional</span>&lt;aClass&gt;) -&gt; () &#123;</div><div class="line">    ...</div><div class="line">    <span class="comment">/* å…³äºé—­åŒ…çš„ SIL ä»£ç ï¼Œ è§ä¸‹æ–‡ */</span></div><div class="line"></div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">...</div><div class="line"><span class="comment">/* </span></div><div class="line">  sil_vtable å®šä¹‰æ‰€æœ‰å…³äº aClass ç±»çš„è™šå‡½æ•°è¡¨ã€‚</div><div class="line">  sil_vtable åŒ…å«äº†æœŸæœ›çš„æ‰€æœ‰è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•ã€‚</div><div class="line">*/</div><div class="line">sil_vtable aClass &#123;</div><div class="line">  #aClass.<span class="keyword">deinit</span>!deallocator: _TFC4clos6aClassD	<span class="comment">// aClass.__deallocating_deinit</span></div><div class="line">  #aClass.value!getter.<span class="number">1</span>: _TFC4clos6aClassg5valueSi	<span class="comment">// aClass.value.getter</span></div><div class="line">  #aClass.value!setter.<span class="number">1</span>: _TFC4clos6aClasss5valueSi	<span class="comment">// aClass.value.setter</span></div><div class="line">  #aClass.value!materializeForSet.<span class="number">1</span>: _TFC4clos6aClassm5valueSi	<span class="comment">// aClass.value.materializeForSet</span></div><div class="line">  #aClass.<span class="keyword">init</span>!initializer.<span class="number">1</span>: _TFC4clos6aClasscfT_S0_	<span class="comment">// aClass.init() -&gt; aClass</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç°åœ¨å›åˆ°ä¸»å‡½æ•°ï¼Œçœ‹çœ‹ä¸¤ä¸ªç±»å®ä¾‹å¦‚ä½•è¢«è·å–åˆ°ï¼Œå¹¶å¦‚ä½•ä¼ é€’ç»™è°ƒç”¨ä»–ä»¬çš„é—­åŒ…ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæ‰€æœ‰æ ‡è¯†éƒ½è¢«é‡æ–°æ•´ç†ï¼Œä½¿å¾—ä»£ç ç‰‡æ®µæ›´åŠ å¯è¯»ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// main</span></div><div class="line">sil @main : $<span class="meta">@convention</span>(<span class="built_in">c</span>) (<span class="type">Int32</span>, <span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;&gt;) -&gt; <span class="type">Int32</span> &#123;</div><div class="line"><span class="comment">// %0                                             // user: %4</span></div><div class="line"><span class="comment">// %1                                             // user: %10</span></div><div class="line">bb0(%<span class="number">0</span> : $<span class="type">Int32</span>, %<span class="number">1</span> : $<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Optional</span>&lt;<span class="type">UnsafeMutablePointer</span>&lt;<span class="type">Int8</span>&gt;&gt;&gt;):</div><div class="line">  ...</div><div class="line">  <span class="comment">/*</span></div><div class="line">    å…¨å±€å˜é‡çš„å¼•ç”¨ä½¿ç”¨ä¸‰ä¸ªå…¥å£æ¥æ”¾ç½®ã€‚</div><div class="line">  */</div><div class="line">  %<span class="number">13</span> = global_addr @clos.c1 : $*aClass, loc <span class="string">"sample.swift"</span>:<span class="number">5</span>:<span class="number">5</span>, scope <span class="number">1</span> <span class="comment">// users: %26, %17</span></div><div class="line">  ...</div><div class="line">  %<span class="number">19</span> = global_addr @clos.c2 : $*aClass, loc <span class="string">"sample.swift"</span>:<span class="number">6</span>:<span class="number">5</span>, scope <span class="number">1</span> <span class="comment">// users: %32, %23</span></div><div class="line">  ...</div><div class="line">  %<span class="number">25</span> = global_addr @clos.fSpec : $*@callee_owned () -&gt; (), loc <span class="string">"sample.swift"</span>:<span class="number">8</span>:<span class="number">5</span>, scope <span class="number">1</span> <span class="comment">// users: %48, %45</span></div><div class="line">  <span class="comment">/*</span></div><div class="line">    c1 æ˜¯ unowned_retained çš„ã€‚</div><div class="line">    ä¸‹é¢çš„æŒ‡ä»¤å¢åŠ å˜é‡çš„ unowned å¼•ç”¨è®¡æ•°ã€‚</div><div class="line">  */</div><div class="line">  %<span class="number">26</span> = load %<span class="number">13</span> : $*aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// user: %27</span></div><div class="line">  %<span class="number">27</span> = ref_to_unowned %<span class="number">26</span> : $aClass to $@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// users: %47, %38, %39, %29, %28</span></div><div class="line">  unowned_retain %<span class="number">27</span> : $@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// id: %28</span></div><div class="line">  store %<span class="number">27</span> to %<span class="number">2</span> : $*@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">14</span>, scope <span class="number">2</span> <span class="comment">// id: %29</span></div><div class="line">  <span class="comment">/*</span></div><div class="line">    å¯¹ c2 çš„å¤„ç†ä¼šæ›´åŠ å¤æ‚ä¸€äº›ã€‚</div><div class="line">	alloc_box åˆ›å»ºäº†ä¸€ä¸ªè¿™ä¸ªå˜é‡çš„å¼•ç”¨æ•°å®¹å™¨ï¼Œå˜é‡å°†ä¼šå­˜åœ¨è¿™ä¸ªå®¹å™¨çš„å †ä¸­ã€‚</div><div class="line">    å®¹å™¨åˆ›å»ºä»¥åï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªå¯é€‰å˜é‡ï¼ŒæŒ‡å‘ c2ï¼Œå¹¶ä¸”å¯é€‰å˜é‡ä¼šå­˜å‚¨åœ¨å®¹å™¨é‡Œã€‚å®¹å™¨ä¼šå¢åŠ æ‰€åŒ…å«å€¼çš„æŠ€æœ¯ï¼Œæ­£å¦‚ä¸‹é¢çœ‹åˆ°çš„ä¸€æ ·ï¼Œä¸€æ—¦å®¹å™¨è¢«è¿ç§»ï¼Œå¯é€‰å€¼å°±ä¼šè¢«é‡Šæ”¾ã€‚</div><div class="line">    åœ¨è¿™é‡Œï¼Œc2 çš„å€¼å°†è¢«å­˜å‚¨åœ¨è¿™ä¸ªå¯é€‰å€¼ä¸­ï¼Œå¯¹è±¡å°†æš‚æ—¶strong_retained ç„¶åé‡Šæ”¾ã€‚</div><div class="line">  */</div><div class="line">  %<span class="number">30</span> = alloc_box $@sil_weak <span class="type">Optional</span>&lt;aClass&gt;, <span class="keyword">var</span>, name <span class="string">"c2"</span>, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// users: %46, %44, %43, %31</span></div><div class="line">  %<span class="number">31</span> = project_box %<span class="number">30</span> : $@box @sil_weak <span class="type">Optional</span>&lt;aClass&gt;, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// user: %35</span></div><div class="line">  %<span class="number">32</span> = load %<span class="number">19</span> : $*aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// users: %34, %33</span></div><div class="line">  strong_retain %<span class="number">32</span> : $aClass, loc <span class="string">"sample.swift"</span>:<span class="number">9</span>:<span class="number">23</span>, scope <span class="number">2</span> <span class="comment">// id: %33</span></div><div class="line">  %<span class="number">34</span> = <span class="class"><span class="keyword">enum</span> <span class="title">$Optional</span>&lt;<span class="title">aClass</span>&gt;, #<span class="title">Optional</span>.<span class="title">some</span>!<span class="title">enumelt</span>.1, %32 : <span class="title">$aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":9:23, <span class="title">scope</span> 2 // <span class="title">users</span>: %36, %35</span></div><div class="line">  <span class="title">store_weak</span> %34 <span class="title">to</span> [<span class="title">initialization</span>] %31 : <span class="title">$</span>*@<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":9:23, <span class="title">scope</span> 2 // <span class="title">id</span>: %35</div><div class="line">  <span class="title">release_value</span> %34 : <span class="title">$Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":9:23, <span class="title">scope</span> 2 // <span class="title">id</span>: %36</div><div class="line">  /*</div><div class="line">    è·å–åˆ°é—­åŒ…çš„å¼•ç”¨ã€‚</div><div class="line">  */</div><div class="line">  // <span class="title">function_ref</span> (<span class="title">closure</span> #1)</div><div class="line">  %37 = <span class="title">function_ref</span> @<span class="title">sample</span>.(<span class="title">closure</span> #1) : <span class="title">$</span>@<span class="title">convention</span>(<span class="title">thin</span>) (@<span class="title">owned</span> @<span class="title">sil_unowned</span> <span class="title">aClass</span>, @<span class="title">owned</span> @<span class="title">box</span> @<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">user</span>: %44</div><div class="line">  /*</div><div class="line">    <span class="title">c1</span> å°†è¢«æ ‡è®°ä¸º <span class="title">tagged</span>ï¼Œå¹¶ä¸”å˜é‡å˜ä¸º <span class="title">unowned_retained</span>ã€‚</div><div class="line">  */</div><div class="line">  <span class="title">strong_retain_unowned</span> %27 : <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">id</span>: %38</div><div class="line">  %39 = <span class="title">unowned_to_ref</span> %27 : <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span> <span class="title">to</span> <span class="title">$aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">users</span>: %42, %40</div><div class="line">  %40 = <span class="title">ref_to_unowned</span> %39 : <span class="title">$aClass</span> <span class="title">to</span> <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">users</span>: %44, %41</div><div class="line">  <span class="title">unowned_retain</span> %40 : <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">id</span>: %41</div><div class="line">  <span class="title">strong_release</span> %39 : <span class="title">$aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">id</span>: %42</div><div class="line">  /*</div><div class="line">    åŒ…å« <span class="title">c2</span> çš„å¯é€‰å€¼å®¹å™¨æ˜¯ <span class="title">strong_retained</span> çš„ã€‚</div><div class="line">  */</div><div class="line">  <span class="title">strong_retain</span> %30 : <span class="title">$</span>@<span class="title">box</span> @<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">id</span>: %43</div><div class="line">  /*</div><div class="line">    åˆ›å»ºä¸€ä¸ªé—­åŒ…å¯¹è±¡ï¼Œç»‘å®šæ–¹æ³•åˆ°å‚æ•°ä¸­ã€‚</div><div class="line">  */</div><div class="line">  %44 = <span class="title">partial_apply</span> %37(%40, %30) : <span class="title">$</span>@<span class="title">convention</span>(<span class="title">thin</span>) (@<span class="title">owned</span> @<span class="title">sil_unowned</span> <span class="title">aClass</span>, @<span class="title">owned</span> @<span class="title">box</span> @<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">user</span>: %45</div><div class="line">  <span class="title">store</span> %44 <span class="title">to</span> %25 : <span class="title">$</span>*@<span class="title">callee_owned</span> () -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":8:13, <span class="title">scope</span> 2 // <span class="title">id</span>: %45</div><div class="line">  /*</div><div class="line">    </div><div class="line">    å¯¹ <span class="title">c1</span> å’Œ <span class="title">c2</span> çš„å®¹å™¨å˜é‡è¿›è¡Œé‡Šæ”¾ï¼ˆä½¿ç”¨ å¯¹åº”åŒ¹é…çš„ *<span class="title">_release</span> æ–¹æ³•ï¼‰ã€‚</div><div class="line">  */</div><div class="line">  <span class="title">strong_release</span> %30 : <span class="title">$</span>@<span class="title">box</span> @<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":14:1, <span class="title">scope</span> 2 // <span class="title">id</span>: %46</div><div class="line">  <span class="title">unowned_release</span> %27 : <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":9:14, <span class="title">scope</span> 2 // <span class="title">id</span>: %47</div><div class="line">  /*</div><div class="line">     åŠ è½½åŸå…ˆå­˜å‚¨çš„é—­åŒ…å¯¹è±¡ï¼Œå¢åŠ å¼ºå¼•ç”¨ç„¶åè°ƒç”¨å®ƒã€‚</div><div class="line">  */</div><div class="line">   %48 = <span class="title">load</span> %25 : <span class="title">$</span>*@<span class="title">callee_owned</span> () -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":17:1, <span class="title">scope</span> 2 // <span class="title">users</span>: %50, %49</div><div class="line">  <span class="title">strong_retain</span> %48 : <span class="title">$</span>@<span class="title">callee_owned</span> () -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":17:1, <span class="title">scope</span> 2 // <span class="title">id</span>: %49</div><div class="line">  %50 = <span class="title">apply</span> %48() : <span class="title">$</span>@<span class="title">callee_owned</span> () -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":17:7, <span class="title">scope</span> 2</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é—­åŒ…æœ‰ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ç»“æ„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">  é—­åŒ…å‚æ•°è¢«æ ‡è®°ä¸º @sil, æŒ‡å®šå‚æ•°å¦‚ä½•è¢«è®¡æ•°ï¼Œæœ‰ä¸€ä¸ª unowned çš„ aClass ç±»å˜é‡ c2, å’Œå¦å¤–ä¸€ä¸ªåŒ…å« c2 çš„å¯é€‰å€¼å®¹å™¨ã€‚</div><div class="line">*/</div><div class="line"><span class="comment">// (closure #1)</span></div><div class="line">sil shared @clos.fSpec: $<span class="meta">@convention</span>(thin) (@owned @sil_unowned aClass, @owned @box @sil_weak <span class="type">Optional</span>&lt;aClass&gt;) -&gt; () &#123;</div><div class="line"><span class="comment">// %0                                             // users: %24, %6, %5, %2</span></div><div class="line"><span class="comment">// %1                                             // users: %23, %3</span></div><div class="line"><span class="comment">/*</span></div><div class="line">  ä¸‹é¢çš„å‡½æ•°åŒ…å«ä¸‰å—ï¼Œåé¢ä¸¤å—çš„æ‰§è¡Œä¾èµ–å¯é€‰å€¼ c2 å…·ä½“çš„å€¼ã€‚</div><div class="line">*/</div><div class="line">bb0(%<span class="number">0</span> : $@sil_unowned aClass, %<span class="number">1</span> : $@box @sil_weak <span class="type">Optional</span>&lt;aClass&gt;):</div><div class="line">...</div><div class="line">  <span class="comment">/*</span></div><div class="line">    c1 è¢«å¼ºè®¡æ•°ã€‚</div><div class="line">  */</div><div class="line">  strong_retain_unowned %<span class="number">0</span> : $@sil_unowned aClass, loc <span class="string">"sample.swift"</span>:<span class="number">10</span>:<span class="number">5</span>, scope <span class="number">17</span> <span class="comment">// id: %5</span></div><div class="line">  %<span class="number">6</span> = unowned_to_ref %<span class="number">0</span> : $@sil_unowned aClass to $aClass, loc <span class="string">"sample.swift"</span>:<span class="number">10</span>:<span class="number">5</span>, scope <span class="number">17</span> <span class="comment">// users: %11, %10, %9</span></div><div class="line">  <span class="comment">/*</span></div><div class="line">    ä½¿ç”¨å†…éƒ¨è‡ªå¸¦åŒ…ï¼Œä¼ å…¥ä¸€ä¸ªæ•´å‹å­—é¢é‡åˆ°æ•´å‹ç»“æ„ä¸­ï¼Œåˆå§‹åŒ–äº†ä¸€ä¸ªå€¼ä¸º 42 çš„æ•´å‹å€¼ã€‚</div><div class="line">    è¿™ä¸ªå€¼å°†è¢«è®¾ç½®ä¸º c1 çš„æ–°å€¼ï¼Œå®Œæˆä»¥åè¿™ä¸ªå˜é‡å°†ä¼šè¢«é‡Šæ”¾ã€‚</div><div class="line">    åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡çœ‹åˆ° class_method æŒ‡ä»¤ï¼Œç”¨äºè·å– vtable ä¸­çš„å‡½æ•°å¼•ç”¨ã€‚</div><div class="line">  */</div><div class="line">  %<span class="number">7</span> = integer_literal $<span class="type">Builtin</span>.<span class="type">Int64</span>, <span class="number">42</span>, loc <span class="string">"sample.swift"</span>:<span class="number">10</span>:<span class="number">16</span>, scope <span class="number">17</span> <span class="comment">// user: %8</span></div><div class="line">  %<span class="number">8</span> = <span class="class"><span class="keyword">struct</span> <span class="title">$Int</span> (%7 : <span class="title">$Builtin</span>.<span class="title">Int64</span>), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":10:16, <span class="title">scope</span> 17 // <span class="title">user</span>: %10</span></div><div class="line">  %9 = <span class="title">class_method</span> %6 : <span class="title">$aClass</span>, #<span class="title">aClass</span>.<span class="title">value</span>!<span class="title">setter</span>.1 : (<span class="title">aClass</span>) -&gt; (<span class="title">Int</span>) -&gt; () , <span class="title">$</span>@<span class="title">convention</span>(<span class="title">method</span>) (<span class="title">Int</span>, @<span class="title">guaranteed</span> <span class="title">aClass</span>) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":10:14, <span class="title">scope</span> 17 // <span class="title">user</span>: %10</div><div class="line">  %10 = <span class="title">apply</span> %9(%8, %6) : <span class="title">$</span>@<span class="title">convention</span>(<span class="title">method</span>) (<span class="title">Int</span>, @<span class="title">guaranteed</span> <span class="title">aClass</span>) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":10:14, <span class="title">scope</span> 17</div><div class="line">  <span class="title">strong_release</span> %6 : <span class="title">$aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":10:16, <span class="title">scope</span> 17 // <span class="title">id</span>: %11</div><div class="line">  /*</div><div class="line">    æ¥ä¸‹æ¥è®¨è®º <span class="title">c2</span>ã€‚</div><div class="line">    è·å–å¯é€‰å€¼ï¼Œç„¶åæ ¹æ®å®ƒçš„å†…å®¹æ‰§è¡Œæ¥ä¸‹æ¥çš„åˆ†æ”¯è¯­å¥ã€‚</div><div class="line"></div><div class="line">    <span class="title">If</span> <span class="title">the</span> <span class="title">optional</span> <span class="title">has</span> <span class="title">a</span> <span class="title">value</span> <span class="title">the</span> <span class="title">bb2</span> <span class="title">block</span> <span class="title">will</span> <span class="title">be</span> <span class="title">executed</span> <span class="title">before</span> <span class="title">jumping</span> </div><div class="line">    <span class="title">to</span> <span class="title">bb3</span>, <span class="title">if</span> <span class="title">it</span> <span class="title">doesn</span>'<span class="title">t</span> <span class="title">after</span> <span class="title">a</span> <span class="title">brief</span> <span class="title">jump</span> <span class="title">to</span> <span class="title">bb1</span>, <span class="title">the</span> <span class="title">function</span> <span class="title">will</span> <span class="title">proceed</span> <span class="title">to</span> <span class="title">bb3</span> <span class="title">releasing</span></div><div class="line">    <span class="title">the</span> <span class="title">retained</span> <span class="title">parameters</span>.</div><div class="line">    </div><div class="line">  */</div><div class="line">  %12 = <span class="title">load_weak</span> %3 : <span class="title">$</span>*@<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":11:18, <span class="title">scope</span> 18 // <span class="title">user</span>: %13</div><div class="line">  <span class="title">switch_enum</span> %12 : <span class="title">$Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">case</span> #<span class="title">Optional</span>.<span class="title">some</span>!<span class="title">enumelt</span>.1: <span class="title">bb2</span>, <span class="title">default</span> <span class="title">bb1</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":11:18, <span class="title">scope</span> 18 // <span class="title">id</span>: %13</div><div class="line">  <span class="title">bb1</span>:                                              // <span class="title">Preds</span>: <span class="title">bb0</span></div><div class="line">  /*</div><div class="line">    è·³è½¬åˆ°é—­åŒ…çš„ç»“å°¾ã€‚</div><div class="line">  */</div><div class="line">  <span class="title">br</span> <span class="title">bb3</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":11:18, <span class="title">scope</span> 16        // <span class="title">id</span>: %14</div><div class="line"></div><div class="line">// %15                                            // <span class="title">users</span>: %21, %20, %19, %16</div><div class="line"><span class="title">bb2</span>(%15 : <span class="title">$aClass</span>):                               // <span class="title">Preds</span>: <span class="title">bb0</span></div><div class="line">  /*</div><div class="line">    è°ƒç”¨ <span class="title">aClass</span> çš„ <span class="title">setter</span>ï¼Œè®¾ç½®å®ƒçš„å€¼ä¸º 42.</div><div class="line">  */</div><div class="line">  ...</div><div class="line">  %17 = <span class="title">integer_literal</span> <span class="title">$Builtin</span>.<span class="title">Int64</span>, 42, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":12:21, <span class="title">scope</span> 19 // <span class="title">user</span>: %18</div><div class="line">  %18 = <span class="title">struct</span> <span class="title">$Int</span> (%17 : <span class="title">$Builtin</span>.<span class="title">Int64</span>), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":12:21, <span class="title">scope</span> 19 // <span class="title">user</span>: %20</div><div class="line">  %19 = <span class="title">class_method</span> %15 : <span class="title">$aClass</span>, #<span class="title">aClass</span>.<span class="title">value</span>!<span class="title">setter</span>.1 : (<span class="title">aClass</span>) -&gt; (<span class="title">Int</span>) -&gt; () , <span class="title">$</span>@<span class="title">convention</span>(<span class="title">method</span>) (<span class="title">Int</span>, @<span class="title">guaranteed</span> <span class="title">aClass</span>) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":12:19, <span class="title">scope</span> 19 // <span class="title">user</span>: %20</div><div class="line">  %20 = <span class="title">apply</span> %19(%18, %15) : <span class="title">$</span>@<span class="title">convention</span>(<span class="title">method</span>) (<span class="title">Int</span>, @<span class="title">guaranteed</span> <span class="title">aClass</span>) -&gt; (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":12:19, <span class="title">scope</span> 19</div><div class="line">  <span class="title">strong_release</span> %15 : <span class="title">$aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":13:5, <span class="title">scope</span> 18 // <span class="title">id</span>: %21</div><div class="line">  <span class="title">br</span> <span class="title">bb3</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":13:5, <span class="title">scope</span> 18         // <span class="title">id</span>: %22</div><div class="line"></div><div class="line"><span class="title">bb3</span>:                                              // <span class="title">Preds</span>: <span class="title">bb1</span> <span class="title">bb2</span></div><div class="line">  /*</div><div class="line">    é‡Šæ”¾æ‰€æœ‰è·å–çš„å˜é‡ç„¶åè¿”å›ã€‚</div><div class="line">  */</div><div class="line">  <span class="title">strong_release</span> %1 : <span class="title">$</span>@<span class="title">box</span> @<span class="title">sil_weak</span> <span class="title">Optional</span>&lt;<span class="title">aClass</span>&gt;, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":14:1, <span class="title">scope</span> 17 // <span class="title">id</span>: %23</div><div class="line">  <span class="title">unowned_release</span> %0 : <span class="title">$</span>@<span class="title">sil_unowned</span> <span class="title">aClass</span>, <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":14:1, <span class="title">scope</span> 17 // <span class="title">id</span>: %24</div><div class="line">  %25 = <span class="title">tuple</span> (), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":14:1, <span class="title">scope</span> 17 // <span class="title">user</span>: %26</div><div class="line">  <span class="title">return</span> %25 : <span class="title">$</span>(), <span class="title">loc</span> "<span class="title">sample</span>.<span class="title">swift</span>":14:1, <span class="title">scope</span> 17 // <span class="title">id</span>: %26</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œå¿½ç•¥æ‰ä¸åŒçš„ ARC æŒ‡ä»¤å¸¦æ¥çš„æ€§èƒ½çš„å·®å¼‚ç‚¹ï¼Œå¯¹ä¸åŒé˜¶æ®µæ¯ç§ç±»å‹çš„æ•è·å˜é‡åšä¸€ä¸ªå¿«é€Ÿçš„å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th>åŠ¨ä½œ</th>
<th>Unowned</th>
<th>Weak</th>
</tr>
</thead>
<tbody>
<tr>
<td>é¢„å…ˆè°ƒç”¨ #1</td>
<td>å¯¹è±¡è¿›è¡Œ unowned_retain</td>
<td>åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶ä¸”å¯¹è±¡è¿›è¡Œ strong_retain æ“ä½œã€‚åˆ›å»ºä¸€ä¸ªå¯é€‰å€¼ï¼Œå­˜å…¥åˆ°å®¹å™¨ä¸­ï¼Œç„¶åé‡Šæ”¾å¯é€‰å€¼</td>
</tr>
<tr>
<td>é¢„å…ˆè°ƒç”¨ #2</td>
<td>strong_retain_unownedï¼Œunowned_retain å’Œ strong_release</td>
<td>strong_retain</td>
</tr>
<tr>
<td>é—­åŒ…æ‰§è¡Œ</td>
<td>strong_retain_unownedï¼Œunowned_release</td>
<td>load_weak, æ‰“å¼€å¯é€‰å€¼, strong_release</td>
</tr>
<tr>
<td>è°ƒç”¨ä¹‹å</td>
<td>unowned_release</td>
<td>strong_release</td>
</tr>
</tbody>
</table>
<p>æ­£å¦‚ä¸Šé¢çœ‹åˆ°çš„ SIL ä»£ç æ®µé‚£æ ·ï¼Œå¤„ç† weak å¼•ç”¨ä¼šæ¶‰åŠåˆ°æ›´å¤šçš„å·¥ä½œï¼Œå› ä¸ºéœ€è¦å¤„ç†å¼•ç”¨éœ€è¦çš„å¯é€‰å€¼ã€‚</p>
<p>å‚ç…§å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼Œè¿™é‡Œå¯¹æ¶‰åŠåˆ°çš„æ‰€æœ‰ ARC æŒ‡ä»¤åšä¸€ä¸ªç®€è¦çš„è§£é‡Šï¼š</p>
<ul>
<li>unowned_retainï¼šå¢åŠ å †å¯¹è±¡ä¸­çš„ unowned å¼•ç”¨è®¡æ•°ã€‚</li>
<li>strong_retain_unowned ï¼šæ–­è¨€å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°å¤§äº 0ï¼Œç„¶åå¢åŠ è¿™ä¸ªå¼•ç”¨è®¡æ•°ã€‚</li>
<li>strong_retainï¼šå¢åŠ å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°ã€‚</li>
<li>load_weakï¼šä¸æ˜¯çœŸæ­£çš„ ARC è°ƒç”¨ï¼Œä½†æ˜¯å®ƒå°†å¢åŠ å¯é€‰å€¼æŒ‡å‘å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°ã€‚</li>
<li>strong_releaseï¼šå‡å°‘å¯¹è±¡çš„å¼ºå¼•ç”¨è®¡æ•°ã€‚å¦‚æœé‡Šæ”¾æ“ä½œæŠŠå¯¹è±¡å¼ºå¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œå¯¹è±¡å°†è¢«é”€æ¯ï¼Œç„¶åå¼±å¼•ç”¨å°†è¢«æ¸…é™¤ã€‚å½“æ•´ä¸ªå¼ºå¼•ç”¨è®¡æ•°å’Œ unowned å¼•ç”¨è®¡æ•°éƒ½ä¸º0æ—¶ï¼Œå¯¹è±¡çš„å†…å­˜æ‰ä¼šè¢«é‡Šæ”¾ã€‚</li>
<li>unowned_releaseï¼šå‡å°‘å¯¹è±¡çš„ unowned å¼•ç”¨è®¡æ•°ã€‚å½“æ•´ä¸ªå¼ºå¼•ç”¨è®¡æ•°å’Œ unowned å¼•ç”¨è®¡æ•°éƒ½ä¸º 0 æ—¶ï¼Œå¯¹è±¡çš„å†…å­˜æ‰ä¼šè¢«é‡Šæ”¾ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥æ·±å…¥åˆ° Swift è¿è¡Œæ—¶çœ‹çœ‹ï¼Œè¿™äº›æŒ‡ä»¤éƒ½æ˜¯å¦‚ä½•è¢«å®ç°çš„ï¼Œç›¸å…³çš„ä»£ç æ–‡ä»¶æœ‰ï¼šHeapObject.cppï¼ŒHeapObject.hï¼ŒRefCount.h å’Œ Heap.cppã€ SwiftObject.mm ä¸­çš„å°‘é‡å®šä¹‰ã€‚å®¹å™¨å®ç°å¯ä»¥åœ¨ MetadataImpl.h æ‰¾åˆ°ï¼Œä½†æ˜¯æœ¬æ–‡ä¸å±•å¼€è®¨è®ºã€‚</p>
<p>è¿™äº›æ–‡ä»¶ä¸­å®šä¹‰å¤§å¤šæ•°çš„ ARC æ–¹æ³•éƒ½æœ‰ä¸‰ç§å˜ä½“ï¼Œä¸€ç§æ˜¯å¯¹ Swift å¯¹è±¡çš„åŸºç¡€å®ç°ï¼Œå¦å¤–ä¸¤ç§å®ç°æ˜¯é’ˆå¯¹éåŸç”Ÿ Swift å¯¹è±¡çš„ï¼šæ¡¥æ¥å¯¹è±¡å’ŒæœªçŸ¥å¯¹è±¡ã€‚åé¢ä¸¤ç§å˜ä½“è¿™é‡Œä¸äºˆè®¨è®ºã€‚</p>
<p>ç¬¬ä¸€ä¸ªè®¨è®ºæŒ‡ä»¤é›†å’Œ unowned å¼•ç”¨ç›¸å…³ã€‚</p>
<p>åœ¨ HeapObject.cpp æ–‡ä»¶ä¸­é—´å¯ä»¥çœ‹åˆ°å¯¹ unowned_retain å’Œ unowned_release çš„å®ç°æ–¹æ³•ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="type">SWIFT_RT_ENTRY_VISIBILITY</span></div><div class="line">void swift::swift_unownedRetain(<span class="type">HeapObject</span> *object)</div><div class="line">    <span class="type">SWIFT_CC</span>(<span class="type">RegisterPreservingCC_IMPL</span>) &#123;</div><div class="line">  <span class="keyword">if</span> (!object)</div><div class="line">    <span class="keyword">return</span>;</div><div class="line"></div><div class="line">  object-&gt;weakRefCount.increment();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="type">SWIFT_RT_ENTRY_VISIBILITY</span></div><div class="line">void swift::swift_unownedRelease(<span class="type">HeapObject</span> *object)</div><div class="line">    <span class="type">SWIFT_CC</span>(<span class="type">RegisterPreservingCC_IMPL</span>) &#123;</div><div class="line">  <span class="keyword">if</span> (!object)</div><div class="line">    <span class="keyword">return</span>;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (object-&gt;weakRefCount.decrementShouldDeallocate()) &#123;</div><div class="line">    <span class="comment">// Only class objects can be weak-retained and weak-released.</span></div><div class="line">    auto metadata = object-&gt;metadata;</div><div class="line">    <span class="built_in">assert</span>(metadata-&gt;isClassObject());</div><div class="line">    auto classMetadata = static_cast&lt;const <span class="type">ClassMetadata</span>*&gt;(metadata);</div><div class="line">    <span class="built_in">assert</span>(classMetadata-&gt;isTypeMetadata());</div><div class="line">    <span class="type">SWIFT_RT_ENTRY_CALL</span>(swift_slowDealloc)</div><div class="line">        (object, classMetadata-&gt;getInstanceSize(),</div><div class="line">         classMetadata-&gt;getInstanceAlignMask());</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>swift_unownedRetain æ˜¯ unowned_retain çš„å…·ä½“å®ç°ï¼Œç®€å•åœ°è¿›è¡Œ unowned å¼•ç”¨è®¡æ•°çš„åŸå­å¢åŠ æ“ä½œï¼ˆè¿™é‡Œå®šä¹‰ä¸ºweakRefCountï¼‰ï¼Œswift_unownedRelease æ›´åŠ å¤æ‚ï¼ŒåŸå› ä¹‹å‰ä¹Ÿæè¿°è¿‡ï¼Œå½“æ²¡æœ‰å…¶ä»– unowned å¼•ç”¨å­˜åœ¨æ—¶ï¼Œå®ƒéœ€è¦æ‰§è¡Œå¯¹è±¡çš„ææ„æ“ä½œã€‚</p>
<p>ä½†æ˜¯æ•´ä½“æ¥è®²éƒ½ä¸å¤æ‚ï¼Œåœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ° doDecrementShouldDeallocate æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ä¸Šé¢ä»£ç ä¸­è¢«ä¸€ä¸ªå‘½åç±»ä¼¼çš„æ–¹æ³•è°ƒç”¨äº†ã€‚è¿™ä¸ªæ–¹æ³•æ²¡æœ‰åšå¤ªå¤šï¼Œswift_slowDealloc åªæ˜¯é‡Šæ”¾ç»™å®šçš„æŒ‡é’ˆã€‚</p>
<p>åˆ°æ­¤å·²ç»æœ‰äº†ä¸€ä¸ªå¯¹è±¡çš„ unowned å¼•ç”¨ï¼Œå¦å¤–ä¸€ä¸ªæŒ‡ä»¤ï¼Œstrong_retain_unowned ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¼ºå¼•ç”¨ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="type">SWIFT_RT_ENTRY_VISIBILITY</span></div><div class="line">void swift::swift_unownedRetainStrong(<span class="type">HeapObject</span> *object)</div><div class="line">    <span class="type">SWIFT_CC</span>(<span class="type">RegisterPreservingCC_IMPL</span>) &#123;</div><div class="line">  <span class="keyword">if</span> (!object)</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">  <span class="built_in">assert</span>(object-&gt;weakRefCount.getCount() &amp;&amp;</div><div class="line">         <span class="string">"object is not currently weakly retained"</span>);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (! object-&gt;refCount.tryIncrement())</div><div class="line">    _swift_abortRetainUnowned(object);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å› ä¸ºå¼±å¼•ç”¨åº”è¯¥æŒ‡å‘äº†è¿™ä¸ªå¯¹è±¡ï¼Œè¦ä½¿ç”¨æ–­è¨€æ¥éªŒè¯å¯¹è±¡æ˜¯å¦è¢«å¼±å¼•ç”¨ï¼Œä¸€æ—¦æ–­è¨€é€šè¿‡ï¼Œå°†å°è¯•è¿›è¡Œå¢åŠ å¼ºå¼•ç”¨è®¡æ•°çš„æ“ä½œã€‚ä¸€æ—¦å¯¹è±¡åœ¨è¿›ç¨‹ä¸­å·²ç»è¢«é‡Šæ”¾ï¼Œå°è¯•å°†ä¼šå¤±è´¥ã€‚</p>
<p>æ‰€æœ‰ç±»ä¼¼äº tryIncrement é€šè¿‡æŸç§å½¢å¼ä¿®æ”¹å¼•ç”¨è®¡æ•°çš„æ–¹æ³•éƒ½æ”¾åˆ° RefCount.h ä¸­ï¼Œéœ€è¦ä½¿ç”¨åŸå­æ“ä½œè¿›è¡Œè¿™äº›ä»»åŠ¡ã€‚</p>
<p>æ¥ä¸‹æ¥è®¨è®ºä¸‹ weak å¼•ç”¨çš„çš„å®ç°ï¼Œæ­£å¦‚ä¹‹å‰çœ‹åˆ°çš„é‚£æ ·ï¼Œswift_weakLoadStrong ç”¨æ¥è·å–å®¹å™¨ä¸­å¯é€‰å€¼ä¸­å¼ºå¼•ç”¨çš„å¯¹è±¡ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="type">HeapObject</span> *swift::swift_weakLoadStrong(<span class="type">WeakReference</span> *ref) &#123;</div><div class="line">  <span class="keyword">if</span> (ref-&gt;<span class="type">Value</span> == (uintptr_t)nullptr) &#123;</div><div class="line">    <span class="keyword">return</span> nullptr;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// ref å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®</span></div><div class="line">  auto ptr = __atomic_fetch_or(&amp;ref-&gt;<span class="type">Value</span>, <span class="type">WR_READING</span>, __ATOMIC_RELAXED);</div><div class="line">  <span class="keyword">while</span> (ptr &amp; <span class="type">WR_READING</span>) &#123;</div><div class="line">    short <span class="built_in">c</span> = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (__atomic_load_n(&amp;ref-&gt;<span class="type">Value</span>, __ATOMIC_RELAXED) &amp; <span class="type">WR_READING</span>) &#123;</div><div class="line">      <span class="keyword">if</span> (++<span class="built_in">c</span> == <span class="type">WR_SPINLIMIT</span>) &#123;</div><div class="line">        std::this_thread::yield();</div><div class="line">        <span class="built_in">c</span> -= <span class="number">1</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    ptr = __atomic_fetch_or(&amp;ref-&gt;<span class="type">Value</span>, <span class="type">WR_READING</span>, __ATOMIC_RELAXED);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  auto object = (<span class="type">HeapObject</span>*)(ptr &amp; ~<span class="type">WR_NATIVE</span>);</div><div class="line">  <span class="keyword">if</span> (object == nullptr) &#123;</div><div class="line">    __atomic_store_n(&amp;ref-&gt;<span class="type">Value</span>, (uintptr_t)nullptr, __ATOMIC_RELAXED);</div><div class="line">    <span class="keyword">return</span> nullptr;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (object-&gt;refCount.isDeallocating()) &#123;</div><div class="line">    __atomic_store_n(&amp;ref-&gt;<span class="type">Value</span>, (uintptr_t)nullptr, __ATOMIC_RELAXED);</div><div class="line">    <span class="type">SWIFT_RT_ENTRY_CALL</span>(swift_unownedRelease)(object);</div><div class="line">    <span class="keyword">return</span> nullptr;</div><div class="line">  &#125;</div><div class="line">  auto result = swift_tryRetain(object);</div><div class="line">  __atomic_store_n(&amp;ref-&gt;<span class="type">Value</span>, ptr, __ATOMIC_RELAXED);</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œè·å–ä¸€ä¸ªå¼ºå¼•ç”¨éœ€è¦æ›´å¤šå¤æ‚åŒæ­¥æ“ä½œï¼Œåœ¨å¤šçº¿ç¨‹ç«äº‰ä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œä¼šå¸¦æ¥æ€§èƒ½æŸè€—ã€‚</p>
<p>åœ¨è¿™é‡Œç¬¬ä¸€æ¬¡å‡ºç°çš„ WeakReference å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªç®€å•çš„ç»“æ„ä½“ï¼ŒåŒ…å«ä¸€ä¸ªæ•´å‹å€¼å­—æ®µæŒ‡å‘ç›®æ ‡å¯¹è±¡ï¼Œç›®æ ‡å¯¹è±¡æ˜¯ä½¿ç”¨ HeapObject ç±»æ¥æ‰¿è½½çš„æ¯ä¸€ä¸ªè¿è¡Œæ—¶çš„ Swift å¯¹è±¡ã€‚</p>
<p>åœ¨ weak å¼•ç”¨è¯¢é—®å½“å‰çº¿ç¨‹è®¾ç½®çš„ WR_READING æ ‡è¯†ä¹‹åï¼Œä» WeakReference å®¹å™¨ä¸­è·å– Swift å¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸å†æœ‰æ•ˆï¼Œæˆ–è€…åœ¨ç­‰å¾…è·å–èµ„æºæ—¶ï¼Œå®ƒå˜æˆå¯ä»¥è¿›è¡Œææ„ï¼Œå½“å‰çš„å¼•ç”¨ä¼šè¢«è®¾ç½®ä¸º nullã€‚</p>
<p>å¦‚æœå¯¹è±¡ä¾ç„¶æœ‰æ•ˆï¼Œè·å–å¯¹è±¡çš„å°è¯•å°†ä¼šæˆåŠŸã€‚</p>
<p>å› æ­¤ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è®²ï¼Œå¯¹ weak å¼•ç”¨çš„å¸¸è§„æ“ä½œæ€§èƒ½æ¯” unowned å¼•ç”¨çš„æ›´ä½ï¼ˆä½†æ˜¯ä¸»è¦çš„é—®é¢˜è¿˜æ˜¯åœ¨å¯é€‰å€¼æ“ä½œä¸Šé¢ï¼‰ã€‚</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ä¿å®ˆçš„ä½¿ç”¨ weak å¼•ç”¨æ˜¯å¦æ˜æ™ºå‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œæ— è®ºæ˜¯ä»æ€§èƒ½çš„è§’åº¦è¿˜æ˜¯ä»£ç æ¸…æ™°çš„è§’åº¦è€Œè¨€ã€‚</p>
<p>ä½¿ç”¨æ­£ç¡®çš„æ•è·ä¿®é¥°ç¬¦ç±»å‹ï¼Œæ˜ç¡®çš„è¡¨æ˜ä»£ç ä¸­çš„ç”Ÿå‘½å‘¨æœŸç‰¹æ€§ï¼Œå½“å…¶ä»–äººæˆ–è€…ä½ è‡ªå·±åœ¨è¯»ä½ çš„ä»£ç æ—¶ä¸å®¹æ˜“è¯¯è§£ã€‚</p>
<h2 id="è„šæ³¨"><a href="#è„šæ³¨" class="headerlink" title="è„šæ³¨"></a>è„šæ³¨</h2><p>1ã€è‹¹æœç¬¬ä¸€æ¬¡è®¨è®º weak/unowned äº‰è®®å¯ä»¥æŸ¥çœ‹è¿™é‡Œï¼Œä¹‹ååœ¨ twitter ä¸Š Joe Groff å¯¹æ­¤ä¹Ÿè¿›è¡Œäº†è®¨è®ºï¼Œå¹¶ä¸”è¢« Michael Tsai æ€»ç»“æˆæ–‡ã€‚<br>è¿™ç¯‡æ–‡ç« ä»æ„å›¾è§’åº¦å‡ºå‘ï¼Œæä¾›äº†å®Œæ•´å¹¶ä¸”å¯æ“ä½œçš„è§£é‡Šã€‚</p>
<p>2ã€ä»ç»´åŸºç™¾ç§‘ä¸­å¯ä»¥æ‰¾åˆ°å…³äº AST çš„è§£é‡Šï¼Œè¿˜å¯ä»¥ä» Slava Pestov çš„è¿™ç¯‡æ–‡ç« ä¸­çœ‹åˆ°å…³äº Swift ç¼–è¯‘å™¨ä¸­å¦‚ä½•å®ç° AST çš„ä¸€äº›ç»†èŠ‚ã€‚</p>
<p>3ã€å…³äº SIL çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹è¯¦å°½çš„å®˜æ–¹ SIL æŒ‡å—ï¼Œè¿˜æœ‰ 2015 LLVM å¼€å‘è€…ä¼šè®®çš„è§†é¢‘ã€‚Lex Chou å†™çš„ SIL å¿«é€ŸæŒ‡å—å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ã€‚</p>
<p>4ã€æŸ¥çœ‹åœ¨ Swift ä¸­å¦‚ä½•è¿›è¡Œåç§°ç²‰ç¢ï¼ˆname manglingï¼‰çš„ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹ Lex Chou çš„è¿™ç¯‡æ–‡ç« ã€‚</p>
<p>5ã€Mike Ash åœ¨ä»–çš„ Friday Q&amp;A ä¸­çš„ä¸€ç¯‡æ–‡ç« ä¸­è®¨è®ºäº†å¦‚ä½•å®ç° weak å¼•ç”¨çš„ä¸€ç§å®è·µæ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•ä¸ç›®å‰ Swift çš„æ–¹æ³•å¯¹æ¯”èµ·æ¥æœ‰ä¸€äº›è¿‡æ—¶ï¼Œä½†æ˜¯å…¶ä¸­çš„è§£é‡Šä¾ç„¶å€¼å¾—å‚è€ƒã€‚</p>
<blockquote>
<p>æœ¬æ–‡ç”± SwiftGG ç¿»è¯‘ç»„ç¿»è¯‘ï¼Œå·²ç»è·å¾—ä½œè€…ç¿»è¯‘æˆæƒï¼Œæœ€æ–°æ–‡ç« è¯·è®¿é—® <a href="http://swift.ggã€‚" target="_blank" rel="external">http://swift.ggã€‚</a></p>
</blockquote>
<hr>
<p>æ–‡ç« è½¬è‡ª <a href="http://swift.gg/2017/05/16/unowned-or-weak-lifetime-and-performance/" target="_blank" rel="external">SwiftGG</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šUmberto Raimondiï¼ŒåŸæ–‡é“¾æ¥ï¼ŒåŸæ–‡æ—¥æœŸï¼š2016-10-27&lt;br&gt;è¯‘è€…ï¼šshanksï¼›æ ¡å¯¹ï¼šCrystal Sunï¼›å®šç¨¿ï¼šCMB&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯å½“å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆretain cyclesï¼‰æ—¶ï¼Œéœ€è¦è€ƒé‡å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæ¥é€‰æ‹©unownedæˆ–è€…weakæ ‡è¯†ç¬¦ï¼Œè¿™å·²ç»æˆä¸ºäº†ä¸€ä¸ªå…±è¯†ã€‚ä½†æ˜¯æœ‰æ—¶ä»ç„¶ä¼šå¿ƒå­˜ç–‘é—®ï¼Œåœ¨å…·ä½“çš„ä½¿ç”¨ä¸­åº”è¯¥é€‰æ‹©å“ªä¸€ä¸ªï¼Œæˆ–è€…é€€ä¸€æ­¥è®²ï¼Œä¿å®ˆçš„åªä½¿ç”¨ weak æ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡é¦–å…ˆå¯¹å¾ªç¯å¼•ç”¨çš„åŸºç¡€çŸ¥è¯†åšä¸€ä¸ªç®€è¦ä»‹ç»ï¼Œç„¶åä¼šåˆ†æ Swift æºä»£ç çš„ä¸€äº›ç‰‡æ®µï¼Œè®²è§£ unowned å’Œ weak åœ¨ç”Ÿå‘½å‘¨æœŸå’Œæ€§èƒ½ä¸Šçš„å·®å¼‚ç‚¹ï¼Œå¸Œæœ›çœ‹å®Œæœ¬æ–‡ä»¥åï¼Œåœ¨çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œèƒ½ä½¿ç”¨æ­£ç¡®çš„å¼±å¼•ç”¨ç±»å‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="Unownedä¸Weak" scheme="https://madordie.github.io/tags/Unowned%E4%B8%8EWeak/"/>
    
  </entry>
  
  <entry>
    <title>ä¾§æ»‘å¯¼èˆªæ æ¶ˆå¤±é—®é¢˜ç¬”è®°</title>
    <link href="https://madordie.github.io/post/push-pop-navigation-bar-hidden/"/>
    <id>https://madordie.github.io/post/push-pop-navigation-bar-hidden/</id>
    <published>2017-05-16T04:16:47.000Z</published>
    <updated>2017-10-11T03:37:32.533Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>å¦‚æœå‰é¡µé¢å’Œåé¡µé¢ä¸åŒï¼Œåˆ™ä¼šå‡ºç°è½»å¾®ä¾§æ»‘æ—¶å¯¼èˆªæ è«åå…¶å¦™æ²¡äº†ğŸ˜‚</p>
<p><a href="https://github.com/madordie/Demo-PushAndPop" target="_blank" rel="external">Demo-PushAndPop</a></p>
<a id="more"></a>
<h2 id="Demo-PushAndPop"><a href="#Demo-PushAndPop" class="headerlink" title="Demo-PushAndPop"></a>Demo-PushAndPop</h2><p>[å·²è§£å†³] éšè—å¯¼èˆªæ +æ”¹å˜çŠ¶æ€æ æ ·å¼æ—¶å‡ºç°å¯¼èˆªæ è«åå…¶å¦™æ²¡äº†</p>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p><img src="https://github.com/madordie/Demo-PushAndPop/blob/master/Untitled.gif?raw=true" alt="snapshot"></p>
<p>å½“<code>ViewController.swift</code>å®ç°<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="keyword">var</span> preferredStatusBarStyle: <span class="type">UIStatusBarStyle</span> &#123;</div><div class="line">    <span class="keyword">return</span> .lightContent</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ—¶ï¼Œä¸¤ä¸ª<code>ViewController</code>å¯¹åº”çš„<code>UIStatusBarStyle</code>ä¸åŒï¼Œåˆ™ä¼šå‡ºç°å¦‚ä¸Šå›¾ã€‚<code>UIStatusBarStyle</code>ä¸€è‡´åˆ™æ­£å¸¸ã€‚</p>
<h2 id="è§£å†³å…³é”®"><a href="#è§£å†³å…³é”®" class="headerlink" title="è§£å†³å…³é”®"></a>è§£å†³å…³é”®</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NavigationController</span>: <span class="title">UINavigationController</span> </span>&#123;</div><div class="line">    <span class="keyword">override</span> <span class="keyword">var</span> childViewControllerForStatusBarStyle: <span class="type">UIViewController</span>? &#123;</div><div class="line">        <span class="keyword">return</span> topViewController</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åªéœ€è¦å°†<code>childViewControllerForStatusBarStyle</code>è®¾ç½®ä¸º<code>UINavigationController.topViewController</code>å³å¯ã€‚</p>
<h2 id="å¦å¤–"><a href="#å¦å¤–" class="headerlink" title="å¦å¤–"></a>å¦å¤–</h2><p>é™„ä¸Š<code>BViewController</code>ä¸­ç›¸å…³ä»£ç ã€‚åœ¨åˆ‡æ¢çš„ä¸¤ä¸ª<code>UIViewController</code>çš„<code>preferredStatusBarStyle</code>ä¸€æ ·æ—¶ï¼Œä¸éœ€è¦è®¾ç½®<code>UINavigationController.childViewControllerForStatusBarStyle</code>ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> navigationBarHidden = <span class="literal">false</span></div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewWillAppear(animated)</div><div class="line"></div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> navigationController = navigationController  <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> navigationController.isNavigationBarHidden != navigationBarHidden &#123;</div><div class="line">            navigationController.setNavigationBarHidden(navigationBarHidden, animated: animated)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewWillDisappear(animated)</div><div class="line"></div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> navigationController = navigationController  <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> last = navigationController.viewControllers.last <span class="keyword">as</span>? <span class="type">BViewController</span> <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> last.navigationBarHidden != navigationBarHidden &#123;</div><div class="line">            navigationController.setNavigationBarHidden(last.navigationBarHidden, animated: animated)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h2><ul>
<li>@æœ¨å¤´ <code>viewWillAppear</code>æ›´æ¢ä¸º<code>viewDidAppear</code>ç„¶åè°ƒè¯•ï¼Œåœ¨Demoä¸­æµ‹è¯•ä¹Ÿå¯ä»¥æ›²çº¿æ•‘å›½ã€‚</li>
<li>@Harry æä¾›çš„ç»ˆæå¤§æ³•ï½</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¦‚æœå‰é¡µé¢å’Œåé¡µé¢ä¸åŒï¼Œåˆ™ä¼šå‡ºç°è½»å¾®ä¾§æ»‘æ—¶å¯¼èˆªæ è«åå…¶å¦™æ²¡äº†ğŸ˜‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/madordie/Demo-PushAndPop&quot;&gt;Demo-PushAndPop&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="DEBUG" scheme="https://madordie.github.io/tags/DEBUG/"/>
    
  </entry>
  
  <entry>
    <title>ã€Œè½¬ã€iOSå›¾ç‰‡åŠ è½½é€Ÿåº¦æé™ä¼˜åŒ–â€”FastImageCacheè§£æ</title>
    <link href="https://madordie.github.io/post/bang-fastimagecache/"/>
    <id>https://madordie.github.io/post/bang-fastimagecache/</id>
    <published>2017-05-16T02:55:00.000Z</published>
    <updated>2017-10-10T05:34:24.597Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>åŸæ–‡ï¼š<a href="http://blog.cnbang.net/tech/2578/" target="_blank" rel="external">iOSå›¾ç‰‡åŠ è½½é€Ÿåº¦æé™ä¼˜åŒ–â€”FastImageCacheè§£æ</a></p>
<p><a href="https://github.com/path/FastImageCache" target="_blank" rel="external">FastImageCache</a>æ˜¯Pathå›¢é˜Ÿå¼€å‘çš„ä¸€ä¸ªå¼€æºåº“ï¼Œç”¨äºæå‡å›¾ç‰‡çš„åŠ è½½å’Œæ¸²æŸ“é€Ÿåº¦ï¼Œè®©åŸºäºå›¾ç‰‡çš„åˆ—è¡¨æ»‘åŠ¨èµ·æ¥æ›´é¡ºç•…ï¼Œæ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåšçš„ã€‚</p>
<a id="more"></a>
<h2 id="ä¼˜åŒ–ç‚¹"><a href="#ä¼˜åŒ–ç‚¹" class="headerlink" title="ä¼˜åŒ–ç‚¹"></a>ä¼˜åŒ–ç‚¹</h2><p>iOSä»ç£ç›˜åŠ è½½ä¸€å¼ å›¾ç‰‡ï¼Œä½¿ç”¨UIImageVIewæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œéœ€è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>ä»ç£ç›˜æ‹·è´æ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒº</li>
<li>ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´</li>
<li>ç”ŸæˆUIImageViewï¼ŒæŠŠå›¾åƒæ•°æ®èµ‹å€¼ç»™UIImageView</li>
<li>å¦‚æœå›¾åƒæ•°æ®ä¸ºæœªè§£ç çš„PNG/JPGï¼Œè§£ç ä¸ºä½å›¾æ•°æ®</li>
<li>CATransactionæ•è·åˆ°UIImageView layeræ ‘çš„å˜åŒ–</li>
<li>ä¸»çº¿ç¨‹Runloopæäº¤CATransactionï¼Œå¼€å§‹è¿›è¡Œå›¾åƒæ¸²æŸ“<br> 6.1 å¦‚æœæ•°æ®æ²¡æœ‰å­—èŠ‚å¯¹é½ï¼ŒCore Animationä¼šå†æ‹·è´ä¸€ä»½æ•°æ®ï¼Œè¿›è¡Œå­—èŠ‚å¯¹é½ã€‚<br> 6.2 GPUå¤„ç†ä½å›¾æ•°æ®ï¼Œè¿›è¡Œæ¸²æŸ“ã€‚</li>
</ol>
<p>FastImageCacheåˆ†åˆ«ä¼˜åŒ–äº†2,4,6.1ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ä½¿ç”¨mmapå†…å­˜æ˜ å°„ï¼Œçœå»äº†ä¸Šè¿°ç¬¬2æ­¥æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„æ“ä½œã€‚</li>
<li>ç¼“å­˜è§£ç åçš„ä½å›¾æ•°æ®åˆ°ç£ç›˜ï¼Œä¸‹æ¬¡ä»ç£ç›˜è¯»å–æ—¶çœå»ç¬¬4æ­¥è§£ç çš„æ“ä½œã€‚</li>
<li>ç”Ÿæˆå­—èŠ‚å¯¹é½çš„æ•°æ®ï¼Œé˜²æ­¢ä¸Šè¿°ç¬¬6.1æ­¥CoreAnimationåœ¨æ¸²æŸ“æ—¶å†æ‹·è´ä¸€ä»½æ•°æ®ã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥å…·ä½“ä»‹ç»è¿™ä¸‰ä¸ªä¼˜åŒ–ç‚¹ä»¥åŠå®ƒçš„å®ç°ã€‚</p>
<h3 id="å†…å­˜æ˜ å°„"><a href="#å†…å­˜æ˜ å°„" class="headerlink" title="å†…å­˜æ˜ å°„"></a>å†…å­˜æ˜ å°„</h3><p>å¹³å¸¸æˆ‘ä»¬è¯»å–ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸Šå±‚APIè°ƒç”¨åˆ°æœ€åä¼šä½¿ç”¨ç³»ç»Ÿæ–¹æ³•read()è¯»å–æ•°æ®ï¼Œå†…æ ¸æŠŠç£ç›˜æ•°æ®è¯»å…¥å†…æ ¸ç¼“å†²åŒºï¼Œç”¨æˆ·å†ä»å†…æ ¸ç¼“å†²åŒºè¯»å–æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·å†…å­˜ç©ºé—´ï¼Œè¿™é‡Œæœ‰ä¸€æ¬¡å†…å­˜æ‹·è´çš„æ—¶é—´æ¶ˆè€—ï¼Œå¹¶ä¸”è¯»å–åæ•´ä¸ªæ–‡ä»¶æ•°æ®å°±å·²ç»å­˜åœ¨äºç”¨æˆ·å†…å­˜ä¸­ï¼Œå ç”¨äº†è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>FastImageCacheé‡‡ç”¨äº†å¦ä¸€ç§è¯»å†™æ–‡ä»¶çš„æ–¹æ³•ï¼Œå°±æ˜¯ç”¨mmapæŠŠæ–‡ä»¶æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´é‡Œçš„è™šæ‹Ÿå†…å­˜ï¼Œæ–‡ä»¶ä¸­çš„ä½ç½®åœ¨è™šæ‹Ÿå†…å­˜ä¸­æœ‰äº†å¯¹åº”çš„åœ°å€ï¼Œå¯ä»¥åƒæ“ä½œå†…å­˜ä¸€æ ·æ“ä½œè¿™ä¸ªæ–‡ä»¶ï¼Œç›¸å½“äºå·²ç»æŠŠæ•´ä¸ªæ–‡ä»¶æ”¾å…¥å†…å­˜ï¼Œä½†åœ¨çœŸæ­£ä½¿ç”¨åˆ°è¿™äº›æ•°æ®å‰å´ä¸ä¼šæ¶ˆè€—ç‰©ç†å†…å­˜ï¼Œä¹Ÿä¸ä¼šæœ‰è¯»å†™ç£ç›˜çš„æ“ä½œï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨è¿™äº›æ•°æ®æ—¶ï¼Œä¹Ÿå°±æ˜¯å›¾åƒå‡†å¤‡æ¸²æŸ“åœ¨å±å¹•ä¸Šæ—¶ï¼Œè™šæ‹Ÿå†…å­˜ç®¡ç†ç³»ç»ŸVMSæ‰æ ¹æ®ç¼ºé¡µåŠ è½½çš„æœºåˆ¶ä»ç£ç›˜åŠ è½½å¯¹åº”çš„æ•°æ®å—åˆ°ç‰©ç†å†…å­˜ï¼Œå†è¿›è¡Œæ¸²æŸ“ã€‚è¿™æ ·çš„æ–‡ä»¶è¯»å†™æ–‡ä»¶æ–¹å¼å°‘äº†æ•°æ®ä»å†…æ ¸ç¼“å­˜åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚</p>
<h3 id="è§£ç å›¾åƒ"><a href="#è§£ç å›¾åƒ" class="headerlink" title="è§£ç å›¾åƒ"></a>è§£ç å›¾åƒ</h3><p>ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨çš„å›¾åƒæ˜¯JPG/PNGï¼Œè¿™äº›å›¾åƒæ•°æ®ä¸æ˜¯ä½å›¾ï¼Œè€Œæ˜¯æ˜¯ç»è¿‡ç¼–ç å‹ç¼©åçš„æ•°æ®ï¼Œä½¿ç”¨å®ƒæ¸²æŸ“åˆ°å±å¹•ä¹‹å‰éœ€è¦è¿›è¡Œè§£ç è½¬æˆä½å›¾æ•°æ®ï¼Œè¿™ä¸ªè§£ç æ“ä½œæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œå¹¶ä¸”æ²¡æœ‰GPUç¡¬è§£ç ï¼Œåªèƒ½é€šè¿‡CPUï¼ŒiOSé»˜è®¤ä¼šåœ¨ä¸»çº¿ç¨‹å¯¹å›¾åƒè¿›è¡Œè§£ç ã€‚å¾ˆå¤šåº“éƒ½è§£å†³äº†å›¾åƒè§£ç çš„é—®é¢˜ï¼Œä¸è¿‡ç”±äºè§£ç åçš„å›¾åƒå¤ªå¤§ï¼Œä¸€èˆ¬ä¸ä¼šç¼“å­˜åˆ°ç£ç›˜ï¼ŒSDWebImageçš„åšæ³•æ˜¯æŠŠè§£ç æ“ä½œä»ä¸»çº¿ç¨‹ç§»åˆ°å­çº¿ç¨‹ï¼Œè®©è€—æ—¶çš„è§£ç æ“ä½œä¸å ç”¨ä¸»çº¿ç¨‹çš„æ—¶é—´ã€‚</p>
<p>FastImageCacheä¹Ÿæ˜¯åœ¨å­çº¿ç¨‹è§£ç å›¾åƒï¼Œä¸åŒçš„æ˜¯å®ƒä¼šç¼“å­˜è§£ç åçš„å›¾åƒåˆ°ç£ç›˜ã€‚å› ä¸ºè§£ç åçš„å›¾åƒä½“ç§¯å¾ˆå¤§ï¼ŒFastImageCacheå¯¹è¿™äº›å›¾åƒæ•°æ®åšäº†ç³»åˆ—ç¼“å­˜ç®¡ç†ï¼Œè¯¦è§ä¸‹æ–‡å®ç°éƒ¨åˆ†ã€‚å¦å¤–ç¼“å­˜çš„å›¾åƒä½“ç§¯å¤§ä¹Ÿæ˜¯ä½¿ç”¨å†…å­˜æ˜ å°„è¯»å–æ–‡ä»¶çš„åŸå› ï¼Œå°æ–‡ä»¶ä½¿ç”¨å†…å­˜æ˜ å°„æ— ä¼˜åŠ¿ï¼Œå†…å­˜æ‹·è´çš„é‡å°‘ï¼Œæ‹·è´åå ç”¨ç”¨æˆ·å†…å­˜ä¹Ÿä¸é«˜ï¼Œæ–‡ä»¶è¶Šå¤§å†…å­˜æ˜ å°„ä¼˜åŠ¿è¶Šå¤§ã€‚</p>
<h3 id="å­—èŠ‚å¯¹é½"><a href="#å­—èŠ‚å¯¹é½" class="headerlink" title="å­—èŠ‚å¯¹é½"></a>å­—èŠ‚å¯¹é½</h3><p>Core Animationåœ¨å›¾åƒæ•°æ®éå­—èŠ‚å¯¹é½çš„æƒ…å†µä¸‹æ¸²æŸ“å‰ä¼šå…ˆæ‹·è´ä¸€ä»½å›¾åƒæ•°æ®ï¼Œå®˜æ–¹æ–‡æ¡£æ²¡æœ‰å¯¹è¿™æ¬¡æ‹·è´è¡Œä¸ºä½œè¯´æ˜ï¼Œæ¨¡æ‹Ÿå™¨å’ŒInstrumenté‡Œæœ‰é«˜äº®æ˜¾ç¤ºâ€œcopied imagesâ€çš„åŠŸèƒ½ï¼Œä½†ä¼¼ä¹å®ƒæœ‰bugï¼Œå³ä½¿æŸå¼ å›¾ç‰‡æ²¡æœ‰è¢«é«˜äº®æ˜¾ç¤ºå‡ºæ¸²æŸ“æ—¶è¢«copyï¼Œä»è°ƒç”¨å †æ ˆä¸Šä¹Ÿè¿˜æ˜¯èƒ½çœ‹åˆ°è°ƒç”¨äº†CA::Render::copy_imageæ–¹æ³•ï¼š</p>
<p><img src="/images/fastImageCache1.png" alt="fastImageCache1"></p>
<p>é‚£ä»€ä¹ˆæ˜¯å­—èŠ‚å¯¹é½å‘¢ï¼ŒæŒ‰æˆ‘çš„ç†è§£ï¼Œä¸ºäº†æ€§èƒ½ï¼Œåº•å±‚æ¸²æŸ“å›¾åƒæ—¶ä¸æ˜¯ä¸€ä¸ªåƒç´ ä¸€ä¸ªåƒç´ æ¸²æŸ“ï¼Œè€Œæ˜¯ä¸€å—ä¸€å—æ¸²æŸ“ï¼Œæ•°æ®æ˜¯ä¸€å—å—åœ°å–ï¼Œå°±å¯èƒ½é‡åˆ°è¿™ä¸€å—è¿ç»­çš„å†…å­˜æ•°æ®é‡Œç»“å°¾çš„æ•°æ®ä¸æ˜¯å›¾åƒçš„å†…å®¹ï¼Œæ˜¯å†…å­˜é‡Œå…¶ä»–çš„æ•°æ®ï¼Œå¯èƒ½è¶Šç•Œè¯»å–å¯¼è‡´ä¸€äº›å¥‡æ€ªçš„ä¸œè¥¿æ··å…¥ï¼Œæ‰€ä»¥åœ¨æ¸²æŸ“ä¹‹å‰CoreAnimationè¦æŠŠæ•°æ®æ‹·è´ä¸€ä»½è¿›è¡Œå¤„ç†ï¼Œç¡®ä¿æ¯ä¸€å—éƒ½æ˜¯å›¾åƒæ•°æ®ï¼Œå¯¹äºä¸è¶³ä¸€å—çš„æ•°æ®ç½®ç©ºã€‚å¤§è‡´å›¾ç¤ºï¼š(pixelæ˜¯å›¾åƒåƒç´ æ•°æ®ï¼Œdataæ˜¯å†…å­˜é‡Œå…¶ä»–æ•°æ®)</p>
<p><img src="/images/fastImageCache2.png" alt="fastImageCache2"></p>
<p>å—çš„å¤§å°åº”è¯¥æ˜¯è·ŸCPU cache lineæœ‰å…³ï¼ŒARMv7æ˜¯32byteï¼ŒA9æ˜¯64byteï¼Œåœ¨A9ä¸‹CoreAnimationåº”è¯¥æ˜¯æŒ‰64byteä½œä¸ºä¸€å—æ•°æ®å»è¯»å–å’Œæ¸²æŸ“ï¼Œè®©å›¾åƒæ•°æ®å¯¹é½64byteå°±å¯ä»¥é¿å…CoreAnimationå†æ‹·è´ä¸€ä»½æ•°æ®è¿›è¡Œä¿®è¡¥ã€‚FastImageCacheåšçš„å­—èŠ‚å¯¹é½å°±æ˜¯è¿™ä¸ªäº‹æƒ…ã€‚</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>FastImageCacheæŠŠåŒä¸ªç±»å‹å’Œå°ºå¯¸çš„å›¾åƒéƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œæ ¹æ®æ–‡ä»¶åç§»å–å•å¼ å›¾ç‰‡ï¼Œç±»ä¼¼webçš„cssé›ªç¢§å›¾ï¼Œè¿™é‡Œç§°ä¸ºImageTableã€‚è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿ç»Ÿä¸€ç®¡ç†å›¾ç‰‡ç¼“å­˜ï¼Œæ§åˆ¶ç¼“å­˜çš„å¤§å°ï¼Œæ•´ä¸ªFastImageCacheå°±æ˜¯åœ¨ç®¡ç†ä¸€ä¸ªä¸ªImageTableçš„æ•°æ®ã€‚æ•´ä½“å®ç°çš„æ•°æ®ç»“æ„å¦‚å›¾ï¼š</p>
<p><img src="/images/fastImageCache3.png" alt="fastImageCache3"></p>
<p>ä¸€äº›è¡¥å……å’Œè¯´æ˜ï¼š</p>
<h3 id="ImageTable"><a href="#ImageTable" class="headerlink" title="ImageTable"></a>ImageTable</h3><ol>
<li>ä¸€ä¸ªImageFormatå¯¹åº”ä¸€ä¸ªImageTableï¼ŒImageFormatæŒ‡å®šäº†ImageTableé‡Œå›¾åƒæ¸²æŸ“æ ¼å¼/å¤§å°ç­‰ä¿¡æ¯ï¼ŒImageTableé‡Œçš„å›¾åƒæ•°æ®éƒ½ç”±ImageFormatè§„å®šäº†ç»Ÿä¸€çš„å°ºå¯¸ï¼Œæ¯å¼ å›¾åƒå¤§å°éƒ½æ˜¯ä¸€æ ·çš„ã€‚</li>
<li>ä¸€ä¸ªImageTableä¸€ä¸ªå®ä½“æ–‡ä»¶ï¼Œå¹¶æœ‰å¦ä¸€ä¸ªæ–‡ä»¶ä¿å­˜è¿™ä¸ªImageTableçš„metaä¿¡æ¯ã€‚</li>
<li>å›¾åƒä½¿ç”¨entityUUIDä½œä¸ºå”¯ä¸€æ ‡ç¤ºç¬¦ï¼Œç”±ç”¨æˆ·å®šä¹‰ï¼Œé€šå¸¸æ˜¯å›¾åƒurlçš„hashå€¼ã€‚ImageTable Metaçš„indexMapè®°å½•äº†entityUUID-&gt;entryIndexçš„æ˜ å°„ï¼Œé€šè¿‡indexMapå°±å¯ä»¥ç”¨å›¾åƒçš„entityUUIDæ‰¾åˆ°ç¼“å­˜æ•°æ®åœ¨ImageTableå¯¹åº”çš„ä½ç½®ã€‚</li>
</ol>
<h3 id="ImageTableEntry"><a href="#ImageTableEntry" class="headerlink" title="ImageTableEntry"></a>ImageTableEntry</h3><ol>
<li>ImageTableçš„å®ä½“æ•°æ®æ˜¯ImageTableEntryï¼Œæ¯ä¸ªentryæœ‰ä¸¤éƒ¨åˆ†æ•°æ®ï¼Œä¸€éƒ¨åˆ†æ˜¯å¯¹é½åçš„å›¾åƒæ•°æ®ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯metaä¿¡æ¯ï¼Œmetaä¿å­˜è¿™å¼ å›¾åƒçš„UUIDå’ŒåŸå›¾UUIDï¼Œç”¨äºæ ¡éªŒå›¾åƒæ•°æ®çš„æ­£ç¡®æ€§ã€‚</li>
<li>Entryæ•°æ®æ˜¯æŒ‰å†…å­˜åˆ†é¡µå¤§å°å¯¹é½çš„ï¼Œæ•°æ®å¤§å°æ˜¯å†…å­˜åˆ†é¡µå¤§å°çš„æ•´æ•°å€ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è™šæ‹Ÿå†…å­˜ç¼ºé¡µåŠ è½½æ—¶ä½¿ç”¨æœ€å°‘çš„å†…å­˜é¡µåŠ è½½ä¸€å¼ å›¾åƒã€‚</li>
<li>å›¾åƒæ•°æ®åšäº†å­—èŠ‚å¯¹é½å¤„ç†ï¼ŒCoreAnimationä½¿ç”¨æ—¶æ— éœ€å†å¤„ç†æ‹·è´ã€‚å…·ä½“åšæ³•æ˜¯CGBitmapContextCreateåˆ›å»ºä½å›¾ç”»å¸ƒæ—¶bytesPerRowå‚æ•°ä¼ 64å€æ•°ã€‚</li>
</ol>
<h3 id="Chunk"><a href="#Chunk" class="headerlink" title="Chunk"></a>Chunk</h3><ul>
<li>ImageTableå’Œå®ä½“æ•°æ®Entryé—´å¤šäº†å±‚Chunkï¼ŒChunkæ˜¯é€»è¾‘ä¸Šçš„æ•°æ®åˆ’åˆ†ï¼ŒNä¸ªEntryä½œä¸ºä¸€ä¸ªChunkï¼Œå†…å­˜æ˜ å°„mmapæ“ä½œæ˜¯ä»¥chunkä¸ºå•ä½çš„ï¼Œæ¯ä¸€ä¸ªchunkæ‰§è¡Œä¸€æ¬¡mmapæŠŠè¿™ä¸ªchunkçš„å†…å®¹æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ã€‚ä¸ºä»€ä¹ˆè¦å¤šä¸€å±‚chunkå‘¢ï¼ŒæŒ‰æˆ‘çš„ç†è§£ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†çµæ´»æ§åˆ¶mmapçš„å¤§å°å’Œè°ƒç”¨æ¬¡æ•°ï¼Œè‹¥å¯¹æ•´ä¸ªImageTableæ‰§è¡Œmmapï¼Œè½½å…¥è™šæ‹Ÿå†…å­˜çš„æ–‡ä»¶è¿‡å¤§ï¼Œè‹¥å¯¹æ¯ä¸ªEntryåšmmapï¼Œè°ƒç”¨æ¬¡æ•°ä¼šå¤ªå¤šã€‚</li>
</ul>
<h3 id="ç¼“å­˜ç®¡ç†"><a href="#ç¼“å­˜ç®¡ç†" class="headerlink" title="ç¼“å­˜ç®¡ç†"></a>ç¼“å­˜ç®¡ç†</h3><ul>
<li>ç”¨æˆ·å¯ä»¥å®šä¹‰æ•´ä¸ªImageTableé‡Œæœ€å¤§ç¼“å­˜çš„å›¾åƒæ•°é‡ï¼Œåœ¨æœ‰æ–°å›¾åƒéœ€è¦ç¼“å­˜æ—¶ï¼Œå¦‚æœç¼“å­˜æ²¡æœ‰è¶…è¿‡é™åˆ¶ï¼Œä¼šä»¥chunkä¸ºå•ä½æ‰©å±•æ–‡ä»¶å¤§å°ï¼Œé¡ºåºå†™ä¸‹å»ã€‚å¦‚æœå·²è¶…è¿‡æœ€å¤§ç¼“å­˜é™åˆ¶ï¼Œä¼šæŠŠæœ€å°‘ä½¿ç”¨çš„ç¼“å­˜æ›¿æ¢æ‰ï¼Œå®ç°æ–¹æ³•æ˜¯æ¯æ¬¡ä½¿ç”¨å›¾åƒéƒ½ä¼šæŠŠUUIDæ’å…¥åˆ°MRUEntriesæ•°ç»„çš„å¼€å¤´ï¼ŒMRUEntriesæŒ‰æœ€è¿‘ä½¿ç”¨é¡ºåºæ’åˆ—äº†å›¾åƒUUIDï¼Œæ•°ç»„é‡Œæœ€åä¸€ä¸ªå›¾åƒå°±æ˜¯æœ€å°‘ä½¿ç”¨çš„ã€‚è¢«æ›¿æ¢æ‰çš„å›¾ç‰‡ä¸‹æ¬¡éœ€è¦å†ä½¿ç”¨æ—¶ï¼Œå†èµ°ä¸€æ¬¡å–åŸå›¾â€”è§£å‹â€”å­˜å‚¨çš„æµç¨‹ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>FastImageCacheé€‚åˆç”¨äºtableViewé‡Œç¼“å­˜æ¯ä¸ªcellä¸ŠåŒæ ·è§„æ ¼çš„å›¾åƒï¼Œä¼˜ç‚¹æ˜¯èƒ½æå¤§åŠ å¿«ç¬¬ä¸€æ¬¡ä»ç£ç›˜åŠ è½½è¿™äº›å›¾åƒçš„é€Ÿåº¦ã€‚ä½†å®ƒæœ‰ä¸¤ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼šä¸€æ˜¯å ç©ºé—´å¤§ã€‚å› ä¸ºç¼“å­˜äº†è§£ç åçš„ä½å›¾åˆ°ç£ç›˜ï¼Œä½å›¾æ˜¯å¾ˆå¤§çš„ï¼Œå®½é«˜100<em>100çš„å›¾åƒåœ¨2xçš„é«˜æ¸…å±è®¾å¤‡ä¸‹å°±éœ€è¦200</em>200*4byte/pixel=156KBï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆFastImageCacheè¦å¤§è´¹å‘¨ç« é™åˆ¶ç¼“å­˜å¤§å°ã€‚äºŒæ˜¯æ¥å£ä¸å‹å¥½ï¼Œéœ€é¢„å®šä¹‰å¥½ç¼“å­˜çš„å›¾åƒå°ºå¯¸ã€‚FastImageCacheæ— æ³•åƒSDWebImageé‚£æ ·æ— ç¼æ¥å…¥UIImageViewï¼Œä½¿ç”¨å®ƒéœ€è¦é…ç½®ImageTableï¼Œå®šä¹‰å¥½å°ºå¯¸ï¼Œæ‰‹åŠ¨æä¾›çš„åŸå›¾ï¼Œæ¯ç§å®ä½“å›¾åƒè¦å®šä¹‰ä¸€ä¸ªFICEntityæ¨¡å‹ï¼Œä½¿é€»è¾‘å˜å¤æ‚ã€‚</p>
<p>FastImageCacheå·²ç»å±äºæé™ä¼˜åŒ–ï¼Œåšå›¾åƒåŠ è½½/æ¸²æŸ“ä¼˜åŒ–æ—¶åº”è¯¥ä¼˜å…ˆè€ƒè™‘ä¸€äº›ä½ä»£ä»·é«˜å›æŠ¥çš„ä¼˜åŒ–ç‚¹ï¼Œä¾‹å¦‚CALayerä»£æ›¿UIImageVIewï¼Œå‡å°‘GPUè®¡ç®—ï¼ˆå»é€æ˜/åƒç´ å¯¹é½ï¼‰ï¼Œå›¾åƒå­çº¿ç¨‹è§£ç ï¼Œé¿å…Offscreen-Renderç­‰ã€‚åœ¨å…¶ä»–ä¼˜åŒ–éƒ½åšåˆ°ä½ï¼Œå›¾åƒçš„æ¸²æŸ“è¿˜æ˜¯æœ‰æ€§èƒ½é—®é¢˜çš„å‰æä¸‹æ‰è€ƒè™‘ä½¿ç”¨FastImageCacheè¿›ä¸€æ­¥æå‡é¦–æ¬¡åŠ è½½çš„æ€§èƒ½ï¼Œä¸è¿‡å­—èŠ‚å¯¹é½çš„ä¼˜åŒ–å€’æ˜¯å¯ä»¥è„±ç¦»FastImageCacheç›´æ¥è¿ç”¨åœ¨é¡¹ç›®ä¸Šï¼Œåªéœ€è¦åœ¨è§£ç å›¾åƒæ—¶bitmapç”»å¸ƒçš„bytesPerRowè®¾ä¸º64çš„å€æ•°å³å¯ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åŸæ–‡ï¼š&lt;a href=&quot;http://blog.cnbang.net/tech/2578/&quot;&gt;iOSå›¾ç‰‡åŠ è½½é€Ÿåº¦æé™ä¼˜åŒ–â€”FastImageCacheè§£æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/path/FastImageCache&quot;&gt;FastImageCache&lt;/a&gt;æ˜¯Pathå›¢é˜Ÿå¼€å‘çš„ä¸€ä¸ªå¼€æºåº“ï¼Œç”¨äºæå‡å›¾ç‰‡çš„åŠ è½½å’Œæ¸²æŸ“é€Ÿåº¦ï¼Œè®©åŸºäºå›¾ç‰‡çš„åˆ—è¡¨æ»‘åŠ¨èµ·æ¥æ›´é¡ºç•…ï¼Œæ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåšçš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="FastImageCache" scheme="https://madordie.github.io/tags/FastImageCache/"/>
    
  </entry>
  
  <entry>
    <title>debug-_SwiftValue-unsignedIntegerValue</title>
    <link href="https://madordie.github.io/post/debug-SwiftValue-unsignedIntegerValue/"/>
    <id>https://madordie.github.io/post/debug-SwiftValue-unsignedIntegerValue/</id>
    <published>2017-04-17T06:05:09.000Z</published>
    <updated>2017-10-11T03:37:40.489Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>crash:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">let attr = try? NSMutableAttributedString(data: data,</div><div class="line">                                          options: [NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType,</div><div class="line">                                                    NSCharacterEncodingDocumentAttribute: String.Encoding.utf8],</div><div class="line">                                          documentAttributes:nil)</div><div class="line">// log:</div><div class="line">2017-04-17 14:04:38.140 [41275:463875] -[_SwiftValue unsignedIntegerValue]: unrecognized selector sent to instance 0x608000256620</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>WTF! è¿™ä¸ªæ–¹æ³•å¯åŠ¨æ—¶ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œè¦å¼‚æ­¥ï¼Ÿ</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;crash:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;let attr = try? NSMutableAttributedString(data: data,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                          options: [NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                    NSCharacterEncodingDocumentAttribute: String.Encoding.utf8],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                          documentAttributes:nil)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;// log:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2017-04-17 14:04:38.140 [41275:463875] -[_SwiftValue unsignedIntegerValue]: unrecognized selector sent to instance 0x608000256620&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="https://madordie.github.io/categories/iOS/"/>
    
    
      <category term="DEBUG" scheme="https://madordie.github.io/tags/DEBUG/"/>
    
  </entry>
  
</feed>
