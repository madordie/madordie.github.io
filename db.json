{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"source/uploads/avatar.png","path":"uploads/avatar.png","modified":0,"renderable":0},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/LICENSE","path":"lib/fastclick/LICENSE","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/README.md","path":"lib/fastclick/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/bower.json","path":"lib/fastclick/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","path":"lib/jquery_lazyload/CONTRIBUTING.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","path":"lib/jquery_lazyload/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","path":"lib/jquery_lazyload/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","path":"lib/jquery_lazyload/jquery.lazyload.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","path":"lib/jquery_lazyload/jquery.scrollstop.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/bower.json","path":"lib/velocity/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","path":"lib/fastclick/lib/fastclick.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","path":"lib/fastclick/lib/fastclick.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","path":"lib/fancybox/source/blank.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","path":"lib/fancybox/source/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","path":"lib/fancybox/source/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","path":"lib/fancybox/source/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","path":"lib/fancybox/source/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","path":"lib/fancybox/source/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","path":"lib/fancybox/source/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","path":"lib/fancybox/source/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"6d06e7e7cc4e7b3a8e6f21f8cf942d5b3e1d9e35","modified":1488812674000},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1491634131000},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1469338903000},{"_id":"themes/next/.gitignore","hash":"5f09fca02e030b7676c1d312cd88ce8fbccf381c","modified":1491634131000},{"_id":"themes/next/.javascript_ignore","hash":"f9ea3c5395f8feb225a24e2c32baa79afda30c16","modified":1491634131000},{"_id":"themes/next/.hound.yml","hash":"b76daa84c9ca3ad292c78412603370a367cc2bc3","modified":1469338903000},{"_id":"themes/next/.jshintrc","hash":"9928f81bd822f6a8d67fdbc909b517178533bca9","modified":1469338903000},{"_id":"themes/next/README.en.md","hash":"4ece25ee5f64447cd522e54cb0fffd9a375f0bd4","modified":1491634131000},{"_id":"themes/next/README.md","hash":"500b5606eb6a09c979d16128f8b00f4bf9bc95ac","modified":1469338903000},{"_id":"themes/next/_config.yml","hash":"566015acc51e0b49053ef3b8a911de90eff066e8","modified":1491638452000},{"_id":"themes/next/gulpfile.coffee","hash":"031bffc483e417b20e90eceb6cf358e7596d2e69","modified":1491634131000},{"_id":"themes/next/bower.json","hash":"5abc236d9cc2512f5457ed57c1fba76669eb7399","modified":1491634131000},{"_id":"themes/next/package.json","hash":"7e87b2621104b39a30488654c2a8a0c6a563574b","modified":1491634131000},{"_id":"source/404/index.md","hash":"bfd44eb167d1b158f4a080da30416f269d28fec3","modified":1467803963000},{"_id":"source/_posts/about-me.md","hash":"e81b3577c089a5446affb919578fe9a9769b2a2e","modified":1488961534000},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1488812640000},{"_id":"source/_posts/about-change-blog.md","hash":"ce131343e6daeb19f786e0a52eb523c63dd146eb","modified":1469405391000},{"_id":"source/_posts/about-project-tableview.md","hash":"7ec571d56ab97c2655b27eea578825583904196f","modified":1490414949000},{"_id":"source/_posts/build-ipa-sh.md","hash":"6f988c610481b75895a57f77dd4febdc59db2981","modified":1484300145000},{"_id":"source/_posts/about-reprint-article.md","hash":"12b54293fce2c4f5c593918cfb141c9fc6c457ec","modified":1490415140000},{"_id":"source/_posts/bandwagonhost-note.md","hash":"595d8c2d763ada4459549932d575fd0e0a32edf7","modified":1486447729000},{"_id":"source/_posts/bruch-up-regular-expressions.md","hash":"c5ea6fc6bb18d239ddbe548accf44edb7d9f80fb","modified":1483096325000},{"_id":"source/_posts/debug-swift-notifa-frame.md","hash":"b0b404fbdb703a4961fe0747dbbc5debc219c08e","modified":1483096709000},{"_id":"source/_posts/debug-uiview-m-190.md","hash":"4dbeb67ac741e7c251ee8917b1593c35ab4d788c","modified":1483096769000},{"_id":"source/_posts/debug-xcode8-analysis-crash-file.md","hash":"953c4508ddb1529b0781727a20b8c8accc0b03f7","modified":1483096697000},{"_id":"source/_posts/fastlane-note.md","hash":"ee118460c86dd987f1c1daba90982031d14fd088","modified":1491633698000},{"_id":"source/_posts/elegant-to-use-swiftlint.md","hash":"4913b978e81752147da1e12b4be3e2c0ae5f8013","modified":1486449381000},{"_id":"source/_posts/rx-dictionary.md","hash":"a8e7a48a1f5037dc947ab1753f99a4f79fe35ac5","modified":1491638674000},{"_id":"source/_posts/note.md","hash":"f2c31d23ace00041e98ea9e22b32aac86b026b4c","modified":1486636630000},{"_id":"source/_posts/reactivecocoa-ready-to-use.md","hash":"5cdeaf066407ea3657b5c321a44f2311f0b75de4","modified":1477144813000},{"_id":"source/_posts/sonarqube-note.md","hash":"5ac3ad98eaaefd9db8a302afe986a6a329df28df","modified":1486447774000},{"_id":"source/_posts/real-world-swift-performance.md","hash":"d22f84e8f377f2d738484c695a58501a77a1775d","modified":1484736396000},{"_id":"source/_posts/swift-build-times.md","hash":"3ae83f7b195d99e7db906d16ad8aca49a0410589","modified":1486370232000},{"_id":"source/_posts/ui-source-and-code-decoupling.md","hash":"397f032251f3ea0a09a5ab16810b021fc48db0bb","modified":1477144813000},{"_id":"source/_posts/use-hexo-setup-blog.md","hash":"5db812ca3a007815ee5adfaad4b04c7a477ffa18","modified":1477144562000},{"_id":"source/_posts/uitextkit-ellipsis-sth-at-the-end.md","hash":"fa56c3d2c18e37791446eb35030bcf0d437232aa","modified":1483096540000},{"_id":"source/about/index.md","hash":"ae36d4702b8343f58e788308e0c5675857dcc06d","modified":1488813087000},{"_id":"source/about/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1488812687000},{"_id":"source/categories/index.md","hash":"bbff6e3714fbd02943df6c95da107ab7ba7c661b","modified":1490415657000},{"_id":"source/tags/index.md","hash":"e3c461d62957e2da657e9cacc03925de0b3a2834","modified":1469403457000},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"3b5eafd32abb718e56ccf8d1cee0607ad8ce611d","modified":1491634131000},{"_id":"themes/next/_git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1469338903000},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"fdd63b77472612337309eb93ec415a059b90756b","modified":1491634131000},{"_id":"themes/next/_git/config","hash":"bf7d1df65cf34d0f25a7184a58c37a09f72e4be7","modified":1469338903000},{"_id":"themes/next/_git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1469338287000},{"_id":"themes/next/_git/packed-refs","hash":"4466857f1a41f86e8a1c29bc9088bff54a5c90d1","modified":1469338903000},{"_id":"themes/next/_git/index","hash":"a4a0d172df6b04ab22cc9dfe43e25440ca48c832","modified":1469341762000},{"_id":"themes/next/languages/default.yml","hash":"4cc6aeb1ac09a58330e494c8771773758ab354af","modified":1491634131000},{"_id":"themes/next/languages/de.yml","hash":"306db8c865630f32c6b6260ade9d3209fbec8011","modified":1491634131000},{"_id":"themes/next/languages/en.yml","hash":"e7def07a709ef55684490b700a06998c67f35f39","modified":1491634131000},{"_id":"themes/next/languages/fr-FR.yml","hash":"24180322c83587a153cea110e74e96eacc3355ad","modified":1491634131000},{"_id":"themes/next/languages/pt-BR.yml","hash":"958e49571818a34fdf4af3232a07a024050f8f4e","modified":1491634131000},{"_id":"themes/next/languages/pt.yml","hash":"36c8f60dacbe5d27d84d0e0d6974d7679f928da0","modified":1491634131000},{"_id":"themes/next/languages/ja.yml","hash":"1c3a05ab80a6f8be63268b66da6f19da7aa2c638","modified":1491634131000},{"_id":"themes/next/languages/ru.yml","hash":"7462c3017dae88e5f80ff308db0b95baf960c83f","modified":1491634131000},{"_id":"themes/next/languages/zh-Hans.yml","hash":"3c0c7dfd0256457ee24df9e9879226c58cb084b5","modified":1491634131000},{"_id":"themes/next/languages/zh-hk.yml","hash":"1c917997413bf566cb79e0975789f3c9c9128ccd","modified":1491634131000},{"_id":"themes/next/languages/zh-tw.yml","hash":"0b2c18aa76570364003c8d1cd429fa158ae89022","modified":1491634131000},{"_id":"themes/next/layout/_layout.swig","hash":"909d68b164227fe7601d82e2303bf574eb754172","modified":1491634131000},{"_id":"themes/next/layout/archive.swig","hash":"b5b59d70fc1563f482fa07afd435752774ad5981","modified":1469338903000},{"_id":"themes/next/layout/index.swig","hash":"427d0b95b854e311ae363088ab39a393bf8fdc8b","modified":1469338903000},{"_id":"themes/next/layout/category.swig","hash":"6422d196ceaff4220d54b8af770e7e957f3364ad","modified":1469338903000},{"_id":"themes/next/scripts/merge-configs.js","hash":"13c8b3a2d9fce06c2488820d9248d190c8100e0a","modified":1491634131000},{"_id":"themes/next/layout/post.swig","hash":"e2e512142961ddfe77eba29eaa88f4a2ee43ae18","modified":1469338903000},{"_id":"themes/next/languages/id.yml","hash":"2835ea80dadf093fcf47edd957680973f1fb6b85","modified":1491634131000},{"_id":"themes/next/layout/page.swig","hash":"3727fab9dadb967e9c2204edca787dc72264674a","modified":1491634131000},{"_id":"themes/next/layout/tag.swig","hash":"07cf49c49c39a14dfbe9ce8e7d7eea3d4d0a4911","modified":1469338903000},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1469338903000},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1469338903000},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1469338903000},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1469338903000},{"_id":"themes/next/_git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1469338287000},{"_id":"themes/next/_git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1469338287000},{"_id":"themes/next/_git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1469338287000},{"_id":"themes/next/_git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1469338287000},{"_id":"themes/next/_git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1469338287000},{"_id":"themes/next/_git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1469338287000},{"_id":"themes/next/_git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1469338287000},{"_id":"themes/next/_git/hooks/pre-rebase.sample","hash":"5885a56ab4fca8075a05a562d005e922cde9853b","modified":1469338287000},{"_id":"themes/next/_git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1469338287000},{"_id":"themes/next/_git/hooks/update.sample","hash":"39355a075977d05708ef74e1b66d09a36e486df1","modified":1469338287000},{"_id":"themes/next/_git/logs/HEAD","hash":"802e264e3c99af3e571933b47897965466da2225","modified":1469338903000},{"_id":"themes/next/layout/_macro/post.swig","hash":"640b431eccbbd27f10c6781f33db5ea9a6e064de","modified":1491634131000},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"911b99ba0445b2c07373128d87a4ef2eb7de341a","modified":1491634131000},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"14e785adeb0e671ba0ff9a553e6f0d8def6c670c","modified":1469338903000},{"_id":"themes/next/layout/_macro/reward.swig","hash":"37e5b7c42ec17b9b6b786c5512bcc481a21c974e","modified":1469338903000},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"5864f5567ba5efeabcf6ea355013c0b603ee07f2","modified":1491634131000},{"_id":"themes/next/layout/_partials/comments.swig","hash":"1c7d3c975e499b9aa3119d6724b030b7b00fc87e","modified":1491634131000},{"_id":"themes/next/layout/_partials/duoshuo-hot-articles.swig","hash":"5d4638c46aef65bf32a01681495b62416ccc98db","modified":1469338903000},{"_id":"themes/next/layout/_partials/footer.swig","hash":"7172c6053118b7c291a56a7860128a652ae66b83","modified":1491634131000},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9e8e21d194ef44d271b1cca0bc1448c14d7edf4f","modified":1469338903000},{"_id":"themes/next/layout/_partials/head.swig","hash":"a0eafe24d1dae30c790ae35612154b3ffbbd5cce","modified":1491634131000},{"_id":"themes/next/layout/_partials/header.swig","hash":"a1ffbb691dfad3eaf2832a11766e58a179003b8b","modified":1491634131000},{"_id":"themes/next/layout/_partials/search.swig","hash":"9dbd378e94abfcb3f864a5b8dbbf18d212ca2ee0","modified":1491634131000},{"_id":"themes/next/layout/_scripts/baidu-push.swig","hash":"82d060fe055d6e423bbc9199f82dfe5c68e74779","modified":1469338903000},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"03aaebe9d50f6acb007ec38cc04acd1cfceb404d","modified":1469338903000},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"766b2bdda29523ed6cd8d7aa197f996022f8fd94","modified":1469338903000},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"9de352a32865869e7ed6863db271c46db5853e5a","modified":1491634131000},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"535fc542781021c4326dec24d8495cbb1387634a","modified":1469338903000},{"_id":"themes/next/scripts/tags/full-image.js","hash":"8eeb3fb89540299bdbb799edfdfdac3743b50596","modified":1491634131000},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"49252824cd53184dc9b97b2f2d87ff28e1b3ef27","modified":1469338903000},{"_id":"themes/next/source/css/main.styl","hash":"20702c48d6053c92c5bcdbc68e8d0ef1369848a0","modified":1469338903000},{"_id":"themes/next/source/images/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1469339541000},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1469338903000},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1469338903000},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1469338903000},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1469338903000},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1469338903000},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1469338903000},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1469338903000},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1469338903000},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1469338903000},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1469338903000},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1469338903000},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1469338903000},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1469338903000},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1469338903000},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1469338903000},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1469338903000},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1469338903000},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1469338903000},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1469338903000},{"_id":"source/uploads/avatar.png","hash":"c219003cac089b0b74a184c915003f257ec1ec21","modified":1467803963000},{"_id":"themes/next/_git/refs/heads/master","hash":"4ad994fe133b79fa089d49b7a6e68860bbc420e5","modified":1469338903000},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"7ce76358411184482bb0934e70037949dd0da8ca","modified":1469338903000},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"2d1075f4cabcb3956b7b84a8e210f5a66f0a5562","modified":1491634131000},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1491634131000},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1469338903000},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"959b7e04a96a5596056e4009b73b6489c117597e","modified":1469338903000},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"1f1107468aaf03f7d0dcd7eb2b653e2813a675b4","modified":1491634131000},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"89c5a5240ecb223acfe1d12377df5562a943fd5d","modified":1469338903000},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"63315fcf210799f894208c9f512737096df84962","modified":1469338903000},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1469338903000},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"069d1357c717572256e5cdee09574ebce529cbae","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/analytics.swig","hash":"0a89c04055bade7baa5962f1d5aefe438d83a244","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/comments.swig","hash":"907b931d775d32405d02a25b3b0a3ac03bf804d0","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/lean-analytics.swig","hash":"92dc60821307fc9769bea9b2d60adaeb798342af","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/localsearch.swig","hash":"7f7148c8f52e4d3cfc070d964160362179fa8e91","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/mathjax.swig","hash":"5bafc33f57508d1d04a9930165240f6e9efa8d6d","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1469338903000},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"c8d35a6b9e3bff6d8fdb66de853065af9d37562d","modified":1469338903000},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"06f432f328a5b8a9ef0dbd5301b002aba600b4ce","modified":1491634131000},{"_id":"themes/next/source/css/_variables/base.styl","hash":"28a7f84242ca816a6452a0a79669ca963d824607","modified":1491634131000},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"715d5b40dc52f319fe4bff0325beb874774d9bd9","modified":1469338903000},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"78a83c38f69a8747bb74e420e6c9eeef1ea76525","modified":1469338903000},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1469338903000},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"aab7be0a6e2724b3faa9338db93c19556c559625","modified":1491634131000},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1469338903000},{"_id":"themes/next/source/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1469338903000},{"_id":"themes/next/source/js/src/motion.js","hash":"269414e84df544a4ccb88519f6abae4943db3c67","modified":1469338903000},{"_id":"themes/next/source/js/src/post-details.js","hash":"af7a417dd1cb02465a7b98211653e7c6192e6d55","modified":1491634131000},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1469338903000},{"_id":"themes/next/source/js/src/utils.js","hash":"e13c9ccf70d593bdf3b8cc1d768f595abd610e6e","modified":1491634131000},{"_id":"themes/next/source/vendors/fancybox/.bower.json","hash":"cc40a9b11e52348e554c84e4a5c058056f6b7aeb","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/.gitattributes","hash":"2db21acfbd457452462f71cc4048a943ee61b8e0","modified":1469338903000},{"_id":"themes/next/source/vendors/fastclick/.bower.json","hash":"93ebd5b35e632f714dcf1753e1f6db77ec74449b","modified":1469338903000},{"_id":"themes/next/source/vendors/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1469338903000},{"_id":"themes/next/source/vendors/fastclick/bower.json","hash":"13379463c7463b4b96d13556b46faa4cc38d81e6","modified":1469338903000},{"_id":"themes/next/source/vendors/fastclick/README.md","hash":"1decd8e1adad2cd6db0ab50cf56de6035156f4ea","modified":1469338903000},{"_id":"themes/next/source/vendors/jquery_lazyload/.bower.json","hash":"b7638afc93e9cd350d0783565ee9a7da6805ad8e","modified":1469338903000},{"_id":"themes/next/source/vendors/jquery_lazyload/CONTRIBUTING.md","hash":"4891864c24c28efecd81a6a8d3f261145190f901","modified":1469338903000},{"_id":"themes/next/source/vendors/jquery_lazyload/README.md","hash":"895d50fa29759af7835256522e9dd7dac597765c","modified":1469338903000},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1469338903000},{"_id":"themes/next/source/vendors/jquery_lazyload/bower.json","hash":"65bc85d12197e71c40a55c0cd7f6823995a05222","modified":1469338903000},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/HELP-US-OUT.txt","hash":"69a4c537d167b68a0ccf1c6febd138aeffca60d6","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/.bower.json","hash":"7da985a99674e54f514d4fd9fcd3bcea6e7e41d5","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1469338903000},{"_id":"themes/next/source/vendors/jquery/.bower.json","hash":"91745c2cc6c946c7275f952b2b0760b880cea69e","modified":1469338903000},{"_id":"themes/next/source/vendors/velocity/.bower.json","hash":"05f960846f1c7a93dab1d3f9a1121e86812e8c88","modified":1469338903000},{"_id":"themes/next/source/vendors/velocity/bower.json","hash":"2ec99573e84c7117368beccb9e94b6bf35d2db03","modified":1469338903000},{"_id":"themes/next/source/vendors/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1469338903000},{"_id":"themes/next/source/vendors/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1469338903000},{"_id":"themes/next/source/vendors/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1469338903000},{"_id":"themes/next/source/vendors/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1469338903000},{"_id":"themes/next/_git/logs/refs/heads/master","hash":"802e264e3c99af3e571933b47897965466da2225","modified":1469338903000},{"_id":"themes/next/_git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1469338903000},{"_id":"themes/next/_git/objects/pack/pack-adcffcdf0fcd56ff3adf9ee5e2e97ce9c03b1c4f.idx","hash":"4af6e2fb7304b0b3bc26d5aefbd4b319e97bc562","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/analytics/busuanzi-counter.swig","hash":"4fcbf57c4918528ab51d3d042cff92cf5aefb599","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/analytics/baidu-analytics.swig","hash":"7c43d66da93cde65b473a7d6db2a86f9a42647d6","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/analytics/cnzz-analytics.swig","hash":"f9c6ee91c2a615edd8ca26edcc8a66b71883c238","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/analytics/facebook-sdk.swig","hash":"394d008e5e94575280407ad8a1607a028026cbc3","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/analytics/google-analytics.swig","hash":"30a23fa7e816496fdec0e932aa42e2d13098a9c2","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/comments/duoshuo.swig","hash":"696666141cdd204fd8818ac2ad18f05e320f8587","modified":1469338903000},{"_id":"themes/next/layout/_scripts/third-party/comments/disqus.swig","hash":"bff3b18f56175c53f3bc6d733166c4d998e08732","modified":1469338903000},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"2186be20e317505cd31886f1291429cc21f76703","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"0dfb4b3ba3180d7285e66f270e1d3fa0f132c3d2","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"ef089a407c90e58eca10c49bc47ec978f96e03ba","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"711c8830886619d4f4a0598b0cde5499dce50c62","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1469338903000},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"7804e31c44717c9a9ddf0f8482b9b9c1a0f74538","modified":1491634131000},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"9c25c75311e1bd4d68df031d3f2ae6d141a90766","modified":1491634131000},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1469338903000},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"013619c472c7e4b08311c464fcbe9fcf5edde603","modified":1469338903000},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"64f5d56c08d74a338813df1265580ca0cbf0190b","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"c2d079788d6fc2e9a191ccdae94e50d55bf849dc","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"b0dcca862cd0cc6e732e33d975b476d744911742","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"fda14bc35be2e1b332809b55b3d07155a833dbf4","modified":1491634131000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9a5581a770af8964064fef7afd3e16963e45547f","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"c4ed249798296f60bda02351fe6404fb3ef2126f","modified":1491634131000},{"_id":"themes/next/source/css/_schemes/Pisces/_full-image.styl","hash":"938d39eedc6e3d33918c1145a5bf1e79991d3fcf","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"5b93958239d3d2bf9aeaede44eced2434d784462","modified":1491634131000},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"215de948be49bcf14f06d500cef9f7035e406a43","modified":1491634131000},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"e3e23751d4ad24e8714b425d768cf68e37de7ded","modified":1491634131000},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"69ecd6c97e7cdfd822ac8102b45ad0ede85050db","modified":1491634131000},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1491634131000},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"8829bc556ca38bfec4add4f15a2f028092ac6d46","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"82bbaa6322764779a1ac2e2c8390ce901c7972e2","modified":1491634131000},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"a0e2030a606c934fb2c5c7373aaae04a1caac4c5","modified":1469338903000},{"_id":"themes/next/source/images/avatar.gif","hash":"c219003cac089b0b74a184c915003f257ec1ec21","modified":1467803963000},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"79da92119bc246fe05d1626ac98426a83ec90a94","modified":1491634131000},{"_id":"themes/next/source/vendors/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1469338903000},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1469338903000},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css","hash":"3b87c2560832748cd06f9bfd2fd6ea8edbdae8c7","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.min.css","hash":"05ea25bc9b3ac48993e1fee322d3bc94b49a6e22","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff2","hash":"574ea2698c03ae9477db2ea3baf460ee32f1a7ea","modified":1469338903000},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1469338903000},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/fonts/FontAwesome.otf","hash":"0112e96f327d413938d37c1693806f468ffdbace","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff","hash":"507970402e328b2baeb05bde73bf9ded4e2c3a2d","modified":1469338903000},{"_id":"themes/next/source/vendors/velocity/velocity.js","hash":"e63dc7cea055ca60a95d286f32349d88b10c5a4d","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.eot","hash":"b3c2f08e73320135b69c23a3908b87a12053a2f6","modified":1469338903000},{"_id":"themes/next/_git/logs/refs/remotes/origin/HEAD","hash":"802e264e3c99af3e571933b47897965466da2225","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"ae1ca14e51de67b07dba8f61ec79ee0e2e344574","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"6c00f6e0978f4d8f9a846a15579963728aaa6a17","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"8a2421cb9005352905fae9d41a847ae56957247e","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"8994ffcce84deac0471532f270f97c44fea54dc0","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"740d37f428b8f4574a76fc95cc25e50e0565f45e","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"2039590632bba3943c39319d80ef630af7928185","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"8fae54591877a73dff0b29b2be2e8935e3c63575","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"7778920dd105fa4de3a7ab206eeba30b1a7bac45","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"b9a2e76f019a5941191f1263b54aef7b69c48789","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/post/post-more-link.styl","hash":"15063d79b5befc21820baf05d6f20cc1c1787477","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"a5d8617a24d7cb6c5ad91ea621183ca2c0917331","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"c196401747019d389da09b7a0fe7f27e3a0ec01f","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"e792c8dc41561c96d128e9b421187f1c3dc978a0","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"963105a531403d7aad6d9e5e23e3bfabb8ec065a","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"8c0276883398651336853d5ec0e9da267a00dd86","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"2e7ec9aaa3293941106b1bdd09055246aa3c3dc6","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"920343e41c124221a17f050bbb989494d44f7a24","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"5f6ea57aabfa30a437059bf8352f1ad829dbd4ff","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"7690b9596ec3a49befbe529a5a2649abec0faf76","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"a2ec22ef4a6817bbb2abe8660fcd99fe4ca0cc5e","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"b8969e1654eec89a0fd10d88b337fee9cb03cd44","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"234facd038f144bd0fe09a31ed1357c5d74c517f","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"dd310c2d999185e881db007360176ee2f811df10","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"d4e6d8d7b34dc69994593c208f875ae8f7e8a3ae","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"93b08815c4d17e2b96fef8530ec1f1064dede6ef","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"327b5f63d55ec26f7663185c1a778440588d9803","modified":1469338903000},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"42348219db93a85d2ee23cb06cebd4d8ab121726","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"173490e21bece35a34858e8e534cf86e34561350","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"2340dd9b3202c61d73cc708b790fac5adddbfc7f","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1469338903000},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1491634131000},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1491634131000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1469338903000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.ttf","hash":"27cf1f2ec59aece6938c7bb2feb0e287ea778ff9","modified":1469338903000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.svg","hash":"2b3c8ba7008cc014d8fb37abc6f9f49aeda83824","modified":1469338903000},{"_id":"themes/next/_git/objects/pack/pack-adcffcdf0fcd56ff3adf9ee5e2e97ce9c03b1c4f.pack","hash":"a4dca228bc044f942f1a8bbf5aecee5e5e88fcf2","modified":1469338903000},{"_id":"themes/next/.gitattributes","hash":"44bd4729c74ccb88110804f41746fec07bf487d4","modified":1491634131000},{"_id":"themes/next/.DS_Store","hash":"eae04c45b3d1720048d42fe8e1444e3496270e02","modified":1491634126000},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1491634131000},{"_id":"themes/next/.travis.yml","hash":"c42d9608c8c7fe90de7b1581a8dc3886e90c179e","modified":1491634131000},{"_id":"themes/next/LICENSE","hash":"f293bcfcdc06c0b77ba13570bb8af55eb5c059fd","modified":1491634131000},{"_id":"themes/next/.git/COMMIT_EDITMSG","hash":"4a6d71189eb08db2cb25735eb0bc394b379b2c8d","modified":1491634075000},{"_id":"themes/next/.git/FETCH_HEAD","hash":"b50b2bffd0b80a7698c415b36dfa97cd44394bc9","modified":1491634125000},{"_id":"themes/next/.git/HEAD","hash":"929f0a39f61901b4b7ead241fc06f16e4584928a","modified":1491634131000},{"_id":"themes/next/.git/ORIG_HEAD","hash":"8a33fa3a76deae66b2039973715aa1d47cef90a2","modified":1491634131000},{"_id":"themes/next/.git/config","hash":"bf7d1df65cf34d0f25a7184a58c37a09f72e4be7","modified":1469338903000},{"_id":"themes/next/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1469338287000},{"_id":"themes/next/.git/index","hash":"3b03404cdb0127258f607a00b6a29097e2aebbff","modified":1491634153000},{"_id":"themes/next/.git/packed-refs","hash":"4466857f1a41f86e8a1c29bc9088bff54a5c90d1","modified":1469338903000},{"_id":"themes/next/languages/ko.yml","hash":"be150543379150f78329815af427bf152c0e9431","modified":1491634131000},{"_id":"themes/next/layout/schedule.swig","hash":"234dc8c3b9e276e7811c69011efd5d560519ef19","modified":1491634131000},{"_id":"themes/next/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/apply-opt","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/rebasing","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/scissors","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1491634131000},{"_id":"themes/next/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1469338287000},{"_id":"themes/next/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1469338287000},{"_id":"themes/next/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1469338287000},{"_id":"themes/next/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1469338287000},{"_id":"themes/next/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1469338287000},{"_id":"themes/next/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1469338287000},{"_id":"themes/next/.git/hooks/pre-rebase.sample","hash":"5885a56ab4fca8075a05a562d005e922cde9853b","modified":1469338287000},{"_id":"themes/next/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1469338287000},{"_id":"themes/next/.git/hooks/update.sample","hash":"39355a075977d05708ef74e1b66d09a36e486df1","modified":1469338287000},{"_id":"themes/next/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1469338287000},{"_id":"themes/next/.git/logs/HEAD","hash":"4fa5f94f9d21f4a7c5b1aa03d2d3683062faaa92","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/abort-safety","hash":"929f0a39f61901b4b7ead241fc06f16e4584928a","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/author-script","hash":"bca1666d67114daa3b30c8f8d607bbb9409a5062","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/final-commit","hash":"8c42a99f2faf0570422e0e4403e0ff44a64f1fcc","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/head-name","hash":"140296a356533b1771f9a72539a40a0ec81903d9","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/keep","hash":"a9fcd54b25e7e863d72cd47c08af46e61b74b561","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/last","hash":"e5fa44f2b31c1fb553b6021e7360d07d5d91ff5e","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/messageid","hash":"a9fcd54b25e7e863d72cd47c08af46e61b74b561","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/next","hash":"e5fa44f2b31c1fb553b6021e7360d07d5d91ff5e","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/onto","hash":"929f0a39f61901b4b7ead241fc06f16e4584928a","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/orig-head","hash":"8a33fa3a76deae66b2039973715aa1d47cef90a2","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/original-commit","hash":"8a33fa3a76deae66b2039973715aa1d47cef90a2","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/patch-merge-index","hash":"ef8b42d1eec0b92d2b772c717a29b493f179a778","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/quiet","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/sign","hash":"a9fcd54b25e7e863d72cd47c08af46e61b74b561","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/threeway","hash":"34fc7a11cb38cf4911763696a41698c68e5ddbbe","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/utf8","hash":"34fc7a11cb38cf4911763696a41698c68e5ddbbe","modified":1491634131000},{"_id":"themes/next/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1491634131000},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1491634131000},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"b16fcbf0efd20c018d7545257a8533c497ea7647","modified":1491634131000},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"1efd925d34a5d4ba2dc0838d9c86ba911e705fc9","modified":1491634131000},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"5d4638c46aef65bf32a01681495b62416ccc98db","modified":1491634131000},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"7c04a42319d728be356746363aff8ea247791d24","modified":1491634131000},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"6d25596d6a7c57700d37b607f8d9a62d89708683","modified":1491634131000},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"22369026c87fc23893c35a7f250b42f3bb1b60f1","modified":1491634131000},{"_id":"themes/next/scripts/tags/button.js","hash":"62e6dbeb53d07627a048132c79630b45d9a8f2cc","modified":1491634131000},{"_id":"themes/next/scripts/tags/exturl.js","hash":"8d7e60f60779bde050d20fd76f6fdc36fc85e06d","modified":1491634131000},{"_id":"themes/next/scripts/tags/note.js","hash":"6752925eedbdb939d8ec4d11bdfb75199f18dd70","modified":1491634131000},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"90035272fa31a3f65b3c0e2cb8a633876ef457dc","modified":1491634131000},{"_id":"themes/next/.git/objects/0e/052d97ab5cacf365a3a34e9230b47d35d07c2d","hash":"5eec87422aefe4069809e9ba8572a73c6171afcb","modified":1491634131000},{"_id":"themes/next/.git/objects/38/52c5af02e253b73d4f1e060e90162651aeb4f6","hash":"0a2ec453ef941b059cd54293c205c5d56e35efe2","modified":1491634131000},{"_id":"themes/next/.git/objects/3f/a54777cb4fe7f830c193b0b1cc76620aa34079","hash":"4eaf341c8b17b571b10c7da253ea658217edd5f0","modified":1491634131000},{"_id":"themes/next/.git/objects/44/6b9ede224d0331d1e64a667134459ad6157c31","hash":"2c464454c6e9974959e63c5a0f10a1bd8fc028f9","modified":1491634067000},{"_id":"themes/next/.git/objects/56/15d6cc4bdbae3080bdd9f7aa7f964b0ae3fd3f","hash":"8f7971aa10ced8d0ec890ed468b5dfae24102a9b","modified":1491634075000},{"_id":"themes/next/.git/objects/5b/0d4cc569dee835596d0238dbc70b5ea1fefb15","hash":"3e86522856632990606e06837e1eda3e8dd4fab1","modified":1491634131000},{"_id":"themes/next/.git/objects/99/137db8eb0871978d8bf0b79414aec3e4aa4f37","hash":"d4bebc43c4072ea5792da6ca49c3feaf44a60e95","modified":1491634131000},{"_id":"themes/next/.git/objects/a0/7b2fae080ca32947ebbda0dd75c63f5723d44f","hash":"de27628a528ae7d3416fc65d0e9819f5a8474fb3","modified":1491634067000},{"_id":"themes/next/.git/objects/ab/ced23e2ad343d5a71d259795d1e73c2734fa8d","hash":"ee0135e107fe6d917efa541bbedbf98b2fde5fa3","modified":1491634131000},{"_id":"themes/next/.git/objects/d4/7bddb0e28d722859c35d061d3e81ec5e411c72","hash":"efb61ae105297a35913737585811b737944ecbf4","modified":1491634067000},{"_id":"themes/next/.git/objects/e0/e563df1af0af2fb997259c88d522e77682ab89","hash":"01953f6553b9598453d8d65c678a969a6b55d05c","modified":1491634131000},{"_id":"themes/next/.git/objects/f5/582c38546f1805d0cf55ec331249e3cf7f612a","hash":"1eadd06eb2991c835c28efdb9c7c83eb809a0df9","modified":1491634131000},{"_id":"themes/next/.git/refs/heads/master","hash":"8a33fa3a76deae66b2039973715aa1d47cef90a2","modified":1491634075000},{"_id":"themes/next/.git/refs/tags/v5.1.0","hash":"7ec0539e56966d1eaf8b88c1d27165c1f7dfacf5","modified":1491634125000},{"_id":"themes/next/.git/refs/tags/v5.1.1","hash":"3caf2cc30e2bc17ce7c8decb48064104d4845453","modified":1491634125000},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"60426bf73f8a89ba61fb1be2df3ad5398e32c4ef","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"deda6a814ed48debc694c4e0c466f06c127163d0","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"18e7bef8923d83ea42df6c97405e515a876cede4","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"8160b27bee0aa372c7dc7c8476c05bae57f58d0f","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"394d008e5e94575280407ad8a1607a028026cbc3","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"5d9943d74cc2e0a91badcf4f755c6de77eab193a","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"3358d11b9a26185a2d36c96049e4340e701646e4","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"92dc60821307fc9769bea9b2d60adaeb798342af","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"a652f202bd5b30c648c228ab8f0e997eb4928e44","modified":1491634131000},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"c3971fd154d781088e1cc665035f8561a4098f4c","modified":1491634131000},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"0e3378f7c39b2b0f69638290873ede6b6b6825c0","modified":1491634131000},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"c316758546dc9ba6c60cb4d852c17ca6bb6d6724","modified":1491634131000},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"a356b2185d40914447fde817eb3d358ab6b3e4c3","modified":1491634131000},{"_id":"themes/next/layout/_third-party/comments/gentie.swig","hash":"03592d1d731592103a41ebb87437fe4b0a4c78ca","modified":1491634131000},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"3e8dc5c6c912628a37e3b5f886bec7b2e5ed14ea","modified":1491634131000},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"abb92620197a16ed2c0775edf18a0f044a82256e","modified":1491634131000},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"7240f2e5ec7115f8abbbc4c9ef73d4bed180fdc7","modified":1491634131000},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"af9dd8a4aed7d06cf47b363eebff48850888566c","modified":1491634131000},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1491634131000},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"f4dbd4c896e6510ded8ebe05394c28f8a86e71bf","modified":1491634131000},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1491634131000},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"c057b17f79e8261680fbae8dc4e81317a127c799","modified":1491634131000},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1491634131000},{"_id":"themes/next/source/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1491634131000},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1491634131000},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1491634131000},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"93ebd5b35e632f714dcf1753e1f6db77ec74449b","modified":1491634131000},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1491634131000},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"1decd8e1adad2cd6db0ab50cf56de6035156f4ea","modified":1491634131000},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"13379463c7463b4b96d13556b46faa4cc38d81e6","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/.bower.json","hash":"cc40a9b11e52348e554c84e4a5c058056f6b7aeb","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/.gitattributes","hash":"2db21acfbd457452462f71cc4048a943ee61b8e0","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1491634131000},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"91745c2cc6c946c7275f952b2b0760b880cea69e","modified":1491634131000},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"b7638afc93e9cd350d0783565ee9a7da6805ad8e","modified":1491634131000},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"5b38ae00297ffc07f433c632c3dbf7bde4cdf39a","modified":1491634131000},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4891864c24c28efecd81a6a8d3f261145190f901","modified":1491634131000},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"895d50fa29759af7835256522e9dd7dac597765c","modified":1491634131000},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"65bc85d12197e71c40a55c0cd7f6823995a05222","modified":1491634131000},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1491634131000},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1491634131000},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"05f960846f1c7a93dab1d3f9a1121e86812e8c88","modified":1491634131000},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"2ec99573e84c7117368beccb9e94b6bf35d2db03","modified":1491634131000},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1491634131000},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1491634131000},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1491634131000},{"_id":"themes/next/.git/objects/pack/pack-9c68b1bc8f77ff23034f0e1f16b6501cb5270b9d.idx","hash":"0a7fa18dadd5418b0da5d1dad22e75e25a612a43","modified":1491634125000},{"_id":"themes/next/source/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1491634131000},{"_id":"themes/next/.git/objects/pack/pack-adcffcdf0fcd56ff3adf9ee5e2e97ce9c03b1c4f.idx","hash":"4af6e2fb7304b0b3bc26d5aefbd4b319e97bc562","modified":1469338903000},{"_id":"themes/next/.git/logs/refs/heads/master","hash":"34207528c26487d13a9d4a6a296a7f87e52cac9e","modified":1491634075000},{"_id":"themes/next/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1469338903000},{"_id":"themes/next/.git/refs/remotes/origin/dev","hash":"41ab21bbe0d88c2cc439c0af33807af4e95aef31","modified":1491634125000},{"_id":"themes/next/.git/refs/remotes/origin/master","hash":"929f0a39f61901b4b7ead241fc06f16e4584928a","modified":1491634125000},{"_id":"themes/next/.git/refs/remotes/origin/servant","hash":"ee903ee2112907f4498fdb13674a640c685e95fb","modified":1491634125000},{"_id":"themes/next/.git/refs/remotes/origin/testing","hash":"15660a56eaab85fc3fd3324de8d61dbc2b09b42a","modified":1491634125000},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"28ff4ed6714c59124569ffcbd10f1173d53ca923","modified":1491634131000},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"59ad08bcc6fe9793594869ac2b4c525021453e78","modified":1491634131000},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1491634131000},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1491634131000},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1491634131000},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/0001","hash":"91309d5c771672efd3bb815201483da64ff1e421","modified":1491634131000},{"_id":"themes/next/.git/rebase-apply/patch","hash":"e8ff1c2557a7abdce1128cb0121844635cbfb43c","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1491634131000},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1491634131000},{"_id":"themes/next/.git/objects/37/48fac6ae0a7df0dc841c59bb4f9b3058d913e0","hash":"b9f82fbc766a037332df3a8a085b8b4b849f26aa","modified":1491634131000},{"_id":"themes/next/.git/logs/refs/remotes/origin/HEAD","hash":"802e264e3c99af3e571933b47897965466da2225","modified":1469338903000},{"_id":"themes/next/.git/logs/refs/remotes/origin/master","hash":"e28e9ee119abc5ae63fb08e412e1c16ad1899cfc","modified":1491634125000},{"_id":"themes/next/.git/logs/refs/remotes/origin/dev","hash":"97ff1d2375c0f6a343acf2e48b466476fe60c745","modified":1491634125000},{"_id":"themes/next/.git/logs/refs/remotes/origin/servant","hash":"0fdae62d07a4ae03d7bb00264759540fbb8ddc2b","modified":1491634125000},{"_id":"themes/next/.git/logs/refs/remotes/origin/testing","hash":"25b40415139b4b95aaa98e554aff9cee865adc58","modified":1491634125000},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"a82afbb72d83ee394aedc7b37ac0008a9823b4f4","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"beccb53dcd658136fb91a0c5678dea8f37d6e0b6","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f54367c0feda6986c030cc4d15a0ca6ceea14bcb","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"1b3cc9f4e5a7f6e05b4100e9990b37b20d4a2005","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"74d0ba86f698165d13402670382a822c8736a556","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"fd42777b9125fd8969dc39d4f15473e2b91b4142","modified":1491634131000},{"_id":"themes/next/source/css/_common/components/third-party/gentie.styl","hash":"586a3ec0f1015e7207cd6a2474362e068c341744","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1491634131000},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1491634131000},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1491634131000},{"_id":"themes/next/source/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1491634131000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1491634131000},{"_id":"themes/next/.git/objects/pack/pack-9c68b1bc8f77ff23034f0e1f16b6501cb5270b9d.pack","hash":"724b5f17b249c72d9b620d2820465b6f5600b32e","modified":1491634125000},{"_id":"themes/next/.git/objects/pack/pack-adcffcdf0fcd56ff3adf9ee5e2e97ce9c03b1c4f.pack","hash":"a4dca228bc044f942f1a8bbf5aecee5e5e88fcf2","modified":1469338903000},{"_id":"public/baidusitemap.xml","hash":"f512584019da461c7799a4d58bf8bc863a6ee734","modified":1491638683659},{"_id":"public/atom.xml","hash":"7d97ea512d71b8ca2c66eb8e1c861c7430173a77","modified":1491638683679},{"_id":"public/search.xml","hash":"1fe437a3c309b3d9edf51ebf9204e0a7270b72d9","modified":1491638683681},{"_id":"public/sitemap.xml","hash":"e33fbe55496a0a79b9fdb99446d6eaf747cbd4f0","modified":1491638683681},{"_id":"public/404.html","hash":"33333cee6a1a8c3279a98742fa3113a11734f7a0","modified":1491638683750},{"_id":"public/categories/index.html","hash":"453d32043ea0b8aa931b1cf74fe34f315cdc45f5","modified":1491638683750},{"_id":"public/tags/index.html","hash":"68cc54b4891df9e30c4775fb3b482953cb559ca7","modified":1491638683751},{"_id":"public/about/index.html","hash":"2e0f2df53e4e4e4a201a022f69979bc253561aaf","modified":1491638683751},{"_id":"public/2017/02/07/sonarqube-note/index.html","hash":"0a6f1178f765aeb5c14d11c5098357a12929ce1d","modified":1491638683756},{"_id":"public/archives/2016/07/index.html","hash":"3769ce0e501602c8540a4de22d81d2a0a006aa2d","modified":1491638683758},{"_id":"public/archives/2016/09/index.html","hash":"b98a605c5f8f59e54099e87a92715690c6aec575","modified":1491638683751},{"_id":"public/archives/2016/08/index.html","hash":"8e73eaa39f4c3fd7fec26e312513c50d44c0f3be","modified":1491638683751},{"_id":"public/archives/2016/10/index.html","hash":"7025b5b0e6b7685d4caa644215fd73fe22ff7f7e","modified":1491638683751},{"_id":"public/archives/2016/11/index.html","hash":"bd23538c3bff825949030b3619f765db91a70fbe","modified":1491638683751},{"_id":"public/archives/2016/12/index.html","hash":"f7736aaf4e03ea57fd382ceaad92f67a6a8510b7","modified":1491638683752},{"_id":"public/archives/2017/index.html","hash":"0027251ec5880c86360067bea387ce64b6d23bb8","modified":1491638683752},{"_id":"public/archives/2017/01/index.html","hash":"62f4ab7c703a55bf27dc8dee0b75f1632f3320ad","modified":1491638683752},{"_id":"public/archives/2017/02/index.html","hash":"3041720ae86a142f11472941db9b517d240cdeb0","modified":1491638683752},{"_id":"public/categories/公告/index.html","hash":"41b2b43a7d1d043bb6fec47bec5bca61ff93efb4","modified":1491638683752},{"_id":"public/categories/正则表达式/index.html","hash":"04c264deada42e046ab0451e4b6df63e7da88ddc","modified":1491638683753},{"_id":"public/categories/DEBUG/index.html","hash":"af2d6349a20958b5d6eb021bc4bb092e7b0e57f9","modified":1491638683753},{"_id":"public/categories/笔记/index.html","hash":"726d23c8bfafe2807a8b90295c71c3f354ba58b6","modified":1491638683753},{"_id":"public/categories/教程/index.html","hash":"81c896903404cc4bf92044e0c2f40f8b2fcd8810","modified":1491638683753},{"_id":"public/tags/Fastlane/index.html","hash":"50ef7ce8a6bf4a7b058ed58e71bdcdc707f003c6","modified":1491638683754},{"_id":"public/tags/ReactiveCocoa/index.html","hash":"287eaca89e6874b123c2ff623b0fb35b356f80f7","modified":1491638683754},{"_id":"public/tags/hexo/index.html","hash":"231d8499f29ed7a1667a239b6cfe276c55a1611f","modified":1491638683754},{"_id":"public/tags/iOS/index.html","hash":"94605ce096c7e4673b6760f9b83aea321c9e63b7","modified":1491638683753},{"_id":"public/2017/04/08/rx-dictionary/index.html","hash":"a329468bdd5f73ea432264274a39e143456d9259","modified":1491638683756},{"_id":"public/2017/01/04/fastlane-note/index.html","hash":"2ae0b280e6ec4748673df6eddc9eb0134af1e63b","modified":1491638683756},{"_id":"public/2017/01/17/real-world-swift-performance/index.html","hash":"0136a71dd60b4aedafb7ef2bb8005284dbd66dc1","modified":1491638683756},{"_id":"public/2017/01/17/swift-build-times/index.html","hash":"d9de18ee6c23abb9206f02bdd9e0ac01f6f5a45a","modified":1491638683756},{"_id":"public/2016/12/23/uitextkit-ellipsis-sth-at-the-end/index.html","hash":"6bd931eabc6a1e0558aa9cc36ca4e9daf6683d03","modified":1491638683756},{"_id":"public/2016/12/19/bandwagonhost-note/index.html","hash":"ea38138e269bb5f9f0ad57a9da188a61e0b48371","modified":1491638683756},{"_id":"public/2016/12/01/debug-swift-notifa-frame/index.html","hash":"4ded284eb83870facbda9c078ac37f6026073295","modified":1491638683755},{"_id":"public/2016/12/23/elegant-to-use-swiftlint/index.html","hash":"4d7cb237778c904d493035c176a99bf606adca0f","modified":1491638683756},{"_id":"public/2016/11/14/debug-xcode8-analysis-crash-file/index.html","hash":"8db7544ef8931973d97142c6fc76271ba2fda8a7","modified":1491638683755},{"_id":"public/2016/10/11/debug-uiview-m-190/index.html","hash":"168d43bf77bda831a5fb45ded8bfb80fc76ec2e3","modified":1491638683755},{"_id":"public/2016/12/19/bruch-up-regular-expressions/index.html","hash":"a70b312c857b3952acce03aa52e9e48e3597c8c1","modified":1491638683755},{"_id":"public/2016/08/28/ui-source-and-code-decoupling/index.html","hash":"874863e7d7a34403ffce56e0fd93cab6e5c6d608","modified":1491638683755},{"_id":"public/2016/07/24/about-reprint-article/index.html","hash":"f513be4edeb0df91e4b1b67003e7d17c83c1de00","modified":1491638683755},{"_id":"public/2016/09/26/build-ipa-sh/index.html","hash":"90fb699e1c72d8aa7274154fec2d596d87555345","modified":1491638683755},{"_id":"public/2016/07/12/reactivecocoa-ready-to-use/index.html","hash":"950e0127cd74be568f60e43aaa0f4bf822b85543","modified":1491638683754},{"_id":"public/2016/07/28/note/index.html","hash":"622f90ec21b70386602ee85d448a607d433203c8","modified":1491638683755},{"_id":"public/2016/07/27/about-project-tableview/index.html","hash":"e2e76ed3656d9a2f69926613a72592d0e589a04c","modified":1491638683755},{"_id":"public/2016/07/05/about-me/index.html","hash":"d19ba61065c0416188b52e2ca667989e5baaa1c6","modified":1491638683754},{"_id":"public/archives/index.html","hash":"2561b82c8416228cacf3048a764c7a09a3c039b8","modified":1491638683758},{"_id":"public/2016/07/05/use-hexo-setup-blog/index.html","hash":"7cabd84af4f8186cd393a33b7b38489017b1aec2","modified":1491638683754},{"_id":"public/archives/2016/index.html","hash":"396dad69844fecb2863f91967f3c9f0be61a82bd","modified":1491638683758},{"_id":"public/index.html","hash":"342c5f5ee3317ed8daddcebfb17a74c737b82371","modified":1491638683759},{"_id":"public/page/2/index.html","hash":"d882d51d6bf03b1f49cc06596f55ace3cdafe227","modified":1491638683759},{"_id":"public/page/4/index.html","hash":"1890aac7886e99f42d0a8dc821a1bfb66f09c09e","modified":1491638683760},{"_id":"public/2016/07/05/about-change-blog/index.html","hash":"7c4ed0284a439e0afce8415c0d4ec6de18e84735","modified":1491638683754},{"_id":"public/page/3/index.html","hash":"b399c8c9af64d00452811ff898ab54351b806587","modified":1491638683760},{"_id":"public/archives/page/2/index.html","hash":"617c581d673dca8c9febe25d1e78daabfc4977ef","modified":1491638683751},{"_id":"public/archives/2017/04/index.html","hash":"aa0f4a5d41b798ff8e8574992e3bbf55bc6b946b","modified":1491638683752},{"_id":"public/categories/牢骚/index.html","hash":"2ad74be6a8ad4fd05329b40d86e5df5d71caf13b","modified":1491638683753},{"_id":"public/page/5/index.html","hash":"6f34162b9f781f0b9da6d2d66a65f96a257b338f","modified":1491638683760},{"_id":"public/tags/牢骚/index.html","hash":"7879ef0b289049fedc850d1f9f6badcf507c54ea","modified":1491638683753},{"_id":"public/images/algolia_logo.svg","hash":"90035272fa31a3f65b3c0e2cb8a633876ef457dc","modified":1491635857164},{"_id":"public/lib/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1491635857164},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1491635857164},{"_id":"public/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1491635857164},{"_id":"public/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1491635857164},{"_id":"public/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1491635857164},{"_id":"public/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1491635857164},{"_id":"public/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1491635857164},{"_id":"public/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1491635857165},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1491635857165},{"_id":"public/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1491635857165},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1491635857223},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1491635857228},{"_id":"public/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1491635857238},{"_id":"public/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1491635857238},{"_id":"public/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1491635857238},{"_id":"public/lib/fastclick/README.html","hash":"da3c74d484c73cc7df565e8abbfa4d6a5a18d4da","modified":1491635857238},{"_id":"public/lib/fastclick/bower.json","hash":"4dcecf83afddba148464d5339c93f6d0aa9f42e9","modified":1491635857238},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1491635857238},{"_id":"public/lib/jquery_lazyload/CONTRIBUTING.html","hash":"a6358170d346af13b1452ac157b60505bec7015c","modified":1491635857239},{"_id":"public/lib/jquery_lazyload/README.html","hash":"bde24335f6bc09d8801c0dcd7274f71b466552bd","modified":1491635857239},{"_id":"public/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1491635857239},{"_id":"public/lib/jquery_lazyload/bower.json","hash":"ae3c3b61e6e7f9e1d7e3585ad854380ecc04cf53","modified":1491635857239},{"_id":"public/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1491635857239},{"_id":"public/lib/velocity/bower.json","hash":"0ef14e7ccdfba5db6eb3f8fc6aa3b47282c36409","modified":1491635857239},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1491635857239},{"_id":"public/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1491635857239},{"_id":"public/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1491635857239},{"_id":"public/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1491635857239},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1491635857239},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1491635857239},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1491635857239},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1491635857239},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1491635857239},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1491635857239},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1491635857239},{"_id":"public/lib/three/three-waves.min.js","hash":"5b38ae00297ffc07f433c632c3dbf7bde4cdf39a","modified":1491635857239},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1491635857240},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1491635857240},{"_id":"public/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1491635857240},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1491635857240},{"_id":"public/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1491635857240},{"_id":"public/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1491635857240},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1491635857240},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1491635857240},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1491635857240},{"_id":"public/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1491635857240},{"_id":"public/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1491635857240},{"_id":"public/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1491635857241},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1491635857241},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1491635857241},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1491635857257},{"_id":"public/tags/swift/index.html","hash":"063d976661ad0925a4610c267767d2d8151c7646","modified":1491638683762},{"_id":"public/tags/RxSwift/index.html","hash":"dfa5fce4a985c5fe90f2e6ba710193c4dd020d6e","modified":1491638683762}],"Category":[{"name":"公告","_id":"cj18v0f970006l0uv9e9vu2tw"},{"name":"牢骚","_id":"cj18v0f9j000cl0uv7mho31kg"},{"name":"正则表达式","_id":"cj18v0f9n000il0uv7am2rwnl"},{"name":"DEBUG","_id":"cj18v0f9v000ol0uvnmmmsmi2"},{"name":"笔记","_id":"cj18v0fa80013l0uvv0gkbole"},{"name":"教程","_id":"cj18v0faf001el0uv3x1bgmww"}],"Data":[],"Page":[{"title":"404","date":"2016-07-01T07:17:26.000Z","toc":false,"comments":0,"_content":"sorry ~~~\n\n您要找的内容可能在火星，点击 <keith_127@126.com> 告诉我，马上帮你找回来！！！","source":"404/index.md","raw":"---\ntitle: 404\ndate: 2016-07-01 15:17:26\ntoc: false\ncomments: false\npermalink: /404\n---\nsorry ~~~\n\n您要找的内容可能在火星，点击 <keith_127@126.com> 告诉我，马上帮你找回来！！！","updated":"2016-07-06T11:19:23.000Z","path":"/404.html","layout":"page","_id":"cj18v0f8s0000l0uvaijucbi6","content":"<p>sorry ~~~</p>\n<p>您要找的内容可能在火星，点击 <a href=\"&#109;&#97;&#105;&#x6c;&#x74;&#111;&#58;&#107;&#x65;&#105;&#116;&#x68;&#95;&#49;&#50;&#x37;&#x40;&#49;&#x32;&#x36;&#46;&#99;&#x6f;&#109;\">&#107;&#x65;&#105;&#116;&#x68;&#95;&#49;&#50;&#x37;&#x40;&#49;&#x32;&#x36;&#46;&#99;&#x6f;&#109;</a> 告诉我，马上帮你找回来！！！</p>\n","excerpt":"","more":"<p>sorry ~~~</p>\n<p>您要找的内容可能在火星，点击 <a href=\"&#109;&#97;&#105;&#x6c;&#x74;&#111;&#58;&#107;&#x65;&#105;&#116;&#x68;&#95;&#49;&#50;&#x37;&#x40;&#49;&#x32;&#x36;&#46;&#99;&#x6f;&#109;\">&#107;&#x65;&#105;&#116;&#x68;&#95;&#49;&#50;&#x37;&#x40;&#49;&#x32;&#x36;&#46;&#99;&#x6f;&#109;</a> 告诉我，马上帮你找回来！！！</p>\n"},{"title":"分类","date":"2016-07-24T06:17:20.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2016-07-24 14:17:20\ntype: \"categories\"\n---\n","updated":"2017-03-25T04:20:57.000Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cj18v0f8y0002l0uvs4r3qfj7","content":"","excerpt":"","more":""},{"title":"关于我","date":"2016-07-01T07:17:20.000Z","_content":"# 关于我\n上海，男，有女朋友。\n\niOS 开发者，嵌入式爱好者，喜欢研究，热衷于技术。\n\n**QQ**: [453870736](tencent://QQInterLive/?Cmd=2&Uin=495939026)\n\n**email**: <keith_127@126.com>\n\n**Github**: [https://github.com/madordie](https://github.com/madordie)\n\n**个人资料页**: [传送门](https://madordie.github.io/2016/07/05/about-me/)","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2016-07-01 15:17:20\n---\n# 关于我\n上海，男，有女朋友。\n\niOS 开发者，嵌入式爱好者，喜欢研究，热衷于技术。\n\n**QQ**: [453870736](tencent://QQInterLive/?Cmd=2&Uin=495939026)\n\n**email**: <keith_127@126.com>\n\n**Github**: [https://github.com/madordie](https://github.com/madordie)\n\n**个人资料页**: [传送门](https://madordie.github.io/2016/07/05/about-me/)","updated":"2017-03-06T15:11:27.000Z","path":"about/index.html","comments":1,"layout":"page","_id":"cj18v0f930004l0uvaz5lx5c5","content":"<h1 id=\"关于我\"><a href=\"#关于我\" class=\"headerlink\" title=\"关于我\"></a>关于我</h1><p>上海，男，有女朋友。</p>\n<p>iOS 开发者，嵌入式爱好者，喜欢研究，热衷于技术。</p>\n<p><strong>QQ</strong>: <a href=\"tencent://QQInterLive/?Cmd=2&amp;Uin=495939026\" target=\"_blank\" rel=\"external\">453870736</a></p>\n<p><strong>email</strong>: <a href=\"&#x6d;&#97;&#x69;&#108;&#116;&#111;&#58;&#x6b;&#101;&#105;&#x74;&#x68;&#95;&#x31;&#x32;&#55;&#64;&#x31;&#50;&#54;&#46;&#99;&#111;&#x6d;\">&#x6b;&#101;&#105;&#x74;&#x68;&#95;&#x31;&#x32;&#55;&#64;&#x31;&#50;&#54;&#46;&#99;&#111;&#x6d;</a></p>\n<p><strong>Github</strong>: <a href=\"https://github.com/madordie\" target=\"_blank\" rel=\"external\">https://github.com/madordie</a></p>\n<p><strong>个人资料页</strong>: <a href=\"https://madordie.github.io/2016/07/05/about-me/\">传送门</a></p>\n","excerpt":"","more":"<h1 id=\"关于我\"><a href=\"#关于我\" class=\"headerlink\" title=\"关于我\"></a>关于我</h1><p>上海，男，有女朋友。</p>\n<p>iOS 开发者，嵌入式爱好者，喜欢研究，热衷于技术。</p>\n<p><strong>QQ</strong>: <a href=\"tencent://QQInterLive/?Cmd=2&amp;Uin=495939026\">453870736</a></p>\n<p><strong>email</strong>: <a href=\"&#x6d;&#97;&#x69;&#108;&#116;&#111;&#58;&#x6b;&#101;&#105;&#x74;&#x68;&#95;&#x31;&#x32;&#55;&#64;&#x31;&#50;&#54;&#46;&#99;&#111;&#x6d;\">&#x6b;&#101;&#105;&#x74;&#x68;&#95;&#x31;&#x32;&#55;&#64;&#x31;&#50;&#54;&#46;&#99;&#111;&#x6d;</a></p>\n<p><strong>Github</strong>: <a href=\"https://github.com/madordie\">https://github.com/madordie</a></p>\n<p><strong>个人资料页</strong>: <a href=\"https://madordie.github.io/2016/07/05/about-me/\">传送门</a></p>\n"},{"title":"标签云","date":"2016-07-24T23:23:39.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签云\ndate: 2016-07-25 07:23:39\ntype: \"tags\"\n---\n","updated":"2016-07-24T23:37:37.000Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cj18v0f9d0007l0uvghlyw7v2","content":"","excerpt":"","more":""}],"Post":[{"title":"个人资料页","date":"2016-07-04T16:00:00.000Z","_content":"\n## 基本信息\n\n - __孙继刚__\n - 坐标: 上海\n - e-mail: <e.madordie@gmail.com>\n - blog: [https://madordie.github.io](https://madordie.github.io)\n\n\n## 经历\n\n - 深圳房多多网络科技有限公司\n \t- 2015.8.24 - 今\n \t- 为IM选择较为稳定、适合快速迭代的IMSDK。\n \t- 负责C端IM模块的底层设计与开发，为IM业务逻辑提供数据支持。\n \t- 降低iOS的整体crash，分析并解决较为隐蔽的crash。\n \t- 负责C端主要项目模块，比如：自定义刷新动画组件、IM定制缓存数据库、等。\n \t- 为房多多建立公共代码库。\n\n\n - 福州淘股网络技术有限公司\n \t- 2015.5 - 2015.8\n \t- 为淘股吧iOS端的构建提供项目架构设计与支持。\n \t- 统一主题变更的思路以及方案。\n \t- 以数据作为整体驱动的思想，构建从网络到UI再到网络的项目架构。\n\n\n - 上海商路网络科技有限公司\n \t- 2014.10 - 2015.5\n \t- 将<肌肤管家>APP从外包接手并大部分重构至普通开发者可维护。\n \t- 独立开发并维护该社区活动类APP。\n\n\n ## 个人技能\n\n - 熟练掌握C/C++、Objective-c、Swift等编程语言\n - 熟悉shell、ruby、python等脚本语言\n - 有良好的编程习惯、较强的分析并解决问题的能力，并能积极的分析并总结所遇到的问题\n - 对项目架构有一定的认识和把握，能够搭建较为优秀的项目框架\n - 对面向对象编程、面向切片编程、等编程思想在实践中的应用有一定的认识和理解\n - 对编码基础知识：线程、网络、布局、适配、Debug调试、等基础知识运用自如\n\n\n## 教育经历\n\n - 2011.6 - 2015.6 南阳理工大学 软件工程专业移动设备应用开发方向\n\n\n## 自我评价\n\n热衷于技术。一个典型处女座强迫症重度患者。并伴有代码洁癖。","source":"_posts/about-me.md","raw":"---\ntitle: 个人资料页\ndate: 2016-07-05\ntags:\n---\n\n## 基本信息\n\n - __孙继刚__\n - 坐标: 上海\n - e-mail: <e.madordie@gmail.com>\n - blog: [https://madordie.github.io](https://madordie.github.io)\n\n\n## 经历\n\n - 深圳房多多网络科技有限公司\n \t- 2015.8.24 - 今\n \t- 为IM选择较为稳定、适合快速迭代的IMSDK。\n \t- 负责C端IM模块的底层设计与开发，为IM业务逻辑提供数据支持。\n \t- 降低iOS的整体crash，分析并解决较为隐蔽的crash。\n \t- 负责C端主要项目模块，比如：自定义刷新动画组件、IM定制缓存数据库、等。\n \t- 为房多多建立公共代码库。\n\n\n - 福州淘股网络技术有限公司\n \t- 2015.5 - 2015.8\n \t- 为淘股吧iOS端的构建提供项目架构设计与支持。\n \t- 统一主题变更的思路以及方案。\n \t- 以数据作为整体驱动的思想，构建从网络到UI再到网络的项目架构。\n\n\n - 上海商路网络科技有限公司\n \t- 2014.10 - 2015.5\n \t- 将<肌肤管家>APP从外包接手并大部分重构至普通开发者可维护。\n \t- 独立开发并维护该社区活动类APP。\n\n\n ## 个人技能\n\n - 熟练掌握C/C++、Objective-c、Swift等编程语言\n - 熟悉shell、ruby、python等脚本语言\n - 有良好的编程习惯、较强的分析并解决问题的能力，并能积极的分析并总结所遇到的问题\n - 对项目架构有一定的认识和把握，能够搭建较为优秀的项目框架\n - 对面向对象编程、面向切片编程、等编程思想在实践中的应用有一定的认识和理解\n - 对编码基础知识：线程、网络、布局、适配、Debug调试、等基础知识运用自如\n\n\n## 教育经历\n\n - 2011.6 - 2015.6 南阳理工大学 软件工程专业移动设备应用开发方向\n\n\n## 自我评价\n\n热衷于技术。一个典型处女座强迫症重度患者。并伴有代码洁癖。","slug":"about-me","published":1,"updated":"2017-03-08T08:25:34.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f8t0001l0uvzl8bebez","content":"<h2 id=\"基本信息\"><a href=\"#基本信息\" class=\"headerlink\" title=\"基本信息\"></a>基本信息</h2><ul>\n<li><strong>孙继刚</strong></li>\n<li>坐标: 上海</li>\n<li>e-mail: <a href=\"&#109;&#97;&#105;&#x6c;&#116;&#111;&#58;&#101;&#x2e;&#x6d;&#x61;&#100;&#x6f;&#114;&#100;&#105;&#x65;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;\">&#101;&#x2e;&#x6d;&#x61;&#100;&#x6f;&#114;&#100;&#105;&#x65;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;</a></li>\n<li>blog: <a href=\"https://madordie.github.io\">https://madordie.github.io</a></li>\n</ul>\n<h2 id=\"经历\"><a href=\"#经历\" class=\"headerlink\" title=\"经历\"></a>经历</h2><ul>\n<li>深圳房多多网络科技有限公司<ul>\n<li>2015.8.24 - 今</li>\n<li>为IM选择较为稳定、适合快速迭代的IMSDK。</li>\n<li>负责C端IM模块的底层设计与开发，为IM业务逻辑提供数据支持。</li>\n<li>降低iOS的整体crash，分析并解决较为隐蔽的crash。</li>\n<li>负责C端主要项目模块，比如：自定义刷新动画组件、IM定制缓存数据库、等。</li>\n<li>为房多多建立公共代码库。</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>福州淘股网络技术有限公司<ul>\n<li>2015.5 - 2015.8</li>\n<li>为淘股吧iOS端的构建提供项目架构设计与支持。</li>\n<li>统一主题变更的思路以及方案。</li>\n<li>以数据作为整体驱动的思想，构建从网络到UI再到网络的项目架构。</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>上海商路网络科技有限公司<ul>\n<li>2014.10 - 2015.5</li>\n<li>将&lt;肌肤管家&gt;APP从外包接手并大部分重构至普通开发者可维护。</li>\n<li>独立开发并维护该社区活动类APP。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"个人技能\"><a href=\"#个人技能\" class=\"headerlink\" title=\"个人技能\"></a>个人技能</h2><ul>\n<li>熟练掌握C/C++、Objective-c、Swift等编程语言</li>\n<li>熟悉shell、ruby、python等脚本语言</li>\n<li>有良好的编程习惯、较强的分析并解决问题的能力，并能积极的分析并总结所遇到的问题</li>\n<li>对项目架构有一定的认识和把握，能够搭建较为优秀的项目框架</li>\n<li>对面向对象编程、面向切片编程、等编程思想在实践中的应用有一定的认识和理解</li>\n<li>对编码基础知识：线程、网络、布局、适配、Debug调试、等基础知识运用自如</li>\n</ul>\n<h2 id=\"教育经历\"><a href=\"#教育经历\" class=\"headerlink\" title=\"教育经历\"></a>教育经历</h2><ul>\n<li>2011.6 - 2015.6 南阳理工大学 软件工程专业移动设备应用开发方向</li>\n</ul>\n<h2 id=\"自我评价\"><a href=\"#自我评价\" class=\"headerlink\" title=\"自我评价\"></a>自我评价</h2><p>热衷于技术。一个典型处女座强迫症重度患者。并伴有代码洁癖。</p>\n","excerpt":"","more":"<h2 id=\"基本信息\"><a href=\"#基本信息\" class=\"headerlink\" title=\"基本信息\"></a>基本信息</h2><ul>\n<li><strong>孙继刚</strong></li>\n<li>坐标: 上海</li>\n<li>e-mail: <a href=\"&#109;&#97;&#105;&#x6c;&#116;&#111;&#58;&#101;&#x2e;&#x6d;&#x61;&#100;&#x6f;&#114;&#100;&#105;&#x65;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;\">&#101;&#x2e;&#x6d;&#x61;&#100;&#x6f;&#114;&#100;&#105;&#x65;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;</a></li>\n<li>blog: <a href=\"https://madordie.github.io\">https://madordie.github.io</a></li>\n</ul>\n<h2 id=\"经历\"><a href=\"#经历\" class=\"headerlink\" title=\"经历\"></a>经历</h2><ul>\n<li>深圳房多多网络科技有限公司<ul>\n<li>2015.8.24 - 今</li>\n<li>为IM选择较为稳定、适合快速迭代的IMSDK。</li>\n<li>负责C端IM模块的底层设计与开发，为IM业务逻辑提供数据支持。</li>\n<li>降低iOS的整体crash，分析并解决较为隐蔽的crash。</li>\n<li>负责C端主要项目模块，比如：自定义刷新动画组件、IM定制缓存数据库、等。</li>\n<li>为房多多建立公共代码库。</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>福州淘股网络技术有限公司<ul>\n<li>2015.5 - 2015.8</li>\n<li>为淘股吧iOS端的构建提供项目架构设计与支持。</li>\n<li>统一主题变更的思路以及方案。</li>\n<li>以数据作为整体驱动的思想，构建从网络到UI再到网络的项目架构。</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>上海商路网络科技有限公司<ul>\n<li>2014.10 - 2015.5</li>\n<li>将&lt;肌肤管家&gt;APP从外包接手并大部分重构至普通开发者可维护。</li>\n<li>独立开发并维护该社区活动类APP。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"个人技能\"><a href=\"#个人技能\" class=\"headerlink\" title=\"个人技能\"></a>个人技能</h2><ul>\n<li>熟练掌握C/C++、Objective-c、Swift等编程语言</li>\n<li>熟悉shell、ruby、python等脚本语言</li>\n<li>有良好的编程习惯、较强的分析并解决问题的能力，并能积极的分析并总结所遇到的问题</li>\n<li>对项目架构有一定的认识和把握，能够搭建较为优秀的项目框架</li>\n<li>对面向对象编程、面向切片编程、等编程思想在实践中的应用有一定的认识和理解</li>\n<li>对编码基础知识：线程、网络、布局、适配、Debug调试、等基础知识运用自如</li>\n</ul>\n<h2 id=\"教育经历\"><a href=\"#教育经历\" class=\"headerlink\" title=\"教育经历\"></a>教育经历</h2><ul>\n<li>2011.6 - 2015.6 南阳理工大学 软件工程专业移动设备应用开发方向</li>\n</ul>\n<h2 id=\"自我评价\"><a href=\"#自我评价\" class=\"headerlink\" title=\"自我评价\"></a>自我评价</h2><p>热衷于技术。一个典型处女座强迫症重度患者。并伴有代码洁癖。</p>\n"},{"title":"博客迁移公告","date":"2016-07-05T05:43:36.000Z","_content":"\n你敢信！我又搬家了。。\n\n之前在[博客园](http://www.cnblogs.com/madordie/)后来又去了[蚂蚁笔记](http://madordie.leanote.com)，最后吧，我就到了[这里](https://madordie.github.io)。\n\n说下大体感受：\n\n[博客园](http://www.cnblogs.com)挺好的，不过不喜欢其编码方式，真的不喜欢。博客园的主题什么的都是可以定制，但是总归是写起来比较费劲的。\n\n[蚂蚁笔记](https://leanote.com)不错，我开始时候logo还不是这个<img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/leanote_new_logo.png\" width=35 alt=\"新logo\">原来logo是<img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/leanote_old_logo.png\" width=35 alt=\"旧logo\" >😂,不过现在已经很厉害了，开始了各种业务。期待会走得更好更远。\n\n我是看了[巧哥](http://blog.devtang.com)的[这个博文](http://blog.devtang.com/2012/02/10/setup-blog-based-on-github/)才开始准备转到Github的。。赶脚markdown很好玩，虽然出来很早了，但是并没有仔细的去学习这个语法，于是乎这个博客就用[hexo](https://hexo.io)进行搭建。\n\n虽然我还不知道怎么让百度收录我的Github，但是主要的是能尝试着自己想试试确没有尝试的事情！","source":"_posts/about-change-blog.md","raw":"---\ntitle: 博客迁移公告\ndate: 2016-07-05 13:43:36\ncategories: 公告\n---\n\n你敢信！我又搬家了。。\n\n之前在[博客园](http://www.cnblogs.com/madordie/)后来又去了[蚂蚁笔记](http://madordie.leanote.com)，最后吧，我就到了[这里](https://madordie.github.io)。\n\n说下大体感受：\n\n[博客园](http://www.cnblogs.com)挺好的，不过不喜欢其编码方式，真的不喜欢。博客园的主题什么的都是可以定制，但是总归是写起来比较费劲的。\n\n[蚂蚁笔记](https://leanote.com)不错，我开始时候logo还不是这个<img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/leanote_new_logo.png\" width=35 alt=\"新logo\">原来logo是<img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/leanote_old_logo.png\" width=35 alt=\"旧logo\" >😂,不过现在已经很厉害了，开始了各种业务。期待会走得更好更远。\n\n我是看了[巧哥](http://blog.devtang.com)的[这个博文](http://blog.devtang.com/2012/02/10/setup-blog-based-on-github/)才开始准备转到Github的。。赶脚markdown很好玩，虽然出来很早了，但是并没有仔细的去学习这个语法，于是乎这个博客就用[hexo](https://hexo.io)进行搭建。\n\n虽然我还不知道怎么让百度收录我的Github，但是主要的是能尝试着自己想试试确没有尝试的事情！","slug":"about-change-blog","published":1,"updated":"2016-07-25T00:09:51.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f8z0003l0uvr7nzyyp9","content":"<p>你敢信！我又搬家了。。</p>\n<p>之前在<a href=\"http://www.cnblogs.com/madordie/\" target=\"_blank\" rel=\"external\">博客园</a>后来又去了<a href=\"http://madordie.leanote.com\" target=\"_blank\" rel=\"external\">蚂蚁笔记</a>，最后吧，我就到了<a href=\"https://madordie.github.io\">这里</a>。</p>\n<p>说下大体感受：</p>\n<p><a href=\"http://www.cnblogs.com\" target=\"_blank\" rel=\"external\">博客园</a>挺好的，不过不喜欢其编码方式，真的不喜欢。博客园的主题什么的都是可以定制，但是总归是写起来比较费劲的。</p>\n<p><a href=\"https://leanote.com\" target=\"_blank\" rel=\"external\">蚂蚁笔记</a>不错，我开始时候logo还不是这个<img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/leanote_new_logo.png\" width=\"35\" alt=\"新logo\">原来logo是<img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/leanote_old_logo.png\" width=\"35\" alt=\"旧logo\">😂,不过现在已经很厉害了，开始了各种业务。期待会走得更好更远。</p>\n<p>我是看了<a href=\"http://blog.devtang.com\" target=\"_blank\" rel=\"external\">巧哥</a>的<a href=\"http://blog.devtang.com/2012/02/10/setup-blog-based-on-github/\" target=\"_blank\" rel=\"external\">这个博文</a>才开始准备转到Github的。。赶脚markdown很好玩，虽然出来很早了，但是并没有仔细的去学习这个语法，于是乎这个博客就用<a href=\"https://hexo.io\" target=\"_blank\" rel=\"external\">hexo</a>进行搭建。</p>\n<p>虽然我还不知道怎么让百度收录我的Github，但是主要的是能尝试着自己想试试确没有尝试的事情！</p>\n","excerpt":"","more":"<p>你敢信！我又搬家了。。</p>\n<p>之前在<a href=\"http://www.cnblogs.com/madordie/\">博客园</a>后来又去了<a href=\"http://madordie.leanote.com\">蚂蚁笔记</a>，最后吧，我就到了<a href=\"https://madordie.github.io\">这里</a>。</p>\n<p>说下大体感受：</p>\n<p><a href=\"http://www.cnblogs.com\">博客园</a>挺好的，不过不喜欢其编码方式，真的不喜欢。博客园的主题什么的都是可以定制，但是总归是写起来比较费劲的。</p>\n<p><a href=\"https://leanote.com\">蚂蚁笔记</a>不错，我开始时候logo还不是这个<img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/leanote_new_logo.png\" width=35 alt=\"新logo\">原来logo是<img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/leanote_old_logo.png\" width=35 alt=\"旧logo\" >😂,不过现在已经很厉害了，开始了各种业务。期待会走得更好更远。</p>\n<p>我是看了<a href=\"http://blog.devtang.com\">巧哥</a>的<a href=\"http://blog.devtang.com/2012/02/10/setup-blog-based-on-github/\">这个博文</a>才开始准备转到Github的。。赶脚markdown很好玩，虽然出来很早了，但是并没有仔细的去学习这个语法，于是乎这个博客就用<a href=\"https://hexo.io\">hexo</a>进行搭建。</p>\n<p>虽然我还不知道怎么让百度收录我的Github，但是主要的是能尝试着自己想试试确没有尝试的事情！</p>\n"},{"title":"项目中的UITableView","_content":"\n前两天听到有人说多人合作的项目并不需要处理很多事情，只需要处理好自己的那部分业务逻辑就好了。感觉这是一个很不负责任的说法。\n\n作为一个APP的开发者，自己负责的事其中的一个模块，但是都是这个APP的开发者，也要往里面塞代码，如果每个人都用不同的逻辑风格去组织代码。那么整个项目就是一坨坨坨，这个坨会影响项目的演进、日后的发展。\n\n当然有的是看不出来的，比如说：当一个请假的人写的代码出现一个BUG，需要修复上线的时候，对于不同的代码风格，需要找到问题的关键代码，这个过程是撕心裂肺的，但是如果同一套代码风格，心中就会有一个大致的位置，去修改时候就会比较快速的定位问题。\n\n<!--more-->\n\n# 从协议入手\n\n`UITableView`是项目中非常常见的iOS高级控件，在页面中所有相似的页面几乎都是由该控件进行完成。其广泛运用的不止是使用方便，最主要的是内部的复用优化也是相当给力的。\n\n\n## 协议模式下的UITableView\n\n`UITableView`是典型的 __协议-代理模式__ ，比例`id <UITableViewDataSource> dataSource`和`id <UITableViewDelegate> delegate`，所以使用对于这种比较规整的列表来说把协议继续扩展到下一级也是可以的。\n\n为了统一`UITableView.dataSource`和`UITableView.delegate`，构建如下协议：\n```objc\n//  直接填充Cell的cellModel\n@protocol CellModelProtocol <NSObject>\n\n- (NSString *)cellClassName;  //  cellModel绑定的类名\n- (void)cellModelForCell:(UITableViewCell *)cell; //  cellModel填充上面绑定的cell\n\n@end\n\n```\n\n\n那么只需要在代理中做如下设置:\n\n```objc\n#pragma mark <UITableViewDelegate, UITableViewDataSource>\n- (NSInteger)numberOfSectionsInTableView:(UITableView*)tableView\n{\n    return 1;\n}\n- (NSInteger)tableView:(UITableView*)tableView numberOfRowsInSection:(NSInteger)section\n{\n    return self.viewModel.dataSource.count;\n}\n- (UITableViewCell*)tableView:(UITableView*)tableView cellForRowAtIndexPath:(NSIndexPath*)indexPath\n{\n      id<CellModelProtocol> cellModel = self.viewModel.dataSource[indexPath.row];\n      UITableViewCell* cell = [tableView dequeueReusableCellWithIdentifier:[cellModel cellClassName]];\n      cell.frame = tableView.bounds;\n      [cellModel cellModelForCell:cell];\n      [cell sizeToFit];\n      return cell;\n}\n- (CGFloat)tableView:(UITableView*)tableView heightForRowAtIndexPath:(NSIndexPath*)indexPath\n{\n      id<CellModelProtocol> cellModel = self.viewModel.dataSource[indexPath.row];\n      UITableViewCell* cell = [tableView ktj_cacheHeightCellForReuseIDFA:[cellModel cellClassName]];\n      [cellModel cellModelForCell:cell];\n      return [cell sizeThatFits:tableView.bounds.size].height;\n}\n\n```\n\n而在cell中，默认在`sizeThatFits:`中进行布局的设置和算高即可。如下：\n\n```objc\n//  xxxCell.m\n\n- (CGSize)sizeThatFits:(CGSize)size {\n    \n    CGRect frame = CGRectZero;\n    //  根据Cell的实际内容进行布局并设置高度\n    frame.origin = CGPointMake(10, 15);\n    frame.size = [self.infoLabel sizeThatFits:CGSizeMake(size.width-frame.origin.x*2, size.height)];\n    self.infoLabel.frame = frame;\n    \n    size.height = CGRectGetMaxY(self.infoLabel.frame)+frame.origin.y;\n    return size;\n}\n\n```\n\n如果cell采用autolayout，则计算采用[UITableView-FDTemplateLayoutCell](https://github.com/forkingdog/UITableView-FDTemplateLayoutCell/blob/e3ee86ce419d18d3ff735056f1474f2863e43003/Classes/UITableView%2BFDTemplateLayoutCell.m)的计算方法。\n\n```objc\n@implementation UITableViewCell (KTJCellAutoLayoutForSize)\n//  autolout布局计算高度\n- (CGSize)ktj_ALCellSizeThatFits:(CGSize)size {\n    // Add a hard width constraint to make dynamic content views (like labels) expand vertically instead\n    // of growing horizontally, in a flow-layout manner.\n    NSLayoutConstraint *tempWidthConstraint =\n    [NSLayoutConstraint constraintWithItem:self.contentView\n                                 attribute:NSLayoutAttributeWidth\n                                 relatedBy:NSLayoutRelationEqual\n                                    toItem:nil\n                                 attribute:NSLayoutAttributeNotAnAttribute\n                                multiplier:1.0\n                                  constant:size.width];\n    [self.contentView addConstraint:tempWidthConstraint];\n    // Auto layout engine does its math\n    size = [self.contentView systemLayoutSizeFittingSize:UILayoutFittingCompressedSize];\n    size.height += 1;\n    [self.contentView removeConstraint:tempWidthConstraint];\n    return size;\n}\n@end\n\n```\n\n另外在`<UITableViewDelegate, UITableViewDataSource>`中只写了1组，只有cell，没有header、footer的情况，如果需要，炮制即可。\n\n说一下这个其中的`ktj_cacheHeightCellForReuseIDFA:`类别方法。这个方法是为了算高进行缓存的一个cell，这个cell保存在 `NSCache`中。所以为了统一，需要在数据初始化时候注册所有的cell。当然你也可以根据类名直接生成，这个自主决定。\n\n说到算高，需要说一下这其中的`dequeueReusableCellWithIdentifier:`方法。该方法是从tableView的缓存池中取出指定ID的cell。请注意是 __取出__ ，并且`UITableView`并没有暴露出如何放进缓存池，也没有必要暴露出放进缓存池的方法。\n\n而且`UITableView`只有一个地方能够接收Cell那就是`tableView:cellForRowAtIndexPath:`。所以请保证`dequeueReusableCellWithIdentifier:`取出的方法 __需要通过`tableView:cellForRowAtIndexPath:`返回给`UITableView`__ 。这就是我上面说的`ktj_cacheHeightCellForReuseIDFA:`方法为何要做一个 cache去缓存我取出的cell，目的是为了减少cell的浪费。\n\n\n同理，对于`UITableView`的`headerView`、`footerView`来说，可以炮制以上协议、方法。不再赘述\n\n\nPS.\n  1. [UITableView-FDTemplateLayoutCell](https://github.com/forkingdog/UITableView-FDTemplateLayoutCell): [sunnyxx](https://github.com/sunnyxx)打造的优化UITableView的一个库，6000的star，很赞。\n  \n\n# 规范化的代码风格\n\n对于多人开发，最崩溃的事情就要数去读别人的代码。就算不是多人开发，接手别人的代码也是让人最崩溃的事情。如果有不用考虑这件事的叫我！\n\n不同的公司可以有不同的代码风格，但是一个公司的代码风格需要保持一致，这样就不会出现一人请假，无人能接受项目的尴尬局面，就算能接，也是需要为了加一个逻辑判断，需要花费很大的精力去处理。\n\n至于其中的代码不统一的坑，恐怕要等踩过才知道吧😂。\n\n\n# 业务逻辑的拆分\n\n对于复杂的业务逻辑，对其拆分是非常重要的，不拆分很可能写出来的代码一个文件 >1000 行。复杂的业务逻辑对于写出来需要一气呵成，修改起来也就出现了牵一发动全身(虽然拆分完成之后可能也会关键逻辑代码不可拆分，但是会好很多)。\n\n\n## 筛选重构\n\n筛选主要处理的是筛选项，针对众多筛选条件拆分为不同的业务逻辑模块是必须的。遵照拆分的原则，于是乎根据UI划分出来位置、价格、户型、筛选、排序这么几个模块。针对每个模块自行处理选中数据、UI展示。对外只暴露选中项输入和选中回调。\n\n对于每个数据大致都可分为一个列表，然后可选中1项或多项。于是乎，这个代码如果不拉出来是要写好多次的，拉出来，但是选中需要把选中的逻辑扔出来，方便自定义。\n","source":"_posts/about-project-tableview.md","raw":"---\ntitle: 项目中的UITableView\ntags:\n  - iOS\n  - 牢骚\n---\n\n前两天听到有人说多人合作的项目并不需要处理很多事情，只需要处理好自己的那部分业务逻辑就好了。感觉这是一个很不负责任的说法。\n\n作为一个APP的开发者，自己负责的事其中的一个模块，但是都是这个APP的开发者，也要往里面塞代码，如果每个人都用不同的逻辑风格去组织代码。那么整个项目就是一坨坨坨，这个坨会影响项目的演进、日后的发展。\n\n当然有的是看不出来的，比如说：当一个请假的人写的代码出现一个BUG，需要修复上线的时候，对于不同的代码风格，需要找到问题的关键代码，这个过程是撕心裂肺的，但是如果同一套代码风格，心中就会有一个大致的位置，去修改时候就会比较快速的定位问题。\n\n<!--more-->\n\n# 从协议入手\n\n`UITableView`是项目中非常常见的iOS高级控件，在页面中所有相似的页面几乎都是由该控件进行完成。其广泛运用的不止是使用方便，最主要的是内部的复用优化也是相当给力的。\n\n\n## 协议模式下的UITableView\n\n`UITableView`是典型的 __协议-代理模式__ ，比例`id <UITableViewDataSource> dataSource`和`id <UITableViewDelegate> delegate`，所以使用对于这种比较规整的列表来说把协议继续扩展到下一级也是可以的。\n\n为了统一`UITableView.dataSource`和`UITableView.delegate`，构建如下协议：\n```objc\n//  直接填充Cell的cellModel\n@protocol CellModelProtocol <NSObject>\n\n- (NSString *)cellClassName;  //  cellModel绑定的类名\n- (void)cellModelForCell:(UITableViewCell *)cell; //  cellModel填充上面绑定的cell\n\n@end\n\n```\n\n\n那么只需要在代理中做如下设置:\n\n```objc\n#pragma mark <UITableViewDelegate, UITableViewDataSource>\n- (NSInteger)numberOfSectionsInTableView:(UITableView*)tableView\n{\n    return 1;\n}\n- (NSInteger)tableView:(UITableView*)tableView numberOfRowsInSection:(NSInteger)section\n{\n    return self.viewModel.dataSource.count;\n}\n- (UITableViewCell*)tableView:(UITableView*)tableView cellForRowAtIndexPath:(NSIndexPath*)indexPath\n{\n      id<CellModelProtocol> cellModel = self.viewModel.dataSource[indexPath.row];\n      UITableViewCell* cell = [tableView dequeueReusableCellWithIdentifier:[cellModel cellClassName]];\n      cell.frame = tableView.bounds;\n      [cellModel cellModelForCell:cell];\n      [cell sizeToFit];\n      return cell;\n}\n- (CGFloat)tableView:(UITableView*)tableView heightForRowAtIndexPath:(NSIndexPath*)indexPath\n{\n      id<CellModelProtocol> cellModel = self.viewModel.dataSource[indexPath.row];\n      UITableViewCell* cell = [tableView ktj_cacheHeightCellForReuseIDFA:[cellModel cellClassName]];\n      [cellModel cellModelForCell:cell];\n      return [cell sizeThatFits:tableView.bounds.size].height;\n}\n\n```\n\n而在cell中，默认在`sizeThatFits:`中进行布局的设置和算高即可。如下：\n\n```objc\n//  xxxCell.m\n\n- (CGSize)sizeThatFits:(CGSize)size {\n    \n    CGRect frame = CGRectZero;\n    //  根据Cell的实际内容进行布局并设置高度\n    frame.origin = CGPointMake(10, 15);\n    frame.size = [self.infoLabel sizeThatFits:CGSizeMake(size.width-frame.origin.x*2, size.height)];\n    self.infoLabel.frame = frame;\n    \n    size.height = CGRectGetMaxY(self.infoLabel.frame)+frame.origin.y;\n    return size;\n}\n\n```\n\n如果cell采用autolayout，则计算采用[UITableView-FDTemplateLayoutCell](https://github.com/forkingdog/UITableView-FDTemplateLayoutCell/blob/e3ee86ce419d18d3ff735056f1474f2863e43003/Classes/UITableView%2BFDTemplateLayoutCell.m)的计算方法。\n\n```objc\n@implementation UITableViewCell (KTJCellAutoLayoutForSize)\n//  autolout布局计算高度\n- (CGSize)ktj_ALCellSizeThatFits:(CGSize)size {\n    // Add a hard width constraint to make dynamic content views (like labels) expand vertically instead\n    // of growing horizontally, in a flow-layout manner.\n    NSLayoutConstraint *tempWidthConstraint =\n    [NSLayoutConstraint constraintWithItem:self.contentView\n                                 attribute:NSLayoutAttributeWidth\n                                 relatedBy:NSLayoutRelationEqual\n                                    toItem:nil\n                                 attribute:NSLayoutAttributeNotAnAttribute\n                                multiplier:1.0\n                                  constant:size.width];\n    [self.contentView addConstraint:tempWidthConstraint];\n    // Auto layout engine does its math\n    size = [self.contentView systemLayoutSizeFittingSize:UILayoutFittingCompressedSize];\n    size.height += 1;\n    [self.contentView removeConstraint:tempWidthConstraint];\n    return size;\n}\n@end\n\n```\n\n另外在`<UITableViewDelegate, UITableViewDataSource>`中只写了1组，只有cell，没有header、footer的情况，如果需要，炮制即可。\n\n说一下这个其中的`ktj_cacheHeightCellForReuseIDFA:`类别方法。这个方法是为了算高进行缓存的一个cell，这个cell保存在 `NSCache`中。所以为了统一，需要在数据初始化时候注册所有的cell。当然你也可以根据类名直接生成，这个自主决定。\n\n说到算高，需要说一下这其中的`dequeueReusableCellWithIdentifier:`方法。该方法是从tableView的缓存池中取出指定ID的cell。请注意是 __取出__ ，并且`UITableView`并没有暴露出如何放进缓存池，也没有必要暴露出放进缓存池的方法。\n\n而且`UITableView`只有一个地方能够接收Cell那就是`tableView:cellForRowAtIndexPath:`。所以请保证`dequeueReusableCellWithIdentifier:`取出的方法 __需要通过`tableView:cellForRowAtIndexPath:`返回给`UITableView`__ 。这就是我上面说的`ktj_cacheHeightCellForReuseIDFA:`方法为何要做一个 cache去缓存我取出的cell，目的是为了减少cell的浪费。\n\n\n同理，对于`UITableView`的`headerView`、`footerView`来说，可以炮制以上协议、方法。不再赘述\n\n\nPS.\n  1. [UITableView-FDTemplateLayoutCell](https://github.com/forkingdog/UITableView-FDTemplateLayoutCell): [sunnyxx](https://github.com/sunnyxx)打造的优化UITableView的一个库，6000的star，很赞。\n  \n\n# 规范化的代码风格\n\n对于多人开发，最崩溃的事情就要数去读别人的代码。就算不是多人开发，接手别人的代码也是让人最崩溃的事情。如果有不用考虑这件事的叫我！\n\n不同的公司可以有不同的代码风格，但是一个公司的代码风格需要保持一致，这样就不会出现一人请假，无人能接受项目的尴尬局面，就算能接，也是需要为了加一个逻辑判断，需要花费很大的精力去处理。\n\n至于其中的代码不统一的坑，恐怕要等踩过才知道吧😂。\n\n\n# 业务逻辑的拆分\n\n对于复杂的业务逻辑，对其拆分是非常重要的，不拆分很可能写出来的代码一个文件 >1000 行。复杂的业务逻辑对于写出来需要一气呵成，修改起来也就出现了牵一发动全身(虽然拆分完成之后可能也会关键逻辑代码不可拆分，但是会好很多)。\n\n\n## 筛选重构\n\n筛选主要处理的是筛选项，针对众多筛选条件拆分为不同的业务逻辑模块是必须的。遵照拆分的原则，于是乎根据UI划分出来位置、价格、户型、筛选、排序这么几个模块。针对每个模块自行处理选中数据、UI展示。对外只暴露选中项输入和选中回调。\n\n对于每个数据大致都可分为一个列表，然后可选中1项或多项。于是乎，这个代码如果不拉出来是要写好多次的，拉出来，但是选中需要把选中的逻辑扔出来，方便自定义。\n","slug":"about-project-tableview","published":1,"date":"2016-07-27T05:30:45.000Z","updated":"2017-03-25T04:09:09.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f940005l0uvpofcntmw","content":"<p>前两天听到有人说多人合作的项目并不需要处理很多事情，只需要处理好自己的那部分业务逻辑就好了。感觉这是一个很不负责任的说法。</p>\n<p>作为一个APP的开发者，自己负责的事其中的一个模块，但是都是这个APP的开发者，也要往里面塞代码，如果每个人都用不同的逻辑风格去组织代码。那么整个项目就是一坨坨坨，这个坨会影响项目的演进、日后的发展。</p>\n<p>当然有的是看不出来的，比如说：当一个请假的人写的代码出现一个BUG，需要修复上线的时候，对于不同的代码风格，需要找到问题的关键代码，这个过程是撕心裂肺的，但是如果同一套代码风格，心中就会有一个大致的位置，去修改时候就会比较快速的定位问题。</p>\n<a id=\"more\"></a>\n<h1 id=\"从协议入手\"><a href=\"#从协议入手\" class=\"headerlink\" title=\"从协议入手\"></a>从协议入手</h1><p><code>UITableView</code>是项目中非常常见的iOS高级控件，在页面中所有相似的页面几乎都是由该控件进行完成。其广泛运用的不止是使用方便，最主要的是内部的复用优化也是相当给力的。</p>\n<h2 id=\"协议模式下的UITableView\"><a href=\"#协议模式下的UITableView\" class=\"headerlink\" title=\"协议模式下的UITableView\"></a>协议模式下的UITableView</h2><p><code>UITableView</code>是典型的 <strong>协议-代理模式</strong> ，比例<code>id &lt;UITableViewDataSource&gt; dataSource</code>和<code>id &lt;UITableViewDelegate&gt; delegate</code>，所以使用对于这种比较规整的列表来说把协议继续扩展到下一级也是可以的。</p>\n<p>为了统一<code>UITableView.dataSource</code>和<code>UITableView.delegate</code>，构建如下协议：<br><figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//  直接填充Cell的cellModel</span></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">@protocol</span> <span class=\"title\">CellModelProtocol</span> &lt;<span class=\"title\">NSObject</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">- (<span class=\"built_in\">NSString</span> *)cellClassName;  <span class=\"comment\">//  cellModel绑定的类名</span></div><div class=\"line\">- (<span class=\"keyword\">void</span>)cellModelForCell:(<span class=\"built_in\">UITableViewCell</span> *)cell; <span class=\"comment\">//  cellModel填充上面绑定的cell</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">@end</span></div></pre></td></tr></table></figure></p>\n<p>那么只需要在代理中做如下设置:</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#pragma mark <span class=\"meta-string\">&lt;UITableViewDelegate, UITableViewDataSource&gt;</span></span></div><div class=\"line\">- (<span class=\"built_in\">NSInteger</span>)numberOfSectionsInTableView:(<span class=\"built_in\">UITableView</span>*)tableView</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\">- (<span class=\"built_in\">NSInteger</span>)tableView:(<span class=\"built_in\">UITableView</span>*)tableView numberOfRowsInSection:(<span class=\"built_in\">NSInteger</span>)section</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.viewModel.dataSource.count;</div><div class=\"line\">&#125;</div><div class=\"line\">- (<span class=\"built_in\">UITableViewCell</span>*)tableView:(<span class=\"built_in\">UITableView</span>*)tableView cellForRowAtIndexPath:(<span class=\"built_in\">NSIndexPath</span>*)indexPath</div><div class=\"line\">&#123;</div><div class=\"line\">      <span class=\"keyword\">id</span>&lt;CellModelProtocol&gt; cellModel = <span class=\"keyword\">self</span>.viewModel.dataSource[indexPath.row];</div><div class=\"line\">      <span class=\"built_in\">UITableViewCell</span>* cell = [tableView dequeueReusableCellWithIdentifier:[cellModel cellClassName]];</div><div class=\"line\">      cell.frame = tableView.bounds;</div><div class=\"line\">      [cellModel cellModelForCell:cell];</div><div class=\"line\">      [cell sizeToFit];</div><div class=\"line\">      <span class=\"keyword\">return</span> cell;</div><div class=\"line\">&#125;</div><div class=\"line\">- (<span class=\"built_in\">CGFloat</span>)tableView:(<span class=\"built_in\">UITableView</span>*)tableView heightForRowAtIndexPath:(<span class=\"built_in\">NSIndexPath</span>*)indexPath</div><div class=\"line\">&#123;</div><div class=\"line\">      <span class=\"keyword\">id</span>&lt;CellModelProtocol&gt; cellModel = <span class=\"keyword\">self</span>.viewModel.dataSource[indexPath.row];</div><div class=\"line\">      <span class=\"built_in\">UITableViewCell</span>* cell = [tableView ktj_cacheHeightCellForReuseIDFA:[cellModel cellClassName]];</div><div class=\"line\">      [cellModel cellModelForCell:cell];</div><div class=\"line\">      <span class=\"keyword\">return</span> [cell sizeThatFits:tableView.bounds.size].height;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>而在cell中，默认在<code>sizeThatFits:</code>中进行布局的设置和算高即可。如下：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//  xxxCell.m</span></div><div class=\"line\"></div><div class=\"line\">- (<span class=\"built_in\">CGSize</span>)sizeThatFits:(<span class=\"built_in\">CGSize</span>)size &#123;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"built_in\">CGRect</span> frame = <span class=\"built_in\">CGRectZero</span>;</div><div class=\"line\">    <span class=\"comment\">//  根据Cell的实际内容进行布局并设置高度</span></div><div class=\"line\">    frame.origin = <span class=\"built_in\">CGPointMake</span>(<span class=\"number\">10</span>, <span class=\"number\">15</span>);</div><div class=\"line\">    frame.size = [<span class=\"keyword\">self</span>.infoLabel sizeThatFits:<span class=\"built_in\">CGSizeMake</span>(size.width-frame.origin.x*<span class=\"number\">2</span>, size.height)];</div><div class=\"line\">    <span class=\"keyword\">self</span>.infoLabel.frame = frame;</div><div class=\"line\">    </div><div class=\"line\">    size.height = <span class=\"built_in\">CGRectGetMaxY</span>(<span class=\"keyword\">self</span>.infoLabel.frame)+frame.origin.y;</div><div class=\"line\">    <span class=\"keyword\">return</span> size;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>如果cell采用autolayout，则计算采用<a href=\"https://github.com/forkingdog/UITableView-FDTemplateLayoutCell/blob/e3ee86ce419d18d3ff735056f1474f2863e43003/Classes/UITableView%2BFDTemplateLayoutCell.m\" target=\"_blank\" rel=\"external\">UITableView-FDTemplateLayoutCell</a>的计算方法。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">UITableViewCell</span> (<span class=\"title\">KTJCellAutoLayoutForSize</span>)</span></div><div class=\"line\"><span class=\"comment\">//  autolout布局计算高度</span></div><div class=\"line\">- (<span class=\"built_in\">CGSize</span>)ktj_ALCellSizeThatFits:(<span class=\"built_in\">CGSize</span>)size &#123;</div><div class=\"line\">    <span class=\"comment\">// Add a hard width constraint to make dynamic content views (like labels) expand vertically instead</span></div><div class=\"line\">    <span class=\"comment\">// of growing horizontally, in a flow-layout manner.</span></div><div class=\"line\">    <span class=\"built_in\">NSLayoutConstraint</span> *tempWidthConstraint =</div><div class=\"line\">    [<span class=\"built_in\">NSLayoutConstraint</span> constraintWithItem:<span class=\"keyword\">self</span>.contentView</div><div class=\"line\">                                 attribute:<span class=\"built_in\">NSLayoutAttributeWidth</span></div><div class=\"line\">                                 relatedBy:<span class=\"built_in\">NSLayoutRelationEqual</span></div><div class=\"line\">                                    toItem:<span class=\"literal\">nil</span></div><div class=\"line\">                                 attribute:<span class=\"built_in\">NSLayoutAttributeNotAnAttribute</span></div><div class=\"line\">                                multiplier:<span class=\"number\">1.0</span></div><div class=\"line\">                                  constant:size.width];</div><div class=\"line\">    [<span class=\"keyword\">self</span>.contentView addConstraint:tempWidthConstraint];</div><div class=\"line\">    <span class=\"comment\">// Auto layout engine does its math</span></div><div class=\"line\">    size = [<span class=\"keyword\">self</span>.contentView systemLayoutSizeFittingSize:<span class=\"built_in\">UILayoutFittingCompressedSize</span>];</div><div class=\"line\">    size.height += <span class=\"number\">1</span>;</div><div class=\"line\">    [<span class=\"keyword\">self</span>.contentView removeConstraint:tempWidthConstraint];</div><div class=\"line\">    <span class=\"keyword\">return</span> size;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">@end</span></div></pre></td></tr></table></figure>\n<p>另外在<code>&lt;UITableViewDelegate, UITableViewDataSource&gt;</code>中只写了1组，只有cell，没有header、footer的情况，如果需要，炮制即可。</p>\n<p>说一下这个其中的<code>ktj_cacheHeightCellForReuseIDFA:</code>类别方法。这个方法是为了算高进行缓存的一个cell，这个cell保存在 <code>NSCache</code>中。所以为了统一，需要在数据初始化时候注册所有的cell。当然你也可以根据类名直接生成，这个自主决定。</p>\n<p>说到算高，需要说一下这其中的<code>dequeueReusableCellWithIdentifier:</code>方法。该方法是从tableView的缓存池中取出指定ID的cell。请注意是 <strong>取出</strong> ，并且<code>UITableView</code>并没有暴露出如何放进缓存池，也没有必要暴露出放进缓存池的方法。</p>\n<p>而且<code>UITableView</code>只有一个地方能够接收Cell那就是<code>tableView:cellForRowAtIndexPath:</code>。所以请保证<code>dequeueReusableCellWithIdentifier:</code>取出的方法 <strong>需要通过<code>tableView:cellForRowAtIndexPath:</code>返回给<code>UITableView</code></strong> 。这就是我上面说的<code>ktj_cacheHeightCellForReuseIDFA:</code>方法为何要做一个 cache去缓存我取出的cell，目的是为了减少cell的浪费。</p>\n<p>同理，对于<code>UITableView</code>的<code>headerView</code>、<code>footerView</code>来说，可以炮制以上协议、方法。不再赘述</p>\n<p>PS.</p>\n<ol>\n<li><a href=\"https://github.com/forkingdog/UITableView-FDTemplateLayoutCell\" target=\"_blank\" rel=\"external\">UITableView-FDTemplateLayoutCell</a>: <a href=\"https://github.com/sunnyxx\" target=\"_blank\" rel=\"external\">sunnyxx</a>打造的优化UITableView的一个库，6000的star，很赞。</li>\n</ol>\n<h1 id=\"规范化的代码风格\"><a href=\"#规范化的代码风格\" class=\"headerlink\" title=\"规范化的代码风格\"></a>规范化的代码风格</h1><p>对于多人开发，最崩溃的事情就要数去读别人的代码。就算不是多人开发，接手别人的代码也是让人最崩溃的事情。如果有不用考虑这件事的叫我！</p>\n<p>不同的公司可以有不同的代码风格，但是一个公司的代码风格需要保持一致，这样就不会出现一人请假，无人能接受项目的尴尬局面，就算能接，也是需要为了加一个逻辑判断，需要花费很大的精力去处理。</p>\n<p>至于其中的代码不统一的坑，恐怕要等踩过才知道吧😂。</p>\n<h1 id=\"业务逻辑的拆分\"><a href=\"#业务逻辑的拆分\" class=\"headerlink\" title=\"业务逻辑的拆分\"></a>业务逻辑的拆分</h1><p>对于复杂的业务逻辑，对其拆分是非常重要的，不拆分很可能写出来的代码一个文件 &gt;1000 行。复杂的业务逻辑对于写出来需要一气呵成，修改起来也就出现了牵一发动全身(虽然拆分完成之后可能也会关键逻辑代码不可拆分，但是会好很多)。</p>\n<h2 id=\"筛选重构\"><a href=\"#筛选重构\" class=\"headerlink\" title=\"筛选重构\"></a>筛选重构</h2><p>筛选主要处理的是筛选项，针对众多筛选条件拆分为不同的业务逻辑模块是必须的。遵照拆分的原则，于是乎根据UI划分出来位置、价格、户型、筛选、排序这么几个模块。针对每个模块自行处理选中数据、UI展示。对外只暴露选中项输入和选中回调。</p>\n<p>对于每个数据大致都可分为一个列表，然后可选中1项或多项。于是乎，这个代码如果不拉出来是要写好多次的，拉出来，但是选中需要把选中的逻辑扔出来，方便自定义。</p>\n","excerpt":"<p>前两天听到有人说多人合作的项目并不需要处理很多事情，只需要处理好自己的那部分业务逻辑就好了。感觉这是一个很不负责任的说法。</p>\n<p>作为一个APP的开发者，自己负责的事其中的一个模块，但是都是这个APP的开发者，也要往里面塞代码，如果每个人都用不同的逻辑风格去组织代码。那么整个项目就是一坨坨坨，这个坨会影响项目的演进、日后的发展。</p>\n<p>当然有的是看不出来的，比如说：当一个请假的人写的代码出现一个BUG，需要修复上线的时候，对于不同的代码风格，需要找到问题的关键代码，这个过程是撕心裂肺的，但是如果同一套代码风格，心中就会有一个大致的位置，去修改时候就会比较快速的定位问题。</p>","more":"<h1 id=\"从协议入手\"><a href=\"#从协议入手\" class=\"headerlink\" title=\"从协议入手\"></a>从协议入手</h1><p><code>UITableView</code>是项目中非常常见的iOS高级控件，在页面中所有相似的页面几乎都是由该控件进行完成。其广泛运用的不止是使用方便，最主要的是内部的复用优化也是相当给力的。</p>\n<h2 id=\"协议模式下的UITableView\"><a href=\"#协议模式下的UITableView\" class=\"headerlink\" title=\"协议模式下的UITableView\"></a>协议模式下的UITableView</h2><p><code>UITableView</code>是典型的 <strong>协议-代理模式</strong> ，比例<code>id &lt;UITableViewDataSource&gt; dataSource</code>和<code>id &lt;UITableViewDelegate&gt; delegate</code>，所以使用对于这种比较规整的列表来说把协议继续扩展到下一级也是可以的。</p>\n<p>为了统一<code>UITableView.dataSource</code>和<code>UITableView.delegate</code>，构建如下协议：<br><figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//  直接填充Cell的cellModel</span></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">@protocol</span> <span class=\"title\">CellModelProtocol</span> &lt;<span class=\"title\">NSObject</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">- (<span class=\"built_in\">NSString</span> *)cellClassName;  <span class=\"comment\">//  cellModel绑定的类名</span></div><div class=\"line\">- (<span class=\"keyword\">void</span>)cellModelForCell:(<span class=\"built_in\">UITableViewCell</span> *)cell; <span class=\"comment\">//  cellModel填充上面绑定的cell</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">@end</span></div></pre></td></tr></table></figure></p>\n<p>那么只需要在代理中做如下设置:</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#pragma mark <span class=\"meta-string\">&lt;UITableViewDelegate, UITableViewDataSource&gt;</span></span></div><div class=\"line\">- (<span class=\"built_in\">NSInteger</span>)numberOfSectionsInTableView:(<span class=\"built_in\">UITableView</span>*)tableView</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\">- (<span class=\"built_in\">NSInteger</span>)tableView:(<span class=\"built_in\">UITableView</span>*)tableView numberOfRowsInSection:(<span class=\"built_in\">NSInteger</span>)section</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.viewModel.dataSource.count;</div><div class=\"line\">&#125;</div><div class=\"line\">- (<span class=\"built_in\">UITableViewCell</span>*)tableView:(<span class=\"built_in\">UITableView</span>*)tableView cellForRowAtIndexPath:(<span class=\"built_in\">NSIndexPath</span>*)indexPath</div><div class=\"line\">&#123;</div><div class=\"line\">      <span class=\"keyword\">id</span>&lt;CellModelProtocol&gt; cellModel = <span class=\"keyword\">self</span>.viewModel.dataSource[indexPath.row];</div><div class=\"line\">      <span class=\"built_in\">UITableViewCell</span>* cell = [tableView dequeueReusableCellWithIdentifier:[cellModel cellClassName]];</div><div class=\"line\">      cell.frame = tableView.bounds;</div><div class=\"line\">      [cellModel cellModelForCell:cell];</div><div class=\"line\">      [cell sizeToFit];</div><div class=\"line\">      <span class=\"keyword\">return</span> cell;</div><div class=\"line\">&#125;</div><div class=\"line\">- (<span class=\"built_in\">CGFloat</span>)tableView:(<span class=\"built_in\">UITableView</span>*)tableView heightForRowAtIndexPath:(<span class=\"built_in\">NSIndexPath</span>*)indexPath</div><div class=\"line\">&#123;</div><div class=\"line\">      <span class=\"keyword\">id</span>&lt;CellModelProtocol&gt; cellModel = <span class=\"keyword\">self</span>.viewModel.dataSource[indexPath.row];</div><div class=\"line\">      <span class=\"built_in\">UITableViewCell</span>* cell = [tableView ktj_cacheHeightCellForReuseIDFA:[cellModel cellClassName]];</div><div class=\"line\">      [cellModel cellModelForCell:cell];</div><div class=\"line\">      <span class=\"keyword\">return</span> [cell sizeThatFits:tableView.bounds.size].height;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>而在cell中，默认在<code>sizeThatFits:</code>中进行布局的设置和算高即可。如下：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//  xxxCell.m</span></div><div class=\"line\"></div><div class=\"line\">- (<span class=\"built_in\">CGSize</span>)sizeThatFits:(<span class=\"built_in\">CGSize</span>)size &#123;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"built_in\">CGRect</span> frame = <span class=\"built_in\">CGRectZero</span>;</div><div class=\"line\">    <span class=\"comment\">//  根据Cell的实际内容进行布局并设置高度</span></div><div class=\"line\">    frame.origin = <span class=\"built_in\">CGPointMake</span>(<span class=\"number\">10</span>, <span class=\"number\">15</span>);</div><div class=\"line\">    frame.size = [<span class=\"keyword\">self</span>.infoLabel sizeThatFits:<span class=\"built_in\">CGSizeMake</span>(size.width-frame.origin.x*<span class=\"number\">2</span>, size.height)];</div><div class=\"line\">    <span class=\"keyword\">self</span>.infoLabel.frame = frame;</div><div class=\"line\">    </div><div class=\"line\">    size.height = <span class=\"built_in\">CGRectGetMaxY</span>(<span class=\"keyword\">self</span>.infoLabel.frame)+frame.origin.y;</div><div class=\"line\">    <span class=\"keyword\">return</span> size;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>如果cell采用autolayout，则计算采用<a href=\"https://github.com/forkingdog/UITableView-FDTemplateLayoutCell/blob/e3ee86ce419d18d3ff735056f1474f2863e43003/Classes/UITableView%2BFDTemplateLayoutCell.m\">UITableView-FDTemplateLayoutCell</a>的计算方法。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">UITableViewCell</span> (<span class=\"title\">KTJCellAutoLayoutForSize</span>)</span></div><div class=\"line\"><span class=\"comment\">//  autolout布局计算高度</span></div><div class=\"line\">- (<span class=\"built_in\">CGSize</span>)ktj_ALCellSizeThatFits:(<span class=\"built_in\">CGSize</span>)size &#123;</div><div class=\"line\">    <span class=\"comment\">// Add a hard width constraint to make dynamic content views (like labels) expand vertically instead</span></div><div class=\"line\">    <span class=\"comment\">// of growing horizontally, in a flow-layout manner.</span></div><div class=\"line\">    <span class=\"built_in\">NSLayoutConstraint</span> *tempWidthConstraint =</div><div class=\"line\">    [<span class=\"built_in\">NSLayoutConstraint</span> constraintWithItem:<span class=\"keyword\">self</span>.contentView</div><div class=\"line\">                                 attribute:<span class=\"built_in\">NSLayoutAttributeWidth</span></div><div class=\"line\">                                 relatedBy:<span class=\"built_in\">NSLayoutRelationEqual</span></div><div class=\"line\">                                    toItem:<span class=\"literal\">nil</span></div><div class=\"line\">                                 attribute:<span class=\"built_in\">NSLayoutAttributeNotAnAttribute</span></div><div class=\"line\">                                multiplier:<span class=\"number\">1.0</span></div><div class=\"line\">                                  constant:size.width];</div><div class=\"line\">    [<span class=\"keyword\">self</span>.contentView addConstraint:tempWidthConstraint];</div><div class=\"line\">    <span class=\"comment\">// Auto layout engine does its math</span></div><div class=\"line\">    size = [<span class=\"keyword\">self</span>.contentView systemLayoutSizeFittingSize:<span class=\"built_in\">UILayoutFittingCompressedSize</span>];</div><div class=\"line\">    size.height += <span class=\"number\">1</span>;</div><div class=\"line\">    [<span class=\"keyword\">self</span>.contentView removeConstraint:tempWidthConstraint];</div><div class=\"line\">    <span class=\"keyword\">return</span> size;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">@end</span></div></pre></td></tr></table></figure>\n<p>另外在<code>&lt;UITableViewDelegate, UITableViewDataSource&gt;</code>中只写了1组，只有cell，没有header、footer的情况，如果需要，炮制即可。</p>\n<p>说一下这个其中的<code>ktj_cacheHeightCellForReuseIDFA:</code>类别方法。这个方法是为了算高进行缓存的一个cell，这个cell保存在 <code>NSCache</code>中。所以为了统一，需要在数据初始化时候注册所有的cell。当然你也可以根据类名直接生成，这个自主决定。</p>\n<p>说到算高，需要说一下这其中的<code>dequeueReusableCellWithIdentifier:</code>方法。该方法是从tableView的缓存池中取出指定ID的cell。请注意是 <strong>取出</strong> ，并且<code>UITableView</code>并没有暴露出如何放进缓存池，也没有必要暴露出放进缓存池的方法。</p>\n<p>而且<code>UITableView</code>只有一个地方能够接收Cell那就是<code>tableView:cellForRowAtIndexPath:</code>。所以请保证<code>dequeueReusableCellWithIdentifier:</code>取出的方法 <strong>需要通过<code>tableView:cellForRowAtIndexPath:</code>返回给<code>UITableView</code></strong> 。这就是我上面说的<code>ktj_cacheHeightCellForReuseIDFA:</code>方法为何要做一个 cache去缓存我取出的cell，目的是为了减少cell的浪费。</p>\n<p>同理，对于<code>UITableView</code>的<code>headerView</code>、<code>footerView</code>来说，可以炮制以上协议、方法。不再赘述</p>\n<p>PS.</p>\n<ol>\n<li><a href=\"https://github.com/forkingdog/UITableView-FDTemplateLayoutCell\">UITableView-FDTemplateLayoutCell</a>: <a href=\"https://github.com/sunnyxx\">sunnyxx</a>打造的优化UITableView的一个库，6000的star，很赞。</li>\n</ol>\n<h1 id=\"规范化的代码风格\"><a href=\"#规范化的代码风格\" class=\"headerlink\" title=\"规范化的代码风格\"></a>规范化的代码风格</h1><p>对于多人开发，最崩溃的事情就要数去读别人的代码。就算不是多人开发，接手别人的代码也是让人最崩溃的事情。如果有不用考虑这件事的叫我！</p>\n<p>不同的公司可以有不同的代码风格，但是一个公司的代码风格需要保持一致，这样就不会出现一人请假，无人能接受项目的尴尬局面，就算能接，也是需要为了加一个逻辑判断，需要花费很大的精力去处理。</p>\n<p>至于其中的代码不统一的坑，恐怕要等踩过才知道吧😂。</p>\n<h1 id=\"业务逻辑的拆分\"><a href=\"#业务逻辑的拆分\" class=\"headerlink\" title=\"业务逻辑的拆分\"></a>业务逻辑的拆分</h1><p>对于复杂的业务逻辑，对其拆分是非常重要的，不拆分很可能写出来的代码一个文件 &gt;1000 行。复杂的业务逻辑对于写出来需要一气呵成，修改起来也就出现了牵一发动全身(虽然拆分完成之后可能也会关键逻辑代码不可拆分，但是会好很多)。</p>\n<h2 id=\"筛选重构\"><a href=\"#筛选重构\" class=\"headerlink\" title=\"筛选重构\"></a>筛选重构</h2><p>筛选主要处理的是筛选项，针对众多筛选条件拆分为不同的业务逻辑模块是必须的。遵照拆分的原则，于是乎根据UI划分出来位置、价格、户型、筛选、排序这么几个模块。针对每个模块自行处理选中数据、UI展示。对外只暴露选中项输入和选中回调。</p>\n<p>对于每个数据大致都可分为一个列表，然后可选中1项或多项。于是乎，这个代码如果不拉出来是要写好多次的，拉出来，但是选中需要把选中的逻辑扔出来，方便自定义。</p>"},{"title":"Xcode8打包脚本","date":"2016-09-26T06:55:09.000Z","_content":"\nJenkins自动构建脚本解决方案。\n\n<!--more-->\n\n## 写在前面\n  2017.1.13更新：\n  好吧，其实有更加强悍的打包工具，虽然早有耳闻但是没弄。然后最近搭建了一下，这打包脚本也不用了，毕竟有成套工具嘛。嘿嘿\n  不过最后上传osc的脚本还是很可以的。\n  传送门：[Fastlane自动化笔记](https://madordie.github.io/2017/01/04/fastlane-note/#more)\n\n## Xcode8\n\n  好悲催，Xcode8更新之后Jenkins打包失败了。。由于代码库中使用了swift3语法，故必须使用Xcode8。。\n  \n  先来重点：可用脚本：\n\n  ```bash\n  #!/bin/bash\n\n  #   追上fir API token 自动上传\n  #   基于当前代码进行打包打包目录：MyProject/build/MyProject_ent.ipa\n\n  cd MyProject\n\n  rm -rf ./build/*\n\n  xcodebuild -archivePath \"./build/xxx.xcarchive\" -workspace MyProject.xcworkspace -sdk iphoneos -scheme \"MyProject_ent\" -configuration \"Release Inhouse\" archive\n\n  echo \"<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"><plist version=\"1.0\"><dict><key>method</key><string>enterprise</string><key>compileBitcode</key><string>YES</string></dict></plist>\" > ./build/exportOptionsPlist.plist\n\n  xcodebuild -exportArchive -archivePath \"./build/xxx.xcarchive\" -exportPath \"./build/\" -exportOptionsPlist ./build/exportOptionsPlist.plist\n\n\n  cd build/\n\n  fir i ./MyProject_ent.ipa\n\n\n  if [ -n \"$1\" ]; then\n      git log -10 > git.log\n      fir p ./MyProject_ent.ipa -T $1 -c git.log\n  fi\n\n  ```\n  \n  之前漏掉了一个错误：`The flag -exportFormat cannot be specified along with -exportOptionsPlist` 导致了最终包签名错误，而无法安装。\n\n  exportOptionsPlist参考的[iOS 打包总结](https://testerhome.com/topics/4619)\n\n\n## 手动上传\n  ```\n  #!/bin/bash\n\n  #   追上fir API token 自动上传\n  #   基于当前代码进行打包打包目录：xxxx/build/xxxx_ent.ipa\n\n  workspace_name=xxxx\n  scheme_name=xxxx_ent\n\n\n  cd $workspace_name\n\n  rm -rf ./build/*\n\n  xcodebuild -archivePath \"./build/xxx.xcarchive\" -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration \"Release Inhouse\" archive\n\n\n  cat << EOF > ./build/exportOptionsPlist.plist\n  <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n  <plist version=\"1.0\">\n      <dict>\n          <key>method</key>\n          <string>enterprise</string>\n          <key>compileBitcode</key>\n              <false/>\n      </dict>\n  </plist>\n  EOF\n\n  xcodebuild -exportArchive -archivePath \"./build/xxx.xcarchive\" -exportOptionsPlist \"./build/exportOptionsPlist.plist\" -exportPath \"./build/\"\n\n  cd build/\n\n\n  git log -10 > git.log\n\n  #拷贝ipa到临时文件夹中\n  cp ./$scheme_name.ipa ./tmp.zip\n  #将ipa解压\n  unzip tmp.zip\n\n  #app文件中Info.plist文件路径\n  app_infoplist_path=$(pwd)/Payload/*.app/Info.plist\n  #取bundleIdentifier\n  bundleIdentifier=$(/usr/libexec/PlistBuddy -c \"print CFBundleIdentifier\" ${app_infoplist_path})\n  #取build值\n  bundleVersion=$(/usr/libexec/PlistBuddy -c \"print CFBundleVersion\" ${app_infoplist_path})\n  #显示名称\n  ipa_name=$workspace_name\n\n  #ipa下载url\n  ipa_download_url=\"https://***/install_ipa/raw/master/xxxx_ent.ipa\"\n  #itms-services协议串\n  ios_install_url=\"itms-services://?action=download-manifest&url=https://***/install_ipa/raw/master/xxxx_ent.plist\"\n\n  #生成install.html文件\n\n  cat << EOF > index.html\n  <!DOCTYPE HTML>\n  <html>\n    <head>\n      <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n      <title>安装</title>\n    </head>\n    <body>\n      <br>\n      <br>\n      <br>\n      <br>\n      <p align=center>\n          <font size=\"8\">\n              <a href=\"${ios_install_url}\">点击这里安装</a>\n          </font>\n      </p>\n\n      </div>\n    </body>\n  </html>\n  EOF\n\n  #生成plist文件\n  cat << EOF > ${workspace_name}.plist\n  <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n  <plist version=\"1.0\">\n  <dict>\n     <key>items</key>\n     <array>\n         <dict>\n             <key>assets</key>\n             <array>\n                 <dict>\n                     <key>kind</key>\n                     <string>software-package</string>\n                     <key>url</key>\n                     <string>${ipa_download_url}</string>\n                 </dict>\n                 <dict>\n                     <key>kind</key>\n                     <string>display-image</string>\n                     <key>needs-shine</key>\n                     <true/>\n                     <key>url</key>\n                     <string>http://git.oschina.net/logo.svg</string>\n                 </dict>\n             <dict>\n                     <key>kind</key>\n                     <string>full-size-image</string>\n                     <key>needs-shine</key>\n                     <true/>\n                     <key>url</key>\n                     <string>http://git.oschina.net/logo.svg</string>\n                 </dict>\n             </array><key>metadata</key>\n             <dict>\n                 <key>bundle-identifier</key>\n                 <string>${bundleIdentifier}</string>\n                 <key>bundle-version</key>\n                 <string>${bundleVersion}</string>\n                 <key>kind</key>\n                 <string>software</string>\n                 <key>subtitle</key>\n                 <string>${ipa_name}</string>\n                 <key>title</key>\n                 <string>${ipa_name}</string>\n             </dict>\n         </dict>\n     </array>\n  </dict>\n  </plist>\n  EOF\n\n  fir i $scheme_name.ipa\n  ```\n\n## 手动上传到OSC脚本\n  ```\n  #!/bin/bash\n\n  root_path=$(pwd)\n  workspace_name=Fangduoduo\n  scheme_name=XXX\n\n  # 编译\n  cd $root_path\n  cd $workspace_name\n\n  rm -rf ./build/*\n\n  xcodebuild -archivePath ./build/$scheme_name.xcarchive -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration \"Release Inhouse\" archive\n\n  echo \"<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"><plist version=\"1.0\"><dict><key>method</key><string>enterprise</string><key>compileBitcode</key><false/></dict></plist>\" > ./build/exportOptionsPlist.plist\n\n  xcodebuild -exportArchive -archivePath ./build/$scheme_name.xcarchive -exportOptionsPlist \"./build/exportOptionsPlist.plist\" -exportPath \"./build/\"\n\n\n  cd build/\n\n  if [ ! -f $scheme_name.ipa ]; then\n      echo \"*** 无法打包 ***\"\n      exit -1\n  fi\n\n  fir i ./$scheme_name.ipa\n\n  git log -10 > git.log\n  git_log=$(cat git.log)\n  # fir 上传\n  if [ -n \"$1\" ]; then\n      fir p ./$scheme_name.ipa -T $1 -c git.log\n  fi\n\n\n  # 校验HTML并上传\n\n  public_git_path=$root_path/public_ipa_tmp/\n  public_git_root=\"install_ipa\"\n  public_git=\"https://***/install_ipa.git\"\n  #ipa下载url\n  ipa_download_url=\"https://***/install_ipa/raw/master/XXX.ipa\"\n  #itms-services协议串\n  ios_install_url=\"itms-services://?action=download-manifest&url=https://***/install_ipa/raw/master/XXX.plist\"\n\n\n  cd $root_path/\n  # checkout path is OK\n  if [ ! -e $public_git_path ]; then\n      mkdir $public_git_path\n  fi\n\n  if [ -n $public_git_path ]; then\n      rm -rf $public_git_path\n  fi\n  mkdir $public_git_path\n  cd $public_git_path\n  git init\n  git remote add origin $public_git\n\n\n  cd $root_path/$workspace_name/build/\n\n  #拷贝ipa到临时文件夹中\n  cp ./$scheme_name.ipa ./tmp.zip\n  rm -rf Payload\n  #将ipa解压\n  unzip tmp.zip\n\n  #app文件中Info.plist文件路径\n  app_infoplist_path=$(pwd)/Payload/*.app/Info.plist\n  #取bundleIdentifier\n  bundleIdentifier=$(/usr/libexec/PlistBuddy -c \"print CFBundleIdentifier\" ${app_infoplist_path})\n  #取build值\n  bundleVersion=$(/usr/libexec/PlistBuddy -c \"print CFBundleVersion\" ${app_infoplist_path})\n  #取shortVersionbuild值\n  shortVersion=$(/usr/libexec/PlistBuddy -c \"print CFBundleShortVersionString\" ${app_infoplist_path})\n  #显示名称\n  ipa_name=$(/usr/libexec/PlistBuddy -c \"print CFBundleDisplayName\" ${app_infoplist_path})\n  nowTime=$(date +%Y-%m-%d\\ %H:%M)\n  log_url=\"https://madordie.github.io/uploads/avatar.png\"\n\n  #生成install.html文件\n\n  cat << EOF > index.html\n  <!DOCTYPE HTML>\n  <html>\n  <head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0\">\n  <title>${ipa_name}安装</title>\n  <style>\n  .containor {\n      position: relative;\n      top: 0;\n      left: 0;\n      right: 0;\n      margin: 0 auto;\n      width: 100%;\n      max-width: 640px;\n      text-align: center;\n  }\n  .logo {\n      width: 120px;\n      margin-top: 30px;\n  }\n  .title,\n  .version_history,\n  .update_time {\n      text-align: center;\n      color: #999;\n      font-size: 16px;\n  }\n  .title {\n      margin-top: 10px;\n  }\n  .version_history,\n  .update_time {\n      margin-top: 5px;\n  }\n  .download {\n      display: block;\n      width: 150px;\n      height: 30px;\n      line-height: 30px;\n      margin: 0 auto;\n      margin-top: 20px;\n      border: 1px solid #eee;\n      border-radius: 20px;\n      text-decoration: none;\n      color: #999;\n  }\n  .log_title {\n      margin-top: 20px;\n      font-size: 18px;\n      color: #333;\n  }\n  .log {\n      color: #aaa;\n      padding: 20px;\n      text-align: left;\n      font-size: 12px;\n      line-height: 15px;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      overflow: hidden;\n  }\n  </style>\n  </head>\n  <body>\n  <div class=\"containor\">\n      <img class=\"logo\" src=${log_url} />\n      <div class=\"title\">$ipa_name</div>\n      <div class=\"version_history\">${shortVersion}(bundle:${bundleVersion})</div>\n      <div></div>\n      <div class=\"update_time\">${nowTime}</div>\n      <a class=\"download\" href=\"${ios_install_url}\">点击这里安装</a>\n      <div class=\"log_title\">更新日志</div>\n      <div class=\"log\"> ${git_log} </div>\n  </div>\n  </body>\n  </html>\n  EOF\n\n  #生成plist文件\n  cat << EOF > ${scheme_name}.plist\n  <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n  <plist version=\"1.0\">\n  <dict>\n     <key>items</key>\n     <array>\n         <dict>\n             <key>assets</key>\n             <array>\n                 <dict>\n                     <key>kind</key>\n                     <string>software-package</string>\n                     <key>url</key>\n                     <string>${ipa_download_url}</string>\n                 </dict>\n                 <dict>\n                     <key>kind</key>\n                     <string>display-image</string>\n                     <key>needs-shine</key>\n                     <true/>\n                     <key>url</key>\n                     <string>http://git.oschina.net/logo.svg</string>\n                 </dict>\n             <dict>\n                     <key>kind</key>\n                     <string>full-size-image</string>\n                     <key>needs-shine</key>\n                     <true/>\n                     <key>url</key>\n                     <string>http://git.oschina.net/logo.svg</string>\n                 </dict>\n             </array><key>metadata</key>\n             <dict>\n                 <key>bundle-identifier</key>\n                 <string>${bundleIdentifier}</string>\n                 <key>bundle-version</key>\n                 <string>${bundleVersion}</string>\n                 <key>kind</key>\n                 <string>software</string>\n                 <key>subtitle</key>\n                 <string>${ipa_name}</string>\n                 <key>title</key>\n                 <string>${ipa_name}</string>\n             </dict>\n         </dict>\n     </array>\n  </dict>\n  </plist>\n  EOF\n\n  #fir i $scheme_name.ipa\n  cp $scheme_name.ipa $public_git_path\n  cp $scheme_name.plist $public_git_path\n  cp index.html $public_git_path\n\n  cd $public_git_path\n  ls -l > README.md\n  if [ ! -e \"./.git/\" ]; then\n      echo \"*** OSC的git目录不完整，无法上传，请联系开发! ***\"\n      exit -1\n  fi\n  echo \"commit and pushing ...\"\n  git add .\n  git commit -am $bundleVersion\n  git push -f origin master\n  ```","source":"_posts/build-ipa-sh.md","raw":"---\ntitle: Xcode8打包脚本\ndate: 2016-09-26 14:55:09\ntags:\n---\n\nJenkins自动构建脚本解决方案。\n\n<!--more-->\n\n## 写在前面\n  2017.1.13更新：\n  好吧，其实有更加强悍的打包工具，虽然早有耳闻但是没弄。然后最近搭建了一下，这打包脚本也不用了，毕竟有成套工具嘛。嘿嘿\n  不过最后上传osc的脚本还是很可以的。\n  传送门：[Fastlane自动化笔记](https://madordie.github.io/2017/01/04/fastlane-note/#more)\n\n## Xcode8\n\n  好悲催，Xcode8更新之后Jenkins打包失败了。。由于代码库中使用了swift3语法，故必须使用Xcode8。。\n  \n  先来重点：可用脚本：\n\n  ```bash\n  #!/bin/bash\n\n  #   追上fir API token 自动上传\n  #   基于当前代码进行打包打包目录：MyProject/build/MyProject_ent.ipa\n\n  cd MyProject\n\n  rm -rf ./build/*\n\n  xcodebuild -archivePath \"./build/xxx.xcarchive\" -workspace MyProject.xcworkspace -sdk iphoneos -scheme \"MyProject_ent\" -configuration \"Release Inhouse\" archive\n\n  echo \"<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"><plist version=\"1.0\"><dict><key>method</key><string>enterprise</string><key>compileBitcode</key><string>YES</string></dict></plist>\" > ./build/exportOptionsPlist.plist\n\n  xcodebuild -exportArchive -archivePath \"./build/xxx.xcarchive\" -exportPath \"./build/\" -exportOptionsPlist ./build/exportOptionsPlist.plist\n\n\n  cd build/\n\n  fir i ./MyProject_ent.ipa\n\n\n  if [ -n \"$1\" ]; then\n      git log -10 > git.log\n      fir p ./MyProject_ent.ipa -T $1 -c git.log\n  fi\n\n  ```\n  \n  之前漏掉了一个错误：`The flag -exportFormat cannot be specified along with -exportOptionsPlist` 导致了最终包签名错误，而无法安装。\n\n  exportOptionsPlist参考的[iOS 打包总结](https://testerhome.com/topics/4619)\n\n\n## 手动上传\n  ```\n  #!/bin/bash\n\n  #   追上fir API token 自动上传\n  #   基于当前代码进行打包打包目录：xxxx/build/xxxx_ent.ipa\n\n  workspace_name=xxxx\n  scheme_name=xxxx_ent\n\n\n  cd $workspace_name\n\n  rm -rf ./build/*\n\n  xcodebuild -archivePath \"./build/xxx.xcarchive\" -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration \"Release Inhouse\" archive\n\n\n  cat << EOF > ./build/exportOptionsPlist.plist\n  <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n  <plist version=\"1.0\">\n      <dict>\n          <key>method</key>\n          <string>enterprise</string>\n          <key>compileBitcode</key>\n              <false/>\n      </dict>\n  </plist>\n  EOF\n\n  xcodebuild -exportArchive -archivePath \"./build/xxx.xcarchive\" -exportOptionsPlist \"./build/exportOptionsPlist.plist\" -exportPath \"./build/\"\n\n  cd build/\n\n\n  git log -10 > git.log\n\n  #拷贝ipa到临时文件夹中\n  cp ./$scheme_name.ipa ./tmp.zip\n  #将ipa解压\n  unzip tmp.zip\n\n  #app文件中Info.plist文件路径\n  app_infoplist_path=$(pwd)/Payload/*.app/Info.plist\n  #取bundleIdentifier\n  bundleIdentifier=$(/usr/libexec/PlistBuddy -c \"print CFBundleIdentifier\" ${app_infoplist_path})\n  #取build值\n  bundleVersion=$(/usr/libexec/PlistBuddy -c \"print CFBundleVersion\" ${app_infoplist_path})\n  #显示名称\n  ipa_name=$workspace_name\n\n  #ipa下载url\n  ipa_download_url=\"https://***/install_ipa/raw/master/xxxx_ent.ipa\"\n  #itms-services协议串\n  ios_install_url=\"itms-services://?action=download-manifest&url=https://***/install_ipa/raw/master/xxxx_ent.plist\"\n\n  #生成install.html文件\n\n  cat << EOF > index.html\n  <!DOCTYPE HTML>\n  <html>\n    <head>\n      <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n      <title>安装</title>\n    </head>\n    <body>\n      <br>\n      <br>\n      <br>\n      <br>\n      <p align=center>\n          <font size=\"8\">\n              <a href=\"${ios_install_url}\">点击这里安装</a>\n          </font>\n      </p>\n\n      </div>\n    </body>\n  </html>\n  EOF\n\n  #生成plist文件\n  cat << EOF > ${workspace_name}.plist\n  <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n  <plist version=\"1.0\">\n  <dict>\n     <key>items</key>\n     <array>\n         <dict>\n             <key>assets</key>\n             <array>\n                 <dict>\n                     <key>kind</key>\n                     <string>software-package</string>\n                     <key>url</key>\n                     <string>${ipa_download_url}</string>\n                 </dict>\n                 <dict>\n                     <key>kind</key>\n                     <string>display-image</string>\n                     <key>needs-shine</key>\n                     <true/>\n                     <key>url</key>\n                     <string>http://git.oschina.net/logo.svg</string>\n                 </dict>\n             <dict>\n                     <key>kind</key>\n                     <string>full-size-image</string>\n                     <key>needs-shine</key>\n                     <true/>\n                     <key>url</key>\n                     <string>http://git.oschina.net/logo.svg</string>\n                 </dict>\n             </array><key>metadata</key>\n             <dict>\n                 <key>bundle-identifier</key>\n                 <string>${bundleIdentifier}</string>\n                 <key>bundle-version</key>\n                 <string>${bundleVersion}</string>\n                 <key>kind</key>\n                 <string>software</string>\n                 <key>subtitle</key>\n                 <string>${ipa_name}</string>\n                 <key>title</key>\n                 <string>${ipa_name}</string>\n             </dict>\n         </dict>\n     </array>\n  </dict>\n  </plist>\n  EOF\n\n  fir i $scheme_name.ipa\n  ```\n\n## 手动上传到OSC脚本\n  ```\n  #!/bin/bash\n\n  root_path=$(pwd)\n  workspace_name=Fangduoduo\n  scheme_name=XXX\n\n  # 编译\n  cd $root_path\n  cd $workspace_name\n\n  rm -rf ./build/*\n\n  xcodebuild -archivePath ./build/$scheme_name.xcarchive -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration \"Release Inhouse\" archive\n\n  echo \"<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"><plist version=\"1.0\"><dict><key>method</key><string>enterprise</string><key>compileBitcode</key><false/></dict></plist>\" > ./build/exportOptionsPlist.plist\n\n  xcodebuild -exportArchive -archivePath ./build/$scheme_name.xcarchive -exportOptionsPlist \"./build/exportOptionsPlist.plist\" -exportPath \"./build/\"\n\n\n  cd build/\n\n  if [ ! -f $scheme_name.ipa ]; then\n      echo \"*** 无法打包 ***\"\n      exit -1\n  fi\n\n  fir i ./$scheme_name.ipa\n\n  git log -10 > git.log\n  git_log=$(cat git.log)\n  # fir 上传\n  if [ -n \"$1\" ]; then\n      fir p ./$scheme_name.ipa -T $1 -c git.log\n  fi\n\n\n  # 校验HTML并上传\n\n  public_git_path=$root_path/public_ipa_tmp/\n  public_git_root=\"install_ipa\"\n  public_git=\"https://***/install_ipa.git\"\n  #ipa下载url\n  ipa_download_url=\"https://***/install_ipa/raw/master/XXX.ipa\"\n  #itms-services协议串\n  ios_install_url=\"itms-services://?action=download-manifest&url=https://***/install_ipa/raw/master/XXX.plist\"\n\n\n  cd $root_path/\n  # checkout path is OK\n  if [ ! -e $public_git_path ]; then\n      mkdir $public_git_path\n  fi\n\n  if [ -n $public_git_path ]; then\n      rm -rf $public_git_path\n  fi\n  mkdir $public_git_path\n  cd $public_git_path\n  git init\n  git remote add origin $public_git\n\n\n  cd $root_path/$workspace_name/build/\n\n  #拷贝ipa到临时文件夹中\n  cp ./$scheme_name.ipa ./tmp.zip\n  rm -rf Payload\n  #将ipa解压\n  unzip tmp.zip\n\n  #app文件中Info.plist文件路径\n  app_infoplist_path=$(pwd)/Payload/*.app/Info.plist\n  #取bundleIdentifier\n  bundleIdentifier=$(/usr/libexec/PlistBuddy -c \"print CFBundleIdentifier\" ${app_infoplist_path})\n  #取build值\n  bundleVersion=$(/usr/libexec/PlistBuddy -c \"print CFBundleVersion\" ${app_infoplist_path})\n  #取shortVersionbuild值\n  shortVersion=$(/usr/libexec/PlistBuddy -c \"print CFBundleShortVersionString\" ${app_infoplist_path})\n  #显示名称\n  ipa_name=$(/usr/libexec/PlistBuddy -c \"print CFBundleDisplayName\" ${app_infoplist_path})\n  nowTime=$(date +%Y-%m-%d\\ %H:%M)\n  log_url=\"https://madordie.github.io/uploads/avatar.png\"\n\n  #生成install.html文件\n\n  cat << EOF > index.html\n  <!DOCTYPE HTML>\n  <html>\n  <head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0\">\n  <title>${ipa_name}安装</title>\n  <style>\n  .containor {\n      position: relative;\n      top: 0;\n      left: 0;\n      right: 0;\n      margin: 0 auto;\n      width: 100%;\n      max-width: 640px;\n      text-align: center;\n  }\n  .logo {\n      width: 120px;\n      margin-top: 30px;\n  }\n  .title,\n  .version_history,\n  .update_time {\n      text-align: center;\n      color: #999;\n      font-size: 16px;\n  }\n  .title {\n      margin-top: 10px;\n  }\n  .version_history,\n  .update_time {\n      margin-top: 5px;\n  }\n  .download {\n      display: block;\n      width: 150px;\n      height: 30px;\n      line-height: 30px;\n      margin: 0 auto;\n      margin-top: 20px;\n      border: 1px solid #eee;\n      border-radius: 20px;\n      text-decoration: none;\n      color: #999;\n  }\n  .log_title {\n      margin-top: 20px;\n      font-size: 18px;\n      color: #333;\n  }\n  .log {\n      color: #aaa;\n      padding: 20px;\n      text-align: left;\n      font-size: 12px;\n      line-height: 15px;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      overflow: hidden;\n  }\n  </style>\n  </head>\n  <body>\n  <div class=\"containor\">\n      <img class=\"logo\" src=${log_url} />\n      <div class=\"title\">$ipa_name</div>\n      <div class=\"version_history\">${shortVersion}(bundle:${bundleVersion})</div>\n      <div></div>\n      <div class=\"update_time\">${nowTime}</div>\n      <a class=\"download\" href=\"${ios_install_url}\">点击这里安装</a>\n      <div class=\"log_title\">更新日志</div>\n      <div class=\"log\"> ${git_log} </div>\n  </div>\n  </body>\n  </html>\n  EOF\n\n  #生成plist文件\n  cat << EOF > ${scheme_name}.plist\n  <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n  <plist version=\"1.0\">\n  <dict>\n     <key>items</key>\n     <array>\n         <dict>\n             <key>assets</key>\n             <array>\n                 <dict>\n                     <key>kind</key>\n                     <string>software-package</string>\n                     <key>url</key>\n                     <string>${ipa_download_url}</string>\n                 </dict>\n                 <dict>\n                     <key>kind</key>\n                     <string>display-image</string>\n                     <key>needs-shine</key>\n                     <true/>\n                     <key>url</key>\n                     <string>http://git.oschina.net/logo.svg</string>\n                 </dict>\n             <dict>\n                     <key>kind</key>\n                     <string>full-size-image</string>\n                     <key>needs-shine</key>\n                     <true/>\n                     <key>url</key>\n                     <string>http://git.oschina.net/logo.svg</string>\n                 </dict>\n             </array><key>metadata</key>\n             <dict>\n                 <key>bundle-identifier</key>\n                 <string>${bundleIdentifier}</string>\n                 <key>bundle-version</key>\n                 <string>${bundleVersion}</string>\n                 <key>kind</key>\n                 <string>software</string>\n                 <key>subtitle</key>\n                 <string>${ipa_name}</string>\n                 <key>title</key>\n                 <string>${ipa_name}</string>\n             </dict>\n         </dict>\n     </array>\n  </dict>\n  </plist>\n  EOF\n\n  #fir i $scheme_name.ipa\n  cp $scheme_name.ipa $public_git_path\n  cp $scheme_name.plist $public_git_path\n  cp index.html $public_git_path\n\n  cd $public_git_path\n  ls -l > README.md\n  if [ ! -e \"./.git/\" ]; then\n      echo \"*** OSC的git目录不完整，无法上传，请联系开发! ***\"\n      exit -1\n  fi\n  echo \"commit and pushing ...\"\n  git add .\n  git commit -am $bundleVersion\n  git push -f origin master\n  ```","slug":"build-ipa-sh","published":1,"updated":"2017-01-13T09:35:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f9e0008l0uvyma2tncs","content":"<p>Jenkins自动构建脚本解决方案。</p>\n<a id=\"more\"></a>\n<h2 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h2><p>  2017.1.13更新：<br>  好吧，其实有更加强悍的打包工具，虽然早有耳闻但是没弄。然后最近搭建了一下，这打包脚本也不用了，毕竟有成套工具嘛。嘿嘿<br>  不过最后上传osc的脚本还是很可以的。<br>  传送门：<a href=\"https://madordie.github.io/2017/01/04/fastlane-note/#more\">Fastlane自动化笔记</a></p>\n<h2 id=\"Xcode8\"><a href=\"#Xcode8\" class=\"headerlink\" title=\"Xcode8\"></a>Xcode8</h2><p>  好悲催，Xcode8更新之后Jenkins打包失败了。。由于代码库中使用了swift3语法，故必须使用Xcode8。。</p>\n<p>  先来重点：可用脚本：</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">#   追上fir API token 自动上传</span></div><div class=\"line\"><span class=\"comment\">#   基于当前代码进行打包打包目录：MyProject/build/MyProject_ent.ipa</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">cd</span> MyProject</div><div class=\"line\"></div><div class=\"line\">rm -rf ./build/*</div><div class=\"line\"></div><div class=\"line\">xcodebuild -archivePath <span class=\"string\">\"./build/xxx.xcarchive\"</span> -workspace MyProject.xcworkspace -sdk iphoneos -scheme <span class=\"string\">\"MyProject_ent\"</span> -configuration <span class=\"string\">\"Release Inhouse\"</span> archive</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"&lt;?xml version=\"</span>1.0<span class=\"string\">\" encoding=\"</span>UTF-8<span class=\"string\">\"?&gt;&lt;!DOCTYPE plist PUBLIC \"</span>-//Apple//DTD PLIST 1.0//EN<span class=\"string\">\" \"</span>http://www.apple.com/DTDs/PropertyList-1.0.dtd<span class=\"string\">\"&gt;&lt;plist version=\"</span>1.0<span class=\"string\">\"&gt;&lt;dict&gt;&lt;key&gt;method&lt;/key&gt;&lt;string&gt;enterprise&lt;/string&gt;&lt;key&gt;compileBitcode&lt;/key&gt;&lt;string&gt;YES&lt;/string&gt;&lt;/dict&gt;&lt;/plist&gt;\"</span> &gt; ./build/<span class=\"built_in\">export</span>OptionsPlist.plist</div><div class=\"line\"></div><div class=\"line\">xcodebuild -exportArchive -archivePath <span class=\"string\">\"./build/xxx.xcarchive\"</span> -exportPath <span class=\"string\">\"./build/\"</span> -exportOptionsPlist ./build/<span class=\"built_in\">export</span>OptionsPlist.plist</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">cd</span> build/</div><div class=\"line\"></div><div class=\"line\">fir i ./MyProject_ent.ipa</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">if</span> [ -n <span class=\"string\">\"<span class=\"variable\">$1</span>\"</span> ]; <span class=\"keyword\">then</span></div><div class=\"line\">    git <span class=\"built_in\">log</span> -10 &gt; git.log</div><div class=\"line\">    fir p ./MyProject_ent.ipa -T <span class=\"variable\">$1</span> -c git.log</div><div class=\"line\"><span class=\"keyword\">fi</span></div></pre></td></tr></table></figure>\n<p>  之前漏掉了一个错误：<code>The flag -exportFormat cannot be specified along with -exportOptionsPlist</code> 导致了最终包签名错误，而无法安装。</p>\n<p>  exportOptionsPlist参考的<a href=\"https://testerhome.com/topics/4619\" target=\"_blank\" rel=\"external\">iOS 打包总结</a></p>\n<h2 id=\"手动上传\"><a href=\"#手动上传\" class=\"headerlink\" title=\"手动上传\"></a>手动上传</h2>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div></pre></td><td class=\"code\"><pre><div class=\"line\">#!/bin/bash</div><div class=\"line\"></div><div class=\"line\">#   追上fir API token 自动上传</div><div class=\"line\">#   基于当前代码进行打包打包目录：xxxx/build/xxxx_ent.ipa</div><div class=\"line\"></div><div class=\"line\">workspace_name=xxxx</div><div class=\"line\">scheme_name=xxxx_ent</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">cd $workspace_name</div><div class=\"line\"></div><div class=\"line\">rm -rf ./build/*</div><div class=\"line\"></div><div class=\"line\">xcodebuild -archivePath &quot;./build/xxx.xcarchive&quot; -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration &quot;Release Inhouse&quot; archive</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">cat &lt;&lt; EOF &gt; ./build/exportOptionsPlist.plist</div><div class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class=\"line\">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</div><div class=\"line\">&lt;plist version=&quot;1.0&quot;&gt;</div><div class=\"line\">    &lt;dict&gt;</div><div class=\"line\">        &lt;key&gt;method&lt;/key&gt;</div><div class=\"line\">        &lt;string&gt;enterprise&lt;/string&gt;</div><div class=\"line\">        &lt;key&gt;compileBitcode&lt;/key&gt;</div><div class=\"line\">            &lt;false/&gt;</div><div class=\"line\">    &lt;/dict&gt;</div><div class=\"line\">&lt;/plist&gt;</div><div class=\"line\">EOF</div><div class=\"line\"></div><div class=\"line\">xcodebuild -exportArchive -archivePath &quot;./build/xxx.xcarchive&quot; -exportOptionsPlist &quot;./build/exportOptionsPlist.plist&quot; -exportPath &quot;./build/&quot;</div><div class=\"line\"></div><div class=\"line\">cd build/</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">git log -10 &gt; git.log</div><div class=\"line\"></div><div class=\"line\">#拷贝ipa到临时文件夹中</div><div class=\"line\">cp ./$scheme_name.ipa ./tmp.zip</div><div class=\"line\">#将ipa解压</div><div class=\"line\">unzip tmp.zip</div><div class=\"line\"></div><div class=\"line\">#app文件中Info.plist文件路径</div><div class=\"line\">app_infoplist_path=$(pwd)/Payload/*.app/Info.plist</div><div class=\"line\">#取bundleIdentifier</div><div class=\"line\">bundleIdentifier=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleIdentifier&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">#取build值</div><div class=\"line\">bundleVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleVersion&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">#显示名称</div><div class=\"line\">ipa_name=$workspace_name</div><div class=\"line\"></div><div class=\"line\">#ipa下载url</div><div class=\"line\">ipa_download_url=&quot;https://***/install_ipa/raw/master/xxxx_ent.ipa&quot;</div><div class=\"line\">#itms-services协议串</div><div class=\"line\">ios_install_url=&quot;itms-services://?action=download-manifest&amp;url=https://***/install_ipa/raw/master/xxxx_ent.plist&quot;</div><div class=\"line\"></div><div class=\"line\">#生成install.html文件</div><div class=\"line\"></div><div class=\"line\">cat &lt;&lt; EOF &gt; index.html</div><div class=\"line\">&lt;!DOCTYPE HTML&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">  &lt;head&gt;</div><div class=\"line\">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</div><div class=\"line\">    &lt;title&gt;安装&lt;/title&gt;</div><div class=\"line\">  &lt;/head&gt;</div><div class=\"line\">  &lt;body&gt;</div><div class=\"line\">    &lt;br&gt;</div><div class=\"line\">    &lt;br&gt;</div><div class=\"line\">    &lt;br&gt;</div><div class=\"line\">    &lt;br&gt;</div><div class=\"line\">    &lt;p align=center&gt;</div><div class=\"line\">        &lt;font size=&quot;8&quot;&gt;</div><div class=\"line\">            &lt;a href=&quot;$&#123;ios_install_url&#125;&quot;&gt;点击这里安装&lt;/a&gt;</div><div class=\"line\">        &lt;/font&gt;</div><div class=\"line\">    &lt;/p&gt;</div><div class=\"line\"></div><div class=\"line\">    &lt;/div&gt;</div><div class=\"line\">  &lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div><div class=\"line\">EOF</div><div class=\"line\"></div><div class=\"line\">#生成plist文件</div><div class=\"line\">cat &lt;&lt; EOF &gt; $&#123;workspace_name&#125;.plist</div><div class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class=\"line\">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</div><div class=\"line\">&lt;plist version=&quot;1.0&quot;&gt;</div><div class=\"line\">&lt;dict&gt;</div><div class=\"line\">   &lt;key&gt;items&lt;/key&gt;</div><div class=\"line\">   &lt;array&gt;</div><div class=\"line\">       &lt;dict&gt;</div><div class=\"line\">           &lt;key&gt;assets&lt;/key&gt;</div><div class=\"line\">           &lt;array&gt;</div><div class=\"line\">               &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;software-package&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;$&#123;ipa_download_url&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">               &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;display-image&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;needs-shine&lt;/key&gt;</div><div class=\"line\">                   &lt;true/&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">           &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;full-size-image&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;needs-shine&lt;/key&gt;</div><div class=\"line\">                   &lt;true/&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">           &lt;/array&gt;&lt;key&gt;metadata&lt;/key&gt;</div><div class=\"line\">           &lt;dict&gt;</div><div class=\"line\">               &lt;key&gt;bundle-identifier&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;bundleIdentifier&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;bundle-version&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;bundleVersion&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;software&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;subtitle&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;title&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt;</div><div class=\"line\">           &lt;/dict&gt;</div><div class=\"line\">       &lt;/dict&gt;</div><div class=\"line\">   &lt;/array&gt;</div><div class=\"line\">&lt;/dict&gt;</div><div class=\"line\">&lt;/plist&gt;</div><div class=\"line\">EOF</div><div class=\"line\"></div><div class=\"line\">fir i $scheme_name.ipa</div></pre></td></tr></table></figure>\n<h2 id=\"手动上传到OSC脚本\"><a href=\"#手动上传到OSC脚本\" class=\"headerlink\" title=\"手动上传到OSC脚本\"></a>手动上传到OSC脚本</h2>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div></pre></td><td class=\"code\"><pre><div class=\"line\">#!/bin/bash</div><div class=\"line\"></div><div class=\"line\">root_path=$(pwd)</div><div class=\"line\">workspace_name=Fangduoduo</div><div class=\"line\">scheme_name=XXX</div><div class=\"line\"></div><div class=\"line\"># 编译</div><div class=\"line\">cd $root_path</div><div class=\"line\">cd $workspace_name</div><div class=\"line\"></div><div class=\"line\">rm -rf ./build/*</div><div class=\"line\"></div><div class=\"line\">xcodebuild -archivePath ./build/$scheme_name.xcarchive -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration &quot;Release Inhouse&quot; archive</div><div class=\"line\"></div><div class=\"line\">echo &quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt;&lt;dict&gt;&lt;key&gt;method&lt;/key&gt;&lt;string&gt;enterprise&lt;/string&gt;&lt;key&gt;compileBitcode&lt;/key&gt;&lt;false/&gt;&lt;/dict&gt;&lt;/plist&gt;&quot; &gt; ./build/exportOptionsPlist.plist</div><div class=\"line\"></div><div class=\"line\">xcodebuild -exportArchive -archivePath ./build/$scheme_name.xcarchive -exportOptionsPlist &quot;./build/exportOptionsPlist.plist&quot; -exportPath &quot;./build/&quot;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">cd build/</div><div class=\"line\"></div><div class=\"line\">if [ ! -f $scheme_name.ipa ]; then</div><div class=\"line\">    echo &quot;*** 无法打包 ***&quot;</div><div class=\"line\">    exit -1</div><div class=\"line\">fi</div><div class=\"line\"></div><div class=\"line\">fir i ./$scheme_name.ipa</div><div class=\"line\"></div><div class=\"line\">git log -10 &gt; git.log</div><div class=\"line\">git_log=$(cat git.log)</div><div class=\"line\"># fir 上传</div><div class=\"line\">if [ -n &quot;$1&quot; ]; then</div><div class=\"line\">    fir p ./$scheme_name.ipa -T $1 -c git.log</div><div class=\"line\">fi</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># 校验HTML并上传</div><div class=\"line\"></div><div class=\"line\">public_git_path=$root_path/public_ipa_tmp/</div><div class=\"line\">public_git_root=&quot;install_ipa&quot;</div><div class=\"line\">public_git=&quot;https://***/install_ipa.git&quot;</div><div class=\"line\">#ipa下载url</div><div class=\"line\">ipa_download_url=&quot;https://***/install_ipa/raw/master/XXX.ipa&quot;</div><div class=\"line\">#itms-services协议串</div><div class=\"line\">ios_install_url=&quot;itms-services://?action=download-manifest&amp;url=https://***/install_ipa/raw/master/XXX.plist&quot;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">cd $root_path/</div><div class=\"line\"># checkout path is OK</div><div class=\"line\">if [ ! -e $public_git_path ]; then</div><div class=\"line\">    mkdir $public_git_path</div><div class=\"line\">fi</div><div class=\"line\"></div><div class=\"line\">if [ -n $public_git_path ]; then</div><div class=\"line\">    rm -rf $public_git_path</div><div class=\"line\">fi</div><div class=\"line\">mkdir $public_git_path</div><div class=\"line\">cd $public_git_path</div><div class=\"line\">git init</div><div class=\"line\">git remote add origin $public_git</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">cd $root_path/$workspace_name/build/</div><div class=\"line\"></div><div class=\"line\">#拷贝ipa到临时文件夹中</div><div class=\"line\">cp ./$scheme_name.ipa ./tmp.zip</div><div class=\"line\">rm -rf Payload</div><div class=\"line\">#将ipa解压</div><div class=\"line\">unzip tmp.zip</div><div class=\"line\"></div><div class=\"line\">#app文件中Info.plist文件路径</div><div class=\"line\">app_infoplist_path=$(pwd)/Payload/*.app/Info.plist</div><div class=\"line\">#取bundleIdentifier</div><div class=\"line\">bundleIdentifier=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleIdentifier&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">#取build值</div><div class=\"line\">bundleVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleVersion&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">#取shortVersionbuild值</div><div class=\"line\">shortVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleShortVersionString&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">#显示名称</div><div class=\"line\">ipa_name=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleDisplayName&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">nowTime=$(date +%Y-%m-%d\\ %H:%M)</div><div class=\"line\">log_url=&quot;https://madordie.github.io/uploads/avatar.png&quot;</div><div class=\"line\"></div><div class=\"line\">#生成install.html文件</div><div class=\"line\"></div><div class=\"line\">cat &lt;&lt; EOF &gt; index.html</div><div class=\"line\">&lt;!DOCTYPE HTML&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">&lt;head&gt;</div><div class=\"line\">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</div><div class=\"line\">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0&quot;&gt;</div><div class=\"line\">&lt;title&gt;$&#123;ipa_name&#125;安装&lt;/title&gt;</div><div class=\"line\">&lt;style&gt;</div><div class=\"line\">.containor &#123;</div><div class=\"line\">    position: relative;</div><div class=\"line\">    top: 0;</div><div class=\"line\">    left: 0;</div><div class=\"line\">    right: 0;</div><div class=\"line\">    margin: 0 auto;</div><div class=\"line\">    width: 100%;</div><div class=\"line\">    max-width: 640px;</div><div class=\"line\">    text-align: center;</div><div class=\"line\">&#125;</div><div class=\"line\">.logo &#123;</div><div class=\"line\">    width: 120px;</div><div class=\"line\">    margin-top: 30px;</div><div class=\"line\">&#125;</div><div class=\"line\">.title,</div><div class=\"line\">.version_history,</div><div class=\"line\">.update_time &#123;</div><div class=\"line\">    text-align: center;</div><div class=\"line\">    color: #999;</div><div class=\"line\">    font-size: 16px;</div><div class=\"line\">&#125;</div><div class=\"line\">.title &#123;</div><div class=\"line\">    margin-top: 10px;</div><div class=\"line\">&#125;</div><div class=\"line\">.version_history,</div><div class=\"line\">.update_time &#123;</div><div class=\"line\">    margin-top: 5px;</div><div class=\"line\">&#125;</div><div class=\"line\">.download &#123;</div><div class=\"line\">    display: block;</div><div class=\"line\">    width: 150px;</div><div class=\"line\">    height: 30px;</div><div class=\"line\">    line-height: 30px;</div><div class=\"line\">    margin: 0 auto;</div><div class=\"line\">    margin-top: 20px;</div><div class=\"line\">    border: 1px solid #eee;</div><div class=\"line\">    border-radius: 20px;</div><div class=\"line\">    text-decoration: none;</div><div class=\"line\">    color: #999;</div><div class=\"line\">&#125;</div><div class=\"line\">.log_title &#123;</div><div class=\"line\">    margin-top: 20px;</div><div class=\"line\">    font-size: 18px;</div><div class=\"line\">    color: #333;</div><div class=\"line\">&#125;</div><div class=\"line\">.log &#123;</div><div class=\"line\">    color: #aaa;</div><div class=\"line\">    padding: 20px;</div><div class=\"line\">    text-align: left;</div><div class=\"line\">    font-size: 12px;</div><div class=\"line\">    line-height: 15px;</div><div class=\"line\">    white-space: pre-wrap;</div><div class=\"line\">    word-wrap: break-word;</div><div class=\"line\">    overflow: hidden;</div><div class=\"line\">&#125;</div><div class=\"line\">&lt;/style&gt;</div><div class=\"line\">&lt;/head&gt;</div><div class=\"line\">&lt;body&gt;</div><div class=\"line\">&lt;div class=&quot;containor&quot;&gt;</div><div class=\"line\">    &lt;img class=&quot;logo&quot; src=$&#123;log_url&#125; /&gt;</div><div class=\"line\">    &lt;div class=&quot;title&quot;&gt;$ipa_name&lt;/div&gt;</div><div class=\"line\">    &lt;div class=&quot;version_history&quot;&gt;$&#123;shortVersion&#125;(bundle:$&#123;bundleVersion&#125;)&lt;/div&gt;</div><div class=\"line\">    &lt;div&gt;&lt;/div&gt;</div><div class=\"line\">    &lt;div class=&quot;update_time&quot;&gt;$&#123;nowTime&#125;&lt;/div&gt;</div><div class=\"line\">    &lt;a class=&quot;download&quot; href=&quot;$&#123;ios_install_url&#125;&quot;&gt;点击这里安装&lt;/a&gt;</div><div class=\"line\">    &lt;div class=&quot;log_title&quot;&gt;更新日志&lt;/div&gt;</div><div class=\"line\">    &lt;div class=&quot;log&quot;&gt; $&#123;git_log&#125; &lt;/div&gt;</div><div class=\"line\">&lt;/div&gt;</div><div class=\"line\">&lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div><div class=\"line\">EOF</div><div class=\"line\"></div><div class=\"line\">#生成plist文件</div><div class=\"line\">cat &lt;&lt; EOF &gt; $&#123;scheme_name&#125;.plist</div><div class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class=\"line\">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</div><div class=\"line\">&lt;plist version=&quot;1.0&quot;&gt;</div><div class=\"line\">&lt;dict&gt;</div><div class=\"line\">   &lt;key&gt;items&lt;/key&gt;</div><div class=\"line\">   &lt;array&gt;</div><div class=\"line\">       &lt;dict&gt;</div><div class=\"line\">           &lt;key&gt;assets&lt;/key&gt;</div><div class=\"line\">           &lt;array&gt;</div><div class=\"line\">               &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;software-package&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;$&#123;ipa_download_url&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">               &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;display-image&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;needs-shine&lt;/key&gt;</div><div class=\"line\">                   &lt;true/&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">           &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;full-size-image&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;needs-shine&lt;/key&gt;</div><div class=\"line\">                   &lt;true/&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">           &lt;/array&gt;&lt;key&gt;metadata&lt;/key&gt;</div><div class=\"line\">           &lt;dict&gt;</div><div class=\"line\">               &lt;key&gt;bundle-identifier&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;bundleIdentifier&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;bundle-version&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;bundleVersion&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;software&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;subtitle&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;title&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt;</div><div class=\"line\">           &lt;/dict&gt;</div><div class=\"line\">       &lt;/dict&gt;</div><div class=\"line\">   &lt;/array&gt;</div><div class=\"line\">&lt;/dict&gt;</div><div class=\"line\">&lt;/plist&gt;</div><div class=\"line\">EOF</div><div class=\"line\"></div><div class=\"line\">#fir i $scheme_name.ipa</div><div class=\"line\">cp $scheme_name.ipa $public_git_path</div><div class=\"line\">cp $scheme_name.plist $public_git_path</div><div class=\"line\">cp index.html $public_git_path</div><div class=\"line\"></div><div class=\"line\">cd $public_git_path</div><div class=\"line\">ls -l &gt; README.md</div><div class=\"line\">if [ ! -e &quot;./.git/&quot; ]; then</div><div class=\"line\">    echo &quot;*** OSC的git目录不完整，无法上传，请联系开发! ***&quot;</div><div class=\"line\">    exit -1</div><div class=\"line\">fi</div><div class=\"line\">echo &quot;commit and pushing ...&quot;</div><div class=\"line\">git add .</div><div class=\"line\">git commit -am $bundleVersion</div><div class=\"line\">git push -f origin master</div></pre></td></tr></table></figure>","excerpt":"<p>Jenkins自动构建脚本解决方案。</p>","more":"<h2 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h2><p>  2017.1.13更新：<br>  好吧，其实有更加强悍的打包工具，虽然早有耳闻但是没弄。然后最近搭建了一下，这打包脚本也不用了，毕竟有成套工具嘛。嘿嘿<br>  不过最后上传osc的脚本还是很可以的。<br>  传送门：<a href=\"https://madordie.github.io/2017/01/04/fastlane-note/#more\">Fastlane自动化笔记</a></p>\n<h2 id=\"Xcode8\"><a href=\"#Xcode8\" class=\"headerlink\" title=\"Xcode8\"></a>Xcode8</h2><p>  好悲催，Xcode8更新之后Jenkins打包失败了。。由于代码库中使用了swift3语法，故必须使用Xcode8。。</p>\n<p>  先来重点：可用脚本：</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</div><div class=\"line\"></span></div><div class=\"line\"><span class=\"comment\">#   追上fir API token 自动上传</span></div><div class=\"line\"><span class=\"comment\">#   基于当前代码进行打包打包目录：MyProject/build/MyProject_ent.ipa</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">cd</span> MyProject</div><div class=\"line\"></div><div class=\"line\">rm -rf ./build/*</div><div class=\"line\"></div><div class=\"line\">xcodebuild -archivePath <span class=\"string\">\"./build/xxx.xcarchive\"</span> -workspace MyProject.xcworkspace -sdk iphoneos -scheme <span class=\"string\">\"MyProject_ent\"</span> -configuration <span class=\"string\">\"Release Inhouse\"</span> archive</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"&lt;?xml version=\"</span>1.0<span class=\"string\">\" encoding=\"</span>UTF-8<span class=\"string\">\"?&gt;&lt;!DOCTYPE plist PUBLIC \"</span>-//Apple//DTD PLIST 1.0//EN<span class=\"string\">\" \"</span>http://www.apple.com/DTDs/PropertyList-1.0.dtd<span class=\"string\">\"&gt;&lt;plist version=\"</span>1.0<span class=\"string\">\"&gt;&lt;dict&gt;&lt;key&gt;method&lt;/key&gt;&lt;string&gt;enterprise&lt;/string&gt;&lt;key&gt;compileBitcode&lt;/key&gt;&lt;string&gt;YES&lt;/string&gt;&lt;/dict&gt;&lt;/plist&gt;\"</span> &gt; ./build/<span class=\"built_in\">export</span>OptionsPlist.plist</div><div class=\"line\"></div><div class=\"line\">xcodebuild -exportArchive -archivePath <span class=\"string\">\"./build/xxx.xcarchive\"</span> -exportPath <span class=\"string\">\"./build/\"</span> -exportOptionsPlist ./build/<span class=\"built_in\">export</span>OptionsPlist.plist</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">cd</span> build/</div><div class=\"line\"></div><div class=\"line\">fir i ./MyProject_ent.ipa</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">if</span> [ -n <span class=\"string\">\"<span class=\"variable\">$1</span>\"</span> ]; <span class=\"keyword\">then</span></div><div class=\"line\">    git <span class=\"built_in\">log</span> -10 &gt; git.log</div><div class=\"line\">    fir p ./MyProject_ent.ipa -T <span class=\"variable\">$1</span> -c git.log</div><div class=\"line\"><span class=\"keyword\">fi</span></div></pre></td></tr></table></figure>\n<p>  之前漏掉了一个错误：<code>The flag -exportFormat cannot be specified along with -exportOptionsPlist</code> 导致了最终包签名错误，而无法安装。</p>\n<p>  exportOptionsPlist参考的<a href=\"https://testerhome.com/topics/4619\">iOS 打包总结</a></p>\n<h2 id=\"手动上传\"><a href=\"#手动上传\" class=\"headerlink\" title=\"手动上传\"></a>手动上传</h2>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div></pre></td><td class=\"code\"><pre><div class=\"line\">#!/bin/bash</div><div class=\"line\"></div><div class=\"line\">#   追上fir API token 自动上传</div><div class=\"line\">#   基于当前代码进行打包打包目录：xxxx/build/xxxx_ent.ipa</div><div class=\"line\"></div><div class=\"line\">workspace_name=xxxx</div><div class=\"line\">scheme_name=xxxx_ent</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">cd $workspace_name</div><div class=\"line\"></div><div class=\"line\">rm -rf ./build/*</div><div class=\"line\"></div><div class=\"line\">xcodebuild -archivePath &quot;./build/xxx.xcarchive&quot; -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration &quot;Release Inhouse&quot; archive</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">cat &lt;&lt; EOF &gt; ./build/exportOptionsPlist.plist</div><div class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class=\"line\">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</div><div class=\"line\">&lt;plist version=&quot;1.0&quot;&gt;</div><div class=\"line\">    &lt;dict&gt;</div><div class=\"line\">        &lt;key&gt;method&lt;/key&gt;</div><div class=\"line\">        &lt;string&gt;enterprise&lt;/string&gt;</div><div class=\"line\">        &lt;key&gt;compileBitcode&lt;/key&gt;</div><div class=\"line\">            &lt;false/&gt;</div><div class=\"line\">    &lt;/dict&gt;</div><div class=\"line\">&lt;/plist&gt;</div><div class=\"line\">EOF</div><div class=\"line\"></div><div class=\"line\">xcodebuild -exportArchive -archivePath &quot;./build/xxx.xcarchive&quot; -exportOptionsPlist &quot;./build/exportOptionsPlist.plist&quot; -exportPath &quot;./build/&quot;</div><div class=\"line\"></div><div class=\"line\">cd build/</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">git log -10 &gt; git.log</div><div class=\"line\"></div><div class=\"line\">#拷贝ipa到临时文件夹中</div><div class=\"line\">cp ./$scheme_name.ipa ./tmp.zip</div><div class=\"line\">#将ipa解压</div><div class=\"line\">unzip tmp.zip</div><div class=\"line\"></div><div class=\"line\">#app文件中Info.plist文件路径</div><div class=\"line\">app_infoplist_path=$(pwd)/Payload/*.app/Info.plist</div><div class=\"line\">#取bundleIdentifier</div><div class=\"line\">bundleIdentifier=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleIdentifier&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">#取build值</div><div class=\"line\">bundleVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleVersion&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">#显示名称</div><div class=\"line\">ipa_name=$workspace_name</div><div class=\"line\"></div><div class=\"line\">#ipa下载url</div><div class=\"line\">ipa_download_url=&quot;https://***/install_ipa/raw/master/xxxx_ent.ipa&quot;</div><div class=\"line\">#itms-services协议串</div><div class=\"line\">ios_install_url=&quot;itms-services://?action=download-manifest&amp;url=https://***/install_ipa/raw/master/xxxx_ent.plist&quot;</div><div class=\"line\"></div><div class=\"line\">#生成install.html文件</div><div class=\"line\"></div><div class=\"line\">cat &lt;&lt; EOF &gt; index.html</div><div class=\"line\">&lt;!DOCTYPE HTML&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">  &lt;head&gt;</div><div class=\"line\">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</div><div class=\"line\">    &lt;title&gt;安装&lt;/title&gt;</div><div class=\"line\">  &lt;/head&gt;</div><div class=\"line\">  &lt;body&gt;</div><div class=\"line\">    &lt;br&gt;</div><div class=\"line\">    &lt;br&gt;</div><div class=\"line\">    &lt;br&gt;</div><div class=\"line\">    &lt;br&gt;</div><div class=\"line\">    &lt;p align=center&gt;</div><div class=\"line\">        &lt;font size=&quot;8&quot;&gt;</div><div class=\"line\">            &lt;a href=&quot;$&#123;ios_install_url&#125;&quot;&gt;点击这里安装&lt;/a&gt;</div><div class=\"line\">        &lt;/font&gt;</div><div class=\"line\">    &lt;/p&gt;</div><div class=\"line\"></div><div class=\"line\">    &lt;/div&gt;</div><div class=\"line\">  &lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div><div class=\"line\">EOF</div><div class=\"line\"></div><div class=\"line\">#生成plist文件</div><div class=\"line\">cat &lt;&lt; EOF &gt; $&#123;workspace_name&#125;.plist</div><div class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class=\"line\">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</div><div class=\"line\">&lt;plist version=&quot;1.0&quot;&gt;</div><div class=\"line\">&lt;dict&gt;</div><div class=\"line\">   &lt;key&gt;items&lt;/key&gt;</div><div class=\"line\">   &lt;array&gt;</div><div class=\"line\">       &lt;dict&gt;</div><div class=\"line\">           &lt;key&gt;assets&lt;/key&gt;</div><div class=\"line\">           &lt;array&gt;</div><div class=\"line\">               &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;software-package&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;$&#123;ipa_download_url&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">               &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;display-image&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;needs-shine&lt;/key&gt;</div><div class=\"line\">                   &lt;true/&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">           &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;full-size-image&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;needs-shine&lt;/key&gt;</div><div class=\"line\">                   &lt;true/&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">           &lt;/array&gt;&lt;key&gt;metadata&lt;/key&gt;</div><div class=\"line\">           &lt;dict&gt;</div><div class=\"line\">               &lt;key&gt;bundle-identifier&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;bundleIdentifier&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;bundle-version&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;bundleVersion&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;software&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;subtitle&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;title&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt;</div><div class=\"line\">           &lt;/dict&gt;</div><div class=\"line\">       &lt;/dict&gt;</div><div class=\"line\">   &lt;/array&gt;</div><div class=\"line\">&lt;/dict&gt;</div><div class=\"line\">&lt;/plist&gt;</div><div class=\"line\">EOF</div><div class=\"line\"></div><div class=\"line\">fir i $scheme_name.ipa</div></pre></td></tr></table></figure>\n<h2 id=\"手动上传到OSC脚本\"><a href=\"#手动上传到OSC脚本\" class=\"headerlink\" title=\"手动上传到OSC脚本\"></a>手动上传到OSC脚本</h2>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div></pre></td><td class=\"code\"><pre><div class=\"line\">#!/bin/bash</div><div class=\"line\"></div><div class=\"line\">root_path=$(pwd)</div><div class=\"line\">workspace_name=Fangduoduo</div><div class=\"line\">scheme_name=XXX</div><div class=\"line\"></div><div class=\"line\"># 编译</div><div class=\"line\">cd $root_path</div><div class=\"line\">cd $workspace_name</div><div class=\"line\"></div><div class=\"line\">rm -rf ./build/*</div><div class=\"line\"></div><div class=\"line\">xcodebuild -archivePath ./build/$scheme_name.xcarchive -workspace $workspace_name.xcworkspace -sdk iphoneos -scheme $scheme_name -configuration &quot;Release Inhouse&quot; archive</div><div class=\"line\"></div><div class=\"line\">echo &quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;&lt;plist version=&quot;1.0&quot;&gt;&lt;dict&gt;&lt;key&gt;method&lt;/key&gt;&lt;string&gt;enterprise&lt;/string&gt;&lt;key&gt;compileBitcode&lt;/key&gt;&lt;false/&gt;&lt;/dict&gt;&lt;/plist&gt;&quot; &gt; ./build/exportOptionsPlist.plist</div><div class=\"line\"></div><div class=\"line\">xcodebuild -exportArchive -archivePath ./build/$scheme_name.xcarchive -exportOptionsPlist &quot;./build/exportOptionsPlist.plist&quot; -exportPath &quot;./build/&quot;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">cd build/</div><div class=\"line\"></div><div class=\"line\">if [ ! -f $scheme_name.ipa ]; then</div><div class=\"line\">    echo &quot;*** 无法打包 ***&quot;</div><div class=\"line\">    exit -1</div><div class=\"line\">fi</div><div class=\"line\"></div><div class=\"line\">fir i ./$scheme_name.ipa</div><div class=\"line\"></div><div class=\"line\">git log -10 &gt; git.log</div><div class=\"line\">git_log=$(cat git.log)</div><div class=\"line\"># fir 上传</div><div class=\"line\">if [ -n &quot;$1&quot; ]; then</div><div class=\"line\">    fir p ./$scheme_name.ipa -T $1 -c git.log</div><div class=\"line\">fi</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># 校验HTML并上传</div><div class=\"line\"></div><div class=\"line\">public_git_path=$root_path/public_ipa_tmp/</div><div class=\"line\">public_git_root=&quot;install_ipa&quot;</div><div class=\"line\">public_git=&quot;https://***/install_ipa.git&quot;</div><div class=\"line\">#ipa下载url</div><div class=\"line\">ipa_download_url=&quot;https://***/install_ipa/raw/master/XXX.ipa&quot;</div><div class=\"line\">#itms-services协议串</div><div class=\"line\">ios_install_url=&quot;itms-services://?action=download-manifest&amp;url=https://***/install_ipa/raw/master/XXX.plist&quot;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">cd $root_path/</div><div class=\"line\"># checkout path is OK</div><div class=\"line\">if [ ! -e $public_git_path ]; then</div><div class=\"line\">    mkdir $public_git_path</div><div class=\"line\">fi</div><div class=\"line\"></div><div class=\"line\">if [ -n $public_git_path ]; then</div><div class=\"line\">    rm -rf $public_git_path</div><div class=\"line\">fi</div><div class=\"line\">mkdir $public_git_path</div><div class=\"line\">cd $public_git_path</div><div class=\"line\">git init</div><div class=\"line\">git remote add origin $public_git</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">cd $root_path/$workspace_name/build/</div><div class=\"line\"></div><div class=\"line\">#拷贝ipa到临时文件夹中</div><div class=\"line\">cp ./$scheme_name.ipa ./tmp.zip</div><div class=\"line\">rm -rf Payload</div><div class=\"line\">#将ipa解压</div><div class=\"line\">unzip tmp.zip</div><div class=\"line\"></div><div class=\"line\">#app文件中Info.plist文件路径</div><div class=\"line\">app_infoplist_path=$(pwd)/Payload/*.app/Info.plist</div><div class=\"line\">#取bundleIdentifier</div><div class=\"line\">bundleIdentifier=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleIdentifier&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">#取build值</div><div class=\"line\">bundleVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleVersion&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">#取shortVersionbuild值</div><div class=\"line\">shortVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleShortVersionString&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">#显示名称</div><div class=\"line\">ipa_name=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleDisplayName&quot; $&#123;app_infoplist_path&#125;)</div><div class=\"line\">nowTime=$(date +%Y-%m-%d\\ %H:%M)</div><div class=\"line\">log_url=&quot;https://madordie.github.io/uploads/avatar.png&quot;</div><div class=\"line\"></div><div class=\"line\">#生成install.html文件</div><div class=\"line\"></div><div class=\"line\">cat &lt;&lt; EOF &gt; index.html</div><div class=\"line\">&lt;!DOCTYPE HTML&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">&lt;head&gt;</div><div class=\"line\">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</div><div class=\"line\">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0&quot;&gt;</div><div class=\"line\">&lt;title&gt;$&#123;ipa_name&#125;安装&lt;/title&gt;</div><div class=\"line\">&lt;style&gt;</div><div class=\"line\">.containor &#123;</div><div class=\"line\">    position: relative;</div><div class=\"line\">    top: 0;</div><div class=\"line\">    left: 0;</div><div class=\"line\">    right: 0;</div><div class=\"line\">    margin: 0 auto;</div><div class=\"line\">    width: 100%;</div><div class=\"line\">    max-width: 640px;</div><div class=\"line\">    text-align: center;</div><div class=\"line\">&#125;</div><div class=\"line\">.logo &#123;</div><div class=\"line\">    width: 120px;</div><div class=\"line\">    margin-top: 30px;</div><div class=\"line\">&#125;</div><div class=\"line\">.title,</div><div class=\"line\">.version_history,</div><div class=\"line\">.update_time &#123;</div><div class=\"line\">    text-align: center;</div><div class=\"line\">    color: #999;</div><div class=\"line\">    font-size: 16px;</div><div class=\"line\">&#125;</div><div class=\"line\">.title &#123;</div><div class=\"line\">    margin-top: 10px;</div><div class=\"line\">&#125;</div><div class=\"line\">.version_history,</div><div class=\"line\">.update_time &#123;</div><div class=\"line\">    margin-top: 5px;</div><div class=\"line\">&#125;</div><div class=\"line\">.download &#123;</div><div class=\"line\">    display: block;</div><div class=\"line\">    width: 150px;</div><div class=\"line\">    height: 30px;</div><div class=\"line\">    line-height: 30px;</div><div class=\"line\">    margin: 0 auto;</div><div class=\"line\">    margin-top: 20px;</div><div class=\"line\">    border: 1px solid #eee;</div><div class=\"line\">    border-radius: 20px;</div><div class=\"line\">    text-decoration: none;</div><div class=\"line\">    color: #999;</div><div class=\"line\">&#125;</div><div class=\"line\">.log_title &#123;</div><div class=\"line\">    margin-top: 20px;</div><div class=\"line\">    font-size: 18px;</div><div class=\"line\">    color: #333;</div><div class=\"line\">&#125;</div><div class=\"line\">.log &#123;</div><div class=\"line\">    color: #aaa;</div><div class=\"line\">    padding: 20px;</div><div class=\"line\">    text-align: left;</div><div class=\"line\">    font-size: 12px;</div><div class=\"line\">    line-height: 15px;</div><div class=\"line\">    white-space: pre-wrap;</div><div class=\"line\">    word-wrap: break-word;</div><div class=\"line\">    overflow: hidden;</div><div class=\"line\">&#125;</div><div class=\"line\">&lt;/style&gt;</div><div class=\"line\">&lt;/head&gt;</div><div class=\"line\">&lt;body&gt;</div><div class=\"line\">&lt;div class=&quot;containor&quot;&gt;</div><div class=\"line\">    &lt;img class=&quot;logo&quot; src=$&#123;log_url&#125; /&gt;</div><div class=\"line\">    &lt;div class=&quot;title&quot;&gt;$ipa_name&lt;/div&gt;</div><div class=\"line\">    &lt;div class=&quot;version_history&quot;&gt;$&#123;shortVersion&#125;(bundle:$&#123;bundleVersion&#125;)&lt;/div&gt;</div><div class=\"line\">    &lt;div&gt;&lt;/div&gt;</div><div class=\"line\">    &lt;div class=&quot;update_time&quot;&gt;$&#123;nowTime&#125;&lt;/div&gt;</div><div class=\"line\">    &lt;a class=&quot;download&quot; href=&quot;$&#123;ios_install_url&#125;&quot;&gt;点击这里安装&lt;/a&gt;</div><div class=\"line\">    &lt;div class=&quot;log_title&quot;&gt;更新日志&lt;/div&gt;</div><div class=\"line\">    &lt;div class=&quot;log&quot;&gt; $&#123;git_log&#125; &lt;/div&gt;</div><div class=\"line\">&lt;/div&gt;</div><div class=\"line\">&lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div><div class=\"line\">EOF</div><div class=\"line\"></div><div class=\"line\">#生成plist文件</div><div class=\"line\">cat &lt;&lt; EOF &gt; $&#123;scheme_name&#125;.plist</div><div class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class=\"line\">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</div><div class=\"line\">&lt;plist version=&quot;1.0&quot;&gt;</div><div class=\"line\">&lt;dict&gt;</div><div class=\"line\">   &lt;key&gt;items&lt;/key&gt;</div><div class=\"line\">   &lt;array&gt;</div><div class=\"line\">       &lt;dict&gt;</div><div class=\"line\">           &lt;key&gt;assets&lt;/key&gt;</div><div class=\"line\">           &lt;array&gt;</div><div class=\"line\">               &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;software-package&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;$&#123;ipa_download_url&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">               &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;display-image&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;needs-shine&lt;/key&gt;</div><div class=\"line\">                   &lt;true/&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">           &lt;dict&gt;</div><div class=\"line\">                   &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;full-size-image&lt;/string&gt;</div><div class=\"line\">                   &lt;key&gt;needs-shine&lt;/key&gt;</div><div class=\"line\">                   &lt;true/&gt;</div><div class=\"line\">                   &lt;key&gt;url&lt;/key&gt;</div><div class=\"line\">                   &lt;string&gt;http://git.oschina.net/logo.svg&lt;/string&gt;</div><div class=\"line\">               &lt;/dict&gt;</div><div class=\"line\">           &lt;/array&gt;&lt;key&gt;metadata&lt;/key&gt;</div><div class=\"line\">           &lt;dict&gt;</div><div class=\"line\">               &lt;key&gt;bundle-identifier&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;bundleIdentifier&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;bundle-version&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;bundleVersion&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;kind&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;software&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;subtitle&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt;</div><div class=\"line\">               &lt;key&gt;title&lt;/key&gt;</div><div class=\"line\">               &lt;string&gt;$&#123;ipa_name&#125;&lt;/string&gt;</div><div class=\"line\">           &lt;/dict&gt;</div><div class=\"line\">       &lt;/dict&gt;</div><div class=\"line\">   &lt;/array&gt;</div><div class=\"line\">&lt;/dict&gt;</div><div class=\"line\">&lt;/plist&gt;</div><div class=\"line\">EOF</div><div class=\"line\"></div><div class=\"line\">#fir i $scheme_name.ipa</div><div class=\"line\">cp $scheme_name.ipa $public_git_path</div><div class=\"line\">cp $scheme_name.plist $public_git_path</div><div class=\"line\">cp index.html $public_git_path</div><div class=\"line\"></div><div class=\"line\">cd $public_git_path</div><div class=\"line\">ls -l &gt; README.md</div><div class=\"line\">if [ ! -e &quot;./.git/&quot; ]; then</div><div class=\"line\">    echo &quot;*** OSC的git目录不完整，无法上传，请联系开发! ***&quot;</div><div class=\"line\">    exit -1</div><div class=\"line\">fi</div><div class=\"line\">echo &quot;commit and pushing ...&quot;</div><div class=\"line\">git add .</div><div class=\"line\">git commit -am $bundleVersion</div><div class=\"line\">git push -f origin master</div></pre></td></tr></table></figure>"},{"title":"关于转载的文章","date":"2016-07-24T03:52:40.000Z","_content":"\n一点删除原链接的转载文章的牢骚\n\n<!--more-->\n\n# 缘由\n\n前两天看到朋友圈一个哥们转载了许多关于iOS的一些文章，很是兴奋，去围观。突然发现这文笔绝对是经过校对的。心中大喜，以为淘到宝了（因为文章并没有署名转载出处，所以应该是原创）。之后看了一下他的另一个文章，刚好我百度过这个文章的原作者的最后一个系列的，于是我又翻阅了一下看看是不是不一样，结果和我想的一样，除了删除了作者的署名之外其他的都是一样的。于是关掉了网页，心中默默的鄙视。\n\n\n# 关于转载的别人文章\n\n对于一些大神的技术文章都是喜欢的，爱不释手的那种，我也是。有的能转载的我就转载，不能转载的，我会复制下来，放在我自己的文件夹中，为的是方便查询。在转载的时候我会特意标示转载的地址。而且一般情况下我会在文章的开始写上几句简单的主要的思想（比如：[《[转]蓝牙开发》](http://www.cnblogs.com/madordie/p/5159597.html)、[《[搬运] mac下安装GDB》](http://www.cnblogs.com/madordie/p/4322044.html)、[《［搬运］MAC 下安装 brew》](http://www.cnblogs.com/madordie/p/4322042.html)），当然有时候没来得及的就忘了😂（比如：[《[搬运] iOS 7 侧滑返回手势使用和错误集》](http://www.cnblogs.com/madordie/p/4357685.html)）。\n\n还有关于文章的排版，殊不知原作者为了让读者更好的阅读会对排版做的比较好，有的人为了阅读方便会去阅读原作者的文章。比如说我这种强迫症。\n\n\n# 我对删除原链的转载文章态度\n\n然后说一下我对于那些抄袭的，然后删除了原链接的人鄙视一下。每一篇文章都是别人花费了大量的精力去完成的，有的为了让读者能够更清楚的理解，所以会在发布的时候找别人去读一读，看能不能理解其中云云。然而对文章的原链接保存是一种对别人劳动成果的尊重，对原作者最基本的尊重。\n\n别的不想多说了。转载请注明出处。谢谢！\n且行且珍惜。","source":"_posts/about-reprint-article.md","raw":"---\ntitle: 关于转载的文章\ndate: 2016-07-24 11:52:40\ncategories:\n    - 牢骚\n---\n\n一点删除原链接的转载文章的牢骚\n\n<!--more-->\n\n# 缘由\n\n前两天看到朋友圈一个哥们转载了许多关于iOS的一些文章，很是兴奋，去围观。突然发现这文笔绝对是经过校对的。心中大喜，以为淘到宝了（因为文章并没有署名转载出处，所以应该是原创）。之后看了一下他的另一个文章，刚好我百度过这个文章的原作者的最后一个系列的，于是我又翻阅了一下看看是不是不一样，结果和我想的一样，除了删除了作者的署名之外其他的都是一样的。于是关掉了网页，心中默默的鄙视。\n\n\n# 关于转载的别人文章\n\n对于一些大神的技术文章都是喜欢的，爱不释手的那种，我也是。有的能转载的我就转载，不能转载的，我会复制下来，放在我自己的文件夹中，为的是方便查询。在转载的时候我会特意标示转载的地址。而且一般情况下我会在文章的开始写上几句简单的主要的思想（比如：[《[转]蓝牙开发》](http://www.cnblogs.com/madordie/p/5159597.html)、[《[搬运] mac下安装GDB》](http://www.cnblogs.com/madordie/p/4322044.html)、[《［搬运］MAC 下安装 brew》](http://www.cnblogs.com/madordie/p/4322042.html)），当然有时候没来得及的就忘了😂（比如：[《[搬运] iOS 7 侧滑返回手势使用和错误集》](http://www.cnblogs.com/madordie/p/4357685.html)）。\n\n还有关于文章的排版，殊不知原作者为了让读者更好的阅读会对排版做的比较好，有的人为了阅读方便会去阅读原作者的文章。比如说我这种强迫症。\n\n\n# 我对删除原链的转载文章态度\n\n然后说一下我对于那些抄袭的，然后删除了原链接的人鄙视一下。每一篇文章都是别人花费了大量的精力去完成的，有的为了让读者能够更清楚的理解，所以会在发布的时候找别人去读一读，看能不能理解其中云云。然而对文章的原链接保存是一种对别人劳动成果的尊重，对原作者最基本的尊重。\n\n别的不想多说了。转载请注明出处。谢谢！\n且行且珍惜。","slug":"about-reprint-article","published":1,"updated":"2017-03-25T04:12:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f9g000al0uvffi83r9e","content":"<p>一点删除原链接的转载文章的牢骚</p>\n<a id=\"more\"></a>\n<h1 id=\"缘由\"><a href=\"#缘由\" class=\"headerlink\" title=\"缘由\"></a>缘由</h1><p>前两天看到朋友圈一个哥们转载了许多关于iOS的一些文章，很是兴奋，去围观。突然发现这文笔绝对是经过校对的。心中大喜，以为淘到宝了（因为文章并没有署名转载出处，所以应该是原创）。之后看了一下他的另一个文章，刚好我百度过这个文章的原作者的最后一个系列的，于是我又翻阅了一下看看是不是不一样，结果和我想的一样，除了删除了作者的署名之外其他的都是一样的。于是关掉了网页，心中默默的鄙视。</p>\n<h1 id=\"关于转载的别人文章\"><a href=\"#关于转载的别人文章\" class=\"headerlink\" title=\"关于转载的别人文章\"></a>关于转载的别人文章</h1><p>对于一些大神的技术文章都是喜欢的，爱不释手的那种，我也是。有的能转载的我就转载，不能转载的，我会复制下来，放在我自己的文件夹中，为的是方便查询。在转载的时候我会特意标示转载的地址。而且一般情况下我会在文章的开始写上几句简单的主要的思想（比如：<a href=\"http://www.cnblogs.com/madordie/p/5159597.html\" target=\"_blank\" rel=\"external\">《[转]蓝牙开发》</a>、<a href=\"http://www.cnblogs.com/madordie/p/4322044.html\" target=\"_blank\" rel=\"external\">《[搬运] mac下安装GDB》</a>、<a href=\"http://www.cnblogs.com/madordie/p/4322042.html\" target=\"_blank\" rel=\"external\">《［搬运］MAC 下安装 brew》</a>），当然有时候没来得及的就忘了😂（比如：<a href=\"http://www.cnblogs.com/madordie/p/4357685.html\" target=\"_blank\" rel=\"external\">《[搬运] iOS 7 侧滑返回手势使用和错误集》</a>）。</p>\n<p>还有关于文章的排版，殊不知原作者为了让读者更好的阅读会对排版做的比较好，有的人为了阅读方便会去阅读原作者的文章。比如说我这种强迫症。</p>\n<h1 id=\"我对删除原链的转载文章态度\"><a href=\"#我对删除原链的转载文章态度\" class=\"headerlink\" title=\"我对删除原链的转载文章态度\"></a>我对删除原链的转载文章态度</h1><p>然后说一下我对于那些抄袭的，然后删除了原链接的人鄙视一下。每一篇文章都是别人花费了大量的精力去完成的，有的为了让读者能够更清楚的理解，所以会在发布的时候找别人去读一读，看能不能理解其中云云。然而对文章的原链接保存是一种对别人劳动成果的尊重，对原作者最基本的尊重。</p>\n<p>别的不想多说了。转载请注明出处。谢谢！<br>且行且珍惜。</p>\n","excerpt":"<p>一点删除原链接的转载文章的牢骚</p>","more":"<h1 id=\"缘由\"><a href=\"#缘由\" class=\"headerlink\" title=\"缘由\"></a>缘由</h1><p>前两天看到朋友圈一个哥们转载了许多关于iOS的一些文章，很是兴奋，去围观。突然发现这文笔绝对是经过校对的。心中大喜，以为淘到宝了（因为文章并没有署名转载出处，所以应该是原创）。之后看了一下他的另一个文章，刚好我百度过这个文章的原作者的最后一个系列的，于是我又翻阅了一下看看是不是不一样，结果和我想的一样，除了删除了作者的署名之外其他的都是一样的。于是关掉了网页，心中默默的鄙视。</p>\n<h1 id=\"关于转载的别人文章\"><a href=\"#关于转载的别人文章\" class=\"headerlink\" title=\"关于转载的别人文章\"></a>关于转载的别人文章</h1><p>对于一些大神的技术文章都是喜欢的，爱不释手的那种，我也是。有的能转载的我就转载，不能转载的，我会复制下来，放在我自己的文件夹中，为的是方便查询。在转载的时候我会特意标示转载的地址。而且一般情况下我会在文章的开始写上几句简单的主要的思想（比如：<a href=\"http://www.cnblogs.com/madordie/p/5159597.html\">《[转]蓝牙开发》</a>、<a href=\"http://www.cnblogs.com/madordie/p/4322044.html\">《[搬运] mac下安装GDB》</a>、<a href=\"http://www.cnblogs.com/madordie/p/4322042.html\">《［搬运］MAC 下安装 brew》</a>），当然有时候没来得及的就忘了😂（比如：<a href=\"http://www.cnblogs.com/madordie/p/4357685.html\">《[搬运] iOS 7 侧滑返回手势使用和错误集》</a>）。</p>\n<p>还有关于文章的排版，殊不知原作者为了让读者更好的阅读会对排版做的比较好，有的人为了阅读方便会去阅读原作者的文章。比如说我这种强迫症。</p>\n<h1 id=\"我对删除原链的转载文章态度\"><a href=\"#我对删除原链的转载文章态度\" class=\"headerlink\" title=\"我对删除原链的转载文章态度\"></a>我对删除原链的转载文章态度</h1><p>然后说一下我对于那些抄袭的，然后删除了原链接的人鄙视一下。每一篇文章都是别人花费了大量的精力去完成的，有的为了让读者能够更清楚的理解，所以会在发布的时候找别人去读一读，看能不能理解其中云云。然而对文章的原链接保存是一种对别人劳动成果的尊重，对原作者最基本的尊重。</p>\n<p>别的不想多说了。转载请注明出处。谢谢！<br>且行且珍惜。</p>"},{"title":"科学上网之搬瓦工ss搭建笔记","date":"2016-12-19T12:37:11.000Z","_content":"\n原来吧，用用goagent、Lantern、XX-Net，确实，这玩意只能Google出来结果，但是有的站点打不开才是最骚的。。\n同事搞了个搬瓦工挺便宜，于是乎就也搞了一个。不过强迫症犯了，尝试了各种SS版本以及各种优化，目的是找个流畅点的版本进行__科学上网__。\n\n<!--more-->\n\n# 写在前面\n  - 红线越不得！红线越不得！红线越不得！重要的事情说3遍。\n  - 参看第一条\n  - 参看第一条\n  - 参看第一条\n  \n# 目前安装的 rss\n  尝试了各种版本的系统，各种ss分支，最后用了rss，然后又花了一下，觉得速度可以了，延迟的问题无解。ping过去就是那么慢。。\n  注意：为了重启不配置，要把里面没有自启动的添加到启动项。具体方法 Google一下。我加在了 `/etc/rc.local`\n\n## shadowsocks-rss\n  - [wiki](https://github.com/breakwa11/shadowsocks-rss/wiki)\n  - [ShadowsocksR 服务端安装教程](https://github.com/breakwa11/shadowsocks-rss/wiki/Server-Setup)\n  - [macOS](https://github.com/shadowsocksr/ShadowsocksX-NG/releases)\n  - [iOS](https://itunes.apple.com/cn/app/id1178584911)\n  \n  [2017.1.18更新]：\n  新版rss版本可能自动启动连接成功无法上网。服务器日志会出现`tcprelay.py:935 can not parse header when handling connection from`的错误，这个是由于在启动的时候默认才用了混淆。在配置的时候需要注意一下。也可直接在`user-config.json`中修改或者删除。[配置说明](https://github.com/breakwa11/shadowsocks-rss/wiki/config.json)\n  \n## 优化\n  - [官方优化方案](http://shadowsocks.org/en/config/advanced.html)\n  - [Net Speeder](https://www.dou-bi.co/netspeeder-jc1/) `wget http://linux.linzhihao.cn/shell/netspeeder.sh & bash netspeeder.sh`\n\n## history\n  chacha20的插件忘记了按照哪种方式安装的了。将我安装的历史命令放出来：\n\n  ```\n    1  yum install git\n    2  git clone -b manyuser https://github.com/breakwa11/shadowsocks.git\n    3  cd ~/shadowsocks\n    4  bash initcfg.sh\n    5  cd ~/shadowsocks/shadowsocks\n    6  python server.py -p 443 -k password -m chacha20\n    7  python server.py -p 443 -k password -m aes-256-cfb \n    8  python server.py -p 443 -k password -m rc4-md5\n    9  yum install epel-release\n   10  yum install libsodium\n   11  python server.py -p 443 -k password -m chacha20\n   12  yum install libsodium\n   13  python server.py -p 443 -k password -m chacha20\n   14  yum install libsodium\n   15  yum install libsodium update\n   16  yum update\n   17  yum install libsodium\n   18  yum -y groupinstall \"Development Tools\"\n   19  wget https://github.com/jedisct1/libsodium/releases/download/1.0.10/libsodium-1.0.10.tar.gz\n   20  tar xf libsodium-1.0.10.tar.gz && cd libsodium-1.0.10\n   21  ./configure && make -j2 && make install\n   22  echo /usr/local/lib > /etc/ld.so.conf.d/usr_local_lib.conf\n   23  ldconfig\n   24  yum install libsodium\n   25  cd ../\n   26  ls\n   27  python server.py -p 443 -k password -m chacha20\n   28  echo \"python server.py -p 443 -k password -m chacha20 -d start\"\n   29  echo \"python server.py -p 443 -k password -m chacha20 -d start\" >> /etc/rc.local \n   30  reboot\n   31  cd //\n   32  cd ~/\n   33  cd shadowsocks/\n   34  ls\n   35  cd shadowsocks/\n   36  ls\n   37  cd ../\n   38  ls\n   39  pwd\n   40  vim /etc/rc.local \n   41  reboot\n   42  cd shadowsocks/\n   43  python server.py -p 443 -k password -m chacha20 -d start\n   44  python ~/shadowsocks/shadowsocks/server.py -p 443 -k password -m chacha20 -d start\n   45  vim /etc/rc.local \n   46  reboot\n   47  rm -f /sbin/modprobe\n   48  ln -s /bin/true /sbin/modprobe\n   49  rm -f /sbin/sysctl\n   50  ln -s /bin/true /sbin/sysctl\n   51  vi /etc/sysctl.conf\n   52  sysctl -p\n   53  reboot\n   54  wget http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el5.rf.i386.rpm\n   55  vim /etc/rc.local \n   56  reboot\n   57  python server.py status\n   58  cd shadowsocks/shadowsocks/\n   59  python server.py status\n   60  exit\n   61  vim /etc/rc.local \n   62  reboot\n   63  ls\n   64  rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-firmware-2.6.32-504.3.3.el6.noarch.rpm\n   65  rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-2.6.32-504.3.3.el6.x86_64.rpm --force\n   66  rpm -qa | grep kernel\n   67  wget -N --no-check-certificate https://raw.githubusercontent.com/91yun/code/master/vm_check.sh && bash vm_check.sh\n   68  ls\n   69  reboot\n   70  vi /etc/security/limits.conf\n   71  vim /etc/rc.local \n   72  vim /etc/sysctl.conf\n   73  sysctl -p\n   74  reboot\n   75  ls\n   76  wget https://github.com/snooda/net-speeder/archive/master.zip\n   77  unzip master.zip\n   78  ls\n   79  rm -rf master.zip virt-what-1.12*\n   80  ls\n   81  wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\n   82  rpm -ivh epel-release-6-8.noarch.rpm\n   83  yum install libnet libpcap libnet-devel libpcap-devel\n   84  sh build.sh -DCOOKED\n   85  ls\n   86  cd net-speeder-master/\n   87  ls\n   88  sh build.sh -DCOOKED\n   89  ifconfig\n   90  ./net_speeder venet0 \"ip\"\n   91  service netspeederd start\n   92  wget –no-check-certificate https://raw.githubusercontent.com/tennfy/debian_netspeeder_tennfy/master/debian_netspeeder_tennfy.sh\n   93  chmod a+x debian_netspeeder_tennfy.sh\n   94  wget http://linux.linzhihao.cn/shell/netspeeder.sh\n   95  bash netspeeder.sh\n   96  service netspeederd start\n   97  service netspeederd status\n   98  reboot\n  ```\n\n\n## 本地访问VPS脚本\n  我比较懒，密码都是随机的也不想改，所以做了一个脚本用来直接ssh登陆。\n  后来我发现我需要下载一些文件，于是乎我增加了两个参数。。\n  安装系统的时候修改一下，将`password`修改为随机生成的密码，这样也不用记录，直接复制粘贴。。\n  同时将`12345`替换为端口号。\n  将`1.2.3.4`替换为服务器IP，这个只需要写一次就好，基本上也不会改。。\n  这样搞完之后在`~/.profile`中增加`alias vps=\"/Users/Madordie/shell/Mac_shell/ss.sh\"`，然后执行`source ~/.profile`即可。\n  \n  这样就可以使用下面的简写：\n    - SSH登陆`vps`\n    - 下载文件`vps /server_path /local_path`，自行修改后面俩参数\n  \n  ```\n  $ cat ~/shell/Mac_shell/ss.sh \n  \n  #!/bin/bash\n\n  echo 'password'\n  port=12345\n  ip=1.2.3.4\n  usr=root\n\n  if [ $# -eq 0 ]; then\n      ssh $usr@$ip -p $port\n  elif [ $# -eq 2 ]; then \n      scp -P $port $usr@$ip:$1 $2\n  else\n      echo \"($*)你要干嘛。。\"\n  fi\n\n  ```\n  \n__2017-2-7更新__: [一个SSH登录服务器的shell脚本](https://github.com/jiangxianli/SSHAutoLogin)\n\n# 尝试的时候各种用的环境搭建\n  很显然上面的已经足够了，这个只是留个笔记，用来快速搭建某个环境啥的。。\n\n## CentOS\n\n### git\n  1. 直接安装\n    ```\n    yum install git\n    ```\n\n### go\n\n  1. 下载二进制文件：\n    ```\n    wget https://storage.googleapis.com/golang/go1.7.3.linux-amd64.tar.gz\n    ```\n  2. 解压并创建工作目录：\n    ```\n    tar -zxf go1.7.3.linux-amd64.tar.gz -C /usr/local/\n    ```\n  3. 设置环境变量：\n    在 /etc/profile 添加：\n    ```\n    export GOROOT=/usr/local/go \n    export GOBIN=$GOROOT/bin\n    export GOPKG=$GOROOT/pkg/tool/linux_amd64 \n    export GOARCH=amd64\n    export GOOS=linux\n    export GOPATH=/Golang\n    export PATH=$PATH:$GOBIN:$GOPKG:$GOPATH/bin\n    ```\n    4. 使之生效或者重新登录Linux也可\n    ```\n    source /etc/profile\n    ```\n  \n## scp\n  \n  `scp -P 8888 root@127.0.0.10:/root/my_key/ca.cert.pem .`\n\n\n## Ubuntu\n\n### 更新\n  ```\n    sudo apt-get update\n  ```\n\n### git\n  ```\n  sudo apt-get install git  \n  ```\n### go\n  ```\n  sudo apt-get install golang\n  ```","source":"_posts/bandwagonhost-note.md","raw":"---\ntitle: 科学上网之搬瓦工ss搭建笔记\ndate: 2016-12-19 20:37:11\ntags:\n---\n\n原来吧，用用goagent、Lantern、XX-Net，确实，这玩意只能Google出来结果，但是有的站点打不开才是最骚的。。\n同事搞了个搬瓦工挺便宜，于是乎就也搞了一个。不过强迫症犯了，尝试了各种SS版本以及各种优化，目的是找个流畅点的版本进行__科学上网__。\n\n<!--more-->\n\n# 写在前面\n  - 红线越不得！红线越不得！红线越不得！重要的事情说3遍。\n  - 参看第一条\n  - 参看第一条\n  - 参看第一条\n  \n# 目前安装的 rss\n  尝试了各种版本的系统，各种ss分支，最后用了rss，然后又花了一下，觉得速度可以了，延迟的问题无解。ping过去就是那么慢。。\n  注意：为了重启不配置，要把里面没有自启动的添加到启动项。具体方法 Google一下。我加在了 `/etc/rc.local`\n\n## shadowsocks-rss\n  - [wiki](https://github.com/breakwa11/shadowsocks-rss/wiki)\n  - [ShadowsocksR 服务端安装教程](https://github.com/breakwa11/shadowsocks-rss/wiki/Server-Setup)\n  - [macOS](https://github.com/shadowsocksr/ShadowsocksX-NG/releases)\n  - [iOS](https://itunes.apple.com/cn/app/id1178584911)\n  \n  [2017.1.18更新]：\n  新版rss版本可能自动启动连接成功无法上网。服务器日志会出现`tcprelay.py:935 can not parse header when handling connection from`的错误，这个是由于在启动的时候默认才用了混淆。在配置的时候需要注意一下。也可直接在`user-config.json`中修改或者删除。[配置说明](https://github.com/breakwa11/shadowsocks-rss/wiki/config.json)\n  \n## 优化\n  - [官方优化方案](http://shadowsocks.org/en/config/advanced.html)\n  - [Net Speeder](https://www.dou-bi.co/netspeeder-jc1/) `wget http://linux.linzhihao.cn/shell/netspeeder.sh & bash netspeeder.sh`\n\n## history\n  chacha20的插件忘记了按照哪种方式安装的了。将我安装的历史命令放出来：\n\n  ```\n    1  yum install git\n    2  git clone -b manyuser https://github.com/breakwa11/shadowsocks.git\n    3  cd ~/shadowsocks\n    4  bash initcfg.sh\n    5  cd ~/shadowsocks/shadowsocks\n    6  python server.py -p 443 -k password -m chacha20\n    7  python server.py -p 443 -k password -m aes-256-cfb \n    8  python server.py -p 443 -k password -m rc4-md5\n    9  yum install epel-release\n   10  yum install libsodium\n   11  python server.py -p 443 -k password -m chacha20\n   12  yum install libsodium\n   13  python server.py -p 443 -k password -m chacha20\n   14  yum install libsodium\n   15  yum install libsodium update\n   16  yum update\n   17  yum install libsodium\n   18  yum -y groupinstall \"Development Tools\"\n   19  wget https://github.com/jedisct1/libsodium/releases/download/1.0.10/libsodium-1.0.10.tar.gz\n   20  tar xf libsodium-1.0.10.tar.gz && cd libsodium-1.0.10\n   21  ./configure && make -j2 && make install\n   22  echo /usr/local/lib > /etc/ld.so.conf.d/usr_local_lib.conf\n   23  ldconfig\n   24  yum install libsodium\n   25  cd ../\n   26  ls\n   27  python server.py -p 443 -k password -m chacha20\n   28  echo \"python server.py -p 443 -k password -m chacha20 -d start\"\n   29  echo \"python server.py -p 443 -k password -m chacha20 -d start\" >> /etc/rc.local \n   30  reboot\n   31  cd //\n   32  cd ~/\n   33  cd shadowsocks/\n   34  ls\n   35  cd shadowsocks/\n   36  ls\n   37  cd ../\n   38  ls\n   39  pwd\n   40  vim /etc/rc.local \n   41  reboot\n   42  cd shadowsocks/\n   43  python server.py -p 443 -k password -m chacha20 -d start\n   44  python ~/shadowsocks/shadowsocks/server.py -p 443 -k password -m chacha20 -d start\n   45  vim /etc/rc.local \n   46  reboot\n   47  rm -f /sbin/modprobe\n   48  ln -s /bin/true /sbin/modprobe\n   49  rm -f /sbin/sysctl\n   50  ln -s /bin/true /sbin/sysctl\n   51  vi /etc/sysctl.conf\n   52  sysctl -p\n   53  reboot\n   54  wget http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el5.rf.i386.rpm\n   55  vim /etc/rc.local \n   56  reboot\n   57  python server.py status\n   58  cd shadowsocks/shadowsocks/\n   59  python server.py status\n   60  exit\n   61  vim /etc/rc.local \n   62  reboot\n   63  ls\n   64  rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-firmware-2.6.32-504.3.3.el6.noarch.rpm\n   65  rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-2.6.32-504.3.3.el6.x86_64.rpm --force\n   66  rpm -qa | grep kernel\n   67  wget -N --no-check-certificate https://raw.githubusercontent.com/91yun/code/master/vm_check.sh && bash vm_check.sh\n   68  ls\n   69  reboot\n   70  vi /etc/security/limits.conf\n   71  vim /etc/rc.local \n   72  vim /etc/sysctl.conf\n   73  sysctl -p\n   74  reboot\n   75  ls\n   76  wget https://github.com/snooda/net-speeder/archive/master.zip\n   77  unzip master.zip\n   78  ls\n   79  rm -rf master.zip virt-what-1.12*\n   80  ls\n   81  wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\n   82  rpm -ivh epel-release-6-8.noarch.rpm\n   83  yum install libnet libpcap libnet-devel libpcap-devel\n   84  sh build.sh -DCOOKED\n   85  ls\n   86  cd net-speeder-master/\n   87  ls\n   88  sh build.sh -DCOOKED\n   89  ifconfig\n   90  ./net_speeder venet0 \"ip\"\n   91  service netspeederd start\n   92  wget –no-check-certificate https://raw.githubusercontent.com/tennfy/debian_netspeeder_tennfy/master/debian_netspeeder_tennfy.sh\n   93  chmod a+x debian_netspeeder_tennfy.sh\n   94  wget http://linux.linzhihao.cn/shell/netspeeder.sh\n   95  bash netspeeder.sh\n   96  service netspeederd start\n   97  service netspeederd status\n   98  reboot\n  ```\n\n\n## 本地访问VPS脚本\n  我比较懒，密码都是随机的也不想改，所以做了一个脚本用来直接ssh登陆。\n  后来我发现我需要下载一些文件，于是乎我增加了两个参数。。\n  安装系统的时候修改一下，将`password`修改为随机生成的密码，这样也不用记录，直接复制粘贴。。\n  同时将`12345`替换为端口号。\n  将`1.2.3.4`替换为服务器IP，这个只需要写一次就好，基本上也不会改。。\n  这样搞完之后在`~/.profile`中增加`alias vps=\"/Users/Madordie/shell/Mac_shell/ss.sh\"`，然后执行`source ~/.profile`即可。\n  \n  这样就可以使用下面的简写：\n    - SSH登陆`vps`\n    - 下载文件`vps /server_path /local_path`，自行修改后面俩参数\n  \n  ```\n  $ cat ~/shell/Mac_shell/ss.sh \n  \n  #!/bin/bash\n\n  echo 'password'\n  port=12345\n  ip=1.2.3.4\n  usr=root\n\n  if [ $# -eq 0 ]; then\n      ssh $usr@$ip -p $port\n  elif [ $# -eq 2 ]; then \n      scp -P $port $usr@$ip:$1 $2\n  else\n      echo \"($*)你要干嘛。。\"\n  fi\n\n  ```\n  \n__2017-2-7更新__: [一个SSH登录服务器的shell脚本](https://github.com/jiangxianli/SSHAutoLogin)\n\n# 尝试的时候各种用的环境搭建\n  很显然上面的已经足够了，这个只是留个笔记，用来快速搭建某个环境啥的。。\n\n## CentOS\n\n### git\n  1. 直接安装\n    ```\n    yum install git\n    ```\n\n### go\n\n  1. 下载二进制文件：\n    ```\n    wget https://storage.googleapis.com/golang/go1.7.3.linux-amd64.tar.gz\n    ```\n  2. 解压并创建工作目录：\n    ```\n    tar -zxf go1.7.3.linux-amd64.tar.gz -C /usr/local/\n    ```\n  3. 设置环境变量：\n    在 /etc/profile 添加：\n    ```\n    export GOROOT=/usr/local/go \n    export GOBIN=$GOROOT/bin\n    export GOPKG=$GOROOT/pkg/tool/linux_amd64 \n    export GOARCH=amd64\n    export GOOS=linux\n    export GOPATH=/Golang\n    export PATH=$PATH:$GOBIN:$GOPKG:$GOPATH/bin\n    ```\n    4. 使之生效或者重新登录Linux也可\n    ```\n    source /etc/profile\n    ```\n  \n## scp\n  \n  `scp -P 8888 root@127.0.0.10:/root/my_key/ca.cert.pem .`\n\n\n## Ubuntu\n\n### 更新\n  ```\n    sudo apt-get update\n  ```\n\n### git\n  ```\n  sudo apt-get install git  \n  ```\n### go\n  ```\n  sudo apt-get install golang\n  ```","slug":"bandwagonhost-note","published":1,"updated":"2017-02-07T06:08:49.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f9h000bl0uvxfbl9ryi","content":"<p>原来吧，用用goagent、Lantern、XX-Net，确实，这玩意只能Google出来结果，但是有的站点打不开才是最骚的。。<br>同事搞了个搬瓦工挺便宜，于是乎就也搞了一个。不过强迫症犯了，尝试了各种SS版本以及各种优化，目的是找个流畅点的版本进行<strong>科学上网</strong>。</p>\n<a id=\"more\"></a>\n<h1 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h1><ul>\n<li>红线越不得！红线越不得！红线越不得！重要的事情说3遍。</li>\n<li>参看第一条</li>\n<li>参看第一条</li>\n<li>参看第一条</li>\n</ul>\n<h1 id=\"目前安装的-rss\"><a href=\"#目前安装的-rss\" class=\"headerlink\" title=\"目前安装的 rss\"></a>目前安装的 rss</h1><p>  尝试了各种版本的系统，各种ss分支，最后用了rss，然后又花了一下，觉得速度可以了，延迟的问题无解。ping过去就是那么慢。。<br>  注意：为了重启不配置，要把里面没有自启动的添加到启动项。具体方法 Google一下。我加在了 <code>/etc/rc.local</code></p>\n<h2 id=\"shadowsocks-rss\"><a href=\"#shadowsocks-rss\" class=\"headerlink\" title=\"shadowsocks-rss\"></a>shadowsocks-rss</h2><ul>\n<li><a href=\"https://github.com/breakwa11/shadowsocks-rss/wiki\" target=\"_blank\" rel=\"external\">wiki</a></li>\n<li><a href=\"https://github.com/breakwa11/shadowsocks-rss/wiki/Server-Setup\" target=\"_blank\" rel=\"external\">ShadowsocksR 服务端安装教程</a></li>\n<li><a href=\"https://github.com/shadowsocksr/ShadowsocksX-NG/releases\" target=\"_blank\" rel=\"external\">macOS</a></li>\n<li><p><a href=\"https://itunes.apple.com/cn/app/id1178584911\" target=\"_blank\" rel=\"external\">iOS</a></p>\n<p>[2017.1.18更新]：<br>新版rss版本可能自动启动连接成功无法上网。服务器日志会出现<code>tcprelay.py:935 can not parse header when handling connection from</code>的错误，这个是由于在启动的时候默认才用了混淆。在配置的时候需要注意一下。也可直接在<code>user-config.json</code>中修改或者删除。<a href=\"https://github.com/breakwa11/shadowsocks-rss/wiki/config.json\" target=\"_blank\" rel=\"external\">配置说明</a></p>\n</li>\n</ul>\n<h2 id=\"优化\"><a href=\"#优化\" class=\"headerlink\" title=\"优化\"></a>优化</h2><ul>\n<li><a href=\"http://shadowsocks.org/en/config/advanced.html\" target=\"_blank\" rel=\"external\">官方优化方案</a></li>\n<li><a href=\"https://www.dou-bi.co/netspeeder-jc1/\" target=\"_blank\" rel=\"external\">Net Speeder</a> <code>wget http://linux.linzhihao.cn/shell/netspeeder.sh &amp; bash netspeeder.sh</code></li>\n</ul>\n<h2 id=\"history\"><a href=\"#history\" class=\"headerlink\" title=\"history\"></a>history</h2><p>  chacha20的插件忘记了按照哪种方式安装的了。将我安装的历史命令放出来：</p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div></pre></td><td class=\"code\"><pre><div class=\"line\"> 1  yum install git</div><div class=\"line\"> 2  git clone -b manyuser https://github.com/breakwa11/shadowsocks.git</div><div class=\"line\"> 3  cd ~/shadowsocks</div><div class=\"line\"> 4  bash initcfg.sh</div><div class=\"line\"> 5  cd ~/shadowsocks/shadowsocks</div><div class=\"line\"> 6  python server.py -p 443 -k password -m chacha20</div><div class=\"line\"> 7  python server.py -p 443 -k password -m aes-256-cfb </div><div class=\"line\"> 8  python server.py -p 443 -k password -m rc4-md5</div><div class=\"line\"> 9  yum install epel-release</div><div class=\"line\">10  yum install libsodium</div><div class=\"line\">11  python server.py -p 443 -k password -m chacha20</div><div class=\"line\">12  yum install libsodium</div><div class=\"line\">13  python server.py -p 443 -k password -m chacha20</div><div class=\"line\">14  yum install libsodium</div><div class=\"line\">15  yum install libsodium update</div><div class=\"line\">16  yum update</div><div class=\"line\">17  yum install libsodium</div><div class=\"line\">18  yum -y groupinstall &quot;Development Tools&quot;</div><div class=\"line\">19  wget https://github.com/jedisct1/libsodium/releases/download/1.0.10/libsodium-1.0.10.tar.gz</div><div class=\"line\">20  tar xf libsodium-1.0.10.tar.gz &amp;&amp; cd libsodium-1.0.10</div><div class=\"line\">21  ./configure &amp;&amp; make -j2 &amp;&amp; make install</div><div class=\"line\">22  echo /usr/local/lib &gt; /etc/ld.so.conf.d/usr_local_lib.conf</div><div class=\"line\">23  ldconfig</div><div class=\"line\">24  yum install libsodium</div><div class=\"line\">25  cd ../</div><div class=\"line\">26  ls</div><div class=\"line\">27  python server.py -p 443 -k password -m chacha20</div><div class=\"line\">28  echo &quot;python server.py -p 443 -k password -m chacha20 -d start&quot;</div><div class=\"line\">29  echo &quot;python server.py -p 443 -k password -m chacha20 -d start&quot; &gt;&gt; /etc/rc.local </div><div class=\"line\">30  reboot</div><div class=\"line\">31  cd //</div><div class=\"line\">32  cd ~/</div><div class=\"line\">33  cd shadowsocks/</div><div class=\"line\">34  ls</div><div class=\"line\">35  cd shadowsocks/</div><div class=\"line\">36  ls</div><div class=\"line\">37  cd ../</div><div class=\"line\">38  ls</div><div class=\"line\">39  pwd</div><div class=\"line\">40  vim /etc/rc.local </div><div class=\"line\">41  reboot</div><div class=\"line\">42  cd shadowsocks/</div><div class=\"line\">43  python server.py -p 443 -k password -m chacha20 -d start</div><div class=\"line\">44  python ~/shadowsocks/shadowsocks/server.py -p 443 -k password -m chacha20 -d start</div><div class=\"line\">45  vim /etc/rc.local </div><div class=\"line\">46  reboot</div><div class=\"line\">47  rm -f /sbin/modprobe</div><div class=\"line\">48  ln -s /bin/true /sbin/modprobe</div><div class=\"line\">49  rm -f /sbin/sysctl</div><div class=\"line\">50  ln -s /bin/true /sbin/sysctl</div><div class=\"line\">51  vi /etc/sysctl.conf</div><div class=\"line\">52  sysctl -p</div><div class=\"line\">53  reboot</div><div class=\"line\">54  wget http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el5.rf.i386.rpm</div><div class=\"line\">55  vim /etc/rc.local </div><div class=\"line\">56  reboot</div><div class=\"line\">57  python server.py status</div><div class=\"line\">58  cd shadowsocks/shadowsocks/</div><div class=\"line\">59  python server.py status</div><div class=\"line\">60  exit</div><div class=\"line\">61  vim /etc/rc.local </div><div class=\"line\">62  reboot</div><div class=\"line\">63  ls</div><div class=\"line\">64  rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-firmware-2.6.32-504.3.3.el6.noarch.rpm</div><div class=\"line\">65  rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-2.6.32-504.3.3.el6.x86_64.rpm --force</div><div class=\"line\">66  rpm -qa | grep kernel</div><div class=\"line\">67  wget -N --no-check-certificate https://raw.githubusercontent.com/91yun/code/master/vm_check.sh &amp;&amp; bash vm_check.sh</div><div class=\"line\">68  ls</div><div class=\"line\">69  reboot</div><div class=\"line\">70  vi /etc/security/limits.conf</div><div class=\"line\">71  vim /etc/rc.local </div><div class=\"line\">72  vim /etc/sysctl.conf</div><div class=\"line\">73  sysctl -p</div><div class=\"line\">74  reboot</div><div class=\"line\">75  ls</div><div class=\"line\">76  wget https://github.com/snooda/net-speeder/archive/master.zip</div><div class=\"line\">77  unzip master.zip</div><div class=\"line\">78  ls</div><div class=\"line\">79  rm -rf master.zip virt-what-1.12*</div><div class=\"line\">80  ls</div><div class=\"line\">81  wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</div><div class=\"line\">82  rpm -ivh epel-release-6-8.noarch.rpm</div><div class=\"line\">83  yum install libnet libpcap libnet-devel libpcap-devel</div><div class=\"line\">84  sh build.sh -DCOOKED</div><div class=\"line\">85  ls</div><div class=\"line\">86  cd net-speeder-master/</div><div class=\"line\">87  ls</div><div class=\"line\">88  sh build.sh -DCOOKED</div><div class=\"line\">89  ifconfig</div><div class=\"line\">90  ./net_speeder venet0 &quot;ip&quot;</div><div class=\"line\">91  service netspeederd start</div><div class=\"line\">92  wget –no-check-certificate https://raw.githubusercontent.com/tennfy/debian_netspeeder_tennfy/master/debian_netspeeder_tennfy.sh</div><div class=\"line\">93  chmod a+x debian_netspeeder_tennfy.sh</div><div class=\"line\">94  wget http://linux.linzhihao.cn/shell/netspeeder.sh</div><div class=\"line\">95  bash netspeeder.sh</div><div class=\"line\">96  service netspeederd start</div><div class=\"line\">97  service netspeederd status</div><div class=\"line\">98  reboot</div></pre></td></tr></table></figure>\n<h2 id=\"本地访问VPS脚本\"><a href=\"#本地访问VPS脚本\" class=\"headerlink\" title=\"本地访问VPS脚本\"></a>本地访问VPS脚本</h2><p>  我比较懒，密码都是随机的也不想改，所以做了一个脚本用来直接ssh登陆。<br>  后来我发现我需要下载一些文件，于是乎我增加了两个参数。。<br>  安装系统的时候修改一下，将<code>password</code>修改为随机生成的密码，这样也不用记录，直接复制粘贴。。<br>  同时将<code>12345</code>替换为端口号。<br>  将<code>1.2.3.4</code>替换为服务器IP，这个只需要写一次就好，基本上也不会改。。<br>  这样搞完之后在<code>~/.profile</code>中增加<code>alias vps=&quot;/Users/Madordie/shell/Mac_shell/ss.sh&quot;</code>，然后执行<code>source ~/.profile</code>即可。</p>\n<p>  这样就可以使用下面的简写：</p>\n<pre><code>- SSH登陆`vps`\n- 下载文件`vps /server_path /local_path`，自行修改后面俩参数\n</code></pre>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ cat ~/shell/Mac_shell/ss.sh </div><div class=\"line\"></div><div class=\"line\">#!/bin/bash</div><div class=\"line\"></div><div class=\"line\">echo &apos;password&apos;</div><div class=\"line\">port=12345</div><div class=\"line\">ip=1.2.3.4</div><div class=\"line\">usr=root</div><div class=\"line\"></div><div class=\"line\">if [ $# -eq 0 ]; then</div><div class=\"line\">    ssh $usr@$ip -p $port</div><div class=\"line\">elif [ $# -eq 2 ]; then </div><div class=\"line\">    scp -P $port $usr@$ip:$1 $2</div><div class=\"line\">else</div><div class=\"line\">    echo &quot;($*)你要干嘛。。&quot;</div><div class=\"line\">fi</div></pre></td></tr></table></figure>\n<p><strong>2017-2-7更新</strong>: <a href=\"https://github.com/jiangxianli/SSHAutoLogin\" target=\"_blank\" rel=\"external\">一个SSH登录服务器的shell脚本</a></p>\n<h1 id=\"尝试的时候各种用的环境搭建\"><a href=\"#尝试的时候各种用的环境搭建\" class=\"headerlink\" title=\"尝试的时候各种用的环境搭建\"></a>尝试的时候各种用的环境搭建</h1><p>  很显然上面的已经足够了，这个只是留个笔记，用来快速搭建某个环境啥的。。</p>\n<h2 id=\"CentOS\"><a href=\"#CentOS\" class=\"headerlink\" title=\"CentOS\"></a>CentOS</h2><h3 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h3><ol>\n<li>直接安装<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum install git</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"go\"><a href=\"#go\" class=\"headerlink\" title=\"go\"></a>go</h3><ol>\n<li><p>下载二进制文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">wget https://storage.googleapis.com/golang/go1.7.3.linux-amd64.tar.gz</div></pre></td></tr></table></figure>\n</li>\n<li><p>解压并创建工作目录：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">tar -zxf go1.7.3.linux-amd64.tar.gz -C /usr/local/</div></pre></td></tr></table></figure>\n</li>\n<li><p>设置环境变量：<br>在 /etc/profile 添加：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">export GOROOT=/usr/local/go </div><div class=\"line\">export GOBIN=$GOROOT/bin</div><div class=\"line\">export GOPKG=$GOROOT/pkg/tool/linux_amd64 </div><div class=\"line\">export GOARCH=amd64</div><div class=\"line\">export GOOS=linux</div><div class=\"line\">export GOPATH=/Golang</div><div class=\"line\">export PATH=$PATH:$GOBIN:$GOPKG:$GOPATH/bin</div></pre></td></tr></table></figure>\n<ol>\n<li>使之生效或者重新登录Linux也可<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">source /etc/profile</div></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"scp\"><a href=\"#scp\" class=\"headerlink\" title=\"scp\"></a>scp</h2><p>  <code>scp -P 8888 root@127.0.0.10:/root/my_key/ca.cert.pem .</code></p>\n<h2 id=\"Ubuntu\"><a href=\"#Ubuntu\" class=\"headerlink\" title=\"Ubuntu\"></a>Ubuntu</h2><h3 id=\"更新\"><a href=\"#更新\" class=\"headerlink\" title=\"更新\"></a>更新</h3>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo apt-get update</div></pre></td></tr></table></figure>\n<h3 id=\"git-1\"><a href=\"#git-1\" class=\"headerlink\" title=\"git\"></a>git</h3>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo apt-get install git</div></pre></td></tr></table></figure>\n<h3 id=\"go-1\"><a href=\"#go-1\" class=\"headerlink\" title=\"go\"></a>go</h3>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo apt-get install golang</div></pre></td></tr></table></figure>","excerpt":"<p>原来吧，用用goagent、Lantern、XX-Net，确实，这玩意只能Google出来结果，但是有的站点打不开才是最骚的。。<br>同事搞了个搬瓦工挺便宜，于是乎就也搞了一个。不过强迫症犯了，尝试了各种SS版本以及各种优化，目的是找个流畅点的版本进行<strong>科学上网</strong>。</p>","more":"<h1 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h1><ul>\n<li>红线越不得！红线越不得！红线越不得！重要的事情说3遍。</li>\n<li>参看第一条</li>\n<li>参看第一条</li>\n<li>参看第一条</li>\n</ul>\n<h1 id=\"目前安装的-rss\"><a href=\"#目前安装的-rss\" class=\"headerlink\" title=\"目前安装的 rss\"></a>目前安装的 rss</h1><p>  尝试了各种版本的系统，各种ss分支，最后用了rss，然后又花了一下，觉得速度可以了，延迟的问题无解。ping过去就是那么慢。。<br>  注意：为了重启不配置，要把里面没有自启动的添加到启动项。具体方法 Google一下。我加在了 <code>/etc/rc.local</code></p>\n<h2 id=\"shadowsocks-rss\"><a href=\"#shadowsocks-rss\" class=\"headerlink\" title=\"shadowsocks-rss\"></a>shadowsocks-rss</h2><ul>\n<li><a href=\"https://github.com/breakwa11/shadowsocks-rss/wiki\">wiki</a></li>\n<li><a href=\"https://github.com/breakwa11/shadowsocks-rss/wiki/Server-Setup\">ShadowsocksR 服务端安装教程</a></li>\n<li><a href=\"https://github.com/shadowsocksr/ShadowsocksX-NG/releases\">macOS</a></li>\n<li><p><a href=\"https://itunes.apple.com/cn/app/id1178584911\">iOS</a></p>\n<p>[2017.1.18更新]：<br>新版rss版本可能自动启动连接成功无法上网。服务器日志会出现<code>tcprelay.py:935 can not parse header when handling connection from</code>的错误，这个是由于在启动的时候默认才用了混淆。在配置的时候需要注意一下。也可直接在<code>user-config.json</code>中修改或者删除。<a href=\"https://github.com/breakwa11/shadowsocks-rss/wiki/config.json\">配置说明</a></p>\n</li>\n</ul>\n<h2 id=\"优化\"><a href=\"#优化\" class=\"headerlink\" title=\"优化\"></a>优化</h2><ul>\n<li><a href=\"http://shadowsocks.org/en/config/advanced.html\">官方优化方案</a></li>\n<li><a href=\"https://www.dou-bi.co/netspeeder-jc1/\">Net Speeder</a> <code>wget http://linux.linzhihao.cn/shell/netspeeder.sh &amp; bash netspeeder.sh</code></li>\n</ul>\n<h2 id=\"history\"><a href=\"#history\" class=\"headerlink\" title=\"history\"></a>history</h2><p>  chacha20的插件忘记了按照哪种方式安装的了。将我安装的历史命令放出来：</p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div></pre></td><td class=\"code\"><pre><div class=\"line\"> 1  yum install git</div><div class=\"line\"> 2  git clone -b manyuser https://github.com/breakwa11/shadowsocks.git</div><div class=\"line\"> 3  cd ~/shadowsocks</div><div class=\"line\"> 4  bash initcfg.sh</div><div class=\"line\"> 5  cd ~/shadowsocks/shadowsocks</div><div class=\"line\"> 6  python server.py -p 443 -k password -m chacha20</div><div class=\"line\"> 7  python server.py -p 443 -k password -m aes-256-cfb </div><div class=\"line\"> 8  python server.py -p 443 -k password -m rc4-md5</div><div class=\"line\"> 9  yum install epel-release</div><div class=\"line\">10  yum install libsodium</div><div class=\"line\">11  python server.py -p 443 -k password -m chacha20</div><div class=\"line\">12  yum install libsodium</div><div class=\"line\">13  python server.py -p 443 -k password -m chacha20</div><div class=\"line\">14  yum install libsodium</div><div class=\"line\">15  yum install libsodium update</div><div class=\"line\">16  yum update</div><div class=\"line\">17  yum install libsodium</div><div class=\"line\">18  yum -y groupinstall &quot;Development Tools&quot;</div><div class=\"line\">19  wget https://github.com/jedisct1/libsodium/releases/download/1.0.10/libsodium-1.0.10.tar.gz</div><div class=\"line\">20  tar xf libsodium-1.0.10.tar.gz &amp;&amp; cd libsodium-1.0.10</div><div class=\"line\">21  ./configure &amp;&amp; make -j2 &amp;&amp; make install</div><div class=\"line\">22  echo /usr/local/lib &gt; /etc/ld.so.conf.d/usr_local_lib.conf</div><div class=\"line\">23  ldconfig</div><div class=\"line\">24  yum install libsodium</div><div class=\"line\">25  cd ../</div><div class=\"line\">26  ls</div><div class=\"line\">27  python server.py -p 443 -k password -m chacha20</div><div class=\"line\">28  echo &quot;python server.py -p 443 -k password -m chacha20 -d start&quot;</div><div class=\"line\">29  echo &quot;python server.py -p 443 -k password -m chacha20 -d start&quot; &gt;&gt; /etc/rc.local </div><div class=\"line\">30  reboot</div><div class=\"line\">31  cd //</div><div class=\"line\">32  cd ~/</div><div class=\"line\">33  cd shadowsocks/</div><div class=\"line\">34  ls</div><div class=\"line\">35  cd shadowsocks/</div><div class=\"line\">36  ls</div><div class=\"line\">37  cd ../</div><div class=\"line\">38  ls</div><div class=\"line\">39  pwd</div><div class=\"line\">40  vim /etc/rc.local </div><div class=\"line\">41  reboot</div><div class=\"line\">42  cd shadowsocks/</div><div class=\"line\">43  python server.py -p 443 -k password -m chacha20 -d start</div><div class=\"line\">44  python ~/shadowsocks/shadowsocks/server.py -p 443 -k password -m chacha20 -d start</div><div class=\"line\">45  vim /etc/rc.local </div><div class=\"line\">46  reboot</div><div class=\"line\">47  rm -f /sbin/modprobe</div><div class=\"line\">48  ln -s /bin/true /sbin/modprobe</div><div class=\"line\">49  rm -f /sbin/sysctl</div><div class=\"line\">50  ln -s /bin/true /sbin/sysctl</div><div class=\"line\">51  vi /etc/sysctl.conf</div><div class=\"line\">52  sysctl -p</div><div class=\"line\">53  reboot</div><div class=\"line\">54  wget http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el5.rf.i386.rpm</div><div class=\"line\">55  vim /etc/rc.local </div><div class=\"line\">56  reboot</div><div class=\"line\">57  python server.py status</div><div class=\"line\">58  cd shadowsocks/shadowsocks/</div><div class=\"line\">59  python server.py status</div><div class=\"line\">60  exit</div><div class=\"line\">61  vim /etc/rc.local </div><div class=\"line\">62  reboot</div><div class=\"line\">63  ls</div><div class=\"line\">64  rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-firmware-2.6.32-504.3.3.el6.noarch.rpm</div><div class=\"line\">65  rpm -ivh http://soft.91yun.org/ISO/Linux/CentOS/kernel/kernel-2.6.32-504.3.3.el6.x86_64.rpm --force</div><div class=\"line\">66  rpm -qa | grep kernel</div><div class=\"line\">67  wget -N --no-check-certificate https://raw.githubusercontent.com/91yun/code/master/vm_check.sh &amp;&amp; bash vm_check.sh</div><div class=\"line\">68  ls</div><div class=\"line\">69  reboot</div><div class=\"line\">70  vi /etc/security/limits.conf</div><div class=\"line\">71  vim /etc/rc.local </div><div class=\"line\">72  vim /etc/sysctl.conf</div><div class=\"line\">73  sysctl -p</div><div class=\"line\">74  reboot</div><div class=\"line\">75  ls</div><div class=\"line\">76  wget https://github.com/snooda/net-speeder/archive/master.zip</div><div class=\"line\">77  unzip master.zip</div><div class=\"line\">78  ls</div><div class=\"line\">79  rm -rf master.zip virt-what-1.12*</div><div class=\"line\">80  ls</div><div class=\"line\">81  wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</div><div class=\"line\">82  rpm -ivh epel-release-6-8.noarch.rpm</div><div class=\"line\">83  yum install libnet libpcap libnet-devel libpcap-devel</div><div class=\"line\">84  sh build.sh -DCOOKED</div><div class=\"line\">85  ls</div><div class=\"line\">86  cd net-speeder-master/</div><div class=\"line\">87  ls</div><div class=\"line\">88  sh build.sh -DCOOKED</div><div class=\"line\">89  ifconfig</div><div class=\"line\">90  ./net_speeder venet0 &quot;ip&quot;</div><div class=\"line\">91  service netspeederd start</div><div class=\"line\">92  wget –no-check-certificate https://raw.githubusercontent.com/tennfy/debian_netspeeder_tennfy/master/debian_netspeeder_tennfy.sh</div><div class=\"line\">93  chmod a+x debian_netspeeder_tennfy.sh</div><div class=\"line\">94  wget http://linux.linzhihao.cn/shell/netspeeder.sh</div><div class=\"line\">95  bash netspeeder.sh</div><div class=\"line\">96  service netspeederd start</div><div class=\"line\">97  service netspeederd status</div><div class=\"line\">98  reboot</div></pre></td></tr></table></figure>\n<h2 id=\"本地访问VPS脚本\"><a href=\"#本地访问VPS脚本\" class=\"headerlink\" title=\"本地访问VPS脚本\"></a>本地访问VPS脚本</h2><p>  我比较懒，密码都是随机的也不想改，所以做了一个脚本用来直接ssh登陆。<br>  后来我发现我需要下载一些文件，于是乎我增加了两个参数。。<br>  安装系统的时候修改一下，将<code>password</code>修改为随机生成的密码，这样也不用记录，直接复制粘贴。。<br>  同时将<code>12345</code>替换为端口号。<br>  将<code>1.2.3.4</code>替换为服务器IP，这个只需要写一次就好，基本上也不会改。。<br>  这样搞完之后在<code>~/.profile</code>中增加<code>alias vps=&quot;/Users/Madordie/shell/Mac_shell/ss.sh&quot;</code>，然后执行<code>source ~/.profile</code>即可。</p>\n<p>  这样就可以使用下面的简写：</p>\n<pre><code>- SSH登陆`vps`\n- 下载文件`vps /server_path /local_path`，自行修改后面俩参数\n</code></pre>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ cat ~/shell/Mac_shell/ss.sh </div><div class=\"line\"></div><div class=\"line\">#!/bin/bash</div><div class=\"line\"></div><div class=\"line\">echo &apos;password&apos;</div><div class=\"line\">port=12345</div><div class=\"line\">ip=1.2.3.4</div><div class=\"line\">usr=root</div><div class=\"line\"></div><div class=\"line\">if [ $# -eq 0 ]; then</div><div class=\"line\">    ssh $usr@$ip -p $port</div><div class=\"line\">elif [ $# -eq 2 ]; then </div><div class=\"line\">    scp -P $port $usr@$ip:$1 $2</div><div class=\"line\">else</div><div class=\"line\">    echo &quot;($*)你要干嘛。。&quot;</div><div class=\"line\">fi</div></pre></td></tr></table></figure>\n<p><strong>2017-2-7更新</strong>: <a href=\"https://github.com/jiangxianli/SSHAutoLogin\">一个SSH登录服务器的shell脚本</a></p>\n<h1 id=\"尝试的时候各种用的环境搭建\"><a href=\"#尝试的时候各种用的环境搭建\" class=\"headerlink\" title=\"尝试的时候各种用的环境搭建\"></a>尝试的时候各种用的环境搭建</h1><p>  很显然上面的已经足够了，这个只是留个笔记，用来快速搭建某个环境啥的。。</p>\n<h2 id=\"CentOS\"><a href=\"#CentOS\" class=\"headerlink\" title=\"CentOS\"></a>CentOS</h2><h3 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h3><ol>\n<li>直接安装<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yum install git</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"go\"><a href=\"#go\" class=\"headerlink\" title=\"go\"></a>go</h3><ol>\n<li><p>下载二进制文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">wget https://storage.googleapis.com/golang/go1.7.3.linux-amd64.tar.gz</div></pre></td></tr></table></figure>\n</li>\n<li><p>解压并创建工作目录：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">tar -zxf go1.7.3.linux-amd64.tar.gz -C /usr/local/</div></pre></td></tr></table></figure>\n</li>\n<li><p>设置环境变量：<br>在 /etc/profile 添加：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">export GOROOT=/usr/local/go </div><div class=\"line\">export GOBIN=$GOROOT/bin</div><div class=\"line\">export GOPKG=$GOROOT/pkg/tool/linux_amd64 </div><div class=\"line\">export GOARCH=amd64</div><div class=\"line\">export GOOS=linux</div><div class=\"line\">export GOPATH=/Golang</div><div class=\"line\">export PATH=$PATH:$GOBIN:$GOPKG:$GOPATH/bin</div></pre></td></tr></table></figure>\n<ol>\n<li>使之生效或者重新登录Linux也可<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">source /etc/profile</div></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"scp\"><a href=\"#scp\" class=\"headerlink\" title=\"scp\"></a>scp</h2><p>  <code>scp -P 8888 root@127.0.0.10:/root/my_key/ca.cert.pem .</code></p>\n<h2 id=\"Ubuntu\"><a href=\"#Ubuntu\" class=\"headerlink\" title=\"Ubuntu\"></a>Ubuntu</h2><h3 id=\"更新\"><a href=\"#更新\" class=\"headerlink\" title=\"更新\"></a>更新</h3>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo apt-get update</div></pre></td></tr></table></figure>\n<h3 id=\"git-1\"><a href=\"#git-1\" class=\"headerlink\" title=\"git\"></a>git</h3>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo apt-get install git</div></pre></td></tr></table></figure>\n<h3 id=\"go-1\"><a href=\"#go-1\" class=\"headerlink\" title=\"go\"></a>go</h3>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo apt-get install golang</div></pre></td></tr></table></figure>"},{"title":"正则表达式学习笔记","date":"2016-12-19T07:03:09.000Z","_content":"\n正则表达式基础学习笔记。\n\n<!--more-->\n\n# 前面\n  上次找了个很好的文章，可是手残没保存。。找不到了😭，现在重新找了一个文章：[正则表达式30分钟入门教程](https://luke0922.gitbooks.io/learnregularexpressionin30minutes/content/index.html)\n  正如作者说的：\n  > # 声明\n  > 本文非原创，是改编自[《正则表达式30分钟入门教程》](http://deerchao.net/tutorials/regex/regex.htm#mission)，因为原作者的排版个人不是很喜欢，而且内容上个人觉得有些地方需要改进，所以在 gitbook 上开了一本书。\n  \n  OSC的[在线正则表达式测试](http://tool.oschina.net/regex)\n  \n# 开搞\n\n## 元字符\n  - `\\` : 转义\n  - `\\b` : 单词开始或结束\n  - `^` : 字符串开始\n  - `$` : 字符串结束\n  - `\\d` : 一个数字\n  - `\\s` : 任意空白字符：空格、制表符、换行符、中文全角空格、等\n  - `\\w` : 字母/数字/下划线/汉字 可见字符\n  - `.` : 除换行符以外的任意字符\n\n## 重复\n  - `{n}` : 前置位重复匹配 [n] 次\n  - `{n,m}` : 前置位重复匹配 [n-m] 次\n  - `{n,}` : 前置位重复匹配 [n-∞] 次\n  - `*` : 数量区间：[0-N]\n  - `+` : 数量区间：[1-N]\n  - `?` : 数量区间：[0-1]\n  \n## 字符类\n  - `[nml]` : 可以匹配到 n/m/l\n  \n## 条件\n  - `|` : __或__语句。存在逻辑短路\n  - `(m)` : __分组__语句。子式，可以指定重复什么的\n  \n## 反义\n  - `\\W` : 任意__不是__（字符、数字、下划线、汉字）\n  - `\\S` : 任意__不是__ 空白符\n  - `\\D` : 任意__不是__ 数字\n  - `\\B` : 任意__不是__ 单词开头或结尾\n  - `\\^x` : 除x以外的任意字符\n  - `[\\^abc]` : 除abc这几个字母以外的任意字符\n  \n## 后向引用\n  `(\\w+)`这样用`()`的部分称为一个分组，其匹配到的内容可以使用`\\n`来表示，`n`代表该分组为第n个分组。分组下标从`1`开始。\n  也可以自定义子表达式组名: `(?<Word>M) \\k<Word>` : 或 `(?'Word'M) \\k'Word'`，其中M为子式。\n  \n## 常用分组语法\n\n### 捕获\n  - `(exp)` : 匹配exp,并捕获文本到自动命名的组里\n  - `(?exp)` : 匹配exp,并捕获文本到名称为name的组里，也可以写成(?'name'exp)\n  - `(?:exp)` : 匹配exp,不捕获匹配的文本，也不给此分组分配组号\n\n### 零宽断言\n  - `(?=exp)` : 匹配exp前面的位置\n  - `(?<=exp)` : 匹配exp后面的位置\n  - `(?!exp)` : 匹配后面跟的不是exp的位置\n  - `(?<!exp)` : 匹配前面不是exp的位置\n\n### 注释\n  - `(?#comment)` : 这种类型的分组不对正则表达式的处理产生任何影响，用于提供注释让人阅读\n  \n## 贪婪与懒惰\n  贪婪：匹配的尽可能长\n  懒惰：匹配的尽可能短\n  \n  - `*?` : 重复任意次，但尽可能少重复\n  - `+?` : 重复1次或更多次，但尽可能少重复\n  - `??` : 重复0次或1次，但尽可能少重复\n  - `{n,m}?` : 重复n到m次，但尽可能少重复\n  - `{n,}?` : 重复n次以上，但尽可能少重复\n  \n## 平衡组/递归匹配\n  \\# 我开始看不懂了😂\n  \n## 其他\n  - `\\a` : 报警字符(打印它的效果是电脑嘀一声)\n  - `\\b` : 通常是单词分界位置，但如果在字符类里使用代表退格\n  - `\\t` : 制表符，Tab\n  - `\\r` : 回车\n  - `\\v` : 竖向制表符\n  - `\\f` : 换页符\n  - `\\n` : 换行符\n  - `\\e` : Escape\n  - `\\0nn` : ASCII代码中八进制代码为nn的字符\n  - `\\xnn` : ASCII代码中十六进制代码为nn的字符\n  - `\\unnnn` : Unicode代码中十六进制代码为nnnn的字符\n  - `\\cN` : ASCII控制字符。比如\\cC代表Ctrl+C\n  - `\\A` : 字符串开头(类似^，但不受处理多行选项的影响)\n  - `\\Z` : 字符串结尾或行尾(不受处理多行选项的影响)\n  - `\\z` : 字符串结尾(类似$，但不受处理多行选项的影响)\n  - `\\G` : 当前搜索的开头\n  - `\\p{name}` : Unicode中命名为name的字符类，例如\\p{IsGreek}\n  - `(?>exp)` : 贪婪子表达式\n  - `(?<x>-<y>exp)` : 平衡组\n  - `(?im-nsx:exp)` : 在子表达式exp中改变处理选项\n  - `(?im-nsx)` : 为表达式后面的部分改变处理选项\n  - `(?(exp)yes|no)` : 把exp当作零宽正向先行断言，如果在这个位置能匹配，使用yes作为此组的表达式；否则使用no\n  - `(?(exp)yes)` : 同上，只是使用空表达式作为no\n  - `(?(name)yes|no)` : 如果命名为name的组捕获到了内容，使用yes作为表达式；否则使用no\n  - `(?(name)yes)` : 同上，只是使用空表达式作为no\n  \n  \n## 栗子\n  - 5-12位QQ：`^\\d{5,12}$`\n  - IPv4地址：`((2[0-4]\\d|25[0-5]|[01]?\\d\\d?)\\.){3}(2[0-4]\\d|25[0-5]|[01]?\\d\\d?)`\n  - `go go`、`kitty kitty`这样的叠词：`\\b(\\w+)\\b\\s+\\1\\b`\n  - 后向引用：`\\b(\\w+)\\b\\s+\\1\\b` == `\\b(?<Word>\\w+)\\b\\s+\\k<Word>\\b` == `\\b(?'Word'\\w+)\\b\\s+\\k'Word'\\b`\n  \n# 最后\n  知识研究了一下语法，还未详细测试。思考：这玩意真心厉害😂。","source":"_posts/bruch-up-regular-expressions.md","raw":"---\ntitle: 正则表达式学习笔记\ndate: 2016-12-19 15:03:09\ntags:\ncategories:\n    - 正则表达式\n---\n\n正则表达式基础学习笔记。\n\n<!--more-->\n\n# 前面\n  上次找了个很好的文章，可是手残没保存。。找不到了😭，现在重新找了一个文章：[正则表达式30分钟入门教程](https://luke0922.gitbooks.io/learnregularexpressionin30minutes/content/index.html)\n  正如作者说的：\n  > # 声明\n  > 本文非原创，是改编自[《正则表达式30分钟入门教程》](http://deerchao.net/tutorials/regex/regex.htm#mission)，因为原作者的排版个人不是很喜欢，而且内容上个人觉得有些地方需要改进，所以在 gitbook 上开了一本书。\n  \n  OSC的[在线正则表达式测试](http://tool.oschina.net/regex)\n  \n# 开搞\n\n## 元字符\n  - `\\` : 转义\n  - `\\b` : 单词开始或结束\n  - `^` : 字符串开始\n  - `$` : 字符串结束\n  - `\\d` : 一个数字\n  - `\\s` : 任意空白字符：空格、制表符、换行符、中文全角空格、等\n  - `\\w` : 字母/数字/下划线/汉字 可见字符\n  - `.` : 除换行符以外的任意字符\n\n## 重复\n  - `{n}` : 前置位重复匹配 [n] 次\n  - `{n,m}` : 前置位重复匹配 [n-m] 次\n  - `{n,}` : 前置位重复匹配 [n-∞] 次\n  - `*` : 数量区间：[0-N]\n  - `+` : 数量区间：[1-N]\n  - `?` : 数量区间：[0-1]\n  \n## 字符类\n  - `[nml]` : 可以匹配到 n/m/l\n  \n## 条件\n  - `|` : __或__语句。存在逻辑短路\n  - `(m)` : __分组__语句。子式，可以指定重复什么的\n  \n## 反义\n  - `\\W` : 任意__不是__（字符、数字、下划线、汉字）\n  - `\\S` : 任意__不是__ 空白符\n  - `\\D` : 任意__不是__ 数字\n  - `\\B` : 任意__不是__ 单词开头或结尾\n  - `\\^x` : 除x以外的任意字符\n  - `[\\^abc]` : 除abc这几个字母以外的任意字符\n  \n## 后向引用\n  `(\\w+)`这样用`()`的部分称为一个分组，其匹配到的内容可以使用`\\n`来表示，`n`代表该分组为第n个分组。分组下标从`1`开始。\n  也可以自定义子表达式组名: `(?<Word>M) \\k<Word>` : 或 `(?'Word'M) \\k'Word'`，其中M为子式。\n  \n## 常用分组语法\n\n### 捕获\n  - `(exp)` : 匹配exp,并捕获文本到自动命名的组里\n  - `(?exp)` : 匹配exp,并捕获文本到名称为name的组里，也可以写成(?'name'exp)\n  - `(?:exp)` : 匹配exp,不捕获匹配的文本，也不给此分组分配组号\n\n### 零宽断言\n  - `(?=exp)` : 匹配exp前面的位置\n  - `(?<=exp)` : 匹配exp后面的位置\n  - `(?!exp)` : 匹配后面跟的不是exp的位置\n  - `(?<!exp)` : 匹配前面不是exp的位置\n\n### 注释\n  - `(?#comment)` : 这种类型的分组不对正则表达式的处理产生任何影响，用于提供注释让人阅读\n  \n## 贪婪与懒惰\n  贪婪：匹配的尽可能长\n  懒惰：匹配的尽可能短\n  \n  - `*?` : 重复任意次，但尽可能少重复\n  - `+?` : 重复1次或更多次，但尽可能少重复\n  - `??` : 重复0次或1次，但尽可能少重复\n  - `{n,m}?` : 重复n到m次，但尽可能少重复\n  - `{n,}?` : 重复n次以上，但尽可能少重复\n  \n## 平衡组/递归匹配\n  \\# 我开始看不懂了😂\n  \n## 其他\n  - `\\a` : 报警字符(打印它的效果是电脑嘀一声)\n  - `\\b` : 通常是单词分界位置，但如果在字符类里使用代表退格\n  - `\\t` : 制表符，Tab\n  - `\\r` : 回车\n  - `\\v` : 竖向制表符\n  - `\\f` : 换页符\n  - `\\n` : 换行符\n  - `\\e` : Escape\n  - `\\0nn` : ASCII代码中八进制代码为nn的字符\n  - `\\xnn` : ASCII代码中十六进制代码为nn的字符\n  - `\\unnnn` : Unicode代码中十六进制代码为nnnn的字符\n  - `\\cN` : ASCII控制字符。比如\\cC代表Ctrl+C\n  - `\\A` : 字符串开头(类似^，但不受处理多行选项的影响)\n  - `\\Z` : 字符串结尾或行尾(不受处理多行选项的影响)\n  - `\\z` : 字符串结尾(类似$，但不受处理多行选项的影响)\n  - `\\G` : 当前搜索的开头\n  - `\\p{name}` : Unicode中命名为name的字符类，例如\\p{IsGreek}\n  - `(?>exp)` : 贪婪子表达式\n  - `(?<x>-<y>exp)` : 平衡组\n  - `(?im-nsx:exp)` : 在子表达式exp中改变处理选项\n  - `(?im-nsx)` : 为表达式后面的部分改变处理选项\n  - `(?(exp)yes|no)` : 把exp当作零宽正向先行断言，如果在这个位置能匹配，使用yes作为此组的表达式；否则使用no\n  - `(?(exp)yes)` : 同上，只是使用空表达式作为no\n  - `(?(name)yes|no)` : 如果命名为name的组捕获到了内容，使用yes作为表达式；否则使用no\n  - `(?(name)yes)` : 同上，只是使用空表达式作为no\n  \n  \n## 栗子\n  - 5-12位QQ：`^\\d{5,12}$`\n  - IPv4地址：`((2[0-4]\\d|25[0-5]|[01]?\\d\\d?)\\.){3}(2[0-4]\\d|25[0-5]|[01]?\\d\\d?)`\n  - `go go`、`kitty kitty`这样的叠词：`\\b(\\w+)\\b\\s+\\1\\b`\n  - 后向引用：`\\b(\\w+)\\b\\s+\\1\\b` == `\\b(?<Word>\\w+)\\b\\s+\\k<Word>\\b` == `\\b(?'Word'\\w+)\\b\\s+\\k'Word'\\b`\n  \n# 最后\n  知识研究了一下语法，还未详细测试。思考：这玩意真心厉害😂。","slug":"bruch-up-regular-expressions","published":1,"updated":"2016-12-30T11:12:05.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f9j000el0uvjp8u9s9i","content":"<p>正则表达式基础学习笔记。</p>\n<a id=\"more\"></a>\n<h1 id=\"前面\"><a href=\"#前面\" class=\"headerlink\" title=\"前面\"></a>前面</h1><p>  上次找了个很好的文章，可是手残没保存。。找不到了😭，现在重新找了一个文章：<a href=\"https://luke0922.gitbooks.io/learnregularexpressionin30minutes/content/index.html\" target=\"_blank\" rel=\"external\">正则表达式30分钟入门教程</a><br>  正如作者说的：</p>\n<blockquote>\n<h1 id=\"声明\"><a href=\"#声明\" class=\"headerlink\" title=\"声明\"></a>声明</h1><p>本文非原创，是改编自<a href=\"http://deerchao.net/tutorials/regex/regex.htm#mission\" target=\"_blank\" rel=\"external\">《正则表达式30分钟入门教程》</a>，因为原作者的排版个人不是很喜欢，而且内容上个人觉得有些地方需要改进，所以在 gitbook 上开了一本书。</p>\n</blockquote>\n<p>  OSC的<a href=\"http://tool.oschina.net/regex\" target=\"_blank\" rel=\"external\">在线正则表达式测试</a></p>\n<h1 id=\"开搞\"><a href=\"#开搞\" class=\"headerlink\" title=\"开搞\"></a>开搞</h1><h2 id=\"元字符\"><a href=\"#元字符\" class=\"headerlink\" title=\"元字符\"></a>元字符</h2><ul>\n<li><code>\\</code> : 转义</li>\n<li><code>\\b</code> : 单词开始或结束</li>\n<li><code>^</code> : 字符串开始</li>\n<li><code>$</code> : 字符串结束</li>\n<li><code>\\d</code> : 一个数字</li>\n<li><code>\\s</code> : 任意空白字符：空格、制表符、换行符、中文全角空格、等</li>\n<li><code>\\w</code> : 字母/数字/下划线/汉字 可见字符</li>\n<li><code>.</code> : 除换行符以外的任意字符</li>\n</ul>\n<h2 id=\"重复\"><a href=\"#重复\" class=\"headerlink\" title=\"重复\"></a>重复</h2><ul>\n<li><code>{n}</code> : 前置位重复匹配 [n] 次</li>\n<li><code>{n,m}</code> : 前置位重复匹配 [n-m] 次</li>\n<li><code>{n,}</code> : 前置位重复匹配 [n-∞] 次</li>\n<li><code>*</code> : 数量区间：[0-N]</li>\n<li><code>+</code> : 数量区间：[1-N]</li>\n<li><code>?</code> : 数量区间：[0-1]</li>\n</ul>\n<h2 id=\"字符类\"><a href=\"#字符类\" class=\"headerlink\" title=\"字符类\"></a>字符类</h2><ul>\n<li><code>[nml]</code> : 可以匹配到 n/m/l</li>\n</ul>\n<h2 id=\"条件\"><a href=\"#条件\" class=\"headerlink\" title=\"条件\"></a>条件</h2><ul>\n<li><code>|</code> : <strong>或</strong>语句。存在逻辑短路</li>\n<li><code>(m)</code> : <strong>分组</strong>语句。子式，可以指定重复什么的</li>\n</ul>\n<h2 id=\"反义\"><a href=\"#反义\" class=\"headerlink\" title=\"反义\"></a>反义</h2><ul>\n<li><code>\\W</code> : 任意<strong>不是</strong>（字符、数字、下划线、汉字）</li>\n<li><code>\\S</code> : 任意<strong>不是</strong> 空白符</li>\n<li><code>\\D</code> : 任意<strong>不是</strong> 数字</li>\n<li><code>\\B</code> : 任意<strong>不是</strong> 单词开头或结尾</li>\n<li><code>\\^x</code> : 除x以外的任意字符</li>\n<li><code>[\\^abc]</code> : 除abc这几个字母以外的任意字符</li>\n</ul>\n<h2 id=\"后向引用\"><a href=\"#后向引用\" class=\"headerlink\" title=\"后向引用\"></a>后向引用</h2><p>  <code>(\\w+)</code>这样用<code>()</code>的部分称为一个分组，其匹配到的内容可以使用<code>\\n</code>来表示，<code>n</code>代表该分组为第n个分组。分组下标从<code>1</code>开始。<br>  也可以自定义子表达式组名: <code>(?&lt;Word&gt;M) \\k&lt;Word&gt;</code> : 或 <code>(?&#39;Word&#39;M) \\k&#39;Word&#39;</code>，其中M为子式。</p>\n<h2 id=\"常用分组语法\"><a href=\"#常用分组语法\" class=\"headerlink\" title=\"常用分组语法\"></a>常用分组语法</h2><h3 id=\"捕获\"><a href=\"#捕获\" class=\"headerlink\" title=\"捕获\"></a>捕获</h3><ul>\n<li><code>(exp)</code> : 匹配exp,并捕获文本到自动命名的组里</li>\n<li><code>(?exp)</code> : 匹配exp,并捕获文本到名称为name的组里，也可以写成(?’name’exp)</li>\n<li><code>(?:exp)</code> : 匹配exp,不捕获匹配的文本，也不给此分组分配组号</li>\n</ul>\n<h3 id=\"零宽断言\"><a href=\"#零宽断言\" class=\"headerlink\" title=\"零宽断言\"></a>零宽断言</h3><ul>\n<li><code>(?=exp)</code> : 匹配exp前面的位置</li>\n<li><code>(?&lt;=exp)</code> : 匹配exp后面的位置</li>\n<li><code>(?!exp)</code> : 匹配后面跟的不是exp的位置</li>\n<li><code>(?&lt;!exp)</code> : 匹配前面不是exp的位置</li>\n</ul>\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h3><ul>\n<li><code>(?#comment)</code> : 这种类型的分组不对正则表达式的处理产生任何影响，用于提供注释让人阅读</li>\n</ul>\n<h2 id=\"贪婪与懒惰\"><a href=\"#贪婪与懒惰\" class=\"headerlink\" title=\"贪婪与懒惰\"></a>贪婪与懒惰</h2><p>  贪婪：匹配的尽可能长<br>  懒惰：匹配的尽可能短</p>\n<ul>\n<li><code>*?</code> : 重复任意次，但尽可能少重复</li>\n<li><code>+?</code> : 重复1次或更多次，但尽可能少重复</li>\n<li><code>??</code> : 重复0次或1次，但尽可能少重复</li>\n<li><code>{n,m}?</code> : 重复n到m次，但尽可能少重复</li>\n<li><code>{n,}?</code> : 重复n次以上，但尽可能少重复</li>\n</ul>\n<h2 id=\"平衡组-递归匹配\"><a href=\"#平衡组-递归匹配\" class=\"headerlink\" title=\"平衡组/递归匹配\"></a>平衡组/递归匹配</h2><p>  # 我开始看不懂了😂</p>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><ul>\n<li><code>\\a</code> : 报警字符(打印它的效果是电脑嘀一声)</li>\n<li><code>\\b</code> : 通常是单词分界位置，但如果在字符类里使用代表退格</li>\n<li><code>\\t</code> : 制表符，Tab</li>\n<li><code>\\r</code> : 回车</li>\n<li><code>\\v</code> : 竖向制表符</li>\n<li><code>\\f</code> : 换页符</li>\n<li><code>\\n</code> : 换行符</li>\n<li><code>\\e</code> : Escape</li>\n<li><code>\\0nn</code> : ASCII代码中八进制代码为nn的字符</li>\n<li><code>\\xnn</code> : ASCII代码中十六进制代码为nn的字符</li>\n<li><code>\\unnnn</code> : Unicode代码中十六进制代码为nnnn的字符</li>\n<li><code>\\cN</code> : ASCII控制字符。比如\\cC代表Ctrl+C</li>\n<li><code>\\A</code> : 字符串开头(类似^，但不受处理多行选项的影响)</li>\n<li><code>\\Z</code> : 字符串结尾或行尾(不受处理多行选项的影响)</li>\n<li><code>\\z</code> : 字符串结尾(类似$，但不受处理多行选项的影响)</li>\n<li><code>\\G</code> : 当前搜索的开头</li>\n<li><code>\\p{name}</code> : Unicode中命名为name的字符类，例如\\p{IsGreek}</li>\n<li><code>(?&gt;exp)</code> : 贪婪子表达式</li>\n<li><code>(?&lt;x&gt;-&lt;y&gt;exp)</code> : 平衡组</li>\n<li><code>(?im-nsx:exp)</code> : 在子表达式exp中改变处理选项</li>\n<li><code>(?im-nsx)</code> : 为表达式后面的部分改变处理选项</li>\n<li><code>(?(exp)yes|no)</code> : 把exp当作零宽正向先行断言，如果在这个位置能匹配，使用yes作为此组的表达式；否则使用no</li>\n<li><code>(?(exp)yes)</code> : 同上，只是使用空表达式作为no</li>\n<li><code>(?(name)yes|no)</code> : 如果命名为name的组捕获到了内容，使用yes作为表达式；否则使用no</li>\n<li><code>(?(name)yes)</code> : 同上，只是使用空表达式作为no</li>\n</ul>\n<h2 id=\"栗子\"><a href=\"#栗子\" class=\"headerlink\" title=\"栗子\"></a>栗子</h2><ul>\n<li>5-12位QQ：<code>^\\d{5,12}$</code></li>\n<li>IPv4地址：<code>((2[0-4]\\d|25[0-5]|[01]?\\d\\d?)\\.){3}(2[0-4]\\d|25[0-5]|[01]?\\d\\d?)</code></li>\n<li><code>go go</code>、<code>kitty kitty</code>这样的叠词：<code>\\b(\\w+)\\b\\s+\\1\\b</code></li>\n<li>后向引用：<code>\\b(\\w+)\\b\\s+\\1\\b</code> == <code>\\b(?&lt;Word&gt;\\w+)\\b\\s+\\k&lt;Word&gt;\\b</code> == <code>\\b(?&#39;Word&#39;\\w+)\\b\\s+\\k&#39;Word&#39;\\b</code></li>\n</ul>\n<h1 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h1><p>  知识研究了一下语法，还未详细测试。思考：这玩意真心厉害😂。</p>\n","excerpt":"<p>正则表达式基础学习笔记。</p>","more":"<h1 id=\"前面\"><a href=\"#前面\" class=\"headerlink\" title=\"前面\"></a>前面</h1><p>  上次找了个很好的文章，可是手残没保存。。找不到了😭，现在重新找了一个文章：<a href=\"https://luke0922.gitbooks.io/learnregularexpressionin30minutes/content/index.html\">正则表达式30分钟入门教程</a><br>  正如作者说的：</p>\n<blockquote>\n<h1 id=\"声明\"><a href=\"#声明\" class=\"headerlink\" title=\"声明\"></a>声明</h1><p>本文非原创，是改编自<a href=\"http://deerchao.net/tutorials/regex/regex.htm#mission\">《正则表达式30分钟入门教程》</a>，因为原作者的排版个人不是很喜欢，而且内容上个人觉得有些地方需要改进，所以在 gitbook 上开了一本书。</p>\n</blockquote>\n<p>  OSC的<a href=\"http://tool.oschina.net/regex\">在线正则表达式测试</a></p>\n<h1 id=\"开搞\"><a href=\"#开搞\" class=\"headerlink\" title=\"开搞\"></a>开搞</h1><h2 id=\"元字符\"><a href=\"#元字符\" class=\"headerlink\" title=\"元字符\"></a>元字符</h2><ul>\n<li><code>\\</code> : 转义</li>\n<li><code>\\b</code> : 单词开始或结束</li>\n<li><code>^</code> : 字符串开始</li>\n<li><code>$</code> : 字符串结束</li>\n<li><code>\\d</code> : 一个数字</li>\n<li><code>\\s</code> : 任意空白字符：空格、制表符、换行符、中文全角空格、等</li>\n<li><code>\\w</code> : 字母/数字/下划线/汉字 可见字符</li>\n<li><code>.</code> : 除换行符以外的任意字符</li>\n</ul>\n<h2 id=\"重复\"><a href=\"#重复\" class=\"headerlink\" title=\"重复\"></a>重复</h2><ul>\n<li><code>{n}</code> : 前置位重复匹配 [n] 次</li>\n<li><code>{n,m}</code> : 前置位重复匹配 [n-m] 次</li>\n<li><code>{n,}</code> : 前置位重复匹配 [n-∞] 次</li>\n<li><code>*</code> : 数量区间：[0-N]</li>\n<li><code>+</code> : 数量区间：[1-N]</li>\n<li><code>?</code> : 数量区间：[0-1]</li>\n</ul>\n<h2 id=\"字符类\"><a href=\"#字符类\" class=\"headerlink\" title=\"字符类\"></a>字符类</h2><ul>\n<li><code>[nml]</code> : 可以匹配到 n/m/l</li>\n</ul>\n<h2 id=\"条件\"><a href=\"#条件\" class=\"headerlink\" title=\"条件\"></a>条件</h2><ul>\n<li><code>|</code> : <strong>或</strong>语句。存在逻辑短路</li>\n<li><code>(m)</code> : <strong>分组</strong>语句。子式，可以指定重复什么的</li>\n</ul>\n<h2 id=\"反义\"><a href=\"#反义\" class=\"headerlink\" title=\"反义\"></a>反义</h2><ul>\n<li><code>\\W</code> : 任意<strong>不是</strong>（字符、数字、下划线、汉字）</li>\n<li><code>\\S</code> : 任意<strong>不是</strong> 空白符</li>\n<li><code>\\D</code> : 任意<strong>不是</strong> 数字</li>\n<li><code>\\B</code> : 任意<strong>不是</strong> 单词开头或结尾</li>\n<li><code>\\^x</code> : 除x以外的任意字符</li>\n<li><code>[\\^abc]</code> : 除abc这几个字母以外的任意字符</li>\n</ul>\n<h2 id=\"后向引用\"><a href=\"#后向引用\" class=\"headerlink\" title=\"后向引用\"></a>后向引用</h2><p>  <code>(\\w+)</code>这样用<code>()</code>的部分称为一个分组，其匹配到的内容可以使用<code>\\n</code>来表示，<code>n</code>代表该分组为第n个分组。分组下标从<code>1</code>开始。<br>  也可以自定义子表达式组名: <code>(?&lt;Word&gt;M) \\k&lt;Word&gt;</code> : 或 <code>(?&#39;Word&#39;M) \\k&#39;Word&#39;</code>，其中M为子式。</p>\n<h2 id=\"常用分组语法\"><a href=\"#常用分组语法\" class=\"headerlink\" title=\"常用分组语法\"></a>常用分组语法</h2><h3 id=\"捕获\"><a href=\"#捕获\" class=\"headerlink\" title=\"捕获\"></a>捕获</h3><ul>\n<li><code>(exp)</code> : 匹配exp,并捕获文本到自动命名的组里</li>\n<li><code>(?exp)</code> : 匹配exp,并捕获文本到名称为name的组里，也可以写成(?’name’exp)</li>\n<li><code>(?:exp)</code> : 匹配exp,不捕获匹配的文本，也不给此分组分配组号</li>\n</ul>\n<h3 id=\"零宽断言\"><a href=\"#零宽断言\" class=\"headerlink\" title=\"零宽断言\"></a>零宽断言</h3><ul>\n<li><code>(?=exp)</code> : 匹配exp前面的位置</li>\n<li><code>(?&lt;=exp)</code> : 匹配exp后面的位置</li>\n<li><code>(?!exp)</code> : 匹配后面跟的不是exp的位置</li>\n<li><code>(?&lt;!exp)</code> : 匹配前面不是exp的位置</li>\n</ul>\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h3><ul>\n<li><code>(?#comment)</code> : 这种类型的分组不对正则表达式的处理产生任何影响，用于提供注释让人阅读</li>\n</ul>\n<h2 id=\"贪婪与懒惰\"><a href=\"#贪婪与懒惰\" class=\"headerlink\" title=\"贪婪与懒惰\"></a>贪婪与懒惰</h2><p>  贪婪：匹配的尽可能长<br>  懒惰：匹配的尽可能短</p>\n<ul>\n<li><code>*?</code> : 重复任意次，但尽可能少重复</li>\n<li><code>+?</code> : 重复1次或更多次，但尽可能少重复</li>\n<li><code>??</code> : 重复0次或1次，但尽可能少重复</li>\n<li><code>{n,m}?</code> : 重复n到m次，但尽可能少重复</li>\n<li><code>{n,}?</code> : 重复n次以上，但尽可能少重复</li>\n</ul>\n<h2 id=\"平衡组-递归匹配\"><a href=\"#平衡组-递归匹配\" class=\"headerlink\" title=\"平衡组/递归匹配\"></a>平衡组/递归匹配</h2><p>  # 我开始看不懂了😂</p>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><ul>\n<li><code>\\a</code> : 报警字符(打印它的效果是电脑嘀一声)</li>\n<li><code>\\b</code> : 通常是单词分界位置，但如果在字符类里使用代表退格</li>\n<li><code>\\t</code> : 制表符，Tab</li>\n<li><code>\\r</code> : 回车</li>\n<li><code>\\v</code> : 竖向制表符</li>\n<li><code>\\f</code> : 换页符</li>\n<li><code>\\n</code> : 换行符</li>\n<li><code>\\e</code> : Escape</li>\n<li><code>\\0nn</code> : ASCII代码中八进制代码为nn的字符</li>\n<li><code>\\xnn</code> : ASCII代码中十六进制代码为nn的字符</li>\n<li><code>\\unnnn</code> : Unicode代码中十六进制代码为nnnn的字符</li>\n<li><code>\\cN</code> : ASCII控制字符。比如\\cC代表Ctrl+C</li>\n<li><code>\\A</code> : 字符串开头(类似^，但不受处理多行选项的影响)</li>\n<li><code>\\Z</code> : 字符串结尾或行尾(不受处理多行选项的影响)</li>\n<li><code>\\z</code> : 字符串结尾(类似$，但不受处理多行选项的影响)</li>\n<li><code>\\G</code> : 当前搜索的开头</li>\n<li><code>\\p{name}</code> : Unicode中命名为name的字符类，例如\\p{IsGreek}</li>\n<li><code>(?&gt;exp)</code> : 贪婪子表达式</li>\n<li><code>(?&lt;x&gt;-&lt;y&gt;exp)</code> : 平衡组</li>\n<li><code>(?im-nsx:exp)</code> : 在子表达式exp中改变处理选项</li>\n<li><code>(?im-nsx)</code> : 为表达式后面的部分改变处理选项</li>\n<li><code>(?(exp)yes|no)</code> : 把exp当作零宽正向先行断言，如果在这个位置能匹配，使用yes作为此组的表达式；否则使用no</li>\n<li><code>(?(exp)yes)</code> : 同上，只是使用空表达式作为no</li>\n<li><code>(?(name)yes|no)</code> : 如果命名为name的组捕获到了内容，使用yes作为表达式；否则使用no</li>\n<li><code>(?(name)yes)</code> : 同上，只是使用空表达式作为no</li>\n</ul>\n<h2 id=\"栗子\"><a href=\"#栗子\" class=\"headerlink\" title=\"栗子\"></a>栗子</h2><ul>\n<li>5-12位QQ：<code>^\\d{5,12}$</code></li>\n<li>IPv4地址：<code>((2[0-4]\\d|25[0-5]|[01]?\\d\\d?)\\.){3}(2[0-4]\\d|25[0-5]|[01]?\\d\\d?)</code></li>\n<li><code>go go</code>、<code>kitty kitty</code>这样的叠词：<code>\\b(\\w+)\\b\\s+\\1\\b</code></li>\n<li>后向引用：<code>\\b(\\w+)\\b\\s+\\1\\b</code> == <code>\\b(?&lt;Word&gt;\\w+)\\b\\s+\\k&lt;Word&gt;\\b</code> == <code>\\b(?&#39;Word&#39;\\w+)\\b\\s+\\k&#39;Word&#39;\\b</code></li>\n</ul>\n<h1 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h1><p>  知识研究了一下语法，还未详细测试。思考：这玩意真心厉害😂。</p>"},{"title":"DEBUG - swift中取出通知中的frame","date":"2016-11-30T16:00:00.000Z","_content":"\nswift中获取OC存储的Frame两种获取方案。\n\n<!--more-->\n\n# Swift下在Notification.userInfo取Frame，Debug和Release情况下还不一样。。\n  -->更新于2016.12.1\n  \n  __ Version 8.1 (8B62) __\n\n  ``` swift\n    func keyboardShow(sender: Notification) {\n        var endFrame = CGRect.zero        \n        if let frame = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? CGRect {\n            endFrame = frame\n            //  *** Debug是可以通过的。但是Release无法通过。\n            NSLog(\"<<<INFO>>>: as CGRect\")\n        } else if let value = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValue {\n            endFrame = value.cgRectValue\n            //  *** Release会取出NSValue\n            NSLog(\"<<<INFO>>>: as NSValue\")\n        }\n\n  ```\n\n  由于Release无法调试，所以费了不少劲。首先Swift中的字典已经可以存放值类型，其本身也是值类型。所以我首先选择了第一种写法`let frame = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? CGRect`, 但是Release情况下却发生解包失败的情况。所以采用OC的传统写法`let value = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValue`。就能解析出来。但是总感觉OC的方法不够swift😂。。。\n\n  有同事直接强制转换为NSValue是没有问题的，于是乎试了一下，发现直接校验NSValue就可以。但是swift中感觉不应该有这个转换了，毕竟本身就可以存储CGRect..\n\n  猜测原因：目前阶段Swift的字典和OC的字典数据结构还并未完全一致。。\n\n","source":"_posts/debug-swift-notifa-frame.md","raw":"---\ntitle: DEBUG - swift中取出通知中的frame\ndate: 2016-12-01\ntags: \ncategories:\n    - DEBUG\n---\n\nswift中获取OC存储的Frame两种获取方案。\n\n<!--more-->\n\n# Swift下在Notification.userInfo取Frame，Debug和Release情况下还不一样。。\n  -->更新于2016.12.1\n  \n  __ Version 8.1 (8B62) __\n\n  ``` swift\n    func keyboardShow(sender: Notification) {\n        var endFrame = CGRect.zero        \n        if let frame = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? CGRect {\n            endFrame = frame\n            //  *** Debug是可以通过的。但是Release无法通过。\n            NSLog(\"<<<INFO>>>: as CGRect\")\n        } else if let value = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValue {\n            endFrame = value.cgRectValue\n            //  *** Release会取出NSValue\n            NSLog(\"<<<INFO>>>: as NSValue\")\n        }\n\n  ```\n\n  由于Release无法调试，所以费了不少劲。首先Swift中的字典已经可以存放值类型，其本身也是值类型。所以我首先选择了第一种写法`let frame = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? CGRect`, 但是Release情况下却发生解包失败的情况。所以采用OC的传统写法`let value = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValue`。就能解析出来。但是总感觉OC的方法不够swift😂。。。\n\n  有同事直接强制转换为NSValue是没有问题的，于是乎试了一下，发现直接校验NSValue就可以。但是swift中感觉不应该有这个转换了，毕竟本身就可以存储CGRect..\n\n  猜测原因：目前阶段Swift的字典和OC的字典数据结构还并未完全一致。。\n\n","slug":"debug-swift-notifa-frame","published":1,"updated":"2016-12-30T11:18:29.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f9k000gl0uvcu5eli5t","content":"<p>swift中获取OC存储的Frame两种获取方案。</p>\n<a id=\"more\"></a>\n<h1 id=\"Swift下在Notification-userInfo取Frame，Debug和Release情况下还不一样。。\"><a href=\"#Swift下在Notification-userInfo取Frame，Debug和Release情况下还不一样。。\" class=\"headerlink\" title=\"Swift下在Notification.userInfo取Frame，Debug和Release情况下还不一样。。\"></a>Swift下在Notification.userInfo取Frame，Debug和Release情况下还不一样。。</h1><p>  –&gt;更新于2016.12.1</p>\n<p>  <strong> Version 8.1 (8B62) </strong></p>\n  <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">keyboardShow</span><span class=\"params\">(sender: Notification)</span></span> &#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> endFrame = <span class=\"type\">CGRect</span>.zero        </div><div class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> frame = sender.userInfo?[<span class=\"type\">UIKeyboardFrameEndUserInfoKey</span>] <span class=\"keyword\">as</span>? <span class=\"type\">CGRect</span> &#123;</div><div class=\"line\">        endFrame = frame</div><div class=\"line\">        <span class=\"comment\">//  *** Debug是可以通过的。但是Release无法通过。</span></div><div class=\"line\">        <span class=\"type\">NSLog</span>(<span class=\"string\">\"&lt;&lt;&lt;INFO&gt;&gt;&gt;: as CGRect\"</span>)</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> value = sender.userInfo?[<span class=\"type\">UIKeyboardFrameEndUserInfoKey</span>] <span class=\"keyword\">as</span>? <span class=\"type\">NSValue</span> &#123;</div><div class=\"line\">        endFrame = value.cgRectValue</div><div class=\"line\">        <span class=\"comment\">//  *** Release会取出NSValue</span></div><div class=\"line\">        <span class=\"type\">NSLog</span>(<span class=\"string\">\"&lt;&lt;&lt;INFO&gt;&gt;&gt;: as NSValue\"</span>)</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>  由于Release无法调试，所以费了不少劲。首先Swift中的字典已经可以存放值类型，其本身也是值类型。所以我首先选择了第一种写法<code>let frame = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? CGRect</code>, 但是Release情况下却发生解包失败的情况。所以采用OC的传统写法<code>let value = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValue</code>。就能解析出来。但是总感觉OC的方法不够swift😂。。。</p>\n<p>  有同事直接强制转换为NSValue是没有问题的，于是乎试了一下，发现直接校验NSValue就可以。但是swift中感觉不应该有这个转换了，毕竟本身就可以存储CGRect..</p>\n<p>  猜测原因：目前阶段Swift的字典和OC的字典数据结构还并未完全一致。。</p>\n","excerpt":"<p>swift中获取OC存储的Frame两种获取方案。</p>","more":"<h1 id=\"Swift下在Notification-userInfo取Frame，Debug和Release情况下还不一样。。\"><a href=\"#Swift下在Notification-userInfo取Frame，Debug和Release情况下还不一样。。\" class=\"headerlink\" title=\"Swift下在Notification.userInfo取Frame，Debug和Release情况下还不一样。。\"></a>Swift下在Notification.userInfo取Frame，Debug和Release情况下还不一样。。</h1><p>  –&gt;更新于2016.12.1</p>\n<p>  <strong> Version 8.1 (8B62) </strong></p>\n  <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">keyboardShow</span><span class=\"params\">(sender: Notification)</span></span> &#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> endFrame = <span class=\"type\">CGRect</span>.zero        </div><div class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> frame = sender.userInfo?[<span class=\"type\">UIKeyboardFrameEndUserInfoKey</span>] <span class=\"keyword\">as</span>? <span class=\"type\">CGRect</span> &#123;</div><div class=\"line\">        endFrame = frame</div><div class=\"line\">        <span class=\"comment\">//  *** Debug是可以通过的。但是Release无法通过。</span></div><div class=\"line\">        <span class=\"type\">NSLog</span>(<span class=\"string\">\"&lt;&lt;&lt;INFO&gt;&gt;&gt;: as CGRect\"</span>)</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> value = sender.userInfo?[<span class=\"type\">UIKeyboardFrameEndUserInfoKey</span>] <span class=\"keyword\">as</span>? <span class=\"type\">NSValue</span> &#123;</div><div class=\"line\">        endFrame = value.cgRectValue</div><div class=\"line\">        <span class=\"comment\">//  *** Release会取出NSValue</span></div><div class=\"line\">        <span class=\"type\">NSLog</span>(<span class=\"string\">\"&lt;&lt;&lt;INFO&gt;&gt;&gt;: as NSValue\"</span>)</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>  由于Release无法调试，所以费了不少劲。首先Swift中的字典已经可以存放值类型，其本身也是值类型。所以我首先选择了第一种写法<code>let frame = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? CGRect</code>, 但是Release情况下却发生解包失败的情况。所以采用OC的传统写法<code>let value = sender.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValue</code>。就能解析出来。但是总感觉OC的方法不够swift😂。。。</p>\n<p>  有同事直接强制转换为NSValue是没有问题的，于是乎试了一下，发现直接校验NSValue就可以。但是swift中感觉不应该有这个转换了，毕竟本身就可以存储CGRect..</p>\n<p>  猜测原因：目前阶段Swift的字典和OC的字典数据结构还并未完全一致。。</p>"},{"title":"DEBUG - UIView.h#190","date":"2016-10-11T04:43:22.000Z","_content":"\nCRASH:\n`void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)()`\n\n<!--more-->\n\n# UIView.m:190 - UIViewReportBrokenSuperviewChain\n\n## 异常信息：\n  ```\n  *** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit/UIKit-3599.6.1/UIView.m:190\n  invalid mode 'kCFRunLoopCommonModes' provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.\n  libc++abi.dylib: terminate_handler unexpectedly threw an exception\n  ```\n\n## 异常分析\n  APP crash在\n  ```\n  [keyWindow addSubview:weakSelf];\n  ```\n  [错误堆栈信息](#错误堆栈)。\n\n\n  但是真正造成crash的代码为：\n\n  ```\n  [self.layer insertSublayer:xxxView.layer atIndex:0];\n  ```\n  \n  \n  解决方案：\n  ```\n  [self layoutIfNeeded];\n  [self.layer insertSublayer:xxxView.layer atIndex:0];\n  ```\n  \n  原因分析：\n  下面这个说的很在理\n  > http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation\n  >\n  > I had this issue with a library when moving over to Xcode 8 (Material-Controls-For-iOS - MDTextField). I found that the problem was coming from where the layer of one view (which had no superview) was being added to another.\n  >\n  > It looks like this may be the case for yourself also - your toolbar being created has not been added to a superview first. The fix I used was to add the view as a subview of the view that the layer was being added to, so in your case adding the toolbar as a subview of myModelView should stop the error.\n  \n\n## 碰到该问题的还有\n  - [Google出来的一个，但是并未看到相关回复。。。](http://technology.ezeenow.com/Posts/119474/Unity_Prime31_prompt_for_photo_is_crashing_on_iOS_10_and_XCode_8)\n  - [IOS10上崩溃错误“View has lost track of its superview, most (并未找到原贴)](http://www.th7.cn/Program/IOS/201609/975582.shtml)\n  - [stackoverflow(这个分析的很到位)](http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation)\n\n## <a name=\"错误堆栈\">错误堆栈 <脱敏></a>\n\n  ```\n  *** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit/UIKit-3599.6.1/UIView.m:190\n  invalid mode 'kCFRunLoopCommonModes' provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.\n  libc++abi.dylib: terminate_handler unexpectedly threw an exception\n\n  (lldb) bt\n  * thread #1: tid = 0x87c18, 0x000000018238c524 libobjc.A.dylib`objc_exception_throw, queue = 'com.apple.main-thread', stop reason = breakpoint 1.2\n      frame #0: 0x000000018238c524 libobjc.A.dylib`objc_exception_throw\n      frame #1: 0x0000000183954094 CoreFoundation`+[NSException raise:format:arguments:] + 104\n      frame #2: 0x00000001843de898 Foundation`-[NSAssertionHandler handleFailureInFunction:file:lineNumber:description:] + 88\n      frame #3: 0x0000000189a7cf9c UIKit`UIViewReportBrokenSuperviewChain + 472\n      frame #4: 0x0000000189a7d658 UIKit`_UIViewTopDownSubtreeTraversal + 1496\n      frame #5: 0x000000018a0f3390 UIKit`-[UIView(UIConstraintBasedLayout_EngineDelegate) _invalidateSystemLayoutSizeFittingSizeAtEngineDelegateLevel] + 232\n      frame #6: 0x00000001843832ac Foundation`-[NSISEngine tryToAddConstraintWithMarker:expression:integralizationAdjustment:mutuallyExclusiveConstraints:] + 920\n      frame #7: 0x0000000184382dcc Foundation`-[NSLayoutConstraint _addLoweredExpression:toEngine:integralizationAdjustment:lastLoweredConstantWasRounded:mutuallyExclusiveConstraints:] + 284\n      frame #8: 0x00000001843809e0 Foundation`-[NSLayoutConstraint _addToEngine:integralizationAdjustment:mutuallyExclusiveConstraints:] + 272\n      frame #9: 0x000000018989cfdc UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 396\n      frame #10: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168\n      frame #11: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564\n      frame #12: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224\n      frame #13: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196\n      frame #14: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168\n      frame #15: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564\n      frame #16: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224\n      frame #17: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196\n      frame #18: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168\n      frame #19: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564\n      frame #20: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224\n      frame #21: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196\n      frame #22: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168\n      frame #23: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564\n      frame #24: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224\n      frame #25: 0x00000001898a4bb0 UIKit`-[UIWindow(UIConstraintBasedLayout) _switchToLayoutEngine:] + 72\n      frame #26: 0x00000001898a4b04 UIKit`-[UIWindow(UIConstraintBasedLayout) _initializeLayoutEngine] + 256\n      frame #27: 0x00000001898a4910 UIKit`-[UIView(UIConstraintBasedLayout) _layoutEngine_windowDidChange] + 132\n      frame #28: 0x00000001897996dc UIKit`-[UIView(Internal) _didMoveFromWindow:toWindow:] + 200\n      frame #29: 0x0000000189798d90 UIKit`__45-[UIView(Hierarchy) _postMovedFromSuperview:]_block_invoke + 156\n      frame #30: 0x0000000189798be8 UIKit`-[UIView(Hierarchy) _postMovedFromSuperview:] + 792\n      frame #31: 0x00000001897a4ad0 UIKit`-[UIView(Internal) _addSubview:positioned:relativeTo:] + 1788\n      frame #32: 0x00000001897a43bc UIKit`-[UIView(Hierarchy) addSubview:] + 828\n    * frame #33: 0x00000001004f78ec Project_ent`__31-[EsfCommentReportView show]_block_invoke((null)=<unavailable>) + 228 at EsfCommentReportView.m:293\n      frame #34: 0x00000001897d2b88 UIKit`+[UIView(UIViewAnimationWithBlocks) _setupAnimationWithDuration:delay:view:options:factory:animations:start:animationStateGenerator:completion:] + 660\n      frame #35: 0x00000001897d28e8 UIKit`+[UIView(UIViewAnimationWithBlocks) animateWithDuration:animations:] + 56\n      frame #36: 0x00000001004f77a0 Project_ent`-[EsfCommentReportView show](self=0x000000015fe32020, _cmd=\"show\") + 492 at EsfCommentReportView.m:291\n      frame #37: 0x0000000100858a04 Project_ent`__53-[BuyerAdviserProfileViewController reportAction:]_block_invoke((null)=<unavailable>) + 308 at BuyerAdviserProfileViewController.m:174\n      frame #38: 0x00000001003f93e4 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:](self=MyLoginViewController, _cmd=\"ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:\", viewController=0x000000015fd2e320, sourceType=2, afterCheckOrLogin=0x00000001008588d0, cancelLogin=(null)) + 236 at MyLoginViewController.m:123\n      frame #39: 0x00000001003f92b0 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:](self=MyLoginViewController, _cmd=\"ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:\", viewController=0x000000015fd2e320, afterCheckOrLogin=0x00000001008588d0, cancelLogin=(null)) + 156 at MyLoginViewController.m:114\n      frame #40: 0x00000001003f9124 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:](self=MyLoginViewController, _cmd=\"ifShouldLoginFromViewController:afterCheckOrLogin:\", viewController=0x000000015fd2e320, afterCheckOrLogin=0x00000001008588d0) + 120 at MyLoginViewController.m:104\n      frame #41: 0x0000000100858870 Project_ent`-[BuyerAdviserProfileViewController reportAction:](self=0x000000015fd2e320, _cmd=\"reportAction:\", button=0x000000015fe26650) + 452 at BuyerAdviserProfileViewController.m:156\n      frame #42: 0x00000001897d27b0 UIKit`-[UIApplication sendAction:to:from:forEvent:] + 96\n      frame #43: 0x00000001897d2730 UIKit`-[UIControl sendAction:to:forEvent:] + 80\n      frame #44: 0x00000001897bcbe4 UIKit`-[UIControl _sendActionsForEvents:withEvent:] + 452\n      frame #45: 0x00000001897d201c UIKit`-[UIControl touchesEnded:withEvent:] + 584\n      frame #46: 0x00000001897d1b44 UIKit`-[UIWindow _sendTouchesForEvent:] + 2484\n      frame #47: 0x00000001897ccd8c UIKit`-[UIWindow sendEvent:] + 2988\n      frame #48: 0x000000018979d858 UIKit`-[UIApplication sendEvent:] + 340\n      frame #49: 0x0000000189f8acb8 UIKit`__dispatchPreprocessedEventFromEventQueue + 2736\n      frame #50: 0x0000000189f84720 UIKit`__handleEventQueue + 784\n      frame #51: 0x0000000183902278 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 24\n      frame #52: 0x0000000183901bc0 CoreFoundation`__CFRunLoopDoSources0 + 524\n      frame #53: 0x00000001838ff7c0 CoreFoundation`__CFRunLoopRun + 804\n      frame #54: 0x000000018382e048 CoreFoundation`CFRunLoopRunSpecific + 444\n      frame #55: 0x00000001852b1198 GraphicsServices`GSEventRunModal + 180\n      frame #56: 0x0000000189808628 UIKit`-[UIApplication _run] + 684\n      frame #57: 0x0000000189803360 UIKit`UIApplicationMain + 208\n      frame #58: 0x0000000100a3db78 Project_ent`main + 460 at main.swift:24\n      frame #59: 0x00000001828105b8 libdyld.dylib`start + 4\n  (lldb) \n  ```","source":"_posts/debug-uiview-m-190.md","raw":"---\ntitle: DEBUG - UIView.h#190\ndate: 2016-10-11 12:43:22\ntags: \ncategories:\n    - DEBUG\n\n---\n\nCRASH:\n`void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)()`\n\n<!--more-->\n\n# UIView.m:190 - UIViewReportBrokenSuperviewChain\n\n## 异常信息：\n  ```\n  *** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit/UIKit-3599.6.1/UIView.m:190\n  invalid mode 'kCFRunLoopCommonModes' provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.\n  libc++abi.dylib: terminate_handler unexpectedly threw an exception\n  ```\n\n## 异常分析\n  APP crash在\n  ```\n  [keyWindow addSubview:weakSelf];\n  ```\n  [错误堆栈信息](#错误堆栈)。\n\n\n  但是真正造成crash的代码为：\n\n  ```\n  [self.layer insertSublayer:xxxView.layer atIndex:0];\n  ```\n  \n  \n  解决方案：\n  ```\n  [self layoutIfNeeded];\n  [self.layer insertSublayer:xxxView.layer atIndex:0];\n  ```\n  \n  原因分析：\n  下面这个说的很在理\n  > http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation\n  >\n  > I had this issue with a library when moving over to Xcode 8 (Material-Controls-For-iOS - MDTextField). I found that the problem was coming from where the layer of one view (which had no superview) was being added to another.\n  >\n  > It looks like this may be the case for yourself also - your toolbar being created has not been added to a superview first. The fix I used was to add the view as a subview of the view that the layer was being added to, so in your case adding the toolbar as a subview of myModelView should stop the error.\n  \n\n## 碰到该问题的还有\n  - [Google出来的一个，但是并未看到相关回复。。。](http://technology.ezeenow.com/Posts/119474/Unity_Prime31_prompt_for_photo_is_crashing_on_iOS_10_and_XCode_8)\n  - [IOS10上崩溃错误“View has lost track of its superview, most (并未找到原贴)](http://www.th7.cn/Program/IOS/201609/975582.shtml)\n  - [stackoverflow(这个分析的很到位)](http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation)\n\n## <a name=\"错误堆栈\">错误堆栈 <脱敏></a>\n\n  ```\n  *** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit/UIKit-3599.6.1/UIView.m:190\n  invalid mode 'kCFRunLoopCommonModes' provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.\n  libc++abi.dylib: terminate_handler unexpectedly threw an exception\n\n  (lldb) bt\n  * thread #1: tid = 0x87c18, 0x000000018238c524 libobjc.A.dylib`objc_exception_throw, queue = 'com.apple.main-thread', stop reason = breakpoint 1.2\n      frame #0: 0x000000018238c524 libobjc.A.dylib`objc_exception_throw\n      frame #1: 0x0000000183954094 CoreFoundation`+[NSException raise:format:arguments:] + 104\n      frame #2: 0x00000001843de898 Foundation`-[NSAssertionHandler handleFailureInFunction:file:lineNumber:description:] + 88\n      frame #3: 0x0000000189a7cf9c UIKit`UIViewReportBrokenSuperviewChain + 472\n      frame #4: 0x0000000189a7d658 UIKit`_UIViewTopDownSubtreeTraversal + 1496\n      frame #5: 0x000000018a0f3390 UIKit`-[UIView(UIConstraintBasedLayout_EngineDelegate) _invalidateSystemLayoutSizeFittingSizeAtEngineDelegateLevel] + 232\n      frame #6: 0x00000001843832ac Foundation`-[NSISEngine tryToAddConstraintWithMarker:expression:integralizationAdjustment:mutuallyExclusiveConstraints:] + 920\n      frame #7: 0x0000000184382dcc Foundation`-[NSLayoutConstraint _addLoweredExpression:toEngine:integralizationAdjustment:lastLoweredConstantWasRounded:mutuallyExclusiveConstraints:] + 284\n      frame #8: 0x00000001843809e0 Foundation`-[NSLayoutConstraint _addToEngine:integralizationAdjustment:mutuallyExclusiveConstraints:] + 272\n      frame #9: 0x000000018989cfdc UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 396\n      frame #10: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168\n      frame #11: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564\n      frame #12: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224\n      frame #13: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196\n      frame #14: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168\n      frame #15: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564\n      frame #16: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224\n      frame #17: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196\n      frame #18: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168\n      frame #19: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564\n      frame #20: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224\n      frame #21: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196\n      frame #22: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168\n      frame #23: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564\n      frame #24: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224\n      frame #25: 0x00000001898a4bb0 UIKit`-[UIWindow(UIConstraintBasedLayout) _switchToLayoutEngine:] + 72\n      frame #26: 0x00000001898a4b04 UIKit`-[UIWindow(UIConstraintBasedLayout) _initializeLayoutEngine] + 256\n      frame #27: 0x00000001898a4910 UIKit`-[UIView(UIConstraintBasedLayout) _layoutEngine_windowDidChange] + 132\n      frame #28: 0x00000001897996dc UIKit`-[UIView(Internal) _didMoveFromWindow:toWindow:] + 200\n      frame #29: 0x0000000189798d90 UIKit`__45-[UIView(Hierarchy) _postMovedFromSuperview:]_block_invoke + 156\n      frame #30: 0x0000000189798be8 UIKit`-[UIView(Hierarchy) _postMovedFromSuperview:] + 792\n      frame #31: 0x00000001897a4ad0 UIKit`-[UIView(Internal) _addSubview:positioned:relativeTo:] + 1788\n      frame #32: 0x00000001897a43bc UIKit`-[UIView(Hierarchy) addSubview:] + 828\n    * frame #33: 0x00000001004f78ec Project_ent`__31-[EsfCommentReportView show]_block_invoke((null)=<unavailable>) + 228 at EsfCommentReportView.m:293\n      frame #34: 0x00000001897d2b88 UIKit`+[UIView(UIViewAnimationWithBlocks) _setupAnimationWithDuration:delay:view:options:factory:animations:start:animationStateGenerator:completion:] + 660\n      frame #35: 0x00000001897d28e8 UIKit`+[UIView(UIViewAnimationWithBlocks) animateWithDuration:animations:] + 56\n      frame #36: 0x00000001004f77a0 Project_ent`-[EsfCommentReportView show](self=0x000000015fe32020, _cmd=\"show\") + 492 at EsfCommentReportView.m:291\n      frame #37: 0x0000000100858a04 Project_ent`__53-[BuyerAdviserProfileViewController reportAction:]_block_invoke((null)=<unavailable>) + 308 at BuyerAdviserProfileViewController.m:174\n      frame #38: 0x00000001003f93e4 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:](self=MyLoginViewController, _cmd=\"ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:\", viewController=0x000000015fd2e320, sourceType=2, afterCheckOrLogin=0x00000001008588d0, cancelLogin=(null)) + 236 at MyLoginViewController.m:123\n      frame #39: 0x00000001003f92b0 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:](self=MyLoginViewController, _cmd=\"ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:\", viewController=0x000000015fd2e320, afterCheckOrLogin=0x00000001008588d0, cancelLogin=(null)) + 156 at MyLoginViewController.m:114\n      frame #40: 0x00000001003f9124 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:](self=MyLoginViewController, _cmd=\"ifShouldLoginFromViewController:afterCheckOrLogin:\", viewController=0x000000015fd2e320, afterCheckOrLogin=0x00000001008588d0) + 120 at MyLoginViewController.m:104\n      frame #41: 0x0000000100858870 Project_ent`-[BuyerAdviserProfileViewController reportAction:](self=0x000000015fd2e320, _cmd=\"reportAction:\", button=0x000000015fe26650) + 452 at BuyerAdviserProfileViewController.m:156\n      frame #42: 0x00000001897d27b0 UIKit`-[UIApplication sendAction:to:from:forEvent:] + 96\n      frame #43: 0x00000001897d2730 UIKit`-[UIControl sendAction:to:forEvent:] + 80\n      frame #44: 0x00000001897bcbe4 UIKit`-[UIControl _sendActionsForEvents:withEvent:] + 452\n      frame #45: 0x00000001897d201c UIKit`-[UIControl touchesEnded:withEvent:] + 584\n      frame #46: 0x00000001897d1b44 UIKit`-[UIWindow _sendTouchesForEvent:] + 2484\n      frame #47: 0x00000001897ccd8c UIKit`-[UIWindow sendEvent:] + 2988\n      frame #48: 0x000000018979d858 UIKit`-[UIApplication sendEvent:] + 340\n      frame #49: 0x0000000189f8acb8 UIKit`__dispatchPreprocessedEventFromEventQueue + 2736\n      frame #50: 0x0000000189f84720 UIKit`__handleEventQueue + 784\n      frame #51: 0x0000000183902278 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 24\n      frame #52: 0x0000000183901bc0 CoreFoundation`__CFRunLoopDoSources0 + 524\n      frame #53: 0x00000001838ff7c0 CoreFoundation`__CFRunLoopRun + 804\n      frame #54: 0x000000018382e048 CoreFoundation`CFRunLoopRunSpecific + 444\n      frame #55: 0x00000001852b1198 GraphicsServices`GSEventRunModal + 180\n      frame #56: 0x0000000189808628 UIKit`-[UIApplication _run] + 684\n      frame #57: 0x0000000189803360 UIKit`UIApplicationMain + 208\n      frame #58: 0x0000000100a3db78 Project_ent`main + 460 at main.swift:24\n      frame #59: 0x00000001828105b8 libdyld.dylib`start + 4\n  (lldb) \n  ```","slug":"debug-uiview-m-190","published":1,"updated":"2016-12-30T11:19:29.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f9m000hl0uvc81uajof","content":"<p>CRASH:<br><code>void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)()</code></p>\n<a id=\"more\"></a>\n<h1 id=\"UIView-m-190-UIViewReportBrokenSuperviewChain\"><a href=\"#UIView-m-190-UIViewReportBrokenSuperviewChain\" class=\"headerlink\" title=\"UIView.m:190 - UIViewReportBrokenSuperviewChain\"></a>UIView.m:190 - UIViewReportBrokenSuperviewChain</h1><h2 id=\"异常信息：\"><a href=\"#异常信息：\" class=\"headerlink\" title=\"异常信息：\"></a>异常信息：</h2>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">*** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit/UIKit-3599.6.1/UIView.m:190</div><div class=\"line\">invalid mode &apos;kCFRunLoopCommonModes&apos; provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.</div><div class=\"line\">libc++abi.dylib: terminate_handler unexpectedly threw an exception</div></pre></td></tr></table></figure>\n<h2 id=\"异常分析\"><a href=\"#异常分析\" class=\"headerlink\" title=\"异常分析\"></a>异常分析</h2><p>  APP crash在<br>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">[keyWindow addSubview:weakSelf];</div></pre></td></tr></table></figure></p>\n<p>  <a href=\"#错误堆栈\">错误堆栈信息</a>。</p>\n<p>  但是真正造成crash的代码为：</p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">[self.layer insertSublayer:xxxView.layer atIndex:0];</div></pre></td></tr></table></figure>\n<p>  解决方案：<br>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">[self layoutIfNeeded];</div><div class=\"line\">[self.layer insertSublayer:xxxView.layer atIndex:0];</div></pre></td></tr></table></figure></p>\n<p>  原因分析：<br>  下面这个说的很在理</p>\n<blockquote>\n<p><a href=\"http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation\" target=\"_blank\" rel=\"external\">http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation</a></p>\n<p>I had this issue with a library when moving over to Xcode 8 (Material-Controls-For-iOS - MDTextField). I found that the problem was coming from where the layer of one view (which had no superview) was being added to another.</p>\n<p>It looks like this may be the case for yourself also - your toolbar being created has not been added to a superview first. The fix I used was to add the view as a subview of the view that the layer was being added to, so in your case adding the toolbar as a subview of myModelView should stop the error.</p>\n</blockquote>\n<h2 id=\"碰到该问题的还有\"><a href=\"#碰到该问题的还有\" class=\"headerlink\" title=\"碰到该问题的还有\"></a>碰到该问题的还有</h2><ul>\n<li><a href=\"http://technology.ezeenow.com/Posts/119474/Unity_Prime31_prompt_for_photo_is_crashing_on_iOS_10_and_XCode_8\" target=\"_blank\" rel=\"external\">Google出来的一个，但是并未看到相关回复。。。</a></li>\n<li><a href=\"http://www.th7.cn/Program/IOS/201609/975582.shtml\" target=\"_blank\" rel=\"external\">IOS10上崩溃错误“View has lost track of its superview, most (并未找到原贴)</a></li>\n<li><a href=\"http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation\" target=\"_blank\" rel=\"external\">stackoverflow(这个分析的很到位)</a></li>\n</ul>\n<h2 id=\"错误堆栈-lt-脱敏-gt\"><a href=\"#错误堆栈-lt-脱敏-gt\" class=\"headerlink\" title=\"错误堆栈 &lt;脱敏&gt;\"></a><a name=\"错误堆栈\">错误堆栈 &lt;脱敏&gt;</a></h2>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div></pre></td><td class=\"code\"><pre><div class=\"line\">*** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit/UIKit-3599.6.1/UIView.m:190</div><div class=\"line\">invalid mode &apos;kCFRunLoopCommonModes&apos; provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.</div><div class=\"line\">libc++abi.dylib: terminate_handler unexpectedly threw an exception</div><div class=\"line\"></div><div class=\"line\">(lldb) bt</div><div class=\"line\">* thread #1: tid = 0x87c18, 0x000000018238c524 libobjc.A.dylib`objc_exception_throw, queue = &apos;com.apple.main-thread&apos;, stop reason = breakpoint 1.2</div><div class=\"line\">    frame #0: 0x000000018238c524 libobjc.A.dylib`objc_exception_throw</div><div class=\"line\">    frame #1: 0x0000000183954094 CoreFoundation`+[NSException raise:format:arguments:] + 104</div><div class=\"line\">    frame #2: 0x00000001843de898 Foundation`-[NSAssertionHandler handleFailureInFunction:file:lineNumber:description:] + 88</div><div class=\"line\">    frame #3: 0x0000000189a7cf9c UIKit`UIViewReportBrokenSuperviewChain + 472</div><div class=\"line\">    frame #4: 0x0000000189a7d658 UIKit`_UIViewTopDownSubtreeTraversal + 1496</div><div class=\"line\">    frame #5: 0x000000018a0f3390 UIKit`-[UIView(UIConstraintBasedLayout_EngineDelegate) _invalidateSystemLayoutSizeFittingSizeAtEngineDelegateLevel] + 232</div><div class=\"line\">    frame #6: 0x00000001843832ac Foundation`-[NSISEngine tryToAddConstraintWithMarker:expression:integralizationAdjustment:mutuallyExclusiveConstraints:] + 920</div><div class=\"line\">    frame #7: 0x0000000184382dcc Foundation`-[NSLayoutConstraint _addLoweredExpression:toEngine:integralizationAdjustment:lastLoweredConstantWasRounded:mutuallyExclusiveConstraints:] + 284</div><div class=\"line\">    frame #8: 0x00000001843809e0 Foundation`-[NSLayoutConstraint _addToEngine:integralizationAdjustment:mutuallyExclusiveConstraints:] + 272</div><div class=\"line\">    frame #9: 0x000000018989cfdc UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 396</div><div class=\"line\">    frame #10: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168</div><div class=\"line\">    frame #11: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</div><div class=\"line\">    frame #12: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</div><div class=\"line\">    frame #13: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196</div><div class=\"line\">    frame #14: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168</div><div class=\"line\">    frame #15: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</div><div class=\"line\">    frame #16: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</div><div class=\"line\">    frame #17: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196</div><div class=\"line\">    frame #18: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168</div><div class=\"line\">    frame #19: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</div><div class=\"line\">    frame #20: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</div><div class=\"line\">    frame #21: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196</div><div class=\"line\">    frame #22: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168</div><div class=\"line\">    frame #23: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</div><div class=\"line\">    frame #24: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</div><div class=\"line\">    frame #25: 0x00000001898a4bb0 UIKit`-[UIWindow(UIConstraintBasedLayout) _switchToLayoutEngine:] + 72</div><div class=\"line\">    frame #26: 0x00000001898a4b04 UIKit`-[UIWindow(UIConstraintBasedLayout) _initializeLayoutEngine] + 256</div><div class=\"line\">    frame #27: 0x00000001898a4910 UIKit`-[UIView(UIConstraintBasedLayout) _layoutEngine_windowDidChange] + 132</div><div class=\"line\">    frame #28: 0x00000001897996dc UIKit`-[UIView(Internal) _didMoveFromWindow:toWindow:] + 200</div><div class=\"line\">    frame #29: 0x0000000189798d90 UIKit`__45-[UIView(Hierarchy) _postMovedFromSuperview:]_block_invoke + 156</div><div class=\"line\">    frame #30: 0x0000000189798be8 UIKit`-[UIView(Hierarchy) _postMovedFromSuperview:] + 792</div><div class=\"line\">    frame #31: 0x00000001897a4ad0 UIKit`-[UIView(Internal) _addSubview:positioned:relativeTo:] + 1788</div><div class=\"line\">    frame #32: 0x00000001897a43bc UIKit`-[UIView(Hierarchy) addSubview:] + 828</div><div class=\"line\">  * frame #33: 0x00000001004f78ec Project_ent`__31-[EsfCommentReportView show]_block_invoke((null)=&lt;unavailable&gt;) + 228 at EsfCommentReportView.m:293</div><div class=\"line\">    frame #34: 0x00000001897d2b88 UIKit`+[UIView(UIViewAnimationWithBlocks) _setupAnimationWithDuration:delay:view:options:factory:animations:start:animationStateGenerator:completion:] + 660</div><div class=\"line\">    frame #35: 0x00000001897d28e8 UIKit`+[UIView(UIViewAnimationWithBlocks) animateWithDuration:animations:] + 56</div><div class=\"line\">    frame #36: 0x00000001004f77a0 Project_ent`-[EsfCommentReportView show](self=0x000000015fe32020, _cmd=&quot;show&quot;) + 492 at EsfCommentReportView.m:291</div><div class=\"line\">    frame #37: 0x0000000100858a04 Project_ent`__53-[BuyerAdviserProfileViewController reportAction:]_block_invoke((null)=&lt;unavailable&gt;) + 308 at BuyerAdviserProfileViewController.m:174</div><div class=\"line\">    frame #38: 0x00000001003f93e4 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:](self=MyLoginViewController, _cmd=&quot;ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:&quot;, viewController=0x000000015fd2e320, sourceType=2, afterCheckOrLogin=0x00000001008588d0, cancelLogin=(null)) + 236 at MyLoginViewController.m:123</div><div class=\"line\">    frame #39: 0x00000001003f92b0 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:](self=MyLoginViewController, _cmd=&quot;ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:&quot;, viewController=0x000000015fd2e320, afterCheckOrLogin=0x00000001008588d0, cancelLogin=(null)) + 156 at MyLoginViewController.m:114</div><div class=\"line\">    frame #40: 0x00000001003f9124 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:](self=MyLoginViewController, _cmd=&quot;ifShouldLoginFromViewController:afterCheckOrLogin:&quot;, viewController=0x000000015fd2e320, afterCheckOrLogin=0x00000001008588d0) + 120 at MyLoginViewController.m:104</div><div class=\"line\">    frame #41: 0x0000000100858870 Project_ent`-[BuyerAdviserProfileViewController reportAction:](self=0x000000015fd2e320, _cmd=&quot;reportAction:&quot;, button=0x000000015fe26650) + 452 at BuyerAdviserProfileViewController.m:156</div><div class=\"line\">    frame #42: 0x00000001897d27b0 UIKit`-[UIApplication sendAction:to:from:forEvent:] + 96</div><div class=\"line\">    frame #43: 0x00000001897d2730 UIKit`-[UIControl sendAction:to:forEvent:] + 80</div><div class=\"line\">    frame #44: 0x00000001897bcbe4 UIKit`-[UIControl _sendActionsForEvents:withEvent:] + 452</div><div class=\"line\">    frame #45: 0x00000001897d201c UIKit`-[UIControl touchesEnded:withEvent:] + 584</div><div class=\"line\">    frame #46: 0x00000001897d1b44 UIKit`-[UIWindow _sendTouchesForEvent:] + 2484</div><div class=\"line\">    frame #47: 0x00000001897ccd8c UIKit`-[UIWindow sendEvent:] + 2988</div><div class=\"line\">    frame #48: 0x000000018979d858 UIKit`-[UIApplication sendEvent:] + 340</div><div class=\"line\">    frame #49: 0x0000000189f8acb8 UIKit`__dispatchPreprocessedEventFromEventQueue + 2736</div><div class=\"line\">    frame #50: 0x0000000189f84720 UIKit`__handleEventQueue + 784</div><div class=\"line\">    frame #51: 0x0000000183902278 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 24</div><div class=\"line\">    frame #52: 0x0000000183901bc0 CoreFoundation`__CFRunLoopDoSources0 + 524</div><div class=\"line\">    frame #53: 0x00000001838ff7c0 CoreFoundation`__CFRunLoopRun + 804</div><div class=\"line\">    frame #54: 0x000000018382e048 CoreFoundation`CFRunLoopRunSpecific + 444</div><div class=\"line\">    frame #55: 0x00000001852b1198 GraphicsServices`GSEventRunModal + 180</div><div class=\"line\">    frame #56: 0x0000000189808628 UIKit`-[UIApplication _run] + 684</div><div class=\"line\">    frame #57: 0x0000000189803360 UIKit`UIApplicationMain + 208</div><div class=\"line\">    frame #58: 0x0000000100a3db78 Project_ent`main + 460 at main.swift:24</div><div class=\"line\">    frame #59: 0x00000001828105b8 libdyld.dylib`start + 4</div><div class=\"line\">(lldb)</div></pre></td></tr></table></figure>","excerpt":"<p>CRASH:<br><code>void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)()</code></p>","more":"<h1 id=\"UIView-m-190-UIViewReportBrokenSuperviewChain\"><a href=\"#UIView-m-190-UIViewReportBrokenSuperviewChain\" class=\"headerlink\" title=\"UIView.m:190 - UIViewReportBrokenSuperviewChain\"></a>UIView.m:190 - UIViewReportBrokenSuperviewChain</h1><h2 id=\"异常信息：\"><a href=\"#异常信息：\" class=\"headerlink\" title=\"异常信息：\"></a>异常信息：</h2>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">*** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit/UIKit-3599.6.1/UIView.m:190</div><div class=\"line\">invalid mode &apos;kCFRunLoopCommonModes&apos; provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.</div><div class=\"line\">libc++abi.dylib: terminate_handler unexpectedly threw an exception</div></pre></td></tr></table></figure>\n<h2 id=\"异常分析\"><a href=\"#异常分析\" class=\"headerlink\" title=\"异常分析\"></a>异常分析</h2><p>  APP crash在<br>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">[keyWindow addSubview:weakSelf];</div></pre></td></tr></table></figure></p>\n<p>  <a href=\"#错误堆栈\">错误堆栈信息</a>。</p>\n<p>  但是真正造成crash的代码为：</p>\n  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">[self.layer insertSublayer:xxxView.layer atIndex:0];</div></pre></td></tr></table></figure>\n<p>  解决方案：<br>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">[self layoutIfNeeded];</div><div class=\"line\">[self.layer insertSublayer:xxxView.layer atIndex:0];</div></pre></td></tr></table></figure></p>\n<p>  原因分析：<br>  下面这个说的很在理</p>\n<blockquote>\n<p><a href=\"http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation\">http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation</a></p>\n<p>I had this issue with a library when moving over to Xcode 8 (Material-Controls-For-iOS - MDTextField). I found that the problem was coming from where the layer of one view (which had no superview) was being added to another.</p>\n<p>It looks like this may be the case for yourself also - your toolbar being created has not been added to a superview first. The fix I used was to add the view as a subview of the view that the layer was being added to, so in your case adding the toolbar as a subview of myModelView should stop the error.</p>\n</blockquote>\n<h2 id=\"碰到该问题的还有\"><a href=\"#碰到该问题的还有\" class=\"headerlink\" title=\"碰到该问题的还有\"></a>碰到该问题的还有</h2><ul>\n<li><a href=\"http://technology.ezeenow.com/Posts/119474/Unity_Prime31_prompt_for_photo_is_crashing_on_iOS_10_and_XCode_8\">Google出来的一个，但是并未看到相关回复。。。</a></li>\n<li><a href=\"http://www.th7.cn/Program/IOS/201609/975582.shtml\">IOS10上崩溃错误“View has lost track of its superview, most (并未找到原贴)</a></li>\n<li><a href=\"http://stackoverflow.com/questions/39565424/swift-uiviewreportbrokensuperviewchain-cause-by-layer-manipulation\">stackoverflow(这个分析的很到位)</a></li>\n</ul>\n<h2 id=\"错误堆栈-lt-脱敏-gt\"><a href=\"#错误堆栈-lt-脱敏-gt\" class=\"headerlink\" title=\"错误堆栈 &lt;脱敏&gt;\"></a><a name=\"错误堆栈\">错误堆栈 &lt;脱敏&gt;</a></h2>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div></pre></td><td class=\"code\"><pre><div class=\"line\">*** Assertion failure in void UIViewReportBrokenSuperviewChain(UIView *__strong, UIView *__strong, BOOL)(), /BuildRoot/Library/Caches/com.apple.xbs/Sources/UIKit/UIKit-3599.6.1/UIView.m:190</div><div class=\"line\">invalid mode &apos;kCFRunLoopCommonModes&apos; provided to CFRunLoopRunSpecific - break on _CFRunLoopError_RunCalledWithInvalidMode to debug. This message will only appear once per execution.</div><div class=\"line\">libc++abi.dylib: terminate_handler unexpectedly threw an exception</div><div class=\"line\"></div><div class=\"line\">(lldb) bt</div><div class=\"line\">* thread #1: tid = 0x87c18, 0x000000018238c524 libobjc.A.dylib`objc_exception_throw, queue = &apos;com.apple.main-thread&apos;, stop reason = breakpoint 1.2</div><div class=\"line\">    frame #0: 0x000000018238c524 libobjc.A.dylib`objc_exception_throw</div><div class=\"line\">    frame #1: 0x0000000183954094 CoreFoundation`+[NSException raise:format:arguments:] + 104</div><div class=\"line\">    frame #2: 0x00000001843de898 Foundation`-[NSAssertionHandler handleFailureInFunction:file:lineNumber:description:] + 88</div><div class=\"line\">    frame #3: 0x0000000189a7cf9c UIKit`UIViewReportBrokenSuperviewChain + 472</div><div class=\"line\">    frame #4: 0x0000000189a7d658 UIKit`_UIViewTopDownSubtreeTraversal + 1496</div><div class=\"line\">    frame #5: 0x000000018a0f3390 UIKit`-[UIView(UIConstraintBasedLayout_EngineDelegate) _invalidateSystemLayoutSizeFittingSizeAtEngineDelegateLevel] + 232</div><div class=\"line\">    frame #6: 0x00000001843832ac Foundation`-[NSISEngine tryToAddConstraintWithMarker:expression:integralizationAdjustment:mutuallyExclusiveConstraints:] + 920</div><div class=\"line\">    frame #7: 0x0000000184382dcc Foundation`-[NSLayoutConstraint _addLoweredExpression:toEngine:integralizationAdjustment:lastLoweredConstantWasRounded:mutuallyExclusiveConstraints:] + 284</div><div class=\"line\">    frame #8: 0x00000001843809e0 Foundation`-[NSLayoutConstraint _addToEngine:integralizationAdjustment:mutuallyExclusiveConstraints:] + 272</div><div class=\"line\">    frame #9: 0x000000018989cfdc UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 396</div><div class=\"line\">    frame #10: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168</div><div class=\"line\">    frame #11: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</div><div class=\"line\">    frame #12: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</div><div class=\"line\">    frame #13: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196</div><div class=\"line\">    frame #14: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168</div><div class=\"line\">    frame #15: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</div><div class=\"line\">    frame #16: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</div><div class=\"line\">    frame #17: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196</div><div class=\"line\">    frame #18: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168</div><div class=\"line\">    frame #19: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</div><div class=\"line\">    frame #20: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</div><div class=\"line\">    frame #21: 0x000000018989cf14 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke_2 + 196</div><div class=\"line\">    frame #22: 0x0000000184380510 Foundation`-[NSISEngine withBehaviors:performModifications:] + 168</div><div class=\"line\">    frame #23: 0x000000018989cde8 UIKit`__57-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:]_block_invoke + 564</div><div class=\"line\">    frame #24: 0x00000001897995e0 UIKit`-[UIView(AdditionalLayoutSupport) _switchToLayoutEngine:] + 224</div><div class=\"line\">    frame #25: 0x00000001898a4bb0 UIKit`-[UIWindow(UIConstraintBasedLayout) _switchToLayoutEngine:] + 72</div><div class=\"line\">    frame #26: 0x00000001898a4b04 UIKit`-[UIWindow(UIConstraintBasedLayout) _initializeLayoutEngine] + 256</div><div class=\"line\">    frame #27: 0x00000001898a4910 UIKit`-[UIView(UIConstraintBasedLayout) _layoutEngine_windowDidChange] + 132</div><div class=\"line\">    frame #28: 0x00000001897996dc UIKit`-[UIView(Internal) _didMoveFromWindow:toWindow:] + 200</div><div class=\"line\">    frame #29: 0x0000000189798d90 UIKit`__45-[UIView(Hierarchy) _postMovedFromSuperview:]_block_invoke + 156</div><div class=\"line\">    frame #30: 0x0000000189798be8 UIKit`-[UIView(Hierarchy) _postMovedFromSuperview:] + 792</div><div class=\"line\">    frame #31: 0x00000001897a4ad0 UIKit`-[UIView(Internal) _addSubview:positioned:relativeTo:] + 1788</div><div class=\"line\">    frame #32: 0x00000001897a43bc UIKit`-[UIView(Hierarchy) addSubview:] + 828</div><div class=\"line\">  * frame #33: 0x00000001004f78ec Project_ent`__31-[EsfCommentReportView show]_block_invoke((null)=&lt;unavailable&gt;) + 228 at EsfCommentReportView.m:293</div><div class=\"line\">    frame #34: 0x00000001897d2b88 UIKit`+[UIView(UIViewAnimationWithBlocks) _setupAnimationWithDuration:delay:view:options:factory:animations:start:animationStateGenerator:completion:] + 660</div><div class=\"line\">    frame #35: 0x00000001897d28e8 UIKit`+[UIView(UIViewAnimationWithBlocks) animateWithDuration:animations:] + 56</div><div class=\"line\">    frame #36: 0x00000001004f77a0 Project_ent`-[EsfCommentReportView show](self=0x000000015fe32020, _cmd=&quot;show&quot;) + 492 at EsfCommentReportView.m:291</div><div class=\"line\">    frame #37: 0x0000000100858a04 Project_ent`__53-[BuyerAdviserProfileViewController reportAction:]_block_invoke((null)=&lt;unavailable&gt;) + 308 at BuyerAdviserProfileViewController.m:174</div><div class=\"line\">    frame #38: 0x00000001003f93e4 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:](self=MyLoginViewController, _cmd=&quot;ifShouldLoginFromViewController:sourceType:afterCheckOrLogin:cancelLogin:&quot;, viewController=0x000000015fd2e320, sourceType=2, afterCheckOrLogin=0x00000001008588d0, cancelLogin=(null)) + 236 at MyLoginViewController.m:123</div><div class=\"line\">    frame #39: 0x00000001003f92b0 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:](self=MyLoginViewController, _cmd=&quot;ifShouldLoginFromViewController:afterCheckOrLogin:cancelLogin:&quot;, viewController=0x000000015fd2e320, afterCheckOrLogin=0x00000001008588d0, cancelLogin=(null)) + 156 at MyLoginViewController.m:114</div><div class=\"line\">    frame #40: 0x00000001003f9124 Project_ent`+[MyLoginViewController ifShouldLoginFromViewController:afterCheckOrLogin:](self=MyLoginViewController, _cmd=&quot;ifShouldLoginFromViewController:afterCheckOrLogin:&quot;, viewController=0x000000015fd2e320, afterCheckOrLogin=0x00000001008588d0) + 120 at MyLoginViewController.m:104</div><div class=\"line\">    frame #41: 0x0000000100858870 Project_ent`-[BuyerAdviserProfileViewController reportAction:](self=0x000000015fd2e320, _cmd=&quot;reportAction:&quot;, button=0x000000015fe26650) + 452 at BuyerAdviserProfileViewController.m:156</div><div class=\"line\">    frame #42: 0x00000001897d27b0 UIKit`-[UIApplication sendAction:to:from:forEvent:] + 96</div><div class=\"line\">    frame #43: 0x00000001897d2730 UIKit`-[UIControl sendAction:to:forEvent:] + 80</div><div class=\"line\">    frame #44: 0x00000001897bcbe4 UIKit`-[UIControl _sendActionsForEvents:withEvent:] + 452</div><div class=\"line\">    frame #45: 0x00000001897d201c UIKit`-[UIControl touchesEnded:withEvent:] + 584</div><div class=\"line\">    frame #46: 0x00000001897d1b44 UIKit`-[UIWindow _sendTouchesForEvent:] + 2484</div><div class=\"line\">    frame #47: 0x00000001897ccd8c UIKit`-[UIWindow sendEvent:] + 2988</div><div class=\"line\">    frame #48: 0x000000018979d858 UIKit`-[UIApplication sendEvent:] + 340</div><div class=\"line\">    frame #49: 0x0000000189f8acb8 UIKit`__dispatchPreprocessedEventFromEventQueue + 2736</div><div class=\"line\">    frame #50: 0x0000000189f84720 UIKit`__handleEventQueue + 784</div><div class=\"line\">    frame #51: 0x0000000183902278 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 24</div><div class=\"line\">    frame #52: 0x0000000183901bc0 CoreFoundation`__CFRunLoopDoSources0 + 524</div><div class=\"line\">    frame #53: 0x00000001838ff7c0 CoreFoundation`__CFRunLoopRun + 804</div><div class=\"line\">    frame #54: 0x000000018382e048 CoreFoundation`CFRunLoopRunSpecific + 444</div><div class=\"line\">    frame #55: 0x00000001852b1198 GraphicsServices`GSEventRunModal + 180</div><div class=\"line\">    frame #56: 0x0000000189808628 UIKit`-[UIApplication _run] + 684</div><div class=\"line\">    frame #57: 0x0000000189803360 UIKit`UIApplicationMain + 208</div><div class=\"line\">    frame #58: 0x0000000100a3db78 Project_ent`main + 460 at main.swift:24</div><div class=\"line\">    frame #59: 0x00000001828105b8 libdyld.dylib`start + 4</div><div class=\"line\">(lldb)</div></pre></td></tr></table></figure>"},{"title":"DEBUG - Xcode8解析.crash","date":"2016-11-14T04:43:22.000Z","_content":"\n5步解析`.crash`文件\n\n<!--more-->\n\n# Xcode8中解析.crash文件\n  \n  1. 导出`x.crash`文件，放置在`目录A`下\n  2. 复制`工程名.app.dSYM`到`目录A`\n  3. 配置环境变量，运行`export DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer`\n  4. 拷贝脚本文件，运行`cp /Applications/Xcode.app/Contents/SharedFrameworks/DVTFoundation.framework/Versions/A/Resources/symbolicatecrash 目录A`\n  5. 到`目录A`解析，运行`./symbolicatecrash x.crash 工程名.app.dSYM > 自定义输出结果文件名`\n","source":"_posts/debug-xcode8-analysis-crash-file.md","raw":"---\ntitle: DEBUG - Xcode8解析.crash\ndate: 2016-11-14 12:43:22\ntags: \ncategories:\n    - DEBUG\n---\n\n5步解析`.crash`文件\n\n<!--more-->\n\n# Xcode8中解析.crash文件\n  \n  1. 导出`x.crash`文件，放置在`目录A`下\n  2. 复制`工程名.app.dSYM`到`目录A`\n  3. 配置环境变量，运行`export DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer`\n  4. 拷贝脚本文件，运行`cp /Applications/Xcode.app/Contents/SharedFrameworks/DVTFoundation.framework/Versions/A/Resources/symbolicatecrash 目录A`\n  5. 到`目录A`解析，运行`./symbolicatecrash x.crash 工程名.app.dSYM > 自定义输出结果文件名`\n","slug":"debug-xcode8-analysis-crash-file","published":1,"updated":"2016-12-30T11:18:17.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f9o000kl0uv8ec62lrc","content":"<p>5步解析<code>.crash</code>文件</p>\n<a id=\"more\"></a>\n<h1 id=\"Xcode8中解析-crash文件\"><a href=\"#Xcode8中解析-crash文件\" class=\"headerlink\" title=\"Xcode8中解析.crash文件\"></a>Xcode8中解析.crash文件</h1><ol>\n<li>导出<code>x.crash</code>文件，放置在<code>目录A</code>下</li>\n<li>复制<code>工程名.app.dSYM</code>到<code>目录A</code></li>\n<li>配置环境变量，运行<code>export DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer</code></li>\n<li>拷贝脚本文件，运行<code>cp /Applications/Xcode.app/Contents/SharedFrameworks/DVTFoundation.framework/Versions/A/Resources/symbolicatecrash 目录A</code></li>\n<li>到<code>目录A</code>解析，运行<code>./symbolicatecrash x.crash 工程名.app.dSYM &gt; 自定义输出结果文件名</code></li>\n</ol>\n","excerpt":"<p>5步解析<code>.crash</code>文件</p>","more":"<h1 id=\"Xcode8中解析-crash文件\"><a href=\"#Xcode8中解析-crash文件\" class=\"headerlink\" title=\"Xcode8中解析.crash文件\"></a>Xcode8中解析.crash文件</h1><ol>\n<li>导出<code>x.crash</code>文件，放置在<code>目录A</code>下</li>\n<li>复制<code>工程名.app.dSYM</code>到<code>目录A</code></li>\n<li>配置环境变量，运行<code>export DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer</code></li>\n<li>拷贝脚本文件，运行<code>cp /Applications/Xcode.app/Contents/SharedFrameworks/DVTFoundation.framework/Versions/A/Resources/symbolicatecrash 目录A</code></li>\n<li>到<code>目录A</code>解析，运行<code>./symbolicatecrash x.crash 工程名.app.dSYM &gt; 自定义输出结果文件名</code></li>\n</ol>"},{"title":"Fastlane自动化笔记","date":"2017-01-04T10:14:07.000Z","_content":"\n之前在搭建Jenkins的时候，由于看到Fastlane的配置好复杂，那么多，而当时的需求就是自动打包。。所以没有用，现在想来好气！今天翻到InfoQ的一个文章，又详细的了解了Fastlane之后，觉得此大法甚好，解决很多痛点！决定搞通这一切！\n回看之前的[build-ipa-sh.md](https://madordie.github.io/2016/09/26/build-ipa-sh)确实比较僵硬。自动化还是很棒的。\n\n<!--more-->\n\n# 基本知识\n  ([@icyleaf](http://icyleaf.com))在[Fastlane - iOS 和 Android 的自动化构建工具](https://icyleaf.com/2016/07/intro-fastlane-automation-for-ios-and-android/)中说到：\n  > Fastlane 提供的流程的众多工具都是可以独立存在和使用（提供 cli 命令），也可以统一由 fastlane 来控制。它在使用中提出了两个概念：\n  >\n    - action: Fastlane 的插件，截至当前内置 165 个至多，不过每个动作的颗粒度大小不一。查看详情\n    - lane: Fastlane 的任务（或者可以理解为命令），一个可以包含多个 lanes，通过 fastlane cli 传入制定的 lane 来执行。\n\n  自我感觉这句话这个对理解和使用很重要！\n  \n\n# 配置\n  Fastlane已被Fabric收购，所以按照其安装也很随意([戳我配置](https://fabric.io/features/distribution))。\n  对于打包，\n  \n# 文章\n  - [深入浅出 Fastlane 一看你就懂](http://icyleaf.com/2016/07/fastlane-in-action/)\n  - [fir.im weekly - 「 持续集成 」实践教程合集](http://blog.fir.im/fir_im_weekly160505)\n  - [使用fastlane实现iOS持续集成](https://everettjf.github.io/2015/09/08/ios-ci-with-fastlane)\n  - [fastlane docs](https://docs.fastlane.tools)\n  - [fastlane GitHub](https://github.com/fastlane/fastlane)\n  - [Fastlane实战（一）：移动开发自动化之道](http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part01)\n  - [Fastlane实战（二）：Action和Plugin机制](http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part02)\n  - [Fastlane实战（三）：Fastlane在Android平台的应用](http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part03)\n  - [Fastlane实战（四）：自动化测试篇](http://www.infoq.com/cn/articles/fastlane-automatic-testing)\n  - [Fastlane实战（五）：高级用法](http://www.infoq.com/cn/articles/fastlane-pro-tips)\n  ","source":"_posts/fastlane-note.md","raw":"---\ntitle: Fastlane自动化笔记\ndate: 2017-01-04 18:14:07\ntags:\n  - Fastlane\n---\n\n之前在搭建Jenkins的时候，由于看到Fastlane的配置好复杂，那么多，而当时的需求就是自动打包。。所以没有用，现在想来好气！今天翻到InfoQ的一个文章，又详细的了解了Fastlane之后，觉得此大法甚好，解决很多痛点！决定搞通这一切！\n回看之前的[build-ipa-sh.md](https://madordie.github.io/2016/09/26/build-ipa-sh)确实比较僵硬。自动化还是很棒的。\n\n<!--more-->\n\n# 基本知识\n  ([@icyleaf](http://icyleaf.com))在[Fastlane - iOS 和 Android 的自动化构建工具](https://icyleaf.com/2016/07/intro-fastlane-automation-for-ios-and-android/)中说到：\n  > Fastlane 提供的流程的众多工具都是可以独立存在和使用（提供 cli 命令），也可以统一由 fastlane 来控制。它在使用中提出了两个概念：\n  >\n    - action: Fastlane 的插件，截至当前内置 165 个至多，不过每个动作的颗粒度大小不一。查看详情\n    - lane: Fastlane 的任务（或者可以理解为命令），一个可以包含多个 lanes，通过 fastlane cli 传入制定的 lane 来执行。\n\n  自我感觉这句话这个对理解和使用很重要！\n  \n\n# 配置\n  Fastlane已被Fabric收购，所以按照其安装也很随意([戳我配置](https://fabric.io/features/distribution))。\n  对于打包，\n  \n# 文章\n  - [深入浅出 Fastlane 一看你就懂](http://icyleaf.com/2016/07/fastlane-in-action/)\n  - [fir.im weekly - 「 持续集成 」实践教程合集](http://blog.fir.im/fir_im_weekly160505)\n  - [使用fastlane实现iOS持续集成](https://everettjf.github.io/2015/09/08/ios-ci-with-fastlane)\n  - [fastlane docs](https://docs.fastlane.tools)\n  - [fastlane GitHub](https://github.com/fastlane/fastlane)\n  - [Fastlane实战（一）：移动开发自动化之道](http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part01)\n  - [Fastlane实战（二）：Action和Plugin机制](http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part02)\n  - [Fastlane实战（三）：Fastlane在Android平台的应用](http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part03)\n  - [Fastlane实战（四）：自动化测试篇](http://www.infoq.com/cn/articles/fastlane-automatic-testing)\n  - [Fastlane实战（五）：高级用法](http://www.infoq.com/cn/articles/fastlane-pro-tips)\n  ","slug":"fastlane-note","published":1,"updated":"2017-04-08T06:41:38.000Z","_id":"cj18v0f9t000nl0uv3hz8iuhw","comments":1,"layout":"post","photos":[],"link":"","content":"<p>之前在搭建Jenkins的时候，由于看到Fastlane的配置好复杂，那么多，而当时的需求就是自动打包。。所以没有用，现在想来好气！今天翻到InfoQ的一个文章，又详细的了解了Fastlane之后，觉得此大法甚好，解决很多痛点！决定搞通这一切！<br>回看之前的<a href=\"https://madordie.github.io/2016/09/26/build-ipa-sh\">build-ipa-sh.md</a>确实比较僵硬。自动化还是很棒的。</p>\n<a id=\"more\"></a>\n<h1 id=\"基本知识\"><a href=\"#基本知识\" class=\"headerlink\" title=\"基本知识\"></a>基本知识</h1><p>  (<a href=\"http://icyleaf.com\" target=\"_blank\" rel=\"external\">@icyleaf</a>)在<a href=\"https://icyleaf.com/2016/07/intro-fastlane-automation-for-ios-and-android/\" target=\"_blank\" rel=\"external\">Fastlane - iOS 和 Android 的自动化构建工具</a>中说到：</p>\n<blockquote>\n<p>Fastlane 提供的流程的众多工具都是可以独立存在和使用（提供 cli 命令），也可以统一由 fastlane 来控制。它在使用中提出了两个概念：</p>\n<pre><code>- action: Fastlane 的插件，截至当前内置 165 个至多，不过每个动作的颗粒度大小不一。查看详情\n- lane: Fastlane 的任务（或者可以理解为命令），一个可以包含多个 lanes，通过 fastlane cli 传入制定的 lane 来执行。\n</code></pre></blockquote>\n<p>  自我感觉这句话这个对理解和使用很重要！</p>\n<h1 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h1><p>  Fastlane已被Fabric收购，所以按照其安装也很随意(<a href=\"https://fabric.io/features/distribution\" target=\"_blank\" rel=\"external\">戳我配置</a>)。<br>  对于打包，</p>\n<h1 id=\"文章\"><a href=\"#文章\" class=\"headerlink\" title=\"文章\"></a>文章</h1><ul>\n<li><a href=\"http://icyleaf.com/2016/07/fastlane-in-action/\" target=\"_blank\" rel=\"external\">深入浅出 Fastlane 一看你就懂</a></li>\n<li><a href=\"http://blog.fir.im/fir_im_weekly160505\" target=\"_blank\" rel=\"external\">fir.im weekly - 「 持续集成 」实践教程合集</a></li>\n<li><a href=\"https://everettjf.github.io/2015/09/08/ios-ci-with-fastlane\" target=\"_blank\" rel=\"external\">使用fastlane实现iOS持续集成</a></li>\n<li><a href=\"https://docs.fastlane.tools\" target=\"_blank\" rel=\"external\">fastlane docs</a></li>\n<li><a href=\"https://github.com/fastlane/fastlane\" target=\"_blank\" rel=\"external\">fastlane GitHub</a></li>\n<li><a href=\"http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part01\" target=\"_blank\" rel=\"external\">Fastlane实战（一）：移动开发自动化之道</a></li>\n<li><a href=\"http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part02\" target=\"_blank\" rel=\"external\">Fastlane实战（二）：Action和Plugin机制</a></li>\n<li><a href=\"http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part03\" target=\"_blank\" rel=\"external\">Fastlane实战（三）：Fastlane在Android平台的应用</a></li>\n<li><a href=\"http://www.infoq.com/cn/articles/fastlane-automatic-testing\" target=\"_blank\" rel=\"external\">Fastlane实战（四）：自动化测试篇</a></li>\n<li><a href=\"http://www.infoq.com/cn/articles/fastlane-pro-tips\" target=\"_blank\" rel=\"external\">Fastlane实战（五）：高级用法</a></li>\n</ul>\n","excerpt":"<p>之前在搭建Jenkins的时候，由于看到Fastlane的配置好复杂，那么多，而当时的需求就是自动打包。。所以没有用，现在想来好气！今天翻到InfoQ的一个文章，又详细的了解了Fastlane之后，觉得此大法甚好，解决很多痛点！决定搞通这一切！<br>回看之前的<a href=\"https://madordie.github.io/2016/09/26/build-ipa-sh\">build-ipa-sh.md</a>确实比较僵硬。自动化还是很棒的。</p>","more":"<h1 id=\"基本知识\"><a href=\"#基本知识\" class=\"headerlink\" title=\"基本知识\"></a>基本知识</h1><p>  (<a href=\"http://icyleaf.com\">@icyleaf</a>)在<a href=\"https://icyleaf.com/2016/07/intro-fastlane-automation-for-ios-and-android/\">Fastlane - iOS 和 Android 的自动化构建工具</a>中说到：</p>\n<blockquote>\n<p>Fastlane 提供的流程的众多工具都是可以独立存在和使用（提供 cli 命令），也可以统一由 fastlane 来控制。它在使用中提出了两个概念：</p>\n<pre><code>- action: Fastlane 的插件，截至当前内置 165 个至多，不过每个动作的颗粒度大小不一。查看详情\n- lane: Fastlane 的任务（或者可以理解为命令），一个可以包含多个 lanes，通过 fastlane cli 传入制定的 lane 来执行。\n</code></pre></blockquote>\n<p>  自我感觉这句话这个对理解和使用很重要！</p>\n<h1 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h1><p>  Fastlane已被Fabric收购，所以按照其安装也很随意(<a href=\"https://fabric.io/features/distribution\">戳我配置</a>)。<br>  对于打包，</p>\n<h1 id=\"文章\"><a href=\"#文章\" class=\"headerlink\" title=\"文章\"></a>文章</h1><ul>\n<li><a href=\"http://icyleaf.com/2016/07/fastlane-in-action/\">深入浅出 Fastlane 一看你就懂</a></li>\n<li><a href=\"http://blog.fir.im/fir_im_weekly160505\">fir.im weekly - 「 持续集成 」实践教程合集</a></li>\n<li><a href=\"https://everettjf.github.io/2015/09/08/ios-ci-with-fastlane\">使用fastlane实现iOS持续集成</a></li>\n<li><a href=\"https://docs.fastlane.tools\">fastlane docs</a></li>\n<li><a href=\"https://github.com/fastlane/fastlane\">fastlane GitHub</a></li>\n<li><a href=\"http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part01\">Fastlane实战（一）：移动开发自动化之道</a></li>\n<li><a href=\"http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part02\">Fastlane实战（二）：Action和Plugin机制</a></li>\n<li><a href=\"http://www.infoq.com/cn/articles/actual-combat-of-fastlane-part03\">Fastlane实战（三）：Fastlane在Android平台的应用</a></li>\n<li><a href=\"http://www.infoq.com/cn/articles/fastlane-automatic-testing\">Fastlane实战（四）：自动化测试篇</a></li>\n<li><a href=\"http://www.infoq.com/cn/articles/fastlane-pro-tips\">Fastlane实战（五）：高级用法</a></li>\n</ul>"},{"title":"优雅的使用SwiftLint","date":"2016-12-23T03:59:57.000Z","_content":"\n接入了SwiftLine，修改2000+的warning、300+error的一点笔记心得。\n\n<!--more-->\n\n# SwiftLint\n\n  > ## [SwiftLint](https://github.com/realm/SwiftLint)\n  > A tool to enforce Swift style and conventions, loosely based on GitHub's Swift Style Guide.\n  SwiftLint hooks into Clang and SourceKit to use the AST representation of your source files for more accurate results.\n  SwiftLint 是一个用于强制检查 Swift 代码风格和规定的一个工具，基本上以 GitHub's Swift 代码风格指南为基础。\n  SwiftLint Hook 了 Clang 和 SourceKit 从而能够使用 AST 来表示源代码文件的更多精确结果。\n  \n## 对原有代码格式化\n\n### 自动格式化\n  ```bash\n  swiftlint autocorrect\n  ```\n\n### TrailingWhitespaceRule\n\n#### 现象\n  > xxx.swift:34: warning: Trailing Whitespace Violation: Lines should not have trailing whitespace. (trailing_whitespace)\n  \n  规则实现：[TrailingWhitespaceRule.swift](https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/TrailingWhitespaceRule.swift)\n  \n#### 原因\n  Xcode中的\"空白行\"。其实并不空白，含有空的字符。最明显的表现为git提交的时候会有明显的黄色警告。\n\n#### 解决办法\n  Xcode中有选项可以直接控制，具体路径为\n  ```\n  Xcode \n  -> Preferences\n  -> Text Editing\n  -> While editing\n  -> [V] Including whitespace-only lines\n  ```\n  \n### ColonRule\n\n#### 现象\n  > xxx.swift:13:71: warning: Colon Violation: Colons should be next to the identifier when specifying a type. (colon)\n  \n#### 原因\n  变量方法的 `: ` 的右边应该有一个空格才能识别出来，且左侧不能留空格。所以写代码的时候随手写上还是比较好的。。\n  栗子：\n  ```\n  //  OK:\n  var responseData: [String : Any]? = nil // 返回结果，请求之前为nil\n\n  //  warning: 第一个':'处左侧有空格\n  var responseData : [String : Any]? = nil // 返回结果，请求之前为nil\n  \n  //  warning: 第一个':'处右侧无空格\n  var responseData:[String : Any]? = nil // 返回结果，请求之前为nil\n  ```\n\n#### 解决办法\n  规范书写\n  \n### LineLengthRule\n\n#### 现象\n  > xxx.swift:90: warning: Line Length Violation: Line should be 100 characters or less: currently 101 characters (line_length)\n  \n#### 原因\n  行数超了呗。。\n  \n#### 解决办法\n  - 方法名字写的简单易懂\n  \n### ControlStatementRule\n\n#### 现象\n  > xxx.swift:169:21: warning: Control Statement Violation: if,for,while,do statements shouldn't wrap their conditionals in parentheses. (control_statement)\n  \n  规则实现[ControlStatementRule](https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/ControlStatementRule.swift)\n  \n#### 原因\n  swift中`if,for,while,do` 语句不应该用`()`\n\n\n### UnusedClosureParameterRule\n\n#### 现象\n  > xxx.swift:103:62: warning: Unused Closure Parameter Violation: Unused parameter \"response\" in a closure should be replaced with _. (unused_closure_parameter)\n\n  规则实现[UnusedClosureParameterRule](https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/UnusedClosureParameterRule.swift)\n\n#### 原因\n  `response` 没有使用，建议替换为 `_`。\n  \n### CyclomaticComplexityRule\n\n#### 现象\n  > xxx.swift:69:5: warning: Cyclomatic Complexity Violation: Function should have complexity 10 or less: currently complexity equals 14 (cyclomatic_complexity)\n  \n  规则实现[CyclomaticComplexityRule](https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/CyclomaticComplexityRule.swift)\n\n#### 原因\n  😂，他说你这函数写的太复杂了。看实现是说不能有过多的`if {}`\n  \n\n### OpeningBraceRule\n\n#### 现象\n  > xxx.swift:221:34: warning: Opening Brace Spacing Violation: Opening braces should be preceded by a single space and on the same line as the declaration. (opening_brace)\n  \n  规则实现[OpeningBraceRule](https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/OpeningBraceRule.swift)\n  \n#### 解决\n  `{}`的前面要有空格隔开\n","source":"_posts/elegant-to-use-swiftlint.md","raw":"---\ntitle: 优雅的使用SwiftLint\ndate: 2016-12-23 11:59:57\ntags:\n---\n\n接入了SwiftLine，修改2000+的warning、300+error的一点笔记心得。\n\n<!--more-->\n\n# SwiftLint\n\n  > ## [SwiftLint](https://github.com/realm/SwiftLint)\n  > A tool to enforce Swift style and conventions, loosely based on GitHub's Swift Style Guide.\n  SwiftLint hooks into Clang and SourceKit to use the AST representation of your source files for more accurate results.\n  SwiftLint 是一个用于强制检查 Swift 代码风格和规定的一个工具，基本上以 GitHub's Swift 代码风格指南为基础。\n  SwiftLint Hook 了 Clang 和 SourceKit 从而能够使用 AST 来表示源代码文件的更多精确结果。\n  \n## 对原有代码格式化\n\n### 自动格式化\n  ```bash\n  swiftlint autocorrect\n  ```\n\n### TrailingWhitespaceRule\n\n#### 现象\n  > xxx.swift:34: warning: Trailing Whitespace Violation: Lines should not have trailing whitespace. (trailing_whitespace)\n  \n  规则实现：[TrailingWhitespaceRule.swift](https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/TrailingWhitespaceRule.swift)\n  \n#### 原因\n  Xcode中的\"空白行\"。其实并不空白，含有空的字符。最明显的表现为git提交的时候会有明显的黄色警告。\n\n#### 解决办法\n  Xcode中有选项可以直接控制，具体路径为\n  ```\n  Xcode \n  -> Preferences\n  -> Text Editing\n  -> While editing\n  -> [V] Including whitespace-only lines\n  ```\n  \n### ColonRule\n\n#### 现象\n  > xxx.swift:13:71: warning: Colon Violation: Colons should be next to the identifier when specifying a type. (colon)\n  \n#### 原因\n  变量方法的 `: ` 的右边应该有一个空格才能识别出来，且左侧不能留空格。所以写代码的时候随手写上还是比较好的。。\n  栗子：\n  ```\n  //  OK:\n  var responseData: [String : Any]? = nil // 返回结果，请求之前为nil\n\n  //  warning: 第一个':'处左侧有空格\n  var responseData : [String : Any]? = nil // 返回结果，请求之前为nil\n  \n  //  warning: 第一个':'处右侧无空格\n  var responseData:[String : Any]? = nil // 返回结果，请求之前为nil\n  ```\n\n#### 解决办法\n  规范书写\n  \n### LineLengthRule\n\n#### 现象\n  > xxx.swift:90: warning: Line Length Violation: Line should be 100 characters or less: currently 101 characters (line_length)\n  \n#### 原因\n  行数超了呗。。\n  \n#### 解决办法\n  - 方法名字写的简单易懂\n  \n### ControlStatementRule\n\n#### 现象\n  > xxx.swift:169:21: warning: Control Statement Violation: if,for,while,do statements shouldn't wrap their conditionals in parentheses. (control_statement)\n  \n  规则实现[ControlStatementRule](https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/ControlStatementRule.swift)\n  \n#### 原因\n  swift中`if,for,while,do` 语句不应该用`()`\n\n\n### UnusedClosureParameterRule\n\n#### 现象\n  > xxx.swift:103:62: warning: Unused Closure Parameter Violation: Unused parameter \"response\" in a closure should be replaced with _. (unused_closure_parameter)\n\n  规则实现[UnusedClosureParameterRule](https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/UnusedClosureParameterRule.swift)\n\n#### 原因\n  `response` 没有使用，建议替换为 `_`。\n  \n### CyclomaticComplexityRule\n\n#### 现象\n  > xxx.swift:69:5: warning: Cyclomatic Complexity Violation: Function should have complexity 10 or less: currently complexity equals 14 (cyclomatic_complexity)\n  \n  规则实现[CyclomaticComplexityRule](https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/CyclomaticComplexityRule.swift)\n\n#### 原因\n  😂，他说你这函数写的太复杂了。看实现是说不能有过多的`if {}`\n  \n\n### OpeningBraceRule\n\n#### 现象\n  > xxx.swift:221:34: warning: Opening Brace Spacing Violation: Opening braces should be preceded by a single space and on the same line as the declaration. (opening_brace)\n  \n  规则实现[OpeningBraceRule](https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/OpeningBraceRule.swift)\n  \n#### 解决\n  `{}`的前面要有空格隔开\n","slug":"elegant-to-use-swiftlint","published":1,"updated":"2017-02-07T06:36:21.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0f9w000pl0uv3xzise9c","content":"<p>接入了SwiftLine，修改2000+的warning、300+error的一点笔记心得。</p>\n<a id=\"more\"></a>\n<h1 id=\"SwiftLint\"><a href=\"#SwiftLint\" class=\"headerlink\" title=\"SwiftLint\"></a>SwiftLint</h1><blockquote>\n<h2 id=\"SwiftLint-1\"><a href=\"#SwiftLint-1\" class=\"headerlink\" title=\"SwiftLint\"></a><a href=\"https://github.com/realm/SwiftLint\" target=\"_blank\" rel=\"external\">SwiftLint</a></h2><p>A tool to enforce Swift style and conventions, loosely based on GitHub’s Swift Style Guide.<br>  SwiftLint hooks into Clang and SourceKit to use the AST representation of your source files for more accurate results.<br>  SwiftLint 是一个用于强制检查 Swift 代码风格和规定的一个工具，基本上以 GitHub’s Swift 代码风格指南为基础。<br>  SwiftLint Hook 了 Clang 和 SourceKit 从而能够使用 AST 来表示源代码文件的更多精确结果。</p>\n</blockquote>\n<h2 id=\"对原有代码格式化\"><a href=\"#对原有代码格式化\" class=\"headerlink\" title=\"对原有代码格式化\"></a>对原有代码格式化</h2><h3 id=\"自动格式化\"><a href=\"#自动格式化\" class=\"headerlink\" title=\"自动格式化\"></a>自动格式化</h3>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">swiftlint autocorrect</div></pre></td></tr></table></figure>\n<h3 id=\"TrailingWhitespaceRule\"><a href=\"#TrailingWhitespaceRule\" class=\"headerlink\" title=\"TrailingWhitespaceRule\"></a>TrailingWhitespaceRule</h3><h4 id=\"现象\"><a href=\"#现象\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:34: warning: Trailing Whitespace Violation: Lines should not have trailing whitespace. (trailing_whitespace)</p>\n</blockquote>\n<p>  规则实现：<a href=\"https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/TrailingWhitespaceRule.swift\" target=\"_blank\" rel=\"external\">TrailingWhitespaceRule.swift</a></p>\n<h4 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  Xcode中的”空白行”。其实并不空白，含有空的字符。最明显的表现为git提交的时候会有明显的黄色警告。</p>\n<h4 id=\"解决办法\"><a href=\"#解决办法\" class=\"headerlink\" title=\"解决办法\"></a>解决办法</h4><p>  Xcode中有选项可以直接控制，具体路径为<br>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">Xcode </div><div class=\"line\">-&gt; Preferences</div><div class=\"line\">-&gt; Text Editing</div><div class=\"line\">-&gt; While editing</div><div class=\"line\">-&gt; [V] Including whitespace-only lines</div></pre></td></tr></table></figure></p>\n<h3 id=\"ColonRule\"><a href=\"#ColonRule\" class=\"headerlink\" title=\"ColonRule\"></a>ColonRule</h3><h4 id=\"现象-1\"><a href=\"#现象-1\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:13:71: warning: Colon Violation: Colons should be next to the identifier when specifying a type. (colon)</p>\n</blockquote>\n<h4 id=\"原因-1\"><a href=\"#原因-1\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  变量方法的 <code>:</code> 的右边应该有一个空格才能识别出来，且左侧不能留空格。所以写代码的时候随手写上还是比较好的。。<br>  栗子：<br>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">//  OK:</div><div class=\"line\">var responseData: [String : Any]? = nil // 返回结果，请求之前为nil</div><div class=\"line\"></div><div class=\"line\">//  warning: 第一个&apos;:&apos;处左侧有空格</div><div class=\"line\">var responseData : [String : Any]? = nil // 返回结果，请求之前为nil</div><div class=\"line\"></div><div class=\"line\">//  warning: 第一个&apos;:&apos;处右侧无空格</div><div class=\"line\">var responseData:[String : Any]? = nil // 返回结果，请求之前为nil</div></pre></td></tr></table></figure></p>\n<h4 id=\"解决办法-1\"><a href=\"#解决办法-1\" class=\"headerlink\" title=\"解决办法\"></a>解决办法</h4><p>  规范书写</p>\n<h3 id=\"LineLengthRule\"><a href=\"#LineLengthRule\" class=\"headerlink\" title=\"LineLengthRule\"></a>LineLengthRule</h3><h4 id=\"现象-2\"><a href=\"#现象-2\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:90: warning: Line Length Violation: Line should be 100 characters or less: currently 101 characters (line_length)</p>\n</blockquote>\n<h4 id=\"原因-2\"><a href=\"#原因-2\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  行数超了呗。。</p>\n<h4 id=\"解决办法-2\"><a href=\"#解决办法-2\" class=\"headerlink\" title=\"解决办法\"></a>解决办法</h4><ul>\n<li>方法名字写的简单易懂</li>\n</ul>\n<h3 id=\"ControlStatementRule\"><a href=\"#ControlStatementRule\" class=\"headerlink\" title=\"ControlStatementRule\"></a>ControlStatementRule</h3><h4 id=\"现象-3\"><a href=\"#现象-3\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:169:21: warning: Control Statement Violation: if,for,while,do statements shouldn’t wrap their conditionals in parentheses. (control_statement)</p>\n</blockquote>\n<p>  规则实现<a href=\"https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/ControlStatementRule.swift\" target=\"_blank\" rel=\"external\">ControlStatementRule</a></p>\n<h4 id=\"原因-3\"><a href=\"#原因-3\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  swift中<code>if,for,while,do</code> 语句不应该用<code>()</code></p>\n<h3 id=\"UnusedClosureParameterRule\"><a href=\"#UnusedClosureParameterRule\" class=\"headerlink\" title=\"UnusedClosureParameterRule\"></a>UnusedClosureParameterRule</h3><h4 id=\"现象-4\"><a href=\"#现象-4\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:103:62: warning: Unused Closure Parameter Violation: Unused parameter “response” in a closure should be replaced with _. (unused_closure_parameter)</p>\n</blockquote>\n<p>  规则实现<a href=\"https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/UnusedClosureParameterRule.swift\" target=\"_blank\" rel=\"external\">UnusedClosureParameterRule</a></p>\n<h4 id=\"原因-4\"><a href=\"#原因-4\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  <code>response</code> 没有使用，建议替换为 <code>_</code>。</p>\n<h3 id=\"CyclomaticComplexityRule\"><a href=\"#CyclomaticComplexityRule\" class=\"headerlink\" title=\"CyclomaticComplexityRule\"></a>CyclomaticComplexityRule</h3><h4 id=\"现象-5\"><a href=\"#现象-5\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:69:5: warning: Cyclomatic Complexity Violation: Function should have complexity 10 or less: currently complexity equals 14 (cyclomatic_complexity)</p>\n</blockquote>\n<p>  规则实现<a href=\"https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/CyclomaticComplexityRule.swift\" target=\"_blank\" rel=\"external\">CyclomaticComplexityRule</a></p>\n<h4 id=\"原因-5\"><a href=\"#原因-5\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  😂，他说你这函数写的太复杂了。看实现是说不能有过多的<code>if {}</code></p>\n<h3 id=\"OpeningBraceRule\"><a href=\"#OpeningBraceRule\" class=\"headerlink\" title=\"OpeningBraceRule\"></a>OpeningBraceRule</h3><h4 id=\"现象-6\"><a href=\"#现象-6\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:221:34: warning: Opening Brace Spacing Violation: Opening braces should be preceded by a single space and on the same line as the declaration. (opening_brace)</p>\n</blockquote>\n<p>  规则实现<a href=\"https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/OpeningBraceRule.swift\" target=\"_blank\" rel=\"external\">OpeningBraceRule</a></p>\n<h4 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h4><p>  <code>{}</code>的前面要有空格隔开</p>\n","excerpt":"<p>接入了SwiftLine，修改2000+的warning、300+error的一点笔记心得。</p>","more":"<h1 id=\"SwiftLint\"><a href=\"#SwiftLint\" class=\"headerlink\" title=\"SwiftLint\"></a>SwiftLint</h1><blockquote>\n<h2 id=\"SwiftLint-1\"><a href=\"#SwiftLint-1\" class=\"headerlink\" title=\"SwiftLint\"></a><a href=\"https://github.com/realm/SwiftLint\">SwiftLint</a></h2><p>A tool to enforce Swift style and conventions, loosely based on GitHub’s Swift Style Guide.<br>  SwiftLint hooks into Clang and SourceKit to use the AST representation of your source files for more accurate results.<br>  SwiftLint 是一个用于强制检查 Swift 代码风格和规定的一个工具，基本上以 GitHub’s Swift 代码风格指南为基础。<br>  SwiftLint Hook 了 Clang 和 SourceKit 从而能够使用 AST 来表示源代码文件的更多精确结果。</p>\n</blockquote>\n<h2 id=\"对原有代码格式化\"><a href=\"#对原有代码格式化\" class=\"headerlink\" title=\"对原有代码格式化\"></a>对原有代码格式化</h2><h3 id=\"自动格式化\"><a href=\"#自动格式化\" class=\"headerlink\" title=\"自动格式化\"></a>自动格式化</h3>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">swiftlint autocorrect</div></pre></td></tr></table></figure>\n<h3 id=\"TrailingWhitespaceRule\"><a href=\"#TrailingWhitespaceRule\" class=\"headerlink\" title=\"TrailingWhitespaceRule\"></a>TrailingWhitespaceRule</h3><h4 id=\"现象\"><a href=\"#现象\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:34: warning: Trailing Whitespace Violation: Lines should not have trailing whitespace. (trailing_whitespace)</p>\n</blockquote>\n<p>  规则实现：<a href=\"https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/TrailingWhitespaceRule.swift\">TrailingWhitespaceRule.swift</a></p>\n<h4 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  Xcode中的”空白行”。其实并不空白，含有空的字符。最明显的表现为git提交的时候会有明显的黄色警告。</p>\n<h4 id=\"解决办法\"><a href=\"#解决办法\" class=\"headerlink\" title=\"解决办法\"></a>解决办法</h4><p>  Xcode中有选项可以直接控制，具体路径为<br>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">Xcode </div><div class=\"line\">-&gt; Preferences</div><div class=\"line\">-&gt; Text Editing</div><div class=\"line\">-&gt; While editing</div><div class=\"line\">-&gt; [V] Including whitespace-only lines</div></pre></td></tr></table></figure></p>\n<h3 id=\"ColonRule\"><a href=\"#ColonRule\" class=\"headerlink\" title=\"ColonRule\"></a>ColonRule</h3><h4 id=\"现象-1\"><a href=\"#现象-1\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:13:71: warning: Colon Violation: Colons should be next to the identifier when specifying a type. (colon)</p>\n</blockquote>\n<h4 id=\"原因-1\"><a href=\"#原因-1\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  变量方法的 <code>:</code> 的右边应该有一个空格才能识别出来，且左侧不能留空格。所以写代码的时候随手写上还是比较好的。。<br>  栗子：<br>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">//  OK:</div><div class=\"line\">var responseData: [String : Any]? = nil // 返回结果，请求之前为nil</div><div class=\"line\"></div><div class=\"line\">//  warning: 第一个&apos;:&apos;处左侧有空格</div><div class=\"line\">var responseData : [String : Any]? = nil // 返回结果，请求之前为nil</div><div class=\"line\"></div><div class=\"line\">//  warning: 第一个&apos;:&apos;处右侧无空格</div><div class=\"line\">var responseData:[String : Any]? = nil // 返回结果，请求之前为nil</div></pre></td></tr></table></figure></p>\n<h4 id=\"解决办法-1\"><a href=\"#解决办法-1\" class=\"headerlink\" title=\"解决办法\"></a>解决办法</h4><p>  规范书写</p>\n<h3 id=\"LineLengthRule\"><a href=\"#LineLengthRule\" class=\"headerlink\" title=\"LineLengthRule\"></a>LineLengthRule</h3><h4 id=\"现象-2\"><a href=\"#现象-2\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:90: warning: Line Length Violation: Line should be 100 characters or less: currently 101 characters (line_length)</p>\n</blockquote>\n<h4 id=\"原因-2\"><a href=\"#原因-2\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  行数超了呗。。</p>\n<h4 id=\"解决办法-2\"><a href=\"#解决办法-2\" class=\"headerlink\" title=\"解决办法\"></a>解决办法</h4><ul>\n<li>方法名字写的简单易懂</li>\n</ul>\n<h3 id=\"ControlStatementRule\"><a href=\"#ControlStatementRule\" class=\"headerlink\" title=\"ControlStatementRule\"></a>ControlStatementRule</h3><h4 id=\"现象-3\"><a href=\"#现象-3\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:169:21: warning: Control Statement Violation: if,for,while,do statements shouldn’t wrap their conditionals in parentheses. (control_statement)</p>\n</blockquote>\n<p>  规则实现<a href=\"https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/ControlStatementRule.swift\">ControlStatementRule</a></p>\n<h4 id=\"原因-3\"><a href=\"#原因-3\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  swift中<code>if,for,while,do</code> 语句不应该用<code>()</code></p>\n<h3 id=\"UnusedClosureParameterRule\"><a href=\"#UnusedClosureParameterRule\" class=\"headerlink\" title=\"UnusedClosureParameterRule\"></a>UnusedClosureParameterRule</h3><h4 id=\"现象-4\"><a href=\"#现象-4\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:103:62: warning: Unused Closure Parameter Violation: Unused parameter “response” in a closure should be replaced with _. (unused_closure_parameter)</p>\n</blockquote>\n<p>  规则实现<a href=\"https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/UnusedClosureParameterRule.swift\">UnusedClosureParameterRule</a></p>\n<h4 id=\"原因-4\"><a href=\"#原因-4\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  <code>response</code> 没有使用，建议替换为 <code>_</code>。</p>\n<h3 id=\"CyclomaticComplexityRule\"><a href=\"#CyclomaticComplexityRule\" class=\"headerlink\" title=\"CyclomaticComplexityRule\"></a>CyclomaticComplexityRule</h3><h4 id=\"现象-5\"><a href=\"#现象-5\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:69:5: warning: Cyclomatic Complexity Violation: Function should have complexity 10 or less: currently complexity equals 14 (cyclomatic_complexity)</p>\n</blockquote>\n<p>  规则实现<a href=\"https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/CyclomaticComplexityRule.swift\">CyclomaticComplexityRule</a></p>\n<h4 id=\"原因-5\"><a href=\"#原因-5\" class=\"headerlink\" title=\"原因\"></a>原因</h4><p>  😂，他说你这函数写的太复杂了。看实现是说不能有过多的<code>if {}</code></p>\n<h3 id=\"OpeningBraceRule\"><a href=\"#OpeningBraceRule\" class=\"headerlink\" title=\"OpeningBraceRule\"></a>OpeningBraceRule</h3><h4 id=\"现象-6\"><a href=\"#现象-6\" class=\"headerlink\" title=\"现象\"></a>现象</h4><blockquote>\n<p>xxx.swift:221:34: warning: Opening Brace Spacing Violation: Opening braces should be preceded by a single space and on the same line as the declaration. (opening_brace)</p>\n</blockquote>\n<p>  规则实现<a href=\"https://github.com/realm/SwiftLint/blob/master/Source/SwiftLintFramework/Rules/OpeningBraceRule.swift\">OpeningBraceRule</a></p>\n<h4 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h4><p>  <code>{}</code>的前面要有空格隔开</p>"},{"title":"RxSwift语法笔记","date":"2017-04-08T06:03:18.000Z","_content":"\n记录RxSwift在使用过程中的一些常用语法。\n\n<!--more-->\n\n## 说明\n按照[RxSwift 入坑手册 Part0 - 基础概念](https://blog.callmewhy.com/2015/09/21/rxswift-getting-started-0/)格式进行补充。\n\n\n## SupportCode\n在进入正题之前，先看下项目里的 `SupportCode.swift` ，主要为 `playground` 提供了两个便利函数。\n\n一个是 `example` 函数，专门用来写示例代码的，统一输出 log 便于标记浏览，同时还能保持变量不污染全局：\n\n```swift\npublic func example(description: String, action: () -> ()) {\n    print(\"\\n--- \\(description) example ---\")\n    action()\n}\n```\n\n另一个是 `delay` 函数，通过 `dispatch_after` 用来演示延时的：\n\n```swift\npublic func delay(delay:Double, closure:()->()) {\n    dispatch_after(\n        dispatch_time(\n            DISPATCH_TIME_NOW,\n            Int64(delay * Double(NSEC_PER_SEC))\n        ),\n        dispatch_get_main_queue(), closure)\n}\n```\n\n## Introduction\n\n主要介绍了 Rx 的基础： `Observable` 。 `Observable<Element>` 是观察者模式中被观察的对象，相当于一个事件序列 (`GeneratorType`) ，会向订阅者发送新产生的事件信息。事件信息分为三种：\n\n - Next(value) 表示新的事件数据。\n - Completed 表示事件序列的完结。\n - Error 同样表示完结，但是代表异常导致的完结。\n（打个岔：协议命名，想起来上午汤哥在微博说的一段话：\n\n> 另外，我觉得 protocol 名字用形容词会更加语义分明，比如 Swift : Flyable, Killable, Visible。全用名词的话显得比较生硬，比如 Swift : Head, Wings, Ass。\n\n### empty\n\n`empty` 是一个空的序列，它只发送 `.Completed` 消息。\n\n```swift\nexample(\"empty\") {\n    let emptySequence: Observable<Int> = empty()\n    let subscription = emptySequence\n        .subscribe { event in\n            print(event)\n        }\n}\n--- empty example ---\nCompleted\n```\n\n\n### never\n\n`never` 是没有任何元素、也不会发送任何事件的空序列。\n\n```swift\nexample(\"never\") {\n    let neverSequence: Observable<String> = never()\n    let subscription = neverSequence\n        .subscribe { _ in\n            print(\"This block is never called.\")\n        }\n}\n\n--- never example ---\n```\n### just\n\n`just` 是只包含一个元素的序列，它会先发送 `.Next(value)` ，然后发送 `.Completed` 。\n\n```swift\nexample(\"just\") {\n    let singleElementSequence = just(32)\n    let subscription = singleElementSequence\n        .subscribe { event in\n            print(event)\n        }\n}\n--- just example ---\nNext(32)\nCompleted\nsequenceOf\n```\n\n`sequenceOf` 可以把一系列元素转换成事件序列。\n\n```swift\nexample(\"sequenceOf\") {\n    let sequenceOfElements/* : Observable<Int> */ = sequenceOf(0, 1, 2, 3)\n    let subscription = sequenceOfElements\n        .subscribe { event in\n            print(event)\n        }\n}\n--- sequenceOf example ---\nNext(0)\nNext(1)\nNext(2)\nNext(3)\nCompleted\nfrom\n```\n\n`from` 是通过 `asObservable()` 方法把 Swift 中的序列 (`SequenceType`) 转换成事件序列。\n\n```swift\nexample(\"from\") {\n    let sequenceFromArray = [1, 2, 3, 4, 5].asObservable()\n    let subscription = sequenceFromArray\n        .subscribe { event in\n            print(event)\n        }\n}\n--- from example ---\nNext(1)\nNext(2)\nNext(3)\nNext(4)\nNext(5)\nCompleted\n```\n\n### create\n\n`create` 可以通过闭包创建序列，通过 `.on(e: Event)` 添加事件。\n\n```swift\nexample(\"create\") {\n    let myJust = { (singleElement: Int) -> Observable<Int> in\n        return create { observer in\n            observer.on(.Next(singleElement))\n            observer.on(.Completed)\n            return NopDisposable.instance\n        }\n    }\n    let subscription = myJust(5)\n        .subscribe { event in\n            print(event)\n        }\n}\n--- create example ---\nNext(5)\nCompleted\n```\n\n### failWith\n\n`failWith` 创建一个没有元素的序列，只会发送失败 (`.Error`) 事件。\n\n```swift\nexample(\"failWith\") {\n    let error = NSError(domain: \"Test\", code: -1, userInfo: nil)\n    let erroredSequence: Observable<Int> = failWith(error)\n    let subscription = erroredSequence\n        .subscribe { event in\n            print(event)\n        }\n}\n--- failWith example ---\nError(Error Domain=Test Code=-1 \"The operation couldn’t be completed. (Test error -1.)\")\n```\n\n### deferred\n\n`deferred` 会等到有订阅者的时候再通过工厂方法创建 `Observable` 对象，每个订阅者订阅的对象都是内容相同而完全独立的序列。\n\n```swift\nexample(\"deferred\") {\n    let deferredSequence: Observable<Int> = deferred {\n        print(\"creating\")\n        return create { observer in\n            print(\"emmiting\")\n            observer.on(.Next(0))\n            observer.on(.Next(1))\n            observer.on(.Next(2))\n            return NopDisposable.instance\n        }\n    }\n    print(\"go\")\n    deferredSequence\n        .subscribe { event in\n            print(event)\n    }\n    deferredSequence\n        .subscribe { event in\n            print(event)\n        }\n}\n--- deferred example ---\ngo\ncreating\nemmiting\nNext(0)\nNext(1)\nNext(2)\ncreating\nemmiting\nNext(0)\nNext(1)\nNext(2)\n```\n\n为什么需要 `defferd` 这样一个奇怪的家伙呢？其实这相当于是一种延时加载，因为在添加监听的时候数据未必加载完毕，例如下面这个例子：\n\n```swift\nexample(\"TestDeferred\") {\n    var value: String? = nil\n    var subscription: Observable<String?> = just(value)\n    // got value\n    value = \"Hello!\"\n    subscription.subscribe { event in\n        print(event)\n    }\n}\n--- TestDeferred example ---\nNext(nil)\nCompleted\n```\n\n如果使用 `deffered` 则可以正常显示想要的数据：\n\n```swift\nexample(\"TestDeferred\") {\n    var value: String? = nil\n    var subscription: Observable<String?> = deferred {\n        return just(value)\n    }\n    // got value\n    value = \"Hello!\"\n    subscription.subscribe { event in\n        print(event)\n    }\n}\n--- TestDeferred example ---\nNext(Optional(\"Hello!\"))\nCompleted\n```\n\n## Subjects\n\n接下来是关于 `Subject` 的内容。 `Subject` 可以看做是一种代理和桥梁。它既是订阅者又是订阅源，这意味着它既可以订阅其他 `Observable` 对象，同时又可以对它的订阅者们发送事件。\n\n如果把 `Observable` 理解成不断输出事件的水管，那 `Subject` 就是套在上面的水龙头。它既怼着一根不断出水的水管，同时也向外面输送着新鲜水源。如果你直接用水杯接着水管的水，那可能导出来什么王水胶水完全把持不住；如果你在水龙头下面接着水，那你可以随心所欲的调成你想要的水速和水温。\n\n（好吧上面一段文档里没有，是我瞎掰的，如果理解错了还望打脸(￣ε(#￣)☆╰╮(￣▽￣///))\n\n在开始下面的代码之前，先定义一个辅助函数用于输出数据：\n\n```swift\nfunc writeSequenceToConsole<O: ObservableType>(name: String, sequence: O) {\n    sequence\n        .subscribe { e in\n            print(\"Subscription: \\(name), event: \\(e)\")\n        }\n}\n```\n\n### PublishSubject\n\n`PublishSubject` 会发送订阅者从订阅之后的事件序列。\n\n```swift\nexample(\"PublishSubject\") {\n    let subject = PublishSubject<String>()\n    writeSequenceToConsole(\"1\", sequence: subject)\n    subject.on(.Next(\"a\"))\n    subject.on(.Next(\"b\"))\n    writeSequenceToConsole(\"2\", sequence: subject)\n    subject.on(.Next(\"c\"))\n    subject.on(.Next(\"d\"))\n}\n--- PublishSubject example ---\nSubscription: 1, event: Next(a)\nSubscription: 1, event: Next(b)\nSubscription: 1, event: Next(c)\nSubscription: 2, event: Next(c)\nSubscription: 1, event: Next(d)\nSubscription: 2, event: Next(d)\n```\n\n### ReplaySubject\n\n`ReplaySubject` 在新的订阅对象订阅的时候会补发所有已经发送过的数据队列， `bufferSize` 是缓冲区的大小，决定了补发队列的最大值。如果 `bufferSize` 是1，那么新的订阅者出现的时候就会补发上一个事件，如果是2，则补两个，以此类推。\n\n```swift\nexample(\"ReplaySubject\") {\n    let subject = ReplaySubject<String>.create(bufferSize: 1)\n    writeSequenceToConsole(\"1\", sequence: subject)\n    subject.on(.Next(\"a\"))\n    subject.on(.Next(\"b\"))\n    writeSequenceToConsole(\"2\", sequence: subject)\n    subject.on(.Next(\"c\"))\n    subject.on(.Next(\"d\"))\n}\n--- ReplaySubject example ---\nSubscription: 1, event: Next(a)\nSubscription: 1, event: Next(b)\nSubscription: 2, event: Next(b) // 补了一个 b\nSubscription: 1, event: Next(c)\nSubscription: 2, event: Next(c)\nSubscription: 1, event: Next(d)\nSubscription: 2, event: Next(d)\n```\n\n### BehaviorSubject\n\n`BehaviorSubject` 在新的订阅对象订阅的时候会发送最近发送的事件，如果没有则发送一个默认值。\n\n```swift\nexample(\"BehaviorSubject\") {\n    let subject = BehaviorSubject(value: \"z\")\n    writeSequenceToConsole(\"1\", sequence: subject)\n    subject.on(.Next(\"a\"))\n    subject.on(.Next(\"b\"))\n    writeSequenceToConsole(\"2\", sequence: subject)\n    subject.on(.Next(\"c\"))\n    subject.on(.Completed)\n}\n--- BehaviorSubject example ---\nSubscription: 1, event: Next(z)\nSubscription: 1, event: Next(a)\nSubscription: 1, event: Next(b)\nSubscription: 2, event: Next(b)\nSubscription: 1, event: Next(c)\nSubscription: 2, event: Next(c)\nSubscription: 1, event: Completed\nSubscription: 2, event: Completed\n```\n\n### Variable\n\n`Variable` 是基于 `BehaviorSubject` 的一层封装，它的优势是：不会被显式终结。即：不会收到 `.Completed` 和 `.Error` 这类的终结事件，它会主动在析构的时候发送 `.Complete` 。\n\n```swift\nexample(\"Variable\") {\n    let variable = Variable(\"z\")\n    writeSequenceToConsole(\"1\", sequence: variable)\n    variable.value = \"a\"\n    variable.value = \"b\"\n    writeSequenceToConsole(\"2\", sequence: variable)\n    variable.value = \"c\"\n}\n--- Variable example ---\nSubscription: 1, event: Next(z)\nSubscription: 1, event: Next(a)\nSubscription: 1, event: Next(b)\nSubscription: 2, event: Next(b)\nSubscription: 1, event: Next(c)\nSubscription: 2, event: Next(c)\nSubscription: 1, event: Completed\nSubscription: 2, event: Completed\n```\n\n## Transform\n\n我们可以对序列做一些转换，类似于 `Swift` 中 `CollectionType` 的各种转换。在以前的坑中曾经提到过，可以参考：[函数式的函数](https://blog.callmewhy.com/2015/05/11/functional-reactive-programming-1/#函数式的函数/)。\n\n### map\n\n`map` 就是对每个元素都用函数做一次转换，挨个映射一遍。\n\n```swift\nexample(\"map\") {\n    let originalSequence = sequenceOf(1,2,3)\n    originalSequence\n        .map { $0 * 2 }\n        .subscribe { print($0) }\n}\n--- map example ---\nNext(2)\nNext(4)\nNext(6)\nCompleted\n```\n\n### flatMap\n\n`map` 在做转换的时候很容易出现『升维』的情况，即：转变之后，从一个序列变成了一个序列的序列。\n\n什么是『升维』？在集合中我们可以举这样一个例子，我有一个好友列表 `[p1, p2, p3]`，那么如果要获取我好友的好友的列表，可以这样做：\n\n```swift\nmyFriends.map { $0.getFriends() }\n```\n结果就成了 `[[p1-1, p1-2, p1-3], [p2-1], [p3-1, p3-2]]` ，这就成了好友的好友列表的列表了。这就是一个『升维』的例子。\n\n（以上内容文档中依旧没有，依旧是我瞎掰的，依旧欢迎有错误当面打脸(￣ε(#￣)☆╰╮(￣▽￣///))\n\n在 `Swift` 中，我们可以用 `flatMap` 过滤掉 `map` 之后的 `nil` 结果。在 `Rx` 中， `flatMap` 可以把一个序列转换成一组序列，然后再把这一组序列『拍扁』成一个序列。\n\n```swift\nexample(\"flatMap\") {\n    let sequenceInt = sequenceOf(1, 2, 3)\n    let sequenceString = sequenceOf(\"A\", \"B\", \"--\")\n    sequenceInt\n        .flatMap { int in\n            sequenceString\n        }\n        .subscribe {\n            print($0)\n        }\n}\n--- flatMap example ---\nNext(A)\nNext(B)\nNext(--)\nNext(A)\nNext(B)\nNext(--)\nNext(A)\nNext(B)\nNext(--)\nCompleted\n```\n\n### scan\n\n`scan` 有点像 `reduce` ，它会把每次的运算结果累积起来，作为下一次运算的输入值。\n\n```swift\nexample(\"scan\") {\n    let sequenceToSum = sequenceOf(0, 1, 2, 3, 4, 5)\n    sequenceToSum\n        .scan(0) { acum, elem in\n            acum + elem\n        }\n        .subscribe {\n            print($0)\n        }\n}\n--- scan example ---\nNext(0)\nNext(1)\nNext(3)\nNext(6)\nNext(10)\nNext(15)\nCompleted\n```\n\n## Filtering\n\n除了上面的各种转换，我们还可以对序列进行过滤。\n\n### filter\n\n`filter` 只会让符合条件的元素通过。\n\n```swift\nexample(\"filter\") {\n    let subscription = sequenceOf(0, 1, 2, 3, 4, 5, 6, 7, 8, 9)\n        .filter {\n            $0 % 2 == 0\n        }\n        .subscribe {\n            print($0)\n        }\n}\n--- filter example ---\nNext(0)\nNext(2)\nNext(4)\nNext(6)\nNext(8)\nCompleted\n```\n\n### distinctUntilChanged\n\n`distinctUntilChanged` 会废弃掉重复的事件。\n\n```swift\nexample(\"distinctUntilChanged\") {\n    let subscription = sequenceOf(1, 2, 3, 1, 1, 4)\n        .distinctUntilChanged()\n        .subscribe {\n            print($0)\n        }\n}\n--- distinctUntilChanged example ---\nNext(1)\nNext(2)\nNext(3)\nNext(1)\nNext(4)\nCompleted\n```\n\n### take\n\n`take` 只获取序列中的前 `n` 个事件，在满足数量之后会自动 `.Completed` 。\n\n```swift\nexample(\"take\") {\n    let subscription = sequenceOf(1, 2, 3, 4, 5, 6)\n        .take(3)\n        .subscribe {\n            print($0)\n        }\n}\n--- take example ---\nNext(1)\nNext(2)\nNext(3)\nCompleted\n```\n\n### throttle VS. debounce\n\n`throttle` 和 `debounce` 目的都是控制某个时间段内事件序列的速度。但是又有差别：\n\n- `debounce` : `空闲控制`  空闲时间必须 `>=` 固定的时间，事件序列才会被放行\n- `throttle` : `频率控制`  事件序列满足 `1/delay` 才会被放行\n\n一般的按钮点击、用户输入、等都属于频率控制，应该使用 `throttle` 。\n\n```swift\nlet searchResults = searchBar.rx.text.orEmpty\n    .throttle(0.3, scheduler: MainScheduler.instance)\n    .distinctUntilChanged()\n    .flatMapLatest { query -> Observable<[Repository]> in\n        if query.isEmpty {\n            return .just([])\n        }\n        return searchGitHub(query)\n            .catchErrorJustReturn([])\n    }\n    .observeOn(MainScheduler.instance)\n```\n\n## Combining\n\n这部分是关于序列的运算，可以将多个序列源进行组合拼装成一个新的事件序列。\n\n### startWith\n\n`startWith` 会在队列开始之前插入一个事件元素。\n\n```swift\nexample(\"startWith\") {\n    let subscription = sequenceOf(4, 5, 6)\n        .startWith(3)\n        .subscribe {\n            print($0)\n        }\n}\n--- startWith example ---\nNext(3)\nNext(4)\nNext(5)\nNext(6)\nCompleted\n```\n\n### combineLatest\n\n如果存在两条事件队列，需要同时监听，那么每当有新的事件发生的时候，`combineLatest` 会将每个队列的最新的一个元素进行合并。\n\n```swift\nexample(\"combineLatest 1\") {\n    let intOb1 = PublishSubject<String>()\n    let intOb2 = PublishSubject<Int>()\n    combineLatest(intOb1, intOb2) {\n        \"\\($0) \\($1)\"\n        }\n        .subscribe {\n            print($0)\n        }\n    intOb1.on(.Next(\"A\"))\n    intOb2.on(.Next(1))\n    intOb1.on(.Next(\"B\"))\n    intOb2.on(.Next(2))\n}\n--- combineLatest 1 example ---\nNext(A 1)\nNext(B 1)\nNext(B 2)\n```\n\n### zip\n\n`zip` 人如其名，就是合并两条队列用的，不过它会等到两个队列的元素一一对应地凑齐了之后再合并，正如[百折不撓的米斯特菜](http://weibo.com/mrgreenhand)所提醒的， `zip` 就像是拉链一样，两根拉链拉着拉着合并到了一根上：\n\n```swift\nexample(\"zip 1\") {\n    let intOb1 = PublishSubject<String>()\n    let intOb2 = PublishSubject<Int>()\n    zip(intOb1, intOb2) {\n        \"\\($0) \\($1)\"\n        }\n        .subscribe {\n            print($0)\n        }\n    intOb1.on(.Next(\"A\"))\n    intOb2.on(.Next(1))\n    intOb1.on(.Next(\"B\"))\n    intOb1.on(.Next(\"C\"))\n    intOb2.on(.Next(2))\n}\n--- zip 1 example ---\nNext(A 1)\nNext(B 2)\n```\n\n### merge\n\n`merge` 就是 `merge` 啦，把两个队列按照顺序组合在一起。\n\n```swift\nexample(\"merge 1\") {\n    let subject1 = PublishSubject<Int>()\n    let subject2 = PublishSubject<Int>()\n    sequenceOf(subject1, subject2)\n        .merge()\n        .subscribeNext { int in\n            print(int)\n        }\n    subject1.on(.Next(1))\n    subject1.on(.Next(2))\n    subject2.on(.Next(3))\n    subject1.on(.Next(4))\n    subject2.on(.Next(5))\n}\n--- merge 1 example ---\n1\n2\n3\n4\n5\n```\n\n### switch\n\n当你的事件序列是一个事件序列的序列 (`Observable<Observable<T>>`) 的时候，（可以理解成二维序列？），可以使用 `switch` 将序列的序列平铺成一维，并且在出现新的序列的时候，自动切换到最新的那个序列上。和 `merge` 相似的是，它也是起到了将多个序列『拍平』成一条序列的作用。\n\n```swift\nexample(\"switchLatest\") {\n    let var1 = Variable(0)\n    let var2 = Variable(200)\n    // var3 is like an Observable<Observable<Int>>\n    let var3 = Variable(var1)\n    let d = var3\n        .switchLatest()\n        .subscribe {\n            print($0)\n        }\n    var1.value = 1\n    var1.value = 2\n    var1.value = 3\n    var1.value = 4\n    var3.value = var2\n    var2.value = 201\n    var1.value = 5\n    var3.value = var1\n    var2.value = 202\n    var1.value = 6\n}\n--- switchLatest example ---\nNext(0)\nNext(1)\nNext(2)\nNext(3)\nNext(4)\nNext(200)\nNext(201)\nNext(5)\nNext(6)\n```\n\n注意，虽然都是『拍平』，但是和 `flatmap` 是不同的， `flatmap` 是将一条序列变成另一条序列，而这变换过程会让维度变高，所以需要『拍平』，而 `switch` 是将本来二维的序列（序列的序列）拍平成了一维的序列。\n\n## Error Handling\n\n在事件序列中，遇到异常也是很正常的事情，有以下几种处理异常的手段。\n\n### catchError\n\n`catchError` 可以捕获异常事件，并且在后面无缝接上另一段事件序列，丝毫没有异常的痕迹。\n\n```swift\nexample(\"catchError 1\") {\n    let sequenceThatFails = PublishSubject<Int>()\n    let recoverySequence = sequenceOf(100, 200)\n    sequenceThatFails\n        .catchError { error in\n            return recoverySequence\n        }\n        .subscribe {\n            print($0)\n        }\n    sequenceThatFails.on(.Next(1))\n    sequenceThatFails.on(.Next(2))\n    sequenceThatFails.on(.Error(NSError(domain: \"Test\", code: 0, userInfo: nil)))\n}\n--- catchError 1 example ---\nNext(1)\nNext(2)\nNext(100)\nNext(200)\nCompleted\n```\n\n### retry\n\n`retry` 顾名思义，就是在出现异常的时候会再去从头订阅事件序列，妄图通过『从头再来』解决异常。\n\n```swift\nexample(\"retry\") {\n    var count = 1 // bad practice, only for example purposes\n    let funnyLookingSequence: Observable<Int> = create { observer in\n        let error = NSError(domain: \"Test\", code: 0, userInfo: nil)\n        observer.on(.Next(0))\n        observer.on(.Next(1))\n        if count < 2 {\n            observer.on(.Error(error))\n            count++\n        }\n        observer.on(.Next(2))\n        observer.on(.Completed)\n        return NopDisposable.instance\n    }\n    funnyLookingSequence\n        .retry()\n        .subscribe {\n            print($0)\n        }\n}\n--- retry example ---\nNext(0)\nNext(1)\nNext(0)\nNext(1)\nNext(2)\nCompleted\n```\n\n## Utility\n\n这里列举了针对事件序列的一些方法。\n\n### subscribe\n\n`subscribe` 在前面已经接触过了，有新的事件就会触发。\n\n```swift\nexample(\"subscribe\") {\n    let sequenceOfInts = PublishSubject<Int>()\n    sequenceOfInts\n        .subscribe {\n            print($0)\n        }\n    sequenceOfInts.on(.Next(1))\n    sequenceOfInts.on(.Completed)\n}\n--- subscribe example ---\nNext(1)\nCompleted\n```\n\n### subscribeNext\n\n`subscribeNext` 也是订阅，但是只订阅 `.Next` 事件。\n\n```swift\nexample(\"subscribeNext\") {\n    let sequenceOfInts = PublishSubject<Int>()\n    sequenceOfInts\n        .subscribeNext {\n            print($0)\n        }\n    sequenceOfInts.on(.Next(1))\n    sequenceOfInts.on(.Completed)\n}\n--- subscribeNext example ---\n1\n```\n\n### subscribeCompleted\n\n`subscribeCompleted` 是只订阅 `.Completed` 完成事件。\n\n```swift\nexample(\"subscribeCompleted\") {\n    let sequenceOfInts = PublishSubject<Int>()\n    sequenceOfInts\n        .subscribeCompleted {\n            print(\"It's completed\")\n        }\n    sequenceOfInts.on(.Next(1))\n    sequenceOfInts.on(.Completed)\n}\n--- subscribeCompleted example ---\nIt's completed\n```\n\n### subscribeError\n\n`subscribeError` 只订阅 `.Error` 失败事件。\n\n```swift\nexample(\"subscribeError\") {\n    let sequenceOfInts = PublishSubject<Int>()\n    sequenceOfInts\n        .subscribeError { error in\n            print(error)\n        }\n    sequenceOfInts.on(.Next(1))\n    sequenceOfInts.on(.Error(NSError(domain: \"Examples\", code: -1, userInfo: nil)))\n}\n--- subscribeError example ---\nError Domain=Examples Code=-1 \"The operation couldn’t be completed. (Examples error -1.)\"\n```\n\n### doOn\n\n`doOn` 可以监听事件，并且在事件发生之前调用。\n\n```swift\nexample(\"doOn\") {\n    let sequenceOfInts = PublishSubject<Int>()\n    sequenceOfInts\n        .doOn {\n            print(\"Intercepted event \\($0)\")\n        }\n        .subscribe {\n            print($0)\n        }\n    sequenceOfInts.on(.Next(1))\n    sequenceOfInts.on(.Completed)\n}\n--- doOn example ---\nIntercepted event Next(1)\nNext(1)\nIntercepted event Completed\nCompleted\n```\n\n## Conditional\n\n我们可以对多个事件序列做一些复杂的逻辑判断。\n\n### takeUntil\n\n`takeUntil` 其实就是 `take` ，它会在终于等到那个事件之后触发 `.Completed` 事件。\n\n```swift\nexample(\"takeUntil\") {\n    let originalSequence = PublishSubject<Int>()\n    let whenThisSendsNextWorldStops = PublishSubject<Int>()\n    originalSequence\n        .takeUntil(whenThisSendsNextWorldStops)\n        .subscribe {\n            print($0)\n        }\n    originalSequence.on(.Next(1))\n    originalSequence.on(.Next(2))\n    whenThisSendsNextWorldStops.on(.Next(1))\n    originalSequence.on(.Next(3))\n}\n--- takeUntil example ---\nNext(1)\nNext(2)\nCompleted\n```\n\n### takeWhile\n\n`takeWhile` 则是可以通过状态语句判断是否继续 `take` 。\n\n```swift\nexample(\"takeWhile\") {\n    let sequence = PublishSubject<Int>()\n    sequence\n        .takeWhile { int in\n            int < 2\n        }\n        .subscribe {\n            print($0)\n        }\n    sequence.on(.Next(1))\n    sequence.on(.Next(2))\n    sequence.on(.Next(3))\n}\n--- takeWhile example ---\nNext(1)\nCompleted\n```\n\n## Aggregate\n\n我们可以对事件序列做一些集合运算。\n\n### concat\n\n`concat` 可以把多个事件序列合并起来。\n\n```swift\nexample(\"concat\") {\n    let var1 = BehaviorSubject(value: 0)\n    let var2 = BehaviorSubject(value: 200)\n    // var3 is like an Observable<Observable<Int>>\n    let var3 = BehaviorSubject(value: var1)\n    let d = var3\n        .concat()\n        .subscribe {\n            print($0)\n        }\n    var1.on(.Next(1))\n    var1.on(.Next(2))\n    var3.on(.Next(var2))\n    var2.on(.Next(201))\n    var1.on(.Next(3))\n    var1.on(.Completed)\n    var2.on(.Next(202))\n}\n--- concat example ---\nNext(0)\nNext(1)\nNext(2)\nNext(3)\nNext(201)\nNext(202)\n```\n\n### reduce\n\n这里的 `reduce` 和 `CollectionType` 中的 `reduce` 是一个意思，都是指通过对一系列数据的运算最后生成一个结果。\n\n```swift\nexample(\"reduce\") {\n    sequenceOf(0, 1, 2, 3, 4, 5, 6, 7, 8, 9)\n        .reduce(0, +)\n        .subscribe {\n            print($0)\n        }\n}\n--- reduce example ---\nNext(45)\nCompleted\n```\n\n## Connectable\n\n坑待填，Xcode 里这个操场跑不起来了。\n\n","source":"_posts/rx-dictionary.md","raw":"---\ntitle: RxSwift语法笔记\ndate: 2017-04-08 14:03:18\ntags:\n\t- swift\n\t- RxSwift\n---\n\n记录RxSwift在使用过程中的一些常用语法。\n\n<!--more-->\n\n## 说明\n按照[RxSwift 入坑手册 Part0 - 基础概念](https://blog.callmewhy.com/2015/09/21/rxswift-getting-started-0/)格式进行补充。\n\n\n## SupportCode\n在进入正题之前，先看下项目里的 `SupportCode.swift` ，主要为 `playground` 提供了两个便利函数。\n\n一个是 `example` 函数，专门用来写示例代码的，统一输出 log 便于标记浏览，同时还能保持变量不污染全局：\n\n```swift\npublic func example(description: String, action: () -> ()) {\n    print(\"\\n--- \\(description) example ---\")\n    action()\n}\n```\n\n另一个是 `delay` 函数，通过 `dispatch_after` 用来演示延时的：\n\n```swift\npublic func delay(delay:Double, closure:()->()) {\n    dispatch_after(\n        dispatch_time(\n            DISPATCH_TIME_NOW,\n            Int64(delay * Double(NSEC_PER_SEC))\n        ),\n        dispatch_get_main_queue(), closure)\n}\n```\n\n## Introduction\n\n主要介绍了 Rx 的基础： `Observable` 。 `Observable<Element>` 是观察者模式中被观察的对象，相当于一个事件序列 (`GeneratorType`) ，会向订阅者发送新产生的事件信息。事件信息分为三种：\n\n - Next(value) 表示新的事件数据。\n - Completed 表示事件序列的完结。\n - Error 同样表示完结，但是代表异常导致的完结。\n（打个岔：协议命名，想起来上午汤哥在微博说的一段话：\n\n> 另外，我觉得 protocol 名字用形容词会更加语义分明，比如 Swift : Flyable, Killable, Visible。全用名词的话显得比较生硬，比如 Swift : Head, Wings, Ass。\n\n### empty\n\n`empty` 是一个空的序列，它只发送 `.Completed` 消息。\n\n```swift\nexample(\"empty\") {\n    let emptySequence: Observable<Int> = empty()\n    let subscription = emptySequence\n        .subscribe { event in\n            print(event)\n        }\n}\n--- empty example ---\nCompleted\n```\n\n\n### never\n\n`never` 是没有任何元素、也不会发送任何事件的空序列。\n\n```swift\nexample(\"never\") {\n    let neverSequence: Observable<String> = never()\n    let subscription = neverSequence\n        .subscribe { _ in\n            print(\"This block is never called.\")\n        }\n}\n\n--- never example ---\n```\n### just\n\n`just` 是只包含一个元素的序列，它会先发送 `.Next(value)` ，然后发送 `.Completed` 。\n\n```swift\nexample(\"just\") {\n    let singleElementSequence = just(32)\n    let subscription = singleElementSequence\n        .subscribe { event in\n            print(event)\n        }\n}\n--- just example ---\nNext(32)\nCompleted\nsequenceOf\n```\n\n`sequenceOf` 可以把一系列元素转换成事件序列。\n\n```swift\nexample(\"sequenceOf\") {\n    let sequenceOfElements/* : Observable<Int> */ = sequenceOf(0, 1, 2, 3)\n    let subscription = sequenceOfElements\n        .subscribe { event in\n            print(event)\n        }\n}\n--- sequenceOf example ---\nNext(0)\nNext(1)\nNext(2)\nNext(3)\nCompleted\nfrom\n```\n\n`from` 是通过 `asObservable()` 方法把 Swift 中的序列 (`SequenceType`) 转换成事件序列。\n\n```swift\nexample(\"from\") {\n    let sequenceFromArray = [1, 2, 3, 4, 5].asObservable()\n    let subscription = sequenceFromArray\n        .subscribe { event in\n            print(event)\n        }\n}\n--- from example ---\nNext(1)\nNext(2)\nNext(3)\nNext(4)\nNext(5)\nCompleted\n```\n\n### create\n\n`create` 可以通过闭包创建序列，通过 `.on(e: Event)` 添加事件。\n\n```swift\nexample(\"create\") {\n    let myJust = { (singleElement: Int) -> Observable<Int> in\n        return create { observer in\n            observer.on(.Next(singleElement))\n            observer.on(.Completed)\n            return NopDisposable.instance\n        }\n    }\n    let subscription = myJust(5)\n        .subscribe { event in\n            print(event)\n        }\n}\n--- create example ---\nNext(5)\nCompleted\n```\n\n### failWith\n\n`failWith` 创建一个没有元素的序列，只会发送失败 (`.Error`) 事件。\n\n```swift\nexample(\"failWith\") {\n    let error = NSError(domain: \"Test\", code: -1, userInfo: nil)\n    let erroredSequence: Observable<Int> = failWith(error)\n    let subscription = erroredSequence\n        .subscribe { event in\n            print(event)\n        }\n}\n--- failWith example ---\nError(Error Domain=Test Code=-1 \"The operation couldn’t be completed. (Test error -1.)\")\n```\n\n### deferred\n\n`deferred` 会等到有订阅者的时候再通过工厂方法创建 `Observable` 对象，每个订阅者订阅的对象都是内容相同而完全独立的序列。\n\n```swift\nexample(\"deferred\") {\n    let deferredSequence: Observable<Int> = deferred {\n        print(\"creating\")\n        return create { observer in\n            print(\"emmiting\")\n            observer.on(.Next(0))\n            observer.on(.Next(1))\n            observer.on(.Next(2))\n            return NopDisposable.instance\n        }\n    }\n    print(\"go\")\n    deferredSequence\n        .subscribe { event in\n            print(event)\n    }\n    deferredSequence\n        .subscribe { event in\n            print(event)\n        }\n}\n--- deferred example ---\ngo\ncreating\nemmiting\nNext(0)\nNext(1)\nNext(2)\ncreating\nemmiting\nNext(0)\nNext(1)\nNext(2)\n```\n\n为什么需要 `defferd` 这样一个奇怪的家伙呢？其实这相当于是一种延时加载，因为在添加监听的时候数据未必加载完毕，例如下面这个例子：\n\n```swift\nexample(\"TestDeferred\") {\n    var value: String? = nil\n    var subscription: Observable<String?> = just(value)\n    // got value\n    value = \"Hello!\"\n    subscription.subscribe { event in\n        print(event)\n    }\n}\n--- TestDeferred example ---\nNext(nil)\nCompleted\n```\n\n如果使用 `deffered` 则可以正常显示想要的数据：\n\n```swift\nexample(\"TestDeferred\") {\n    var value: String? = nil\n    var subscription: Observable<String?> = deferred {\n        return just(value)\n    }\n    // got value\n    value = \"Hello!\"\n    subscription.subscribe { event in\n        print(event)\n    }\n}\n--- TestDeferred example ---\nNext(Optional(\"Hello!\"))\nCompleted\n```\n\n## Subjects\n\n接下来是关于 `Subject` 的内容。 `Subject` 可以看做是一种代理和桥梁。它既是订阅者又是订阅源，这意味着它既可以订阅其他 `Observable` 对象，同时又可以对它的订阅者们发送事件。\n\n如果把 `Observable` 理解成不断输出事件的水管，那 `Subject` 就是套在上面的水龙头。它既怼着一根不断出水的水管，同时也向外面输送着新鲜水源。如果你直接用水杯接着水管的水，那可能导出来什么王水胶水完全把持不住；如果你在水龙头下面接着水，那你可以随心所欲的调成你想要的水速和水温。\n\n（好吧上面一段文档里没有，是我瞎掰的，如果理解错了还望打脸(￣ε(#￣)☆╰╮(￣▽￣///))\n\n在开始下面的代码之前，先定义一个辅助函数用于输出数据：\n\n```swift\nfunc writeSequenceToConsole<O: ObservableType>(name: String, sequence: O) {\n    sequence\n        .subscribe { e in\n            print(\"Subscription: \\(name), event: \\(e)\")\n        }\n}\n```\n\n### PublishSubject\n\n`PublishSubject` 会发送订阅者从订阅之后的事件序列。\n\n```swift\nexample(\"PublishSubject\") {\n    let subject = PublishSubject<String>()\n    writeSequenceToConsole(\"1\", sequence: subject)\n    subject.on(.Next(\"a\"))\n    subject.on(.Next(\"b\"))\n    writeSequenceToConsole(\"2\", sequence: subject)\n    subject.on(.Next(\"c\"))\n    subject.on(.Next(\"d\"))\n}\n--- PublishSubject example ---\nSubscription: 1, event: Next(a)\nSubscription: 1, event: Next(b)\nSubscription: 1, event: Next(c)\nSubscription: 2, event: Next(c)\nSubscription: 1, event: Next(d)\nSubscription: 2, event: Next(d)\n```\n\n### ReplaySubject\n\n`ReplaySubject` 在新的订阅对象订阅的时候会补发所有已经发送过的数据队列， `bufferSize` 是缓冲区的大小，决定了补发队列的最大值。如果 `bufferSize` 是1，那么新的订阅者出现的时候就会补发上一个事件，如果是2，则补两个，以此类推。\n\n```swift\nexample(\"ReplaySubject\") {\n    let subject = ReplaySubject<String>.create(bufferSize: 1)\n    writeSequenceToConsole(\"1\", sequence: subject)\n    subject.on(.Next(\"a\"))\n    subject.on(.Next(\"b\"))\n    writeSequenceToConsole(\"2\", sequence: subject)\n    subject.on(.Next(\"c\"))\n    subject.on(.Next(\"d\"))\n}\n--- ReplaySubject example ---\nSubscription: 1, event: Next(a)\nSubscription: 1, event: Next(b)\nSubscription: 2, event: Next(b) // 补了一个 b\nSubscription: 1, event: Next(c)\nSubscription: 2, event: Next(c)\nSubscription: 1, event: Next(d)\nSubscription: 2, event: Next(d)\n```\n\n### BehaviorSubject\n\n`BehaviorSubject` 在新的订阅对象订阅的时候会发送最近发送的事件，如果没有则发送一个默认值。\n\n```swift\nexample(\"BehaviorSubject\") {\n    let subject = BehaviorSubject(value: \"z\")\n    writeSequenceToConsole(\"1\", sequence: subject)\n    subject.on(.Next(\"a\"))\n    subject.on(.Next(\"b\"))\n    writeSequenceToConsole(\"2\", sequence: subject)\n    subject.on(.Next(\"c\"))\n    subject.on(.Completed)\n}\n--- BehaviorSubject example ---\nSubscription: 1, event: Next(z)\nSubscription: 1, event: Next(a)\nSubscription: 1, event: Next(b)\nSubscription: 2, event: Next(b)\nSubscription: 1, event: Next(c)\nSubscription: 2, event: Next(c)\nSubscription: 1, event: Completed\nSubscription: 2, event: Completed\n```\n\n### Variable\n\n`Variable` 是基于 `BehaviorSubject` 的一层封装，它的优势是：不会被显式终结。即：不会收到 `.Completed` 和 `.Error` 这类的终结事件，它会主动在析构的时候发送 `.Complete` 。\n\n```swift\nexample(\"Variable\") {\n    let variable = Variable(\"z\")\n    writeSequenceToConsole(\"1\", sequence: variable)\n    variable.value = \"a\"\n    variable.value = \"b\"\n    writeSequenceToConsole(\"2\", sequence: variable)\n    variable.value = \"c\"\n}\n--- Variable example ---\nSubscription: 1, event: Next(z)\nSubscription: 1, event: Next(a)\nSubscription: 1, event: Next(b)\nSubscription: 2, event: Next(b)\nSubscription: 1, event: Next(c)\nSubscription: 2, event: Next(c)\nSubscription: 1, event: Completed\nSubscription: 2, event: Completed\n```\n\n## Transform\n\n我们可以对序列做一些转换，类似于 `Swift` 中 `CollectionType` 的各种转换。在以前的坑中曾经提到过，可以参考：[函数式的函数](https://blog.callmewhy.com/2015/05/11/functional-reactive-programming-1/#函数式的函数/)。\n\n### map\n\n`map` 就是对每个元素都用函数做一次转换，挨个映射一遍。\n\n```swift\nexample(\"map\") {\n    let originalSequence = sequenceOf(1,2,3)\n    originalSequence\n        .map { $0 * 2 }\n        .subscribe { print($0) }\n}\n--- map example ---\nNext(2)\nNext(4)\nNext(6)\nCompleted\n```\n\n### flatMap\n\n`map` 在做转换的时候很容易出现『升维』的情况，即：转变之后，从一个序列变成了一个序列的序列。\n\n什么是『升维』？在集合中我们可以举这样一个例子，我有一个好友列表 `[p1, p2, p3]`，那么如果要获取我好友的好友的列表，可以这样做：\n\n```swift\nmyFriends.map { $0.getFriends() }\n```\n结果就成了 `[[p1-1, p1-2, p1-3], [p2-1], [p3-1, p3-2]]` ，这就成了好友的好友列表的列表了。这就是一个『升维』的例子。\n\n（以上内容文档中依旧没有，依旧是我瞎掰的，依旧欢迎有错误当面打脸(￣ε(#￣)☆╰╮(￣▽￣///))\n\n在 `Swift` 中，我们可以用 `flatMap` 过滤掉 `map` 之后的 `nil` 结果。在 `Rx` 中， `flatMap` 可以把一个序列转换成一组序列，然后再把这一组序列『拍扁』成一个序列。\n\n```swift\nexample(\"flatMap\") {\n    let sequenceInt = sequenceOf(1, 2, 3)\n    let sequenceString = sequenceOf(\"A\", \"B\", \"--\")\n    sequenceInt\n        .flatMap { int in\n            sequenceString\n        }\n        .subscribe {\n            print($0)\n        }\n}\n--- flatMap example ---\nNext(A)\nNext(B)\nNext(--)\nNext(A)\nNext(B)\nNext(--)\nNext(A)\nNext(B)\nNext(--)\nCompleted\n```\n\n### scan\n\n`scan` 有点像 `reduce` ，它会把每次的运算结果累积起来，作为下一次运算的输入值。\n\n```swift\nexample(\"scan\") {\n    let sequenceToSum = sequenceOf(0, 1, 2, 3, 4, 5)\n    sequenceToSum\n        .scan(0) { acum, elem in\n            acum + elem\n        }\n        .subscribe {\n            print($0)\n        }\n}\n--- scan example ---\nNext(0)\nNext(1)\nNext(3)\nNext(6)\nNext(10)\nNext(15)\nCompleted\n```\n\n## Filtering\n\n除了上面的各种转换，我们还可以对序列进行过滤。\n\n### filter\n\n`filter` 只会让符合条件的元素通过。\n\n```swift\nexample(\"filter\") {\n    let subscription = sequenceOf(0, 1, 2, 3, 4, 5, 6, 7, 8, 9)\n        .filter {\n            $0 % 2 == 0\n        }\n        .subscribe {\n            print($0)\n        }\n}\n--- filter example ---\nNext(0)\nNext(2)\nNext(4)\nNext(6)\nNext(8)\nCompleted\n```\n\n### distinctUntilChanged\n\n`distinctUntilChanged` 会废弃掉重复的事件。\n\n```swift\nexample(\"distinctUntilChanged\") {\n    let subscription = sequenceOf(1, 2, 3, 1, 1, 4)\n        .distinctUntilChanged()\n        .subscribe {\n            print($0)\n        }\n}\n--- distinctUntilChanged example ---\nNext(1)\nNext(2)\nNext(3)\nNext(1)\nNext(4)\nCompleted\n```\n\n### take\n\n`take` 只获取序列中的前 `n` 个事件，在满足数量之后会自动 `.Completed` 。\n\n```swift\nexample(\"take\") {\n    let subscription = sequenceOf(1, 2, 3, 4, 5, 6)\n        .take(3)\n        .subscribe {\n            print($0)\n        }\n}\n--- take example ---\nNext(1)\nNext(2)\nNext(3)\nCompleted\n```\n\n### throttle VS. debounce\n\n`throttle` 和 `debounce` 目的都是控制某个时间段内事件序列的速度。但是又有差别：\n\n- `debounce` : `空闲控制`  空闲时间必须 `>=` 固定的时间，事件序列才会被放行\n- `throttle` : `频率控制`  事件序列满足 `1/delay` 才会被放行\n\n一般的按钮点击、用户输入、等都属于频率控制，应该使用 `throttle` 。\n\n```swift\nlet searchResults = searchBar.rx.text.orEmpty\n    .throttle(0.3, scheduler: MainScheduler.instance)\n    .distinctUntilChanged()\n    .flatMapLatest { query -> Observable<[Repository]> in\n        if query.isEmpty {\n            return .just([])\n        }\n        return searchGitHub(query)\n            .catchErrorJustReturn([])\n    }\n    .observeOn(MainScheduler.instance)\n```\n\n## Combining\n\n这部分是关于序列的运算，可以将多个序列源进行组合拼装成一个新的事件序列。\n\n### startWith\n\n`startWith` 会在队列开始之前插入一个事件元素。\n\n```swift\nexample(\"startWith\") {\n    let subscription = sequenceOf(4, 5, 6)\n        .startWith(3)\n        .subscribe {\n            print($0)\n        }\n}\n--- startWith example ---\nNext(3)\nNext(4)\nNext(5)\nNext(6)\nCompleted\n```\n\n### combineLatest\n\n如果存在两条事件队列，需要同时监听，那么每当有新的事件发生的时候，`combineLatest` 会将每个队列的最新的一个元素进行合并。\n\n```swift\nexample(\"combineLatest 1\") {\n    let intOb1 = PublishSubject<String>()\n    let intOb2 = PublishSubject<Int>()\n    combineLatest(intOb1, intOb2) {\n        \"\\($0) \\($1)\"\n        }\n        .subscribe {\n            print($0)\n        }\n    intOb1.on(.Next(\"A\"))\n    intOb2.on(.Next(1))\n    intOb1.on(.Next(\"B\"))\n    intOb2.on(.Next(2))\n}\n--- combineLatest 1 example ---\nNext(A 1)\nNext(B 1)\nNext(B 2)\n```\n\n### zip\n\n`zip` 人如其名，就是合并两条队列用的，不过它会等到两个队列的元素一一对应地凑齐了之后再合并，正如[百折不撓的米斯特菜](http://weibo.com/mrgreenhand)所提醒的， `zip` 就像是拉链一样，两根拉链拉着拉着合并到了一根上：\n\n```swift\nexample(\"zip 1\") {\n    let intOb1 = PublishSubject<String>()\n    let intOb2 = PublishSubject<Int>()\n    zip(intOb1, intOb2) {\n        \"\\($0) \\($1)\"\n        }\n        .subscribe {\n            print($0)\n        }\n    intOb1.on(.Next(\"A\"))\n    intOb2.on(.Next(1))\n    intOb1.on(.Next(\"B\"))\n    intOb1.on(.Next(\"C\"))\n    intOb2.on(.Next(2))\n}\n--- zip 1 example ---\nNext(A 1)\nNext(B 2)\n```\n\n### merge\n\n`merge` 就是 `merge` 啦，把两个队列按照顺序组合在一起。\n\n```swift\nexample(\"merge 1\") {\n    let subject1 = PublishSubject<Int>()\n    let subject2 = PublishSubject<Int>()\n    sequenceOf(subject1, subject2)\n        .merge()\n        .subscribeNext { int in\n            print(int)\n        }\n    subject1.on(.Next(1))\n    subject1.on(.Next(2))\n    subject2.on(.Next(3))\n    subject1.on(.Next(4))\n    subject2.on(.Next(5))\n}\n--- merge 1 example ---\n1\n2\n3\n4\n5\n```\n\n### switch\n\n当你的事件序列是一个事件序列的序列 (`Observable<Observable<T>>`) 的时候，（可以理解成二维序列？），可以使用 `switch` 将序列的序列平铺成一维，并且在出现新的序列的时候，自动切换到最新的那个序列上。和 `merge` 相似的是，它也是起到了将多个序列『拍平』成一条序列的作用。\n\n```swift\nexample(\"switchLatest\") {\n    let var1 = Variable(0)\n    let var2 = Variable(200)\n    // var3 is like an Observable<Observable<Int>>\n    let var3 = Variable(var1)\n    let d = var3\n        .switchLatest()\n        .subscribe {\n            print($0)\n        }\n    var1.value = 1\n    var1.value = 2\n    var1.value = 3\n    var1.value = 4\n    var3.value = var2\n    var2.value = 201\n    var1.value = 5\n    var3.value = var1\n    var2.value = 202\n    var1.value = 6\n}\n--- switchLatest example ---\nNext(0)\nNext(1)\nNext(2)\nNext(3)\nNext(4)\nNext(200)\nNext(201)\nNext(5)\nNext(6)\n```\n\n注意，虽然都是『拍平』，但是和 `flatmap` 是不同的， `flatmap` 是将一条序列变成另一条序列，而这变换过程会让维度变高，所以需要『拍平』，而 `switch` 是将本来二维的序列（序列的序列）拍平成了一维的序列。\n\n## Error Handling\n\n在事件序列中，遇到异常也是很正常的事情，有以下几种处理异常的手段。\n\n### catchError\n\n`catchError` 可以捕获异常事件，并且在后面无缝接上另一段事件序列，丝毫没有异常的痕迹。\n\n```swift\nexample(\"catchError 1\") {\n    let sequenceThatFails = PublishSubject<Int>()\n    let recoverySequence = sequenceOf(100, 200)\n    sequenceThatFails\n        .catchError { error in\n            return recoverySequence\n        }\n        .subscribe {\n            print($0)\n        }\n    sequenceThatFails.on(.Next(1))\n    sequenceThatFails.on(.Next(2))\n    sequenceThatFails.on(.Error(NSError(domain: \"Test\", code: 0, userInfo: nil)))\n}\n--- catchError 1 example ---\nNext(1)\nNext(2)\nNext(100)\nNext(200)\nCompleted\n```\n\n### retry\n\n`retry` 顾名思义，就是在出现异常的时候会再去从头订阅事件序列，妄图通过『从头再来』解决异常。\n\n```swift\nexample(\"retry\") {\n    var count = 1 // bad practice, only for example purposes\n    let funnyLookingSequence: Observable<Int> = create { observer in\n        let error = NSError(domain: \"Test\", code: 0, userInfo: nil)\n        observer.on(.Next(0))\n        observer.on(.Next(1))\n        if count < 2 {\n            observer.on(.Error(error))\n            count++\n        }\n        observer.on(.Next(2))\n        observer.on(.Completed)\n        return NopDisposable.instance\n    }\n    funnyLookingSequence\n        .retry()\n        .subscribe {\n            print($0)\n        }\n}\n--- retry example ---\nNext(0)\nNext(1)\nNext(0)\nNext(1)\nNext(2)\nCompleted\n```\n\n## Utility\n\n这里列举了针对事件序列的一些方法。\n\n### subscribe\n\n`subscribe` 在前面已经接触过了，有新的事件就会触发。\n\n```swift\nexample(\"subscribe\") {\n    let sequenceOfInts = PublishSubject<Int>()\n    sequenceOfInts\n        .subscribe {\n            print($0)\n        }\n    sequenceOfInts.on(.Next(1))\n    sequenceOfInts.on(.Completed)\n}\n--- subscribe example ---\nNext(1)\nCompleted\n```\n\n### subscribeNext\n\n`subscribeNext` 也是订阅，但是只订阅 `.Next` 事件。\n\n```swift\nexample(\"subscribeNext\") {\n    let sequenceOfInts = PublishSubject<Int>()\n    sequenceOfInts\n        .subscribeNext {\n            print($0)\n        }\n    sequenceOfInts.on(.Next(1))\n    sequenceOfInts.on(.Completed)\n}\n--- subscribeNext example ---\n1\n```\n\n### subscribeCompleted\n\n`subscribeCompleted` 是只订阅 `.Completed` 完成事件。\n\n```swift\nexample(\"subscribeCompleted\") {\n    let sequenceOfInts = PublishSubject<Int>()\n    sequenceOfInts\n        .subscribeCompleted {\n            print(\"It's completed\")\n        }\n    sequenceOfInts.on(.Next(1))\n    sequenceOfInts.on(.Completed)\n}\n--- subscribeCompleted example ---\nIt's completed\n```\n\n### subscribeError\n\n`subscribeError` 只订阅 `.Error` 失败事件。\n\n```swift\nexample(\"subscribeError\") {\n    let sequenceOfInts = PublishSubject<Int>()\n    sequenceOfInts\n        .subscribeError { error in\n            print(error)\n        }\n    sequenceOfInts.on(.Next(1))\n    sequenceOfInts.on(.Error(NSError(domain: \"Examples\", code: -1, userInfo: nil)))\n}\n--- subscribeError example ---\nError Domain=Examples Code=-1 \"The operation couldn’t be completed. (Examples error -1.)\"\n```\n\n### doOn\n\n`doOn` 可以监听事件，并且在事件发生之前调用。\n\n```swift\nexample(\"doOn\") {\n    let sequenceOfInts = PublishSubject<Int>()\n    sequenceOfInts\n        .doOn {\n            print(\"Intercepted event \\($0)\")\n        }\n        .subscribe {\n            print($0)\n        }\n    sequenceOfInts.on(.Next(1))\n    sequenceOfInts.on(.Completed)\n}\n--- doOn example ---\nIntercepted event Next(1)\nNext(1)\nIntercepted event Completed\nCompleted\n```\n\n## Conditional\n\n我们可以对多个事件序列做一些复杂的逻辑判断。\n\n### takeUntil\n\n`takeUntil` 其实就是 `take` ，它会在终于等到那个事件之后触发 `.Completed` 事件。\n\n```swift\nexample(\"takeUntil\") {\n    let originalSequence = PublishSubject<Int>()\n    let whenThisSendsNextWorldStops = PublishSubject<Int>()\n    originalSequence\n        .takeUntil(whenThisSendsNextWorldStops)\n        .subscribe {\n            print($0)\n        }\n    originalSequence.on(.Next(1))\n    originalSequence.on(.Next(2))\n    whenThisSendsNextWorldStops.on(.Next(1))\n    originalSequence.on(.Next(3))\n}\n--- takeUntil example ---\nNext(1)\nNext(2)\nCompleted\n```\n\n### takeWhile\n\n`takeWhile` 则是可以通过状态语句判断是否继续 `take` 。\n\n```swift\nexample(\"takeWhile\") {\n    let sequence = PublishSubject<Int>()\n    sequence\n        .takeWhile { int in\n            int < 2\n        }\n        .subscribe {\n            print($0)\n        }\n    sequence.on(.Next(1))\n    sequence.on(.Next(2))\n    sequence.on(.Next(3))\n}\n--- takeWhile example ---\nNext(1)\nCompleted\n```\n\n## Aggregate\n\n我们可以对事件序列做一些集合运算。\n\n### concat\n\n`concat` 可以把多个事件序列合并起来。\n\n```swift\nexample(\"concat\") {\n    let var1 = BehaviorSubject(value: 0)\n    let var2 = BehaviorSubject(value: 200)\n    // var3 is like an Observable<Observable<Int>>\n    let var3 = BehaviorSubject(value: var1)\n    let d = var3\n        .concat()\n        .subscribe {\n            print($0)\n        }\n    var1.on(.Next(1))\n    var1.on(.Next(2))\n    var3.on(.Next(var2))\n    var2.on(.Next(201))\n    var1.on(.Next(3))\n    var1.on(.Completed)\n    var2.on(.Next(202))\n}\n--- concat example ---\nNext(0)\nNext(1)\nNext(2)\nNext(3)\nNext(201)\nNext(202)\n```\n\n### reduce\n\n这里的 `reduce` 和 `CollectionType` 中的 `reduce` 是一个意思，都是指通过对一系列数据的运算最后生成一个结果。\n\n```swift\nexample(\"reduce\") {\n    sequenceOf(0, 1, 2, 3, 4, 5, 6, 7, 8, 9)\n        .reduce(0, +)\n        .subscribe {\n            print($0)\n        }\n}\n--- reduce example ---\nNext(45)\nCompleted\n```\n\n## Connectable\n\n坑待填，Xcode 里这个操场跑不起来了。\n\n","slug":"rx-dictionary","published":1,"updated":"2017-04-08T08:04:34.000Z","_id":"cj18v0f9x000rl0uvdbn3pat9","comments":1,"layout":"post","photos":[],"link":"","content":"<p>记录RxSwift在使用过程中的一些常用语法。</p>\n<a id=\"more\"></a>\n<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>按照<a href=\"https://blog.callmewhy.com/2015/09/21/rxswift-getting-started-0/\" target=\"_blank\" rel=\"external\">RxSwift 入坑手册 Part0 - 基础概念</a>格式进行补充。</p>\n<h2 id=\"SupportCode\"><a href=\"#SupportCode\" class=\"headerlink\" title=\"SupportCode\"></a>SupportCode</h2><p>在进入正题之前，先看下项目里的 <code>SupportCode.swift</code> ，主要为 <code>playground</code> 提供了两个便利函数。</p>\n<p>一个是 <code>example</code> 函数，专门用来写示例代码的，统一输出 log 便于标记浏览，同时还能保持变量不污染全局：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">example</span><span class=\"params\">(description: String, action: <span class=\"params\">()</span></span></span> -&gt; ()) &#123;</div><div class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"\\n--- <span class=\"subst\">\\(description)</span> example ---\"</span>)</div><div class=\"line\">    action()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>另一个是 <code>delay</code> 函数，通过 <code>dispatch_after</code> 用来演示延时的：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">delay</span><span class=\"params\">(delay:Double, closure:<span class=\"params\">()</span></span></span>-&gt;()) &#123;</div><div class=\"line\">    dispatch_after(</div><div class=\"line\">        dispatch_time(</div><div class=\"line\">            <span class=\"type\">DISPATCH_TIME_NOW</span>,</div><div class=\"line\">            <span class=\"type\">Int64</span>(delay * <span class=\"type\">Double</span>(<span class=\"type\">NSEC_PER_SEC</span>))</div><div class=\"line\">        ),</div><div class=\"line\">        dispatch_get_main_queue(), closure)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h2><p>主要介绍了 Rx 的基础： <code>Observable</code> 。 <code>Observable&lt;Element&gt;</code> 是观察者模式中被观察的对象，相当于一个事件序列 (<code>GeneratorType</code>) ，会向订阅者发送新产生的事件信息。事件信息分为三种：</p>\n<ul>\n<li>Next(value) 表示新的事件数据。</li>\n<li>Completed 表示事件序列的完结。</li>\n<li>Error 同样表示完结，但是代表异常导致的完结。<br>（打个岔：协议命名，想起来上午汤哥在微博说的一段话：</li>\n</ul>\n<blockquote>\n<p>另外，我觉得 protocol 名字用形容词会更加语义分明，比如 Swift : Flyable, Killable, Visible。全用名词的话显得比较生硬，比如 Swift : Head, Wings, Ass。</p>\n</blockquote>\n<h3 id=\"empty\"><a href=\"#empty\" class=\"headerlink\" title=\"empty\"></a>empty</h3><p><code>empty</code> 是一个空的序列，它只发送 <code>.Completed</code> 消息。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"empty\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> emptySequence: <span class=\"type\">Observable</span>&lt;<span class=\"type\">Int</span>&gt; = empty()</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = emptySequence</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- empty example ---</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"never\"><a href=\"#never\" class=\"headerlink\" title=\"never\"></a>never</h3><p><code>never</code> 是没有任何元素、也不会发送任何事件的空序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"never\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> neverSequence: <span class=\"type\">Observable</span>&lt;<span class=\"type\">String</span>&gt; = never()</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = neverSequence</div><div class=\"line\">        .subscribe &#123; <span class=\"number\">_</span> <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"This block is never called.\"</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">--- never example ---</div></pre></td></tr></table></figure>\n<h3 id=\"just\"><a href=\"#just\" class=\"headerlink\" title=\"just\"></a>just</h3><p><code>just</code> 是只包含一个元素的序列，它会先发送 <code>.Next(value)</code> ，然后发送 <code>.Completed</code> 。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"just\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> singleElementSequence = just(<span class=\"number\">32</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = singleElementSequence</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- just example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">32</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div><div class=\"line\">sequenceOf</div></pre></td></tr></table></figure>\n<p><code>sequenceOf</code> 可以把一系列元素转换成事件序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"sequenceOf\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfElements<span class=\"comment\">/* : Observable&lt;Int&gt; */</span> = sequenceOf(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceOfElements</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- sequenceOf example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div><div class=\"line\">from</div></pre></td></tr></table></figure>\n<p><code>from</code> 是通过 <code>asObservable()</code> 方法把 Swift 中的序列 (<code>SequenceType</code>) 转换成事件序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"from\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceFromArray = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>].asObservable()</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceFromArray</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- from example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">5</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"create\"><a href=\"#create\" class=\"headerlink\" title=\"create\"></a>create</h3><p><code>create</code> 可以通过闭包创建序列，通过 <code>.on(e: Event)</code> 添加事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"create\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> myJust = &#123; (singleElement: <span class=\"type\">Int</span>) -&gt; <span class=\"type\">Observable</span>&lt;<span class=\"type\">Int</span>&gt; <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"keyword\">return</span> create &#123; observer <span class=\"keyword\">in</span></div><div class=\"line\">            observer.on(.<span class=\"type\">Next</span>(singleElement))</div><div class=\"line\">            observer.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"type\">NopDisposable</span>.instance</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = myJust(<span class=\"number\">5</span>)</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- create example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">5</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"failWith\"><a href=\"#failWith\" class=\"headerlink\" title=\"failWith\"></a>failWith</h3><p><code>failWith</code> 创建一个没有元素的序列，只会发送失败 (<code>.Error</code>) 事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"failWith\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> error = <span class=\"type\">NSError</span>(domain: <span class=\"string\">\"Test\"</span>, code: -<span class=\"number\">1</span>, userInfo: <span class=\"literal\">nil</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> erroredSequence: <span class=\"type\">Observable</span>&lt;<span class=\"type\">Int</span>&gt; = failWith(error)</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = erroredSequence</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- failWith example ---</div><div class=\"line\"><span class=\"type\">Error</span>(<span class=\"type\">Error</span> <span class=\"type\">Domain</span>=<span class=\"type\">Test</span> <span class=\"type\">Code</span>=-<span class=\"number\">1</span> <span class=\"string\">\"The operation couldn’t be completed. (Test error -1.)\"</span>)</div></pre></td></tr></table></figure>\n<h3 id=\"deferred\"><a href=\"#deferred\" class=\"headerlink\" title=\"deferred\"></a>deferred</h3><p><code>deferred</code> 会等到有订阅者的时候再通过工厂方法创建 <code>Observable</code> 对象，每个订阅者订阅的对象都是内容相同而完全独立的序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"deferred\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> deferredSequence: <span class=\"type\">Observable</span>&lt;<span class=\"type\">Int</span>&gt; = deferred &#123;</div><div class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"creating\"</span>)</div><div class=\"line\">        <span class=\"keyword\">return</span> create &#123; observer <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"emmiting\"</span>)</div><div class=\"line\">            observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">0</span>))</div><div class=\"line\">            observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">            observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"type\">NopDisposable</span>.instance</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"go\"</span>)</div><div class=\"line\">    deferredSequence</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">    &#125;</div><div class=\"line\">    deferredSequence</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- deferred example ---</div><div class=\"line\">go</div><div class=\"line\">creating</div><div class=\"line\">emmiting</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\">creating</div><div class=\"line\">emmiting</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div></pre></td></tr></table></figure>\n<p>为什么需要 <code>defferd</code> 这样一个奇怪的家伙呢？其实这相当于是一种延时加载，因为在添加监听的时候数据未必加载完毕，例如下面这个例子：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"TestDeferred\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> value: <span class=\"type\">String</span>? = <span class=\"literal\">nil</span></div><div class=\"line\">    <span class=\"keyword\">var</span> subscription: <span class=\"type\">Observable</span>&lt;<span class=\"type\">String</span>?&gt; = just(value)</div><div class=\"line\">    <span class=\"comment\">// got value</span></div><div class=\"line\">    value = <span class=\"string\">\"Hello!\"</span></div><div class=\"line\">    subscription.subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"built_in\">print</span>(event)</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">TestDeferred</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"literal\">nil</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<p>如果使用 <code>deffered</code> 则可以正常显示想要的数据：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"TestDeferred\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> value: <span class=\"type\">String</span>? = <span class=\"literal\">nil</span></div><div class=\"line\">    <span class=\"keyword\">var</span> subscription: <span class=\"type\">Observable</span>&lt;<span class=\"type\">String</span>?&gt; = deferred &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> just(value)</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// got value</span></div><div class=\"line\">    value = <span class=\"string\">\"Hello!\"</span></div><div class=\"line\">    subscription.subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"built_in\">print</span>(event)</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">TestDeferred</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">Optional</span>(<span class=\"string\">\"Hello!\"</span>))</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Subjects\"><a href=\"#Subjects\" class=\"headerlink\" title=\"Subjects\"></a>Subjects</h2><p>接下来是关于 <code>Subject</code> 的内容。 <code>Subject</code> 可以看做是一种代理和桥梁。它既是订阅者又是订阅源，这意味着它既可以订阅其他 <code>Observable</code> 对象，同时又可以对它的订阅者们发送事件。</p>\n<p>如果把 <code>Observable</code> 理解成不断输出事件的水管，那 <code>Subject</code> 就是套在上面的水龙头。它既怼着一根不断出水的水管，同时也向外面输送着新鲜水源。如果你直接用水杯接着水管的水，那可能导出来什么王水胶水完全把持不住；如果你在水龙头下面接着水，那你可以随心所欲的调成你想要的水速和水温。</p>\n<p>（好吧上面一段文档里没有，是我瞎掰的，如果理解错了还望打脸(￣ε(#￣)☆╰╮(￣▽￣///))</p>\n<p>在开始下面的代码之前，先定义一个辅助函数用于输出数据：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">writeSequenceToConsole</span>&lt;O: ObservableType&gt;<span class=\"params\">(name: String, sequence: O)</span></span> &#123;</div><div class=\"line\">    sequence</div><div class=\"line\">        .subscribe &#123; e <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"Subscription: <span class=\"subst\">\\(name)</span>, event: <span class=\"subst\">\\(e)</span>\"</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"PublishSubject\"><a href=\"#PublishSubject\" class=\"headerlink\" title=\"PublishSubject\"></a>PublishSubject</h3><p><code>PublishSubject</code> 会发送订阅者从订阅之后的事件序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"PublishSubject\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subject = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">String</span>&gt;()</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"1\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"a\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"b\"</span>))</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"2\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"c\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"d\"</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">PublishSubject</span> example ---</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(a)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(d)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(d)</div></pre></td></tr></table></figure>\n<h3 id=\"ReplaySubject\"><a href=\"#ReplaySubject\" class=\"headerlink\" title=\"ReplaySubject\"></a>ReplaySubject</h3><p><code>ReplaySubject</code> 在新的订阅对象订阅的时候会补发所有已经发送过的数据队列， <code>bufferSize</code> 是缓冲区的大小，决定了补发队列的最大值。如果 <code>bufferSize</code> 是1，那么新的订阅者出现的时候就会补发上一个事件，如果是2，则补两个，以此类推。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"ReplaySubject\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subject = <span class=\"type\">ReplaySubject</span>&lt;<span class=\"type\">String</span>&gt;.create(bufferSize: <span class=\"number\">1</span>)</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"1\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"a\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"b\"</span>))</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"2\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"c\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"d\"</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">ReplaySubject</span> example ---</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(a)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(b) <span class=\"comment\">// 补了一个 b</span></div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(d)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(d)</div></pre></td></tr></table></figure>\n<h3 id=\"BehaviorSubject\"><a href=\"#BehaviorSubject\" class=\"headerlink\" title=\"BehaviorSubject\"></a>BehaviorSubject</h3><p><code>BehaviorSubject</code> 在新的订阅对象订阅的时候会发送最近发送的事件，如果没有则发送一个默认值。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"BehaviorSubject\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subject = <span class=\"type\">BehaviorSubject</span>(value: <span class=\"string\">\"z\"</span>)</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"1\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"a\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"b\"</span>))</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"2\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"c\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">BehaviorSubject</span> example ---</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(z)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(a)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Completed</span></div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"Variable\"><a href=\"#Variable\" class=\"headerlink\" title=\"Variable\"></a>Variable</h3><p><code>Variable</code> 是基于 <code>BehaviorSubject</code> 的一层封装，它的优势是：不会被显式终结。即：不会收到 <code>.Completed</code> 和 <code>.Error</code> 这类的终结事件，它会主动在析构的时候发送 <code>.Complete</code> 。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"Variable\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> variable = <span class=\"type\">Variable</span>(<span class=\"string\">\"z\"</span>)</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"1\"</span>, sequence: variable)</div><div class=\"line\">    variable.value = <span class=\"string\">\"a\"</span></div><div class=\"line\">    variable.value = <span class=\"string\">\"b\"</span></div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"2\"</span>, sequence: variable)</div><div class=\"line\">    variable.value = <span class=\"string\">\"c\"</span></div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">Variable</span> example ---</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(z)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(a)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Completed</span></div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Transform\"><a href=\"#Transform\" class=\"headerlink\" title=\"Transform\"></a>Transform</h2><p>我们可以对序列做一些转换，类似于 <code>Swift</code> 中 <code>CollectionType</code> 的各种转换。在以前的坑中曾经提到过，可以参考：<a href=\"https://blog.callmewhy.com/2015/05/11/functional-reactive-programming-1/#函数式的函数/\" target=\"_blank\" rel=\"external\">函数式的函数</a>。</p>\n<h3 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map\"></a>map</h3><p><code>map</code> 就是对每个元素都用函数做一次转换，挨个映射一遍。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"map\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> originalSequence = sequenceOf(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>)</div><div class=\"line\">    originalSequence</div><div class=\"line\">        .<span class=\"built_in\">map</span> &#123; $<span class=\"number\">0</span> * <span class=\"number\">2</span> &#125;</div><div class=\"line\">        .subscribe &#123; <span class=\"built_in\">print</span>($<span class=\"number\">0</span>) &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"built_in\">map</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">6</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"flatMap\"><a href=\"#flatMap\" class=\"headerlink\" title=\"flatMap\"></a>flatMap</h3><p><code>map</code> 在做转换的时候很容易出现『升维』的情况，即：转变之后，从一个序列变成了一个序列的序列。</p>\n<p>什么是『升维』？在集合中我们可以举这样一个例子，我有一个好友列表 <code>[p1, p2, p3]</code>，那么如果要获取我好友的好友的列表，可以这样做：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">myFriends.<span class=\"built_in\">map</span> &#123; $<span class=\"number\">0</span>.getFriends() &#125;</div></pre></td></tr></table></figure>\n<p>结果就成了 <code>[[p1-1, p1-2, p1-3], [p2-1], [p3-1, p3-2]]</code> ，这就成了好友的好友列表的列表了。这就是一个『升维』的例子。</p>\n<p>（以上内容文档中依旧没有，依旧是我瞎掰的，依旧欢迎有错误当面打脸(￣ε(#￣)☆╰╮(￣▽￣///))</p>\n<p>在 <code>Swift</code> 中，我们可以用 <code>flatMap</code> 过滤掉 <code>map</code> 之后的 <code>nil</code> 结果。在 <code>Rx</code> 中， <code>flatMap</code> 可以把一个序列转换成一组序列，然后再把这一组序列『拍扁』成一个序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"flatMap\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceInt = sequenceOf(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceString = sequenceOf(<span class=\"string\">\"A\"</span>, <span class=\"string\">\"B\"</span>, <span class=\"string\">\"--\"</span>)</div><div class=\"line\">    sequenceInt</div><div class=\"line\">        .flatMap &#123; int <span class=\"keyword\">in</span></div><div class=\"line\">            sequenceString</div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- flatMap example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">A</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(--)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">A</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(--)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">A</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(--)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"scan\"><a href=\"#scan\" class=\"headerlink\" title=\"scan\"></a>scan</h3><p><code>scan</code> 有点像 <code>reduce</code> ，它会把每次的运算结果累积起来，作为下一次运算的输入值。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"scan\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceToSum = sequenceOf(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>)</div><div class=\"line\">    sequenceToSum</div><div class=\"line\">        .scan(<span class=\"number\">0</span>) &#123; acum, elem <span class=\"keyword\">in</span></div><div class=\"line\">            acum + elem</div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- scan example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">6</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">10</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">15</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Filtering\"><a href=\"#Filtering\" class=\"headerlink\" title=\"Filtering\"></a>Filtering</h2><p>除了上面的各种转换，我们还可以对序列进行过滤。</p>\n<h3 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter\"></a>filter</h3><p><code>filter</code> 只会让符合条件的元素通过。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"filter\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceOf(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>)</div><div class=\"line\">        .<span class=\"built_in\">filter</span> &#123;</div><div class=\"line\">            $<span class=\"number\">0</span> % <span class=\"number\">2</span> == <span class=\"number\">0</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"built_in\">filter</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">6</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">8</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"distinctUntilChanged\"><a href=\"#distinctUntilChanged\" class=\"headerlink\" title=\"distinctUntilChanged\"></a>distinctUntilChanged</h3><p><code>distinctUntilChanged</code> 会废弃掉重复的事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"distinctUntilChanged\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceOf(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">4</span>)</div><div class=\"line\">        .distinctUntilChanged()</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- distinctUntilChanged example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"take\"><a href=\"#take\" class=\"headerlink\" title=\"take\"></a>take</h3><p><code>take</code> 只获取序列中的前 <code>n</code> 个事件，在满足数量之后会自动 <code>.Completed</code> 。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"take\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceOf(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>)</div><div class=\"line\">        .take(<span class=\"number\">3</span>)</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- take example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"throttle-VS-debounce\"><a href=\"#throttle-VS-debounce\" class=\"headerlink\" title=\"throttle VS. debounce\"></a>throttle VS. debounce</h3><p><code>throttle</code> 和 <code>debounce</code> 目的都是控制某个时间段内事件序列的速度。但是又有差别：</p>\n<ul>\n<li><code>debounce</code> : <code>空闲控制</code>  空闲时间必须 <code>&gt;=</code> 固定的时间，事件序列才会被放行</li>\n<li><code>throttle</code> : <code>频率控制</code>  事件序列满足 <code>1/delay</code> 才会被放行</li>\n</ul>\n<p>一般的按钮点击、用户输入、等都属于频率控制，应该使用 <code>throttle</code> 。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">let</span> searchResults = searchBar.rx.text.orEmpty</div><div class=\"line\">    .throttle(<span class=\"number\">0.3</span>, scheduler: <span class=\"type\">MainScheduler</span>.instance)</div><div class=\"line\">    .distinctUntilChanged()</div><div class=\"line\">    .flatMapLatest &#123; query -&gt; <span class=\"type\">Observable</span>&lt;[<span class=\"type\">Repository</span>]&gt; <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"keyword\">if</span> query.isEmpty &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> .just([])</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> searchGitHub(query)</div><div class=\"line\">            .catchErrorJustReturn([])</div><div class=\"line\">    &#125;</div><div class=\"line\">    .observeOn(<span class=\"type\">MainScheduler</span>.instance)</div></pre></td></tr></table></figure>\n<h2 id=\"Combining\"><a href=\"#Combining\" class=\"headerlink\" title=\"Combining\"></a>Combining</h2><p>这部分是关于序列的运算，可以将多个序列源进行组合拼装成一个新的事件序列。</p>\n<h3 id=\"startWith\"><a href=\"#startWith\" class=\"headerlink\" title=\"startWith\"></a>startWith</h3><p><code>startWith</code> 会在队列开始之前插入一个事件元素。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"startWith\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceOf(<span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>)</div><div class=\"line\">        .startWith(<span class=\"number\">3</span>)</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- startWith example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">5</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">6</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"combineLatest\"><a href=\"#combineLatest\" class=\"headerlink\" title=\"combineLatest\"></a>combineLatest</h3><p>如果存在两条事件队列，需要同时监听，那么每当有新的事件发生的时候，<code>combineLatest</code> 会将每个队列的最新的一个元素进行合并。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"combineLatest 1\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> intOb1 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">String</span>&gt;()</div><div class=\"line\">    <span class=\"keyword\">let</span> intOb2 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    combineLatest(intOb1, intOb2) &#123;</div><div class=\"line\">        <span class=\"string\">\"<span class=\"subst\">\\($<span class=\"number\">0</span>)</span> <span class=\"subst\">\\($<span class=\"number\">1</span>)</span>\"</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    intOb1.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"A\"</span>))</div><div class=\"line\">    intOb2.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    intOb1.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"B\"</span>))</div><div class=\"line\">    intOb2.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- combineLatest <span class=\"number\">1</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">A</span> <span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span> <span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span> <span class=\"number\">2</span>)</div></pre></td></tr></table></figure>\n<h3 id=\"zip\"><a href=\"#zip\" class=\"headerlink\" title=\"zip\"></a>zip</h3><p><code>zip</code> 人如其名，就是合并两条队列用的，不过它会等到两个队列的元素一一对应地凑齐了之后再合并，正如<a href=\"http://weibo.com/mrgreenhand\" target=\"_blank\" rel=\"external\">百折不撓的米斯特菜</a>所提醒的， <code>zip</code> 就像是拉链一样，两根拉链拉着拉着合并到了一根上：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"zip 1\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> intOb1 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">String</span>&gt;()</div><div class=\"line\">    <span class=\"keyword\">let</span> intOb2 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    <span class=\"built_in\">zip</span>(intOb1, intOb2) &#123;</div><div class=\"line\">        <span class=\"string\">\"<span class=\"subst\">\\($<span class=\"number\">0</span>)</span> <span class=\"subst\">\\($<span class=\"number\">1</span>)</span>\"</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    intOb1.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"A\"</span>))</div><div class=\"line\">    intOb2.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    intOb1.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"B\"</span>))</div><div class=\"line\">    intOb1.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"C\"</span>))</div><div class=\"line\">    intOb2.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"built_in\">zip</span> <span class=\"number\">1</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">A</span> <span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span> <span class=\"number\">2</span>)</div></pre></td></tr></table></figure>\n<h3 id=\"merge\"><a href=\"#merge\" class=\"headerlink\" title=\"merge\"></a>merge</h3><p><code>merge</code> 就是 <code>merge</code> 啦，把两个队列按照顺序组合在一起。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"merge 1\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subject1 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    <span class=\"keyword\">let</span> subject2 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOf(subject1, subject2)</div><div class=\"line\">        .merge()</div><div class=\"line\">        .subscribeNext &#123; int <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(int)</div><div class=\"line\">        &#125;</div><div class=\"line\">    subject1.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    subject1.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">    subject2.on(.<span class=\"type\">Next</span>(<span class=\"number\">3</span>))</div><div class=\"line\">    subject1.on(.<span class=\"type\">Next</span>(<span class=\"number\">4</span>))</div><div class=\"line\">    subject2.on(.<span class=\"type\">Next</span>(<span class=\"number\">5</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- merge <span class=\"number\">1</span> example ---</div><div class=\"line\"><span class=\"number\">1</span></div><div class=\"line\"><span class=\"number\">2</span></div><div class=\"line\"><span class=\"number\">3</span></div><div class=\"line\"><span class=\"number\">4</span></div><div class=\"line\"><span class=\"number\">5</span></div></pre></td></tr></table></figure>\n<h3 id=\"switch\"><a href=\"#switch\" class=\"headerlink\" title=\"switch\"></a>switch</h3><p>当你的事件序列是一个事件序列的序列 (<code>Observable&lt;Observable&lt;T&gt;&gt;</code>) 的时候，（可以理解成二维序列？），可以使用 <code>switch</code> 将序列的序列平铺成一维，并且在出现新的序列的时候，自动切换到最新的那个序列上。和 <code>merge</code> 相似的是，它也是起到了将多个序列『拍平』成一条序列的作用。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"switchLatest\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> var1 = <span class=\"type\">Variable</span>(<span class=\"number\">0</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> var2 = <span class=\"type\">Variable</span>(<span class=\"number\">200</span>)</div><div class=\"line\">    <span class=\"comment\">// var3 is like an Observable&lt;Observable&lt;Int&gt;&gt;</span></div><div class=\"line\">    <span class=\"keyword\">let</span> var3 = <span class=\"type\">Variable</span>(var1)</div><div class=\"line\">    <span class=\"keyword\">let</span> d = var3</div><div class=\"line\">        .switchLatest()</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    var1.value = <span class=\"number\">1</span></div><div class=\"line\">    var1.value = <span class=\"number\">2</span></div><div class=\"line\">    var1.value = <span class=\"number\">3</span></div><div class=\"line\">    var1.value = <span class=\"number\">4</span></div><div class=\"line\">    var3.value = var2</div><div class=\"line\">    var2.value = <span class=\"number\">201</span></div><div class=\"line\">    var1.value = <span class=\"number\">5</span></div><div class=\"line\">    var3.value = var1</div><div class=\"line\">    var2.value = <span class=\"number\">202</span></div><div class=\"line\">    var1.value = <span class=\"number\">6</span></div><div class=\"line\">&#125;</div><div class=\"line\">--- switchLatest example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">200</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">201</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">5</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">6</span>)</div></pre></td></tr></table></figure>\n<p>注意，虽然都是『拍平』，但是和 <code>flatmap</code> 是不同的， <code>flatmap</code> 是将一条序列变成另一条序列，而这变换过程会让维度变高，所以需要『拍平』，而 <code>switch</code> 是将本来二维的序列（序列的序列）拍平成了一维的序列。</p>\n<h2 id=\"Error-Handling\"><a href=\"#Error-Handling\" class=\"headerlink\" title=\"Error Handling\"></a>Error Handling</h2><p>在事件序列中，遇到异常也是很正常的事情，有以下几种处理异常的手段。</p>\n<h3 id=\"catchError\"><a href=\"#catchError\" class=\"headerlink\" title=\"catchError\"></a>catchError</h3><p><code>catchError</code> 可以捕获异常事件，并且在后面无缝接上另一段事件序列，丝毫没有异常的痕迹。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"catchError 1\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceThatFails = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    <span class=\"keyword\">let</span> recoverySequence = sequenceOf(<span class=\"number\">100</span>, <span class=\"number\">200</span>)</div><div class=\"line\">    sequenceThatFails</div><div class=\"line\">        .catchError &#123; error <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"keyword\">return</span> recoverySequence</div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceThatFails.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceThatFails.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">    sequenceThatFails.on(.<span class=\"type\">Error</span>(<span class=\"type\">NSError</span>(domain: <span class=\"string\">\"Test\"</span>, code: <span class=\"number\">0</span>, userInfo: <span class=\"literal\">nil</span>)))</div><div class=\"line\">&#125;</div><div class=\"line\">--- catchError <span class=\"number\">1</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">100</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">200</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"retry\"><a href=\"#retry\" class=\"headerlink\" title=\"retry\"></a>retry</h3><p><code>retry</code> 顾名思义，就是在出现异常的时候会再去从头订阅事件序列，妄图通过『从头再来』解决异常。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"retry\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> <span class=\"built_in\">count</span> = <span class=\"number\">1</span> <span class=\"comment\">// bad practice, only for example purposes</span></div><div class=\"line\">    <span class=\"keyword\">let</span> funnyLookingSequence: <span class=\"type\">Observable</span>&lt;<span class=\"type\">Int</span>&gt; = create &#123; observer <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"keyword\">let</span> error = <span class=\"type\">NSError</span>(domain: <span class=\"string\">\"Test\"</span>, code: <span class=\"number\">0</span>, userInfo: <span class=\"literal\">nil</span>)</div><div class=\"line\">        observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">0</span>))</div><div class=\"line\">        observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">count</span> &lt; <span class=\"number\">2</span> &#123;</div><div class=\"line\">            observer.on(.<span class=\"type\">Error</span>(error))</div><div class=\"line\">            <span class=\"built_in\">count</span>++</div><div class=\"line\">        &#125;</div><div class=\"line\">        observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">        observer.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">NopDisposable</span>.instance</div><div class=\"line\">    &#125;</div><div class=\"line\">    funnyLookingSequence</div><div class=\"line\">        .retry()</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- retry example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Utility\"><a href=\"#Utility\" class=\"headerlink\" title=\"Utility\"></a>Utility</h2><p>这里列举了针对事件序列的一些方法。</p>\n<h3 id=\"subscribe\"><a href=\"#subscribe\" class=\"headerlink\" title=\"subscribe\"></a>subscribe</h3><p><code>subscribe</code> 在前面已经接触过了，有新的事件就会触发。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"subscribe\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfInts = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOfInts</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">&#125;</div><div class=\"line\">--- subscribe example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"subscribeNext\"><a href=\"#subscribeNext\" class=\"headerlink\" title=\"subscribeNext\"></a>subscribeNext</h3><p><code>subscribeNext</code> 也是订阅，但是只订阅 <code>.Next</code> 事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"subscribeNext\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfInts = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOfInts</div><div class=\"line\">        .subscribeNext &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">&#125;</div><div class=\"line\">--- subscribeNext example ---</div><div class=\"line\"><span class=\"number\">1</span></div></pre></td></tr></table></figure>\n<h3 id=\"subscribeCompleted\"><a href=\"#subscribeCompleted\" class=\"headerlink\" title=\"subscribeCompleted\"></a>subscribeCompleted</h3><p><code>subscribeCompleted</code> 是只订阅 <code>.Completed</code> 完成事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"subscribeCompleted\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfInts = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOfInts</div><div class=\"line\">        .subscribeCompleted &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"It's completed\"</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">&#125;</div><div class=\"line\">--- subscribeCompleted example ---</div><div class=\"line\"><span class=\"type\">It's</span> completed</div></pre></td></tr></table></figure>\n<h3 id=\"subscribeError\"><a href=\"#subscribeError\" class=\"headerlink\" title=\"subscribeError\"></a>subscribeError</h3><p><code>subscribeError</code> 只订阅 <code>.Error</code> 失败事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"subscribeError\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfInts = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOfInts</div><div class=\"line\">        .subscribeError &#123; error <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(error)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Error</span>(<span class=\"type\">NSError</span>(domain: <span class=\"string\">\"Examples\"</span>, code: -<span class=\"number\">1</span>, userInfo: <span class=\"literal\">nil</span>)))</div><div class=\"line\">&#125;</div><div class=\"line\">--- subscribeError example ---</div><div class=\"line\"><span class=\"type\">Error</span> <span class=\"type\">Domain</span>=<span class=\"type\">Examples</span> <span class=\"type\">Code</span>=-<span class=\"number\">1</span> <span class=\"string\">\"The operation couldn’t be completed. (Examples error -1.)\"</span></div></pre></td></tr></table></figure>\n<h3 id=\"doOn\"><a href=\"#doOn\" class=\"headerlink\" title=\"doOn\"></a>doOn</h3><p><code>doOn</code> 可以监听事件，并且在事件发生之前调用。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"doOn\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfInts = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOfInts</div><div class=\"line\">        .doOn &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"Intercepted event <span class=\"subst\">\\($<span class=\"number\">0</span>)</span>\"</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">&#125;</div><div class=\"line\">--- doOn example ---</div><div class=\"line\"><span class=\"type\">Intercepted</span> event <span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Intercepted</span> event <span class=\"type\">Completed</span></div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Conditional\"><a href=\"#Conditional\" class=\"headerlink\" title=\"Conditional\"></a>Conditional</h2><p>我们可以对多个事件序列做一些复杂的逻辑判断。</p>\n<h3 id=\"takeUntil\"><a href=\"#takeUntil\" class=\"headerlink\" title=\"takeUntil\"></a>takeUntil</h3><p><code>takeUntil</code> 其实就是 <code>take</code> ，它会在终于等到那个事件之后触发 <code>.Completed</code> 事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"takeUntil\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> originalSequence = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    <span class=\"keyword\">let</span> whenThisSendsNextWorldStops = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    originalSequence</div><div class=\"line\">        .takeUntil(whenThisSendsNextWorldStops)</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    originalSequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    originalSequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">    whenThisSendsNextWorldStops.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    originalSequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">3</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- takeUntil example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"takeWhile\"><a href=\"#takeWhile\" class=\"headerlink\" title=\"takeWhile\"></a>takeWhile</h3><p><code>takeWhile</code> 则是可以通过状态语句判断是否继续 <code>take</code> 。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"takeWhile\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequence = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequence</div><div class=\"line\">        .takeWhile &#123; int <span class=\"keyword\">in</span></div><div class=\"line\">            int &lt; <span class=\"number\">2</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">    sequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">3</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- takeWhile example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Aggregate\"><a href=\"#Aggregate\" class=\"headerlink\" title=\"Aggregate\"></a>Aggregate</h2><p>我们可以对事件序列做一些集合运算。</p>\n<h3 id=\"concat\"><a href=\"#concat\" class=\"headerlink\" title=\"concat\"></a>concat</h3><p><code>concat</code> 可以把多个事件序列合并起来。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"concat\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> var1 = <span class=\"type\">BehaviorSubject</span>(value: <span class=\"number\">0</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> var2 = <span class=\"type\">BehaviorSubject</span>(value: <span class=\"number\">200</span>)</div><div class=\"line\">    <span class=\"comment\">// var3 is like an Observable&lt;Observable&lt;Int&gt;&gt;</span></div><div class=\"line\">    <span class=\"keyword\">let</span> var3 = <span class=\"type\">BehaviorSubject</span>(value: var1)</div><div class=\"line\">    <span class=\"keyword\">let</span> d = var3</div><div class=\"line\">        .concat()</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    var1.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    var1.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">    var3.on(.<span class=\"type\">Next</span>(var2))</div><div class=\"line\">    var2.on(.<span class=\"type\">Next</span>(<span class=\"number\">201</span>))</div><div class=\"line\">    var1.on(.<span class=\"type\">Next</span>(<span class=\"number\">3</span>))</div><div class=\"line\">    var1.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">    var2.on(.<span class=\"type\">Next</span>(<span class=\"number\">202</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- concat example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">201</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">202</span>)</div></pre></td></tr></table></figure>\n<h3 id=\"reduce\"><a href=\"#reduce\" class=\"headerlink\" title=\"reduce\"></a>reduce</h3><p>这里的 <code>reduce</code> 和 <code>CollectionType</code> 中的 <code>reduce</code> 是一个意思，都是指通过对一系列数据的运算最后生成一个结果。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"reduce\"</span>) &#123;</div><div class=\"line\">    sequenceOf(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>)</div><div class=\"line\">        .<span class=\"built_in\">reduce</span>(<span class=\"number\">0</span>, +)</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"built_in\">reduce</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">45</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Connectable\"><a href=\"#Connectable\" class=\"headerlink\" title=\"Connectable\"></a>Connectable</h2><p>坑待填，Xcode 里这个操场跑不起来了。</p>\n","site":{"data":{}},"excerpt":"<p>记录RxSwift在使用过程中的一些常用语法。</p>","more":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>按照<a href=\"https://blog.callmewhy.com/2015/09/21/rxswift-getting-started-0/\">RxSwift 入坑手册 Part0 - 基础概念</a>格式进行补充。</p>\n<h2 id=\"SupportCode\"><a href=\"#SupportCode\" class=\"headerlink\" title=\"SupportCode\"></a>SupportCode</h2><p>在进入正题之前，先看下项目里的 <code>SupportCode.swift</code> ，主要为 <code>playground</code> 提供了两个便利函数。</p>\n<p>一个是 <code>example</code> 函数，专门用来写示例代码的，统一输出 log 便于标记浏览，同时还能保持变量不污染全局：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">example</span><span class=\"params\">(description: String, action: <span class=\"params\">()</span></span></span> -&gt; ()) &#123;</div><div class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"\\n--- <span class=\"subst\">\\(description)</span> example ---\"</span>)</div><div class=\"line\">    action()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>另一个是 <code>delay</code> 函数，通过 <code>dispatch_after</code> 用来演示延时的：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">delay</span><span class=\"params\">(delay:Double, closure:<span class=\"params\">()</span></span></span>-&gt;()) &#123;</div><div class=\"line\">    dispatch_after(</div><div class=\"line\">        dispatch_time(</div><div class=\"line\">            <span class=\"type\">DISPATCH_TIME_NOW</span>,</div><div class=\"line\">            <span class=\"type\">Int64</span>(delay * <span class=\"type\">Double</span>(<span class=\"type\">NSEC_PER_SEC</span>))</div><div class=\"line\">        ),</div><div class=\"line\">        dispatch_get_main_queue(), closure)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h2><p>主要介绍了 Rx 的基础： <code>Observable</code> 。 <code>Observable&lt;Element&gt;</code> 是观察者模式中被观察的对象，相当于一个事件序列 (<code>GeneratorType</code>) ，会向订阅者发送新产生的事件信息。事件信息分为三种：</p>\n<ul>\n<li>Next(value) 表示新的事件数据。</li>\n<li>Completed 表示事件序列的完结。</li>\n<li>Error 同样表示完结，但是代表异常导致的完结。<br>（打个岔：协议命名，想起来上午汤哥在微博说的一段话：</li>\n</ul>\n<blockquote>\n<p>另外，我觉得 protocol 名字用形容词会更加语义分明，比如 Swift : Flyable, Killable, Visible。全用名词的话显得比较生硬，比如 Swift : Head, Wings, Ass。</p>\n</blockquote>\n<h3 id=\"empty\"><a href=\"#empty\" class=\"headerlink\" title=\"empty\"></a>empty</h3><p><code>empty</code> 是一个空的序列，它只发送 <code>.Completed</code> 消息。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"empty\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> emptySequence: <span class=\"type\">Observable</span>&lt;<span class=\"type\">Int</span>&gt; = empty()</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = emptySequence</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- empty example ---</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"never\"><a href=\"#never\" class=\"headerlink\" title=\"never\"></a>never</h3><p><code>never</code> 是没有任何元素、也不会发送任何事件的空序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"never\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> neverSequence: <span class=\"type\">Observable</span>&lt;<span class=\"type\">String</span>&gt; = never()</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = neverSequence</div><div class=\"line\">        .subscribe &#123; <span class=\"number\">_</span> <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"This block is never called.\"</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">--- never example ---</div></pre></td></tr></table></figure>\n<h3 id=\"just\"><a href=\"#just\" class=\"headerlink\" title=\"just\"></a>just</h3><p><code>just</code> 是只包含一个元素的序列，它会先发送 <code>.Next(value)</code> ，然后发送 <code>.Completed</code> 。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"just\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> singleElementSequence = just(<span class=\"number\">32</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = singleElementSequence</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- just example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">32</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div><div class=\"line\">sequenceOf</div></pre></td></tr></table></figure>\n<p><code>sequenceOf</code> 可以把一系列元素转换成事件序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"sequenceOf\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfElements<span class=\"comment\">/* : Observable&lt;Int&gt; */</span> = sequenceOf(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceOfElements</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- sequenceOf example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div><div class=\"line\">from</div></pre></td></tr></table></figure>\n<p><code>from</code> 是通过 <code>asObservable()</code> 方法把 Swift 中的序列 (<code>SequenceType</code>) 转换成事件序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"from\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceFromArray = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>].asObservable()</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceFromArray</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- from example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">5</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"create\"><a href=\"#create\" class=\"headerlink\" title=\"create\"></a>create</h3><p><code>create</code> 可以通过闭包创建序列，通过 <code>.on(e: Event)</code> 添加事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"create\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> myJust = &#123; (singleElement: <span class=\"type\">Int</span>) -&gt; <span class=\"type\">Observable</span>&lt;<span class=\"type\">Int</span>&gt; <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"keyword\">return</span> create &#123; observer <span class=\"keyword\">in</span></div><div class=\"line\">            observer.on(.<span class=\"type\">Next</span>(singleElement))</div><div class=\"line\">            observer.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"type\">NopDisposable</span>.instance</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = myJust(<span class=\"number\">5</span>)</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- create example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">5</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"failWith\"><a href=\"#failWith\" class=\"headerlink\" title=\"failWith\"></a>failWith</h3><p><code>failWith</code> 创建一个没有元素的序列，只会发送失败 (<code>.Error</code>) 事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"failWith\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> error = <span class=\"type\">NSError</span>(domain: <span class=\"string\">\"Test\"</span>, code: -<span class=\"number\">1</span>, userInfo: <span class=\"literal\">nil</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> erroredSequence: <span class=\"type\">Observable</span>&lt;<span class=\"type\">Int</span>&gt; = failWith(error)</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = erroredSequence</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- failWith example ---</div><div class=\"line\"><span class=\"type\">Error</span>(<span class=\"type\">Error</span> <span class=\"type\">Domain</span>=<span class=\"type\">Test</span> <span class=\"type\">Code</span>=-<span class=\"number\">1</span> <span class=\"string\">\"The operation couldn’t be completed. (Test error -1.)\"</span>)</div></pre></td></tr></table></figure>\n<h3 id=\"deferred\"><a href=\"#deferred\" class=\"headerlink\" title=\"deferred\"></a>deferred</h3><p><code>deferred</code> 会等到有订阅者的时候再通过工厂方法创建 <code>Observable</code> 对象，每个订阅者订阅的对象都是内容相同而完全独立的序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"deferred\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> deferredSequence: <span class=\"type\">Observable</span>&lt;<span class=\"type\">Int</span>&gt; = deferred &#123;</div><div class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"creating\"</span>)</div><div class=\"line\">        <span class=\"keyword\">return</span> create &#123; observer <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"emmiting\"</span>)</div><div class=\"line\">            observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">0</span>))</div><div class=\"line\">            observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">            observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"type\">NopDisposable</span>.instance</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"go\"</span>)</div><div class=\"line\">    deferredSequence</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">    &#125;</div><div class=\"line\">    deferredSequence</div><div class=\"line\">        .subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(event)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- deferred example ---</div><div class=\"line\">go</div><div class=\"line\">creating</div><div class=\"line\">emmiting</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\">creating</div><div class=\"line\">emmiting</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div></pre></td></tr></table></figure>\n<p>为什么需要 <code>defferd</code> 这样一个奇怪的家伙呢？其实这相当于是一种延时加载，因为在添加监听的时候数据未必加载完毕，例如下面这个例子：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"TestDeferred\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> value: <span class=\"type\">String</span>? = <span class=\"literal\">nil</span></div><div class=\"line\">    <span class=\"keyword\">var</span> subscription: <span class=\"type\">Observable</span>&lt;<span class=\"type\">String</span>?&gt; = just(value)</div><div class=\"line\">    <span class=\"comment\">// got value</span></div><div class=\"line\">    value = <span class=\"string\">\"Hello!\"</span></div><div class=\"line\">    subscription.subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"built_in\">print</span>(event)</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">TestDeferred</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"literal\">nil</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<p>如果使用 <code>deffered</code> 则可以正常显示想要的数据：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"TestDeferred\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> value: <span class=\"type\">String</span>? = <span class=\"literal\">nil</span></div><div class=\"line\">    <span class=\"keyword\">var</span> subscription: <span class=\"type\">Observable</span>&lt;<span class=\"type\">String</span>?&gt; = deferred &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> just(value)</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">// got value</span></div><div class=\"line\">    value = <span class=\"string\">\"Hello!\"</span></div><div class=\"line\">    subscription.subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"built_in\">print</span>(event)</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">TestDeferred</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">Optional</span>(<span class=\"string\">\"Hello!\"</span>))</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Subjects\"><a href=\"#Subjects\" class=\"headerlink\" title=\"Subjects\"></a>Subjects</h2><p>接下来是关于 <code>Subject</code> 的内容。 <code>Subject</code> 可以看做是一种代理和桥梁。它既是订阅者又是订阅源，这意味着它既可以订阅其他 <code>Observable</code> 对象，同时又可以对它的订阅者们发送事件。</p>\n<p>如果把 <code>Observable</code> 理解成不断输出事件的水管，那 <code>Subject</code> 就是套在上面的水龙头。它既怼着一根不断出水的水管，同时也向外面输送着新鲜水源。如果你直接用水杯接着水管的水，那可能导出来什么王水胶水完全把持不住；如果你在水龙头下面接着水，那你可以随心所欲的调成你想要的水速和水温。</p>\n<p>（好吧上面一段文档里没有，是我瞎掰的，如果理解错了还望打脸(￣ε(#￣)☆╰╮(￣▽￣///))</p>\n<p>在开始下面的代码之前，先定义一个辅助函数用于输出数据：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">writeSequenceToConsole</span>&lt;O: ObservableType&gt;<span class=\"params\">(name: String, sequence: O)</span></span> &#123;</div><div class=\"line\">    sequence</div><div class=\"line\">        .subscribe &#123; e <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"Subscription: <span class=\"subst\">\\(name)</span>, event: <span class=\"subst\">\\(e)</span>\"</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"PublishSubject\"><a href=\"#PublishSubject\" class=\"headerlink\" title=\"PublishSubject\"></a>PublishSubject</h3><p><code>PublishSubject</code> 会发送订阅者从订阅之后的事件序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"PublishSubject\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subject = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">String</span>&gt;()</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"1\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"a\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"b\"</span>))</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"2\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"c\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"d\"</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">PublishSubject</span> example ---</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(a)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(d)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(d)</div></pre></td></tr></table></figure>\n<h3 id=\"ReplaySubject\"><a href=\"#ReplaySubject\" class=\"headerlink\" title=\"ReplaySubject\"></a>ReplaySubject</h3><p><code>ReplaySubject</code> 在新的订阅对象订阅的时候会补发所有已经发送过的数据队列， <code>bufferSize</code> 是缓冲区的大小，决定了补发队列的最大值。如果 <code>bufferSize</code> 是1，那么新的订阅者出现的时候就会补发上一个事件，如果是2，则补两个，以此类推。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"ReplaySubject\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subject = <span class=\"type\">ReplaySubject</span>&lt;<span class=\"type\">String</span>&gt;.create(bufferSize: <span class=\"number\">1</span>)</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"1\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"a\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"b\"</span>))</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"2\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"c\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"d\"</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">ReplaySubject</span> example ---</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(a)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(b) <span class=\"comment\">// 补了一个 b</span></div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(d)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(d)</div></pre></td></tr></table></figure>\n<h3 id=\"BehaviorSubject\"><a href=\"#BehaviorSubject\" class=\"headerlink\" title=\"BehaviorSubject\"></a>BehaviorSubject</h3><p><code>BehaviorSubject</code> 在新的订阅对象订阅的时候会发送最近发送的事件，如果没有则发送一个默认值。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"BehaviorSubject\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subject = <span class=\"type\">BehaviorSubject</span>(value: <span class=\"string\">\"z\"</span>)</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"1\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"a\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"b\"</span>))</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"2\"</span>, sequence: subject)</div><div class=\"line\">    subject.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"c\"</span>))</div><div class=\"line\">    subject.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">BehaviorSubject</span> example ---</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(z)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(a)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Completed</span></div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"Variable\"><a href=\"#Variable\" class=\"headerlink\" title=\"Variable\"></a>Variable</h3><p><code>Variable</code> 是基于 <code>BehaviorSubject</code> 的一层封装，它的优势是：不会被显式终结。即：不会收到 <code>.Completed</code> 和 <code>.Error</code> 这类的终结事件，它会主动在析构的时候发送 <code>.Complete</code> 。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"Variable\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> variable = <span class=\"type\">Variable</span>(<span class=\"string\">\"z\"</span>)</div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"1\"</span>, sequence: variable)</div><div class=\"line\">    variable.value = <span class=\"string\">\"a\"</span></div><div class=\"line\">    variable.value = <span class=\"string\">\"b\"</span></div><div class=\"line\">    writeSequenceToConsole(<span class=\"string\">\"2\"</span>, sequence: variable)</div><div class=\"line\">    variable.value = <span class=\"string\">\"c\"</span></div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"type\">Variable</span> example ---</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(z)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(a)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(b)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Next</span>(<span class=\"built_in\">c</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">1</span>, event: <span class=\"type\">Completed</span></div><div class=\"line\"><span class=\"type\">Subscription</span>: <span class=\"number\">2</span>, event: <span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Transform\"><a href=\"#Transform\" class=\"headerlink\" title=\"Transform\"></a>Transform</h2><p>我们可以对序列做一些转换，类似于 <code>Swift</code> 中 <code>CollectionType</code> 的各种转换。在以前的坑中曾经提到过，可以参考：<a href=\"https://blog.callmewhy.com/2015/05/11/functional-reactive-programming-1/#函数式的函数/\">函数式的函数</a>。</p>\n<h3 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map\"></a>map</h3><p><code>map</code> 就是对每个元素都用函数做一次转换，挨个映射一遍。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"map\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> originalSequence = sequenceOf(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>)</div><div class=\"line\">    originalSequence</div><div class=\"line\">        .<span class=\"built_in\">map</span> &#123; $<span class=\"number\">0</span> * <span class=\"number\">2</span> &#125;</div><div class=\"line\">        .subscribe &#123; <span class=\"built_in\">print</span>($<span class=\"number\">0</span>) &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"built_in\">map</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">6</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"flatMap\"><a href=\"#flatMap\" class=\"headerlink\" title=\"flatMap\"></a>flatMap</h3><p><code>map</code> 在做转换的时候很容易出现『升维』的情况，即：转变之后，从一个序列变成了一个序列的序列。</p>\n<p>什么是『升维』？在集合中我们可以举这样一个例子，我有一个好友列表 <code>[p1, p2, p3]</code>，那么如果要获取我好友的好友的列表，可以这样做：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">myFriends.<span class=\"built_in\">map</span> &#123; $<span class=\"number\">0</span>.getFriends() &#125;</div></pre></td></tr></table></figure>\n<p>结果就成了 <code>[[p1-1, p1-2, p1-3], [p2-1], [p3-1, p3-2]]</code> ，这就成了好友的好友列表的列表了。这就是一个『升维』的例子。</p>\n<p>（以上内容文档中依旧没有，依旧是我瞎掰的，依旧欢迎有错误当面打脸(￣ε(#￣)☆╰╮(￣▽￣///))</p>\n<p>在 <code>Swift</code> 中，我们可以用 <code>flatMap</code> 过滤掉 <code>map</code> 之后的 <code>nil</code> 结果。在 <code>Rx</code> 中， <code>flatMap</code> 可以把一个序列转换成一组序列，然后再把这一组序列『拍扁』成一个序列。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"flatMap\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceInt = sequenceOf(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceString = sequenceOf(<span class=\"string\">\"A\"</span>, <span class=\"string\">\"B\"</span>, <span class=\"string\">\"--\"</span>)</div><div class=\"line\">    sequenceInt</div><div class=\"line\">        .flatMap &#123; int <span class=\"keyword\">in</span></div><div class=\"line\">            sequenceString</div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- flatMap example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">A</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(--)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">A</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(--)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">A</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(--)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"scan\"><a href=\"#scan\" class=\"headerlink\" title=\"scan\"></a>scan</h3><p><code>scan</code> 有点像 <code>reduce</code> ，它会把每次的运算结果累积起来，作为下一次运算的输入值。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"scan\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceToSum = sequenceOf(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>)</div><div class=\"line\">    sequenceToSum</div><div class=\"line\">        .scan(<span class=\"number\">0</span>) &#123; acum, elem <span class=\"keyword\">in</span></div><div class=\"line\">            acum + elem</div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- scan example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">6</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">10</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">15</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Filtering\"><a href=\"#Filtering\" class=\"headerlink\" title=\"Filtering\"></a>Filtering</h2><p>除了上面的各种转换，我们还可以对序列进行过滤。</p>\n<h3 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter\"></a>filter</h3><p><code>filter</code> 只会让符合条件的元素通过。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"filter\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceOf(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>)</div><div class=\"line\">        .<span class=\"built_in\">filter</span> &#123;</div><div class=\"line\">            $<span class=\"number\">0</span> % <span class=\"number\">2</span> == <span class=\"number\">0</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"built_in\">filter</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">6</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">8</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"distinctUntilChanged\"><a href=\"#distinctUntilChanged\" class=\"headerlink\" title=\"distinctUntilChanged\"></a>distinctUntilChanged</h3><p><code>distinctUntilChanged</code> 会废弃掉重复的事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"distinctUntilChanged\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceOf(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">4</span>)</div><div class=\"line\">        .distinctUntilChanged()</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- distinctUntilChanged example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"take\"><a href=\"#take\" class=\"headerlink\" title=\"take\"></a>take</h3><p><code>take</code> 只获取序列中的前 <code>n</code> 个事件，在满足数量之后会自动 <code>.Completed</code> 。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"take\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceOf(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>)</div><div class=\"line\">        .take(<span class=\"number\">3</span>)</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- take example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"throttle-VS-debounce\"><a href=\"#throttle-VS-debounce\" class=\"headerlink\" title=\"throttle VS. debounce\"></a>throttle VS. debounce</h3><p><code>throttle</code> 和 <code>debounce</code> 目的都是控制某个时间段内事件序列的速度。但是又有差别：</p>\n<ul>\n<li><code>debounce</code> : <code>空闲控制</code>  空闲时间必须 <code>&gt;=</code> 固定的时间，事件序列才会被放行</li>\n<li><code>throttle</code> : <code>频率控制</code>  事件序列满足 <code>1/delay</code> 才会被放行</li>\n</ul>\n<p>一般的按钮点击、用户输入、等都属于频率控制，应该使用 <code>throttle</code> 。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">let</span> searchResults = searchBar.rx.text.orEmpty</div><div class=\"line\">    .throttle(<span class=\"number\">0.3</span>, scheduler: <span class=\"type\">MainScheduler</span>.instance)</div><div class=\"line\">    .distinctUntilChanged()</div><div class=\"line\">    .flatMapLatest &#123; query -&gt; <span class=\"type\">Observable</span>&lt;[<span class=\"type\">Repository</span>]&gt; <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"keyword\">if</span> query.isEmpty &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> .just([])</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> searchGitHub(query)</div><div class=\"line\">            .catchErrorJustReturn([])</div><div class=\"line\">    &#125;</div><div class=\"line\">    .observeOn(<span class=\"type\">MainScheduler</span>.instance)</div></pre></td></tr></table></figure>\n<h2 id=\"Combining\"><a href=\"#Combining\" class=\"headerlink\" title=\"Combining\"></a>Combining</h2><p>这部分是关于序列的运算，可以将多个序列源进行组合拼装成一个新的事件序列。</p>\n<h3 id=\"startWith\"><a href=\"#startWith\" class=\"headerlink\" title=\"startWith\"></a>startWith</h3><p><code>startWith</code> 会在队列开始之前插入一个事件元素。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"startWith\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subscription = sequenceOf(<span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>)</div><div class=\"line\">        .startWith(<span class=\"number\">3</span>)</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- startWith example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">5</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">6</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"combineLatest\"><a href=\"#combineLatest\" class=\"headerlink\" title=\"combineLatest\"></a>combineLatest</h3><p>如果存在两条事件队列，需要同时监听，那么每当有新的事件发生的时候，<code>combineLatest</code> 会将每个队列的最新的一个元素进行合并。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"combineLatest 1\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> intOb1 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">String</span>&gt;()</div><div class=\"line\">    <span class=\"keyword\">let</span> intOb2 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    combineLatest(intOb1, intOb2) &#123;</div><div class=\"line\">        <span class=\"string\">\"<span class=\"subst\">\\($<span class=\"number\">0</span>)</span> <span class=\"subst\">\\($<span class=\"number\">1</span>)</span>\"</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    intOb1.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"A\"</span>))</div><div class=\"line\">    intOb2.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    intOb1.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"B\"</span>))</div><div class=\"line\">    intOb2.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- combineLatest <span class=\"number\">1</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">A</span> <span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span> <span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span> <span class=\"number\">2</span>)</div></pre></td></tr></table></figure>\n<h3 id=\"zip\"><a href=\"#zip\" class=\"headerlink\" title=\"zip\"></a>zip</h3><p><code>zip</code> 人如其名，就是合并两条队列用的，不过它会等到两个队列的元素一一对应地凑齐了之后再合并，正如<a href=\"http://weibo.com/mrgreenhand\">百折不撓的米斯特菜</a>所提醒的， <code>zip</code> 就像是拉链一样，两根拉链拉着拉着合并到了一根上：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"zip 1\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> intOb1 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">String</span>&gt;()</div><div class=\"line\">    <span class=\"keyword\">let</span> intOb2 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    <span class=\"built_in\">zip</span>(intOb1, intOb2) &#123;</div><div class=\"line\">        <span class=\"string\">\"<span class=\"subst\">\\($<span class=\"number\">0</span>)</span> <span class=\"subst\">\\($<span class=\"number\">1</span>)</span>\"</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    intOb1.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"A\"</span>))</div><div class=\"line\">    intOb2.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    intOb1.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"B\"</span>))</div><div class=\"line\">    intOb1.on(.<span class=\"type\">Next</span>(<span class=\"string\">\"C\"</span>))</div><div class=\"line\">    intOb2.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"built_in\">zip</span> <span class=\"number\">1</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">A</span> <span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"type\">B</span> <span class=\"number\">2</span>)</div></pre></td></tr></table></figure>\n<h3 id=\"merge\"><a href=\"#merge\" class=\"headerlink\" title=\"merge\"></a>merge</h3><p><code>merge</code> 就是 <code>merge</code> 啦，把两个队列按照顺序组合在一起。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"merge 1\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> subject1 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    <span class=\"keyword\">let</span> subject2 = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOf(subject1, subject2)</div><div class=\"line\">        .merge()</div><div class=\"line\">        .subscribeNext &#123; int <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(int)</div><div class=\"line\">        &#125;</div><div class=\"line\">    subject1.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    subject1.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">    subject2.on(.<span class=\"type\">Next</span>(<span class=\"number\">3</span>))</div><div class=\"line\">    subject1.on(.<span class=\"type\">Next</span>(<span class=\"number\">4</span>))</div><div class=\"line\">    subject2.on(.<span class=\"type\">Next</span>(<span class=\"number\">5</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- merge <span class=\"number\">1</span> example ---</div><div class=\"line\"><span class=\"number\">1</span></div><div class=\"line\"><span class=\"number\">2</span></div><div class=\"line\"><span class=\"number\">3</span></div><div class=\"line\"><span class=\"number\">4</span></div><div class=\"line\"><span class=\"number\">5</span></div></pre></td></tr></table></figure>\n<h3 id=\"switch\"><a href=\"#switch\" class=\"headerlink\" title=\"switch\"></a>switch</h3><p>当你的事件序列是一个事件序列的序列 (<code>Observable&lt;Observable&lt;T&gt;&gt;</code>) 的时候，（可以理解成二维序列？），可以使用 <code>switch</code> 将序列的序列平铺成一维，并且在出现新的序列的时候，自动切换到最新的那个序列上。和 <code>merge</code> 相似的是，它也是起到了将多个序列『拍平』成一条序列的作用。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"switchLatest\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> var1 = <span class=\"type\">Variable</span>(<span class=\"number\">0</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> var2 = <span class=\"type\">Variable</span>(<span class=\"number\">200</span>)</div><div class=\"line\">    <span class=\"comment\">// var3 is like an Observable&lt;Observable&lt;Int&gt;&gt;</span></div><div class=\"line\">    <span class=\"keyword\">let</span> var3 = <span class=\"type\">Variable</span>(var1)</div><div class=\"line\">    <span class=\"keyword\">let</span> d = var3</div><div class=\"line\">        .switchLatest()</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    var1.value = <span class=\"number\">1</span></div><div class=\"line\">    var1.value = <span class=\"number\">2</span></div><div class=\"line\">    var1.value = <span class=\"number\">3</span></div><div class=\"line\">    var1.value = <span class=\"number\">4</span></div><div class=\"line\">    var3.value = var2</div><div class=\"line\">    var2.value = <span class=\"number\">201</span></div><div class=\"line\">    var1.value = <span class=\"number\">5</span></div><div class=\"line\">    var3.value = var1</div><div class=\"line\">    var2.value = <span class=\"number\">202</span></div><div class=\"line\">    var1.value = <span class=\"number\">6</span></div><div class=\"line\">&#125;</div><div class=\"line\">--- switchLatest example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">200</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">201</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">5</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">6</span>)</div></pre></td></tr></table></figure>\n<p>注意，虽然都是『拍平』，但是和 <code>flatmap</code> 是不同的， <code>flatmap</code> 是将一条序列变成另一条序列，而这变换过程会让维度变高，所以需要『拍平』，而 <code>switch</code> 是将本来二维的序列（序列的序列）拍平成了一维的序列。</p>\n<h2 id=\"Error-Handling\"><a href=\"#Error-Handling\" class=\"headerlink\" title=\"Error Handling\"></a>Error Handling</h2><p>在事件序列中，遇到异常也是很正常的事情，有以下几种处理异常的手段。</p>\n<h3 id=\"catchError\"><a href=\"#catchError\" class=\"headerlink\" title=\"catchError\"></a>catchError</h3><p><code>catchError</code> 可以捕获异常事件，并且在后面无缝接上另一段事件序列，丝毫没有异常的痕迹。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"catchError 1\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceThatFails = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    <span class=\"keyword\">let</span> recoverySequence = sequenceOf(<span class=\"number\">100</span>, <span class=\"number\">200</span>)</div><div class=\"line\">    sequenceThatFails</div><div class=\"line\">        .catchError &#123; error <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"keyword\">return</span> recoverySequence</div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceThatFails.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceThatFails.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">    sequenceThatFails.on(.<span class=\"type\">Error</span>(<span class=\"type\">NSError</span>(domain: <span class=\"string\">\"Test\"</span>, code: <span class=\"number\">0</span>, userInfo: <span class=\"literal\">nil</span>)))</div><div class=\"line\">&#125;</div><div class=\"line\">--- catchError <span class=\"number\">1</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">100</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">200</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"retry\"><a href=\"#retry\" class=\"headerlink\" title=\"retry\"></a>retry</h3><p><code>retry</code> 顾名思义，就是在出现异常的时候会再去从头订阅事件序列，妄图通过『从头再来』解决异常。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"retry\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> <span class=\"built_in\">count</span> = <span class=\"number\">1</span> <span class=\"comment\">// bad practice, only for example purposes</span></div><div class=\"line\">    <span class=\"keyword\">let</span> funnyLookingSequence: <span class=\"type\">Observable</span>&lt;<span class=\"type\">Int</span>&gt; = create &#123; observer <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"keyword\">let</span> error = <span class=\"type\">NSError</span>(domain: <span class=\"string\">\"Test\"</span>, code: <span class=\"number\">0</span>, userInfo: <span class=\"literal\">nil</span>)</div><div class=\"line\">        observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">0</span>))</div><div class=\"line\">        observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">count</span> &lt; <span class=\"number\">2</span> &#123;</div><div class=\"line\">            observer.on(.<span class=\"type\">Error</span>(error))</div><div class=\"line\">            <span class=\"built_in\">count</span>++</div><div class=\"line\">        &#125;</div><div class=\"line\">        observer.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">        observer.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">NopDisposable</span>.instance</div><div class=\"line\">    &#125;</div><div class=\"line\">    funnyLookingSequence</div><div class=\"line\">        .retry()</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- retry example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Utility\"><a href=\"#Utility\" class=\"headerlink\" title=\"Utility\"></a>Utility</h2><p>这里列举了针对事件序列的一些方法。</p>\n<h3 id=\"subscribe\"><a href=\"#subscribe\" class=\"headerlink\" title=\"subscribe\"></a>subscribe</h3><p><code>subscribe</code> 在前面已经接触过了，有新的事件就会触发。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"subscribe\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfInts = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOfInts</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">&#125;</div><div class=\"line\">--- subscribe example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"subscribeNext\"><a href=\"#subscribeNext\" class=\"headerlink\" title=\"subscribeNext\"></a>subscribeNext</h3><p><code>subscribeNext</code> 也是订阅，但是只订阅 <code>.Next</code> 事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"subscribeNext\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfInts = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOfInts</div><div class=\"line\">        .subscribeNext &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">&#125;</div><div class=\"line\">--- subscribeNext example ---</div><div class=\"line\"><span class=\"number\">1</span></div></pre></td></tr></table></figure>\n<h3 id=\"subscribeCompleted\"><a href=\"#subscribeCompleted\" class=\"headerlink\" title=\"subscribeCompleted\"></a>subscribeCompleted</h3><p><code>subscribeCompleted</code> 是只订阅 <code>.Completed</code> 完成事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"subscribeCompleted\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfInts = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOfInts</div><div class=\"line\">        .subscribeCompleted &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"It's completed\"</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">&#125;</div><div class=\"line\">--- subscribeCompleted example ---</div><div class=\"line\"><span class=\"type\">It's</span> completed</div></pre></td></tr></table></figure>\n<h3 id=\"subscribeError\"><a href=\"#subscribeError\" class=\"headerlink\" title=\"subscribeError\"></a>subscribeError</h3><p><code>subscribeError</code> 只订阅 <code>.Error</code> 失败事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"subscribeError\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfInts = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOfInts</div><div class=\"line\">        .subscribeError &#123; error <span class=\"keyword\">in</span></div><div class=\"line\">            <span class=\"built_in\">print</span>(error)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Error</span>(<span class=\"type\">NSError</span>(domain: <span class=\"string\">\"Examples\"</span>, code: -<span class=\"number\">1</span>, userInfo: <span class=\"literal\">nil</span>)))</div><div class=\"line\">&#125;</div><div class=\"line\">--- subscribeError example ---</div><div class=\"line\"><span class=\"type\">Error</span> <span class=\"type\">Domain</span>=<span class=\"type\">Examples</span> <span class=\"type\">Code</span>=-<span class=\"number\">1</span> <span class=\"string\">\"The operation couldn’t be completed. (Examples error -1.)\"</span></div></pre></td></tr></table></figure>\n<h3 id=\"doOn\"><a href=\"#doOn\" class=\"headerlink\" title=\"doOn\"></a>doOn</h3><p><code>doOn</code> 可以监听事件，并且在事件发生之前调用。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"doOn\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequenceOfInts = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequenceOfInts</div><div class=\"line\">        .doOn &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"Intercepted event <span class=\"subst\">\\($<span class=\"number\">0</span>)</span>\"</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequenceOfInts.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">&#125;</div><div class=\"line\">--- doOn example ---</div><div class=\"line\"><span class=\"type\">Intercepted</span> event <span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Intercepted</span> event <span class=\"type\">Completed</span></div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Conditional\"><a href=\"#Conditional\" class=\"headerlink\" title=\"Conditional\"></a>Conditional</h2><p>我们可以对多个事件序列做一些复杂的逻辑判断。</p>\n<h3 id=\"takeUntil\"><a href=\"#takeUntil\" class=\"headerlink\" title=\"takeUntil\"></a>takeUntil</h3><p><code>takeUntil</code> 其实就是 <code>take</code> ，它会在终于等到那个事件之后触发 <code>.Completed</code> 事件。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"takeUntil\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> originalSequence = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    <span class=\"keyword\">let</span> whenThisSendsNextWorldStops = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    originalSequence</div><div class=\"line\">        .takeUntil(whenThisSendsNextWorldStops)</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    originalSequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    originalSequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">    whenThisSendsNextWorldStops.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    originalSequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">3</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- takeUntil example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h3 id=\"takeWhile\"><a href=\"#takeWhile\" class=\"headerlink\" title=\"takeWhile\"></a>takeWhile</h3><p><code>takeWhile</code> 则是可以通过状态语句判断是否继续 <code>take</code> 。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"takeWhile\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> sequence = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">Int</span>&gt;()</div><div class=\"line\">    sequence</div><div class=\"line\">        .takeWhile &#123; int <span class=\"keyword\">in</span></div><div class=\"line\">            int &lt; <span class=\"number\">2</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    sequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    sequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">    sequence.on(.<span class=\"type\">Next</span>(<span class=\"number\">3</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- takeWhile example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Aggregate\"><a href=\"#Aggregate\" class=\"headerlink\" title=\"Aggregate\"></a>Aggregate</h2><p>我们可以对事件序列做一些集合运算。</p>\n<h3 id=\"concat\"><a href=\"#concat\" class=\"headerlink\" title=\"concat\"></a>concat</h3><p><code>concat</code> 可以把多个事件序列合并起来。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"concat\"</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> var1 = <span class=\"type\">BehaviorSubject</span>(value: <span class=\"number\">0</span>)</div><div class=\"line\">    <span class=\"keyword\">let</span> var2 = <span class=\"type\">BehaviorSubject</span>(value: <span class=\"number\">200</span>)</div><div class=\"line\">    <span class=\"comment\">// var3 is like an Observable&lt;Observable&lt;Int&gt;&gt;</span></div><div class=\"line\">    <span class=\"keyword\">let</span> var3 = <span class=\"type\">BehaviorSubject</span>(value: var1)</div><div class=\"line\">    <span class=\"keyword\">let</span> d = var3</div><div class=\"line\">        .concat()</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    var1.on(.<span class=\"type\">Next</span>(<span class=\"number\">1</span>))</div><div class=\"line\">    var1.on(.<span class=\"type\">Next</span>(<span class=\"number\">2</span>))</div><div class=\"line\">    var3.on(.<span class=\"type\">Next</span>(var2))</div><div class=\"line\">    var2.on(.<span class=\"type\">Next</span>(<span class=\"number\">201</span>))</div><div class=\"line\">    var1.on(.<span class=\"type\">Next</span>(<span class=\"number\">3</span>))</div><div class=\"line\">    var1.on(.<span class=\"type\">Completed</span>)</div><div class=\"line\">    var2.on(.<span class=\"type\">Next</span>(<span class=\"number\">202</span>))</div><div class=\"line\">&#125;</div><div class=\"line\">--- concat example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">0</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">201</span>)</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">202</span>)</div></pre></td></tr></table></figure>\n<h3 id=\"reduce\"><a href=\"#reduce\" class=\"headerlink\" title=\"reduce\"></a>reduce</h3><p>这里的 <code>reduce</code> 和 <code>CollectionType</code> 中的 <code>reduce</code> 是一个意思，都是指通过对一系列数据的运算最后生成一个结果。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">example(<span class=\"string\">\"reduce\"</span>) &#123;</div><div class=\"line\">    sequenceOf(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>)</div><div class=\"line\">        .<span class=\"built_in\">reduce</span>(<span class=\"number\">0</span>, +)</div><div class=\"line\">        .subscribe &#123;</div><div class=\"line\">            <span class=\"built_in\">print</span>($<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">--- <span class=\"built_in\">reduce</span> example ---</div><div class=\"line\"><span class=\"type\">Next</span>(<span class=\"number\">45</span>)</div><div class=\"line\"><span class=\"type\">Completed</span></div></pre></td></tr></table></figure>\n<h2 id=\"Connectable\"><a href=\"#Connectable\" class=\"headerlink\" title=\"Connectable\"></a>Connectable</h2><p>坑待填，Xcode 里这个操场跑不起来了。</p>"},{"title":"开发小记","date":"2016-07-28T06:52:22.000Z","_content":"\n\n开发中的小笔记。记录开发中的点滴滴点。\n\n<!--more-->\n\n- 批量正则替换的另一种思路\n  ```\n  #!/base/sh\n  find . -name '*.swift' | while read file; do\n    perl -i -lpe 's/if \\(([^\\)].*)\\) \\{/if $1 \\{/g' $file\n  done\n  ```\n\n- 批量删除空格组成的空行中的空格\n  ```\n  #!/base/sh\n  find . -name '*.swift' | while read file; do\n    sed -i '' 's/^[[:space:]][[:space:]]*$//g' $file\n  done\n  ```\n\n- NAN\n  - 当`NSUInteger 0 - 1`时，运算结果为 NAN，iOS中有一个宏`isnan(x)`返回是否为nan。另外这里有一篇文章[Objective-C 中 判断 NaN](http://blog.csdn.net/toss156/article/details/7101885)大致记录了一下\n  ```objc\n  //  math.h  #56\n\n  #if defined(__GNUC__)\n  #   define    HUGE_VAL     __builtin_huge_val()\n  #   define    HUGE_VALF    __builtin_huge_valf()\n  #   define    HUGE_VALL    __builtin_huge_vall()\n  #   define    NAN          __builtin_nanf(\"0x7fc00000\")\n  #else\n  #   define    HUGE_VAL     1e500\n  #   define    HUGE_VALF    1e50f\n  #   define    HUGE_VALL    1e5000L\n  #   define    NAN          __nan()\n  #endif\n\n```\n  \n  - 另外，NAN不能直接判断 == 需要调用下面的宏。否则会发生莫名其妙的问题\n  ``` objc\n    //  math.h  #178\n\n  #define isnan(x)                                                         \\\n      ( sizeof(x) == sizeof(float)  ? __inline_isnanf((float)(x))          \\\n      : sizeof(x) == sizeof(double) ? __inline_isnand((double)(x))         \\\n                                    : __inline_isnanl((long double)(x)))\n```\n\n- 论项目架构设计的重要性 \n  - 规范化\n  - 筛选的坑 \n  - 常见布局BUG \n  - 线程安全\n  \n- 百度地图的坑\n  - 设置经纬度缓慢\n  - 刷新缓慢\n\n- 选择图片时候默认方法选择不到系统的云端图片，但是默认单张选择器却可以！\n  - 16G手机存储空间不够，图片转到了云端，会出现相册中的照片无法选择的情况\n  \n- 无埋点技术的讨论\n\n- 多个window的显示、删除、操作问题\n\n- 使用HTTP架设日志实时显示系统","source":"_posts/note.md","raw":"---\ntitle: 开发小记\ndate: 2016-07-28 14:52:22\ntags: \ncategories:\n    - 笔记\n---\n\n\n开发中的小笔记。记录开发中的点滴滴点。\n\n<!--more-->\n\n- 批量正则替换的另一种思路\n  ```\n  #!/base/sh\n  find . -name '*.swift' | while read file; do\n    perl -i -lpe 's/if \\(([^\\)].*)\\) \\{/if $1 \\{/g' $file\n  done\n  ```\n\n- 批量删除空格组成的空行中的空格\n  ```\n  #!/base/sh\n  find . -name '*.swift' | while read file; do\n    sed -i '' 's/^[[:space:]][[:space:]]*$//g' $file\n  done\n  ```\n\n- NAN\n  - 当`NSUInteger 0 - 1`时，运算结果为 NAN，iOS中有一个宏`isnan(x)`返回是否为nan。另外这里有一篇文章[Objective-C 中 判断 NaN](http://blog.csdn.net/toss156/article/details/7101885)大致记录了一下\n  ```objc\n  //  math.h  #56\n\n  #if defined(__GNUC__)\n  #   define    HUGE_VAL     __builtin_huge_val()\n  #   define    HUGE_VALF    __builtin_huge_valf()\n  #   define    HUGE_VALL    __builtin_huge_vall()\n  #   define    NAN          __builtin_nanf(\"0x7fc00000\")\n  #else\n  #   define    HUGE_VAL     1e500\n  #   define    HUGE_VALF    1e50f\n  #   define    HUGE_VALL    1e5000L\n  #   define    NAN          __nan()\n  #endif\n\n```\n  \n  - 另外，NAN不能直接判断 == 需要调用下面的宏。否则会发生莫名其妙的问题\n  ``` objc\n    //  math.h  #178\n\n  #define isnan(x)                                                         \\\n      ( sizeof(x) == sizeof(float)  ? __inline_isnanf((float)(x))          \\\n      : sizeof(x) == sizeof(double) ? __inline_isnand((double)(x))         \\\n                                    : __inline_isnanl((long double)(x)))\n```\n\n- 论项目架构设计的重要性 \n  - 规范化\n  - 筛选的坑 \n  - 常见布局BUG \n  - 线程安全\n  \n- 百度地图的坑\n  - 设置经纬度缓慢\n  - 刷新缓慢\n\n- 选择图片时候默认方法选择不到系统的云端图片，但是默认单张选择器却可以！\n  - 16G手机存储空间不够，图片转到了云端，会出现相册中的照片无法选择的情况\n  \n- 无埋点技术的讨论\n\n- 多个window的显示、删除、操作问题\n\n- 使用HTTP架设日志实时显示系统","slug":"note","published":1,"updated":"2017-02-09T10:37:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0fa0000ul0uvvim9795k","content":"<p>开发中的小笔记。记录开发中的点滴滴点。</p>\n<a id=\"more\"></a>\n<ul>\n<li><p>批量正则替换的另一种思路</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">#!/base/sh</div><div class=\"line\">find . -name &apos;*.swift&apos; | while read file; do</div><div class=\"line\">  perl -i -lpe &apos;s/if \\(([^\\)].*)\\) \\&#123;/if $1 \\&#123;/g&apos; $file</div><div class=\"line\">done</div></pre></td></tr></table></figure>\n</li>\n<li><p>批量删除空格组成的空行中的空格</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">#!/base/sh</div><div class=\"line\">find . -name &apos;*.swift&apos; | while read file; do</div><div class=\"line\">  sed -i &apos;&apos; &apos;s/^[[:space:]][[:space:]]*$//g&apos; $file</div><div class=\"line\">done</div></pre></td></tr></table></figure>\n</li>\n<li><p>NAN</p>\n<ul>\n<li>当<code>NSUInteger 0 - 1</code>时，运算结果为 NAN，iOS中有一个宏<code>isnan(x)</code>返回是否为nan。另外这里有一篇文章<a href=\"http://blog.csdn.net/toss156/article/details/7101885\" target=\"_blank\" rel=\"external\">Objective-C 中 判断 NaN</a>大致记录了一下<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//  math.h  #56</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#if defined(__GNUC__)</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VAL     __builtin_huge_val()</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VALF    __builtin_huge_valf()</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VALL    __builtin_huge_vall()</span></div><div class=\"line\"><span class=\"meta\">#   define    NAN          __builtin_nanf(<span class=\"meta-string\">\"0x7fc00000\"</span>)</span></div><div class=\"line\"><span class=\"meta\">#else</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VAL     1e500</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VALF    1e50f</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VALL    1e5000L</span></div><div class=\"line\"><span class=\"meta\">#   define    NAN          __nan()</span></div><div class=\"line\"><span class=\"meta\">#endif</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>另外，NAN不能直接判断 == 需要调用下面的宏。否则会发生莫名其妙的问题<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">//  math.h  #178</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#define isnan(x)                                                         \\</span></div><div class=\"line\">    ( <span class=\"keyword\">sizeof</span>(x) == <span class=\"keyword\">sizeof</span>(<span class=\"keyword\">float</span>)  ? __inline_isnanf((<span class=\"keyword\">float</span>)(x))          \\</div><div class=\"line\">    : <span class=\"keyword\">sizeof</span>(x) == <span class=\"keyword\">sizeof</span>(<span class=\"keyword\">double</span>) ? __inline_isnand((<span class=\"keyword\">double</span>)(x))         \\</div><div class=\"line\">                                  : __inline_isnanl((<span class=\"keyword\">long</span> <span class=\"keyword\">double</span>)(x)))</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>论项目架构设计的重要性 </p>\n<ul>\n<li>规范化</li>\n<li>筛选的坑 </li>\n<li>常见布局BUG </li>\n<li>线程安全</li>\n</ul>\n</li>\n<li><p>百度地图的坑</p>\n<ul>\n<li>设置经纬度缓慢</li>\n<li>刷新缓慢</li>\n</ul>\n</li>\n<li><p>选择图片时候默认方法选择不到系统的云端图片，但是默认单张选择器却可以！</p>\n<ul>\n<li>16G手机存储空间不够，图片转到了云端，会出现相册中的照片无法选择的情况</li>\n</ul>\n</li>\n<li><p>无埋点技术的讨论</p>\n</li>\n<li><p>多个window的显示、删除、操作问题</p>\n</li>\n<li><p>使用HTTP架设日志实时显示系统</p>\n</li>\n</ul>\n","excerpt":"<p>开发中的小笔记。记录开发中的点滴滴点。</p>","more":"<ul>\n<li><p>批量正则替换的另一种思路</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">#!/base/sh</div><div class=\"line\">find . -name &apos;*.swift&apos; | while read file; do</div><div class=\"line\">  perl -i -lpe &apos;s/if \\(([^\\)].*)\\) \\&#123;/if $1 \\&#123;/g&apos; $file</div><div class=\"line\">done</div></pre></td></tr></table></figure>\n</li>\n<li><p>批量删除空格组成的空行中的空格</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">#!/base/sh</div><div class=\"line\">find . -name &apos;*.swift&apos; | while read file; do</div><div class=\"line\">  sed -i &apos;&apos; &apos;s/^[[:space:]][[:space:]]*$//g&apos; $file</div><div class=\"line\">done</div></pre></td></tr></table></figure>\n</li>\n<li><p>NAN</p>\n<ul>\n<li>当<code>NSUInteger 0 - 1</code>时，运算结果为 NAN，iOS中有一个宏<code>isnan(x)</code>返回是否为nan。另外这里有一篇文章<a href=\"http://blog.csdn.net/toss156/article/details/7101885\">Objective-C 中 判断 NaN</a>大致记录了一下<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//  math.h  #56</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#if defined(__GNUC__)</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VAL     __builtin_huge_val()</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VALF    __builtin_huge_valf()</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VALL    __builtin_huge_vall()</span></div><div class=\"line\"><span class=\"meta\">#   define    NAN          __builtin_nanf(<span class=\"meta-string\">\"0x7fc00000\"</span>)</span></div><div class=\"line\"><span class=\"meta\">#else</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VAL     1e500</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VALF    1e50f</span></div><div class=\"line\"><span class=\"meta\">#   define    HUGE_VALL    1e5000L</span></div><div class=\"line\"><span class=\"meta\">#   define    NAN          __nan()</span></div><div class=\"line\"><span class=\"meta\">#endif</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>另外，NAN不能直接判断 == 需要调用下面的宏。否则会发生莫名其妙的问题<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">  <span class=\"comment\">//  math.h  #178</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#define isnan(x)                                                         \\</span></div><div class=\"line\">    ( <span class=\"keyword\">sizeof</span>(x) == <span class=\"keyword\">sizeof</span>(<span class=\"keyword\">float</span>)  ? __inline_isnanf((<span class=\"keyword\">float</span>)(x))          \\</div><div class=\"line\">    : <span class=\"keyword\">sizeof</span>(x) == <span class=\"keyword\">sizeof</span>(<span class=\"keyword\">double</span>) ? __inline_isnand((<span class=\"keyword\">double</span>)(x))         \\</div><div class=\"line\">                                  : __inline_isnanl((<span class=\"keyword\">long</span> <span class=\"keyword\">double</span>)(x)))</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>论项目架构设计的重要性 </p>\n<ul>\n<li>规范化</li>\n<li>筛选的坑 </li>\n<li>常见布局BUG </li>\n<li>线程安全</li>\n</ul>\n</li>\n<li><p>百度地图的坑</p>\n<ul>\n<li>设置经纬度缓慢</li>\n<li>刷新缓慢</li>\n</ul>\n</li>\n<li><p>选择图片时候默认方法选择不到系统的云端图片，但是默认单张选择器却可以！</p>\n<ul>\n<li>16G手机存储空间不够，图片转到了云端，会出现相册中的照片无法选择的情况</li>\n</ul>\n</li>\n<li><p>无埋点技术的讨论</p>\n</li>\n<li><p>多个window的显示、删除、操作问题</p>\n</li>\n<li><p>使用HTTP架设日志实时显示系统</p>\n</li>\n</ul>"},{"title":"准备食用RAC(ReactiveCocoa)的顾虑","date":"2016-07-12T01:53:14.000Z","_content":"\n对于目前的项目，如果引用RAC，会对项目造成哪些影响的相关思考。\n\n<!--more-->\n\n# 说明\n\n众所周知，RAC很火，有很多崇拜者。本文只是一个新手第一次使用RAC时候所顾忌的一些问题，如果有比较好的解决方案及时告知我，我会及时更改。\n\n\n# OC简单食用方法\n\n先来个例子代码：\n\n```objc\n\n    RACSignal *RSignal = [[self.R rac_newValueChannelWithNilValue:@0] startWith:@(self.R.value)];\n    RACSignal *GSignal = [[self.G rac_newValueChannelWithNilValue:@0] startWith:@(self.G.value)];\n    RACSignal *BSignal = [[self.B rac_newValueChannelWithNilValue:@0] startWith:@(self.B.value)];\n\n    NSString*(^valueFormat)(NSNumber *value) = ^(NSNumber *value) {\n        return [NSString stringWithFormat:@\"%.0f\", [value doubleValue]*255];\n    };\n    \n    [RSignal subscribeNext:^(id x) {\n        self.RVaule.text = valueFormat(x);\n    }];\n    [GSignal subscribeNext:^(id x) {\n        self.GValue.text = valueFormat(x);\n    }];\n    [BSignal subscribeNext:^(id x) {\n        self.BValue.text = valueFormat(x);\n    }];\n    \n```\n\n是不是超级简单！\n\n\n## 顾虑\n\n可是我有一个问题：\n\n- OC属于运行时语法，这个里面的`id x`的不确定因素可能会导致类型识别出现错误。如果说项目是多人维护，那么A可能不知道B写的Signal走的类型是什么，所以这个问题就不适用于松散的多人开发。如果需要使用RAC恐怕需要在项目启动时进行规避这些不确定的问题才能引入。\n\n\n# Swift简单食用方法\n\n在[ReactiveCocoa](https://github.com/ReactiveCocoa/ReactiveCocoa)的[README.md](https://github.com/ReactiveCocoa/ReactiveCocoa#objective-c-and-swift)中有这么一段话：\n\n> ## Objective-C and Swift\n>\n  Although ReactiveCocoa was started as an Objective-C framework, as of [version\n  3.0][CHANGELOG], all major feature development is concentrated on the [Swift API][].\n>\n  RAC’s [Objective-C API][] and Swift API are entirely separate, but there is\n  a [bridge][Objective-C Bridging] to convert between the two. This\n  is mostly meant as a compatibility layer for older ReactiveCocoa projects, or to\n  use Cocoa extensions which haven’t been added to the Swift API yet.\n>\n  The Objective-C API will continue to exist and be supported for the foreseeable\n  future, but it won’t receive many improvements. For more information about using\n  this API, please consult our [legacy documentation][].\n>\n  **We highly recommend that all new projects use the Swift API.**\n","source":"_posts/reactivecocoa-ready-to-use.md","raw":"---\ntitle: 准备食用RAC(ReactiveCocoa)的顾虑\ndate: 2016-07-12 09:53:14\ntags: \n  - iOS\n  - ReactiveCocoa\n---\n\n对于目前的项目，如果引用RAC，会对项目造成哪些影响的相关思考。\n\n<!--more-->\n\n# 说明\n\n众所周知，RAC很火，有很多崇拜者。本文只是一个新手第一次使用RAC时候所顾忌的一些问题，如果有比较好的解决方案及时告知我，我会及时更改。\n\n\n# OC简单食用方法\n\n先来个例子代码：\n\n```objc\n\n    RACSignal *RSignal = [[self.R rac_newValueChannelWithNilValue:@0] startWith:@(self.R.value)];\n    RACSignal *GSignal = [[self.G rac_newValueChannelWithNilValue:@0] startWith:@(self.G.value)];\n    RACSignal *BSignal = [[self.B rac_newValueChannelWithNilValue:@0] startWith:@(self.B.value)];\n\n    NSString*(^valueFormat)(NSNumber *value) = ^(NSNumber *value) {\n        return [NSString stringWithFormat:@\"%.0f\", [value doubleValue]*255];\n    };\n    \n    [RSignal subscribeNext:^(id x) {\n        self.RVaule.text = valueFormat(x);\n    }];\n    [GSignal subscribeNext:^(id x) {\n        self.GValue.text = valueFormat(x);\n    }];\n    [BSignal subscribeNext:^(id x) {\n        self.BValue.text = valueFormat(x);\n    }];\n    \n```\n\n是不是超级简单！\n\n\n## 顾虑\n\n可是我有一个问题：\n\n- OC属于运行时语法，这个里面的`id x`的不确定因素可能会导致类型识别出现错误。如果说项目是多人维护，那么A可能不知道B写的Signal走的类型是什么，所以这个问题就不适用于松散的多人开发。如果需要使用RAC恐怕需要在项目启动时进行规避这些不确定的问题才能引入。\n\n\n# Swift简单食用方法\n\n在[ReactiveCocoa](https://github.com/ReactiveCocoa/ReactiveCocoa)的[README.md](https://github.com/ReactiveCocoa/ReactiveCocoa#objective-c-and-swift)中有这么一段话：\n\n> ## Objective-C and Swift\n>\n  Although ReactiveCocoa was started as an Objective-C framework, as of [version\n  3.0][CHANGELOG], all major feature development is concentrated on the [Swift API][].\n>\n  RAC’s [Objective-C API][] and Swift API are entirely separate, but there is\n  a [bridge][Objective-C Bridging] to convert between the two. This\n  is mostly meant as a compatibility layer for older ReactiveCocoa projects, or to\n  use Cocoa extensions which haven’t been added to the Swift API yet.\n>\n  The Objective-C API will continue to exist and be supported for the foreseeable\n  future, but it won’t receive many improvements. For more information about using\n  this API, please consult our [legacy documentation][].\n>\n  **We highly recommend that all new projects use the Swift API.**\n","slug":"reactivecocoa-ready-to-use","published":1,"updated":"2016-10-22T14:00:13.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0fa1000vl0uv4w4q9yh5","content":"<p>对于目前的项目，如果引用RAC，会对项目造成哪些影响的相关思考。</p>\n<a id=\"more\"></a>\n<h1 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h1><p>众所周知，RAC很火，有很多崇拜者。本文只是一个新手第一次使用RAC时候所顾忌的一些问题，如果有比较好的解决方案及时告知我，我会及时更改。</p>\n<h1 id=\"OC简单食用方法\"><a href=\"#OC简单食用方法\" class=\"headerlink\" title=\"OC简单食用方法\"></a>OC简单食用方法</h1><p>先来个例子代码：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">RACSignal *RSignal = [[<span class=\"keyword\">self</span>.R rac_newValueChannelWithNilValue:@<span class=\"number\">0</span>] startWith:@(<span class=\"keyword\">self</span>.R.value)];</div><div class=\"line\">RACSignal *GSignal = [[<span class=\"keyword\">self</span>.G rac_newValueChannelWithNilValue:@<span class=\"number\">0</span>] startWith:@(<span class=\"keyword\">self</span>.G.value)];</div><div class=\"line\">RACSignal *BSignal = [[<span class=\"keyword\">self</span>.B rac_newValueChannelWithNilValue:@<span class=\"number\">0</span>] startWith:@(<span class=\"keyword\">self</span>.B.value)];</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">NSString</span>*(^valueFormat)(<span class=\"built_in\">NSNumber</span> *value) = ^(<span class=\"built_in\">NSNumber</span> *value) &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"built_in\">NSString</span> stringWithFormat:<span class=\"string\">@\"%.0f\"</span>, [value doubleValue]*<span class=\"number\">255</span>];</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\">[RSignal subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</div><div class=\"line\">    <span class=\"keyword\">self</span>.RVaule.text = valueFormat(x);</div><div class=\"line\">&#125;];</div><div class=\"line\">[GSignal subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</div><div class=\"line\">    <span class=\"keyword\">self</span>.GValue.text = valueFormat(x);</div><div class=\"line\">&#125;];</div><div class=\"line\">[BSignal subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</div><div class=\"line\">    <span class=\"keyword\">self</span>.BValue.text = valueFormat(x);</div><div class=\"line\">&#125;];</div></pre></td></tr></table></figure>\n<p>是不是超级简单！</p>\n<h2 id=\"顾虑\"><a href=\"#顾虑\" class=\"headerlink\" title=\"顾虑\"></a>顾虑</h2><p>可是我有一个问题：</p>\n<ul>\n<li>OC属于运行时语法，这个里面的<code>id x</code>的不确定因素可能会导致类型识别出现错误。如果说项目是多人维护，那么A可能不知道B写的Signal走的类型是什么，所以这个问题就不适用于松散的多人开发。如果需要使用RAC恐怕需要在项目启动时进行规避这些不确定的问题才能引入。</li>\n</ul>\n<h1 id=\"Swift简单食用方法\"><a href=\"#Swift简单食用方法\" class=\"headerlink\" title=\"Swift简单食用方法\"></a>Swift简单食用方法</h1><p>在<a href=\"https://github.com/ReactiveCocoa/ReactiveCocoa\" target=\"_blank\" rel=\"external\">ReactiveCocoa</a>的<a href=\"https://github.com/ReactiveCocoa/ReactiveCocoa#objective-c-and-swift\" target=\"_blank\" rel=\"external\">README.md</a>中有这么一段话：</p>\n<blockquote>\n<h2 id=\"Objective-C-and-Swift\"><a href=\"#Objective-C-and-Swift\" class=\"headerlink\" title=\"Objective-C and Swift\"></a>Objective-C and Swift</h2><p>  Although ReactiveCocoa was started as an Objective-C framework, as of [version<br>  3.0][CHANGELOG], all major feature development is concentrated on the [Swift API][].</p>\n<p>  RAC’s [Objective-C API][] and Swift API are entirely separate, but there is<br>  a [bridge][Objective-C Bridging] to convert between the two. This<br>  is mostly meant as a compatibility layer for older ReactiveCocoa projects, or to<br>  use Cocoa extensions which haven’t been added to the Swift API yet.</p>\n<p>  The Objective-C API will continue to exist and be supported for the foreseeable<br>  future, but it won’t receive many improvements. For more information about using<br>  this API, please consult our [legacy documentation][].</p>\n<p>  <strong>We highly recommend that all new projects use the Swift API.</strong></p>\n</blockquote>\n","excerpt":"<p>对于目前的项目，如果引用RAC，会对项目造成哪些影响的相关思考。</p>","more":"<h1 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h1><p>众所周知，RAC很火，有很多崇拜者。本文只是一个新手第一次使用RAC时候所顾忌的一些问题，如果有比较好的解决方案及时告知我，我会及时更改。</p>\n<h1 id=\"OC简单食用方法\"><a href=\"#OC简单食用方法\" class=\"headerlink\" title=\"OC简单食用方法\"></a>OC简单食用方法</h1><p>先来个例子代码：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">RACSignal *RSignal = [[<span class=\"keyword\">self</span>.R rac_newValueChannelWithNilValue:@<span class=\"number\">0</span>] startWith:@(<span class=\"keyword\">self</span>.R.value)];</div><div class=\"line\">RACSignal *GSignal = [[<span class=\"keyword\">self</span>.G rac_newValueChannelWithNilValue:@<span class=\"number\">0</span>] startWith:@(<span class=\"keyword\">self</span>.G.value)];</div><div class=\"line\">RACSignal *BSignal = [[<span class=\"keyword\">self</span>.B rac_newValueChannelWithNilValue:@<span class=\"number\">0</span>] startWith:@(<span class=\"keyword\">self</span>.B.value)];</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">NSString</span>*(^valueFormat)(<span class=\"built_in\">NSNumber</span> *value) = ^(<span class=\"built_in\">NSNumber</span> *value) &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"built_in\">NSString</span> stringWithFormat:<span class=\"string\">@\"%.0f\"</span>, [value doubleValue]*<span class=\"number\">255</span>];</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\">[RSignal subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</div><div class=\"line\">    <span class=\"keyword\">self</span>.RVaule.text = valueFormat(x);</div><div class=\"line\">&#125;];</div><div class=\"line\">[GSignal subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</div><div class=\"line\">    <span class=\"keyword\">self</span>.GValue.text = valueFormat(x);</div><div class=\"line\">&#125;];</div><div class=\"line\">[BSignal subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</div><div class=\"line\">    <span class=\"keyword\">self</span>.BValue.text = valueFormat(x);</div><div class=\"line\">&#125;];</div></pre></td></tr></table></figure>\n<p>是不是超级简单！</p>\n<h2 id=\"顾虑\"><a href=\"#顾虑\" class=\"headerlink\" title=\"顾虑\"></a>顾虑</h2><p>可是我有一个问题：</p>\n<ul>\n<li>OC属于运行时语法，这个里面的<code>id x</code>的不确定因素可能会导致类型识别出现错误。如果说项目是多人维护，那么A可能不知道B写的Signal走的类型是什么，所以这个问题就不适用于松散的多人开发。如果需要使用RAC恐怕需要在项目启动时进行规避这些不确定的问题才能引入。</li>\n</ul>\n<h1 id=\"Swift简单食用方法\"><a href=\"#Swift简单食用方法\" class=\"headerlink\" title=\"Swift简单食用方法\"></a>Swift简单食用方法</h1><p>在<a href=\"https://github.com/ReactiveCocoa/ReactiveCocoa\">ReactiveCocoa</a>的<a href=\"https://github.com/ReactiveCocoa/ReactiveCocoa#objective-c-and-swift\">README.md</a>中有这么一段话：</p>\n<blockquote>\n<h2 id=\"Objective-C-and-Swift\"><a href=\"#Objective-C-and-Swift\" class=\"headerlink\" title=\"Objective-C and Swift\"></a>Objective-C and Swift</h2><p>  Although ReactiveCocoa was started as an Objective-C framework, as of [version<br>  3.0][CHANGELOG], all major feature development is concentrated on the [Swift API][].</p>\n<p>  RAC’s [Objective-C API][] and Swift API are entirely separate, but there is<br>  a [bridge][Objective-C Bridging] to convert between the two. This<br>  is mostly meant as a compatibility layer for older ReactiveCocoa projects, or to<br>  use Cocoa extensions which haven’t been added to the Swift API yet.</p>\n<p>  The Objective-C API will continue to exist and be supported for the foreseeable<br>  future, but it won’t receive many improvements. For more information about using<br>  this API, please consult our [legacy documentation][].</p>\n<p>  <strong>We highly recommend that all new projects use the Swift API.</strong></p>\n</blockquote>"},{"title":"Swift 编译时性能优化笔记","date":"2017-01-17T05:47:17.000Z","_content":"\nXcode在编译Swift代码的时候速度会越来越慢，就此查找原因，并列出自己的优化思路。\n\n<!--more-->\n\n### 针对运算符`??`的优化\n\n在使用`??`时，并不是所有的都需要优化，包裹在循环中的`??`会比较耗时比较厉害，目前不知道为啥，估计编译的时候需要检查的此时比较多吧😂。\n\n#### 尝试显式解包\n\n__思路__：`??`编译慢，就不用`??`，直接使用`if else`\n__实施__: 由于工程中使用的`??`比较多，所以比较修改起来比较麻烦。但是可以解决问题。真不行写方法转化调用喽。。\n\n#### 错误的尝试了重载运算符`??`方式\n\n__思路__: `??`运算符编译耗时较多，直觉是`??`实现有复杂的操作,重新按照显式解包的方案进行实现。\n__实施__: \n- 分析`??`的使用场景，左侧为T?,右侧为T，返回值T\n- 重载函数名定义`public func ?? <T>(left: T?, right: T) -> T`\n- 实现\n- 编译\n- error：`Ambiguous use of operator '??'`\n- 思考：这丫的在重载运算符的时候不能使用泛型吧。。\n- 更改函数为`public func ?? <Any>(left: Any?, right: Any) -> Any`\n- PL. OK了，可是问题来了，系统的`??`是可以返回对应的类型，可是这样重载之后返回一个`Any`，代码中如果出现`let str = str1 ?? \"\"`则str类型就变为`Any`而不是`String`。__巨坑__\n- 顾不了那么多了，真不行一个一个跑。于是先修改一个较为严重的`String`类型。\n- 尝试编译，结果时间惊人的没有变化。。依旧居高不下\n- 以失败告终。。\n\n__总结__: 这个`??`耗时较多并不是因为`??`的实现有问题，__猜测__是在为`??`准备左右参数的时候需要进行一层层的解包确定类型，再加上`??`可能有重载版本，进行类型匹配的时候比较耗时。\n\n#### 尝试扩展方法进行优化\n\n__思路__: 既然运算符会导致编译慢，那么就尝试使用方法直接进行转换。\n__实现__: 代码如下：\n```swift\nstruct Operator {\n    ///  ==> ??\n    static func `try`<T>(_ origin: T?, _ then: T) -> T {\n        guard let value = origin else {\n            return then\n        }\n        return value\n    }\n}\n```\n\n测试发现上述方法可以优化时间。\n\n---------\n\n### 以下原文出自：[关于 Swift 编译时性能优化的一些思考](https://github.com/yllziv/gold-miner/blob/1bfbb3deefd27138097415422bec2bb7e98e9715/TODO/regarding-swift-build-time-optimizations.md)\n\n---------\n\n>* 原文链接 : [Regarding Swift build time optimizations](https://medium.com/@RobertGummesson/regarding-swift-build-time-optimizations-fc92cdd91e31#.w81y3zhjr)\n* 原文作者 : [Robert Gummesson](https://medium.com/@RobertGummesson)\n* 译文出自 : [掘金翻译计划](https://github.com/xitu/gold-miner)\n* 译者 : [杨龙龙](http://www.yanglonglong.com)\n* 校对者: [申冠华](https://github.com/shenAlexy), [Jack King](https://github.com/Jack-Kingdom)\n\n![](http://ww3.sinaimg.cn/large/005SiNxygw1f3p3jimjllj31jk0dwqft.jpg)\n\n#### 关于 Swift 编译时性能优化的一些思考\n\n上周，我读了 [@nickoneill](https://medium.com/@nickoneill) 一篇优秀的帖子 [Speeding Up Slow Swift Build Times](https://medium.com/swift-programming/speeding-up-slow-swift-build-times-922feeba5780#.k0pngnkns) 之后，我发现用一个略不同以往的角度去读Swift代码，并不是很难。\n\n一行之前很简洁的代码，现在却出现了新的问题——它是否应该重构为9行代码来达到更快的编译速度？ (_nil coalescing 运算符就是一个例子_)孰轻孰重？简洁的代码还是对编译器友好的代码？ 我觉得，它取决于项目的大小和开发者的想法。\n\n#### 但请等等... 这里有一个Xcode插件\n\n在讲一些例子之前，我首先想到了通过手工提取日志信息是非常耗时的事情。通过命令行工具实现会相对容易一些，但是我把它往前推进了一步：集成为[Xcode插件](https://github.com/RobertGummesson/BuildTimeAnalyzer-for-Xcode)。\n\n![](http://ww1.sinaimg.cn/large/005SiNxygw1f3p3hhivppj30m809lwis.jpg)\n\n在这个例子中，最初的目的仅仅是识别并修复代码中最耗时的地方，但是现在我觉得它成为了一个必须要迭代的过程。这样我才可以更加高效地构建代码，并且防止在项目中出现耗时的函数。\n\n#### 不少惊喜\n\n我经常在不同的 Git 分支中跳转，并且等待一个暖慢的项目编译简直是在浪费我的生命。因此我思考了很长时间，一个玩具项目（大约两万行 Swift 代码）会编译如此长的时间。\n\n当我知道是什么原因导致它如此慢之后，我不得不承认我震惊了，一行代码居然需要几秒的编译时间。\n\n让我们来看几个例子。\n\n#### Nil 合并运算符\n\n编译器肯定不喜欢这里的第一种方法。在展开下面两处简写的代码之后，构建时间减少了 **99.4%**。\n\n    // 构建时间： 5238.3ms\n    return CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height)\n\n    // 构建时间： 32.4ms\n    var padding: CGFloat = 22\n    if let rightView = rightView {\n        padding += rightView.bounds.width\n    }\n\n    if let leftView = leftView {\n        padding += leftView.bounds.width\n    }\n    return CGSizeMake(size.width + padding, bounds.height)\n\n#### ArrayOfStuff + [Stuff]\n\n这个看起来像下面这样：\n\n    return ArrayOfStuff + [Stuff]  \n    // 而不是  \n    ArrayOfStuff.append(stuff)  \n    return ArrayOfStuff\n\n我经常这么做，并且它影响了每次构建的时间。下面是最糟糕的一个例子，改写后构建时间可以减少 **97.9%**。\n\n    // 构建时间： 1250.3ms\n    let systemOptions = [ 7, 14, 30, -1 ]\n    let systemNames = (0...2).map{ String(format: localizedFormat, systemOptions[$0]) } + [NSLocalizedString(\"everything\", comment: \"\")]\n    // Some code in-between \n    labelNames = Array(systemNames[0..<count]) + [systemNames.last!]\n\n    // 构建时间： 25.5ms\n    let systemOptions = [ 7, 14, 30, -1 ]\n    var systemNames = systemOptions.dropLast().map{ String(format: localizedFormat, $0) }\n    systemNames.append(NSLocalizedString(\"everything\", comment: \"\"))\n    // Some code in-between\n    labelNames = Array(systemNames[0..<count])\n    labelNames.append(systemNames.last!)\n\n#### 三元运算符\n\n仅仅是通过替换三元运算符为 if else 语句就能减少 **92.9%** 的构建时间。如果使用一个for循环替换 _map_ 函数，它又能减少另一个 75%（但是我的眼睛可就受不了咯😉）。\n\n    // 构建时间： 239.0ms\n    let labelNames = type == 0 ? (1...5).map{type0ToString($0)} : (0...2).map{type1ToString($0)}\n\n    // 构建时间： 16.9ms\n    var labelNames: [String]\n    if type == 0 {\n        labelNames = (1...5).map{type0ToString($0)}\n    } else {\n        labelNames = (0...2).map{type1ToString($0)}\n    }\n\n#### 转换 CGFloat 到 CGFloat\n\n这里我所说的并不一定正确。变量已经使用了 CGFloat 并且有一些括号也是多余的。在清理了这些冗余之后，构建时间能减少 **99.9%**。\n\n    // 构建时间： 3431.7 ms\n    return CGFloat(M_PI) * (CGFloat((hour + hourDelta + CGFloat(minute + minuteDelta) / 60) * 5) - 15) * unit / 180\n\n    // 构建时间： 3.0ms\n    return CGFloat(M_PI) * ((hour + hourDelta + (minute + minuteDelta) / 60) * 5 - 15) * unit / 180\n\n#### Round()\n\n这个一个非常奇怪的例子，下面的例子中变量是一个局部变量与实例变量的混合。这个问题可能不是四舍五入本身，而是结合代码的方法。去掉四舍五入的方法大概能减少 **97.6%** 的构建时间。\n\n    // 构建时间： 1433.7ms\n    let expansion = a — b — c + round(d * 0.66) + e\n    // 构建时间： 34.7ms\n    let expansion = a — b — c + d * 0.66 + e\n\n注意：所有的测试都在 MacBook Air (13-inch, Mid 2013)中进行。\n\n#### 尝试它\n\n无论你是否面临过构建时间太长的问题，编写对编译器友好的代码都是非常有用的。我确定你自己会在其中找到一些惊喜。作为参考，这里有完整的代码，在我的工程中可以5秒内完成编译...\n\n    import UIKit\n\n    class CMExpandingTextField: UITextField {\n\n        func textFieldEditingChanged() {\n            invalidateIntrinsicContentSize()\n        }\n\n        override func intrinsicContentSize() -> CGSize {\n            if isFirstResponder(), let text = text {\n                let size = text.sizeWithAttributes(typingAttributes)\n                return CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height)\n            }\n            return super.intrinsicContentSize()\n        }\n    }\n\n","source":"_posts/swift-build-times.md","raw":"---\ntitle: Swift 编译时性能优化笔记\ndate: 2017-01-17 13:47:17\ntags:\n---\n\nXcode在编译Swift代码的时候速度会越来越慢，就此查找原因，并列出自己的优化思路。\n\n<!--more-->\n\n### 针对运算符`??`的优化\n\n在使用`??`时，并不是所有的都需要优化，包裹在循环中的`??`会比较耗时比较厉害，目前不知道为啥，估计编译的时候需要检查的此时比较多吧😂。\n\n#### 尝试显式解包\n\n__思路__：`??`编译慢，就不用`??`，直接使用`if else`\n__实施__: 由于工程中使用的`??`比较多，所以比较修改起来比较麻烦。但是可以解决问题。真不行写方法转化调用喽。。\n\n#### 错误的尝试了重载运算符`??`方式\n\n__思路__: `??`运算符编译耗时较多，直觉是`??`实现有复杂的操作,重新按照显式解包的方案进行实现。\n__实施__: \n- 分析`??`的使用场景，左侧为T?,右侧为T，返回值T\n- 重载函数名定义`public func ?? <T>(left: T?, right: T) -> T`\n- 实现\n- 编译\n- error：`Ambiguous use of operator '??'`\n- 思考：这丫的在重载运算符的时候不能使用泛型吧。。\n- 更改函数为`public func ?? <Any>(left: Any?, right: Any) -> Any`\n- PL. OK了，可是问题来了，系统的`??`是可以返回对应的类型，可是这样重载之后返回一个`Any`，代码中如果出现`let str = str1 ?? \"\"`则str类型就变为`Any`而不是`String`。__巨坑__\n- 顾不了那么多了，真不行一个一个跑。于是先修改一个较为严重的`String`类型。\n- 尝试编译，结果时间惊人的没有变化。。依旧居高不下\n- 以失败告终。。\n\n__总结__: 这个`??`耗时较多并不是因为`??`的实现有问题，__猜测__是在为`??`准备左右参数的时候需要进行一层层的解包确定类型，再加上`??`可能有重载版本，进行类型匹配的时候比较耗时。\n\n#### 尝试扩展方法进行优化\n\n__思路__: 既然运算符会导致编译慢，那么就尝试使用方法直接进行转换。\n__实现__: 代码如下：\n```swift\nstruct Operator {\n    ///  ==> ??\n    static func `try`<T>(_ origin: T?, _ then: T) -> T {\n        guard let value = origin else {\n            return then\n        }\n        return value\n    }\n}\n```\n\n测试发现上述方法可以优化时间。\n\n---------\n\n### 以下原文出自：[关于 Swift 编译时性能优化的一些思考](https://github.com/yllziv/gold-miner/blob/1bfbb3deefd27138097415422bec2bb7e98e9715/TODO/regarding-swift-build-time-optimizations.md)\n\n---------\n\n>* 原文链接 : [Regarding Swift build time optimizations](https://medium.com/@RobertGummesson/regarding-swift-build-time-optimizations-fc92cdd91e31#.w81y3zhjr)\n* 原文作者 : [Robert Gummesson](https://medium.com/@RobertGummesson)\n* 译文出自 : [掘金翻译计划](https://github.com/xitu/gold-miner)\n* 译者 : [杨龙龙](http://www.yanglonglong.com)\n* 校对者: [申冠华](https://github.com/shenAlexy), [Jack King](https://github.com/Jack-Kingdom)\n\n![](http://ww3.sinaimg.cn/large/005SiNxygw1f3p3jimjllj31jk0dwqft.jpg)\n\n#### 关于 Swift 编译时性能优化的一些思考\n\n上周，我读了 [@nickoneill](https://medium.com/@nickoneill) 一篇优秀的帖子 [Speeding Up Slow Swift Build Times](https://medium.com/swift-programming/speeding-up-slow-swift-build-times-922feeba5780#.k0pngnkns) 之后，我发现用一个略不同以往的角度去读Swift代码，并不是很难。\n\n一行之前很简洁的代码，现在却出现了新的问题——它是否应该重构为9行代码来达到更快的编译速度？ (_nil coalescing 运算符就是一个例子_)孰轻孰重？简洁的代码还是对编译器友好的代码？ 我觉得，它取决于项目的大小和开发者的想法。\n\n#### 但请等等... 这里有一个Xcode插件\n\n在讲一些例子之前，我首先想到了通过手工提取日志信息是非常耗时的事情。通过命令行工具实现会相对容易一些，但是我把它往前推进了一步：集成为[Xcode插件](https://github.com/RobertGummesson/BuildTimeAnalyzer-for-Xcode)。\n\n![](http://ww1.sinaimg.cn/large/005SiNxygw1f3p3hhivppj30m809lwis.jpg)\n\n在这个例子中，最初的目的仅仅是识别并修复代码中最耗时的地方，但是现在我觉得它成为了一个必须要迭代的过程。这样我才可以更加高效地构建代码，并且防止在项目中出现耗时的函数。\n\n#### 不少惊喜\n\n我经常在不同的 Git 分支中跳转，并且等待一个暖慢的项目编译简直是在浪费我的生命。因此我思考了很长时间，一个玩具项目（大约两万行 Swift 代码）会编译如此长的时间。\n\n当我知道是什么原因导致它如此慢之后，我不得不承认我震惊了，一行代码居然需要几秒的编译时间。\n\n让我们来看几个例子。\n\n#### Nil 合并运算符\n\n编译器肯定不喜欢这里的第一种方法。在展开下面两处简写的代码之后，构建时间减少了 **99.4%**。\n\n    // 构建时间： 5238.3ms\n    return CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height)\n\n    // 构建时间： 32.4ms\n    var padding: CGFloat = 22\n    if let rightView = rightView {\n        padding += rightView.bounds.width\n    }\n\n    if let leftView = leftView {\n        padding += leftView.bounds.width\n    }\n    return CGSizeMake(size.width + padding, bounds.height)\n\n#### ArrayOfStuff + [Stuff]\n\n这个看起来像下面这样：\n\n    return ArrayOfStuff + [Stuff]  \n    // 而不是  \n    ArrayOfStuff.append(stuff)  \n    return ArrayOfStuff\n\n我经常这么做，并且它影响了每次构建的时间。下面是最糟糕的一个例子，改写后构建时间可以减少 **97.9%**。\n\n    // 构建时间： 1250.3ms\n    let systemOptions = [ 7, 14, 30, -1 ]\n    let systemNames = (0...2).map{ String(format: localizedFormat, systemOptions[$0]) } + [NSLocalizedString(\"everything\", comment: \"\")]\n    // Some code in-between \n    labelNames = Array(systemNames[0..<count]) + [systemNames.last!]\n\n    // 构建时间： 25.5ms\n    let systemOptions = [ 7, 14, 30, -1 ]\n    var systemNames = systemOptions.dropLast().map{ String(format: localizedFormat, $0) }\n    systemNames.append(NSLocalizedString(\"everything\", comment: \"\"))\n    // Some code in-between\n    labelNames = Array(systemNames[0..<count])\n    labelNames.append(systemNames.last!)\n\n#### 三元运算符\n\n仅仅是通过替换三元运算符为 if else 语句就能减少 **92.9%** 的构建时间。如果使用一个for循环替换 _map_ 函数，它又能减少另一个 75%（但是我的眼睛可就受不了咯😉）。\n\n    // 构建时间： 239.0ms\n    let labelNames = type == 0 ? (1...5).map{type0ToString($0)} : (0...2).map{type1ToString($0)}\n\n    // 构建时间： 16.9ms\n    var labelNames: [String]\n    if type == 0 {\n        labelNames = (1...5).map{type0ToString($0)}\n    } else {\n        labelNames = (0...2).map{type1ToString($0)}\n    }\n\n#### 转换 CGFloat 到 CGFloat\n\n这里我所说的并不一定正确。变量已经使用了 CGFloat 并且有一些括号也是多余的。在清理了这些冗余之后，构建时间能减少 **99.9%**。\n\n    // 构建时间： 3431.7 ms\n    return CGFloat(M_PI) * (CGFloat((hour + hourDelta + CGFloat(minute + minuteDelta) / 60) * 5) - 15) * unit / 180\n\n    // 构建时间： 3.0ms\n    return CGFloat(M_PI) * ((hour + hourDelta + (minute + minuteDelta) / 60) * 5 - 15) * unit / 180\n\n#### Round()\n\n这个一个非常奇怪的例子，下面的例子中变量是一个局部变量与实例变量的混合。这个问题可能不是四舍五入本身，而是结合代码的方法。去掉四舍五入的方法大概能减少 **97.6%** 的构建时间。\n\n    // 构建时间： 1433.7ms\n    let expansion = a — b — c + round(d * 0.66) + e\n    // 构建时间： 34.7ms\n    let expansion = a — b — c + d * 0.66 + e\n\n注意：所有的测试都在 MacBook Air (13-inch, Mid 2013)中进行。\n\n#### 尝试它\n\n无论你是否面临过构建时间太长的问题，编写对编译器友好的代码都是非常有用的。我确定你自己会在其中找到一些惊喜。作为参考，这里有完整的代码，在我的工程中可以5秒内完成编译...\n\n    import UIKit\n\n    class CMExpandingTextField: UITextField {\n\n        func textFieldEditingChanged() {\n            invalidateIntrinsicContentSize()\n        }\n\n        override func intrinsicContentSize() -> CGSize {\n            if isFirstResponder(), let text = text {\n                let size = text.sizeWithAttributes(typingAttributes)\n                return CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height)\n            }\n            return super.intrinsicContentSize()\n        }\n    }\n\n","slug":"swift-build-times","published":1,"updated":"2017-02-06T08:37:12.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0fa4000zl0uvb6rxz6ia","content":"<p>Xcode在编译Swift代码的时候速度会越来越慢，就此查找原因，并列出自己的优化思路。</p>\n<a id=\"more\"></a>\n<h3 id=\"针对运算符-的优化\"><a href=\"#针对运算符-的优化\" class=\"headerlink\" title=\"针对运算符??的优化\"></a>针对运算符<code>??</code>的优化</h3><p>在使用<code>??</code>时，并不是所有的都需要优化，包裹在循环中的<code>??</code>会比较耗时比较厉害，目前不知道为啥，估计编译的时候需要检查的此时比较多吧😂。</p>\n<h4 id=\"尝试显式解包\"><a href=\"#尝试显式解包\" class=\"headerlink\" title=\"尝试显式解包\"></a>尝试显式解包</h4><p><strong>思路</strong>：<code>??</code>编译慢，就不用<code>??</code>，直接使用<code>if else</code><br><strong>实施</strong>: 由于工程中使用的<code>??</code>比较多，所以比较修改起来比较麻烦。但是可以解决问题。真不行写方法转化调用喽。。</p>\n<h4 id=\"错误的尝试了重载运算符-方式\"><a href=\"#错误的尝试了重载运算符-方式\" class=\"headerlink\" title=\"错误的尝试了重载运算符??方式\"></a>错误的尝试了重载运算符<code>??</code>方式</h4><p><strong>思路</strong>: <code>??</code>运算符编译耗时较多，直觉是<code>??</code>实现有复杂的操作,重新按照显式解包的方案进行实现。<br><strong>实施</strong>: </p>\n<ul>\n<li>分析<code>??</code>的使用场景，左侧为T?,右侧为T，返回值T</li>\n<li>重载函数名定义<code>public func ?? &lt;T&gt;(left: T?, right: T) -&gt; T</code></li>\n<li>实现</li>\n<li>编译</li>\n<li>error：<code>Ambiguous use of operator &#39;??&#39;</code></li>\n<li>思考：这丫的在重载运算符的时候不能使用泛型吧。。</li>\n<li>更改函数为<code>public func ?? &lt;Any&gt;(left: Any?, right: Any) -&gt; Any</code></li>\n<li>PL. OK了，可是问题来了，系统的<code>??</code>是可以返回对应的类型，可是这样重载之后返回一个<code>Any</code>，代码中如果出现<code>let str = str1 ?? &quot;&quot;</code>则str类型就变为<code>Any</code>而不是<code>String</code>。<strong>巨坑</strong></li>\n<li>顾不了那么多了，真不行一个一个跑。于是先修改一个较为严重的<code>String</code>类型。</li>\n<li>尝试编译，结果时间惊人的没有变化。。依旧居高不下</li>\n<li>以失败告终。。</li>\n</ul>\n<p><strong>总结</strong>: 这个<code>??</code>耗时较多并不是因为<code>??</code>的实现有问题，<strong>猜测</strong>是在为<code>??</code>准备左右参数的时候需要进行一层层的解包确定类型，再加上<code>??</code>可能有重载版本，进行类型匹配的时候比较耗时。</p>\n<h4 id=\"尝试扩展方法进行优化\"><a href=\"#尝试扩展方法进行优化\" class=\"headerlink\" title=\"尝试扩展方法进行优化\"></a>尝试扩展方法进行优化</h4><p><strong>思路</strong>: 既然运算符会导致编译慢，那么就尝试使用方法直接进行转换。<br><strong>实现</strong>: 代码如下：<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Operator</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">///  ==&gt; ??</span></div><div class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> `<span class=\"title\">try</span>`&lt;T&gt;<span class=\"params\">(<span class=\"number\">_</span> origin: T?, <span class=\"number\">_</span> then: T)</span></span> -&gt; <span class=\"type\">T</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> value = origin <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> then</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> value</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>测试发现上述方法可以优化时间。</p>\n<hr>\n<h3 id=\"以下原文出自：关于-Swift-编译时性能优化的一些思考\"><a href=\"#以下原文出自：关于-Swift-编译时性能优化的一些思考\" class=\"headerlink\" title=\"以下原文出自：关于 Swift 编译时性能优化的一些思考\"></a>以下原文出自：<a href=\"https://github.com/yllziv/gold-miner/blob/1bfbb3deefd27138097415422bec2bb7e98e9715/TODO/regarding-swift-build-time-optimizations.md\" target=\"_blank\" rel=\"external\">关于 Swift 编译时性能优化的一些思考</a></h3><hr>\n<blockquote>\n<ul>\n<li>原文链接 : <a href=\"https://medium.com/@RobertGummesson/regarding-swift-build-time-optimizations-fc92cdd91e31#.w81y3zhjr\" target=\"_blank\" rel=\"external\">Regarding Swift build time optimizations</a></li>\n<li>原文作者 : <a href=\"https://medium.com/@RobertGummesson\" target=\"_blank\" rel=\"external\">Robert Gummesson</a></li>\n<li>译文出自 : <a href=\"https://github.com/xitu/gold-miner\" target=\"_blank\" rel=\"external\">掘金翻译计划</a></li>\n<li>译者 : <a href=\"http://www.yanglonglong.com\" target=\"_blank\" rel=\"external\">杨龙龙</a></li>\n<li>校对者: <a href=\"https://github.com/shenAlexy\" target=\"_blank\" rel=\"external\">申冠华</a>, <a href=\"https://github.com/Jack-Kingdom\" target=\"_blank\" rel=\"external\">Jack King</a></li>\n</ul>\n</blockquote>\n<p><img src=\"http://ww3.sinaimg.cn/large/005SiNxygw1f3p3jimjllj31jk0dwqft.jpg\" alt=\"\"></p>\n<h4 id=\"关于-Swift-编译时性能优化的一些思考\"><a href=\"#关于-Swift-编译时性能优化的一些思考\" class=\"headerlink\" title=\"关于 Swift 编译时性能优化的一些思考\"></a>关于 Swift 编译时性能优化的一些思考</h4><p>上周，我读了 <a href=\"https://medium.com/@nickoneill\" target=\"_blank\" rel=\"external\">@nickoneill</a> 一篇优秀的帖子 <a href=\"https://medium.com/swift-programming/speeding-up-slow-swift-build-times-922feeba5780#.k0pngnkns\" target=\"_blank\" rel=\"external\">Speeding Up Slow Swift Build Times</a> 之后，我发现用一个略不同以往的角度去读Swift代码，并不是很难。</p>\n<p>一行之前很简洁的代码，现在却出现了新的问题——它是否应该重构为9行代码来达到更快的编译速度？ (<em>nil coalescing 运算符就是一个例子</em>)孰轻孰重？简洁的代码还是对编译器友好的代码？ 我觉得，它取决于项目的大小和开发者的想法。</p>\n<h4 id=\"但请等等…-这里有一个Xcode插件\"><a href=\"#但请等等…-这里有一个Xcode插件\" class=\"headerlink\" title=\"但请等等… 这里有一个Xcode插件\"></a>但请等等… 这里有一个Xcode插件</h4><p>在讲一些例子之前，我首先想到了通过手工提取日志信息是非常耗时的事情。通过命令行工具实现会相对容易一些，但是我把它往前推进了一步：集成为<a href=\"https://github.com/RobertGummesson/BuildTimeAnalyzer-for-Xcode\" target=\"_blank\" rel=\"external\">Xcode插件</a>。</p>\n<p><img src=\"http://ww1.sinaimg.cn/large/005SiNxygw1f3p3hhivppj30m809lwis.jpg\" alt=\"\"></p>\n<p>在这个例子中，最初的目的仅仅是识别并修复代码中最耗时的地方，但是现在我觉得它成为了一个必须要迭代的过程。这样我才可以更加高效地构建代码，并且防止在项目中出现耗时的函数。</p>\n<h4 id=\"不少惊喜\"><a href=\"#不少惊喜\" class=\"headerlink\" title=\"不少惊喜\"></a>不少惊喜</h4><p>我经常在不同的 Git 分支中跳转，并且等待一个暖慢的项目编译简直是在浪费我的生命。因此我思考了很长时间，一个玩具项目（大约两万行 Swift 代码）会编译如此长的时间。</p>\n<p>当我知道是什么原因导致它如此慢之后，我不得不承认我震惊了，一行代码居然需要几秒的编译时间。</p>\n<p>让我们来看几个例子。</p>\n<h4 id=\"Nil-合并运算符\"><a href=\"#Nil-合并运算符\" class=\"headerlink\" title=\"Nil 合并运算符\"></a>Nil 合并运算符</h4><p>编译器肯定不喜欢这里的第一种方法。在展开下面两处简写的代码之后，构建时间减少了 <strong>99.4%</strong>。</p>\n<pre><code>// 构建时间： 5238.3ms\nreturn CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height)\n\n// 构建时间： 32.4ms\nvar padding: CGFloat = 22\nif let rightView = rightView {\n    padding += rightView.bounds.width\n}\n\nif let leftView = leftView {\n    padding += leftView.bounds.width\n}\nreturn CGSizeMake(size.width + padding, bounds.height)\n</code></pre><h4 id=\"ArrayOfStuff-Stuff\"><a href=\"#ArrayOfStuff-Stuff\" class=\"headerlink\" title=\"ArrayOfStuff + [Stuff]\"></a>ArrayOfStuff + [Stuff]</h4><p>这个看起来像下面这样：</p>\n<pre><code>return ArrayOfStuff + [Stuff]  \n// 而不是  \nArrayOfStuff.append(stuff)  \nreturn ArrayOfStuff\n</code></pre><p>我经常这么做，并且它影响了每次构建的时间。下面是最糟糕的一个例子，改写后构建时间可以减少 <strong>97.9%</strong>。</p>\n<pre><code>// 构建时间： 1250.3ms\nlet systemOptions = [ 7, 14, 30, -1 ]\nlet systemNames = (0...2).map{ String(format: localizedFormat, systemOptions[$0]) } + [NSLocalizedString(&quot;everything&quot;, comment: &quot;&quot;)]\n// Some code in-between \nlabelNames = Array(systemNames[0..&lt;count]) + [systemNames.last!]\n\n// 构建时间： 25.5ms\nlet systemOptions = [ 7, 14, 30, -1 ]\nvar systemNames = systemOptions.dropLast().map{ String(format: localizedFormat, $0) }\nsystemNames.append(NSLocalizedString(&quot;everything&quot;, comment: &quot;&quot;))\n// Some code in-between\nlabelNames = Array(systemNames[0..&lt;count])\nlabelNames.append(systemNames.last!)\n</code></pre><h4 id=\"三元运算符\"><a href=\"#三元运算符\" class=\"headerlink\" title=\"三元运算符\"></a>三元运算符</h4><p>仅仅是通过替换三元运算符为 if else 语句就能减少 <strong>92.9%</strong> 的构建时间。如果使用一个for循环替换 <em>map</em> 函数，它又能减少另一个 75%（但是我的眼睛可就受不了咯😉）。</p>\n<pre><code>// 构建时间： 239.0ms\nlet labelNames = type == 0 ? (1...5).map{type0ToString($0)} : (0...2).map{type1ToString($0)}\n\n// 构建时间： 16.9ms\nvar labelNames: [String]\nif type == 0 {\n    labelNames = (1...5).map{type0ToString($0)}\n} else {\n    labelNames = (0...2).map{type1ToString($0)}\n}\n</code></pre><h4 id=\"转换-CGFloat-到-CGFloat\"><a href=\"#转换-CGFloat-到-CGFloat\" class=\"headerlink\" title=\"转换 CGFloat 到 CGFloat\"></a>转换 CGFloat 到 CGFloat</h4><p>这里我所说的并不一定正确。变量已经使用了 CGFloat 并且有一些括号也是多余的。在清理了这些冗余之后，构建时间能减少 <strong>99.9%</strong>。</p>\n<pre><code>// 构建时间： 3431.7 ms\nreturn CGFloat(M_PI) * (CGFloat((hour + hourDelta + CGFloat(minute + minuteDelta) / 60) * 5) - 15) * unit / 180\n\n// 构建时间： 3.0ms\nreturn CGFloat(M_PI) * ((hour + hourDelta + (minute + minuteDelta) / 60) * 5 - 15) * unit / 180\n</code></pre><h4 id=\"Round\"><a href=\"#Round\" class=\"headerlink\" title=\"Round()\"></a>Round()</h4><p>这个一个非常奇怪的例子，下面的例子中变量是一个局部变量与实例变量的混合。这个问题可能不是四舍五入本身，而是结合代码的方法。去掉四舍五入的方法大概能减少 <strong>97.6%</strong> 的构建时间。</p>\n<pre><code>// 构建时间： 1433.7ms\nlet expansion = a — b — c + round(d * 0.66) + e\n// 构建时间： 34.7ms\nlet expansion = a — b — c + d * 0.66 + e\n</code></pre><p>注意：所有的测试都在 MacBook Air (13-inch, Mid 2013)中进行。</p>\n<h4 id=\"尝试它\"><a href=\"#尝试它\" class=\"headerlink\" title=\"尝试它\"></a>尝试它</h4><p>无论你是否面临过构建时间太长的问题，编写对编译器友好的代码都是非常有用的。我确定你自己会在其中找到一些惊喜。作为参考，这里有完整的代码，在我的工程中可以5秒内完成编译…</p>\n<pre><code>import UIKit\n\nclass CMExpandingTextField: UITextField {\n\n    func textFieldEditingChanged() {\n        invalidateIntrinsicContentSize()\n    }\n\n    override func intrinsicContentSize() -&gt; CGSize {\n        if isFirstResponder(), let text = text {\n            let size = text.sizeWithAttributes(typingAttributes)\n            return CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height)\n        }\n        return super.intrinsicContentSize()\n    }\n}\n</code></pre>","excerpt":"<p>Xcode在编译Swift代码的时候速度会越来越慢，就此查找原因，并列出自己的优化思路。</p>","more":"<h3 id=\"针对运算符-的优化\"><a href=\"#针对运算符-的优化\" class=\"headerlink\" title=\"针对运算符??的优化\"></a>针对运算符<code>??</code>的优化</h3><p>在使用<code>??</code>时，并不是所有的都需要优化，包裹在循环中的<code>??</code>会比较耗时比较厉害，目前不知道为啥，估计编译的时候需要检查的此时比较多吧😂。</p>\n<h4 id=\"尝试显式解包\"><a href=\"#尝试显式解包\" class=\"headerlink\" title=\"尝试显式解包\"></a>尝试显式解包</h4><p><strong>思路</strong>：<code>??</code>编译慢，就不用<code>??</code>，直接使用<code>if else</code><br><strong>实施</strong>: 由于工程中使用的<code>??</code>比较多，所以比较修改起来比较麻烦。但是可以解决问题。真不行写方法转化调用喽。。</p>\n<h4 id=\"错误的尝试了重载运算符-方式\"><a href=\"#错误的尝试了重载运算符-方式\" class=\"headerlink\" title=\"错误的尝试了重载运算符??方式\"></a>错误的尝试了重载运算符<code>??</code>方式</h4><p><strong>思路</strong>: <code>??</code>运算符编译耗时较多，直觉是<code>??</code>实现有复杂的操作,重新按照显式解包的方案进行实现。<br><strong>实施</strong>: </p>\n<ul>\n<li>分析<code>??</code>的使用场景，左侧为T?,右侧为T，返回值T</li>\n<li>重载函数名定义<code>public func ?? &lt;T&gt;(left: T?, right: T) -&gt; T</code></li>\n<li>实现</li>\n<li>编译</li>\n<li>error：<code>Ambiguous use of operator &#39;??&#39;</code></li>\n<li>思考：这丫的在重载运算符的时候不能使用泛型吧。。</li>\n<li>更改函数为<code>public func ?? &lt;Any&gt;(left: Any?, right: Any) -&gt; Any</code></li>\n<li>PL. OK了，可是问题来了，系统的<code>??</code>是可以返回对应的类型，可是这样重载之后返回一个<code>Any</code>，代码中如果出现<code>let str = str1 ?? &quot;&quot;</code>则str类型就变为<code>Any</code>而不是<code>String</code>。<strong>巨坑</strong></li>\n<li>顾不了那么多了，真不行一个一个跑。于是先修改一个较为严重的<code>String</code>类型。</li>\n<li>尝试编译，结果时间惊人的没有变化。。依旧居高不下</li>\n<li>以失败告终。。</li>\n</ul>\n<p><strong>总结</strong>: 这个<code>??</code>耗时较多并不是因为<code>??</code>的实现有问题，<strong>猜测</strong>是在为<code>??</code>准备左右参数的时候需要进行一层层的解包确定类型，再加上<code>??</code>可能有重载版本，进行类型匹配的时候比较耗时。</p>\n<h4 id=\"尝试扩展方法进行优化\"><a href=\"#尝试扩展方法进行优化\" class=\"headerlink\" title=\"尝试扩展方法进行优化\"></a>尝试扩展方法进行优化</h4><p><strong>思路</strong>: 既然运算符会导致编译慢，那么就尝试使用方法直接进行转换。<br><strong>实现</strong>: 代码如下：<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Operator</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">///  ==&gt; ??</span></div><div class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> `<span class=\"title\">try</span>`&lt;T&gt;<span class=\"params\">(<span class=\"number\">_</span> origin: T?, <span class=\"number\">_</span> then: T)</span></span> -&gt; <span class=\"type\">T</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> value = origin <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> then</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> value</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>测试发现上述方法可以优化时间。</p>\n<hr>\n<h3 id=\"以下原文出自：关于-Swift-编译时性能优化的一些思考\"><a href=\"#以下原文出自：关于-Swift-编译时性能优化的一些思考\" class=\"headerlink\" title=\"以下原文出自：关于 Swift 编译时性能优化的一些思考\"></a>以下原文出自：<a href=\"https://github.com/yllziv/gold-miner/blob/1bfbb3deefd27138097415422bec2bb7e98e9715/TODO/regarding-swift-build-time-optimizations.md\">关于 Swift 编译时性能优化的一些思考</a></h3><hr>\n<blockquote>\n<ul>\n<li>原文链接 : <a href=\"https://medium.com/@RobertGummesson/regarding-swift-build-time-optimizations-fc92cdd91e31#.w81y3zhjr\">Regarding Swift build time optimizations</a></li>\n<li>原文作者 : <a href=\"https://medium.com/@RobertGummesson\">Robert Gummesson</a></li>\n<li>译文出自 : <a href=\"https://github.com/xitu/gold-miner\">掘金翻译计划</a></li>\n<li>译者 : <a href=\"http://www.yanglonglong.com\">杨龙龙</a></li>\n<li>校对者: <a href=\"https://github.com/shenAlexy\">申冠华</a>, <a href=\"https://github.com/Jack-Kingdom\">Jack King</a></li>\n</ul>\n</blockquote>\n<p><img src=\"http://ww3.sinaimg.cn/large/005SiNxygw1f3p3jimjllj31jk0dwqft.jpg\" alt=\"\"></p>\n<h4 id=\"关于-Swift-编译时性能优化的一些思考\"><a href=\"#关于-Swift-编译时性能优化的一些思考\" class=\"headerlink\" title=\"关于 Swift 编译时性能优化的一些思考\"></a>关于 Swift 编译时性能优化的一些思考</h4><p>上周，我读了 <a href=\"https://medium.com/@nickoneill\">@nickoneill</a> 一篇优秀的帖子 <a href=\"https://medium.com/swift-programming/speeding-up-slow-swift-build-times-922feeba5780#.k0pngnkns\">Speeding Up Slow Swift Build Times</a> 之后，我发现用一个略不同以往的角度去读Swift代码，并不是很难。</p>\n<p>一行之前很简洁的代码，现在却出现了新的问题——它是否应该重构为9行代码来达到更快的编译速度？ (<em>nil coalescing 运算符就是一个例子</em>)孰轻孰重？简洁的代码还是对编译器友好的代码？ 我觉得，它取决于项目的大小和开发者的想法。</p>\n<h4 id=\"但请等等…-这里有一个Xcode插件\"><a href=\"#但请等等…-这里有一个Xcode插件\" class=\"headerlink\" title=\"但请等等… 这里有一个Xcode插件\"></a>但请等等… 这里有一个Xcode插件</h4><p>在讲一些例子之前，我首先想到了通过手工提取日志信息是非常耗时的事情。通过命令行工具实现会相对容易一些，但是我把它往前推进了一步：集成为<a href=\"https://github.com/RobertGummesson/BuildTimeAnalyzer-for-Xcode\">Xcode插件</a>。</p>\n<p><img src=\"http://ww1.sinaimg.cn/large/005SiNxygw1f3p3hhivppj30m809lwis.jpg\" alt=\"\"></p>\n<p>在这个例子中，最初的目的仅仅是识别并修复代码中最耗时的地方，但是现在我觉得它成为了一个必须要迭代的过程。这样我才可以更加高效地构建代码，并且防止在项目中出现耗时的函数。</p>\n<h4 id=\"不少惊喜\"><a href=\"#不少惊喜\" class=\"headerlink\" title=\"不少惊喜\"></a>不少惊喜</h4><p>我经常在不同的 Git 分支中跳转，并且等待一个暖慢的项目编译简直是在浪费我的生命。因此我思考了很长时间，一个玩具项目（大约两万行 Swift 代码）会编译如此长的时间。</p>\n<p>当我知道是什么原因导致它如此慢之后，我不得不承认我震惊了，一行代码居然需要几秒的编译时间。</p>\n<p>让我们来看几个例子。</p>\n<h4 id=\"Nil-合并运算符\"><a href=\"#Nil-合并运算符\" class=\"headerlink\" title=\"Nil 合并运算符\"></a>Nil 合并运算符</h4><p>编译器肯定不喜欢这里的第一种方法。在展开下面两处简写的代码之后，构建时间减少了 <strong>99.4%</strong>。</p>\n<pre><code>// 构建时间： 5238.3ms\nreturn CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height)\n\n// 构建时间： 32.4ms\nvar padding: CGFloat = 22\nif let rightView = rightView {\n    padding += rightView.bounds.width\n}\n\nif let leftView = leftView {\n    padding += leftView.bounds.width\n}\nreturn CGSizeMake(size.width + padding, bounds.height)\n</code></pre><h4 id=\"ArrayOfStuff-Stuff\"><a href=\"#ArrayOfStuff-Stuff\" class=\"headerlink\" title=\"ArrayOfStuff + [Stuff]\"></a>ArrayOfStuff + [Stuff]</h4><p>这个看起来像下面这样：</p>\n<pre><code>return ArrayOfStuff + [Stuff]  \n// 而不是  \nArrayOfStuff.append(stuff)  \nreturn ArrayOfStuff\n</code></pre><p>我经常这么做，并且它影响了每次构建的时间。下面是最糟糕的一个例子，改写后构建时间可以减少 <strong>97.9%</strong>。</p>\n<pre><code>// 构建时间： 1250.3ms\nlet systemOptions = [ 7, 14, 30, -1 ]\nlet systemNames = (0...2).map{ String(format: localizedFormat, systemOptions[$0]) } + [NSLocalizedString(&quot;everything&quot;, comment: &quot;&quot;)]\n// Some code in-between \nlabelNames = Array(systemNames[0..&lt;count]) + [systemNames.last!]\n\n// 构建时间： 25.5ms\nlet systemOptions = [ 7, 14, 30, -1 ]\nvar systemNames = systemOptions.dropLast().map{ String(format: localizedFormat, $0) }\nsystemNames.append(NSLocalizedString(&quot;everything&quot;, comment: &quot;&quot;))\n// Some code in-between\nlabelNames = Array(systemNames[0..&lt;count])\nlabelNames.append(systemNames.last!)\n</code></pre><h4 id=\"三元运算符\"><a href=\"#三元运算符\" class=\"headerlink\" title=\"三元运算符\"></a>三元运算符</h4><p>仅仅是通过替换三元运算符为 if else 语句就能减少 <strong>92.9%</strong> 的构建时间。如果使用一个for循环替换 <em>map</em> 函数，它又能减少另一个 75%（但是我的眼睛可就受不了咯😉）。</p>\n<pre><code>// 构建时间： 239.0ms\nlet labelNames = type == 0 ? (1...5).map{type0ToString($0)} : (0...2).map{type1ToString($0)}\n\n// 构建时间： 16.9ms\nvar labelNames: [String]\nif type == 0 {\n    labelNames = (1...5).map{type0ToString($0)}\n} else {\n    labelNames = (0...2).map{type1ToString($0)}\n}\n</code></pre><h4 id=\"转换-CGFloat-到-CGFloat\"><a href=\"#转换-CGFloat-到-CGFloat\" class=\"headerlink\" title=\"转换 CGFloat 到 CGFloat\"></a>转换 CGFloat 到 CGFloat</h4><p>这里我所说的并不一定正确。变量已经使用了 CGFloat 并且有一些括号也是多余的。在清理了这些冗余之后，构建时间能减少 <strong>99.9%</strong>。</p>\n<pre><code>// 构建时间： 3431.7 ms\nreturn CGFloat(M_PI) * (CGFloat((hour + hourDelta + CGFloat(minute + minuteDelta) / 60) * 5) - 15) * unit / 180\n\n// 构建时间： 3.0ms\nreturn CGFloat(M_PI) * ((hour + hourDelta + (minute + minuteDelta) / 60) * 5 - 15) * unit / 180\n</code></pre><h4 id=\"Round\"><a href=\"#Round\" class=\"headerlink\" title=\"Round()\"></a>Round()</h4><p>这个一个非常奇怪的例子，下面的例子中变量是一个局部变量与实例变量的混合。这个问题可能不是四舍五入本身，而是结合代码的方法。去掉四舍五入的方法大概能减少 <strong>97.6%</strong> 的构建时间。</p>\n<pre><code>// 构建时间： 1433.7ms\nlet expansion = a — b — c + round(d * 0.66) + e\n// 构建时间： 34.7ms\nlet expansion = a — b — c + d * 0.66 + e\n</code></pre><p>注意：所有的测试都在 MacBook Air (13-inch, Mid 2013)中进行。</p>\n<h4 id=\"尝试它\"><a href=\"#尝试它\" class=\"headerlink\" title=\"尝试它\"></a>尝试它</h4><p>无论你是否面临过构建时间太长的问题，编写对编译器友好的代码都是非常有用的。我确定你自己会在其中找到一些惊喜。作为参考，这里有完整的代码，在我的工程中可以5秒内完成编译…</p>\n<pre><code>import UIKit\n\nclass CMExpandingTextField: UITextField {\n\n    func textFieldEditingChanged() {\n        invalidateIntrinsicContentSize()\n    }\n\n    override func intrinsicContentSize() -&gt; CGSize {\n        if isFirstResponder(), let text = text {\n            let size = text.sizeWithAttributes(typingAttributes)\n            return CGSize(width: size.width + (rightView?.bounds.width ?? 0) + (leftView?.bounds.width ?? 0) + 22, height: bounds.height)\n        }\n        return super.intrinsicContentSize()\n    }\n}\n</code></pre>"},{"title":"sonarqube-note","date":"2017-02-07T02:16:58.000Z","_content":"\n### 步骤\n\nGet Started in Two Minutes\n1. Download and unzip the SonarQube distribution (let's say in \"C:\\sonarqube\" or \"/etc/sonarqube\")\n2. Start the SonarQube server:\n```\n# On Windows, execute:\nC:\\sonarqube\\bin\\windows-x86-xx\\StartSonar.bat\n \n# On other operating system, execute:\n/etc/sonarqube/bin/[OS]/sonar.sh console\n```\n3. Download and unzip the SonarQube Scanner (let's say in \"C:\\sonar-scanner\" or \"/etc/sonar-scanner\")\n4. Download and unzip some project samples (let's say in \"C:\\sonar-scanning-examples\" or \"/etc/sonar-scanning-examples\")\n5. Analyze a project:\n```\n# On Windows:\ncd C:\\sonar-scanning-examples\\sonarqube-scanner\nC:\\sonar-scanner\\bin\\sonar-scanner.bat\n \n# On other operating system:\ncd /etc/sonar-scanning-examples/sonarqube-scanner\n/etc/sonar-scanner/bin/sonar-scanner\n```\n6. Browse the results at http://localhost:9000 (default System administrator credentials are admin/admin)\n\n\n### 文档\n- [docs.sonarqube.org](https://docs.sonarqube.org/display/HOME/SonarQube+Platform)\n- \n","source":"_posts/sonarqube-note.md","raw":"---\ntitle: sonarqube-note\ndate: 2017-02-07 10:16:58\ntags:\n---\n\n### 步骤\n\nGet Started in Two Minutes\n1. Download and unzip the SonarQube distribution (let's say in \"C:\\sonarqube\" or \"/etc/sonarqube\")\n2. Start the SonarQube server:\n```\n# On Windows, execute:\nC:\\sonarqube\\bin\\windows-x86-xx\\StartSonar.bat\n \n# On other operating system, execute:\n/etc/sonarqube/bin/[OS]/sonar.sh console\n```\n3. Download and unzip the SonarQube Scanner (let's say in \"C:\\sonar-scanner\" or \"/etc/sonar-scanner\")\n4. Download and unzip some project samples (let's say in \"C:\\sonar-scanning-examples\" or \"/etc/sonar-scanning-examples\")\n5. Analyze a project:\n```\n# On Windows:\ncd C:\\sonar-scanning-examples\\sonarqube-scanner\nC:\\sonar-scanner\\bin\\sonar-scanner.bat\n \n# On other operating system:\ncd /etc/sonar-scanning-examples/sonarqube-scanner\n/etc/sonar-scanner/bin/sonar-scanner\n```\n6. Browse the results at http://localhost:9000 (default System administrator credentials are admin/admin)\n\n\n### 文档\n- [docs.sonarqube.org](https://docs.sonarqube.org/display/HOME/SonarQube+Platform)\n- \n","slug":"sonarqube-note","published":1,"updated":"2017-02-07T06:09:34.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0fa60011l0uvbhr8ti69","content":"<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><p>Get Started in Two Minutes</p>\n<ol>\n<li>Download and unzip the SonarQube distribution (let’s say in “C:\\sonarqube” or “/etc/sonarqube”)</li>\n<li><p>Start the SonarQube server:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"># On Windows, execute:</div><div class=\"line\">C:\\sonarqube\\bin\\windows-x86-xx\\StartSonar.bat</div><div class=\"line\"> </div><div class=\"line\"># On other operating system, execute:</div><div class=\"line\">/etc/sonarqube/bin/[OS]/sonar.sh console</div></pre></td></tr></table></figure>\n</li>\n<li><p>Download and unzip the SonarQube Scanner (let’s say in “C:\\sonar-scanner” or “/etc/sonar-scanner”)</p>\n</li>\n<li>Download and unzip some project samples (let’s say in “C:\\sonar-scanning-examples” or “/etc/sonar-scanning-examples”)</li>\n<li><p>Analyze a project:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"># On Windows:</div><div class=\"line\">cd C:\\sonar-scanning-examples\\sonarqube-scanner</div><div class=\"line\">C:\\sonar-scanner\\bin\\sonar-scanner.bat</div><div class=\"line\"> </div><div class=\"line\"># On other operating system:</div><div class=\"line\">cd /etc/sonar-scanning-examples/sonarqube-scanner</div><div class=\"line\">/etc/sonar-scanner/bin/sonar-scanner</div></pre></td></tr></table></figure>\n</li>\n<li><p>Browse the results at <a href=\"http://localhost:9000\" target=\"_blank\" rel=\"external\">http://localhost:9000</a> (default System administrator credentials are admin/admin)</p>\n</li>\n</ol>\n<h3 id=\"文档\"><a href=\"#文档\" class=\"headerlink\" title=\"文档\"></a>文档</h3><ul>\n<li><a href=\"https://docs.sonarqube.org/display/HOME/SonarQube+Platform\" target=\"_blank\" rel=\"external\">docs.sonarqube.org</a></li>\n<li></li>\n</ul>\n","excerpt":"","more":"<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><p>Get Started in Two Minutes</p>\n<ol>\n<li>Download and unzip the SonarQube distribution (let’s say in “C:\\sonarqube” or “/etc/sonarqube”)</li>\n<li><p>Start the SonarQube server:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"># On Windows, execute:</div><div class=\"line\">C:\\sonarqube\\bin\\windows-x86-xx\\StartSonar.bat</div><div class=\"line\"> </div><div class=\"line\"># On other operating system, execute:</div><div class=\"line\">/etc/sonarqube/bin/[OS]/sonar.sh console</div></pre></td></tr></table></figure>\n</li>\n<li><p>Download and unzip the SonarQube Scanner (let’s say in “C:\\sonar-scanner” or “/etc/sonar-scanner”)</p>\n</li>\n<li>Download and unzip some project samples (let’s say in “C:\\sonar-scanning-examples” or “/etc/sonar-scanning-examples”)</li>\n<li><p>Analyze a project:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"># On Windows:</div><div class=\"line\">cd C:\\sonar-scanning-examples\\sonarqube-scanner</div><div class=\"line\">C:\\sonar-scanner\\bin\\sonar-scanner.bat</div><div class=\"line\"> </div><div class=\"line\"># On other operating system:</div><div class=\"line\">cd /etc/sonar-scanning-examples/sonarqube-scanner</div><div class=\"line\">/etc/sonar-scanner/bin/sonar-scanner</div></pre></td></tr></table></figure>\n</li>\n<li><p>Browse the results at <a href=\"http://localhost:9000\">http://localhost:9000</a> (default System administrator credentials are admin/admin)</p>\n</li>\n</ol>\n<h3 id=\"文档\"><a href=\"#文档\" class=\"headerlink\" title=\"文档\"></a>文档</h3><ul>\n<li><a href=\"https://docs.sonarqube.org/display/HOME/SonarQube+Platform\">docs.sonarqube.org</a></li>\n<li></li>\n</ul>\n"},{"title":"「转」真实世界中的 Swift 性能优化","date":"2017-01-17T11:14:57.000Z","_content":"\n原文链接：[真实世界中的 Swift 性能优化](https://realm.io/cn/news/real-world-swift-performance/)\n\n<!--more-->\n\n------\n\n有太多的因素会导致您的应用变得缓慢。在本次讲演中，我们将自底向上地来探索应用的性能优化。来看一看在真实世界中进行数据解析、数据映射和数据存储的时候，Swift 的特性（协议、泛型、结构体和类）是如何影响应用性能的，我们将确定影响性能提升的瓶颈所在，并体验 Swift 带来的「迅捷」体验。\n\n## 概述\n\n今天我打算同大家谈论 Swift 性能优化方面的内容。当我们构建软件的时候，特别是移动软件，由于人们的精力、时间有限，人们往往更喜欢有一个流畅的用户体验，而不是等着您的应用在那加载。如果应用运行速度过慢，并且不能给用户带来他们所想要的结果的话，那么这会让人们感到不爽。因此，让您的代码能够快速运行是无比重要的一件事。\n\n那么有什么因素会导致代码运行缓慢呢？当您在编写代码并选择架构的时候，深刻认识到这些架构所带来的影响是非常重要的。我将首先谈一谈：如何理解内联、动态调度与静态调度之间的权衡，以及相关结构是如何分配内存的，还有怎样选择最适合的架构。\n\n## 内存分配\n\n对象的内存分配 (allocation) 和内存释放 (deallocation) 是代码中最大的开销之一，同时通常也是不可避免的。Swift 会自行分配和释放内存，此外它存在两种类型的分配方式。\n\n第一个是基于栈 (stack-based) 的内存分配。Swift 会尽可能选择在栈上分配内存。栈是一种非常简单的数据结构；数据从栈的底部推入 (push)，从栈的顶部弹出 (pop)。由于我们只能够修改栈的末端，因此我们可以通过维护一个指向栈末端的指针来实现这种数据结构，并且在其中进行内存的分配和释放只需要重新分配该整数即可。\n\n第二个是基于堆 (heap-based) 的内存分配。这使得内存分配将具备更加动态的生命周期，但是这需要更为复杂的数据结构。要在堆上进行内存分配的话，您需要锁定堆当中的一个空闲块 (free block)，其大小能够容纳您的对象。因此，我们需要找到未使用的块，然后在其中分配内存。当我们需要释放内存的时候，我们就必须搜索何处能够重新插入该内存块。这个操作很缓慢。主要是为了线程安全，我们必须要对这些东西进行锁定和同步。\n\n## 引用计数\n\n我们还有引用计数 (reference counting) 的概念，这个操作相对不怎么耗费性能，但是由于使用次数很多，因此它带来的性能影响仍然是很大的。引用计数是 Objective-C 和 Swift 中用于确定何时该释放对象的安全机制。目前，Swift 当中的引用计数是强制自动管理的，这意味着它很容易被开发者们所忽略。然而，当您打开 Instrument 查看何处影响了代码运行的速度的时候，您会发现 20,000 多次的 Swift 持有 (retain) 和释放 (release)，这些操作占用了 90% 的代码运行时间！\n```swift\nfunc perform(with object: Object) {\n    object.doAThing()\n}\n```\n这是因为如果有这样一个函数接收了一个对象作为参数，并且执行了这个对象的 doAThing() 方法，编译器会自动插入对象持有和释放操作，以确保在这个方法的生命周期当中，这个对象不会被回收掉。\n```swift\nfunc perform(with object: Object) {\n    __swift_retain(object)\n    object.doAThing()\n    __swift_release(object)\n}\n```\n这些对象持有和释放操作是原子操作 (atomic operations)，所以它们运转缓慢就很正常了。或者，是因为我们不知道如何让它们能够运行得更快一些。\n\n## 调度与对象\n\n此外还有调度 (dispatch) 的概念。Swift 拥有三种类型的调度方式。Swift 会尽可能将函数内联 (inline)，这样的话使用这个函数将不会有额外的性能开销。这个函数可以直接调用。静态调度 (static dispatch) 本质上是通过 V-table 进行的查找和跳转，这个操作会花费一纳秒的时间。然后动态调度 (dynamic dispatch) 将会花费大概五纳秒的时间，如果您只有几个这样的方法调用的话，这实际上并不会带来多大的问题，问题是当您在一个嵌套循环或者执行上千次操作当中使用了动态调度的话，那么它所带来的性能耗费将成百上千地累积起来，最终影响应用性能。\n\nSwift 同样也有两种类型的对象。\n```swift\nclass Index {\n    let section: Int\n    let item: Int\n}\n\nlet i = Index(section: 1,\n                item: 1)\n```\n这是一个类，类当中的数据都会在堆上分配内存。您可以在此处看到，这里我们创建了一个名为 Index 的类。其中包含了两个属性，一个 section 和一个 item。当我们创建了这个对象的时候，堆上便创建了一个指向此 Index 的指针，因此在堆上便存放了这个 section 和 item 的数据和空间。\n\n如果我们对其建立引用，就会发现我们现在有两个指向堆上相同区域的指针了，它们之间是共享内存的。\n```swift\nclass Index {\n    let section: Int\n    let item: Int\n}\n\nlet i = Index(section: 1,\n                item: 1)\n\nlet i2 = i\n```\n这个时候，Swift 会自动插入对象持有操作。\n```swift\nclass Index {\n    let section: Int\n    let item: Int\n}\n\nlet i = Index(section: 1,\n                item: 1)\n\n__swift_retain(i)\nlet i2 = i\n```\n## 结构体\n\n很多人都会说：要编写性能优异的 Swift 代码，最简单的方式就是使用结构体了，结构体通常是一个很好的结构，因为结构体会存储在栈上，并且通常会使用静态调度或者内联调度。\n\n存储在栈上的 Swift 结构体将占用三个 Word 大小。如果您的结构体当中的数据数量低于三种的话，那么结构体的值会自动在栈上内联。Word 是 CPU 当中内置整数的大小，它是 CPU 所工作的区块。\n```swift\nstruct Index {\n    let section: Int\n    let item: Int\n}\n\nlet i = Index(section: 1, item: 1)\n```\n在这里您可以看到，当我们创建这个结构体的时候，带有 section 和 item 值得 Index 结构体将会直接下放到栈当中，这个时候不会有额外的内存分配发生。那么如果我们在别处将其赋值到另一个变量的时候，会发生什么呢？\n```swift\nstruct Index {\n    let section: Int\n    let item: Int\n}\n\nlet i = Index(section: 1, item: 1)\nlet i2 = i\n```\n如果我们将 i 赋给 i2，这会将我们存储在栈当中的值直接再次复制一遍，这个时候并不会出现引用的情况。这就是所谓的「值类型」。\n\n那么如果结构体当中存放了引用类型的话又会怎样呢？持有内联指针的结构体。\n```swift\nstruct User {\n    let name: String\n    let id: String\n}\n\nlet u = User(name: \"Joe\", id: \"1234\")\n```\n当我们将其赋值给别的变量的时候，我们就持有了共享两个结构体的相同指针，因此我们必须要对这两个指针进行持有操作，而不是在对象上执行单独的持有操作。\n```swift\nstruct User {\n    let name: String\n    let id: String\n}\n\nlet u = User(name: \"Joe\",\n             id: \"1234\")\n__swift_retain(u.name._textStorage)\n__swift_retain(u.id._textStorage)\nlet u2 = u\n```\n如果其中包含了类的话，那么性能耗费会更大。\n\n## 抽象类型\n\n正如我们此前所述，Swift 提供了许多不同的抽象类型 (abstraction)，从而允许我们自行决定代码该如何运行，以及决定代码的性能特性。现在我们来看一看抽象类型是如何在实际环境当中使用的。这里有一段很简单的代码：\n```swift\nstruct Circle {\n    let radius: Double\n    let center: Point\n    func draw() {}\n}\n\nvar circles = (1..<100_000_000).map { _ in Circle(...) }\n\nfor circle in circles {\n    circle.draw()\n}\n```\n这里有一个带有 radius 和 center 属性的 Circle 结构体。它将占用三个 Word 大小的空间，并存储在栈上。我们创建了一亿个 Circle，然后我们遍历这些 Circle 并调用这个函数。在我的电脑上，这段操作在发布模式下耗费了 0.3 秒的时间。那么当需求发生变更的时候，会发生什么事呢？\n\n我们不仅需要绘圆，还需要能够处理多种类型的形状。让我们假设我们还需要绘线。我非常喜欢面向协议编程，因为它允许我在不使用继承的情况下实现多态性，并且它允许我们只需要考虑这个「抽象类型」即可。\n```\nprotocol Drawable {\n    func draw()\n}\n\nstruct Circle: Drawable {\n    let radius: Double\n    let center: Point\n    func draw() {}\n}\n\nlet drawables: [Drawable] = (1..<100_000_000).map { _ in Circle(...) }\n\nfor drawable in drawables {\n    drawable.draw()\n}\n```\n我们需要做的，就是将这个 draw 方法析取到协议当中，然后将数组的引用类型变更为这个协议，这样做导致这段代码花费了 4.0 秒的时间来运行。速率减慢了 1300%，这是为什么呢？\n\n这是因为此前的代码可以被静态调度，从而在没有任何堆应用建立的情况下仍能够执行。这就是协议是如何实现的。\n\n例如，如大家所见，这里是我们此前的 Circle 结构体。在这个 for 循环当中，Swift 编译器所做的就是前往 V-table 进行查找，或者直接将 draw 函数内联。\n\n```\nstruct Circle {\n    let radius: Double\n    let center: Point\n    func draw() {}\n}\n\nvar circles = (1..<100_000_000).map { _ in Circle(...) }\n\nfor circle in circles {\n    circle.draw()\n}\n```\n当我们用协议来替代的时候，此时它并不知道这个对象是结构体还是类。因为这里可能是任何一个实现此协议的类型。\n\n```\nprotocol Drawable {\n    func draw()\n}\n\nstruct Circle: Drawable {\n    let radius: Double\n    let center: Point\n\n    func draw() {}\n}\n\nvar drawables: [Drawable] = (1..<100_000_000).map { _ in return Circle(...) }\n\nfor drawable in drawables {\n    drawable.draw()\n}\n```\n那么我们该如何去调度这个 draw 函数呢？答案就位于协议记录表 (protocol witness table，也称为虚函数表) 当中。它其中存放了您应用当中每个实现协议的对象名，并且在底层实现当中，这个表本质上充当了这些类型的别名。\n\n```\nprotocol Drawable {\n    func draw()\n}\n\nstruct Circle: Drawable {\n    let radius: Double\n    let center: Point\n\n    func draw() {}\n}\n\nvar drawables: [Drawable] = (1..<100_000_000).map { _ in\n    return Circle(...)\n}\n\nfor drawable in drawables {\n    drawable.draw()\n}\n```\n在这里的代码当中，我们该如何获取协议记录表呢？答案就是从这个既有容器 (existential container) 当中获取，这个容器目前拥有一个三个字大小的结构体，并且存放在其内部的值缓冲区当中，此外还与协议记录表建立了引用关系。\n\n```\nstruct Circle: Drawable {\n    let radius: Double\n    let center: Point\n\n    func draw() {}\n}\n```\n这里 Circle 类型存放在了三个字大小的缓冲区当中，并且不会被单独引用。\n\n```\nstruct Line: Drawable {\n    let origin: Point\n    let end: Point\n\n    func draw() {}\n}\n```\n举个例子，对于我们的 Line 类型来说，它其中包含了四个字的存储空间，因为它拥有两个点类型。这个 Line 结构体需要超过四个字以上的存储空间。我们该如何处理它呢？这会对性能有影响么？好吧，它的确会：\n\n```\nprotocol Drawable {\n    func draw()\n}\n\nstruct Line: Drawable {\n    let origin: Point\n    let end: Point\n    func draw() {}\n}\n\nlet drawables: [Drawable] = (1..<100_000_000).map { _ in Line(...) }\n\nfor drawable in drawables {\n    drawable.draw()\n}\n```\n这需要花费 45 秒钟的时间来运行。为什么这里要花这么久的时间呢，发生了什么事呢？\n\n绝大部分的时间都花费在对结构体进行内存分配上了，因为现在它们无法存放在只有三个字大小的缓冲区当中了。因此这些结构会在堆上进行内存分配，此外这也与协议有一点关系。由于既有容器只能够存储三个字大小的结构体，或者也可以与对象建立引用关系，我们同样需要某种名为值记录表 (value witness table)。这就是我们用来处理任意值的东西。\n\n因此在这里，编译器将创建一个值记录表，对每个���缓冲区、内敛结构体来说，都有三个字大小的缓冲区，然后它将负责对值或者类进行内存分配、拷贝、销毁和内存释放等操作。\n\n```\nfunc draw(drawable: Drawable) {\n    drawable.draw()\n}\n\nlet value: Drawable = Line()\ndraw(local: value)\n\n// Generates\nfunc draw(value: ECTDrawable) {\n    var drawable: ECTDrawable = ECTDrawable()\n    let vwt = value.vwt\n    let pwt = value.pwt\n    drawable.vwt = value.vwt\n    drawable.pwt = value.pwt\n    vwt.allocateBuffAndCopyValue(&drawable, value)\n    pwt.draw(vwt.projectBuffer(&drawable)\n}\n```\n这里是一个例子，这就是这个过程的中间产物。如果我们只有一个 draw 函数，那么它将会接受我们创建的 Line 作为参数，因此我们将它传递给这个 draw 函数即可。\n\n实际情况时，它将这个 Drawable 协议传递到既有容器当中，然后在函数内部再次进行创建。这会对值和协议记录表进行赋值，然后分配一个新的缓冲区，然后将其他结构、类或者类似对象的值拷贝进这个缓冲区当中。然后就使用协议记录表当中的 draw 函数，把真实的 Drable 对象传递给这个函数。\n\n您可以看到，值记录表和协议记录表将会存放在栈上，而 Line 将会被存放在堆上，从而最后将线绘制出来。\n\n## 结论\n\n对我们进行数据建模的方式进行简单的更改将会对性能造成巨大的影响。让我们来看一看该如何来避免这些情况的发生。\n\n首先让我们来说一说泛型。大家可能会说了，我给各位展示了协议会导致性能的下降，那么我们为什么还要使用泛型呢？答案在于：泛型允许我们做什么。\n\n```\nstruct Stack<T: Type> {\n...\n}\n```\n假设我们这里有一个带有泛型 T 的 Stack 结构体，它受到一个协议类型的约束。编译器所要做的，就是将这个 T 提换成相应的协议，或者替换为我们传入的具体类型。这些操作会一直沿着函数链 (function chain) 执行，并且编译器会创建直接对此类型进行操作的专用版本。\n\n这样我们就无需再使用值记录表或者协议记录表了，并且还移除了既有容器，这可能是一个非常好的解决方式，这使得我们仍然能够写出真正快速运行的泛型代码，并且还具备 Swift 所提供的良好多态性。这就是所谓的静态多态性 (static polymorphism)。\n\n您还可以通过使用枚举来改进数据模型，而不是从服务器中获取大量的字符串。例如，假设您正在构建一个社交应用，您需要对账户建立状态的管理，以前您可能会使用字符串来进行控制。\n\n```\nenum AccountStatus: String, RawRepresentable {\ncase .banned, .verified, incomplete\n}\n```\n如果我们改用枚举的话，那么我们就无需进行内存分配了，当我们传递这个类型的时候，我们只是将枚举值进行传递，这是一个加快代码运行速度的好方法，同时也可以为整个应用程序提供更安全、更可读的代码。\n\n此外，使用 u-模型或者演示者 (Presenter) 或者不同的抽象类型的形式，来构建特定类型的模型也是非常有用的，这使得我们能够精简掉应用当中许多不必要的部分。\n\n好的，我的讲演到此结束，内容很短，感谢诸位的参与！\n\n\n","source":"_posts/real-world-swift-performance.md","raw":"---\ntitle: 「转」真实世界中的 Swift 性能优化\ndate: 2017-01-17 19:14:57\ntags:\n---\n\n原文链接：[真实世界中的 Swift 性能优化](https://realm.io/cn/news/real-world-swift-performance/)\n\n<!--more-->\n\n------\n\n有太多的因素会导致您的应用变得缓慢。在本次讲演中，我们将自底向上地来探索应用的性能优化。来看一看在真实世界中进行数据解析、数据映射和数据存储的时候，Swift 的特性（协议、泛型、结构体和类）是如何影响应用性能的，我们将确定影响性能提升的瓶颈所在，并体验 Swift 带来的「迅捷」体验。\n\n## 概述\n\n今天我打算同大家谈论 Swift 性能优化方面的内容。当我们构建软件的时候，特别是移动软件，由于人们的精力、时间有限，人们往往更喜欢有一个流畅的用户体验，而不是等着您的应用在那加载。如果应用运行速度过慢，并且不能给用户带来他们所想要的结果的话，那么这会让人们感到不爽。因此，让您的代码能够快速运行是无比重要的一件事。\n\n那么有什么因素会导致代码运行缓慢呢？当您在编写代码并选择架构的时候，深刻认识到这些架构所带来的影响是非常重要的。我将首先谈一谈：如何理解内联、动态调度与静态调度之间的权衡，以及相关结构是如何分配内存的，还有怎样选择最适合的架构。\n\n## 内存分配\n\n对象的内存分配 (allocation) 和内存释放 (deallocation) 是代码中最大的开销之一，同时通常也是不可避免的。Swift 会自行分配和释放内存，此外它存在两种类型的分配方式。\n\n第一个是基于栈 (stack-based) 的内存分配。Swift 会尽可能选择在栈上分配内存。栈是一种非常简单的数据结构；数据从栈的底部推入 (push)，从栈的顶部弹出 (pop)。由于我们只能够修改栈的末端，因此我们可以通过维护一个指向栈末端的指针来实现这种数据结构，并且在其中进行内存的分配和释放只需要重新分配该整数即可。\n\n第二个是基于堆 (heap-based) 的内存分配。这使得内存分配将具备更加动态的生命周期，但是这需要更为复杂的数据结构。要在堆上进行内存分配的话，您需要锁定堆当中的一个空闲块 (free block)，其大小能够容纳您的对象。因此，我们需要找到未使用的块，然后在其中分配内存。当我们需要释放内存的时候，我们就必须搜索何处能够重新插入该内存块。这个操作很缓慢。主要是为了线程安全，我们必须要对这些东西进行锁定和同步。\n\n## 引用计数\n\n我们还有引用计数 (reference counting) 的概念，这个操作相对不怎么耗费性能，但是由于使用次数很多，因此它带来的性能影响仍然是很大的。引用计数是 Objective-C 和 Swift 中用于确定何时该释放对象的安全机制。目前，Swift 当中的引用计数是强制自动管理的，这意味着它很容易被开发者们所忽略。然而，当您打开 Instrument 查看何处影响了代码运行的速度的时候，您会发现 20,000 多次的 Swift 持有 (retain) 和释放 (release)，这些操作占用了 90% 的代码运行时间！\n```swift\nfunc perform(with object: Object) {\n    object.doAThing()\n}\n```\n这是因为如果有这样一个函数接收了一个对象作为参数，并且执行了这个对象的 doAThing() 方法，编译器会自动插入对象持有和释放操作，以确保在这个方法的生命周期当中，这个对象不会被回收掉。\n```swift\nfunc perform(with object: Object) {\n    __swift_retain(object)\n    object.doAThing()\n    __swift_release(object)\n}\n```\n这些对象持有和释放操作是原子操作 (atomic operations)，所以它们运转缓慢就很正常了。或者，是因为我们不知道如何让它们能够运行得更快一些。\n\n## 调度与对象\n\n此外还有调度 (dispatch) 的概念。Swift 拥有三种类型的调度方式。Swift 会尽可能将函数内联 (inline)，这样的话使用这个函数将不会有额外的性能开销。这个函数可以直接调用。静态调度 (static dispatch) 本质上是通过 V-table 进行的查找和跳转，这个操作会花费一纳秒的时间。然后动态调度 (dynamic dispatch) 将会花费大概五纳秒的时间，如果您只有几个这样的方法调用的话，这实际上并不会带来多大的问题，问题是当您在一个嵌套循环或者执行上千次操作当中使用了动态调度的话，那么它所带来的性能耗费将成百上千地累积起来，最终影响应用性能。\n\nSwift 同样也有两种类型的对象。\n```swift\nclass Index {\n    let section: Int\n    let item: Int\n}\n\nlet i = Index(section: 1,\n                item: 1)\n```\n这是一个类，类当中的数据都会在堆上分配内存。您可以在此处看到，这里我们创建了一个名为 Index 的类。其中包含了两个属性，一个 section 和一个 item。当我们创建了这个对象的时候，堆上便创建了一个指向此 Index 的指针，因此在堆上便存放了这个 section 和 item 的数据和空间。\n\n如果我们对其建立引用，就会发现我们现在有两个指向堆上相同区域的指针了，它们之间是共享内存的。\n```swift\nclass Index {\n    let section: Int\n    let item: Int\n}\n\nlet i = Index(section: 1,\n                item: 1)\n\nlet i2 = i\n```\n这个时候，Swift 会自动插入对象持有操作。\n```swift\nclass Index {\n    let section: Int\n    let item: Int\n}\n\nlet i = Index(section: 1,\n                item: 1)\n\n__swift_retain(i)\nlet i2 = i\n```\n## 结构体\n\n很多人都会说：要编写性能优异的 Swift 代码，最简单的方式就是使用结构体了，结构体通常是一个很好的结构，因为结构体会存储在栈上，并且通常会使用静态调度或者内联调度。\n\n存储在栈上的 Swift 结构体将占用三个 Word 大小。如果您的结构体当中的数据数量低于三种的话，那么结构体的值会自动在栈上内联。Word 是 CPU 当中内置整数的大小，它是 CPU 所工作的区块。\n```swift\nstruct Index {\n    let section: Int\n    let item: Int\n}\n\nlet i = Index(section: 1, item: 1)\n```\n在这里您可以看到，当我们创建这个结构体的时候，带有 section 和 item 值得 Index 结构体将会直接下放到栈当中，这个时候不会有额外的内存分配发生。那么如果我们在别处将其赋值到另一个变量的时候，会发生什么呢？\n```swift\nstruct Index {\n    let section: Int\n    let item: Int\n}\n\nlet i = Index(section: 1, item: 1)\nlet i2 = i\n```\n如果我们将 i 赋给 i2，这会将我们存储在栈当中的值直接再次复制一遍，这个时候并不会出现引用的情况。这就是所谓的「值类型」。\n\n那么如果结构体当中存放了引用类型的话又会怎样呢？持有内联指针的结构体。\n```swift\nstruct User {\n    let name: String\n    let id: String\n}\n\nlet u = User(name: \"Joe\", id: \"1234\")\n```\n当我们将其赋值给别的变量的时候，我们就持有了共享两个结构体的相同指针，因此我们必须要对这两个指针进行持有操作，而不是在对象上执行单独的持有操作。\n```swift\nstruct User {\n    let name: String\n    let id: String\n}\n\nlet u = User(name: \"Joe\",\n             id: \"1234\")\n__swift_retain(u.name._textStorage)\n__swift_retain(u.id._textStorage)\nlet u2 = u\n```\n如果其中包含了类的话，那么性能耗费会更大。\n\n## 抽象类型\n\n正如我们此前所述，Swift 提供了许多不同的抽象类型 (abstraction)，从而允许我们自行决定代码该如何运行，以及决定代码的性能特性。现在我们来看一看抽象类型是如何在实际环境当中使用的。这里有一段很简单的代码：\n```swift\nstruct Circle {\n    let radius: Double\n    let center: Point\n    func draw() {}\n}\n\nvar circles = (1..<100_000_000).map { _ in Circle(...) }\n\nfor circle in circles {\n    circle.draw()\n}\n```\n这里有一个带有 radius 和 center 属性的 Circle 结构体。它将占用三个 Word 大小的空间，并存储在栈上。我们创建了一亿个 Circle，然后我们遍历这些 Circle 并调用这个函数。在我的电脑上，这段操作在发布模式下耗费了 0.3 秒的时间。那么当需求发生变更的时候，会发生什么事呢？\n\n我们不仅需要绘圆，还需要能够处理多种类型的形状。让我们假设我们还需要绘线。我非常喜欢面向协议编程，因为它允许我在不使用继承的情况下实现多态性，并且它允许我们只需要考虑这个「抽象类型」即可。\n```\nprotocol Drawable {\n    func draw()\n}\n\nstruct Circle: Drawable {\n    let radius: Double\n    let center: Point\n    func draw() {}\n}\n\nlet drawables: [Drawable] = (1..<100_000_000).map { _ in Circle(...) }\n\nfor drawable in drawables {\n    drawable.draw()\n}\n```\n我们需要做的，就是将这个 draw 方法析取到协议当中，然后将数组的引用类型变更为这个协议，这样做导致这段代码花费了 4.0 秒的时间来运行。速率减慢了 1300%，这是为什么呢？\n\n这是因为此前的代码可以被静态调度，从而在没有任何堆应用建立的情况下仍能够执行。这就是协议是如何实现的。\n\n例如，如大家所见，这里是我们此前的 Circle 结构体。在这个 for 循环当中，Swift 编译器所做的就是前往 V-table 进行查找，或者直接将 draw 函数内联。\n\n```\nstruct Circle {\n    let radius: Double\n    let center: Point\n    func draw() {}\n}\n\nvar circles = (1..<100_000_000).map { _ in Circle(...) }\n\nfor circle in circles {\n    circle.draw()\n}\n```\n当我们用协议来替代的时候，此时它并不知道这个对象是结构体还是类。因为这里可能是任何一个实现此协议的类型。\n\n```\nprotocol Drawable {\n    func draw()\n}\n\nstruct Circle: Drawable {\n    let radius: Double\n    let center: Point\n\n    func draw() {}\n}\n\nvar drawables: [Drawable] = (1..<100_000_000).map { _ in return Circle(...) }\n\nfor drawable in drawables {\n    drawable.draw()\n}\n```\n那么我们该如何去调度这个 draw 函数呢？答案就位于协议记录表 (protocol witness table，也称为虚函数表) 当中。它其中存放了您应用当中每个实现协议的对象名，并且在底层实现当中，这个表本质上充当了这些类型的别名。\n\n```\nprotocol Drawable {\n    func draw()\n}\n\nstruct Circle: Drawable {\n    let radius: Double\n    let center: Point\n\n    func draw() {}\n}\n\nvar drawables: [Drawable] = (1..<100_000_000).map { _ in\n    return Circle(...)\n}\n\nfor drawable in drawables {\n    drawable.draw()\n}\n```\n在这里的代码当中，我们该如何获取协议记录表呢？答案就是从这个既有容器 (existential container) 当中获取，这个容器目前拥有一个三个字大小的结构体，并且存放在其内部的值缓冲区当中，此外还与协议记录表建立了引用关系。\n\n```\nstruct Circle: Drawable {\n    let radius: Double\n    let center: Point\n\n    func draw() {}\n}\n```\n这里 Circle 类型存放在了三个字大小的缓冲区当中，并且不会被单独引用。\n\n```\nstruct Line: Drawable {\n    let origin: Point\n    let end: Point\n\n    func draw() {}\n}\n```\n举个例子，对于我们的 Line 类型来说，它其中包含了四个字的存储空间，因为它拥有两个点类型。这个 Line 结构体需要超过四个字以上的存储空间。我们该如何处理它呢？这会对性能有影响么？好吧，它的确会：\n\n```\nprotocol Drawable {\n    func draw()\n}\n\nstruct Line: Drawable {\n    let origin: Point\n    let end: Point\n    func draw() {}\n}\n\nlet drawables: [Drawable] = (1..<100_000_000).map { _ in Line(...) }\n\nfor drawable in drawables {\n    drawable.draw()\n}\n```\n这需要花费 45 秒钟的时间来运行。为什么这里要花这么久的时间呢，发生了什么事呢？\n\n绝大部分的时间都花费在对结构体进行内存分配上了，因为现在它们无法存放在只有三个字大小的缓冲区当中了。因此这些结构会在堆上进行内存分配，此外这也与协议有一点关系。由于既有容器只能够存储三个字大小的结构体，或者也可以与对象建立引用关系，我们同样需要某种名为值记录表 (value witness table)。这就是我们用来处理任意值的东西。\n\n因此在这里，编译器将创建一个值记录表，对每个���缓冲区、内敛结构体来说，都有三个字大小的缓冲区，然后它将负责对值或者类进行内存分配、拷贝、销毁和内存释放等操作。\n\n```\nfunc draw(drawable: Drawable) {\n    drawable.draw()\n}\n\nlet value: Drawable = Line()\ndraw(local: value)\n\n// Generates\nfunc draw(value: ECTDrawable) {\n    var drawable: ECTDrawable = ECTDrawable()\n    let vwt = value.vwt\n    let pwt = value.pwt\n    drawable.vwt = value.vwt\n    drawable.pwt = value.pwt\n    vwt.allocateBuffAndCopyValue(&drawable, value)\n    pwt.draw(vwt.projectBuffer(&drawable)\n}\n```\n这里是一个例子，这就是这个过程的中间产物。如果我们只有一个 draw 函数，那么它将会接受我们创建的 Line 作为参数，因此我们将它传递给这个 draw 函数即可。\n\n实际情况时，它将这个 Drawable 协议传递到既有容器当中，然后在函数内部再次进行创建。这会对值和协议记录表进行赋值，然后分配一个新的缓冲区，然后将其他结构、类或者类似对象的值拷贝进这个缓冲区当中。然后就使用协议记录表当中的 draw 函数，把真实的 Drable 对象传递给这个函数。\n\n您可以看到，值记录表和协议记录表将会存放在栈上，而 Line 将会被存放在堆上，从而最后将线绘制出来。\n\n## 结论\n\n对我们进行数据建模的方式进行简单的更改将会对性能造成巨大的影响。让我们来看一看该如何来避免这些情况的发生。\n\n首先让我们来说一说泛型。大家可能会说了，我给各位展示了协议会导致性能的下降，那么我们为什么还要使用泛型呢？答案在于：泛型允许我们做什么。\n\n```\nstruct Stack<T: Type> {\n...\n}\n```\n假设我们这里有一个带有泛型 T 的 Stack 结构体，它受到一个协议类型的约束。编译器所要做的，就是将这个 T 提换成相应的协议，或者替换为我们传入的具体类型。这些操作会一直沿着函数链 (function chain) 执行，并且编译器会创建直接对此类型进行操作的专用版本。\n\n这样我们就无需再使用值记录表或者协议记录表了，并且还移除了既有容器，这可能是一个非常好的解决方式，这使得我们仍然能够写出真正快速运行的泛型代码，并且还具备 Swift 所提供的良好多态性。这就是所谓的静态多态性 (static polymorphism)。\n\n您还可以通过使用枚举来改进数据模型，而不是从服务器中获取大量的字符串。例如，假设您正在构建一个社交应用，您需要对账户建立状态的管理，以前您可能会使用字符串来进行控制。\n\n```\nenum AccountStatus: String, RawRepresentable {\ncase .banned, .verified, incomplete\n}\n```\n如果我们改用枚举的话，那么我们就无需进行内存分配了，当我们传递这个类型的时候，我们只是将枚举值进行传递，这是一个加快代码运行速度的好方法，同时也可以为整个应用程序提供更安全、更可读的代码。\n\n此外，使用 u-模型或者演示者 (Presenter) 或者不同的抽象类型的形式，来构建特定类型的模型也是非常有用的，这使得我们能够精简掉应用当中许多不必要的部分。\n\n好的，我的讲演到此结束，内容很短，感谢诸位的参与！\n\n\n","slug":"real-world-swift-performance","published":1,"updated":"2017-01-18T10:46:36.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0fa80014l0uv13km9mnd","content":"<p>原文链接：<a href=\"https://realm.io/cn/news/real-world-swift-performance/\" target=\"_blank\" rel=\"external\">真实世界中的 Swift 性能优化</a></p>\n<a id=\"more\"></a>\n<hr>\n<p>有太多的因素会导致您的应用变得缓慢。在本次讲演中，我们将自底向上地来探索应用的性能优化。来看一看在真实世界中进行数据解析、数据映射和数据存储的时候，Swift 的特性（协议、泛型、结构体和类）是如何影响应用性能的，我们将确定影响性能提升的瓶颈所在，并体验 Swift 带来的「迅捷」体验。</p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>今天我打算同大家谈论 Swift 性能优化方面的内容。当我们构建软件的时候，特别是移动软件，由于人们的精力、时间有限，人们往往更喜欢有一个流畅的用户体验，而不是等着您的应用在那加载。如果应用运行速度过慢，并且不能给用户带来他们所想要的结果的话，那么这会让人们感到不爽。因此，让您的代码能够快速运行是无比重要的一件事。</p>\n<p>那么有什么因素会导致代码运行缓慢呢？当您在编写代码并选择架构的时候，深刻认识到这些架构所带来的影响是非常重要的。我将首先谈一谈：如何理解内联、动态调度与静态调度之间的权衡，以及相关结构是如何分配内存的，还有怎样选择最适合的架构。</p>\n<h2 id=\"内存分配\"><a href=\"#内存分配\" class=\"headerlink\" title=\"内存分配\"></a>内存分配</h2><p>对象的内存分配 (allocation) 和内存释放 (deallocation) 是代码中最大的开销之一，同时通常也是不可避免的。Swift 会自行分配和释放内存，此外它存在两种类型的分配方式。</p>\n<p>第一个是基于栈 (stack-based) 的内存分配。Swift 会尽可能选择在栈上分配内存。栈是一种非常简单的数据结构；数据从栈的底部推入 (push)，从栈的顶部弹出 (pop)。由于我们只能够修改栈的末端，因此我们可以通过维护一个指向栈末端的指针来实现这种数据结构，并且在其中进行内存的分配和释放只需要重新分配该整数即可。</p>\n<p>第二个是基于堆 (heap-based) 的内存分配。这使得内存分配将具备更加动态的生命周期，但是这需要更为复杂的数据结构。要在堆上进行内存分配的话，您需要锁定堆当中的一个空闲块 (free block)，其大小能够容纳您的对象。因此，我们需要找到未使用的块，然后在其中分配内存。当我们需要释放内存的时候，我们就必须搜索何处能够重新插入该内存块。这个操作很缓慢。主要是为了线程安全，我们必须要对这些东西进行锁定和同步。</p>\n<h2 id=\"引用计数\"><a href=\"#引用计数\" class=\"headerlink\" title=\"引用计数\"></a>引用计数</h2><p>我们还有引用计数 (reference counting) 的概念，这个操作相对不怎么耗费性能，但是由于使用次数很多，因此它带来的性能影响仍然是很大的。引用计数是 Objective-C 和 Swift 中用于确定何时该释放对象的安全机制。目前，Swift 当中的引用计数是强制自动管理的，这意味着它很容易被开发者们所忽略。然而，当您打开 Instrument 查看何处影响了代码运行的速度的时候，您会发现 20,000 多次的 Swift 持有 (retain) 和释放 (release)，这些操作占用了 90% 的代码运行时间！<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">perform</span><span class=\"params\">(with object: Object)</span></span> &#123;</div><div class=\"line\">    object.doAThing()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>这是因为如果有这样一个函数接收了一个对象作为参数，并且执行了这个对象的 doAThing() 方法，编译器会自动插入对象持有和释放操作，以确保在这个方法的生命周期当中，这个对象不会被回收掉。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">perform</span><span class=\"params\">(with object: Object)</span></span> &#123;</div><div class=\"line\">    __swift_retain(object)</div><div class=\"line\">    object.doAThing()</div><div class=\"line\">    __swift_release(object)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>这些对象持有和释放操作是原子操作 (atomic operations)，所以它们运转缓慢就很正常了。或者，是因为我们不知道如何让它们能够运行得更快一些。</p>\n<h2 id=\"调度与对象\"><a href=\"#调度与对象\" class=\"headerlink\" title=\"调度与对象\"></a>调度与对象</h2><p>此外还有调度 (dispatch) 的概念。Swift 拥有三种类型的调度方式。Swift 会尽可能将函数内联 (inline)，这样的话使用这个函数将不会有额外的性能开销。这个函数可以直接调用。静态调度 (static dispatch) 本质上是通过 V-table 进行的查找和跳转，这个操作会花费一纳秒的时间。然后动态调度 (dynamic dispatch) 将会花费大概五纳秒的时间，如果您只有几个这样的方法调用的话，这实际上并不会带来多大的问题，问题是当您在一个嵌套循环或者执行上千次操作当中使用了动态调度的话，那么它所带来的性能耗费将成百上千地累积起来，最终影响应用性能。</p>\n<p>Swift 同样也有两种类型的对象。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Index</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> section: <span class=\"type\">Int</span></div><div class=\"line\">    <span class=\"keyword\">let</span> item: <span class=\"type\">Int</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i = <span class=\"type\">Index</span>(section: <span class=\"number\">1</span>,</div><div class=\"line\">                item: <span class=\"number\">1</span>)</div></pre></td></tr></table></figure></p>\n<p>这是一个类，类当中的数据都会在堆上分配内存。您可以在此处看到，这里我们创建了一个名为 Index 的类。其中包含了两个属性，一个 section 和一个 item。当我们创建了这个对象的时候，堆上便创建了一个指向此 Index 的指针，因此在堆上便存放了这个 section 和 item 的数据和空间。</p>\n<p>如果我们对其建立引用，就会发现我们现在有两个指向堆上相同区域的指针了，它们之间是共享内存的。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Index</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> section: <span class=\"type\">Int</span></div><div class=\"line\">    <span class=\"keyword\">let</span> item: <span class=\"type\">Int</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i = <span class=\"type\">Index</span>(section: <span class=\"number\">1</span>,</div><div class=\"line\">                item: <span class=\"number\">1</span>)</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i2 = i</div></pre></td></tr></table></figure></p>\n<p>这个时候，Swift 会自动插入对象持有操作。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Index</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> section: <span class=\"type\">Int</span></div><div class=\"line\">    <span class=\"keyword\">let</span> item: <span class=\"type\">Int</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i = <span class=\"type\">Index</span>(section: <span class=\"number\">1</span>,</div><div class=\"line\">                item: <span class=\"number\">1</span>)</div><div class=\"line\"></div><div class=\"line\">__swift_retain(i)</div><div class=\"line\"><span class=\"keyword\">let</span> i2 = i</div></pre></td></tr></table></figure></p>\n<h2 id=\"结构体\"><a href=\"#结构体\" class=\"headerlink\" title=\"结构体\"></a>结构体</h2><p>很多人都会说：要编写性能优异的 Swift 代码，最简单的方式就是使用结构体了，结构体通常是一个很好的结构，因为结构体会存储在栈上，并且通常会使用静态调度或者内联调度。</p>\n<p>存储在栈上的 Swift 结构体将占用三个 Word 大小。如果您的结构体当中的数据数量低于三种的话，那么结构体的值会自动在栈上内联。Word 是 CPU 当中内置整数的大小，它是 CPU 所工作的区块。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Index</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> section: <span class=\"type\">Int</span></div><div class=\"line\">    <span class=\"keyword\">let</span> item: <span class=\"type\">Int</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i = <span class=\"type\">Index</span>(section: <span class=\"number\">1</span>, item: <span class=\"number\">1</span>)</div></pre></td></tr></table></figure></p>\n<p>在这里您可以看到，当我们创建这个结构体的时候，带有 section 和 item 值得 Index 结构体将会直接下放到栈当中，这个时候不会有额外的内存分配发生。那么如果我们在别处将其赋值到另一个变量的时候，会发生什么呢？<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Index</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> section: <span class=\"type\">Int</span></div><div class=\"line\">    <span class=\"keyword\">let</span> item: <span class=\"type\">Int</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i = <span class=\"type\">Index</span>(section: <span class=\"number\">1</span>, item: <span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"keyword\">let</span> i2 = i</div></pre></td></tr></table></figure></p>\n<p>如果我们将 i 赋给 i2，这会将我们存储在栈当中的值直接再次复制一遍，这个时候并不会出现引用的情况。这就是所谓的「值类型」。</p>\n<p>那么如果结构体当中存放了引用类型的话又会怎样呢？持有内联指针的结构体。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">User</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> name: <span class=\"type\">String</span></div><div class=\"line\">    <span class=\"keyword\">let</span> id: <span class=\"type\">String</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> u = <span class=\"type\">User</span>(name: <span class=\"string\">\"Joe\"</span>, id: <span class=\"string\">\"1234\"</span>)</div></pre></td></tr></table></figure></p>\n<p>当我们将其赋值给别的变量的时候，我们就持有了共享两个结构体的相同指针，因此我们必须要对这两个指针进行持有操作，而不是在对象上执行单独的持有操作。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">User</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> name: <span class=\"type\">String</span></div><div class=\"line\">    <span class=\"keyword\">let</span> id: <span class=\"type\">String</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> u = <span class=\"type\">User</span>(name: <span class=\"string\">\"Joe\"</span>,</div><div class=\"line\">             id: <span class=\"string\">\"1234\"</span>)</div><div class=\"line\">__swift_retain(u.name._textStorage)</div><div class=\"line\">__swift_retain(u.id._textStorage)</div><div class=\"line\"><span class=\"keyword\">let</span> u2 = u</div></pre></td></tr></table></figure></p>\n<p>如果其中包含了类的话，那么性能耗费会更大。</p>\n<h2 id=\"抽象类型\"><a href=\"#抽象类型\" class=\"headerlink\" title=\"抽象类型\"></a>抽象类型</h2><p>正如我们此前所述，Swift 提供了许多不同的抽象类型 (abstraction)，从而允许我们自行决定代码该如何运行，以及决定代码的性能特性。现在我们来看一看抽象类型是如何在实际环境当中使用的。这里有一段很简单的代码：<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Circle</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> radius: <span class=\"type\">Double</span></div><div class=\"line\">    <span class=\"keyword\">let</span> center: <span class=\"type\">Point</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">draw</span><span class=\"params\">()</span></span> &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> circles = (<span class=\"number\">1</span>..&lt;<span class=\"number\">100_000_000</span>).<span class=\"built_in\">map</span> &#123; <span class=\"number\">_</span> <span class=\"keyword\">in</span> <span class=\"type\">Circle</span>(...) &#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> circle <span class=\"keyword\">in</span> circles &#123;</div><div class=\"line\">    circle.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>这里有一个带有 radius 和 center 属性的 Circle 结构体。它将占用三个 Word 大小的空间，并存储在栈上。我们创建了一亿个 Circle，然后我们遍历这些 Circle 并调用这个函数。在我的电脑上，这段操作在发布模式下耗费了 0.3 秒的时间。那么当需求发生变更的时候，会发生什么事呢？</p>\n<p>我们不仅需要绘圆，还需要能够处理多种类型的形状。让我们假设我们还需要绘线。我非常喜欢面向协议编程，因为它允许我在不使用继承的情况下实现多态性，并且它允许我们只需要考虑这个「抽象类型」即可。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">protocol Drawable &#123;</div><div class=\"line\">    func draw()</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">struct Circle: Drawable &#123;</div><div class=\"line\">    let radius: Double</div><div class=\"line\">    let center: Point</div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">let drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in Circle(...) &#125;</div><div class=\"line\"></div><div class=\"line\">for drawable in drawables &#123;</div><div class=\"line\">    drawable.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>我们需要做的，就是将这个 draw 方法析取到协议当中，然后将数组的引用类型变更为这个协议，这样做导致这段代码花费了 4.0 秒的时间来运行。速率减慢了 1300%，这是为什么呢？</p>\n<p>这是因为此前的代码可以被静态调度，从而在没有任何堆应用建立的情况下仍能够执行。这就是协议是如何实现的。</p>\n<p>例如，如大家所见，这里是我们此前的 Circle 结构体。在这个 for 循环当中，Swift 编译器所做的就是前往 V-table 进行查找，或者直接将 draw 函数内联。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">struct Circle &#123;</div><div class=\"line\">    let radius: Double</div><div class=\"line\">    let center: Point</div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">var circles = (1..&lt;100_000_000).map &#123; _ in Circle(...) &#125;</div><div class=\"line\"></div><div class=\"line\">for circle in circles &#123;</div><div class=\"line\">    circle.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>当我们用协议来替代的时候，此时它并不知道这个对象是结构体还是类。因为这里可能是任何一个实现此协议的类型。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">protocol Drawable &#123;</div><div class=\"line\">    func draw()</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">struct Circle: Drawable &#123;</div><div class=\"line\">    let radius: Double</div><div class=\"line\">    let center: Point</div><div class=\"line\"></div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">var drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in return Circle(...) &#125;</div><div class=\"line\"></div><div class=\"line\">for drawable in drawables &#123;</div><div class=\"line\">    drawable.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>那么我们该如何去调度这个 draw 函数呢？答案就位于协议记录表 (protocol witness table，也称为虚函数表) 当中。它其中存放了您应用当中每个实现协议的对象名，并且在底层实现当中，这个表本质上充当了这些类型的别名。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">protocol Drawable &#123;</div><div class=\"line\">    func draw()</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">struct Circle: Drawable &#123;</div><div class=\"line\">    let radius: Double</div><div class=\"line\">    let center: Point</div><div class=\"line\"></div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">var drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in</div><div class=\"line\">    return Circle(...)</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">for drawable in drawables &#123;</div><div class=\"line\">    drawable.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在这里的代码当中，我们该如何获取协议记录表呢？答案就是从这个既有容器 (existential container) 当中获取，这个容器目前拥有一个三个字大小的结构体，并且存放在其内部的值缓冲区当中，此外还与协议记录表建立了引用关系。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">struct Circle: Drawable &#123;</div><div class=\"line\">    let radius: Double</div><div class=\"line\">    let center: Point</div><div class=\"line\"></div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这里 Circle 类型存放在了三个字大小的缓冲区当中，并且不会被单独引用。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">struct Line: Drawable &#123;</div><div class=\"line\">    let origin: Point</div><div class=\"line\">    let end: Point</div><div class=\"line\"></div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>举个例子，对于我们的 Line 类型来说，它其中包含了四个字的存储空间，因为它拥有两个点类型。这个 Line 结构体需要超过四个字以上的存储空间。我们该如何处理它呢？这会对性能有影响么？好吧，它的确会：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">protocol Drawable &#123;</div><div class=\"line\">    func draw()</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">struct Line: Drawable &#123;</div><div class=\"line\">    let origin: Point</div><div class=\"line\">    let end: Point</div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">let drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in Line(...) &#125;</div><div class=\"line\"></div><div class=\"line\">for drawable in drawables &#123;</div><div class=\"line\">    drawable.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这需要花费 45 秒钟的时间来运行。为什么这里要花这么久的时间呢，发生了什么事呢？</p>\n<p>绝大部分的时间都花费在对结构体进行内存分配上了，因为现在它们无法存放在只有三个字大小的缓冲区当中了。因此这些结构会在堆上进行内存分配，此外这也与协议有一点关系。由于既有容器只能够存储三个字大小的结构体，或者也可以与对象建立引用关系，我们同样需要某种名为值记录表 (value witness table)。这就是我们用来处理任意值的东西。</p>\n<p>因此在这里，编译器将创建一个值记录表，对每个���缓冲区、内敛结构体来说，都有三个字大小的缓冲区，然后它将负责对值或者类进行内存分配、拷贝、销毁和内存释放等操作。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">func draw(drawable: Drawable) &#123;</div><div class=\"line\">    drawable.draw()</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">let value: Drawable = Line()</div><div class=\"line\">draw(local: value)</div><div class=\"line\"></div><div class=\"line\">// Generates</div><div class=\"line\">func draw(value: ECTDrawable) &#123;</div><div class=\"line\">    var drawable: ECTDrawable = ECTDrawable()</div><div class=\"line\">    let vwt = value.vwt</div><div class=\"line\">    let pwt = value.pwt</div><div class=\"line\">    drawable.vwt = value.vwt</div><div class=\"line\">    drawable.pwt = value.pwt</div><div class=\"line\">    vwt.allocateBuffAndCopyValue(&amp;drawable, value)</div><div class=\"line\">    pwt.draw(vwt.projectBuffer(&amp;drawable)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这里是一个例子，这就是这个过程的中间产物。如果我们只有一个 draw 函数，那么它将会接受我们创建的 Line 作为参数，因此我们将它传递给这个 draw 函数即可。</p>\n<p>实际情况时，它将这个 Drawable 协议传递到既有容器当中，然后在函数内部再次进行创建。这会对值和协议记录表进行赋值，然后分配一个新的缓冲区，然后将其他结构、类或者类似对象的值拷贝进这个缓冲区当中。然后就使用协议记录表当中的 draw 函数，把真实的 Drable 对象传递给这个函数。</p>\n<p>您可以看到，值记录表和协议记录表将会存放在栈上，而 Line 将会被存放在堆上，从而最后将线绘制出来。</p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>对我们进行数据建模的方式进行简单的更改将会对性能造成巨大的影响。让我们来看一看该如何来避免这些情况的发生。</p>\n<p>首先让我们来说一说泛型。大家可能会说了，我给各位展示了协议会导致性能的下降，那么我们为什么还要使用泛型呢？答案在于：泛型允许我们做什么。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">struct Stack&lt;T: Type&gt; &#123;</div><div class=\"line\">...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>假设我们这里有一个带有泛型 T 的 Stack 结构体，它受到一个协议类型的约束。编译器所要做的，就是将这个 T 提换成相应的协议，或者替换为我们传入的具体类型。这些操作会一直沿着函数链 (function chain) 执行，并且编译器会创建直接对此类型进行操作的专用版本。</p>\n<p>这样我们就无需再使用值记录表或者协议记录表了，并且还移除了既有容器，这可能是一个非常好的解决方式，这使得我们仍然能够写出真正快速运行的泛型代码，并且还具备 Swift 所提供的良好多态性。这就是所谓的静态多态性 (static polymorphism)。</p>\n<p>您还可以通过使用枚举来改进数据模型，而不是从服务器中获取大量的字符串。例如，假设您正在构建一个社交应用，您需要对账户建立状态的管理，以前您可能会使用字符串来进行控制。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">enum AccountStatus: String, RawRepresentable &#123;</div><div class=\"line\">case .banned, .verified, incomplete</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>如果我们改用枚举的话，那么我们就无需进行内存分配了，当我们传递这个类型的时候，我们只是将枚举值进行传递，这是一个加快代码运行速度的好方法，同时也可以为整个应用程序提供更安全、更可读的代码。</p>\n<p>此外，使用 u-模型或者演示者 (Presenter) 或者不同的抽象类型的形式，来构建特定类型的模型也是非常有用的，这使得我们能够精简掉应用当中许多不必要的部分。</p>\n<p>好的，我的讲演到此结束，内容很短，感谢诸位的参与！</p>\n","excerpt":"<p>原文链接：<a href=\"https://realm.io/cn/news/real-world-swift-performance/\">真实世界中的 Swift 性能优化</a></p>","more":"<hr>\n<p>有太多的因素会导致您的应用变得缓慢。在本次讲演中，我们将自底向上地来探索应用的性能优化。来看一看在真实世界中进行数据解析、数据映射和数据存储的时候，Swift 的特性（协议、泛型、结构体和类）是如何影响应用性能的，我们将确定影响性能提升的瓶颈所在，并体验 Swift 带来的「迅捷」体验。</p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>今天我打算同大家谈论 Swift 性能优化方面的内容。当我们构建软件的时候，特别是移动软件，由于人们的精力、时间有限，人们往往更喜欢有一个流畅的用户体验，而不是等着您的应用在那加载。如果应用运行速度过慢，并且不能给用户带来他们所想要的结果的话，那么这会让人们感到不爽。因此，让您的代码能够快速运行是无比重要的一件事。</p>\n<p>那么有什么因素会导致代码运行缓慢呢？当您在编写代码并选择架构的时候，深刻认识到这些架构所带来的影响是非常重要的。我将首先谈一谈：如何理解内联、动态调度与静态调度之间的权衡，以及相关结构是如何分配内存的，还有怎样选择最适合的架构。</p>\n<h2 id=\"内存分配\"><a href=\"#内存分配\" class=\"headerlink\" title=\"内存分配\"></a>内存分配</h2><p>对象的内存分配 (allocation) 和内存释放 (deallocation) 是代码中最大的开销之一，同时通常也是不可避免的。Swift 会自行分配和释放内存，此外它存在两种类型的分配方式。</p>\n<p>第一个是基于栈 (stack-based) 的内存分配。Swift 会尽可能选择在栈上分配内存。栈是一种非常简单的数据结构；数据从栈的底部推入 (push)，从栈的顶部弹出 (pop)。由于我们只能够修改栈的末端，因此我们可以通过维护一个指向栈末端的指针来实现这种数据结构，并且在其中进行内存的分配和释放只需要重新分配该整数即可。</p>\n<p>第二个是基于堆 (heap-based) 的内存分配。这使得内存分配将具备更加动态的生命周期，但是这需要更为复杂的数据结构。要在堆上进行内存分配的话，您需要锁定堆当中的一个空闲块 (free block)，其大小能够容纳您的对象。因此，我们需要找到未使用的块，然后在其中分配内存。当我们需要释放内存的时候，我们就必须搜索何处能够重新插入该内存块。这个操作很缓慢。主要是为了线程安全，我们必须要对这些东西进行锁定和同步。</p>\n<h2 id=\"引用计数\"><a href=\"#引用计数\" class=\"headerlink\" title=\"引用计数\"></a>引用计数</h2><p>我们还有引用计数 (reference counting) 的概念，这个操作相对不怎么耗费性能，但是由于使用次数很多，因此它带来的性能影响仍然是很大的。引用计数是 Objective-C 和 Swift 中用于确定何时该释放对象的安全机制。目前，Swift 当中的引用计数是强制自动管理的，这意味着它很容易被开发者们所忽略。然而，当您打开 Instrument 查看何处影响了代码运行的速度的时候，您会发现 20,000 多次的 Swift 持有 (retain) 和释放 (release)，这些操作占用了 90% 的代码运行时间！<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">perform</span><span class=\"params\">(with object: Object)</span></span> &#123;</div><div class=\"line\">    object.doAThing()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>这是因为如果有这样一个函数接收了一个对象作为参数，并且执行了这个对象的 doAThing() 方法，编译器会自动插入对象持有和释放操作，以确保在这个方法的生命周期当中，这个对象不会被回收掉。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">perform</span><span class=\"params\">(with object: Object)</span></span> &#123;</div><div class=\"line\">    __swift_retain(object)</div><div class=\"line\">    object.doAThing()</div><div class=\"line\">    __swift_release(object)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>这些对象持有和释放操作是原子操作 (atomic operations)，所以它们运转缓慢就很正常了。或者，是因为我们不知道如何让它们能够运行得更快一些。</p>\n<h2 id=\"调度与对象\"><a href=\"#调度与对象\" class=\"headerlink\" title=\"调度与对象\"></a>调度与对象</h2><p>此外还有调度 (dispatch) 的概念。Swift 拥有三种类型的调度方式。Swift 会尽可能将函数内联 (inline)，这样的话使用这个函数将不会有额外的性能开销。这个函数可以直接调用。静态调度 (static dispatch) 本质上是通过 V-table 进行的查找和跳转，这个操作会花费一纳秒的时间。然后动态调度 (dynamic dispatch) 将会花费大概五纳秒的时间，如果您只有几个这样的方法调用的话，这实际上并不会带来多大的问题，问题是当您在一个嵌套循环或者执行上千次操作当中使用了动态调度的话，那么它所带来的性能耗费将成百上千地累积起来，最终影响应用性能。</p>\n<p>Swift 同样也有两种类型的对象。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Index</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> section: <span class=\"type\">Int</span></div><div class=\"line\">    <span class=\"keyword\">let</span> item: <span class=\"type\">Int</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i = <span class=\"type\">Index</span>(section: <span class=\"number\">1</span>,</div><div class=\"line\">                item: <span class=\"number\">1</span>)</div></pre></td></tr></table></figure></p>\n<p>这是一个类，类当中的数据都会在堆上分配内存。您可以在此处看到，这里我们创建了一个名为 Index 的类。其中包含了两个属性，一个 section 和一个 item。当我们创建了这个对象的时候，堆上便创建了一个指向此 Index 的指针，因此在堆上便存放了这个 section 和 item 的数据和空间。</p>\n<p>如果我们对其建立引用，就会发现我们现在有两个指向堆上相同区域的指针了，它们之间是共享内存的。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Index</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> section: <span class=\"type\">Int</span></div><div class=\"line\">    <span class=\"keyword\">let</span> item: <span class=\"type\">Int</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i = <span class=\"type\">Index</span>(section: <span class=\"number\">1</span>,</div><div class=\"line\">                item: <span class=\"number\">1</span>)</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i2 = i</div></pre></td></tr></table></figure></p>\n<p>这个时候，Swift 会自动插入对象持有操作。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Index</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> section: <span class=\"type\">Int</span></div><div class=\"line\">    <span class=\"keyword\">let</span> item: <span class=\"type\">Int</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i = <span class=\"type\">Index</span>(section: <span class=\"number\">1</span>,</div><div class=\"line\">                item: <span class=\"number\">1</span>)</div><div class=\"line\"></div><div class=\"line\">__swift_retain(i)</div><div class=\"line\"><span class=\"keyword\">let</span> i2 = i</div></pre></td></tr></table></figure></p>\n<h2 id=\"结构体\"><a href=\"#结构体\" class=\"headerlink\" title=\"结构体\"></a>结构体</h2><p>很多人都会说：要编写性能优异的 Swift 代码，最简单的方式就是使用结构体了，结构体通常是一个很好的结构，因为结构体会存储在栈上，并且通常会使用静态调度或者内联调度。</p>\n<p>存储在栈上的 Swift 结构体将占用三个 Word 大小。如果您的结构体当中的数据数量低于三种的话，那么结构体的值会自动在栈上内联。Word 是 CPU 当中内置整数的大小，它是 CPU 所工作的区块。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Index</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> section: <span class=\"type\">Int</span></div><div class=\"line\">    <span class=\"keyword\">let</span> item: <span class=\"type\">Int</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i = <span class=\"type\">Index</span>(section: <span class=\"number\">1</span>, item: <span class=\"number\">1</span>)</div></pre></td></tr></table></figure></p>\n<p>在这里您可以看到，当我们创建这个结构体的时候，带有 section 和 item 值得 Index 结构体将会直接下放到栈当中，这个时候不会有额外的内存分配发生。那么如果我们在别处将其赋值到另一个变量的时候，会发生什么呢？<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Index</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> section: <span class=\"type\">Int</span></div><div class=\"line\">    <span class=\"keyword\">let</span> item: <span class=\"type\">Int</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> i = <span class=\"type\">Index</span>(section: <span class=\"number\">1</span>, item: <span class=\"number\">1</span>)</div><div class=\"line\"><span class=\"keyword\">let</span> i2 = i</div></pre></td></tr></table></figure></p>\n<p>如果我们将 i 赋给 i2，这会将我们存储在栈当中的值直接再次复制一遍，这个时候并不会出现引用的情况。这就是所谓的「值类型」。</p>\n<p>那么如果结构体当中存放了引用类型的话又会怎样呢？持有内联指针的结构体。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">User</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> name: <span class=\"type\">String</span></div><div class=\"line\">    <span class=\"keyword\">let</span> id: <span class=\"type\">String</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> u = <span class=\"type\">User</span>(name: <span class=\"string\">\"Joe\"</span>, id: <span class=\"string\">\"1234\"</span>)</div></pre></td></tr></table></figure></p>\n<p>当我们将其赋值给别的变量的时候，我们就持有了共享两个结构体的相同指针，因此我们必须要对这两个指针进行持有操作，而不是在对象上执行单独的持有操作。<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">User</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> name: <span class=\"type\">String</span></div><div class=\"line\">    <span class=\"keyword\">let</span> id: <span class=\"type\">String</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">let</span> u = <span class=\"type\">User</span>(name: <span class=\"string\">\"Joe\"</span>,</div><div class=\"line\">             id: <span class=\"string\">\"1234\"</span>)</div><div class=\"line\">__swift_retain(u.name._textStorage)</div><div class=\"line\">__swift_retain(u.id._textStorage)</div><div class=\"line\"><span class=\"keyword\">let</span> u2 = u</div></pre></td></tr></table></figure></p>\n<p>如果其中包含了类的话，那么性能耗费会更大。</p>\n<h2 id=\"抽象类型\"><a href=\"#抽象类型\" class=\"headerlink\" title=\"抽象类型\"></a>抽象类型</h2><p>正如我们此前所述，Swift 提供了许多不同的抽象类型 (abstraction)，从而允许我们自行决定代码该如何运行，以及决定代码的性能特性。现在我们来看一看抽象类型是如何在实际环境当中使用的。这里有一段很简单的代码：<br><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Circle</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">let</span> radius: <span class=\"type\">Double</span></div><div class=\"line\">    <span class=\"keyword\">let</span> center: <span class=\"type\">Point</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">draw</span><span class=\"params\">()</span></span> &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> circles = (<span class=\"number\">1</span>..&lt;<span class=\"number\">100_000_000</span>).<span class=\"built_in\">map</span> &#123; <span class=\"number\">_</span> <span class=\"keyword\">in</span> <span class=\"type\">Circle</span>(...) &#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> circle <span class=\"keyword\">in</span> circles &#123;</div><div class=\"line\">    circle.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>这里有一个带有 radius 和 center 属性的 Circle 结构体。它将占用三个 Word 大小的空间，并存储在栈上。我们创建了一亿个 Circle，然后我们遍历这些 Circle 并调用这个函数。在我的电脑上，这段操作在发布模式下耗费了 0.3 秒的时间。那么当需求发生变更的时候，会发生什么事呢？</p>\n<p>我们不仅需要绘圆，还需要能够处理多种类型的形状。让我们假设我们还需要绘线。我非常喜欢面向协议编程，因为它允许我在不使用继承的情况下实现多态性，并且它允许我们只需要考虑这个「抽象类型」即可。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">protocol Drawable &#123;</div><div class=\"line\">    func draw()</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">struct Circle: Drawable &#123;</div><div class=\"line\">    let radius: Double</div><div class=\"line\">    let center: Point</div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">let drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in Circle(...) &#125;</div><div class=\"line\"></div><div class=\"line\">for drawable in drawables &#123;</div><div class=\"line\">    drawable.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>我们需要做的，就是将这个 draw 方法析取到协议当中，然后将数组的引用类型变更为这个协议，这样做导致这段代码花费了 4.0 秒的时间来运行。速率减慢了 1300%，这是为什么呢？</p>\n<p>这是因为此前的代码可以被静态调度，从而在没有任何堆应用建立的情况下仍能够执行。这就是协议是如何实现的。</p>\n<p>例如，如大家所见，这里是我们此前的 Circle 结构体。在这个 for 循环当中，Swift 编译器所做的就是前往 V-table 进行查找，或者直接将 draw 函数内联。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">struct Circle &#123;</div><div class=\"line\">    let radius: Double</div><div class=\"line\">    let center: Point</div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">var circles = (1..&lt;100_000_000).map &#123; _ in Circle(...) &#125;</div><div class=\"line\"></div><div class=\"line\">for circle in circles &#123;</div><div class=\"line\">    circle.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>当我们用协议来替代的时候，此时它并不知道这个对象是结构体还是类。因为这里可能是任何一个实现此协议的类型。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">protocol Drawable &#123;</div><div class=\"line\">    func draw()</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">struct Circle: Drawable &#123;</div><div class=\"line\">    let radius: Double</div><div class=\"line\">    let center: Point</div><div class=\"line\"></div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">var drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in return Circle(...) &#125;</div><div class=\"line\"></div><div class=\"line\">for drawable in drawables &#123;</div><div class=\"line\">    drawable.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>那么我们该如何去调度这个 draw 函数呢？答案就位于协议记录表 (protocol witness table，也称为虚函数表) 当中。它其中存放了您应用当中每个实现协议的对象名，并且在底层实现当中，这个表本质上充当了这些类型的别名。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">protocol Drawable &#123;</div><div class=\"line\">    func draw()</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">struct Circle: Drawable &#123;</div><div class=\"line\">    let radius: Double</div><div class=\"line\">    let center: Point</div><div class=\"line\"></div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">var drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in</div><div class=\"line\">    return Circle(...)</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">for drawable in drawables &#123;</div><div class=\"line\">    drawable.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在这里的代码当中，我们该如何获取协议记录表呢？答案就是从这个既有容器 (existential container) 当中获取，这个容器目前拥有一个三个字大小的结构体，并且存放在其内部的值缓冲区当中，此外还与协议记录表建立了引用关系。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">struct Circle: Drawable &#123;</div><div class=\"line\">    let radius: Double</div><div class=\"line\">    let center: Point</div><div class=\"line\"></div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这里 Circle 类型存放在了三个字大小的缓冲区当中，并且不会被单独引用。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">struct Line: Drawable &#123;</div><div class=\"line\">    let origin: Point</div><div class=\"line\">    let end: Point</div><div class=\"line\"></div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>举个例子，对于我们的 Line 类型来说，它其中包含了四个字的存储空间，因为它拥有两个点类型。这个 Line 结构体需要超过四个字以上的存储空间。我们该如何处理它呢？这会对性能有影响么？好吧，它的确会：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">protocol Drawable &#123;</div><div class=\"line\">    func draw()</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">struct Line: Drawable &#123;</div><div class=\"line\">    let origin: Point</div><div class=\"line\">    let end: Point</div><div class=\"line\">    func draw() &#123;&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">let drawables: [Drawable] = (1..&lt;100_000_000).map &#123; _ in Line(...) &#125;</div><div class=\"line\"></div><div class=\"line\">for drawable in drawables &#123;</div><div class=\"line\">    drawable.draw()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这需要花费 45 秒钟的时间来运行。为什么这里要花这么久的时间呢，发生了什么事呢？</p>\n<p>绝大部分的时间都花费在对结构体进行内存分配上了，因为现在它们无法存放在只有三个字大小的缓冲区当中了。因此这些结构会在堆上进行内存分配，此外这也与协议有一点关系。由于既有容器只能够存储三个字大小的结构体，或者也可以与对象建立引用关系，我们同样需要某种名为值记录表 (value witness table)。这就是我们用来处理任意值的东西。</p>\n<p>因此在这里，编译器将创建一个值记录表，对每个���缓冲区、内敛结构体来说，都有三个字大小的缓冲区，然后它将负责对值或者类进行内存分配、拷贝、销毁和内存释放等操作。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">func draw(drawable: Drawable) &#123;</div><div class=\"line\">    drawable.draw()</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">let value: Drawable = Line()</div><div class=\"line\">draw(local: value)</div><div class=\"line\"></div><div class=\"line\">// Generates</div><div class=\"line\">func draw(value: ECTDrawable) &#123;</div><div class=\"line\">    var drawable: ECTDrawable = ECTDrawable()</div><div class=\"line\">    let vwt = value.vwt</div><div class=\"line\">    let pwt = value.pwt</div><div class=\"line\">    drawable.vwt = value.vwt</div><div class=\"line\">    drawable.pwt = value.pwt</div><div class=\"line\">    vwt.allocateBuffAndCopyValue(&amp;drawable, value)</div><div class=\"line\">    pwt.draw(vwt.projectBuffer(&amp;drawable)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这里是一个例子，这就是这个过程的中间产物。如果我们只有一个 draw 函数，那么它将会接受我们创建的 Line 作为参数，因此我们将它传递给这个 draw 函数即可。</p>\n<p>实际情况时，它将这个 Drawable 协议传递到既有容器当中，然后在函数内部再次进行创建。这会对值和协议记录表进行赋值，然后分配一个新的缓冲区，然后将其他结构、类或者类似对象的值拷贝进这个缓冲区当中。然后就使用协议记录表当中的 draw 函数，把真实的 Drable 对象传递给这个函数。</p>\n<p>您可以看到，值记录表和协议记录表将会存放在栈上，而 Line 将会被存放在堆上，从而最后将线绘制出来。</p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>对我们进行数据建模的方式进行简单的更改将会对性能造成巨大的影响。让我们来看一看该如何来避免这些情况的发生。</p>\n<p>首先让我们来说一说泛型。大家可能会说了，我给各位展示了协议会导致性能的下降，那么我们为什么还要使用泛型呢？答案在于：泛型允许我们做什么。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">struct Stack&lt;T: Type&gt; &#123;</div><div class=\"line\">...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>假设我们这里有一个带有泛型 T 的 Stack 结构体，它受到一个协议类型的约束。编译器所要做的，就是将这个 T 提换成相应的协议，或者替换为我们传入的具体类型。这些操作会一直沿着函数链 (function chain) 执行，并且编译器会创建直接对此类型进行操作的专用版本。</p>\n<p>这样我们就无需再使用值记录表或者协议记录表了，并且还移除了既有容器，这可能是一个非常好的解决方式，这使得我们仍然能够写出真正快速运行的泛型代码，并且还具备 Swift 所提供的良好多态性。这就是所谓的静态多态性 (static polymorphism)。</p>\n<p>您还可以通过使用枚举来改进数据模型，而不是从服务器中获取大量的字符串。例如，假设您正在构建一个社交应用，您需要对账户建立状态的管理，以前您可能会使用字符串来进行控制。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">enum AccountStatus: String, RawRepresentable &#123;</div><div class=\"line\">case .banned, .verified, incomplete</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>如果我们改用枚举的话，那么我们就无需进行内存分配了，当我们传递这个类型的时候，我们只是将枚举值进行传递，这是一个加快代码运行速度的好方法，同时也可以为整个应用程序提供更安全、更可读的代码。</p>\n<p>此外，使用 u-模型或者演示者 (Presenter) 或者不同的抽象类型的形式，来构建特定类型的模型也是非常有用的，这使得我们能够精简掉应用当中许多不必要的部分。</p>\n<p>好的，我的讲演到此结束，内容很短，感谢诸位的参与！</p>"},{"title":"UI素材与代码解耦的讨论与思考","date":"2016-08-28T04:16:02.000Z","_content":"\n个人对UI素材和代码的解耦的一些粗浅的看法。比如：解耦方案、是否该解耦。\n\n<!--more-->\n\n## 起因\n  \n  群里听到有人讨论这个话题，当时觉得比较新鲜，就十分好奇的请教了两位经验丰富的@kkk、@AK，虽然未得其中真髓，但是也得到一些自己的思考。总结一下两人的方案，以及自己的思考，\n  \n  \n## 问题\n  \n  代码内部引入的素材属于设计管理，代码则是码农管理，从这个角度来说两个工做都有码农管理则是一种耦合，为了减轻设计师频繁更换素材而带来的码农的无休止的协作，所以可以进行着方面的解藕。\n  \n  \n## 解决方案\n\n  哪坏哪补。有问题就会有解决方案。群中说的[方案一](#方案一)由于当时不方便，所以并没有弄明白。[方案二](#方案二)、[方案三](#方案三)是自己的一些解决方案。\n  \n  \n### <a name=\"方案一\">方案一</a>\n\n  群中讨论的是素材、代码放在一个仓库，分支不同，使用脚本进行整合(其实并没有想明白怎么弄。。下周请教一下)。另外，@夏汁泡泡 还有一个简化就是这个处理的脚本可以放在[Add Run Script Build Phase](https://developer.apple.com/library/ios/recipes/xcode_help-project_editor/Articles/AddingaRunScriptBuildPhase.html)，暴露出来已知的问题：\n  \n  - 操作麻烦\n  - 图片可能重复\n  - 命名规范\n\n\n### <a name=\"方案二\">方案二</a>\n\n  按照Pods的集成方式，可以将素材看作一个第三方库，直接将素材做成一个bundle，采用Pods私有库或者其他方式放入工程。暴露出来已知的问题：\n \n  - 什么时候更新这个bundle\n  - 多人合作时这个bundle冲突问题\n  - 命名规范\n\n\n### <a name=\"方案三\">方案三</a>\n\n  工程使用`xcassets`进行素材打包，然后使用子库进行持续集成。这样，设计师的素材可以放在另一个独立素材仓库，内含更新脚本，直接将素材生成对应的`xcassets`结构，并上传至子库。这样设计师做完素材直接扔在文件夹中，自动或手动跑一下脚本即可更新到素材仓库。暴露出来已知的问题：\n  \n  - 由于没有测试过，不知道如果素材比较多的话会不会发生冲突。因该不会吧，都是加文件或者修改😂 (有时间去研究一下之后更新)\n  - 命名规范的问题依旧存在\n  \n### <a name=\"方案四\">方案四</a>\n\n  __ 字体库 __。最近同事提出关于用字体库去存储素材图片的方案。感觉非常的赞，虽然并未实践，但是这种方案就像emoji一样，不但减少了相同图片内容之间存在多个不同尺寸版本的问题，也能够比较好的进行压缩管理。设计师需要做的就是做出一套字体库，然后将所有的素材图全部按照设计字体的方案进行设计和制作，这样在使用的时候只需要导入一个字体文件就好了。对于这个字体文件如何管理都好说，毕竟只有一个字体文件。字体库的制作方面还不是很了解，所以只提着么一下吧嘿嘿。。\n  \n  \n  \n## 思考\n\n  好了，重要的问题来了，上面的问题都是存在命名规范的问题。此问题如何化解呢？\n  \n  素材的引入需根据素材名写入代码中，那么如何才能不用素材名呢？那时不可能的😝，毕竟你要有一个唯一标识符去标志着一个素材。可能有的人说可以做一个json用来保存代码的命名和素材的命名呀，我只想说MDZZ，那不是有两套需要维护的命名规则么。。得不偿失。\n  \n  这个命名的问题其实不能复杂化。参看iOS的项目国际化操作，使用一个key作为文案的唯一标识符，需要显示该文案，通过这个唯一标识符就能直接取到。回头看下素材，是不是也能炮制一个呢？\n  \n  如果素材名字有统一的规则，就不需要这样的key作为统一标识符，直接使用素材名字即可，这样维护一套素材命名规则总比两套更容易维护。所以，直接使用素材名即可。\n  \n  如果素材不能统一命名规则，那么这样的对照文件存在也是很不错的。话又说回来，要进行UI素材和代码的解耦，素材名都不能统一，还如何解耦，此问题也不存在了。。\n  \n  退一步，我们的目的是让素材让设计师自己维护，代码不去维护素材。设计师和码农的耦合在于图片本身的交换比较烦。不论采用哪种解耦方案，都是把图片的耦合转换为图片名字的耦合(也可以理解为素材对应的KEY的耦合)。结果是 __ 为了解除一个耦合,而引入了一个新的耦合 __ 。个人认为这样是不靠谱的。。除非有强力的人去推动设计师走标准的命名。\n  \n  \n## 结论\n\n  其实这个问题大可不必纠结，如果有强力的人去推动这个标准持续走下去那么这个问题才有价值。如果真的要进行题中说的代码解耦的话，我认为第三种是比较靠谱的。 __ 命名标准、命名标准、命名标准... __。\n  \n  \n## 说明\n\n  经验有限，如果有更好的方案，望告知。拜谢！","source":"_posts/ui-source-and-code-decoupling.md","raw":"---\ntitle: UI素材与代码解耦的讨论与思考\ndate: 2016-08-28 12:16:02\ntags:\n  - iOS\n---\n\n个人对UI素材和代码的解耦的一些粗浅的看法。比如：解耦方案、是否该解耦。\n\n<!--more-->\n\n## 起因\n  \n  群里听到有人讨论这个话题，当时觉得比较新鲜，就十分好奇的请教了两位经验丰富的@kkk、@AK，虽然未得其中真髓，但是也得到一些自己的思考。总结一下两人的方案，以及自己的思考，\n  \n  \n## 问题\n  \n  代码内部引入的素材属于设计管理，代码则是码农管理，从这个角度来说两个工做都有码农管理则是一种耦合，为了减轻设计师频繁更换素材而带来的码农的无休止的协作，所以可以进行着方面的解藕。\n  \n  \n## 解决方案\n\n  哪坏哪补。有问题就会有解决方案。群中说的[方案一](#方案一)由于当时不方便，所以并没有弄明白。[方案二](#方案二)、[方案三](#方案三)是自己的一些解决方案。\n  \n  \n### <a name=\"方案一\">方案一</a>\n\n  群中讨论的是素材、代码放在一个仓库，分支不同，使用脚本进行整合(其实并没有想明白怎么弄。。下周请教一下)。另外，@夏汁泡泡 还有一个简化就是这个处理的脚本可以放在[Add Run Script Build Phase](https://developer.apple.com/library/ios/recipes/xcode_help-project_editor/Articles/AddingaRunScriptBuildPhase.html)，暴露出来已知的问题：\n  \n  - 操作麻烦\n  - 图片可能重复\n  - 命名规范\n\n\n### <a name=\"方案二\">方案二</a>\n\n  按照Pods的集成方式，可以将素材看作一个第三方库，直接将素材做成一个bundle，采用Pods私有库或者其他方式放入工程。暴露出来已知的问题：\n \n  - 什么时候更新这个bundle\n  - 多人合作时这个bundle冲突问题\n  - 命名规范\n\n\n### <a name=\"方案三\">方案三</a>\n\n  工程使用`xcassets`进行素材打包，然后使用子库进行持续集成。这样，设计师的素材可以放在另一个独立素材仓库，内含更新脚本，直接将素材生成对应的`xcassets`结构，并上传至子库。这样设计师做完素材直接扔在文件夹中，自动或手动跑一下脚本即可更新到素材仓库。暴露出来已知的问题：\n  \n  - 由于没有测试过，不知道如果素材比较多的话会不会发生冲突。因该不会吧，都是加文件或者修改😂 (有时间去研究一下之后更新)\n  - 命名规范的问题依旧存在\n  \n### <a name=\"方案四\">方案四</a>\n\n  __ 字体库 __。最近同事提出关于用字体库去存储素材图片的方案。感觉非常的赞，虽然并未实践，但是这种方案就像emoji一样，不但减少了相同图片内容之间存在多个不同尺寸版本的问题，也能够比较好的进行压缩管理。设计师需要做的就是做出一套字体库，然后将所有的素材图全部按照设计字体的方案进行设计和制作，这样在使用的时候只需要导入一个字体文件就好了。对于这个字体文件如何管理都好说，毕竟只有一个字体文件。字体库的制作方面还不是很了解，所以只提着么一下吧嘿嘿。。\n  \n  \n  \n## 思考\n\n  好了，重要的问题来了，上面的问题都是存在命名规范的问题。此问题如何化解呢？\n  \n  素材的引入需根据素材名写入代码中，那么如何才能不用素材名呢？那时不可能的😝，毕竟你要有一个唯一标识符去标志着一个素材。可能有的人说可以做一个json用来保存代码的命名和素材的命名呀，我只想说MDZZ，那不是有两套需要维护的命名规则么。。得不偿失。\n  \n  这个命名的问题其实不能复杂化。参看iOS的项目国际化操作，使用一个key作为文案的唯一标识符，需要显示该文案，通过这个唯一标识符就能直接取到。回头看下素材，是不是也能炮制一个呢？\n  \n  如果素材名字有统一的规则，就不需要这样的key作为统一标识符，直接使用素材名字即可，这样维护一套素材命名规则总比两套更容易维护。所以，直接使用素材名即可。\n  \n  如果素材不能统一命名规则，那么这样的对照文件存在也是很不错的。话又说回来，要进行UI素材和代码的解耦，素材名都不能统一，还如何解耦，此问题也不存在了。。\n  \n  退一步，我们的目的是让素材让设计师自己维护，代码不去维护素材。设计师和码农的耦合在于图片本身的交换比较烦。不论采用哪种解耦方案，都是把图片的耦合转换为图片名字的耦合(也可以理解为素材对应的KEY的耦合)。结果是 __ 为了解除一个耦合,而引入了一个新的耦合 __ 。个人认为这样是不靠谱的。。除非有强力的人去推动设计师走标准的命名。\n  \n  \n## 结论\n\n  其实这个问题大可不必纠结，如果有强力的人去推动这个标准持续走下去那么这个问题才有价值。如果真的要进行题中说的代码解耦的话，我认为第三种是比较靠谱的。 __ 命名标准、命名标准、命名标准... __。\n  \n  \n## 说明\n\n  经验有限，如果有更好的方案，望告知。拜谢！","slug":"ui-source-and-code-decoupling","published":1,"updated":"2016-10-22T14:00:13.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0fac0015l0uvevwnzh7x","content":"<p>个人对UI素材和代码的解耦的一些粗浅的看法。比如：解耦方案、是否该解耦。</p>\n<a id=\"more\"></a>\n<h2 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h2><p>  群里听到有人讨论这个话题，当时觉得比较新鲜，就十分好奇的请教了两位经验丰富的@kkk、@AK，虽然未得其中真髓，但是也得到一些自己的思考。总结一下两人的方案，以及自己的思考，</p>\n<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><p>  代码内部引入的素材属于设计管理，代码则是码农管理，从这个角度来说两个工做都有码农管理则是一种耦合，为了减轻设计师频繁更换素材而带来的码农的无休止的协作，所以可以进行着方面的解藕。</p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><p>  哪坏哪补。有问题就会有解决方案。群中说的<a href=\"#方案一\">方案一</a>由于当时不方便，所以并没有弄明白。<a href=\"#方案二\">方案二</a>、<a href=\"#方案三\">方案三</a>是自己的一些解决方案。</p>\n<h3 id=\"方案一\"><a href=\"#方案一\" class=\"headerlink\" title=\"方案一\"></a><a name=\"方案一\">方案一</a></h3><p>  群中讨论的是素材、代码放在一个仓库，分支不同，使用脚本进行整合(其实并没有想明白怎么弄。。下周请教一下)。另外，@夏汁泡泡 还有一个简化就是这个处理的脚本可以放在<a href=\"https://developer.apple.com/library/ios/recipes/xcode_help-project_editor/Articles/AddingaRunScriptBuildPhase.html\" target=\"_blank\" rel=\"external\">Add Run Script Build Phase</a>，暴露出来已知的问题：</p>\n<ul>\n<li>操作麻烦</li>\n<li>图片可能重复</li>\n<li>命名规范</li>\n</ul>\n<h3 id=\"方案二\"><a href=\"#方案二\" class=\"headerlink\" title=\"方案二\"></a><a name=\"方案二\">方案二</a></h3><p>  按照Pods的集成方式，可以将素材看作一个第三方库，直接将素材做成一个bundle，采用Pods私有库或者其他方式放入工程。暴露出来已知的问题：</p>\n<ul>\n<li>什么时候更新这个bundle</li>\n<li>多人合作时这个bundle冲突问题</li>\n<li>命名规范</li>\n</ul>\n<h3 id=\"方案三\"><a href=\"#方案三\" class=\"headerlink\" title=\"方案三\"></a><a name=\"方案三\">方案三</a></h3><p>  工程使用<code>xcassets</code>进行素材打包，然后使用子库进行持续集成。这样，设计师的素材可以放在另一个独立素材仓库，内含更新脚本，直接将素材生成对应的<code>xcassets</code>结构，并上传至子库。这样设计师做完素材直接扔在文件夹中，自动或手动跑一下脚本即可更新到素材仓库。暴露出来已知的问题：</p>\n<ul>\n<li>由于没有测试过，不知道如果素材比较多的话会不会发生冲突。因该不会吧，都是加文件或者修改😂 (有时间去研究一下之后更新)</li>\n<li>命名规范的问题依旧存在</li>\n</ul>\n<h3 id=\"方案四\"><a href=\"#方案四\" class=\"headerlink\" title=\"方案四\"></a><a name=\"方案四\">方案四</a></h3><p>  <strong> 字体库 </strong>。最近同事提出关于用字体库去存储素材图片的方案。感觉非常的赞，虽然并未实践，但是这种方案就像emoji一样，不但减少了相同图片内容之间存在多个不同尺寸版本的问题，也能够比较好的进行压缩管理。设计师需要做的就是做出一套字体库，然后将所有的素材图全部按照设计字体的方案进行设计和制作，这样在使用的时候只需要导入一个字体文件就好了。对于这个字体文件如何管理都好说，毕竟只有一个字体文件。字体库的制作方面还不是很了解，所以只提着么一下吧嘿嘿。。</p>\n<h2 id=\"思考\"><a href=\"#思考\" class=\"headerlink\" title=\"思考\"></a>思考</h2><p>  好了，重要的问题来了，上面的问题都是存在命名规范的问题。此问题如何化解呢？</p>\n<p>  素材的引入需根据素材名写入代码中，那么如何才能不用素材名呢？那时不可能的😝，毕竟你要有一个唯一标识符去标志着一个素材。可能有的人说可以做一个json用来保存代码的命名和素材的命名呀，我只想说MDZZ，那不是有两套需要维护的命名规则么。。得不偿失。</p>\n<p>  这个命名的问题其实不能复杂化。参看iOS的项目国际化操作，使用一个key作为文案的唯一标识符，需要显示该文案，通过这个唯一标识符就能直接取到。回头看下素材，是不是也能炮制一个呢？</p>\n<p>  如果素材名字有统一的规则，就不需要这样的key作为统一标识符，直接使用素材名字即可，这样维护一套素材命名规则总比两套更容易维护。所以，直接使用素材名即可。</p>\n<p>  如果素材不能统一命名规则，那么这样的对照文件存在也是很不错的。话又说回来，要进行UI素材和代码的解耦，素材名都不能统一，还如何解耦，此问题也不存在了。。</p>\n<p>  退一步，我们的目的是让素材让设计师自己维护，代码不去维护素材。设计师和码农的耦合在于图片本身的交换比较烦。不论采用哪种解耦方案，都是把图片的耦合转换为图片名字的耦合(也可以理解为素材对应的KEY的耦合)。结果是 <strong> 为了解除一个耦合,而引入了一个新的耦合 </strong> 。个人认为这样是不靠谱的。。除非有强力的人去推动设计师走标准的命名。</p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>  其实这个问题大可不必纠结，如果有强力的人去推动这个标准持续走下去那么这个问题才有价值。如果真的要进行题中说的代码解耦的话，我认为第三种是比较靠谱的。 <strong> 命名标准、命名标准、命名标准… </strong>。</p>\n<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>  经验有限，如果有更好的方案，望告知。拜谢！</p>\n","excerpt":"<p>个人对UI素材和代码的解耦的一些粗浅的看法。比如：解耦方案、是否该解耦。</p>","more":"<h2 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h2><p>  群里听到有人讨论这个话题，当时觉得比较新鲜，就十分好奇的请教了两位经验丰富的@kkk、@AK，虽然未得其中真髓，但是也得到一些自己的思考。总结一下两人的方案，以及自己的思考，</p>\n<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><p>  代码内部引入的素材属于设计管理，代码则是码农管理，从这个角度来说两个工做都有码农管理则是一种耦合，为了减轻设计师频繁更换素材而带来的码农的无休止的协作，所以可以进行着方面的解藕。</p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><p>  哪坏哪补。有问题就会有解决方案。群中说的<a href=\"#方案一\">方案一</a>由于当时不方便，所以并没有弄明白。<a href=\"#方案二\">方案二</a>、<a href=\"#方案三\">方案三</a>是自己的一些解决方案。</p>\n<h3 id=\"方案一\"><a href=\"#方案一\" class=\"headerlink\" title=\"方案一\"></a><a name=\"方案一\">方案一</a></h3><p>  群中讨论的是素材、代码放在一个仓库，分支不同，使用脚本进行整合(其实并没有想明白怎么弄。。下周请教一下)。另外，@夏汁泡泡 还有一个简化就是这个处理的脚本可以放在<a href=\"https://developer.apple.com/library/ios/recipes/xcode_help-project_editor/Articles/AddingaRunScriptBuildPhase.html\">Add Run Script Build Phase</a>，暴露出来已知的问题：</p>\n<ul>\n<li>操作麻烦</li>\n<li>图片可能重复</li>\n<li>命名规范</li>\n</ul>\n<h3 id=\"方案二\"><a href=\"#方案二\" class=\"headerlink\" title=\"方案二\"></a><a name=\"方案二\">方案二</a></h3><p>  按照Pods的集成方式，可以将素材看作一个第三方库，直接将素材做成一个bundle，采用Pods私有库或者其他方式放入工程。暴露出来已知的问题：</p>\n<ul>\n<li>什么时候更新这个bundle</li>\n<li>多人合作时这个bundle冲突问题</li>\n<li>命名规范</li>\n</ul>\n<h3 id=\"方案三\"><a href=\"#方案三\" class=\"headerlink\" title=\"方案三\"></a><a name=\"方案三\">方案三</a></h3><p>  工程使用<code>xcassets</code>进行素材打包，然后使用子库进行持续集成。这样，设计师的素材可以放在另一个独立素材仓库，内含更新脚本，直接将素材生成对应的<code>xcassets</code>结构，并上传至子库。这样设计师做完素材直接扔在文件夹中，自动或手动跑一下脚本即可更新到素材仓库。暴露出来已知的问题：</p>\n<ul>\n<li>由于没有测试过，不知道如果素材比较多的话会不会发生冲突。因该不会吧，都是加文件或者修改😂 (有时间去研究一下之后更新)</li>\n<li>命名规范的问题依旧存在</li>\n</ul>\n<h3 id=\"方案四\"><a href=\"#方案四\" class=\"headerlink\" title=\"方案四\"></a><a name=\"方案四\">方案四</a></h3><p>  <strong> 字体库 </strong>。最近同事提出关于用字体库去存储素材图片的方案。感觉非常的赞，虽然并未实践，但是这种方案就像emoji一样，不但减少了相同图片内容之间存在多个不同尺寸版本的问题，也能够比较好的进行压缩管理。设计师需要做的就是做出一套字体库，然后将所有的素材图全部按照设计字体的方案进行设计和制作，这样在使用的时候只需要导入一个字体文件就好了。对于这个字体文件如何管理都好说，毕竟只有一个字体文件。字体库的制作方面还不是很了解，所以只提着么一下吧嘿嘿。。</p>\n<h2 id=\"思考\"><a href=\"#思考\" class=\"headerlink\" title=\"思考\"></a>思考</h2><p>  好了，重要的问题来了，上面的问题都是存在命名规范的问题。此问题如何化解呢？</p>\n<p>  素材的引入需根据素材名写入代码中，那么如何才能不用素材名呢？那时不可能的😝，毕竟你要有一个唯一标识符去标志着一个素材。可能有的人说可以做一个json用来保存代码的命名和素材的命名呀，我只想说MDZZ，那不是有两套需要维护的命名规则么。。得不偿失。</p>\n<p>  这个命名的问题其实不能复杂化。参看iOS的项目国际化操作，使用一个key作为文案的唯一标识符，需要显示该文案，通过这个唯一标识符就能直接取到。回头看下素材，是不是也能炮制一个呢？</p>\n<p>  如果素材名字有统一的规则，就不需要这样的key作为统一标识符，直接使用素材名字即可，这样维护一套素材命名规则总比两套更容易维护。所以，直接使用素材名即可。</p>\n<p>  如果素材不能统一命名规则，那么这样的对照文件存在也是很不错的。话又说回来，要进行UI素材和代码的解耦，素材名都不能统一，还如何解耦，此问题也不存在了。。</p>\n<p>  退一步，我们的目的是让素材让设计师自己维护，代码不去维护素材。设计师和码农的耦合在于图片本身的交换比较烦。不论采用哪种解耦方案，都是把图片的耦合转换为图片名字的耦合(也可以理解为素材对应的KEY的耦合)。结果是 <strong> 为了解除一个耦合,而引入了一个新的耦合 </strong> 。个人认为这样是不靠谱的。。除非有强力的人去推动设计师走标准的命名。</p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>  其实这个问题大可不必纠结，如果有强力的人去推动这个标准持续走下去那么这个问题才有价值。如果真的要进行题中说的代码解耦的话，我认为第三种是比较靠谱的。 <strong> 命名标准、命名标准、命名标准… </strong>。</p>\n<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>  经验有限，如果有更好的方案，望告知。拜谢！</p>"},{"title":"使用hexo搭建博客","date":"2016-07-05T10:03:31.000Z","_content":"\n这个github.io搭建的过程参考，以及向百度推送的python、js脚本。\n\n<!--more-->\n\n# 参考博客\n    \n感谢 [岁月如歌](http://lovenight.github.io) 的这个[《Hexo 3.1.1 静态博客搭建指南》](http://lovenight.github.io/2015/11/10/Hexo-3-1-1-静态博客搭建指南/)同时感谢这个[《向百度推送hexo博客所有链接的Python脚本》](http://lovenight.github.io/2015/11/18/向百度推送hexo博客所有链接的Python脚本/)(别问我为啥点不开，这个要问博主，不过要看这个文章也不是没办法的😂，因为这个博客也用git管理的。。。你懂)\n\n另外还有一个[soul](http://emufan.com)的[百度主动推送hexo生成的文章](http://emufan.com/2016/02/18/百度主动推送hexo生成的文章/)\n\n# python自动推送脚本修改\n\n上面说的博主大约用的是windows，所以脚本并不能立马的运行在Mac上，需要做些修改：故修改为：\n\n```python\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Author: LoveNight\n# @Date:   2015-11-16 20:45:59\n# @Last Modified by:   LoveNight\n# @Last Modified time: 2015-11-18 18:07:19\n\n# @Last Modified by:   Keith\n# @Last Modified time: 2016-07-06 16:22:45\nimport os\nimport sys\nimport json\nfrom bs4 import BeautifulSoup as BS\nimport requests\n#import msvcrt\n\n\"\"\"\nhexo 博客专用，向百度站长平台提交所有网址\n\n本脚本必须放在hexo博客的根目录下执行！需要已安装生成百度站点地图的插件。\n百度站长平台提交链接：http://zhanzhang.baidu.com/linksubmit/index\n主动推送：最为快速的提交方式，推荐您将站点当天新产出链接立即通过此方式推送给百度，以保证新链接可以及时被百度收录。\n从中找到自己的接口调用地址\n\npython环境：\npip install beautifulsoup4\npip install requests\nxcode-select --install\t\npip install lxml \n\n\"\"\"\n\n# ❌❌❌ 抄的需要更改这个URL！！这是我的！！❌❌❌\nurl = 'http://data.zz.baidu.com/urls?site=https://madordie.github.io&token=j33t0VEPFl24tJ8N'\nbaidu_sitemap = os.path.join(sys.path[0], 'public', 'baidusitemap.xml')\ngoogle_sitemap = os.path.join(sys.path[0], 'public', 'sitemap.xml')\nsitemap = [baidu_sitemap, google_sitemap]\n\nassert (os.path.exists(baidu_sitemap) or os.path.exists(\n    google_sitemap)), \"没找到任何网站地图，请检查！\"\n\n\n# 从站点地图中读取网址列表\ndef getUrls():\n    urls = []\n    for _ in sitemap:\n        if os.path.exists(_):\n            with open(_, \"r\") as f:\n                xml = f.read()\n        soup = BS(xml, \"xml\")\n        tags = soup.find_all(\"loc\")\n        urls += [x.string for x in tags]\n        if _ == baidu_sitemap:\n            tags = soup.find_all(\"breadCrumb\", url=True)\n            urls += [x[\"url\"] for x in tags]\n    return urls\n\n\n# POST提交网址列表\ndef postUrls(urls):\n    urls = set(urls)  # 先去重\n    print(\"一共提取出 %s 个网址\" % len(urls))\n    print(urls)\n    data = \"\\n\".join(urls)\n    return requests.post(url, data=data).text\n\n\nif __name__ == '__main__':\n\n    urls = getUrls()\n    result = postUrls(urls)\n    print(\"提交结果：\")\n    print(result)\n#    msvcrt.getch()\n```\n\n# js脚本\n\n这个脚本是我在[soul](http://emufan.com)的[百度主动推送hexo生成的文章](http://emufan.com/2016/02/18/百度主动推送hexo生成的文章/)发现的，感觉也很赞。\n\n\n>  ## github\n  [脚本地址](https://github.com/Relsoul/bdwork/tree/master/soul/hexo百度主动上传)\n  ## 推送\n  今天发现百度没收录我的站..主要是我的站点换来换去的..估计被ban了..然后想用sitemap来推送一下..结果发现github禁用了百度爬虫..没办法只能主动推送了.\n  ## 利用插件\n  这里利用到了一款插件\n  [hexo-generator-baidu-sitemap](https://github.com/coneycode/hexo-generator-baidu-sitemap)\n  设置很简单 只需要在.config.yml添加一些数据即可, 下面附上我的添加数据 theme这个可以随意更改 下面的copy即可\n  ```\n  # Extensions\n  ## Plugins: http://hexo.io/plugins/\n  ## Themes: http://hexo.io/themes/\n  theme: yilia\n  baidusitemap:\n  path: baidusitemap.xml\n  ```\n>  ## 运行\n  然后hexo g 生成一下数据 会在public下面发现一个文件名为baidusitemap.xml\n  ## 脚本\n  这里用nodejs写了一款脚本 大概流程是 获取baidusitemap.xml里面的内容 然后读取本地的一个site_file.json这个文件 这个文件存储的是上一次数据 与上一次数据进行对比 如果对比发现新数据那么就上传新数据 否则全部上传.\n  ## 运行脚本\n  把ActivePush.js脚本放在hexo文件夹主目录 然后用nodejs ActivePush.js一下即可 这里还支持一个参数nodejs ActivePush.js all 则是不对比直接上传数据\n","source":"_posts/use-hexo-setup-blog.md","raw":"---\ntitle: 使用hexo搭建博客\ndate: 2016-07-05 18:03:31\ntags: hexo\ncategories: \n    - 教程\n---\n\n这个github.io搭建的过程参考，以及向百度推送的python、js脚本。\n\n<!--more-->\n\n# 参考博客\n    \n感谢 [岁月如歌](http://lovenight.github.io) 的这个[《Hexo 3.1.1 静态博客搭建指南》](http://lovenight.github.io/2015/11/10/Hexo-3-1-1-静态博客搭建指南/)同时感谢这个[《向百度推送hexo博客所有链接的Python脚本》](http://lovenight.github.io/2015/11/18/向百度推送hexo博客所有链接的Python脚本/)(别问我为啥点不开，这个要问博主，不过要看这个文章也不是没办法的😂，因为这个博客也用git管理的。。。你懂)\n\n另外还有一个[soul](http://emufan.com)的[百度主动推送hexo生成的文章](http://emufan.com/2016/02/18/百度主动推送hexo生成的文章/)\n\n# python自动推送脚本修改\n\n上面说的博主大约用的是windows，所以脚本并不能立马的运行在Mac上，需要做些修改：故修改为：\n\n```python\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Author: LoveNight\n# @Date:   2015-11-16 20:45:59\n# @Last Modified by:   LoveNight\n# @Last Modified time: 2015-11-18 18:07:19\n\n# @Last Modified by:   Keith\n# @Last Modified time: 2016-07-06 16:22:45\nimport os\nimport sys\nimport json\nfrom bs4 import BeautifulSoup as BS\nimport requests\n#import msvcrt\n\n\"\"\"\nhexo 博客专用，向百度站长平台提交所有网址\n\n本脚本必须放在hexo博客的根目录下执行！需要已安装生成百度站点地图的插件。\n百度站长平台提交链接：http://zhanzhang.baidu.com/linksubmit/index\n主动推送：最为快速的提交方式，推荐您将站点当天新产出链接立即通过此方式推送给百度，以保证新链接可以及时被百度收录。\n从中找到自己的接口调用地址\n\npython环境：\npip install beautifulsoup4\npip install requests\nxcode-select --install\t\npip install lxml \n\n\"\"\"\n\n# ❌❌❌ 抄的需要更改这个URL！！这是我的！！❌❌❌\nurl = 'http://data.zz.baidu.com/urls?site=https://madordie.github.io&token=j33t0VEPFl24tJ8N'\nbaidu_sitemap = os.path.join(sys.path[0], 'public', 'baidusitemap.xml')\ngoogle_sitemap = os.path.join(sys.path[0], 'public', 'sitemap.xml')\nsitemap = [baidu_sitemap, google_sitemap]\n\nassert (os.path.exists(baidu_sitemap) or os.path.exists(\n    google_sitemap)), \"没找到任何网站地图，请检查！\"\n\n\n# 从站点地图中读取网址列表\ndef getUrls():\n    urls = []\n    for _ in sitemap:\n        if os.path.exists(_):\n            with open(_, \"r\") as f:\n                xml = f.read()\n        soup = BS(xml, \"xml\")\n        tags = soup.find_all(\"loc\")\n        urls += [x.string for x in tags]\n        if _ == baidu_sitemap:\n            tags = soup.find_all(\"breadCrumb\", url=True)\n            urls += [x[\"url\"] for x in tags]\n    return urls\n\n\n# POST提交网址列表\ndef postUrls(urls):\n    urls = set(urls)  # 先去重\n    print(\"一共提取出 %s 个网址\" % len(urls))\n    print(urls)\n    data = \"\\n\".join(urls)\n    return requests.post(url, data=data).text\n\n\nif __name__ == '__main__':\n\n    urls = getUrls()\n    result = postUrls(urls)\n    print(\"提交结果：\")\n    print(result)\n#    msvcrt.getch()\n```\n\n# js脚本\n\n这个脚本是我在[soul](http://emufan.com)的[百度主动推送hexo生成的文章](http://emufan.com/2016/02/18/百度主动推送hexo生成的文章/)发现的，感觉也很赞。\n\n\n>  ## github\n  [脚本地址](https://github.com/Relsoul/bdwork/tree/master/soul/hexo百度主动上传)\n  ## 推送\n  今天发现百度没收录我的站..主要是我的站点换来换去的..估计被ban了..然后想用sitemap来推送一下..结果发现github禁用了百度爬虫..没办法只能主动推送了.\n  ## 利用插件\n  这里利用到了一款插件\n  [hexo-generator-baidu-sitemap](https://github.com/coneycode/hexo-generator-baidu-sitemap)\n  设置很简单 只需要在.config.yml添加一些数据即可, 下面附上我的添加数据 theme这个可以随意更改 下面的copy即可\n  ```\n  # Extensions\n  ## Plugins: http://hexo.io/plugins/\n  ## Themes: http://hexo.io/themes/\n  theme: yilia\n  baidusitemap:\n  path: baidusitemap.xml\n  ```\n>  ## 运行\n  然后hexo g 生成一下数据 会在public下面发现一个文件名为baidusitemap.xml\n  ## 脚本\n  这里用nodejs写了一款脚本 大概流程是 获取baidusitemap.xml里面的内容 然后读取本地的一个site_file.json这个文件 这个文件存储的是上一次数据 与上一次数据进行对比 如果对比发现新数据那么就上传新数据 否则全部上传.\n  ## 运行脚本\n  把ActivePush.js脚本放在hexo文件夹主目录 然后用nodejs ActivePush.js一下即可 这里还支持一个参数nodejs ActivePush.js all 则是不对比直接上传数据\n","slug":"use-hexo-setup-blog","published":1,"updated":"2016-10-22T13:56:02.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0fad0018l0uvhb9lcn4j","content":"<p>这个github.io搭建的过程参考，以及向百度推送的python、js脚本。</p>\n<a id=\"more\"></a>\n<h1 id=\"参考博客\"><a href=\"#参考博客\" class=\"headerlink\" title=\"参考博客\"></a>参考博客</h1><p>感谢 <a href=\"http://lovenight.github.io\" target=\"_blank\" rel=\"external\">岁月如歌</a> 的这个<a href=\"http://lovenight.github.io/2015/11/10/Hexo-3-1-1-静态博客搭建指南/\" target=\"_blank\" rel=\"external\">《Hexo 3.1.1 静态博客搭建指南》</a>同时感谢这个<a href=\"http://lovenight.github.io/2015/11/18/向百度推送hexo博客所有链接的Python脚本/\" target=\"_blank\" rel=\"external\">《向百度推送hexo博客所有链接的Python脚本》</a>(别问我为啥点不开，这个要问博主，不过要看这个文章也不是没办法的😂，因为这个博客也用git管理的。。。你懂)</p>\n<p>另外还有一个<a href=\"http://emufan.com\" target=\"_blank\" rel=\"external\">soul</a>的<a href=\"http://emufan.com/2016/02/18/百度主动推送hexo生成的文章/\" target=\"_blank\" rel=\"external\">百度主动推送hexo生成的文章</a></p>\n<h1 id=\"python自动推送脚本修改\"><a href=\"#python自动推送脚本修改\" class=\"headerlink\" title=\"python自动推送脚本修改\"></a>python自动推送脚本修改</h1><p>上面说的博主大约用的是windows，所以脚本并不能立马的运行在Mac上，需要做些修改：故修改为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></div><div class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></div><div class=\"line\"><span class=\"comment\"># @Author: LoveNight</span></div><div class=\"line\"><span class=\"comment\"># @Date:   2015-11-16 20:45:59</span></div><div class=\"line\"><span class=\"comment\"># @Last Modified by:   LoveNight</span></div><div class=\"line\"><span class=\"comment\"># @Last Modified time: 2015-11-18 18:07:19</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># @Last Modified by:   Keith</span></div><div class=\"line\"><span class=\"comment\"># @Last Modified time: 2016-07-06 16:22:45</span></div><div class=\"line\"><span class=\"keyword\">import</span> os</div><div class=\"line\"><span class=\"keyword\">import</span> sys</div><div class=\"line\"><span class=\"keyword\">import</span> json</div><div class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup <span class=\"keyword\">as</span> BS</div><div class=\"line\"><span class=\"keyword\">import</span> requests</div><div class=\"line\"><span class=\"comment\">#import msvcrt</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"string\">\"\"\"</span></div><div class=\"line\">hexo 博客专用，向百度站长平台提交所有网址</div><div class=\"line\"></div><div class=\"line\">本脚本必须放在hexo博客的根目录下执行！需要已安装生成百度站点地图的插件。</div><div class=\"line\">百度站长平台提交链接：http://zhanzhang.baidu.com/linksubmit/index</div><div class=\"line\">主动推送：最为快速的提交方式，推荐您将站点当天新产出链接立即通过此方式推送给百度，以保证新链接可以及时被百度收录。</div><div class=\"line\">从中找到自己的接口调用地址</div><div class=\"line\"></div><div class=\"line\">python环境：</div><div class=\"line\">pip install beautifulsoup4</div><div class=\"line\">pip install requests</div><div class=\"line\">xcode-select --install\t</div><div class=\"line\">pip install lxml </div><div class=\"line\"></div><div class=\"line\">\"\"\"</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># ❌❌❌ 抄的需要更改这个URL！！这是我的！！❌❌❌</span></div><div class=\"line\">url = <span class=\"string\">'http://data.zz.baidu.com/urls?site=https://madordie.github.io&amp;token=j33t0VEPFl24tJ8N'</span></div><div class=\"line\">baidu_sitemap = os.path.join(sys.path[<span class=\"number\">0</span>], <span class=\"string\">'public'</span>, <span class=\"string\">'baidusitemap.xml'</span>)</div><div class=\"line\">google_sitemap = os.path.join(sys.path[<span class=\"number\">0</span>], <span class=\"string\">'public'</span>, <span class=\"string\">'sitemap.xml'</span>)</div><div class=\"line\">sitemap = [baidu_sitemap, google_sitemap]</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">assert</span> (os.path.exists(baidu_sitemap) <span class=\"keyword\">or</span> os.path.exists(</div><div class=\"line\">    google_sitemap)), <span class=\"string\">\"没找到任何网站地图，请检查！\"</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># 从站点地图中读取网址列表</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getUrls</span><span class=\"params\">()</span>:</span></div><div class=\"line\">    urls = []</div><div class=\"line\">    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> sitemap:</div><div class=\"line\">        <span class=\"keyword\">if</span> os.path.exists(_):</div><div class=\"line\">            <span class=\"keyword\">with</span> open(_, <span class=\"string\">\"r\"</span>) <span class=\"keyword\">as</span> f:</div><div class=\"line\">                xml = f.read()</div><div class=\"line\">        soup = BS(xml, <span class=\"string\">\"xml\"</span>)</div><div class=\"line\">        tags = soup.find_all(<span class=\"string\">\"loc\"</span>)</div><div class=\"line\">        urls += [x.string <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> tags]</div><div class=\"line\">        <span class=\"keyword\">if</span> _ == baidu_sitemap:</div><div class=\"line\">            tags = soup.find_all(<span class=\"string\">\"breadCrumb\"</span>, url=<span class=\"keyword\">True</span>)</div><div class=\"line\">            urls += [x[<span class=\"string\">\"url\"</span>] <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> tags]</div><div class=\"line\">    <span class=\"keyword\">return</span> urls</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># POST提交网址列表</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">postUrls</span><span class=\"params\">(urls)</span>:</span></div><div class=\"line\">    urls = set(urls)  <span class=\"comment\"># 先去重</span></div><div class=\"line\">    print(<span class=\"string\">\"一共提取出 %s 个网址\"</span> % len(urls))</div><div class=\"line\">    print(urls)</div><div class=\"line\">    data = <span class=\"string\">\"\\n\"</span>.join(urls)</div><div class=\"line\">    <span class=\"keyword\">return</span> requests.post(url, data=data).text</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</div><div class=\"line\"></div><div class=\"line\">    urls = getUrls()</div><div class=\"line\">    result = postUrls(urls)</div><div class=\"line\">    print(<span class=\"string\">\"提交结果：\"</span>)</div><div class=\"line\">    print(result)</div><div class=\"line\"><span class=\"comment\">#    msvcrt.getch()</span></div></pre></td></tr></table></figure>\n<h1 id=\"js脚本\"><a href=\"#js脚本\" class=\"headerlink\" title=\"js脚本\"></a>js脚本</h1><p>这个脚本是我在<a href=\"http://emufan.com\" target=\"_blank\" rel=\"external\">soul</a>的<a href=\"http://emufan.com/2016/02/18/百度主动推送hexo生成的文章/\" target=\"_blank\" rel=\"external\">百度主动推送hexo生成的文章</a>发现的，感觉也很赞。</p>\n<blockquote>\n<h2 id=\"github\"><a href=\"#github\" class=\"headerlink\" title=\"github\"></a>github</h2><p>  <a href=\"https://github.com/Relsoul/bdwork/tree/master/soul/hexo百度主动上传\" target=\"_blank\" rel=\"external\">脚本地址</a></p>\n<h2 id=\"推送\"><a href=\"#推送\" class=\"headerlink\" title=\"推送\"></a>推送</h2><p>  今天发现百度没收录我的站..主要是我的站点换来换去的..估计被ban了..然后想用sitemap来推送一下..结果发现github禁用了百度爬虫..没办法只能主动推送了.</p>\n<h2 id=\"利用插件\"><a href=\"#利用插件\" class=\"headerlink\" title=\"利用插件\"></a>利用插件</h2><p>  这里利用到了一款插件<br>  <a href=\"https://github.com/coneycode/hexo-generator-baidu-sitemap\" target=\"_blank\" rel=\"external\">hexo-generator-baidu-sitemap</a><br>  设置很简单 只需要在.config.yml添加一些数据即可, 下面附上我的添加数据 theme这个可以随意更改 下面的copy即可<br>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Extensions</div><div class=\"line\">## Plugins: http://hexo.io/plugins/</div><div class=\"line\">## Themes: http://hexo.io/themes/</div><div class=\"line\">theme: yilia</div><div class=\"line\">baidusitemap:</div><div class=\"line\">path: baidusitemap.xml</div></pre></td></tr></table></figure></p>\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><p>  然后hexo g 生成一下数据 会在public下面发现一个文件名为baidusitemap.xml</p>\n<h2 id=\"脚本\"><a href=\"#脚本\" class=\"headerlink\" title=\"脚本\"></a>脚本</h2><p>  这里用nodejs写了一款脚本 大概流程是 获取baidusitemap.xml里面的内容 然后读取本地的一个site_file.json这个文件 这个文件存储的是上一次数据 与上一次数据进行对比 如果对比发现新数据那么就上传新数据 否则全部上传.</p>\n<h2 id=\"运行脚本\"><a href=\"#运行脚本\" class=\"headerlink\" title=\"运行脚本\"></a>运行脚本</h2><p>  把ActivePush.js脚本放在hexo文件夹主目录 然后用nodejs ActivePush.js一下即可 这里还支持一个参数nodejs ActivePush.js all 则是不对比直接上传数据</p>\n</blockquote>\n","excerpt":"<p>这个github.io搭建的过程参考，以及向百度推送的python、js脚本。</p>","more":"<h1 id=\"参考博客\"><a href=\"#参考博客\" class=\"headerlink\" title=\"参考博客\"></a>参考博客</h1><p>感谢 <a href=\"http://lovenight.github.io\">岁月如歌</a> 的这个<a href=\"http://lovenight.github.io/2015/11/10/Hexo-3-1-1-静态博客搭建指南/\">《Hexo 3.1.1 静态博客搭建指南》</a>同时感谢这个<a href=\"http://lovenight.github.io/2015/11/18/向百度推送hexo博客所有链接的Python脚本/\">《向百度推送hexo博客所有链接的Python脚本》</a>(别问我为啥点不开，这个要问博主，不过要看这个文章也不是没办法的😂，因为这个博客也用git管理的。。。你懂)</p>\n<p>另外还有一个<a href=\"http://emufan.com\">soul</a>的<a href=\"http://emufan.com/2016/02/18/百度主动推送hexo生成的文章/\">百度主动推送hexo生成的文章</a></p>\n<h1 id=\"python自动推送脚本修改\"><a href=\"#python自动推送脚本修改\" class=\"headerlink\" title=\"python自动推送脚本修改\"></a>python自动推送脚本修改</h1><p>上面说的博主大约用的是windows，所以脚本并不能立马的运行在Mac上，需要做些修改：故修改为：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></div><div class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></div><div class=\"line\"><span class=\"comment\"># @Author: LoveNight</span></div><div class=\"line\"><span class=\"comment\"># @Date:   2015-11-16 20:45:59</span></div><div class=\"line\"><span class=\"comment\"># @Last Modified by:   LoveNight</span></div><div class=\"line\"><span class=\"comment\"># @Last Modified time: 2015-11-18 18:07:19</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># @Last Modified by:   Keith</span></div><div class=\"line\"><span class=\"comment\"># @Last Modified time: 2016-07-06 16:22:45</span></div><div class=\"line\"><span class=\"keyword\">import</span> os</div><div class=\"line\"><span class=\"keyword\">import</span> sys</div><div class=\"line\"><span class=\"keyword\">import</span> json</div><div class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup <span class=\"keyword\">as</span> BS</div><div class=\"line\"><span class=\"keyword\">import</span> requests</div><div class=\"line\"><span class=\"comment\">#import msvcrt</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"string\">\"\"\"</div><div class=\"line\">hexo 博客专用，向百度站长平台提交所有网址</div><div class=\"line\"></div><div class=\"line\">本脚本必须放在hexo博客的根目录下执行！需要已安装生成百度站点地图的插件。</div><div class=\"line\">百度站长平台提交链接：http://zhanzhang.baidu.com/linksubmit/index</div><div class=\"line\">主动推送：最为快速的提交方式，推荐您将站点当天新产出链接立即通过此方式推送给百度，以保证新链接可以及时被百度收录。</div><div class=\"line\">从中找到自己的接口调用地址</div><div class=\"line\"></div><div class=\"line\">python环境：</div><div class=\"line\">pip install beautifulsoup4</div><div class=\"line\">pip install requests</div><div class=\"line\">xcode-select --install\t</div><div class=\"line\">pip install lxml </div><div class=\"line\"></div><div class=\"line\">\"\"\"</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># ❌❌❌ 抄的需要更改这个URL！！这是我的！！❌❌❌</span></div><div class=\"line\">url = <span class=\"string\">'http://data.zz.baidu.com/urls?site=https://madordie.github.io&amp;token=j33t0VEPFl24tJ8N'</span></div><div class=\"line\">baidu_sitemap = os.path.join(sys.path[<span class=\"number\">0</span>], <span class=\"string\">'public'</span>, <span class=\"string\">'baidusitemap.xml'</span>)</div><div class=\"line\">google_sitemap = os.path.join(sys.path[<span class=\"number\">0</span>], <span class=\"string\">'public'</span>, <span class=\"string\">'sitemap.xml'</span>)</div><div class=\"line\">sitemap = [baidu_sitemap, google_sitemap]</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">assert</span> (os.path.exists(baidu_sitemap) <span class=\"keyword\">or</span> os.path.exists(</div><div class=\"line\">    google_sitemap)), <span class=\"string\">\"没找到任何网站地图，请检查！\"</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># 从站点地图中读取网址列表</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getUrls</span><span class=\"params\">()</span>:</span></div><div class=\"line\">    urls = []</div><div class=\"line\">    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> sitemap:</div><div class=\"line\">        <span class=\"keyword\">if</span> os.path.exists(_):</div><div class=\"line\">            <span class=\"keyword\">with</span> open(_, <span class=\"string\">\"r\"</span>) <span class=\"keyword\">as</span> f:</div><div class=\"line\">                xml = f.read()</div><div class=\"line\">        soup = BS(xml, <span class=\"string\">\"xml\"</span>)</div><div class=\"line\">        tags = soup.find_all(<span class=\"string\">\"loc\"</span>)</div><div class=\"line\">        urls += [x.string <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> tags]</div><div class=\"line\">        <span class=\"keyword\">if</span> _ == baidu_sitemap:</div><div class=\"line\">            tags = soup.find_all(<span class=\"string\">\"breadCrumb\"</span>, url=<span class=\"keyword\">True</span>)</div><div class=\"line\">            urls += [x[<span class=\"string\">\"url\"</span>] <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> tags]</div><div class=\"line\">    <span class=\"keyword\">return</span> urls</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># POST提交网址列表</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">postUrls</span><span class=\"params\">(urls)</span>:</span></div><div class=\"line\">    urls = set(urls)  <span class=\"comment\"># 先去重</span></div><div class=\"line\">    print(<span class=\"string\">\"一共提取出 %s 个网址\"</span> % len(urls))</div><div class=\"line\">    print(urls)</div><div class=\"line\">    data = <span class=\"string\">\"\\n\"</span>.join(urls)</div><div class=\"line\">    <span class=\"keyword\">return</span> requests.post(url, data=data).text</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</div><div class=\"line\"></div><div class=\"line\">    urls = getUrls()</div><div class=\"line\">    result = postUrls(urls)</div><div class=\"line\">    print(<span class=\"string\">\"提交结果：\"</span>)</div><div class=\"line\">    print(result)</div><div class=\"line\"><span class=\"comment\">#    msvcrt.getch()</span></div></pre></td></tr></table></figure>\n<h1 id=\"js脚本\"><a href=\"#js脚本\" class=\"headerlink\" title=\"js脚本\"></a>js脚本</h1><p>这个脚本是我在<a href=\"http://emufan.com\">soul</a>的<a href=\"http://emufan.com/2016/02/18/百度主动推送hexo生成的文章/\">百度主动推送hexo生成的文章</a>发现的，感觉也很赞。</p>\n<blockquote>\n<h2 id=\"github\"><a href=\"#github\" class=\"headerlink\" title=\"github\"></a>github</h2><p>  <a href=\"https://github.com/Relsoul/bdwork/tree/master/soul/hexo百度主动上传\">脚本地址</a></p>\n<h2 id=\"推送\"><a href=\"#推送\" class=\"headerlink\" title=\"推送\"></a>推送</h2><p>  今天发现百度没收录我的站..主要是我的站点换来换去的..估计被ban了..然后想用sitemap来推送一下..结果发现github禁用了百度爬虫..没办法只能主动推送了.</p>\n<h2 id=\"利用插件\"><a href=\"#利用插件\" class=\"headerlink\" title=\"利用插件\"></a>利用插件</h2><p>  这里利用到了一款插件<br>  <a href=\"https://github.com/coneycode/hexo-generator-baidu-sitemap\">hexo-generator-baidu-sitemap</a><br>  设置很简单 只需要在.config.yml添加一些数据即可, 下面附上我的添加数据 theme这个可以随意更改 下面的copy即可<br>  <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Extensions</div><div class=\"line\">## Plugins: http://hexo.io/plugins/</div><div class=\"line\">## Themes: http://hexo.io/themes/</div><div class=\"line\">theme: yilia</div><div class=\"line\">baidusitemap:</div><div class=\"line\">path: baidusitemap.xml</div></pre></td></tr></table></figure></p>\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><p>  然后hexo g 生成一下数据 会在public下面发现一个文件名为baidusitemap.xml</p>\n<h2 id=\"脚本\"><a href=\"#脚本\" class=\"headerlink\" title=\"脚本\"></a>脚本</h2><p>  这里用nodejs写了一款脚本 大概流程是 获取baidusitemap.xml里面的内容 然后读取本地的一个site_file.json这个文件 这个文件存储的是上一次数据 与上一次数据进行对比 如果对比发现新数据那么就上传新数据 否则全部上传.</p>\n<h2 id=\"运行脚本\"><a href=\"#运行脚本\" class=\"headerlink\" title=\"运行脚本\"></a>运行脚本</h2><p>  把ActivePush.js脚本放在hexo文件夹主目录 然后用nodejs ActivePush.js一下即可 这里还支持一个参数nodejs ActivePush.js all 则是不对比直接上传数据</p>\n</blockquote>"},{"title":"如何实现AppStore查看更多的方法","date":"2016-12-23T08:37:37.000Z","_content":"\n看到AppStore的`更多`效果，做的不错哎，本文尝试采用`exclusionPaths`进行实现。不过有瑕疵。。来年用追加的方式在实现一下。感觉追加的方式比较简单。，\n\n<!--more-->\n\n# 效果\n<img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/UITextKit-AppStore-more-scene.gif://7xvzwi.com1.z0.glb.clouddn.com/leanote_new_logo.png\" alt=\"效果图\">\n\n# 简要说明\n  App Store中的查看更多动画是不是很给力？可是做起来确不知道如何下手？这里我提供一种UITextKit的方法来简单的实现一下。\n  \n  为了让例子简单，我就直接写了个more，那个view是自定义的，随便添加的，和本身的文本展示的并没有什么关系。\n  \n  为了让最后的那个moreView更加好用，增加了已经展开显示全部是否隐藏的控制。\n  \n  \n# 代码\n\n  先看下Demo中调用吧：\n  ```swift\n  let info = KTJExclusionLabel()\n  info.exclusionView = more\n  info.isAutoHidenExclusionView = isAutoHiden.isOn\n  info.numberOfLines = Int.init(line.text ?? \"\") ?? 0\n  info.sizeToFit()\n  ```\n\n  然后KTJExclusionLabel的实现：\n  ```swift\n  //\n  //  KTJExclusionLabel.swift\n  //  UITextKit-AppStore-more\n  //\n  //  Created by 孙继刚 on 2016/12/24.\n  //  Copyright © 2016年 madordie. All rights reserved.\n  //\n\n  import UIKit\n\n  class KTJExclusionLabel: UITextView {\n\n      /// 行数\n      public var numberOfLines: Int {\n          set {\n              textContainer.maximumNumberOfLines = newValue\n          }\n          get {\n              return textContainer.maximumNumberOfLines\n          }\n      }\n\n      public var isAutoHidenExclusionView: Bool = false\n\n      /// 避让的view\n      public weak var exclusionView: UIView? {\n          didSet {\n              setNeedsLayout()\n          }\n      }\n\n      override init(frame: CGRect, textContainer: NSTextContainer?) {\n          super.init(frame: frame, textContainer: textContainer)\n          setup()\n      }\n\n      required init?(coder aDecoder: NSCoder) {\n          super.init(coder: aDecoder)\n          setup()\n      }\n\n      func setup() {\n          isEditable = true\n          textContainer.lineBreakMode = .byTruncatingTail\n      }\n\n      override func sizeToFit() {\n          //  对其API还不熟悉，还没有找到如何一次判断出是否已经展示完全。。找到后再更\n\n          let originLines = numberOfLines\n          numberOfLines = 0\n          let maxHeight = resizeThatFits(frame.size).height\n          numberOfLines = originLines\n          frame.size = resizeThatFits(frame.size)\n\n          exclusionView?.isHidden = false\n          if frame.height == maxHeight {\n              frame.size = resizeThatFits(frame.size, isOver: true)\n              if isAutoHidenExclusionView {\n                  exclusionView?.isHidden = true\n              }\n          }\n      }\n\n      func resizeThatFits(_ size: CGSize, isOver: Bool = false) -> CGSize {\n          var frame = CGRect.zero\n          frame.size = size\n\n          textContainer.exclusionPaths.removeAll()\n\n          var ovalPaths = [UIBezierPath]()\n          if let exclusionView = exclusionView {\n              var lastLineFrame = CGRect.zero\n              var lineIdx = 0\n              var lastFrame = CGRect.zero\n              layoutManager.enumerateLineFragments(forGlyphRange: NSMakeRange(0, text.characters.count)) { (rect1, rect2, textContainer, range, pointer) in\n                  if lineIdx < textContainer.maximumNumberOfLines {\n                      lastLineFrame = rect2\n                  }\n                  lineIdx += 1\n                  lastFrame = rect2\n              }\n\n              if lastLineFrame == CGRect.zero {\n                  lastLineFrame = lastFrame\n              }\n              //  矫正\n              lastLineFrame.origin.x += textContainerInset.left\n              lastLineFrame.origin.y += textContainerInset.top\n\n              //  为末尾算出最大的frame\n              lastLineFrame.origin.x = lastLineFrame.maxX\n              lastLineFrame.origin.y = lastLineFrame.minY\n              lastLineFrame.size.width = frame.width - lastLineFrame.minX\n              lastLineFrame.size = exclusionView.sizeThatFits(lastLineFrame.size)\n              if lastLineFrame.maxX >= frame.width {\n\n                  if isOver == false {\n                      lastLineFrame.origin.x -= lastLineFrame.maxX - frame.width + max(textContainerInset.bottom, textContainerInset.right)\n                  } else {\n                      lastLineFrame.origin.x = lastFrame.minX + textContainerInset.left + 5\n                      lastLineFrame.origin.y += lastFrame.height\n                  }\n              }\n              exclusionView.frame = convert(lastLineFrame, to: exclusionView.superview)\n\n              var ovalFrame = convert(exclusionView.bounds, from: exclusionView)\n              ovalFrame.origin.x += 5 + textContainerInset.left\n              ovalPaths.append(UIBezierPath(rect: ovalFrame))\n\n              if isOver, isAutoHidenExclusionView {\n                  frame.size.height = lastFrame.maxY + textContainerInset.bottom\n              } else {\n                  frame.size.height = ovalFrame.maxY + textContainerInset.bottom\n              }\n          } else {\n              frame.size = super.sizeThatFits(size)\n          }\n          textContainer.exclusionPaths = ovalPaths\n\n          return CGSize(width: frame.maxX, height: frame.maxY)\n      }\n  }\n\n  ```\n  代码只是简单的做了一个DEMO，并没有仔细的调试，如果使用的话可能看需要根据自己的需求进行简单的调试吧。比如说偏移量、布局之类的。\n  ","source":"_posts/uitextkit-ellipsis-sth-at-the-end.md","raw":"---\ntitle: 如何实现AppStore查看更多的方法\ndate: 2016-12-23 16:37:37\ntags:\n  - iOS\n---\n\n看到AppStore的`更多`效果，做的不错哎，本文尝试采用`exclusionPaths`进行实现。不过有瑕疵。。来年用追加的方式在实现一下。感觉追加的方式比较简单。，\n\n<!--more-->\n\n# 效果\n<img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/UITextKit-AppStore-more-scene.gif://7xvzwi.com1.z0.glb.clouddn.com/leanote_new_logo.png\" alt=\"效果图\">\n\n# 简要说明\n  App Store中的查看更多动画是不是很给力？可是做起来确不知道如何下手？这里我提供一种UITextKit的方法来简单的实现一下。\n  \n  为了让例子简单，我就直接写了个more，那个view是自定义的，随便添加的，和本身的文本展示的并没有什么关系。\n  \n  为了让最后的那个moreView更加好用，增加了已经展开显示全部是否隐藏的控制。\n  \n  \n# 代码\n\n  先看下Demo中调用吧：\n  ```swift\n  let info = KTJExclusionLabel()\n  info.exclusionView = more\n  info.isAutoHidenExclusionView = isAutoHiden.isOn\n  info.numberOfLines = Int.init(line.text ?? \"\") ?? 0\n  info.sizeToFit()\n  ```\n\n  然后KTJExclusionLabel的实现：\n  ```swift\n  //\n  //  KTJExclusionLabel.swift\n  //  UITextKit-AppStore-more\n  //\n  //  Created by 孙继刚 on 2016/12/24.\n  //  Copyright © 2016年 madordie. All rights reserved.\n  //\n\n  import UIKit\n\n  class KTJExclusionLabel: UITextView {\n\n      /// 行数\n      public var numberOfLines: Int {\n          set {\n              textContainer.maximumNumberOfLines = newValue\n          }\n          get {\n              return textContainer.maximumNumberOfLines\n          }\n      }\n\n      public var isAutoHidenExclusionView: Bool = false\n\n      /// 避让的view\n      public weak var exclusionView: UIView? {\n          didSet {\n              setNeedsLayout()\n          }\n      }\n\n      override init(frame: CGRect, textContainer: NSTextContainer?) {\n          super.init(frame: frame, textContainer: textContainer)\n          setup()\n      }\n\n      required init?(coder aDecoder: NSCoder) {\n          super.init(coder: aDecoder)\n          setup()\n      }\n\n      func setup() {\n          isEditable = true\n          textContainer.lineBreakMode = .byTruncatingTail\n      }\n\n      override func sizeToFit() {\n          //  对其API还不熟悉，还没有找到如何一次判断出是否已经展示完全。。找到后再更\n\n          let originLines = numberOfLines\n          numberOfLines = 0\n          let maxHeight = resizeThatFits(frame.size).height\n          numberOfLines = originLines\n          frame.size = resizeThatFits(frame.size)\n\n          exclusionView?.isHidden = false\n          if frame.height == maxHeight {\n              frame.size = resizeThatFits(frame.size, isOver: true)\n              if isAutoHidenExclusionView {\n                  exclusionView?.isHidden = true\n              }\n          }\n      }\n\n      func resizeThatFits(_ size: CGSize, isOver: Bool = false) -> CGSize {\n          var frame = CGRect.zero\n          frame.size = size\n\n          textContainer.exclusionPaths.removeAll()\n\n          var ovalPaths = [UIBezierPath]()\n          if let exclusionView = exclusionView {\n              var lastLineFrame = CGRect.zero\n              var lineIdx = 0\n              var lastFrame = CGRect.zero\n              layoutManager.enumerateLineFragments(forGlyphRange: NSMakeRange(0, text.characters.count)) { (rect1, rect2, textContainer, range, pointer) in\n                  if lineIdx < textContainer.maximumNumberOfLines {\n                      lastLineFrame = rect2\n                  }\n                  lineIdx += 1\n                  lastFrame = rect2\n              }\n\n              if lastLineFrame == CGRect.zero {\n                  lastLineFrame = lastFrame\n              }\n              //  矫正\n              lastLineFrame.origin.x += textContainerInset.left\n              lastLineFrame.origin.y += textContainerInset.top\n\n              //  为末尾算出最大的frame\n              lastLineFrame.origin.x = lastLineFrame.maxX\n              lastLineFrame.origin.y = lastLineFrame.minY\n              lastLineFrame.size.width = frame.width - lastLineFrame.minX\n              lastLineFrame.size = exclusionView.sizeThatFits(lastLineFrame.size)\n              if lastLineFrame.maxX >= frame.width {\n\n                  if isOver == false {\n                      lastLineFrame.origin.x -= lastLineFrame.maxX - frame.width + max(textContainerInset.bottom, textContainerInset.right)\n                  } else {\n                      lastLineFrame.origin.x = lastFrame.minX + textContainerInset.left + 5\n                      lastLineFrame.origin.y += lastFrame.height\n                  }\n              }\n              exclusionView.frame = convert(lastLineFrame, to: exclusionView.superview)\n\n              var ovalFrame = convert(exclusionView.bounds, from: exclusionView)\n              ovalFrame.origin.x += 5 + textContainerInset.left\n              ovalPaths.append(UIBezierPath(rect: ovalFrame))\n\n              if isOver, isAutoHidenExclusionView {\n                  frame.size.height = lastFrame.maxY + textContainerInset.bottom\n              } else {\n                  frame.size.height = ovalFrame.maxY + textContainerInset.bottom\n              }\n          } else {\n              frame.size = super.sizeThatFits(size)\n          }\n          textContainer.exclusionPaths = ovalPaths\n\n          return CGSize(width: frame.maxX, height: frame.maxY)\n      }\n  }\n\n  ```\n  代码只是简单的做了一个DEMO，并没有仔细的调试，如果使用的话可能看需要根据自己的需求进行简单的调试吧。比如说偏移量、布局之类的。\n  ","slug":"uitextkit-ellipsis-sth-at-the-end","published":1,"updated":"2016-12-30T11:15:40.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj18v0fae001al0uvxpms1y3w","content":"<p>看到AppStore的<code>更多</code>效果，做的不错哎，本文尝试采用<code>exclusionPaths</code>进行实现。不过有瑕疵。。来年用追加的方式在实现一下。感觉追加的方式比较简单。，</p>\n<a id=\"more\"></a>\n<h1 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h1><p><img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/UITextKit-AppStore-more-scene.gif://7xvzwi.com1.z0.glb.clouddn.com/leanote_new_logo.png\" alt=\"效果图\"></p>\n<h1 id=\"简要说明\"><a href=\"#简要说明\" class=\"headerlink\" title=\"简要说明\"></a>简要说明</h1><p>  App Store中的查看更多动画是不是很给力？可是做起来确不知道如何下手？这里我提供一种UITextKit的方法来简单的实现一下。</p>\n<p>  为了让例子简单，我就直接写了个more，那个view是自定义的，随便添加的，和本身的文本展示的并没有什么关系。</p>\n<p>  为了让最后的那个moreView更加好用，增加了已经展开显示全部是否隐藏的控制。</p>\n<h1 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h1><p>  先看下Demo中调用吧：<br>  <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">let</span> info = <span class=\"type\">KTJExclusionLabel</span>()</div><div class=\"line\">info.exclusionView = more</div><div class=\"line\">info.isAutoHidenExclusionView = isAutoHiden.isOn</div><div class=\"line\">info.numberOfLines = <span class=\"type\">Int</span>.<span class=\"keyword\">init</span>(line.text ?? <span class=\"string\">\"\"</span>) ?? <span class=\"number\">0</span></div><div class=\"line\">info.sizeToFit()</div></pre></td></tr></table></figure></p>\n<p>  然后KTJExclusionLabel的实现：<br>  <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//</span></div><div class=\"line\"><span class=\"comment\">//  KTJExclusionLabel.swift</span></div><div class=\"line\"><span class=\"comment\">//  UITextKit-AppStore-more</span></div><div class=\"line\"><span class=\"comment\">//</span></div><div class=\"line\"><span class=\"comment\">//  Created by 孙继刚 on 2016/12/24.</span></div><div class=\"line\"><span class=\"comment\">//  Copyright © 2016年 madordie. All rights reserved.</span></div><div class=\"line\"><span class=\"comment\">//</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> UIKit</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">KTJExclusionLabel</span>: <span class=\"title\">UITextView</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/// 行数</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> numberOfLines: <span class=\"type\">Int</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">set</span> &#123;</div><div class=\"line\">            textContainer.maximumNumberOfLines = newValue</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">get</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> textContainer.maximumNumberOfLines</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> isAutoHidenExclusionView: <span class=\"type\">Bool</span> = <span class=\"literal\">false</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/// 避让的view</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">weak</span> <span class=\"keyword\">var</span> exclusionView: <span class=\"type\">UIView</span>? &#123;</div><div class=\"line\">        <span class=\"keyword\">didSet</span> &#123;</div><div class=\"line\">            setNeedsLayout()</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">init</span>(frame: <span class=\"type\">CGRect</span>, textContainer: <span class=\"type\">NSTextContainer</span>?) &#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>.<span class=\"keyword\">init</span>(frame: frame, textContainer: textContainer)</div><div class=\"line\">        setup()</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">required</span> <span class=\"keyword\">init</span>?(coder aDecoder: <span class=\"type\">NSCoder</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>.<span class=\"keyword\">init</span>(coder: aDecoder)</div><div class=\"line\">        setup()</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">setup</span><span class=\"params\">()</span></span> &#123;</div><div class=\"line\">        isEditable = <span class=\"literal\">true</span></div><div class=\"line\">        textContainer.lineBreakMode = .byTruncatingTail</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">sizeToFit</span><span class=\"params\">()</span></span> &#123;</div><div class=\"line\">        <span class=\"comment\">//  对其API还不熟悉，还没有找到如何一次判断出是否已经展示完全。。找到后再更</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">let</span> originLines = numberOfLines</div><div class=\"line\">        numberOfLines = <span class=\"number\">0</span></div><div class=\"line\">        <span class=\"keyword\">let</span> maxHeight = resizeThatFits(frame.size).height</div><div class=\"line\">        numberOfLines = originLines</div><div class=\"line\">        frame.size = resizeThatFits(frame.size)</div><div class=\"line\"></div><div class=\"line\">        exclusionView?.isHidden = <span class=\"literal\">false</span></div><div class=\"line\">        <span class=\"keyword\">if</span> frame.height == maxHeight &#123;</div><div class=\"line\">            frame.size = resizeThatFits(frame.size, isOver: <span class=\"literal\">true</span>)</div><div class=\"line\">            <span class=\"keyword\">if</span> isAutoHidenExclusionView &#123;</div><div class=\"line\">                exclusionView?.isHidden = <span class=\"literal\">true</span></div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">resizeThatFits</span><span class=\"params\">(<span class=\"number\">_</span> size: CGSize, isOver: Bool = <span class=\"literal\">false</span>)</span></span> -&gt; <span class=\"type\">CGSize</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> frame = <span class=\"type\">CGRect</span>.zero</div><div class=\"line\">        frame.size = size</div><div class=\"line\"></div><div class=\"line\">        textContainer.exclusionPaths.removeAll()</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> ovalPaths = [<span class=\"type\">UIBezierPath</span>]()</div><div class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> exclusionView = exclusionView &#123;</div><div class=\"line\">            <span class=\"keyword\">var</span> lastLineFrame = <span class=\"type\">CGRect</span>.zero</div><div class=\"line\">            <span class=\"keyword\">var</span> lineIdx = <span class=\"number\">0</span></div><div class=\"line\">            <span class=\"keyword\">var</span> lastFrame = <span class=\"type\">CGRect</span>.zero</div><div class=\"line\">            layoutManager.enumerateLineFragments(forGlyphRange: <span class=\"type\">NSMakeRange</span>(<span class=\"number\">0</span>, text.characters.<span class=\"built_in\">count</span>)) &#123; (rect1, rect2, textContainer, range, pointer) <span class=\"keyword\">in</span></div><div class=\"line\">                <span class=\"keyword\">if</span> lineIdx &lt; textContainer.maximumNumberOfLines &#123;</div><div class=\"line\">                    lastLineFrame = rect2</div><div class=\"line\">                &#125;</div><div class=\"line\">                lineIdx += <span class=\"number\">1</span></div><div class=\"line\">                lastFrame = rect2</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">if</span> lastLineFrame == <span class=\"type\">CGRect</span>.zero &#123;</div><div class=\"line\">                lastLineFrame = lastFrame</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"comment\">//  矫正</span></div><div class=\"line\">            lastLineFrame.origin.x += textContainerInset.<span class=\"keyword\">left</span></div><div class=\"line\">            lastLineFrame.origin.y += textContainerInset.top</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//  为末尾算出最大的frame</span></div><div class=\"line\">            lastLineFrame.origin.x = lastLineFrame.maxX</div><div class=\"line\">            lastLineFrame.origin.y = lastLineFrame.minY</div><div class=\"line\">            lastLineFrame.size.width = frame.width - lastLineFrame.minX</div><div class=\"line\">            lastLineFrame.size = exclusionView.sizeThatFits(lastLineFrame.size)</div><div class=\"line\">            <span class=\"keyword\">if</span> lastLineFrame.maxX &gt;= frame.width &#123;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">if</span> isOver == <span class=\"literal\">false</span> &#123;</div><div class=\"line\">                    lastLineFrame.origin.x -= lastLineFrame.maxX - frame.width + <span class=\"built_in\">max</span>(textContainerInset.bottom, textContainerInset.<span class=\"keyword\">right</span>)</div><div class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                    lastLineFrame.origin.x = lastFrame.minX + textContainerInset.<span class=\"keyword\">left</span> + <span class=\"number\">5</span></div><div class=\"line\">                    lastLineFrame.origin.y += lastFrame.height</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            exclusionView.frame = convert(lastLineFrame, to: exclusionView.superview)</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">var</span> ovalFrame = convert(exclusionView.bounds, from: exclusionView)</div><div class=\"line\">            ovalFrame.origin.x += <span class=\"number\">5</span> + textContainerInset.<span class=\"keyword\">left</span></div><div class=\"line\">            ovalPaths.append(<span class=\"type\">UIBezierPath</span>(rect: ovalFrame))</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">if</span> isOver, isAutoHidenExclusionView &#123;</div><div class=\"line\">                frame.size.height = lastFrame.maxY + textContainerInset.bottom</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                frame.size.height = ovalFrame.maxY + textContainerInset.bottom</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            frame.size = <span class=\"keyword\">super</span>.sizeThatFits(size)</div><div class=\"line\">        &#125;</div><div class=\"line\">        textContainer.exclusionPaths = ovalPaths</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">CGSize</span>(width: frame.maxX, height: frame.maxY)</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>  代码只是简单的做了一个DEMO，并没有仔细的调试，如果使用的话可能看需要根据自己的需求进行简单的调试吧。比如说偏移量、布局之类的。</p>\n","excerpt":"<p>看到AppStore的<code>更多</code>效果，做的不错哎，本文尝试采用<code>exclusionPaths</code>进行实现。不过有瑕疵。。来年用追加的方式在实现一下。感觉追加的方式比较简单。，</p>","more":"<h1 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h1><p><img src=\"http://7xvzwi.com1.z0.glb.clouddn.com/UITextKit-AppStore-more-scene.gif://7xvzwi.com1.z0.glb.clouddn.com/leanote_new_logo.png\" alt=\"效果图\"></p>\n<h1 id=\"简要说明\"><a href=\"#简要说明\" class=\"headerlink\" title=\"简要说明\"></a>简要说明</h1><p>  App Store中的查看更多动画是不是很给力？可是做起来确不知道如何下手？这里我提供一种UITextKit的方法来简单的实现一下。</p>\n<p>  为了让例子简单，我就直接写了个more，那个view是自定义的，随便添加的，和本身的文本展示的并没有什么关系。</p>\n<p>  为了让最后的那个moreView更加好用，增加了已经展开显示全部是否隐藏的控制。</p>\n<h1 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h1><p>  先看下Demo中调用吧：<br>  <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">let</span> info = <span class=\"type\">KTJExclusionLabel</span>()</div><div class=\"line\">info.exclusionView = more</div><div class=\"line\">info.isAutoHidenExclusionView = isAutoHiden.isOn</div><div class=\"line\">info.numberOfLines = <span class=\"type\">Int</span>.<span class=\"keyword\">init</span>(line.text ?? <span class=\"string\">\"\"</span>) ?? <span class=\"number\">0</span></div><div class=\"line\">info.sizeToFit()</div></pre></td></tr></table></figure></p>\n<p>  然后KTJExclusionLabel的实现：<br>  <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//</span></div><div class=\"line\"><span class=\"comment\">//  KTJExclusionLabel.swift</span></div><div class=\"line\"><span class=\"comment\">//  UITextKit-AppStore-more</span></div><div class=\"line\"><span class=\"comment\">//</span></div><div class=\"line\"><span class=\"comment\">//  Created by 孙继刚 on 2016/12/24.</span></div><div class=\"line\"><span class=\"comment\">//  Copyright © 2016年 madordie. All rights reserved.</span></div><div class=\"line\"><span class=\"comment\">//</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> UIKit</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">KTJExclusionLabel</span>: <span class=\"title\">UITextView</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/// 行数</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> numberOfLines: <span class=\"type\">Int</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">set</span> &#123;</div><div class=\"line\">            textContainer.maximumNumberOfLines = newValue</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">get</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> textContainer.maximumNumberOfLines</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> isAutoHidenExclusionView: <span class=\"type\">Bool</span> = <span class=\"literal\">false</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/// 避让的view</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">weak</span> <span class=\"keyword\">var</span> exclusionView: <span class=\"type\">UIView</span>? &#123;</div><div class=\"line\">        <span class=\"keyword\">didSet</span> &#123;</div><div class=\"line\">            setNeedsLayout()</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">init</span>(frame: <span class=\"type\">CGRect</span>, textContainer: <span class=\"type\">NSTextContainer</span>?) &#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>.<span class=\"keyword\">init</span>(frame: frame, textContainer: textContainer)</div><div class=\"line\">        setup()</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">required</span> <span class=\"keyword\">init</span>?(coder aDecoder: <span class=\"type\">NSCoder</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>.<span class=\"keyword\">init</span>(coder: aDecoder)</div><div class=\"line\">        setup()</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">setup</span><span class=\"params\">()</span></span> &#123;</div><div class=\"line\">        isEditable = <span class=\"literal\">true</span></div><div class=\"line\">        textContainer.lineBreakMode = .byTruncatingTail</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">sizeToFit</span><span class=\"params\">()</span></span> &#123;</div><div class=\"line\">        <span class=\"comment\">//  对其API还不熟悉，还没有找到如何一次判断出是否已经展示完全。。找到后再更</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">let</span> originLines = numberOfLines</div><div class=\"line\">        numberOfLines = <span class=\"number\">0</span></div><div class=\"line\">        <span class=\"keyword\">let</span> maxHeight = resizeThatFits(frame.size).height</div><div class=\"line\">        numberOfLines = originLines</div><div class=\"line\">        frame.size = resizeThatFits(frame.size)</div><div class=\"line\"></div><div class=\"line\">        exclusionView?.isHidden = <span class=\"literal\">false</span></div><div class=\"line\">        <span class=\"keyword\">if</span> frame.height == maxHeight &#123;</div><div class=\"line\">            frame.size = resizeThatFits(frame.size, isOver: <span class=\"literal\">true</span>)</div><div class=\"line\">            <span class=\"keyword\">if</span> isAutoHidenExclusionView &#123;</div><div class=\"line\">                exclusionView?.isHidden = <span class=\"literal\">true</span></div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">resizeThatFits</span><span class=\"params\">(<span class=\"number\">_</span> size: CGSize, isOver: Bool = <span class=\"literal\">false</span>)</span></span> -&gt; <span class=\"type\">CGSize</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> frame = <span class=\"type\">CGRect</span>.zero</div><div class=\"line\">        frame.size = size</div><div class=\"line\"></div><div class=\"line\">        textContainer.exclusionPaths.removeAll()</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> ovalPaths = [<span class=\"type\">UIBezierPath</span>]()</div><div class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> exclusionView = exclusionView &#123;</div><div class=\"line\">            <span class=\"keyword\">var</span> lastLineFrame = <span class=\"type\">CGRect</span>.zero</div><div class=\"line\">            <span class=\"keyword\">var</span> lineIdx = <span class=\"number\">0</span></div><div class=\"line\">            <span class=\"keyword\">var</span> lastFrame = <span class=\"type\">CGRect</span>.zero</div><div class=\"line\">            layoutManager.enumerateLineFragments(forGlyphRange: <span class=\"type\">NSMakeRange</span>(<span class=\"number\">0</span>, text.characters.<span class=\"built_in\">count</span>)) &#123; (rect1, rect2, textContainer, range, pointer) <span class=\"keyword\">in</span></div><div class=\"line\">                <span class=\"keyword\">if</span> lineIdx &lt; textContainer.maximumNumberOfLines &#123;</div><div class=\"line\">                    lastLineFrame = rect2</div><div class=\"line\">                &#125;</div><div class=\"line\">                lineIdx += <span class=\"number\">1</span></div><div class=\"line\">                lastFrame = rect2</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">if</span> lastLineFrame == <span class=\"type\">CGRect</span>.zero &#123;</div><div class=\"line\">                lastLineFrame = lastFrame</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"comment\">//  矫正</span></div><div class=\"line\">            lastLineFrame.origin.x += textContainerInset.<span class=\"keyword\">left</span></div><div class=\"line\">            lastLineFrame.origin.y += textContainerInset.top</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//  为末尾算出最大的frame</span></div><div class=\"line\">            lastLineFrame.origin.x = lastLineFrame.maxX</div><div class=\"line\">            lastLineFrame.origin.y = lastLineFrame.minY</div><div class=\"line\">            lastLineFrame.size.width = frame.width - lastLineFrame.minX</div><div class=\"line\">            lastLineFrame.size = exclusionView.sizeThatFits(lastLineFrame.size)</div><div class=\"line\">            <span class=\"keyword\">if</span> lastLineFrame.maxX &gt;= frame.width &#123;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">if</span> isOver == <span class=\"literal\">false</span> &#123;</div><div class=\"line\">                    lastLineFrame.origin.x -= lastLineFrame.maxX - frame.width + <span class=\"built_in\">max</span>(textContainerInset.bottom, textContainerInset.<span class=\"keyword\">right</span>)</div><div class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                    lastLineFrame.origin.x = lastFrame.minX + textContainerInset.<span class=\"keyword\">left</span> + <span class=\"number\">5</span></div><div class=\"line\">                    lastLineFrame.origin.y += lastFrame.height</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            exclusionView.frame = convert(lastLineFrame, to: exclusionView.superview)</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">var</span> ovalFrame = convert(exclusionView.bounds, from: exclusionView)</div><div class=\"line\">            ovalFrame.origin.x += <span class=\"number\">5</span> + textContainerInset.<span class=\"keyword\">left</span></div><div class=\"line\">            ovalPaths.append(<span class=\"type\">UIBezierPath</span>(rect: ovalFrame))</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">if</span> isOver, isAutoHidenExclusionView &#123;</div><div class=\"line\">                frame.size.height = lastFrame.maxY + textContainerInset.bottom</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                frame.size.height = ovalFrame.maxY + textContainerInset.bottom</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            frame.size = <span class=\"keyword\">super</span>.sizeThatFits(size)</div><div class=\"line\">        &#125;</div><div class=\"line\">        textContainer.exclusionPaths = ovalPaths</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">CGSize</span>(width: frame.maxX, height: frame.maxY)</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>  代码只是简单的做了一个DEMO，并没有仔细的调试，如果使用的话可能看需要根据自己的需求进行简单的调试吧。比如说偏移量、布局之类的。</p>"}],"PostAsset":[],"PostCategory":[{"post_id":"cj18v0f8z0003l0uvr7nzyyp9","category_id":"cj18v0f970006l0uv9e9vu2tw","_id":"cj18v0f9k000fl0uvkix1xdgd"},{"post_id":"cj18v0f9g000al0uvffi83r9e","category_id":"cj18v0f9j000cl0uv7mho31kg","_id":"cj18v0f9t000ll0uvcajqbn3m"},{"post_id":"cj18v0f9j000el0uvjp8u9s9i","category_id":"cj18v0f9n000il0uv7am2rwnl","_id":"cj18v0f9y000sl0uvh99pw4p2"},{"post_id":"cj18v0f9k000gl0uvcu5eli5t","category_id":"cj18v0f9v000ol0uvnmmmsmi2","_id":"cj18v0fa3000wl0uvxl2ian6e"},{"post_id":"cj18v0f9m000hl0uvc81uajof","category_id":"cj18v0f9v000ol0uvnmmmsmi2","_id":"cj18v0fa80012l0uvwblshsgs"},{"post_id":"cj18v0f9o000kl0uv8ec62lrc","category_id":"cj18v0f9v000ol0uvnmmmsmi2","_id":"cj18v0fad0016l0uv4wfob0fh"},{"post_id":"cj18v0fa0000ul0uvvim9795k","category_id":"cj18v0fa80013l0uvv0gkbole","_id":"cj18v0faf001dl0uvo9ie4hqd"},{"post_id":"cj18v0fad0018l0uvhb9lcn4j","category_id":"cj18v0faf001el0uv3x1bgmww","_id":"cj18v0fai001hl0uv2cwbcnss"}],"PostTag":[{"post_id":"cj18v0f940005l0uvpofcntmw","tag_id":"cj18v0f9f0009l0uv35cs9oyz","_id":"cj18v0f9o000jl0uvg2p3poji"},{"post_id":"cj18v0f940005l0uvpofcntmw","tag_id":"cj18v0f9j000dl0uv8a17wdkl","_id":"cj18v0f9t000ml0uvui334ypf"},{"post_id":"cj18v0f9t000nl0uv3hz8iuhw","tag_id":"cj18v0f9x000ql0uvyixfj7mq","_id":"cj18v0fa3000xl0uv946ucju0"},{"post_id":"cj18v0fa1000vl0uv4w4q9yh5","tag_id":"cj18v0f9f0009l0uv35cs9oyz","_id":"cj18v0fad0017l0uvmlzrpqui"},{"post_id":"cj18v0fa1000vl0uv4w4q9yh5","tag_id":"cj18v0fa60010l0uv2n4i1wvd","_id":"cj18v0fae0019l0uv71x24o4f"},{"post_id":"cj18v0fac0015l0uvevwnzh7x","tag_id":"cj18v0f9f0009l0uv35cs9oyz","_id":"cj18v0faf001cl0uvyr1hmh2i"},{"post_id":"cj18v0fae001al0uvxpms1y3w","tag_id":"cj18v0f9f0009l0uv35cs9oyz","_id":"cj18v0fag001fl0uv6v4ej1pp"},{"post_id":"cj18v0fad0018l0uvhb9lcn4j","tag_id":"cj18v0faf001bl0uvybksuvl9","_id":"cj18v0fah001gl0uvl3yqo1s6"},{"post_id":"cj18v0f9x000rl0uvdbn3pat9","tag_id":"cj18z5ohq0000unuvzf858jej","_id":"cj18z5ohx0002unuvmw189ih9"},{"post_id":"cj18v0f9x000rl0uvdbn3pat9","tag_id":"cj18z5ohw0001unuvxqw2pjqf","_id":"cj18z5ohx0003unuvzh4nr7sl"}],"Tag":[{"name":"iOS","_id":"cj18v0f9f0009l0uv35cs9oyz"},{"name":"牢骚","_id":"cj18v0f9j000dl0uv8a17wdkl"},{"name":"Fastlane","_id":"cj18v0f9x000ql0uvyixfj7mq"},{"name":"ReactiveCocoa","_id":"cj18v0fa60010l0uv2n4i1wvd"},{"name":"hexo","_id":"cj18v0faf001bl0uvybksuvl9"},{"name":"swift","_id":"cj18z5ohq0000unuvzf858jej"},{"name":"RxSwift","_id":"cj18z5ohw0001unuvxqw2pjqf"}]}}